var $3=e=>{throw TypeError(e)};var MC=(e,t,r)=>t.has(e)||$3("Cannot "+r);var Qt=(e,t,r)=>(MC(e,t,"read from private field"),r?r.call(e):t.get(e)),Oi=(e,t,r)=>t.has(e)?$3("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),Vn=(e,t,r,i)=>(MC(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r),Ps=(e,t,r)=>(MC(e,t,"access private method"),r);var Jw=(e,t,r,i)=>({set _(c){Vn(e,t,c,r)},get _(){return Qt(e,t,i)}});function TQ(e,t){for(var r=0;r<t.length;r++){const i=t[r];if(typeof i!="string"&&!Array.isArray(i)){for(const c in i)if(c!=="default"&&!(c in e)){const d=Object.getOwnPropertyDescriptor(i,c);d&&Object.defineProperty(e,c,d.get?d:{enumerable:!0,get:()=>i[c]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))i(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const g of d.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function r(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function i(c){if(c.ep)return;c.ep=!0;const d=r(c);fetch(c.href,d)}})();var gs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ii(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function EQ(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var r=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var c=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(r,i,c.get?c:{enumerable:!0,get:function(){return e[i]}})}),r}var wV={exports:{}},GE={},SV={exports:{}},ii={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M1=Symbol.for("react.element"),AQ=Symbol.for("react.portal"),PQ=Symbol.for("react.fragment"),CQ=Symbol.for("react.strict_mode"),IQ=Symbol.for("react.profiler"),OQ=Symbol.for("react.provider"),MQ=Symbol.for("react.context"),RQ=Symbol.for("react.forward_ref"),kQ=Symbol.for("react.suspense"),DQ=Symbol.for("react.memo"),LQ=Symbol.for("react.lazy"),U3=Symbol.iterator;function zQ(e){return e===null||typeof e!="object"?null:(e=U3&&e[U3]||e["@@iterator"],typeof e=="function"?e:null)}var TV={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},EV=Object.assign,AV={};function ly(e,t,r){this.props=e,this.context=t,this.refs=AV,this.updater=r||TV}ly.prototype.isReactComponent={};ly.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ly.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function PV(){}PV.prototype=ly.prototype;function JR(e,t,r){this.props=e,this.context=t,this.refs=AV,this.updater=r||TV}var QR=JR.prototype=new PV;QR.constructor=JR;EV(QR,ly.prototype);QR.isPureReactComponent=!0;var V3=Array.isArray,CV=Object.prototype.hasOwnProperty,ek={current:null},IV={key:!0,ref:!0,__self:!0,__source:!0};function OV(e,t,r){var i,c={},d=null,g=null;if(t!=null)for(i in t.ref!==void 0&&(g=t.ref),t.key!==void 0&&(d=""+t.key),t)CV.call(t,i)&&!IV.hasOwnProperty(i)&&(c[i]=t[i]);var o=arguments.length-2;if(o===1)c.children=r;else if(1<o){for(var w=Array(o),T=0;T<o;T++)w[T]=arguments[T+2];c.children=w}if(e&&e.defaultProps)for(i in o=e.defaultProps,o)c[i]===void 0&&(c[i]=o[i]);return{$$typeof:M1,type:e,key:d,ref:g,props:c,_owner:ek.current}}function NQ(e,t){return{$$typeof:M1,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function tk(e){return typeof e=="object"&&e!==null&&e.$$typeof===M1}function jQ(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var G3=/\/+/g;function RC(e,t){return typeof e=="object"&&e!==null&&e.key!=null?jQ(""+e.key):t.toString(36)}function GS(e,t,r,i,c){var d=typeof e;(d==="undefined"||d==="boolean")&&(e=null);var g=!1;if(e===null)g=!0;else switch(d){case"string":case"number":g=!0;break;case"object":switch(e.$$typeof){case M1:case AQ:g=!0}}if(g)return g=e,c=c(g),e=i===""?"."+RC(g,0):i,V3(c)?(r="",e!=null&&(r=e.replace(G3,"$&/")+"/"),GS(c,t,r,"",function(T){return T})):c!=null&&(tk(c)&&(c=NQ(c,r+(!c.key||g&&g.key===c.key?"":(""+c.key).replace(G3,"$&/")+"/")+e)),t.push(c)),1;if(g=0,i=i===""?".":i+":",V3(e))for(var o=0;o<e.length;o++){d=e[o];var w=i+RC(d,o);g+=GS(d,t,r,w,c)}else if(w=zQ(e),typeof w=="function")for(e=w.call(e),o=0;!(d=e.next()).done;)d=d.value,w=i+RC(d,o++),g+=GS(d,t,r,w,c);else if(d==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return g}function Qw(e,t,r){if(e==null)return e;var i=[],c=0;return GS(e,i,"","",function(d){return t.call(r,d,c++)}),i}function FQ(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ta={current:null},HS={transition:null},BQ={ReactCurrentDispatcher:ta,ReactCurrentBatchConfig:HS,ReactCurrentOwner:ek};function MV(){throw Error("act(...) is not supported in production builds of React.")}ii.Children={map:Qw,forEach:function(e,t,r){Qw(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return Qw(e,function(){t++}),t},toArray:function(e){return Qw(e,function(t){return t})||[]},only:function(e){if(!tk(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};ii.Component=ly;ii.Fragment=PQ;ii.Profiler=IQ;ii.PureComponent=JR;ii.StrictMode=CQ;ii.Suspense=kQ;ii.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BQ;ii.act=MV;ii.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=EV({},e.props),c=e.key,d=e.ref,g=e._owner;if(t!=null){if(t.ref!==void 0&&(d=t.ref,g=ek.current),t.key!==void 0&&(c=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(w in t)CV.call(t,w)&&!IV.hasOwnProperty(w)&&(i[w]=t[w]===void 0&&o!==void 0?o[w]:t[w])}var w=arguments.length-2;if(w===1)i.children=r;else if(1<w){o=Array(w);for(var T=0;T<w;T++)o[T]=arguments[T+2];i.children=o}return{$$typeof:M1,type:e.type,key:c,ref:d,props:i,_owner:g}};ii.createContext=function(e){return e={$$typeof:MQ,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:OQ,_context:e},e.Consumer=e};ii.createElement=OV;ii.createFactory=function(e){var t=OV.bind(null,e);return t.type=e,t};ii.createRef=function(){return{current:null}};ii.forwardRef=function(e){return{$$typeof:RQ,render:e}};ii.isValidElement=tk;ii.lazy=function(e){return{$$typeof:LQ,_payload:{_status:-1,_result:e},_init:FQ}};ii.memo=function(e,t){return{$$typeof:DQ,type:e,compare:t===void 0?null:t}};ii.startTransition=function(e){var t=HS.transition;HS.transition={};try{e()}finally{HS.transition=t}};ii.unstable_act=MV;ii.useCallback=function(e,t){return ta.current.useCallback(e,t)};ii.useContext=function(e){return ta.current.useContext(e)};ii.useDebugValue=function(){};ii.useDeferredValue=function(e){return ta.current.useDeferredValue(e)};ii.useEffect=function(e,t){return ta.current.useEffect(e,t)};ii.useId=function(){return ta.current.useId()};ii.useImperativeHandle=function(e,t,r){return ta.current.useImperativeHandle(e,t,r)};ii.useInsertionEffect=function(e,t){return ta.current.useInsertionEffect(e,t)};ii.useLayoutEffect=function(e,t){return ta.current.useLayoutEffect(e,t)};ii.useMemo=function(e,t){return ta.current.useMemo(e,t)};ii.useReducer=function(e,t,r){return ta.current.useReducer(e,t,r)};ii.useRef=function(e){return ta.current.useRef(e)};ii.useState=function(e){return ta.current.useState(e)};ii.useSyncExternalStore=function(e,t,r){return ta.current.useSyncExternalStore(e,t,r)};ii.useTransition=function(){return ta.current.useTransition()};ii.version="18.3.1";SV.exports=ii;var Q=SV.exports;const De=Ii(Q),RV=TQ({__proto__:null,default:De},[Q]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $Q=Q,UQ=Symbol.for("react.element"),VQ=Symbol.for("react.fragment"),GQ=Object.prototype.hasOwnProperty,HQ=$Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,WQ={key:!0,ref:!0,__self:!0,__source:!0};function kV(e,t,r){var i,c={},d=null,g=null;r!==void 0&&(d=""+r),t.key!==void 0&&(d=""+t.key),t.ref!==void 0&&(g=t.ref);for(i in t)GQ.call(t,i)&&!WQ.hasOwnProperty(i)&&(c[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps,t)c[i]===void 0&&(c[i]=t[i]);return{$$typeof:UQ,type:e,key:d,ref:g,props:c,_owner:HQ.current}}GE.Fragment=VQ;GE.jsx=kV;GE.jsxs=kV;wV.exports=GE;var z=wV.exports,DV={exports:{}},Ha={},LV={exports:{}},zV={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(Ue,st){var bt=Ue.length;Ue.push(st);e:for(;0<bt;){var At=bt-1>>>1,zt=Ue[At];if(0<c(zt,st))Ue[At]=st,Ue[bt]=zt,bt=At;else break e}}function r(Ue){return Ue.length===0?null:Ue[0]}function i(Ue){if(Ue.length===0)return null;var st=Ue[0],bt=Ue.pop();if(bt!==st){Ue[0]=bt;e:for(var At=0,zt=Ue.length,or=zt>>>1;At<or;){var Mr=2*(At+1)-1,Ar=Ue[Mr],vr=Mr+1,nr=Ue[vr];if(0>c(Ar,bt))vr<zt&&0>c(nr,Ar)?(Ue[At]=nr,Ue[vr]=bt,At=vr):(Ue[At]=Ar,Ue[Mr]=bt,At=Mr);else if(vr<zt&&0>c(nr,bt))Ue[At]=nr,Ue[vr]=bt,At=vr;else break e}}return st}function c(Ue,st){var bt=Ue.sortIndex-st.sortIndex;return bt!==0?bt:Ue.id-st.id}if(typeof performance=="object"&&typeof performance.now=="function"){var d=performance;e.unstable_now=function(){return d.now()}}else{var g=Date,o=g.now();e.unstable_now=function(){return g.now()-o}}var w=[],T=[],I=1,C=null,R=3,F=!1,G=!1,j=!1,H=typeof setTimeout=="function"?setTimeout:null,X=typeof clearTimeout=="function"?clearTimeout:null,q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Z(Ue){for(var st=r(T);st!==null;){if(st.callback===null)i(T);else if(st.startTime<=Ue)i(T),st.sortIndex=st.expirationTime,t(w,st);else break;st=r(T)}}function J(Ue){if(j=!1,Z(Ue),!G)if(r(w)!==null)G=!0,ct(ne);else{var st=r(T);st!==null&&St(J,st.startTime-Ue)}}function ne(Ue,st){G=!1,j&&(j=!1,X(Se),Se=-1),F=!0;var bt=R;try{for(Z(st),C=r(w);C!==null&&(!(C.expirationTime>st)||Ue&&!He());){var At=C.callback;if(typeof At=="function"){C.callback=null,R=C.priorityLevel;var zt=At(C.expirationTime<=st);st=e.unstable_now(),typeof zt=="function"?C.callback=zt:C===r(w)&&i(w),Z(st)}else i(w);C=r(w)}if(C!==null)var or=!0;else{var Mr=r(T);Mr!==null&&St(J,Mr.startTime-st),or=!1}return or}finally{C=null,R=bt,F=!1}}var he=!1,me=null,Se=-1,qe=5,Ze=-1;function He(){return!(e.unstable_now()-Ze<qe)}function Ke(){if(me!==null){var Ue=e.unstable_now();Ze=Ue;var st=!0;try{st=me(!0,Ue)}finally{st?dt():(he=!1,me=null)}}else he=!1}var dt;if(typeof q=="function")dt=function(){q(Ke)};else if(typeof MessageChannel<"u"){var $e=new MessageChannel,mt=$e.port2;$e.port1.onmessage=Ke,dt=function(){mt.postMessage(null)}}else dt=function(){H(Ke,0)};function ct(Ue){me=Ue,he||(he=!0,dt())}function St(Ue,st){Se=H(function(){Ue(e.unstable_now())},st)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Ue){Ue.callback=null},e.unstable_continueExecution=function(){G||F||(G=!0,ct(ne))},e.unstable_forceFrameRate=function(Ue){0>Ue||125<Ue?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):qe=0<Ue?Math.floor(1e3/Ue):5},e.unstable_getCurrentPriorityLevel=function(){return R},e.unstable_getFirstCallbackNode=function(){return r(w)},e.unstable_next=function(Ue){switch(R){case 1:case 2:case 3:var st=3;break;default:st=R}var bt=R;R=st;try{return Ue()}finally{R=bt}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Ue,st){switch(Ue){case 1:case 2:case 3:case 4:case 5:break;default:Ue=3}var bt=R;R=Ue;try{return st()}finally{R=bt}},e.unstable_scheduleCallback=function(Ue,st,bt){var At=e.unstable_now();switch(typeof bt=="object"&&bt!==null?(bt=bt.delay,bt=typeof bt=="number"&&0<bt?At+bt:At):bt=At,Ue){case 1:var zt=-1;break;case 2:zt=250;break;case 5:zt=1073741823;break;case 4:zt=1e4;break;default:zt=5e3}return zt=bt+zt,Ue={id:I++,callback:st,priorityLevel:Ue,startTime:bt,expirationTime:zt,sortIndex:-1},bt>At?(Ue.sortIndex=bt,t(T,Ue),r(w)===null&&Ue===r(T)&&(j?(X(Se),Se=-1):j=!0,St(J,bt-At))):(Ue.sortIndex=zt,t(w,Ue),G||F||(G=!0,ct(ne))),Ue},e.unstable_shouldYield=He,e.unstable_wrapCallback=function(Ue){var st=R;return function(){var bt=R;R=st;try{return Ue.apply(this,arguments)}finally{R=bt}}}})(zV);LV.exports=zV;var qQ=LV.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZQ=Q,Ga=qQ;function lr(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var NV=new Set,xx={};function em(e,t){C_(e,t),C_(e+"Capture",t)}function C_(e,t){for(xx[e]=t,e=0;e<t.length;e++)NV.add(t[e])}var qu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),eO=Object.prototype.hasOwnProperty,XQ=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,H3={},W3={};function KQ(e){return eO.call(W3,e)?!0:eO.call(H3,e)?!1:XQ.test(e)?W3[e]=!0:(H3[e]=!0,!1)}function YQ(e,t,r,i){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function JQ(e,t,r,i){if(t===null||typeof t>"u"||YQ(e,t,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ra(e,t,r,i,c,d,g){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=i,this.attributeNamespace=c,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=d,this.removeEmptyString=g}var ys={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ys[e]=new ra(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ys[t]=new ra(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ys[e]=new ra(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ys[e]=new ra(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ys[e]=new ra(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ys[e]=new ra(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ys[e]=new ra(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ys[e]=new ra(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ys[e]=new ra(e,5,!1,e.toLowerCase(),null,!1,!1)});var rk=/[\-:]([a-z])/g;function nk(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(rk,nk);ys[t]=new ra(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(rk,nk);ys[t]=new ra(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(rk,nk);ys[t]=new ra(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ys[e]=new ra(e,1,!1,e.toLowerCase(),null,!1,!1)});ys.xlinkHref=new ra("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ys[e]=new ra(e,1,!1,e.toLowerCase(),null,!0,!0)});function ik(e,t,r,i){var c=ys.hasOwnProperty(t)?ys[t]:null;(c!==null?c.type!==0:i||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(JQ(t,r,c,i)&&(r=null),i||c===null?KQ(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):c.mustUseProperty?e[c.propertyName]=r===null?c.type===3?!1:"":r:(t=c.attributeName,i=c.attributeNamespace,r===null?e.removeAttribute(t):(c=c.type,r=c===3||c===4&&r===!0?"":""+r,i?e.setAttributeNS(i,t,r):e.setAttribute(t,r))))}var nh=ZQ.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,eS=Symbol.for("react.element"),Ug=Symbol.for("react.portal"),Vg=Symbol.for("react.fragment"),ok=Symbol.for("react.strict_mode"),tO=Symbol.for("react.profiler"),jV=Symbol.for("react.provider"),FV=Symbol.for("react.context"),sk=Symbol.for("react.forward_ref"),rO=Symbol.for("react.suspense"),nO=Symbol.for("react.suspense_list"),ak=Symbol.for("react.memo"),sd=Symbol.for("react.lazy"),BV=Symbol.for("react.offscreen"),q3=Symbol.iterator;function b0(e){return e===null||typeof e!="object"?null:(e=q3&&e[q3]||e["@@iterator"],typeof e=="function"?e:null)}var fo=Object.assign,kC;function U0(e){if(kC===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);kC=t&&t[1]||""}return`
`+kC+e}var DC=!1;function LC(e,t){if(!e||DC)return"";DC=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(T){var i=T}Reflect.construct(e,[],t)}else{try{t.call()}catch(T){i=T}e.call(t.prototype)}else{try{throw Error()}catch(T){i=T}e()}}catch(T){if(T&&i&&typeof T.stack=="string"){for(var c=T.stack.split(`
`),d=i.stack.split(`
`),g=c.length-1,o=d.length-1;1<=g&&0<=o&&c[g]!==d[o];)o--;for(;1<=g&&0<=o;g--,o--)if(c[g]!==d[o]){if(g!==1||o!==1)do if(g--,o--,0>o||c[g]!==d[o]){var w=`
`+c[g].replace(" at new "," at ");return e.displayName&&w.includes("<anonymous>")&&(w=w.replace("<anonymous>",e.displayName)),w}while(1<=g&&0<=o);break}}}finally{DC=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?U0(e):""}function QQ(e){switch(e.tag){case 5:return U0(e.type);case 16:return U0("Lazy");case 13:return U0("Suspense");case 19:return U0("SuspenseList");case 0:case 2:case 15:return e=LC(e.type,!1),e;case 11:return e=LC(e.type.render,!1),e;case 1:return e=LC(e.type,!0),e;default:return""}}function iO(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case Vg:return"Fragment";case Ug:return"Portal";case tO:return"Profiler";case ok:return"StrictMode";case rO:return"Suspense";case nO:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case FV:return(e.displayName||"Context")+".Consumer";case jV:return(e._context.displayName||"Context")+".Provider";case sk:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ak:return t=e.displayName||null,t!==null?t:iO(e.type)||"Memo";case sd:t=e._payload,e=e._init;try{return iO(e(t))}catch{}}return null}function eee(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return iO(t);case 8:return t===ok?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Ld(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function $V(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function tee(e){var t=$V(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),i=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var c=r.get,d=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return c.call(this)},set:function(g){i=""+g,d.call(this,g)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(g){i=""+g},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function tS(e){e._valueTracker||(e._valueTracker=tee(e))}function UV(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),i="";return e&&(i=$V(e)?e.checked?"true":"false":e.value),e=i,e!==r?(t.setValue(e),!0):!1}function lT(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function oO(e,t){var r=t.checked;return fo({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function Z3(e,t){var r=t.defaultValue==null?"":t.defaultValue,i=t.checked!=null?t.checked:t.defaultChecked;r=Ld(t.value!=null?t.value:r),e._wrapperState={initialChecked:i,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function VV(e,t){t=t.checked,t!=null&&ik(e,"checked",t,!1)}function sO(e,t){VV(e,t);var r=Ld(t.value),i=t.type;if(r!=null)i==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(i==="submit"||i==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?aO(e,t.type,r):t.hasOwnProperty("defaultValue")&&aO(e,t.type,Ld(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function X3(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var i=t.type;if(!(i!=="submit"&&i!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function aO(e,t,r){(t!=="number"||lT(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var V0=Array.isArray;function i_(e,t,r,i){if(e=e.options,t){t={};for(var c=0;c<r.length;c++)t["$"+r[c]]=!0;for(r=0;r<e.length;r++)c=t.hasOwnProperty("$"+e[r].value),e[r].selected!==c&&(e[r].selected=c),c&&i&&(e[r].defaultSelected=!0)}else{for(r=""+Ld(r),t=null,c=0;c<e.length;c++){if(e[c].value===r){e[c].selected=!0,i&&(e[c].defaultSelected=!0);return}t!==null||e[c].disabled||(t=e[c])}t!==null&&(t.selected=!0)}}function lO(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(lr(91));return fo({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function K3(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(lr(92));if(V0(r)){if(1<r.length)throw Error(lr(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Ld(r)}}function GV(e,t){var r=Ld(t.value),i=Ld(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),i!=null&&(e.defaultValue=""+i)}function Y3(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function HV(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cO(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?HV(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var rS,WV=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,i,c){MSApp.execUnsafeLocalFunction(function(){return e(t,r,i,c)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(rS=rS||document.createElement("div"),rS.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=rS.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function bx(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var K0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ree=["Webkit","ms","Moz","O"];Object.keys(K0).forEach(function(e){ree.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),K0[t]=K0[e]})});function qV(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||K0.hasOwnProperty(e)&&K0[e]?(""+t).trim():t+"px"}function ZV(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var i=r.indexOf("--")===0,c=qV(r,t[r],i);r==="float"&&(r="cssFloat"),i?e.setProperty(r,c):e[r]=c}}var nee=fo({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function uO(e,t){if(t){if(nee[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(lr(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(lr(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(lr(61))}if(t.style!=null&&typeof t.style!="object")throw Error(lr(62))}}function hO(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dO=null;function lk(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var fO=null,o_=null,s_=null;function J3(e){if(e=D1(e)){if(typeof fO!="function")throw Error(lr(280));var t=e.stateNode;t&&(t=XE(t),fO(e.stateNode,e.type,t))}}function XV(e){o_?s_?s_.push(e):s_=[e]:o_=e}function KV(){if(o_){var e=o_,t=s_;if(s_=o_=null,J3(e),t)for(e=0;e<t.length;e++)J3(t[e])}}function YV(e,t){return e(t)}function JV(){}var zC=!1;function QV(e,t,r){if(zC)return e(t,r);zC=!0;try{return YV(e,t,r)}finally{zC=!1,(o_!==null||s_!==null)&&(JV(),KV())}}function wx(e,t){var r=e.stateNode;if(r===null)return null;var i=XE(r);if(i===null)return null;r=i[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(e=e.type,i=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!i;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(lr(231,t,typeof r));return r}var pO=!1;if(qu)try{var w0={};Object.defineProperty(w0,"passive",{get:function(){pO=!0}}),window.addEventListener("test",w0,w0),window.removeEventListener("test",w0,w0)}catch{pO=!1}function iee(e,t,r,i,c,d,g,o,w){var T=Array.prototype.slice.call(arguments,3);try{t.apply(r,T)}catch(I){this.onError(I)}}var Y0=!1,cT=null,uT=!1,mO=null,oee={onError:function(e){Y0=!0,cT=e}};function see(e,t,r,i,c,d,g,o,w){Y0=!1,cT=null,iee.apply(oee,arguments)}function aee(e,t,r,i,c,d,g,o,w){if(see.apply(this,arguments),Y0){if(Y0){var T=cT;Y0=!1,cT=null}else throw Error(lr(198));uT||(uT=!0,mO=T)}}function tm(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function e6(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Q3(e){if(tm(e)!==e)throw Error(lr(188))}function lee(e){var t=e.alternate;if(!t){if(t=tm(e),t===null)throw Error(lr(188));return t!==e?null:e}for(var r=e,i=t;;){var c=r.return;if(c===null)break;var d=c.alternate;if(d===null){if(i=c.return,i!==null){r=i;continue}break}if(c.child===d.child){for(d=c.child;d;){if(d===r)return Q3(c),e;if(d===i)return Q3(c),t;d=d.sibling}throw Error(lr(188))}if(r.return!==i.return)r=c,i=d;else{for(var g=!1,o=c.child;o;){if(o===r){g=!0,r=c,i=d;break}if(o===i){g=!0,i=c,r=d;break}o=o.sibling}if(!g){for(o=d.child;o;){if(o===r){g=!0,r=d,i=c;break}if(o===i){g=!0,i=d,r=c;break}o=o.sibling}if(!g)throw Error(lr(189))}}if(r.alternate!==i)throw Error(lr(190))}if(r.tag!==3)throw Error(lr(188));return r.stateNode.current===r?e:t}function t6(e){return e=lee(e),e!==null?r6(e):null}function r6(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=r6(e);if(t!==null)return t;e=e.sibling}return null}var n6=Ga.unstable_scheduleCallback,eF=Ga.unstable_cancelCallback,cee=Ga.unstable_shouldYield,uee=Ga.unstable_requestPaint,Po=Ga.unstable_now,hee=Ga.unstable_getCurrentPriorityLevel,ck=Ga.unstable_ImmediatePriority,i6=Ga.unstable_UserBlockingPriority,hT=Ga.unstable_NormalPriority,dee=Ga.unstable_LowPriority,o6=Ga.unstable_IdlePriority,HE=null,Zc=null;function fee(e){if(Zc&&typeof Zc.onCommitFiberRoot=="function")try{Zc.onCommitFiberRoot(HE,e,void 0,(e.current.flags&128)===128)}catch{}}var ic=Math.clz32?Math.clz32:gee,pee=Math.log,mee=Math.LN2;function gee(e){return e>>>=0,e===0?32:31-(pee(e)/mee|0)|0}var nS=64,iS=4194304;function G0(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dT(e,t){var r=e.pendingLanes;if(r===0)return 0;var i=0,c=e.suspendedLanes,d=e.pingedLanes,g=r&268435455;if(g!==0){var o=g&~c;o!==0?i=G0(o):(d&=g,d!==0&&(i=G0(d)))}else g=r&~c,g!==0?i=G0(g):d!==0&&(i=G0(d));if(i===0)return 0;if(t!==0&&t!==i&&!(t&c)&&(c=i&-i,d=t&-t,c>=d||c===16&&(d&4194240)!==0))return t;if(i&4&&(i|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=i;0<t;)r=31-ic(t),c=1<<r,i|=e[r],t&=~c;return i}function _ee(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yee(e,t){for(var r=e.suspendedLanes,i=e.pingedLanes,c=e.expirationTimes,d=e.pendingLanes;0<d;){var g=31-ic(d),o=1<<g,w=c[g];w===-1?(!(o&r)||o&i)&&(c[g]=_ee(o,t)):w<=t&&(e.expiredLanes|=o),d&=~o}}function gO(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function s6(){var e=nS;return nS<<=1,!(nS&4194240)&&(nS=64),e}function NC(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function R1(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-ic(t),e[t]=r}function vee(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var i=e.eventTimes;for(e=e.expirationTimes;0<r;){var c=31-ic(r),d=1<<c;t[c]=0,i[c]=-1,e[c]=-1,r&=~d}}function uk(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var i=31-ic(r),c=1<<i;c&t|e[i]&t&&(e[i]|=t),r&=~c}}var zi=0;function a6(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var l6,hk,c6,u6,h6,_O=!1,oS=[],Td=null,Ed=null,Ad=null,Sx=new Map,Tx=new Map,hd=[],xee="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tF(e,t){switch(e){case"focusin":case"focusout":Td=null;break;case"dragenter":case"dragleave":Ed=null;break;case"mouseover":case"mouseout":Ad=null;break;case"pointerover":case"pointerout":Sx.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tx.delete(t.pointerId)}}function S0(e,t,r,i,c,d){return e===null||e.nativeEvent!==d?(e={blockedOn:t,domEventName:r,eventSystemFlags:i,nativeEvent:d,targetContainers:[c]},t!==null&&(t=D1(t),t!==null&&hk(t)),e):(e.eventSystemFlags|=i,t=e.targetContainers,c!==null&&t.indexOf(c)===-1&&t.push(c),e)}function bee(e,t,r,i,c){switch(t){case"focusin":return Td=S0(Td,e,t,r,i,c),!0;case"dragenter":return Ed=S0(Ed,e,t,r,i,c),!0;case"mouseover":return Ad=S0(Ad,e,t,r,i,c),!0;case"pointerover":var d=c.pointerId;return Sx.set(d,S0(Sx.get(d)||null,e,t,r,i,c)),!0;case"gotpointercapture":return d=c.pointerId,Tx.set(d,S0(Tx.get(d)||null,e,t,r,i,c)),!0}return!1}function d6(e){var t=wp(e.target);if(t!==null){var r=tm(t);if(r!==null){if(t=r.tag,t===13){if(t=e6(r),t!==null){e.blockedOn=t,h6(e.priority,function(){c6(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function WS(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=yO(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var i=new r.constructor(r.type,r);dO=i,r.target.dispatchEvent(i),dO=null}else return t=D1(r),t!==null&&hk(t),e.blockedOn=r,!1;t.shift()}return!0}function rF(e,t,r){WS(e)&&r.delete(t)}function wee(){_O=!1,Td!==null&&WS(Td)&&(Td=null),Ed!==null&&WS(Ed)&&(Ed=null),Ad!==null&&WS(Ad)&&(Ad=null),Sx.forEach(rF),Tx.forEach(rF)}function T0(e,t){e.blockedOn===t&&(e.blockedOn=null,_O||(_O=!0,Ga.unstable_scheduleCallback(Ga.unstable_NormalPriority,wee)))}function Ex(e){function t(c){return T0(c,e)}if(0<oS.length){T0(oS[0],e);for(var r=1;r<oS.length;r++){var i=oS[r];i.blockedOn===e&&(i.blockedOn=null)}}for(Td!==null&&T0(Td,e),Ed!==null&&T0(Ed,e),Ad!==null&&T0(Ad,e),Sx.forEach(t),Tx.forEach(t),r=0;r<hd.length;r++)i=hd[r],i.blockedOn===e&&(i.blockedOn=null);for(;0<hd.length&&(r=hd[0],r.blockedOn===null);)d6(r),r.blockedOn===null&&hd.shift()}var a_=nh.ReactCurrentBatchConfig,fT=!0;function See(e,t,r,i){var c=zi,d=a_.transition;a_.transition=null;try{zi=1,dk(e,t,r,i)}finally{zi=c,a_.transition=d}}function Tee(e,t,r,i){var c=zi,d=a_.transition;a_.transition=null;try{zi=4,dk(e,t,r,i)}finally{zi=c,a_.transition=d}}function dk(e,t,r,i){if(fT){var c=yO(e,t,r,i);if(c===null)qC(e,t,i,pT,r),tF(e,i);else if(bee(c,e,t,r,i))i.stopPropagation();else if(tF(e,i),t&4&&-1<xee.indexOf(e)){for(;c!==null;){var d=D1(c);if(d!==null&&l6(d),d=yO(e,t,r,i),d===null&&qC(e,t,i,pT,r),d===c)break;c=d}c!==null&&i.stopPropagation()}else qC(e,t,i,null,r)}}var pT=null;function yO(e,t,r,i){if(pT=null,e=lk(i),e=wp(e),e!==null)if(t=tm(e),t===null)e=null;else if(r=t.tag,r===13){if(e=e6(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return pT=e,null}function f6(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hee()){case ck:return 1;case i6:return 4;case hT:case dee:return 16;case o6:return 536870912;default:return 16}default:return 16}}var xd=null,fk=null,qS=null;function p6(){if(qS)return qS;var e,t=fk,r=t.length,i,c="value"in xd?xd.value:xd.textContent,d=c.length;for(e=0;e<r&&t[e]===c[e];e++);var g=r-e;for(i=1;i<=g&&t[r-i]===c[d-i];i++);return qS=c.slice(e,1<i?1-i:void 0)}function ZS(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function sS(){return!0}function nF(){return!1}function Wa(e){function t(r,i,c,d,g){this._reactName=r,this._targetInst=c,this.type=i,this.nativeEvent=d,this.target=g,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(r=e[o],this[o]=r?r(d):d[o]);return this.isDefaultPrevented=(d.defaultPrevented!=null?d.defaultPrevented:d.returnValue===!1)?sS:nF,this.isPropagationStopped=nF,this}return fo(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=sS)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=sS)},persist:function(){},isPersistent:sS}),t}var cy={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pk=Wa(cy),k1=fo({},cy,{view:0,detail:0}),Eee=Wa(k1),jC,FC,E0,WE=fo({},k1,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mk,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==E0&&(E0&&e.type==="mousemove"?(jC=e.screenX-E0.screenX,FC=e.screenY-E0.screenY):FC=jC=0,E0=e),jC)},movementY:function(e){return"movementY"in e?e.movementY:FC}}),iF=Wa(WE),Aee=fo({},WE,{dataTransfer:0}),Pee=Wa(Aee),Cee=fo({},k1,{relatedTarget:0}),BC=Wa(Cee),Iee=fo({},cy,{animationName:0,elapsedTime:0,pseudoElement:0}),Oee=Wa(Iee),Mee=fo({},cy,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ree=Wa(Mee),kee=fo({},cy,{data:0}),oF=Wa(kee),Dee={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Lee={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zee={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nee(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=zee[e])?!!t[e]:!1}function mk(){return Nee}var jee=fo({},k1,{key:function(e){if(e.key){var t=Dee[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ZS(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Lee[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mk,charCode:function(e){return e.type==="keypress"?ZS(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ZS(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Fee=Wa(jee),Bee=fo({},WE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),sF=Wa(Bee),$ee=fo({},k1,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mk}),Uee=Wa($ee),Vee=fo({},cy,{propertyName:0,elapsedTime:0,pseudoElement:0}),Gee=Wa(Vee),Hee=fo({},WE,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Wee=Wa(Hee),qee=[9,13,27,32],gk=qu&&"CompositionEvent"in window,J0=null;qu&&"documentMode"in document&&(J0=document.documentMode);var Zee=qu&&"TextEvent"in window&&!J0,m6=qu&&(!gk||J0&&8<J0&&11>=J0),aF=" ",lF=!1;function g6(e,t){switch(e){case"keyup":return qee.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _6(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var Gg=!1;function Xee(e,t){switch(e){case"compositionend":return _6(t);case"keypress":return t.which!==32?null:(lF=!0,aF);case"textInput":return e=t.data,e===aF&&lF?null:e;default:return null}}function Kee(e,t){if(Gg)return e==="compositionend"||!gk&&g6(e,t)?(e=p6(),qS=fk=xd=null,Gg=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return m6&&t.locale!=="ko"?null:t.data;default:return null}}var Yee={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cF(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Yee[e.type]:t==="textarea"}function y6(e,t,r,i){XV(i),t=mT(t,"onChange"),0<t.length&&(r=new pk("onChange","change",null,r,i),e.push({event:r,listeners:t}))}var Q0=null,Ax=null;function Jee(e){I6(e,0)}function qE(e){var t=qg(e);if(UV(t))return e}function Qee(e,t){if(e==="change")return t}var v6=!1;if(qu){var $C;if(qu){var UC="oninput"in document;if(!UC){var uF=document.createElement("div");uF.setAttribute("oninput","return;"),UC=typeof uF.oninput=="function"}$C=UC}else $C=!1;v6=$C&&(!document.documentMode||9<document.documentMode)}function hF(){Q0&&(Q0.detachEvent("onpropertychange",x6),Ax=Q0=null)}function x6(e){if(e.propertyName==="value"&&qE(Ax)){var t=[];y6(t,Ax,e,lk(e)),QV(Jee,t)}}function ete(e,t,r){e==="focusin"?(hF(),Q0=t,Ax=r,Q0.attachEvent("onpropertychange",x6)):e==="focusout"&&hF()}function tte(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return qE(Ax)}function rte(e,t){if(e==="click")return qE(t)}function nte(e,t){if(e==="input"||e==="change")return qE(t)}function ite(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var lc=typeof Object.is=="function"?Object.is:ite;function Px(e,t){if(lc(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var c=r[i];if(!eO.call(t,c)||!lc(e[c],t[c]))return!1}return!0}function dF(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function fF(e,t){var r=dF(e);e=0;for(var i;r;){if(r.nodeType===3){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=dF(r)}}function b6(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?b6(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function w6(){for(var e=window,t=lT();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=lT(e.document)}return t}function _k(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function ote(e){var t=w6(),r=e.focusedElem,i=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&b6(r.ownerDocument.documentElement,r)){if(i!==null&&_k(r)){if(t=i.start,e=i.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var c=r.textContent.length,d=Math.min(i.start,c);i=i.end===void 0?d:Math.min(i.end,c),!e.extend&&d>i&&(c=i,i=d,d=c),c=fF(r,d);var g=fF(r,i);c&&g&&(e.rangeCount!==1||e.anchorNode!==c.node||e.anchorOffset!==c.offset||e.focusNode!==g.node||e.focusOffset!==g.offset)&&(t=t.createRange(),t.setStart(c.node,c.offset),e.removeAllRanges(),d>i?(e.addRange(t),e.extend(g.node,g.offset)):(t.setEnd(g.node,g.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ste=qu&&"documentMode"in document&&11>=document.documentMode,Hg=null,vO=null,ex=null,xO=!1;function pF(e,t,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;xO||Hg==null||Hg!==lT(i)||(i=Hg,"selectionStart"in i&&_k(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ex&&Px(ex,i)||(ex=i,i=mT(vO,"onSelect"),0<i.length&&(t=new pk("onSelect","select",null,t,r),e.push({event:t,listeners:i}),t.target=Hg)))}function aS(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var Wg={animationend:aS("Animation","AnimationEnd"),animationiteration:aS("Animation","AnimationIteration"),animationstart:aS("Animation","AnimationStart"),transitionend:aS("Transition","TransitionEnd")},VC={},S6={};qu&&(S6=document.createElement("div").style,"AnimationEvent"in window||(delete Wg.animationend.animation,delete Wg.animationiteration.animation,delete Wg.animationstart.animation),"TransitionEvent"in window||delete Wg.transitionend.transition);function ZE(e){if(VC[e])return VC[e];if(!Wg[e])return e;var t=Wg[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in S6)return VC[e]=t[r];return e}var T6=ZE("animationend"),E6=ZE("animationiteration"),A6=ZE("animationstart"),P6=ZE("transitionend"),C6=new Map,mF="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vd(e,t){C6.set(e,t),em(t,[e])}for(var GC=0;GC<mF.length;GC++){var HC=mF[GC],ate=HC.toLowerCase(),lte=HC[0].toUpperCase()+HC.slice(1);Vd(ate,"on"+lte)}Vd(T6,"onAnimationEnd");Vd(E6,"onAnimationIteration");Vd(A6,"onAnimationStart");Vd("dblclick","onDoubleClick");Vd("focusin","onFocus");Vd("focusout","onBlur");Vd(P6,"onTransitionEnd");C_("onMouseEnter",["mouseout","mouseover"]);C_("onMouseLeave",["mouseout","mouseover"]);C_("onPointerEnter",["pointerout","pointerover"]);C_("onPointerLeave",["pointerout","pointerover"]);em("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));em("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));em("onBeforeInput",["compositionend","keypress","textInput","paste"]);em("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));em("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));em("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var H0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cte=new Set("cancel close invalid load scroll toggle".split(" ").concat(H0));function gF(e,t,r){var i=e.type||"unknown-event";e.currentTarget=r,aee(i,t,void 0,e),e.currentTarget=null}function I6(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var i=e[r],c=i.event;i=i.listeners;e:{var d=void 0;if(t)for(var g=i.length-1;0<=g;g--){var o=i[g],w=o.instance,T=o.currentTarget;if(o=o.listener,w!==d&&c.isPropagationStopped())break e;gF(c,o,T),d=w}else for(g=0;g<i.length;g++){if(o=i[g],w=o.instance,T=o.currentTarget,o=o.listener,w!==d&&c.isPropagationStopped())break e;gF(c,o,T),d=w}}}if(uT)throw e=mO,uT=!1,mO=null,e}function eo(e,t){var r=t[EO];r===void 0&&(r=t[EO]=new Set);var i=e+"__bubble";r.has(i)||(O6(t,e,2,!1),r.add(i))}function WC(e,t,r){var i=0;t&&(i|=4),O6(r,e,i,t)}var lS="_reactListening"+Math.random().toString(36).slice(2);function Cx(e){if(!e[lS]){e[lS]=!0,NV.forEach(function(r){r!=="selectionchange"&&(cte.has(r)||WC(r,!1,e),WC(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[lS]||(t[lS]=!0,WC("selectionchange",!1,t))}}function O6(e,t,r,i){switch(f6(t)){case 1:var c=See;break;case 4:c=Tee;break;default:c=dk}r=c.bind(null,t,r,e),c=void 0,!pO||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(c=!0),i?c!==void 0?e.addEventListener(t,r,{capture:!0,passive:c}):e.addEventListener(t,r,!0):c!==void 0?e.addEventListener(t,r,{passive:c}):e.addEventListener(t,r,!1)}function qC(e,t,r,i,c){var d=i;if(!(t&1)&&!(t&2)&&i!==null)e:for(;;){if(i===null)return;var g=i.tag;if(g===3||g===4){var o=i.stateNode.containerInfo;if(o===c||o.nodeType===8&&o.parentNode===c)break;if(g===4)for(g=i.return;g!==null;){var w=g.tag;if((w===3||w===4)&&(w=g.stateNode.containerInfo,w===c||w.nodeType===8&&w.parentNode===c))return;g=g.return}for(;o!==null;){if(g=wp(o),g===null)return;if(w=g.tag,w===5||w===6){i=d=g;continue e}o=o.parentNode}}i=i.return}QV(function(){var T=d,I=lk(r),C=[];e:{var R=C6.get(e);if(R!==void 0){var F=pk,G=e;switch(e){case"keypress":if(ZS(r)===0)break e;case"keydown":case"keyup":F=Fee;break;case"focusin":G="focus",F=BC;break;case"focusout":G="blur",F=BC;break;case"beforeblur":case"afterblur":F=BC;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":F=iF;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":F=Pee;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":F=Uee;break;case T6:case E6:case A6:F=Oee;break;case P6:F=Gee;break;case"scroll":F=Eee;break;case"wheel":F=Wee;break;case"copy":case"cut":case"paste":F=Ree;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":F=sF}var j=(t&4)!==0,H=!j&&e==="scroll",X=j?R!==null?R+"Capture":null:R;j=[];for(var q=T,Z;q!==null;){Z=q;var J=Z.stateNode;if(Z.tag===5&&J!==null&&(Z=J,X!==null&&(J=wx(q,X),J!=null&&j.push(Ix(q,J,Z)))),H)break;q=q.return}0<j.length&&(R=new F(R,G,null,r,I),C.push({event:R,listeners:j}))}}if(!(t&7)){e:{if(R=e==="mouseover"||e==="pointerover",F=e==="mouseout"||e==="pointerout",R&&r!==dO&&(G=r.relatedTarget||r.fromElement)&&(wp(G)||G[Zu]))break e;if((F||R)&&(R=I.window===I?I:(R=I.ownerDocument)?R.defaultView||R.parentWindow:window,F?(G=r.relatedTarget||r.toElement,F=T,G=G?wp(G):null,G!==null&&(H=tm(G),G!==H||G.tag!==5&&G.tag!==6)&&(G=null)):(F=null,G=T),F!==G)){if(j=iF,J="onMouseLeave",X="onMouseEnter",q="mouse",(e==="pointerout"||e==="pointerover")&&(j=sF,J="onPointerLeave",X="onPointerEnter",q="pointer"),H=F==null?R:qg(F),Z=G==null?R:qg(G),R=new j(J,q+"leave",F,r,I),R.target=H,R.relatedTarget=Z,J=null,wp(I)===T&&(j=new j(X,q+"enter",G,r,I),j.target=Z,j.relatedTarget=H,J=j),H=J,F&&G)t:{for(j=F,X=G,q=0,Z=j;Z;Z=Og(Z))q++;for(Z=0,J=X;J;J=Og(J))Z++;for(;0<q-Z;)j=Og(j),q--;for(;0<Z-q;)X=Og(X),Z--;for(;q--;){if(j===X||X!==null&&j===X.alternate)break t;j=Og(j),X=Og(X)}j=null}else j=null;F!==null&&_F(C,R,F,j,!1),G!==null&&H!==null&&_F(C,H,G,j,!0)}}e:{if(R=T?qg(T):window,F=R.nodeName&&R.nodeName.toLowerCase(),F==="select"||F==="input"&&R.type==="file")var ne=Qee;else if(cF(R))if(v6)ne=nte;else{ne=tte;var he=ete}else(F=R.nodeName)&&F.toLowerCase()==="input"&&(R.type==="checkbox"||R.type==="radio")&&(ne=rte);if(ne&&(ne=ne(e,T))){y6(C,ne,r,I);break e}he&&he(e,R,T),e==="focusout"&&(he=R._wrapperState)&&he.controlled&&R.type==="number"&&aO(R,"number",R.value)}switch(he=T?qg(T):window,e){case"focusin":(cF(he)||he.contentEditable==="true")&&(Hg=he,vO=T,ex=null);break;case"focusout":ex=vO=Hg=null;break;case"mousedown":xO=!0;break;case"contextmenu":case"mouseup":case"dragend":xO=!1,pF(C,r,I);break;case"selectionchange":if(ste)break;case"keydown":case"keyup":pF(C,r,I)}var me;if(gk)e:{switch(e){case"compositionstart":var Se="onCompositionStart";break e;case"compositionend":Se="onCompositionEnd";break e;case"compositionupdate":Se="onCompositionUpdate";break e}Se=void 0}else Gg?g6(e,r)&&(Se="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(Se="onCompositionStart");Se&&(m6&&r.locale!=="ko"&&(Gg||Se!=="onCompositionStart"?Se==="onCompositionEnd"&&Gg&&(me=p6()):(xd=I,fk="value"in xd?xd.value:xd.textContent,Gg=!0)),he=mT(T,Se),0<he.length&&(Se=new oF(Se,e,null,r,I),C.push({event:Se,listeners:he}),me?Se.data=me:(me=_6(r),me!==null&&(Se.data=me)))),(me=Zee?Xee(e,r):Kee(e,r))&&(T=mT(T,"onBeforeInput"),0<T.length&&(I=new oF("onBeforeInput","beforeinput",null,r,I),C.push({event:I,listeners:T}),I.data=me))}I6(C,t)})}function Ix(e,t,r){return{instance:e,listener:t,currentTarget:r}}function mT(e,t){for(var r=t+"Capture",i=[];e!==null;){var c=e,d=c.stateNode;c.tag===5&&d!==null&&(c=d,d=wx(e,r),d!=null&&i.unshift(Ix(e,d,c)),d=wx(e,t),d!=null&&i.push(Ix(e,d,c))),e=e.return}return i}function Og(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function _F(e,t,r,i,c){for(var d=t._reactName,g=[];r!==null&&r!==i;){var o=r,w=o.alternate,T=o.stateNode;if(w!==null&&w===i)break;o.tag===5&&T!==null&&(o=T,c?(w=wx(r,d),w!=null&&g.unshift(Ix(r,w,o))):c||(w=wx(r,d),w!=null&&g.push(Ix(r,w,o)))),r=r.return}g.length!==0&&e.push({event:t,listeners:g})}var ute=/\r\n?/g,hte=/\u0000|\uFFFD/g;function yF(e){return(typeof e=="string"?e:""+e).replace(ute,`
`).replace(hte,"")}function cS(e,t,r){if(t=yF(t),yF(e)!==t&&r)throw Error(lr(425))}function gT(){}var bO=null,wO=null;function SO(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var TO=typeof setTimeout=="function"?setTimeout:void 0,dte=typeof clearTimeout=="function"?clearTimeout:void 0,vF=typeof Promise=="function"?Promise:void 0,fte=typeof queueMicrotask=="function"?queueMicrotask:typeof vF<"u"?function(e){return vF.resolve(null).then(e).catch(pte)}:TO;function pte(e){setTimeout(function(){throw e})}function ZC(e,t){var r=t,i=0;do{var c=r.nextSibling;if(e.removeChild(r),c&&c.nodeType===8)if(r=c.data,r==="/$"){if(i===0){e.removeChild(c),Ex(t);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=c}while(r);Ex(t)}function Pd(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function xF(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var uy=Math.random().toString(36).slice(2),Hc="__reactFiber$"+uy,Ox="__reactProps$"+uy,Zu="__reactContainer$"+uy,EO="__reactEvents$"+uy,mte="__reactListeners$"+uy,gte="__reactHandles$"+uy;function wp(e){var t=e[Hc];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Zu]||r[Hc]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=xF(e);e!==null;){if(r=e[Hc])return r;e=xF(e)}return t}e=r,r=e.parentNode}return null}function D1(e){return e=e[Hc]||e[Zu],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function qg(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(lr(33))}function XE(e){return e[Ox]||null}var AO=[],Zg=-1;function Gd(e){return{current:e}}function no(e){0>Zg||(e.current=AO[Zg],AO[Zg]=null,Zg--)}function Ki(e,t){Zg++,AO[Zg]=e.current,e.current=t}var zd={},Ns=Gd(zd),_a=Gd(!1),Fp=zd;function I_(e,t){var r=e.type.contextTypes;if(!r)return zd;var i=e.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===t)return i.__reactInternalMemoizedMaskedChildContext;var c={},d;for(d in r)c[d]=t[d];return i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=c),c}function ya(e){return e=e.childContextTypes,e!=null}function _T(){no(_a),no(Ns)}function bF(e,t,r){if(Ns.current!==zd)throw Error(lr(168));Ki(Ns,t),Ki(_a,r)}function M6(e,t,r){var i=e.stateNode;if(t=t.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var c in i)if(!(c in t))throw Error(lr(108,eee(e)||"Unknown",c));return fo({},r,i)}function yT(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||zd,Fp=Ns.current,Ki(Ns,e),Ki(_a,_a.current),!0}function wF(e,t,r){var i=e.stateNode;if(!i)throw Error(lr(169));r?(e=M6(e,t,Fp),i.__reactInternalMemoizedMergedChildContext=e,no(_a),no(Ns),Ki(Ns,e)):no(_a),Ki(_a,r)}var Nu=null,KE=!1,XC=!1;function R6(e){Nu===null?Nu=[e]:Nu.push(e)}function _te(e){KE=!0,R6(e)}function Hd(){if(!XC&&Nu!==null){XC=!0;var e=0,t=zi;try{var r=Nu;for(zi=1;e<r.length;e++){var i=r[e];do i=i(!0);while(i!==null)}Nu=null,KE=!1}catch(c){throw Nu!==null&&(Nu=Nu.slice(e+1)),n6(ck,Hd),c}finally{zi=t,XC=!1}}return null}var Xg=[],Kg=0,vT=null,xT=0,ll=[],cl=0,Bp=null,ju=1,Fu="";function pp(e,t){Xg[Kg++]=xT,Xg[Kg++]=vT,vT=e,xT=t}function k6(e,t,r){ll[cl++]=ju,ll[cl++]=Fu,ll[cl++]=Bp,Bp=e;var i=ju;e=Fu;var c=32-ic(i)-1;i&=~(1<<c),r+=1;var d=32-ic(t)+c;if(30<d){var g=c-c%5;d=(i&(1<<g)-1).toString(32),i>>=g,c-=g,ju=1<<32-ic(t)+c|r<<c|i,Fu=d+e}else ju=1<<d|r<<c|i,Fu=e}function yk(e){e.return!==null&&(pp(e,1),k6(e,1,0))}function vk(e){for(;e===vT;)vT=Xg[--Kg],Xg[Kg]=null,xT=Xg[--Kg],Xg[Kg]=null;for(;e===Bp;)Bp=ll[--cl],ll[cl]=null,Fu=ll[--cl],ll[cl]=null,ju=ll[--cl],ll[cl]=null}var $a=null,Ba=null,oo=!1,rc=null;function D6(e,t){var r=hl(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function SF(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,$a=e,Ba=Pd(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,$a=e,Ba=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Bp!==null?{id:ju,overflow:Fu}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=hl(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,$a=e,Ba=null,!0):!1;default:return!1}}function PO(e){return(e.mode&1)!==0&&(e.flags&128)===0}function CO(e){if(oo){var t=Ba;if(t){var r=t;if(!SF(e,t)){if(PO(e))throw Error(lr(418));t=Pd(r.nextSibling);var i=$a;t&&SF(e,t)?D6(i,r):(e.flags=e.flags&-4097|2,oo=!1,$a=e)}}else{if(PO(e))throw Error(lr(418));e.flags=e.flags&-4097|2,oo=!1,$a=e}}}function TF(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;$a=e}function uS(e){if(e!==$a)return!1;if(!oo)return TF(e),oo=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!SO(e.type,e.memoizedProps)),t&&(t=Ba)){if(PO(e))throw L6(),Error(lr(418));for(;t;)D6(e,t),t=Pd(t.nextSibling)}if(TF(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(lr(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Ba=Pd(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Ba=null}}else Ba=$a?Pd(e.stateNode.nextSibling):null;return!0}function L6(){for(var e=Ba;e;)e=Pd(e.nextSibling)}function O_(){Ba=$a=null,oo=!1}function xk(e){rc===null?rc=[e]:rc.push(e)}var yte=nh.ReactCurrentBatchConfig;function A0(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(lr(309));var i=r.stateNode}if(!i)throw Error(lr(147,e));var c=i,d=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===d?t.ref:(t=function(g){var o=c.refs;g===null?delete o[d]:o[d]=g},t._stringRef=d,t)}if(typeof e!="string")throw Error(lr(284));if(!r._owner)throw Error(lr(290,e))}return e}function hS(e,t){throw e=Object.prototype.toString.call(t),Error(lr(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function EF(e){var t=e._init;return t(e._payload)}function z6(e){function t(X,q){if(e){var Z=X.deletions;Z===null?(X.deletions=[q],X.flags|=16):Z.push(q)}}function r(X,q){if(!e)return null;for(;q!==null;)t(X,q),q=q.sibling;return null}function i(X,q){for(X=new Map;q!==null;)q.key!==null?X.set(q.key,q):X.set(q.index,q),q=q.sibling;return X}function c(X,q){return X=Md(X,q),X.index=0,X.sibling=null,X}function d(X,q,Z){return X.index=Z,e?(Z=X.alternate,Z!==null?(Z=Z.index,Z<q?(X.flags|=2,q):Z):(X.flags|=2,q)):(X.flags|=1048576,q)}function g(X){return e&&X.alternate===null&&(X.flags|=2),X}function o(X,q,Z,J){return q===null||q.tag!==6?(q=rI(Z,X.mode,J),q.return=X,q):(q=c(q,Z),q.return=X,q)}function w(X,q,Z,J){var ne=Z.type;return ne===Vg?I(X,q,Z.props.children,J,Z.key):q!==null&&(q.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===sd&&EF(ne)===q.type)?(J=c(q,Z.props),J.ref=A0(X,q,Z),J.return=X,J):(J=tT(Z.type,Z.key,Z.props,null,X.mode,J),J.ref=A0(X,q,Z),J.return=X,J)}function T(X,q,Z,J){return q===null||q.tag!==4||q.stateNode.containerInfo!==Z.containerInfo||q.stateNode.implementation!==Z.implementation?(q=nI(Z,X.mode,J),q.return=X,q):(q=c(q,Z.children||[]),q.return=X,q)}function I(X,q,Z,J,ne){return q===null||q.tag!==7?(q=Dp(Z,X.mode,J,ne),q.return=X,q):(q=c(q,Z),q.return=X,q)}function C(X,q,Z){if(typeof q=="string"&&q!==""||typeof q=="number")return q=rI(""+q,X.mode,Z),q.return=X,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case eS:return Z=tT(q.type,q.key,q.props,null,X.mode,Z),Z.ref=A0(X,null,q),Z.return=X,Z;case Ug:return q=nI(q,X.mode,Z),q.return=X,q;case sd:var J=q._init;return C(X,J(q._payload),Z)}if(V0(q)||b0(q))return q=Dp(q,X.mode,Z,null),q.return=X,q;hS(X,q)}return null}function R(X,q,Z,J){var ne=q!==null?q.key:null;if(typeof Z=="string"&&Z!==""||typeof Z=="number")return ne!==null?null:o(X,q,""+Z,J);if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case eS:return Z.key===ne?w(X,q,Z,J):null;case Ug:return Z.key===ne?T(X,q,Z,J):null;case sd:return ne=Z._init,R(X,q,ne(Z._payload),J)}if(V0(Z)||b0(Z))return ne!==null?null:I(X,q,Z,J,null);hS(X,Z)}return null}function F(X,q,Z,J,ne){if(typeof J=="string"&&J!==""||typeof J=="number")return X=X.get(Z)||null,o(q,X,""+J,ne);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case eS:return X=X.get(J.key===null?Z:J.key)||null,w(q,X,J,ne);case Ug:return X=X.get(J.key===null?Z:J.key)||null,T(q,X,J,ne);case sd:var he=J._init;return F(X,q,Z,he(J._payload),ne)}if(V0(J)||b0(J))return X=X.get(Z)||null,I(q,X,J,ne,null);hS(q,J)}return null}function G(X,q,Z,J){for(var ne=null,he=null,me=q,Se=q=0,qe=null;me!==null&&Se<Z.length;Se++){me.index>Se?(qe=me,me=null):qe=me.sibling;var Ze=R(X,me,Z[Se],J);if(Ze===null){me===null&&(me=qe);break}e&&me&&Ze.alternate===null&&t(X,me),q=d(Ze,q,Se),he===null?ne=Ze:he.sibling=Ze,he=Ze,me=qe}if(Se===Z.length)return r(X,me),oo&&pp(X,Se),ne;if(me===null){for(;Se<Z.length;Se++)me=C(X,Z[Se],J),me!==null&&(q=d(me,q,Se),he===null?ne=me:he.sibling=me,he=me);return oo&&pp(X,Se),ne}for(me=i(X,me);Se<Z.length;Se++)qe=F(me,X,Se,Z[Se],J),qe!==null&&(e&&qe.alternate!==null&&me.delete(qe.key===null?Se:qe.key),q=d(qe,q,Se),he===null?ne=qe:he.sibling=qe,he=qe);return e&&me.forEach(function(He){return t(X,He)}),oo&&pp(X,Se),ne}function j(X,q,Z,J){var ne=b0(Z);if(typeof ne!="function")throw Error(lr(150));if(Z=ne.call(Z),Z==null)throw Error(lr(151));for(var he=ne=null,me=q,Se=q=0,qe=null,Ze=Z.next();me!==null&&!Ze.done;Se++,Ze=Z.next()){me.index>Se?(qe=me,me=null):qe=me.sibling;var He=R(X,me,Ze.value,J);if(He===null){me===null&&(me=qe);break}e&&me&&He.alternate===null&&t(X,me),q=d(He,q,Se),he===null?ne=He:he.sibling=He,he=He,me=qe}if(Ze.done)return r(X,me),oo&&pp(X,Se),ne;if(me===null){for(;!Ze.done;Se++,Ze=Z.next())Ze=C(X,Ze.value,J),Ze!==null&&(q=d(Ze,q,Se),he===null?ne=Ze:he.sibling=Ze,he=Ze);return oo&&pp(X,Se),ne}for(me=i(X,me);!Ze.done;Se++,Ze=Z.next())Ze=F(me,X,Se,Ze.value,J),Ze!==null&&(e&&Ze.alternate!==null&&me.delete(Ze.key===null?Se:Ze.key),q=d(Ze,q,Se),he===null?ne=Ze:he.sibling=Ze,he=Ze);return e&&me.forEach(function(Ke){return t(X,Ke)}),oo&&pp(X,Se),ne}function H(X,q,Z,J){if(typeof Z=="object"&&Z!==null&&Z.type===Vg&&Z.key===null&&(Z=Z.props.children),typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case eS:e:{for(var ne=Z.key,he=q;he!==null;){if(he.key===ne){if(ne=Z.type,ne===Vg){if(he.tag===7){r(X,he.sibling),q=c(he,Z.props.children),q.return=X,X=q;break e}}else if(he.elementType===ne||typeof ne=="object"&&ne!==null&&ne.$$typeof===sd&&EF(ne)===he.type){r(X,he.sibling),q=c(he,Z.props),q.ref=A0(X,he,Z),q.return=X,X=q;break e}r(X,he);break}else t(X,he);he=he.sibling}Z.type===Vg?(q=Dp(Z.props.children,X.mode,J,Z.key),q.return=X,X=q):(J=tT(Z.type,Z.key,Z.props,null,X.mode,J),J.ref=A0(X,q,Z),J.return=X,X=J)}return g(X);case Ug:e:{for(he=Z.key;q!==null;){if(q.key===he)if(q.tag===4&&q.stateNode.containerInfo===Z.containerInfo&&q.stateNode.implementation===Z.implementation){r(X,q.sibling),q=c(q,Z.children||[]),q.return=X,X=q;break e}else{r(X,q);break}else t(X,q);q=q.sibling}q=nI(Z,X.mode,J),q.return=X,X=q}return g(X);case sd:return he=Z._init,H(X,q,he(Z._payload),J)}if(V0(Z))return G(X,q,Z,J);if(b0(Z))return j(X,q,Z,J);hS(X,Z)}return typeof Z=="string"&&Z!==""||typeof Z=="number"?(Z=""+Z,q!==null&&q.tag===6?(r(X,q.sibling),q=c(q,Z),q.return=X,X=q):(r(X,q),q=rI(Z,X.mode,J),q.return=X,X=q),g(X)):r(X,q)}return H}var M_=z6(!0),N6=z6(!1),bT=Gd(null),wT=null,Yg=null,bk=null;function wk(){bk=Yg=wT=null}function Sk(e){var t=bT.current;no(bT),e._currentValue=t}function IO(e,t,r){for(;e!==null;){var i=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,i!==null&&(i.childLanes|=t)):i!==null&&(i.childLanes&t)!==t&&(i.childLanes|=t),e===r)break;e=e.return}}function l_(e,t){wT=e,bk=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(ma=!0),e.firstContext=null)}function gl(e){var t=e._currentValue;if(bk!==e)if(e={context:e,memoizedValue:t,next:null},Yg===null){if(wT===null)throw Error(lr(308));Yg=e,wT.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return t}var Sp=null;function Tk(e){Sp===null?Sp=[e]:Sp.push(e)}function j6(e,t,r,i){var c=t.interleaved;return c===null?(r.next=r,Tk(t)):(r.next=c.next,c.next=r),t.interleaved=r,Xu(e,i)}function Xu(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ad=!1;function Ek(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function F6(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Vu(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Cd(e,t,r){var i=e.updateQueue;if(i===null)return null;if(i=i.shared,yi&2){var c=i.pending;return c===null?t.next=t:(t.next=c.next,c.next=t),i.pending=t,Xu(e,r)}return c=i.interleaved,c===null?(t.next=t,Tk(i)):(t.next=c.next,c.next=t),i.interleaved=t,Xu(e,r)}function XS(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,uk(e,r)}}function AF(e,t){var r=e.updateQueue,i=e.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var c=null,d=null;if(r=r.firstBaseUpdate,r!==null){do{var g={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};d===null?c=d=g:d=d.next=g,r=r.next}while(r!==null);d===null?c=d=t:d=d.next=t}else c=d=t;r={baseState:i.baseState,firstBaseUpdate:c,lastBaseUpdate:d,shared:i.shared,effects:i.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function ST(e,t,r,i){var c=e.updateQueue;ad=!1;var d=c.firstBaseUpdate,g=c.lastBaseUpdate,o=c.shared.pending;if(o!==null){c.shared.pending=null;var w=o,T=w.next;w.next=null,g===null?d=T:g.next=T,g=w;var I=e.alternate;I!==null&&(I=I.updateQueue,o=I.lastBaseUpdate,o!==g&&(o===null?I.firstBaseUpdate=T:o.next=T,I.lastBaseUpdate=w))}if(d!==null){var C=c.baseState;g=0,I=T=w=null,o=d;do{var R=o.lane,F=o.eventTime;if((i&R)===R){I!==null&&(I=I.next={eventTime:F,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var G=e,j=o;switch(R=t,F=r,j.tag){case 1:if(G=j.payload,typeof G=="function"){C=G.call(F,C,R);break e}C=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=j.payload,R=typeof G=="function"?G.call(F,C,R):G,R==null)break e;C=fo({},C,R);break e;case 2:ad=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,R=c.effects,R===null?c.effects=[o]:R.push(o))}else F={eventTime:F,lane:R,tag:o.tag,payload:o.payload,callback:o.callback,next:null},I===null?(T=I=F,w=C):I=I.next=F,g|=R;if(o=o.next,o===null){if(o=c.shared.pending,o===null)break;R=o,o=R.next,R.next=null,c.lastBaseUpdate=R,c.shared.pending=null}}while(!0);if(I===null&&(w=C),c.baseState=w,c.firstBaseUpdate=T,c.lastBaseUpdate=I,t=c.shared.interleaved,t!==null){c=t;do g|=c.lane,c=c.next;while(c!==t)}else d===null&&(c.shared.lanes=0);Up|=g,e.lanes=g,e.memoizedState=C}}function PF(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var i=e[t],c=i.callback;if(c!==null){if(i.callback=null,i=r,typeof c!="function")throw Error(lr(191,c));c.call(i)}}}var L1={},Xc=Gd(L1),Mx=Gd(L1),Rx=Gd(L1);function Tp(e){if(e===L1)throw Error(lr(174));return e}function Ak(e,t){switch(Ki(Rx,t),Ki(Mx,e),Ki(Xc,L1),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:cO(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=cO(t,e)}no(Xc),Ki(Xc,t)}function R_(){no(Xc),no(Mx),no(Rx)}function B6(e){Tp(Rx.current);var t=Tp(Xc.current),r=cO(t,e.type);t!==r&&(Ki(Mx,e),Ki(Xc,r))}function Pk(e){Mx.current===e&&(no(Xc),no(Mx))}var uo=Gd(0);function TT(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var KC=[];function Ck(){for(var e=0;e<KC.length;e++)KC[e]._workInProgressVersionPrimary=null;KC.length=0}var KS=nh.ReactCurrentDispatcher,YC=nh.ReactCurrentBatchConfig,$p=0,ho=null,Vo=null,is=null,ET=!1,tx=!1,kx=0,vte=0;function Cs(){throw Error(lr(321))}function Ik(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!lc(e[r],t[r]))return!1;return!0}function Ok(e,t,r,i,c,d){if($p=d,ho=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,KS.current=e===null||e.memoizedState===null?Ste:Tte,e=r(i,c),tx){d=0;do{if(tx=!1,kx=0,25<=d)throw Error(lr(301));d+=1,is=Vo=null,t.updateQueue=null,KS.current=Ete,e=r(i,c)}while(tx)}if(KS.current=AT,t=Vo!==null&&Vo.next!==null,$p=0,is=Vo=ho=null,ET=!1,t)throw Error(lr(300));return e}function Mk(){var e=kx!==0;return kx=0,e}function $c(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return is===null?ho.memoizedState=is=e:is=is.next=e,is}function _l(){if(Vo===null){var e=ho.alternate;e=e!==null?e.memoizedState:null}else e=Vo.next;var t=is===null?ho.memoizedState:is.next;if(t!==null)is=t,Vo=e;else{if(e===null)throw Error(lr(310));Vo=e,e={memoizedState:Vo.memoizedState,baseState:Vo.baseState,baseQueue:Vo.baseQueue,queue:Vo.queue,next:null},is===null?ho.memoizedState=is=e:is=is.next=e}return is}function Dx(e,t){return typeof t=="function"?t(e):t}function JC(e){var t=_l(),r=t.queue;if(r===null)throw Error(lr(311));r.lastRenderedReducer=e;var i=Vo,c=i.baseQueue,d=r.pending;if(d!==null){if(c!==null){var g=c.next;c.next=d.next,d.next=g}i.baseQueue=c=d,r.pending=null}if(c!==null){d=c.next,i=i.baseState;var o=g=null,w=null,T=d;do{var I=T.lane;if(($p&I)===I)w!==null&&(w=w.next={lane:0,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null}),i=T.hasEagerState?T.eagerState:e(i,T.action);else{var C={lane:I,action:T.action,hasEagerState:T.hasEagerState,eagerState:T.eagerState,next:null};w===null?(o=w=C,g=i):w=w.next=C,ho.lanes|=I,Up|=I}T=T.next}while(T!==null&&T!==d);w===null?g=i:w.next=o,lc(i,t.memoizedState)||(ma=!0),t.memoizedState=i,t.baseState=g,t.baseQueue=w,r.lastRenderedState=i}if(e=r.interleaved,e!==null){c=e;do d=c.lane,ho.lanes|=d,Up|=d,c=c.next;while(c!==e)}else c===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function QC(e){var t=_l(),r=t.queue;if(r===null)throw Error(lr(311));r.lastRenderedReducer=e;var i=r.dispatch,c=r.pending,d=t.memoizedState;if(c!==null){r.pending=null;var g=c=c.next;do d=e(d,g.action),g=g.next;while(g!==c);lc(d,t.memoizedState)||(ma=!0),t.memoizedState=d,t.baseQueue===null&&(t.baseState=d),r.lastRenderedState=d}return[d,i]}function $6(){}function U6(e,t){var r=ho,i=_l(),c=t(),d=!lc(i.memoizedState,c);if(d&&(i.memoizedState=c,ma=!0),i=i.queue,Rk(H6.bind(null,r,i,e),[e]),i.getSnapshot!==t||d||is!==null&&is.memoizedState.tag&1){if(r.flags|=2048,Lx(9,G6.bind(null,r,i,c,t),void 0,null),ss===null)throw Error(lr(349));$p&30||V6(r,t,c)}return c}function V6(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=ho.updateQueue,t===null?(t={lastEffect:null,stores:null},ho.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function G6(e,t,r,i){t.value=r,t.getSnapshot=i,W6(t)&&q6(e)}function H6(e,t,r){return r(function(){W6(t)&&q6(e)})}function W6(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!lc(e,r)}catch{return!0}}function q6(e){var t=Xu(e,1);t!==null&&oc(t,e,1,-1)}function CF(e){var t=$c();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Dx,lastRenderedState:e},t.queue=e,e=e.dispatch=wte.bind(null,ho,e),[t.memoizedState,e]}function Lx(e,t,r,i){return e={tag:e,create:t,destroy:r,deps:i,next:null},t=ho.updateQueue,t===null?(t={lastEffect:null,stores:null},ho.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(i=r.next,r.next=e,e.next=i,t.lastEffect=e)),e}function Z6(){return _l().memoizedState}function YS(e,t,r,i){var c=$c();ho.flags|=e,c.memoizedState=Lx(1|t,r,void 0,i===void 0?null:i)}function YE(e,t,r,i){var c=_l();i=i===void 0?null:i;var d=void 0;if(Vo!==null){var g=Vo.memoizedState;if(d=g.destroy,i!==null&&Ik(i,g.deps)){c.memoizedState=Lx(t,r,d,i);return}}ho.flags|=e,c.memoizedState=Lx(1|t,r,d,i)}function IF(e,t){return YS(8390656,8,e,t)}function Rk(e,t){return YE(2048,8,e,t)}function X6(e,t){return YE(4,2,e,t)}function K6(e,t){return YE(4,4,e,t)}function Y6(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function J6(e,t,r){return r=r!=null?r.concat([e]):null,YE(4,4,Y6.bind(null,t,e),r)}function kk(){}function Q6(e,t){var r=_l();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&Ik(t,i[1])?i[0]:(r.memoizedState=[e,t],e)}function e8(e,t){var r=_l();t=t===void 0?null:t;var i=r.memoizedState;return i!==null&&t!==null&&Ik(t,i[1])?i[0]:(e=e(),r.memoizedState=[e,t],e)}function t8(e,t,r){return $p&21?(lc(r,t)||(r=s6(),ho.lanes|=r,Up|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,ma=!0),e.memoizedState=r)}function xte(e,t){var r=zi;zi=r!==0&&4>r?r:4,e(!0);var i=YC.transition;YC.transition={};try{e(!1),t()}finally{zi=r,YC.transition=i}}function r8(){return _l().memoizedState}function bte(e,t,r){var i=Od(e);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},n8(e))i8(t,r);else if(r=j6(e,t,r,i),r!==null){var c=ea();oc(r,e,i,c),o8(r,t,i)}}function wte(e,t,r){var i=Od(e),c={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(n8(e))i8(t,c);else{var d=e.alternate;if(e.lanes===0&&(d===null||d.lanes===0)&&(d=t.lastRenderedReducer,d!==null))try{var g=t.lastRenderedState,o=d(g,r);if(c.hasEagerState=!0,c.eagerState=o,lc(o,g)){var w=t.interleaved;w===null?(c.next=c,Tk(t)):(c.next=w.next,w.next=c),t.interleaved=c;return}}catch{}finally{}r=j6(e,t,c,i),r!==null&&(c=ea(),oc(r,e,i,c),o8(r,t,i))}}function n8(e){var t=e.alternate;return e===ho||t!==null&&t===ho}function i8(e,t){tx=ET=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function o8(e,t,r){if(r&4194240){var i=t.lanes;i&=e.pendingLanes,r|=i,t.lanes=r,uk(e,r)}}var AT={readContext:gl,useCallback:Cs,useContext:Cs,useEffect:Cs,useImperativeHandle:Cs,useInsertionEffect:Cs,useLayoutEffect:Cs,useMemo:Cs,useReducer:Cs,useRef:Cs,useState:Cs,useDebugValue:Cs,useDeferredValue:Cs,useTransition:Cs,useMutableSource:Cs,useSyncExternalStore:Cs,useId:Cs,unstable_isNewReconciler:!1},Ste={readContext:gl,useCallback:function(e,t){return $c().memoizedState=[e,t===void 0?null:t],e},useContext:gl,useEffect:IF,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,YS(4194308,4,Y6.bind(null,t,e),r)},useLayoutEffect:function(e,t){return YS(4194308,4,e,t)},useInsertionEffect:function(e,t){return YS(4,2,e,t)},useMemo:function(e,t){var r=$c();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var i=$c();return t=r!==void 0?r(t):t,i.memoizedState=i.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},i.queue=e,e=e.dispatch=bte.bind(null,ho,e),[i.memoizedState,e]},useRef:function(e){var t=$c();return e={current:e},t.memoizedState=e},useState:CF,useDebugValue:kk,useDeferredValue:function(e){return $c().memoizedState=e},useTransition:function(){var e=CF(!1),t=e[0];return e=xte.bind(null,e[1]),$c().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var i=ho,c=$c();if(oo){if(r===void 0)throw Error(lr(407));r=r()}else{if(r=t(),ss===null)throw Error(lr(349));$p&30||V6(i,t,r)}c.memoizedState=r;var d={value:r,getSnapshot:t};return c.queue=d,IF(H6.bind(null,i,d,e),[e]),i.flags|=2048,Lx(9,G6.bind(null,i,d,r,t),void 0,null),r},useId:function(){var e=$c(),t=ss.identifierPrefix;if(oo){var r=Fu,i=ju;r=(i&~(1<<32-ic(i)-1)).toString(32)+r,t=":"+t+"R"+r,r=kx++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=vte++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Tte={readContext:gl,useCallback:Q6,useContext:gl,useEffect:Rk,useImperativeHandle:J6,useInsertionEffect:X6,useLayoutEffect:K6,useMemo:e8,useReducer:JC,useRef:Z6,useState:function(){return JC(Dx)},useDebugValue:kk,useDeferredValue:function(e){var t=_l();return t8(t,Vo.memoizedState,e)},useTransition:function(){var e=JC(Dx)[0],t=_l().memoizedState;return[e,t]},useMutableSource:$6,useSyncExternalStore:U6,useId:r8,unstable_isNewReconciler:!1},Ete={readContext:gl,useCallback:Q6,useContext:gl,useEffect:Rk,useImperativeHandle:J6,useInsertionEffect:X6,useLayoutEffect:K6,useMemo:e8,useReducer:QC,useRef:Z6,useState:function(){return QC(Dx)},useDebugValue:kk,useDeferredValue:function(e){var t=_l();return Vo===null?t.memoizedState=e:t8(t,Vo.memoizedState,e)},useTransition:function(){var e=QC(Dx)[0],t=_l().memoizedState;return[e,t]},useMutableSource:$6,useSyncExternalStore:U6,useId:r8,unstable_isNewReconciler:!1};function Xl(e,t){if(e&&e.defaultProps){t=fo({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function OO(e,t,r,i){t=e.memoizedState,r=r(i,t),r=r==null?t:fo({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var JE={isMounted:function(e){return(e=e._reactInternals)?tm(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var i=ea(),c=Od(e),d=Vu(i,c);d.payload=t,r!=null&&(d.callback=r),t=Cd(e,d,c),t!==null&&(oc(t,e,c,i),XS(t,e,c))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var i=ea(),c=Od(e),d=Vu(i,c);d.tag=1,d.payload=t,r!=null&&(d.callback=r),t=Cd(e,d,c),t!==null&&(oc(t,e,c,i),XS(t,e,c))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=ea(),i=Od(e),c=Vu(r,i);c.tag=2,t!=null&&(c.callback=t),t=Cd(e,c,i),t!==null&&(oc(t,e,i,r),XS(t,e,i))}};function OF(e,t,r,i,c,d,g){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(i,d,g):t.prototype&&t.prototype.isPureReactComponent?!Px(r,i)||!Px(c,d):!0}function s8(e,t,r){var i=!1,c=zd,d=t.contextType;return typeof d=="object"&&d!==null?d=gl(d):(c=ya(t)?Fp:Ns.current,i=t.contextTypes,d=(i=i!=null)?I_(e,c):zd),t=new t(r,d),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=JE,e.stateNode=t,t._reactInternals=e,i&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=c,e.__reactInternalMemoizedMaskedChildContext=d),t}function MF(e,t,r,i){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,i),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,i),t.state!==e&&JE.enqueueReplaceState(t,t.state,null)}function MO(e,t,r,i){var c=e.stateNode;c.props=r,c.state=e.memoizedState,c.refs={},Ek(e);var d=t.contextType;typeof d=="object"&&d!==null?c.context=gl(d):(d=ya(t)?Fp:Ns.current,c.context=I_(e,d)),c.state=e.memoizedState,d=t.getDerivedStateFromProps,typeof d=="function"&&(OO(e,t,d,r),c.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof c.getSnapshotBeforeUpdate=="function"||typeof c.UNSAFE_componentWillMount!="function"&&typeof c.componentWillMount!="function"||(t=c.state,typeof c.componentWillMount=="function"&&c.componentWillMount(),typeof c.UNSAFE_componentWillMount=="function"&&c.UNSAFE_componentWillMount(),t!==c.state&&JE.enqueueReplaceState(c,c.state,null),ST(e,r,c,i),c.state=e.memoizedState),typeof c.componentDidMount=="function"&&(e.flags|=4194308)}function k_(e,t){try{var r="",i=t;do r+=QQ(i),i=i.return;while(i);var c=r}catch(d){c=`
Error generating stack: `+d.message+`
`+d.stack}return{value:e,source:t,stack:c,digest:null}}function eI(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function RO(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var Ate=typeof WeakMap=="function"?WeakMap:Map;function a8(e,t,r){r=Vu(-1,r),r.tag=3,r.payload={element:null};var i=t.value;return r.callback=function(){CT||(CT=!0,UO=i),RO(e,t)},r}function l8(e,t,r){r=Vu(-1,r),r.tag=3;var i=e.type.getDerivedStateFromError;if(typeof i=="function"){var c=t.value;r.payload=function(){return i(c)},r.callback=function(){RO(e,t)}}var d=e.stateNode;return d!==null&&typeof d.componentDidCatch=="function"&&(r.callback=function(){RO(e,t),typeof i!="function"&&(Id===null?Id=new Set([this]):Id.add(this));var g=t.stack;this.componentDidCatch(t.value,{componentStack:g!==null?g:""})}),r}function RF(e,t,r){var i=e.pingCache;if(i===null){i=e.pingCache=new Ate;var c=new Set;i.set(t,c)}else c=i.get(t),c===void 0&&(c=new Set,i.set(t,c));c.has(r)||(c.add(r),e=Bte.bind(null,e,t,r),t.then(e,e))}function kF(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function DF(e,t,r,i,c){return e.mode&1?(e.flags|=65536,e.lanes=c,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Vu(-1,1),t.tag=2,Cd(r,t,1))),r.lanes|=1),e)}var Pte=nh.ReactCurrentOwner,ma=!1;function Zs(e,t,r,i){t.child=e===null?N6(t,null,r,i):M_(t,e.child,r,i)}function LF(e,t,r,i,c){r=r.render;var d=t.ref;return l_(t,c),i=Ok(e,t,r,i,d,c),r=Mk(),e!==null&&!ma?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Ku(e,t,c)):(oo&&r&&yk(t),t.flags|=1,Zs(e,t,i,c),t.child)}function zF(e,t,r,i,c){if(e===null){var d=r.type;return typeof d=="function"&&!$k(d)&&d.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=d,c8(e,t,d,i,c)):(e=tT(r.type,null,i,t,t.mode,c),e.ref=t.ref,e.return=t,t.child=e)}if(d=e.child,!(e.lanes&c)){var g=d.memoizedProps;if(r=r.compare,r=r!==null?r:Px,r(g,i)&&e.ref===t.ref)return Ku(e,t,c)}return t.flags|=1,e=Md(d,i),e.ref=t.ref,e.return=t,t.child=e}function c8(e,t,r,i,c){if(e!==null){var d=e.memoizedProps;if(Px(d,i)&&e.ref===t.ref)if(ma=!1,t.pendingProps=i=d,(e.lanes&c)!==0)e.flags&131072&&(ma=!0);else return t.lanes=e.lanes,Ku(e,t,c)}return kO(e,t,r,i,c)}function u8(e,t,r){var i=t.pendingProps,c=i.children,d=e!==null?e.memoizedState:null;if(i.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ki(Qg,La),La|=r;else{if(!(r&1073741824))return e=d!==null?d.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ki(Qg,La),La|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=d!==null?d.baseLanes:r,Ki(Qg,La),La|=i}else d!==null?(i=d.baseLanes|r,t.memoizedState=null):i=r,Ki(Qg,La),La|=i;return Zs(e,t,c,r),t.child}function h8(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function kO(e,t,r,i,c){var d=ya(r)?Fp:Ns.current;return d=I_(t,d),l_(t,c),r=Ok(e,t,r,i,d,c),i=Mk(),e!==null&&!ma?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~c,Ku(e,t,c)):(oo&&i&&yk(t),t.flags|=1,Zs(e,t,r,c),t.child)}function NF(e,t,r,i,c){if(ya(r)){var d=!0;yT(t)}else d=!1;if(l_(t,c),t.stateNode===null)JS(e,t),s8(t,r,i),MO(t,r,i,c),i=!0;else if(e===null){var g=t.stateNode,o=t.memoizedProps;g.props=o;var w=g.context,T=r.contextType;typeof T=="object"&&T!==null?T=gl(T):(T=ya(r)?Fp:Ns.current,T=I_(t,T));var I=r.getDerivedStateFromProps,C=typeof I=="function"||typeof g.getSnapshotBeforeUpdate=="function";C||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(o!==i||w!==T)&&MF(t,g,i,T),ad=!1;var R=t.memoizedState;g.state=R,ST(t,i,g,c),w=t.memoizedState,o!==i||R!==w||_a.current||ad?(typeof I=="function"&&(OO(t,r,I,i),w=t.memoizedState),(o=ad||OF(t,r,o,i,R,w,T))?(C||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount()),typeof g.componentDidMount=="function"&&(t.flags|=4194308)):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=i,t.memoizedState=w),g.props=i,g.state=w,g.context=T,i=o):(typeof g.componentDidMount=="function"&&(t.flags|=4194308),i=!1)}else{g=t.stateNode,F6(e,t),o=t.memoizedProps,T=t.type===t.elementType?o:Xl(t.type,o),g.props=T,C=t.pendingProps,R=g.context,w=r.contextType,typeof w=="object"&&w!==null?w=gl(w):(w=ya(r)?Fp:Ns.current,w=I_(t,w));var F=r.getDerivedStateFromProps;(I=typeof F=="function"||typeof g.getSnapshotBeforeUpdate=="function")||typeof g.UNSAFE_componentWillReceiveProps!="function"&&typeof g.componentWillReceiveProps!="function"||(o!==C||R!==w)&&MF(t,g,i,w),ad=!1,R=t.memoizedState,g.state=R,ST(t,i,g,c);var G=t.memoizedState;o!==C||R!==G||_a.current||ad?(typeof F=="function"&&(OO(t,r,F,i),G=t.memoizedState),(T=ad||OF(t,r,T,i,R,G,w)||!1)?(I||typeof g.UNSAFE_componentWillUpdate!="function"&&typeof g.componentWillUpdate!="function"||(typeof g.componentWillUpdate=="function"&&g.componentWillUpdate(i,G,w),typeof g.UNSAFE_componentWillUpdate=="function"&&g.UNSAFE_componentWillUpdate(i,G,w)),typeof g.componentDidUpdate=="function"&&(t.flags|=4),typeof g.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof g.componentDidUpdate!="function"||o===e.memoizedProps&&R===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&R===e.memoizedState||(t.flags|=1024),t.memoizedProps=i,t.memoizedState=G),g.props=i,g.state=G,g.context=w,i=T):(typeof g.componentDidUpdate!="function"||o===e.memoizedProps&&R===e.memoizedState||(t.flags|=4),typeof g.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&R===e.memoizedState||(t.flags|=1024),i=!1)}return DO(e,t,r,i,d,c)}function DO(e,t,r,i,c,d){h8(e,t);var g=(t.flags&128)!==0;if(!i&&!g)return c&&wF(t,r,!1),Ku(e,t,d);i=t.stateNode,Pte.current=t;var o=g&&typeof r.getDerivedStateFromError!="function"?null:i.render();return t.flags|=1,e!==null&&g?(t.child=M_(t,e.child,null,d),t.child=M_(t,null,o,d)):Zs(e,t,o,d),t.memoizedState=i.state,c&&wF(t,r,!0),t.child}function d8(e){var t=e.stateNode;t.pendingContext?bF(e,t.pendingContext,t.pendingContext!==t.context):t.context&&bF(e,t.context,!1),Ak(e,t.containerInfo)}function jF(e,t,r,i,c){return O_(),xk(c),t.flags|=256,Zs(e,t,r,i),t.child}var LO={dehydrated:null,treeContext:null,retryLane:0};function zO(e){return{baseLanes:e,cachePool:null,transitions:null}}function f8(e,t,r){var i=t.pendingProps,c=uo.current,d=!1,g=(t.flags&128)!==0,o;if((o=g)||(o=e!==null&&e.memoizedState===null?!1:(c&2)!==0),o?(d=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(c|=1),Ki(uo,c&1),e===null)return CO(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(g=i.children,e=i.fallback,d?(i=t.mode,d=t.child,g={mode:"hidden",children:g},!(i&1)&&d!==null?(d.childLanes=0,d.pendingProps=g):d=t2(g,i,0,null),e=Dp(e,i,r,null),d.return=t,e.return=t,d.sibling=e,t.child=d,t.child.memoizedState=zO(r),t.memoizedState=LO,e):Dk(t,g));if(c=e.memoizedState,c!==null&&(o=c.dehydrated,o!==null))return Cte(e,t,g,i,o,c,r);if(d){d=i.fallback,g=t.mode,c=e.child,o=c.sibling;var w={mode:"hidden",children:i.children};return!(g&1)&&t.child!==c?(i=t.child,i.childLanes=0,i.pendingProps=w,t.deletions=null):(i=Md(c,w),i.subtreeFlags=c.subtreeFlags&14680064),o!==null?d=Md(o,d):(d=Dp(d,g,r,null),d.flags|=2),d.return=t,i.return=t,i.sibling=d,t.child=i,i=d,d=t.child,g=e.child.memoizedState,g=g===null?zO(r):{baseLanes:g.baseLanes|r,cachePool:null,transitions:g.transitions},d.memoizedState=g,d.childLanes=e.childLanes&~r,t.memoizedState=LO,i}return d=e.child,e=d.sibling,i=Md(d,{mode:"visible",children:i.children}),!(t.mode&1)&&(i.lanes=r),i.return=t,i.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function Dk(e,t){return t=t2({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function dS(e,t,r,i){return i!==null&&xk(i),M_(t,e.child,null,r),e=Dk(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function Cte(e,t,r,i,c,d,g){if(r)return t.flags&256?(t.flags&=-257,i=eI(Error(lr(422))),dS(e,t,g,i)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(d=i.fallback,c=t.mode,i=t2({mode:"visible",children:i.children},c,0,null),d=Dp(d,c,g,null),d.flags|=2,i.return=t,d.return=t,i.sibling=d,t.child=i,t.mode&1&&M_(t,e.child,null,g),t.child.memoizedState=zO(g),t.memoizedState=LO,d);if(!(t.mode&1))return dS(e,t,g,null);if(c.data==="$!"){if(i=c.nextSibling&&c.nextSibling.dataset,i)var o=i.dgst;return i=o,d=Error(lr(419)),i=eI(d,i,void 0),dS(e,t,g,i)}if(o=(g&e.childLanes)!==0,ma||o){if(i=ss,i!==null){switch(g&-g){case 4:c=2;break;case 16:c=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:c=32;break;case 536870912:c=268435456;break;default:c=0}c=c&(i.suspendedLanes|g)?0:c,c!==0&&c!==d.retryLane&&(d.retryLane=c,Xu(e,c),oc(i,e,c,-1))}return Bk(),i=eI(Error(lr(421))),dS(e,t,g,i)}return c.data==="$?"?(t.flags|=128,t.child=e.child,t=$te.bind(null,e),c._reactRetry=t,null):(e=d.treeContext,Ba=Pd(c.nextSibling),$a=t,oo=!0,rc=null,e!==null&&(ll[cl++]=ju,ll[cl++]=Fu,ll[cl++]=Bp,ju=e.id,Fu=e.overflow,Bp=t),t=Dk(t,i.children),t.flags|=4096,t)}function FF(e,t,r){e.lanes|=t;var i=e.alternate;i!==null&&(i.lanes|=t),IO(e.return,t,r)}function tI(e,t,r,i,c){var d=e.memoizedState;d===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:c}:(d.isBackwards=t,d.rendering=null,d.renderingStartTime=0,d.last=i,d.tail=r,d.tailMode=c)}function p8(e,t,r){var i=t.pendingProps,c=i.revealOrder,d=i.tail;if(Zs(e,t,i.children,r),i=uo.current,i&2)i=i&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&FF(e,r,t);else if(e.tag===19)FF(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}i&=1}if(Ki(uo,i),!(t.mode&1))t.memoizedState=null;else switch(c){case"forwards":for(r=t.child,c=null;r!==null;)e=r.alternate,e!==null&&TT(e)===null&&(c=r),r=r.sibling;r=c,r===null?(c=t.child,t.child=null):(c=r.sibling,r.sibling=null),tI(t,!1,c,r,d);break;case"backwards":for(r=null,c=t.child,t.child=null;c!==null;){if(e=c.alternate,e!==null&&TT(e)===null){t.child=c;break}e=c.sibling,c.sibling=r,r=c,c=e}tI(t,!0,r,null,d);break;case"together":tI(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function JS(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Ku(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Up|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(lr(153));if(t.child!==null){for(e=t.child,r=Md(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Md(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function Ite(e,t,r){switch(t.tag){case 3:d8(t),O_();break;case 5:B6(t);break;case 1:ya(t.type)&&yT(t);break;case 4:Ak(t,t.stateNode.containerInfo);break;case 10:var i=t.type._context,c=t.memoizedProps.value;Ki(bT,i._currentValue),i._currentValue=c;break;case 13:if(i=t.memoizedState,i!==null)return i.dehydrated!==null?(Ki(uo,uo.current&1),t.flags|=128,null):r&t.child.childLanes?f8(e,t,r):(Ki(uo,uo.current&1),e=Ku(e,t,r),e!==null?e.sibling:null);Ki(uo,uo.current&1);break;case 19:if(i=(r&t.childLanes)!==0,e.flags&128){if(i)return p8(e,t,r);t.flags|=128}if(c=t.memoizedState,c!==null&&(c.rendering=null,c.tail=null,c.lastEffect=null),Ki(uo,uo.current),i)break;return null;case 22:case 23:return t.lanes=0,u8(e,t,r)}return Ku(e,t,r)}var m8,NO,g8,_8;m8=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};NO=function(){};g8=function(e,t,r,i){var c=e.memoizedProps;if(c!==i){e=t.stateNode,Tp(Xc.current);var d=null;switch(r){case"input":c=oO(e,c),i=oO(e,i),d=[];break;case"select":c=fo({},c,{value:void 0}),i=fo({},i,{value:void 0}),d=[];break;case"textarea":c=lO(e,c),i=lO(e,i),d=[];break;default:typeof c.onClick!="function"&&typeof i.onClick=="function"&&(e.onclick=gT)}uO(r,i);var g;r=null;for(T in c)if(!i.hasOwnProperty(T)&&c.hasOwnProperty(T)&&c[T]!=null)if(T==="style"){var o=c[T];for(g in o)o.hasOwnProperty(g)&&(r||(r={}),r[g]="")}else T!=="dangerouslySetInnerHTML"&&T!=="children"&&T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&T!=="autoFocus"&&(xx.hasOwnProperty(T)?d||(d=[]):(d=d||[]).push(T,null));for(T in i){var w=i[T];if(o=c!=null?c[T]:void 0,i.hasOwnProperty(T)&&w!==o&&(w!=null||o!=null))if(T==="style")if(o){for(g in o)!o.hasOwnProperty(g)||w&&w.hasOwnProperty(g)||(r||(r={}),r[g]="");for(g in w)w.hasOwnProperty(g)&&o[g]!==w[g]&&(r||(r={}),r[g]=w[g])}else r||(d||(d=[]),d.push(T,r)),r=w;else T==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,o=o?o.__html:void 0,w!=null&&o!==w&&(d=d||[]).push(T,w)):T==="children"?typeof w!="string"&&typeof w!="number"||(d=d||[]).push(T,""+w):T!=="suppressContentEditableWarning"&&T!=="suppressHydrationWarning"&&(xx.hasOwnProperty(T)?(w!=null&&T==="onScroll"&&eo("scroll",e),d||o===w||(d=[])):(d=d||[]).push(T,w))}r&&(d=d||[]).push("style",r);var T=d;(t.updateQueue=T)&&(t.flags|=4)}};_8=function(e,t,r,i){r!==i&&(t.flags|=4)};function P0(e,t){if(!oo)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:i.sibling=null}}function Is(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,i=0;if(t)for(var c=e.child;c!==null;)r|=c.lanes|c.childLanes,i|=c.subtreeFlags&14680064,i|=c.flags&14680064,c.return=e,c=c.sibling;else for(c=e.child;c!==null;)r|=c.lanes|c.childLanes,i|=c.subtreeFlags,i|=c.flags,c.return=e,c=c.sibling;return e.subtreeFlags|=i,e.childLanes=r,t}function Ote(e,t,r){var i=t.pendingProps;switch(vk(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Is(t),null;case 1:return ya(t.type)&&_T(),Is(t),null;case 3:return i=t.stateNode,R_(),no(_a),no(Ns),Ck(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(e===null||e.child===null)&&(uS(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,rc!==null&&(HO(rc),rc=null))),NO(e,t),Is(t),null;case 5:Pk(t);var c=Tp(Rx.current);if(r=t.type,e!==null&&t.stateNode!=null)g8(e,t,r,i,c),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!i){if(t.stateNode===null)throw Error(lr(166));return Is(t),null}if(e=Tp(Xc.current),uS(t)){i=t.stateNode,r=t.type;var d=t.memoizedProps;switch(i[Hc]=t,i[Ox]=d,e=(t.mode&1)!==0,r){case"dialog":eo("cancel",i),eo("close",i);break;case"iframe":case"object":case"embed":eo("load",i);break;case"video":case"audio":for(c=0;c<H0.length;c++)eo(H0[c],i);break;case"source":eo("error",i);break;case"img":case"image":case"link":eo("error",i),eo("load",i);break;case"details":eo("toggle",i);break;case"input":Z3(i,d),eo("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!d.multiple},eo("invalid",i);break;case"textarea":K3(i,d),eo("invalid",i)}uO(r,d),c=null;for(var g in d)if(d.hasOwnProperty(g)){var o=d[g];g==="children"?typeof o=="string"?i.textContent!==o&&(d.suppressHydrationWarning!==!0&&cS(i.textContent,o,e),c=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(d.suppressHydrationWarning!==!0&&cS(i.textContent,o,e),c=["children",""+o]):xx.hasOwnProperty(g)&&o!=null&&g==="onScroll"&&eo("scroll",i)}switch(r){case"input":tS(i),X3(i,d,!0);break;case"textarea":tS(i),Y3(i);break;case"select":case"option":break;default:typeof d.onClick=="function"&&(i.onclick=gT)}i=c,t.updateQueue=i,i!==null&&(t.flags|=4)}else{g=c.nodeType===9?c:c.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=HV(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=g.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof i.is=="string"?e=g.createElement(r,{is:i.is}):(e=g.createElement(r),r==="select"&&(g=e,i.multiple?g.multiple=!0:i.size&&(g.size=i.size))):e=g.createElementNS(e,r),e[Hc]=t,e[Ox]=i,m8(e,t,!1,!1),t.stateNode=e;e:{switch(g=hO(r,i),r){case"dialog":eo("cancel",e),eo("close",e),c=i;break;case"iframe":case"object":case"embed":eo("load",e),c=i;break;case"video":case"audio":for(c=0;c<H0.length;c++)eo(H0[c],e);c=i;break;case"source":eo("error",e),c=i;break;case"img":case"image":case"link":eo("error",e),eo("load",e),c=i;break;case"details":eo("toggle",e),c=i;break;case"input":Z3(e,i),c=oO(e,i),eo("invalid",e);break;case"option":c=i;break;case"select":e._wrapperState={wasMultiple:!!i.multiple},c=fo({},i,{value:void 0}),eo("invalid",e);break;case"textarea":K3(e,i),c=lO(e,i),eo("invalid",e);break;default:c=i}uO(r,c),o=c;for(d in o)if(o.hasOwnProperty(d)){var w=o[d];d==="style"?ZV(e,w):d==="dangerouslySetInnerHTML"?(w=w?w.__html:void 0,w!=null&&WV(e,w)):d==="children"?typeof w=="string"?(r!=="textarea"||w!=="")&&bx(e,w):typeof w=="number"&&bx(e,""+w):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(xx.hasOwnProperty(d)?w!=null&&d==="onScroll"&&eo("scroll",e):w!=null&&ik(e,d,w,g))}switch(r){case"input":tS(e),X3(e,i,!1);break;case"textarea":tS(e),Y3(e);break;case"option":i.value!=null&&e.setAttribute("value",""+Ld(i.value));break;case"select":e.multiple=!!i.multiple,d=i.value,d!=null?i_(e,!!i.multiple,d,!1):i.defaultValue!=null&&i_(e,!!i.multiple,i.defaultValue,!0);break;default:typeof c.onClick=="function"&&(e.onclick=gT)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Is(t),null;case 6:if(e&&t.stateNode!=null)_8(e,t,e.memoizedProps,i);else{if(typeof i!="string"&&t.stateNode===null)throw Error(lr(166));if(r=Tp(Rx.current),Tp(Xc.current),uS(t)){if(i=t.stateNode,r=t.memoizedProps,i[Hc]=t,(d=i.nodeValue!==r)&&(e=$a,e!==null))switch(e.tag){case 3:cS(i.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&cS(i.nodeValue,r,(e.mode&1)!==0)}d&&(t.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[Hc]=t,t.stateNode=i}return Is(t),null;case 13:if(no(uo),i=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(oo&&Ba!==null&&t.mode&1&&!(t.flags&128))L6(),O_(),t.flags|=98560,d=!1;else if(d=uS(t),i!==null&&i.dehydrated!==null){if(e===null){if(!d)throw Error(lr(318));if(d=t.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(lr(317));d[Hc]=t}else O_(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Is(t),d=!1}else rc!==null&&(HO(rc),rc=null),d=!0;if(!d)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(i=i!==null,i!==(e!==null&&e.memoizedState!==null)&&i&&(t.child.flags|=8192,t.mode&1&&(e===null||uo.current&1?Ho===0&&(Ho=3):Bk())),t.updateQueue!==null&&(t.flags|=4),Is(t),null);case 4:return R_(),NO(e,t),e===null&&Cx(t.stateNode.containerInfo),Is(t),null;case 10:return Sk(t.type._context),Is(t),null;case 17:return ya(t.type)&&_T(),Is(t),null;case 19:if(no(uo),d=t.memoizedState,d===null)return Is(t),null;if(i=(t.flags&128)!==0,g=d.rendering,g===null)if(i)P0(d,!1);else{if(Ho!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(g=TT(e),g!==null){for(t.flags|=128,P0(d,!1),i=g.updateQueue,i!==null&&(t.updateQueue=i,t.flags|=4),t.subtreeFlags=0,i=r,r=t.child;r!==null;)d=r,e=i,d.flags&=14680066,g=d.alternate,g===null?(d.childLanes=0,d.lanes=e,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=g.childLanes,d.lanes=g.lanes,d.child=g.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=g.memoizedProps,d.memoizedState=g.memoizedState,d.updateQueue=g.updateQueue,d.type=g.type,e=g.dependencies,d.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Ki(uo,uo.current&1|2),t.child}e=e.sibling}d.tail!==null&&Po()>D_&&(t.flags|=128,i=!0,P0(d,!1),t.lanes=4194304)}else{if(!i)if(e=TT(g),e!==null){if(t.flags|=128,i=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),P0(d,!0),d.tail===null&&d.tailMode==="hidden"&&!g.alternate&&!oo)return Is(t),null}else 2*Po()-d.renderingStartTime>D_&&r!==1073741824&&(t.flags|=128,i=!0,P0(d,!1),t.lanes=4194304);d.isBackwards?(g.sibling=t.child,t.child=g):(r=d.last,r!==null?r.sibling=g:t.child=g,d.last=g)}return d.tail!==null?(t=d.tail,d.rendering=t,d.tail=t.sibling,d.renderingStartTime=Po(),t.sibling=null,r=uo.current,Ki(uo,i?r&1|2:r&1),t):(Is(t),null);case 22:case 23:return Fk(),i=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==i&&(t.flags|=8192),i&&t.mode&1?La&1073741824&&(Is(t),t.subtreeFlags&6&&(t.flags|=8192)):Is(t),null;case 24:return null;case 25:return null}throw Error(lr(156,t.tag))}function Mte(e,t){switch(vk(t),t.tag){case 1:return ya(t.type)&&_T(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return R_(),no(_a),no(Ns),Ck(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return Pk(t),null;case 13:if(no(uo),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(lr(340));O_()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return no(uo),null;case 4:return R_(),null;case 10:return Sk(t.type._context),null;case 22:case 23:return Fk(),null;case 24:return null;default:return null}}var fS=!1,ks=!1,Rte=typeof WeakSet=="function"?WeakSet:Set,Fr=null;function Jg(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){yo(e,t,i)}else r.current=null}function jO(e,t,r){try{r()}catch(i){yo(e,t,i)}}var BF=!1;function kte(e,t){if(bO=fT,e=w6(),_k(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var c=i.anchorOffset,d=i.focusNode;i=i.focusOffset;try{r.nodeType,d.nodeType}catch{r=null;break e}var g=0,o=-1,w=-1,T=0,I=0,C=e,R=null;t:for(;;){for(var F;C!==r||c!==0&&C.nodeType!==3||(o=g+c),C!==d||i!==0&&C.nodeType!==3||(w=g+i),C.nodeType===3&&(g+=C.nodeValue.length),(F=C.firstChild)!==null;)R=C,C=F;for(;;){if(C===e)break t;if(R===r&&++T===c&&(o=g),R===d&&++I===i&&(w=g),(F=C.nextSibling)!==null)break;C=R,R=C.parentNode}C=F}r=o===-1||w===-1?null:{start:o,end:w}}else r=null}r=r||{start:0,end:0}}else r=null;for(wO={focusedElem:e,selectionRange:r},fT=!1,Fr=t;Fr!==null;)if(t=Fr,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,Fr=e;else for(;Fr!==null;){t=Fr;try{var G=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var j=G.memoizedProps,H=G.memoizedState,X=t.stateNode,q=X.getSnapshotBeforeUpdate(t.elementType===t.type?j:Xl(t.type,j),H);X.__reactInternalSnapshotBeforeUpdate=q}break;case 3:var Z=t.stateNode.containerInfo;Z.nodeType===1?Z.textContent="":Z.nodeType===9&&Z.documentElement&&Z.removeChild(Z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(lr(163))}}catch(J){yo(t,t.return,J)}if(e=t.sibling,e!==null){e.return=t.return,Fr=e;break}Fr=t.return}return G=BF,BF=!1,G}function rx(e,t,r){var i=t.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var c=i=i.next;do{if((c.tag&e)===e){var d=c.destroy;c.destroy=void 0,d!==void 0&&jO(t,r,d)}c=c.next}while(c!==i)}}function QE(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var i=r.create;r.destroy=i()}r=r.next}while(r!==t)}}function FO(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function y8(e){var t=e.alternate;t!==null&&(e.alternate=null,y8(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Hc],delete t[Ox],delete t[EO],delete t[mte],delete t[gte])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function v8(e){return e.tag===5||e.tag===3||e.tag===4}function $F(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||v8(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function BO(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=gT));else if(i!==4&&(e=e.child,e!==null))for(BO(e,t,r),e=e.sibling;e!==null;)BO(e,t,r),e=e.sibling}function $O(e,t,r){var i=e.tag;if(i===5||i===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(i!==4&&(e=e.child,e!==null))for($O(e,t,r),e=e.sibling;e!==null;)$O(e,t,r),e=e.sibling}var ms=null,Jl=!1;function Jh(e,t,r){for(r=r.child;r!==null;)x8(e,t,r),r=r.sibling}function x8(e,t,r){if(Zc&&typeof Zc.onCommitFiberUnmount=="function")try{Zc.onCommitFiberUnmount(HE,r)}catch{}switch(r.tag){case 5:ks||Jg(r,t);case 6:var i=ms,c=Jl;ms=null,Jh(e,t,r),ms=i,Jl=c,ms!==null&&(Jl?(e=ms,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):ms.removeChild(r.stateNode));break;case 18:ms!==null&&(Jl?(e=ms,r=r.stateNode,e.nodeType===8?ZC(e.parentNode,r):e.nodeType===1&&ZC(e,r),Ex(e)):ZC(ms,r.stateNode));break;case 4:i=ms,c=Jl,ms=r.stateNode.containerInfo,Jl=!0,Jh(e,t,r),ms=i,Jl=c;break;case 0:case 11:case 14:case 15:if(!ks&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){c=i=i.next;do{var d=c,g=d.destroy;d=d.tag,g!==void 0&&(d&2||d&4)&&jO(r,t,g),c=c.next}while(c!==i)}Jh(e,t,r);break;case 1:if(!ks&&(Jg(r,t),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(o){yo(r,t,o)}Jh(e,t,r);break;case 21:Jh(e,t,r);break;case 22:r.mode&1?(ks=(i=ks)||r.memoizedState!==null,Jh(e,t,r),ks=i):Jh(e,t,r);break;default:Jh(e,t,r)}}function UF(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new Rte),t.forEach(function(i){var c=Ute.bind(null,e,i);r.has(i)||(r.add(i),i.then(c,c))})}}function Gl(e,t){var r=t.deletions;if(r!==null)for(var i=0;i<r.length;i++){var c=r[i];try{var d=e,g=t,o=g;e:for(;o!==null;){switch(o.tag){case 5:ms=o.stateNode,Jl=!1;break e;case 3:ms=o.stateNode.containerInfo,Jl=!0;break e;case 4:ms=o.stateNode.containerInfo,Jl=!0;break e}o=o.return}if(ms===null)throw Error(lr(160));x8(d,g,c),ms=null,Jl=!1;var w=c.alternate;w!==null&&(w.return=null),c.return=null}catch(T){yo(c,t,T)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)b8(t,e),t=t.sibling}function b8(e,t){var r=e.alternate,i=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Gl(t,e),Bc(e),i&4){try{rx(3,e,e.return),QE(3,e)}catch(j){yo(e,e.return,j)}try{rx(5,e,e.return)}catch(j){yo(e,e.return,j)}}break;case 1:Gl(t,e),Bc(e),i&512&&r!==null&&Jg(r,r.return);break;case 5:if(Gl(t,e),Bc(e),i&512&&r!==null&&Jg(r,r.return),e.flags&32){var c=e.stateNode;try{bx(c,"")}catch(j){yo(e,e.return,j)}}if(i&4&&(c=e.stateNode,c!=null)){var d=e.memoizedProps,g=r!==null?r.memoizedProps:d,o=e.type,w=e.updateQueue;if(e.updateQueue=null,w!==null)try{o==="input"&&d.type==="radio"&&d.name!=null&&VV(c,d),hO(o,g);var T=hO(o,d);for(g=0;g<w.length;g+=2){var I=w[g],C=w[g+1];I==="style"?ZV(c,C):I==="dangerouslySetInnerHTML"?WV(c,C):I==="children"?bx(c,C):ik(c,I,C,T)}switch(o){case"input":sO(c,d);break;case"textarea":GV(c,d);break;case"select":var R=c._wrapperState.wasMultiple;c._wrapperState.wasMultiple=!!d.multiple;var F=d.value;F!=null?i_(c,!!d.multiple,F,!1):R!==!!d.multiple&&(d.defaultValue!=null?i_(c,!!d.multiple,d.defaultValue,!0):i_(c,!!d.multiple,d.multiple?[]:"",!1))}c[Ox]=d}catch(j){yo(e,e.return,j)}}break;case 6:if(Gl(t,e),Bc(e),i&4){if(e.stateNode===null)throw Error(lr(162));c=e.stateNode,d=e.memoizedProps;try{c.nodeValue=d}catch(j){yo(e,e.return,j)}}break;case 3:if(Gl(t,e),Bc(e),i&4&&r!==null&&r.memoizedState.isDehydrated)try{Ex(t.containerInfo)}catch(j){yo(e,e.return,j)}break;case 4:Gl(t,e),Bc(e);break;case 13:Gl(t,e),Bc(e),c=e.child,c.flags&8192&&(d=c.memoizedState!==null,c.stateNode.isHidden=d,!d||c.alternate!==null&&c.alternate.memoizedState!==null||(Nk=Po())),i&4&&UF(e);break;case 22:if(I=r!==null&&r.memoizedState!==null,e.mode&1?(ks=(T=ks)||I,Gl(t,e),ks=T):Gl(t,e),Bc(e),i&8192){if(T=e.memoizedState!==null,(e.stateNode.isHidden=T)&&!I&&e.mode&1)for(Fr=e,I=e.child;I!==null;){for(C=Fr=I;Fr!==null;){switch(R=Fr,F=R.child,R.tag){case 0:case 11:case 14:case 15:rx(4,R,R.return);break;case 1:Jg(R,R.return);var G=R.stateNode;if(typeof G.componentWillUnmount=="function"){i=R,r=R.return;try{t=i,G.props=t.memoizedProps,G.state=t.memoizedState,G.componentWillUnmount()}catch(j){yo(i,r,j)}}break;case 5:Jg(R,R.return);break;case 22:if(R.memoizedState!==null){GF(C);continue}}F!==null?(F.return=R,Fr=F):GF(C)}I=I.sibling}e:for(I=null,C=e;;){if(C.tag===5){if(I===null){I=C;try{c=C.stateNode,T?(d=c.style,typeof d.setProperty=="function"?d.setProperty("display","none","important"):d.display="none"):(o=C.stateNode,w=C.memoizedProps.style,g=w!=null&&w.hasOwnProperty("display")?w.display:null,o.style.display=qV("display",g))}catch(j){yo(e,e.return,j)}}}else if(C.tag===6){if(I===null)try{C.stateNode.nodeValue=T?"":C.memoizedProps}catch(j){yo(e,e.return,j)}}else if((C.tag!==22&&C.tag!==23||C.memoizedState===null||C===e)&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===e)break e;for(;C.sibling===null;){if(C.return===null||C.return===e)break e;I===C&&(I=null),C=C.return}I===C&&(I=null),C.sibling.return=C.return,C=C.sibling}}break;case 19:Gl(t,e),Bc(e),i&4&&UF(e);break;case 21:break;default:Gl(t,e),Bc(e)}}function Bc(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(v8(r)){var i=r;break e}r=r.return}throw Error(lr(160))}switch(i.tag){case 5:var c=i.stateNode;i.flags&32&&(bx(c,""),i.flags&=-33);var d=$F(e);$O(e,d,c);break;case 3:case 4:var g=i.stateNode.containerInfo,o=$F(e);BO(e,o,g);break;default:throw Error(lr(161))}}catch(w){yo(e,e.return,w)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Dte(e,t,r){Fr=e,w8(e)}function w8(e,t,r){for(var i=(e.mode&1)!==0;Fr!==null;){var c=Fr,d=c.child;if(c.tag===22&&i){var g=c.memoizedState!==null||fS;if(!g){var o=c.alternate,w=o!==null&&o.memoizedState!==null||ks;o=fS;var T=ks;if(fS=g,(ks=w)&&!T)for(Fr=c;Fr!==null;)g=Fr,w=g.child,g.tag===22&&g.memoizedState!==null?HF(c):w!==null?(w.return=g,Fr=w):HF(c);for(;d!==null;)Fr=d,w8(d),d=d.sibling;Fr=c,fS=o,ks=T}VF(e)}else c.subtreeFlags&8772&&d!==null?(d.return=c,Fr=d):VF(e)}}function VF(e){for(;Fr!==null;){var t=Fr;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ks||QE(5,t);break;case 1:var i=t.stateNode;if(t.flags&4&&!ks)if(r===null)i.componentDidMount();else{var c=t.elementType===t.type?r.memoizedProps:Xl(t.type,r.memoizedProps);i.componentDidUpdate(c,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var d=t.updateQueue;d!==null&&PF(t,d,i);break;case 3:var g=t.updateQueue;if(g!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}PF(t,g,r)}break;case 5:var o=t.stateNode;if(r===null&&t.flags&4){r=o;var w=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":w.autoFocus&&r.focus();break;case"img":w.src&&(r.src=w.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var T=t.alternate;if(T!==null){var I=T.memoizedState;if(I!==null){var C=I.dehydrated;C!==null&&Ex(C)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(lr(163))}ks||t.flags&512&&FO(t)}catch(R){yo(t,t.return,R)}}if(t===e){Fr=null;break}if(r=t.sibling,r!==null){r.return=t.return,Fr=r;break}Fr=t.return}}function GF(e){for(;Fr!==null;){var t=Fr;if(t===e){Fr=null;break}var r=t.sibling;if(r!==null){r.return=t.return,Fr=r;break}Fr=t.return}}function HF(e){for(;Fr!==null;){var t=Fr;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{QE(4,t)}catch(w){yo(t,r,w)}break;case 1:var i=t.stateNode;if(typeof i.componentDidMount=="function"){var c=t.return;try{i.componentDidMount()}catch(w){yo(t,c,w)}}var d=t.return;try{FO(t)}catch(w){yo(t,d,w)}break;case 5:var g=t.return;try{FO(t)}catch(w){yo(t,g,w)}}}catch(w){yo(t,t.return,w)}if(t===e){Fr=null;break}var o=t.sibling;if(o!==null){o.return=t.return,Fr=o;break}Fr=t.return}}var Lte=Math.ceil,PT=nh.ReactCurrentDispatcher,Lk=nh.ReactCurrentOwner,fl=nh.ReactCurrentBatchConfig,yi=0,ss=null,Do=null,_s=0,La=0,Qg=Gd(0),Ho=0,zx=null,Up=0,e2=0,zk=0,nx=null,fa=null,Nk=0,D_=1/0,Du=null,CT=!1,UO=null,Id=null,pS=!1,bd=null,IT=0,ix=0,VO=null,QS=-1,eT=0;function ea(){return yi&6?Po():QS!==-1?QS:QS=Po()}function Od(e){return e.mode&1?yi&2&&_s!==0?_s&-_s:yte.transition!==null?(eT===0&&(eT=s6()),eT):(e=zi,e!==0||(e=window.event,e=e===void 0?16:f6(e.type)),e):1}function oc(e,t,r,i){if(50<ix)throw ix=0,VO=null,Error(lr(185));R1(e,r,i),(!(yi&2)||e!==ss)&&(e===ss&&(!(yi&2)&&(e2|=r),Ho===4&&dd(e,_s)),va(e,i),r===1&&yi===0&&!(t.mode&1)&&(D_=Po()+500,KE&&Hd()))}function va(e,t){var r=e.callbackNode;yee(e,t);var i=dT(e,e===ss?_s:0);if(i===0)r!==null&&eF(r),e.callbackNode=null,e.callbackPriority=0;else if(t=i&-i,e.callbackPriority!==t){if(r!=null&&eF(r),t===1)e.tag===0?_te(WF.bind(null,e)):R6(WF.bind(null,e)),fte(function(){!(yi&6)&&Hd()}),r=null;else{switch(a6(i)){case 1:r=ck;break;case 4:r=i6;break;case 16:r=hT;break;case 536870912:r=o6;break;default:r=hT}r=O8(r,S8.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function S8(e,t){if(QS=-1,eT=0,yi&6)throw Error(lr(327));var r=e.callbackNode;if(c_()&&e.callbackNode!==r)return null;var i=dT(e,e===ss?_s:0);if(i===0)return null;if(i&30||i&e.expiredLanes||t)t=OT(e,i);else{t=i;var c=yi;yi|=2;var d=E8();(ss!==e||_s!==t)&&(Du=null,D_=Po()+500,kp(e,t));do try{jte();break}catch(o){T8(e,o)}while(!0);wk(),PT.current=d,yi=c,Do!==null?t=0:(ss=null,_s=0,t=Ho)}if(t!==0){if(t===2&&(c=gO(e),c!==0&&(i=c,t=GO(e,c))),t===1)throw r=zx,kp(e,0),dd(e,i),va(e,Po()),r;if(t===6)dd(e,i);else{if(c=e.current.alternate,!(i&30)&&!zte(c)&&(t=OT(e,i),t===2&&(d=gO(e),d!==0&&(i=d,t=GO(e,d))),t===1))throw r=zx,kp(e,0),dd(e,i),va(e,Po()),r;switch(e.finishedWork=c,e.finishedLanes=i,t){case 0:case 1:throw Error(lr(345));case 2:mp(e,fa,Du);break;case 3:if(dd(e,i),(i&130023424)===i&&(t=Nk+500-Po(),10<t)){if(dT(e,0)!==0)break;if(c=e.suspendedLanes,(c&i)!==i){ea(),e.pingedLanes|=e.suspendedLanes&c;break}e.timeoutHandle=TO(mp.bind(null,e,fa,Du),t);break}mp(e,fa,Du);break;case 4:if(dd(e,i),(i&4194240)===i)break;for(t=e.eventTimes,c=-1;0<i;){var g=31-ic(i);d=1<<g,g=t[g],g>c&&(c=g),i&=~d}if(i=c,i=Po()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Lte(i/1960))-i,10<i){e.timeoutHandle=TO(mp.bind(null,e,fa,Du),i);break}mp(e,fa,Du);break;case 5:mp(e,fa,Du);break;default:throw Error(lr(329))}}}return va(e,Po()),e.callbackNode===r?S8.bind(null,e):null}function GO(e,t){var r=nx;return e.current.memoizedState.isDehydrated&&(kp(e,t).flags|=256),e=OT(e,t),e!==2&&(t=fa,fa=r,t!==null&&HO(t)),e}function HO(e){fa===null?fa=e:fa.push.apply(fa,e)}function zte(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var c=r[i],d=c.getSnapshot;c=c.value;try{if(!lc(d(),c))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function dd(e,t){for(t&=~zk,t&=~e2,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-ic(t),i=1<<r;e[r]=-1,t&=~i}}function WF(e){if(yi&6)throw Error(lr(327));c_();var t=dT(e,0);if(!(t&1))return va(e,Po()),null;var r=OT(e,t);if(e.tag!==0&&r===2){var i=gO(e);i!==0&&(t=i,r=GO(e,i))}if(r===1)throw r=zx,kp(e,0),dd(e,t),va(e,Po()),r;if(r===6)throw Error(lr(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,mp(e,fa,Du),va(e,Po()),null}function jk(e,t){var r=yi;yi|=1;try{return e(t)}finally{yi=r,yi===0&&(D_=Po()+500,KE&&Hd())}}function Vp(e){bd!==null&&bd.tag===0&&!(yi&6)&&c_();var t=yi;yi|=1;var r=fl.transition,i=zi;try{if(fl.transition=null,zi=1,e)return e()}finally{zi=i,fl.transition=r,yi=t,!(yi&6)&&Hd()}}function Fk(){La=Qg.current,no(Qg)}function kp(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,dte(r)),Do!==null)for(r=Do.return;r!==null;){var i=r;switch(vk(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&_T();break;case 3:R_(),no(_a),no(Ns),Ck();break;case 5:Pk(i);break;case 4:R_();break;case 13:no(uo);break;case 19:no(uo);break;case 10:Sk(i.type._context);break;case 22:case 23:Fk()}r=r.return}if(ss=e,Do=e=Md(e.current,null),_s=La=t,Ho=0,zx=null,zk=e2=Up=0,fa=nx=null,Sp!==null){for(t=0;t<Sp.length;t++)if(r=Sp[t],i=r.interleaved,i!==null){r.interleaved=null;var c=i.next,d=r.pending;if(d!==null){var g=d.next;d.next=c,i.next=g}r.pending=i}Sp=null}return e}function T8(e,t){do{var r=Do;try{if(wk(),KS.current=AT,ET){for(var i=ho.memoizedState;i!==null;){var c=i.queue;c!==null&&(c.pending=null),i=i.next}ET=!1}if($p=0,is=Vo=ho=null,tx=!1,kx=0,Lk.current=null,r===null||r.return===null){Ho=1,zx=t,Do=null;break}e:{var d=e,g=r.return,o=r,w=t;if(t=_s,o.flags|=32768,w!==null&&typeof w=="object"&&typeof w.then=="function"){var T=w,I=o,C=I.tag;if(!(I.mode&1)&&(C===0||C===11||C===15)){var R=I.alternate;R?(I.updateQueue=R.updateQueue,I.memoizedState=R.memoizedState,I.lanes=R.lanes):(I.updateQueue=null,I.memoizedState=null)}var F=kF(g);if(F!==null){F.flags&=-257,DF(F,g,o,d,t),F.mode&1&&RF(d,T,t),t=F,w=T;var G=t.updateQueue;if(G===null){var j=new Set;j.add(w),t.updateQueue=j}else G.add(w);break e}else{if(!(t&1)){RF(d,T,t),Bk();break e}w=Error(lr(426))}}else if(oo&&o.mode&1){var H=kF(g);if(H!==null){!(H.flags&65536)&&(H.flags|=256),DF(H,g,o,d,t),xk(k_(w,o));break e}}d=w=k_(w,o),Ho!==4&&(Ho=2),nx===null?nx=[d]:nx.push(d),d=g;do{switch(d.tag){case 3:d.flags|=65536,t&=-t,d.lanes|=t;var X=a8(d,w,t);AF(d,X);break e;case 1:o=w;var q=d.type,Z=d.stateNode;if(!(d.flags&128)&&(typeof q.getDerivedStateFromError=="function"||Z!==null&&typeof Z.componentDidCatch=="function"&&(Id===null||!Id.has(Z)))){d.flags|=65536,t&=-t,d.lanes|=t;var J=l8(d,o,t);AF(d,J);break e}}d=d.return}while(d!==null)}P8(r)}catch(ne){t=ne,Do===r&&r!==null&&(Do=r=r.return);continue}break}while(!0)}function E8(){var e=PT.current;return PT.current=AT,e===null?AT:e}function Bk(){(Ho===0||Ho===3||Ho===2)&&(Ho=4),ss===null||!(Up&268435455)&&!(e2&268435455)||dd(ss,_s)}function OT(e,t){var r=yi;yi|=2;var i=E8();(ss!==e||_s!==t)&&(Du=null,kp(e,t));do try{Nte();break}catch(c){T8(e,c)}while(!0);if(wk(),yi=r,PT.current=i,Do!==null)throw Error(lr(261));return ss=null,_s=0,Ho}function Nte(){for(;Do!==null;)A8(Do)}function jte(){for(;Do!==null&&!cee();)A8(Do)}function A8(e){var t=I8(e.alternate,e,La);e.memoizedProps=e.pendingProps,t===null?P8(e):Do=t,Lk.current=null}function P8(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=Mte(r,t),r!==null){r.flags&=32767,Do=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Ho=6,Do=null;return}}else if(r=Ote(r,t,La),r!==null){Do=r;return}if(t=t.sibling,t!==null){Do=t;return}Do=t=e}while(t!==null);Ho===0&&(Ho=5)}function mp(e,t,r){var i=zi,c=fl.transition;try{fl.transition=null,zi=1,Fte(e,t,r,i)}finally{fl.transition=c,zi=i}return null}function Fte(e,t,r,i){do c_();while(bd!==null);if(yi&6)throw Error(lr(327));r=e.finishedWork;var c=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(lr(177));e.callbackNode=null,e.callbackPriority=0;var d=r.lanes|r.childLanes;if(vee(e,d),e===ss&&(Do=ss=null,_s=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||pS||(pS=!0,O8(hT,function(){return c_(),null})),d=(r.flags&15990)!==0,r.subtreeFlags&15990||d){d=fl.transition,fl.transition=null;var g=zi;zi=1;var o=yi;yi|=4,Lk.current=null,kte(e,r),b8(r,e),ote(wO),fT=!!bO,wO=bO=null,e.current=r,Dte(r),uee(),yi=o,zi=g,fl.transition=d}else e.current=r;if(pS&&(pS=!1,bd=e,IT=c),d=e.pendingLanes,d===0&&(Id=null),fee(r.stateNode),va(e,Po()),t!==null)for(i=e.onRecoverableError,r=0;r<t.length;r++)c=t[r],i(c.value,{componentStack:c.stack,digest:c.digest});if(CT)throw CT=!1,e=UO,UO=null,e;return IT&1&&e.tag!==0&&c_(),d=e.pendingLanes,d&1?e===VO?ix++:(ix=0,VO=e):ix=0,Hd(),null}function c_(){if(bd!==null){var e=a6(IT),t=fl.transition,r=zi;try{if(fl.transition=null,zi=16>e?16:e,bd===null)var i=!1;else{if(e=bd,bd=null,IT=0,yi&6)throw Error(lr(331));var c=yi;for(yi|=4,Fr=e.current;Fr!==null;){var d=Fr,g=d.child;if(Fr.flags&16){var o=d.deletions;if(o!==null){for(var w=0;w<o.length;w++){var T=o[w];for(Fr=T;Fr!==null;){var I=Fr;switch(I.tag){case 0:case 11:case 15:rx(8,I,d)}var C=I.child;if(C!==null)C.return=I,Fr=C;else for(;Fr!==null;){I=Fr;var R=I.sibling,F=I.return;if(y8(I),I===T){Fr=null;break}if(R!==null){R.return=F,Fr=R;break}Fr=F}}}var G=d.alternate;if(G!==null){var j=G.child;if(j!==null){G.child=null;do{var H=j.sibling;j.sibling=null,j=H}while(j!==null)}}Fr=d}}if(d.subtreeFlags&2064&&g!==null)g.return=d,Fr=g;else e:for(;Fr!==null;){if(d=Fr,d.flags&2048)switch(d.tag){case 0:case 11:case 15:rx(9,d,d.return)}var X=d.sibling;if(X!==null){X.return=d.return,Fr=X;break e}Fr=d.return}}var q=e.current;for(Fr=q;Fr!==null;){g=Fr;var Z=g.child;if(g.subtreeFlags&2064&&Z!==null)Z.return=g,Fr=Z;else e:for(g=q;Fr!==null;){if(o=Fr,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:QE(9,o)}}catch(ne){yo(o,o.return,ne)}if(o===g){Fr=null;break e}var J=o.sibling;if(J!==null){J.return=o.return,Fr=J;break e}Fr=o.return}}if(yi=c,Hd(),Zc&&typeof Zc.onPostCommitFiberRoot=="function")try{Zc.onPostCommitFiberRoot(HE,e)}catch{}i=!0}return i}finally{zi=r,fl.transition=t}}return!1}function qF(e,t,r){t=k_(r,t),t=a8(e,t,1),e=Cd(e,t,1),t=ea(),e!==null&&(R1(e,1,t),va(e,t))}function yo(e,t,r){if(e.tag===3)qF(e,e,r);else for(;t!==null;){if(t.tag===3){qF(t,e,r);break}else if(t.tag===1){var i=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Id===null||!Id.has(i))){e=k_(r,e),e=l8(t,e,1),t=Cd(t,e,1),e=ea(),t!==null&&(R1(t,1,e),va(t,e));break}}t=t.return}}function Bte(e,t,r){var i=e.pingCache;i!==null&&i.delete(t),t=ea(),e.pingedLanes|=e.suspendedLanes&r,ss===e&&(_s&r)===r&&(Ho===4||Ho===3&&(_s&130023424)===_s&&500>Po()-Nk?kp(e,0):zk|=r),va(e,t)}function C8(e,t){t===0&&(e.mode&1?(t=iS,iS<<=1,!(iS&130023424)&&(iS=4194304)):t=1);var r=ea();e=Xu(e,t),e!==null&&(R1(e,t,r),va(e,r))}function $te(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),C8(e,r)}function Ute(e,t){var r=0;switch(e.tag){case 13:var i=e.stateNode,c=e.memoizedState;c!==null&&(r=c.retryLane);break;case 19:i=e.stateNode;break;default:throw Error(lr(314))}i!==null&&i.delete(t),C8(e,r)}var I8;I8=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||_a.current)ma=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return ma=!1,Ite(e,t,r);ma=!!(e.flags&131072)}else ma=!1,oo&&t.flags&1048576&&k6(t,xT,t.index);switch(t.lanes=0,t.tag){case 2:var i=t.type;JS(e,t),e=t.pendingProps;var c=I_(t,Ns.current);l_(t,r),c=Ok(null,t,i,e,c,r);var d=Mk();return t.flags|=1,typeof c=="object"&&c!==null&&typeof c.render=="function"&&c.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,ya(i)?(d=!0,yT(t)):d=!1,t.memoizedState=c.state!==null&&c.state!==void 0?c.state:null,Ek(t),c.updater=JE,t.stateNode=c,c._reactInternals=t,MO(t,i,e,r),t=DO(null,t,i,!0,d,r)):(t.tag=0,oo&&d&&yk(t),Zs(null,t,c,r),t=t.child),t;case 16:i=t.elementType;e:{switch(JS(e,t),e=t.pendingProps,c=i._init,i=c(i._payload),t.type=i,c=t.tag=Gte(i),e=Xl(i,e),c){case 0:t=kO(null,t,i,e,r);break e;case 1:t=NF(null,t,i,e,r);break e;case 11:t=LF(null,t,i,e,r);break e;case 14:t=zF(null,t,i,Xl(i.type,e),r);break e}throw Error(lr(306,i,""))}return t;case 0:return i=t.type,c=t.pendingProps,c=t.elementType===i?c:Xl(i,c),kO(e,t,i,c,r);case 1:return i=t.type,c=t.pendingProps,c=t.elementType===i?c:Xl(i,c),NF(e,t,i,c,r);case 3:e:{if(d8(t),e===null)throw Error(lr(387));i=t.pendingProps,d=t.memoizedState,c=d.element,F6(e,t),ST(t,i,null,r);var g=t.memoizedState;if(i=g.element,d.isDehydrated)if(d={element:i,isDehydrated:!1,cache:g.cache,pendingSuspenseBoundaries:g.pendingSuspenseBoundaries,transitions:g.transitions},t.updateQueue.baseState=d,t.memoizedState=d,t.flags&256){c=k_(Error(lr(423)),t),t=jF(e,t,i,r,c);break e}else if(i!==c){c=k_(Error(lr(424)),t),t=jF(e,t,i,r,c);break e}else for(Ba=Pd(t.stateNode.containerInfo.firstChild),$a=t,oo=!0,rc=null,r=N6(t,null,i,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(O_(),i===c){t=Ku(e,t,r);break e}Zs(e,t,i,r)}t=t.child}return t;case 5:return B6(t),e===null&&CO(t),i=t.type,c=t.pendingProps,d=e!==null?e.memoizedProps:null,g=c.children,SO(i,c)?g=null:d!==null&&SO(i,d)&&(t.flags|=32),h8(e,t),Zs(e,t,g,r),t.child;case 6:return e===null&&CO(t),null;case 13:return f8(e,t,r);case 4:return Ak(t,t.stateNode.containerInfo),i=t.pendingProps,e===null?t.child=M_(t,null,i,r):Zs(e,t,i,r),t.child;case 11:return i=t.type,c=t.pendingProps,c=t.elementType===i?c:Xl(i,c),LF(e,t,i,c,r);case 7:return Zs(e,t,t.pendingProps,r),t.child;case 8:return Zs(e,t,t.pendingProps.children,r),t.child;case 12:return Zs(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(i=t.type._context,c=t.pendingProps,d=t.memoizedProps,g=c.value,Ki(bT,i._currentValue),i._currentValue=g,d!==null)if(lc(d.value,g)){if(d.children===c.children&&!_a.current){t=Ku(e,t,r);break e}}else for(d=t.child,d!==null&&(d.return=t);d!==null;){var o=d.dependencies;if(o!==null){g=d.child;for(var w=o.firstContext;w!==null;){if(w.context===i){if(d.tag===1){w=Vu(-1,r&-r),w.tag=2;var T=d.updateQueue;if(T!==null){T=T.shared;var I=T.pending;I===null?w.next=w:(w.next=I.next,I.next=w),T.pending=w}}d.lanes|=r,w=d.alternate,w!==null&&(w.lanes|=r),IO(d.return,r,t),o.lanes|=r;break}w=w.next}}else if(d.tag===10)g=d.type===t.type?null:d.child;else if(d.tag===18){if(g=d.return,g===null)throw Error(lr(341));g.lanes|=r,o=g.alternate,o!==null&&(o.lanes|=r),IO(g,r,t),g=d.sibling}else g=d.child;if(g!==null)g.return=d;else for(g=d;g!==null;){if(g===t){g=null;break}if(d=g.sibling,d!==null){d.return=g.return,g=d;break}g=g.return}d=g}Zs(e,t,c.children,r),t=t.child}return t;case 9:return c=t.type,i=t.pendingProps.children,l_(t,r),c=gl(c),i=i(c),t.flags|=1,Zs(e,t,i,r),t.child;case 14:return i=t.type,c=Xl(i,t.pendingProps),c=Xl(i.type,c),zF(e,t,i,c,r);case 15:return c8(e,t,t.type,t.pendingProps,r);case 17:return i=t.type,c=t.pendingProps,c=t.elementType===i?c:Xl(i,c),JS(e,t),t.tag=1,ya(i)?(e=!0,yT(t)):e=!1,l_(t,r),s8(t,i,c),MO(t,i,c,r),DO(null,t,i,!0,e,r);case 19:return p8(e,t,r);case 22:return u8(e,t,r)}throw Error(lr(156,t.tag))};function O8(e,t){return n6(e,t)}function Vte(e,t,r,i){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function hl(e,t,r,i){return new Vte(e,t,r,i)}function $k(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Gte(e){if(typeof e=="function")return $k(e)?1:0;if(e!=null){if(e=e.$$typeof,e===sk)return 11;if(e===ak)return 14}return 2}function Md(e,t){var r=e.alternate;return r===null?(r=hl(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function tT(e,t,r,i,c,d){var g=2;if(i=e,typeof e=="function")$k(e)&&(g=1);else if(typeof e=="string")g=5;else e:switch(e){case Vg:return Dp(r.children,c,d,t);case ok:g=8,c|=8;break;case tO:return e=hl(12,r,t,c|2),e.elementType=tO,e.lanes=d,e;case rO:return e=hl(13,r,t,c),e.elementType=rO,e.lanes=d,e;case nO:return e=hl(19,r,t,c),e.elementType=nO,e.lanes=d,e;case BV:return t2(r,c,d,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case jV:g=10;break e;case FV:g=9;break e;case sk:g=11;break e;case ak:g=14;break e;case sd:g=16,i=null;break e}throw Error(lr(130,e==null?e:typeof e,""))}return t=hl(g,r,t,c),t.elementType=e,t.type=i,t.lanes=d,t}function Dp(e,t,r,i){return e=hl(7,e,i,t),e.lanes=r,e}function t2(e,t,r,i){return e=hl(22,e,i,t),e.elementType=BV,e.lanes=r,e.stateNode={isHidden:!1},e}function rI(e,t,r){return e=hl(6,e,null,t),e.lanes=r,e}function nI(e,t,r){return t=hl(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Hte(e,t,r,i,c){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=NC(0),this.expirationTimes=NC(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=NC(0),this.identifierPrefix=i,this.onRecoverableError=c,this.mutableSourceEagerHydrationData=null}function Uk(e,t,r,i,c,d,g,o,w){return e=new Hte(e,t,r,o,w),t===1?(t=1,d===!0&&(t|=8)):t=0,d=hl(3,null,null,t),e.current=d,d.stateNode=e,d.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ek(d),e}function Wte(e,t,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ug,key:i==null?null:""+i,children:e,containerInfo:t,implementation:r}}function M8(e){if(!e)return zd;e=e._reactInternals;e:{if(tm(e)!==e||e.tag!==1)throw Error(lr(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(ya(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(lr(171))}if(e.tag===1){var r=e.type;if(ya(r))return M6(e,r,t)}return t}function R8(e,t,r,i,c,d,g,o,w){return e=Uk(r,i,!0,e,c,d,g,o,w),e.context=M8(null),r=e.current,i=ea(),c=Od(r),d=Vu(i,c),d.callback=t??null,Cd(r,d,c),e.current.lanes=c,R1(e,c,i),va(e,i),e}function r2(e,t,r,i){var c=t.current,d=ea(),g=Od(c);return r=M8(r),t.context===null?t.context=r:t.pendingContext=r,t=Vu(d,g),t.payload={element:e},i=i===void 0?null:i,i!==null&&(t.callback=i),e=Cd(c,t,g),e!==null&&(oc(e,c,g,d),XS(e,c,g)),g}function MT(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function ZF(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Vk(e,t){ZF(e,t),(e=e.alternate)&&ZF(e,t)}function qte(){return null}var k8=typeof reportError=="function"?reportError:function(e){console.error(e)};function Gk(e){this._internalRoot=e}n2.prototype.render=Gk.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(lr(409));r2(e,t,null,null)};n2.prototype.unmount=Gk.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Vp(function(){r2(null,e,null,null)}),t[Zu]=null}};function n2(e){this._internalRoot=e}n2.prototype.unstable_scheduleHydration=function(e){if(e){var t=u6();e={blockedOn:null,target:e,priority:t};for(var r=0;r<hd.length&&t!==0&&t<hd[r].priority;r++);hd.splice(r,0,e),r===0&&d6(e)}};function Hk(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function i2(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function XF(){}function Zte(e,t,r,i,c){if(c){if(typeof i=="function"){var d=i;i=function(){var T=MT(g);d.call(T)}}var g=R8(t,i,e,0,null,!1,!1,"",XF);return e._reactRootContainer=g,e[Zu]=g.current,Cx(e.nodeType===8?e.parentNode:e),Vp(),g}for(;c=e.lastChild;)e.removeChild(c);if(typeof i=="function"){var o=i;i=function(){var T=MT(w);o.call(T)}}var w=Uk(e,0,!1,null,null,!1,!1,"",XF);return e._reactRootContainer=w,e[Zu]=w.current,Cx(e.nodeType===8?e.parentNode:e),Vp(function(){r2(t,w,r,i)}),w}function o2(e,t,r,i,c){var d=r._reactRootContainer;if(d){var g=d;if(typeof c=="function"){var o=c;c=function(){var w=MT(g);o.call(w)}}r2(t,g,e,c)}else g=Zte(r,t,e,c,i);return MT(g)}l6=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=G0(t.pendingLanes);r!==0&&(uk(t,r|1),va(t,Po()),!(yi&6)&&(D_=Po()+500,Hd()))}break;case 13:Vp(function(){var i=Xu(e,1);if(i!==null){var c=ea();oc(i,e,1,c)}}),Vk(e,1)}};hk=function(e){if(e.tag===13){var t=Xu(e,134217728);if(t!==null){var r=ea();oc(t,e,134217728,r)}Vk(e,134217728)}};c6=function(e){if(e.tag===13){var t=Od(e),r=Xu(e,t);if(r!==null){var i=ea();oc(r,e,t,i)}Vk(e,t)}};u6=function(){return zi};h6=function(e,t){var r=zi;try{return zi=e,t()}finally{zi=r}};fO=function(e,t,r){switch(t){case"input":if(sO(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var i=r[t];if(i!==e&&i.form===e.form){var c=XE(i);if(!c)throw Error(lr(90));UV(i),sO(i,c)}}}break;case"textarea":GV(e,r);break;case"select":t=r.value,t!=null&&i_(e,!!r.multiple,t,!1)}};YV=jk;JV=Vp;var Xte={usingClientEntryPoint:!1,Events:[D1,qg,XE,XV,KV,jk]},C0={findFiberByHostInstance:wp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Kte={bundleType:C0.bundleType,version:C0.version,rendererPackageName:C0.rendererPackageName,rendererConfig:C0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:nh.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=t6(e),e===null?null:e.stateNode},findFiberByHostInstance:C0.findFiberByHostInstance||qte,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var mS=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!mS.isDisabled&&mS.supportsFiber)try{HE=mS.inject(Kte),Zc=mS}catch{}}Ha.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Xte;Ha.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Hk(t))throw Error(lr(200));return Wte(e,t,null,r)};Ha.createRoot=function(e,t){if(!Hk(e))throw Error(lr(299));var r=!1,i="",c=k8;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(i=t.identifierPrefix),t.onRecoverableError!==void 0&&(c=t.onRecoverableError)),t=Uk(e,1,!1,null,null,r,!1,i,c),e[Zu]=t.current,Cx(e.nodeType===8?e.parentNode:e),new Gk(t)};Ha.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(lr(188)):(e=Object.keys(e).join(","),Error(lr(268,e)));return e=t6(t),e=e===null?null:e.stateNode,e};Ha.flushSync=function(e){return Vp(e)};Ha.hydrate=function(e,t,r){if(!i2(t))throw Error(lr(200));return o2(null,e,t,!0,r)};Ha.hydrateRoot=function(e,t,r){if(!Hk(e))throw Error(lr(405));var i=r!=null&&r.hydratedSources||null,c=!1,d="",g=k8;if(r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(d=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),t=R8(t,null,e,1,r??null,c,!1,d,g),e[Zu]=t.current,Cx(e),i)for(e=0;e<i.length;e++)r=i[e],c=r._getVersion,c=c(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,c]:t.mutableSourceEagerHydrationData.push(r,c);return new n2(t)};Ha.render=function(e,t,r){if(!i2(t))throw Error(lr(200));return o2(null,e,t,!1,r)};Ha.unmountComponentAtNode=function(e){if(!i2(e))throw Error(lr(40));return e._reactRootContainer?(Vp(function(){o2(null,null,e,!1,function(){e._reactRootContainer=null,e[Zu]=null})}),!0):!1};Ha.unstable_batchedUpdates=jk;Ha.unstable_renderSubtreeIntoContainer=function(e,t,r,i){if(!i2(r))throw Error(lr(200));if(e==null||e._reactInternals===void 0)throw Error(lr(38));return o2(e,t,r,!1,i)};Ha.version="18.3.1-next-f1338f8080-20240426";function D8(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(D8)}catch(e){console.error(e)}}D8(),DV.exports=Ha;var rm=DV.exports;const L8=Ii(rm);var z8,KF=rm;z8=KF.createRoot,KF.hydrateRoot;const Yte=1,Jte=1e6;let iI=0;function Qte(){return iI=(iI+1)%Number.MAX_SAFE_INTEGER,iI.toString()}const oI=new Map,YF=e=>{if(oI.has(e))return;const t=setTimeout(()=>{oI.delete(e),ox({type:"REMOVE_TOAST",toastId:e})},Jte);oI.set(e,t)},ere=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,Yte)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(r=>r.id===t.toast.id?{...r,...t.toast}:r)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?YF(r):e.toasts.forEach(i=>{YF(i.id)}),{...e,toasts:e.toasts.map(i=>i.id===r||r===void 0?{...i,open:!1}:i)}}case"REMOVE_TOAST":return t.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(r=>r.id!==t.toastId)}}},rT=[];let nT={toasts:[]};function ox(e){nT=ere(nT,e),rT.forEach(t=>{t(nT)})}function tre({...e}){const t=Qte(),r=c=>ox({type:"UPDATE_TOAST",toast:{...c,id:t}}),i=()=>ox({type:"DISMISS_TOAST",toastId:t});return ox({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:c=>{c||i()}}}),{id:t,dismiss:i,update:r}}function Wd(){const[e,t]=Q.useState(nT);return Q.useEffect(()=>(rT.push(t),()=>{const r=rT.indexOf(t);r>-1&&rT.splice(r,1)}),[e]),{...e,toast:tre,dismiss:r=>ox({type:"DISMISS_TOAST",toastId:r})}}function Er(e,t,{checkForDefaultPrevented:r=!0}={}){return function(c){if(e==null||e(c),r===!1||!c.defaultPrevented)return t==null?void 0:t(c)}}function rre(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function s2(...e){return t=>e.forEach(r=>rre(r,t))}function Ci(...e){return Q.useCallback(s2(...e),e)}function nre(e,t=[]){let r=[];function i(d,g){const o=Q.createContext(g),w=r.length;r=[...r,g];function T(C){const{scope:R,children:F,...G}=C,j=(R==null?void 0:R[e][w])||o,H=Q.useMemo(()=>G,Object.values(G));return z.jsx(j.Provider,{value:H,children:F})}function I(C,R){const F=(R==null?void 0:R[e][w])||o,G=Q.useContext(F);if(G)return G;if(g!==void 0)return g;throw new Error(`\`${C}\` must be used within \`${d}\``)}return T.displayName=d+"Provider",[T,I]}const c=()=>{const d=r.map(g=>Q.createContext(g));return function(o){const w=(o==null?void 0:o[e])||d;return Q.useMemo(()=>({[`__scope${e}`]:{...o,[e]:w}}),[o,w])}};return c.scopeName=e,[i,ire(c,...t)]}function ire(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const i=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const g=i.reduce((o,{useScope:w,scopeName:T})=>{const C=w(d)[`__scope${T}`];return{...o,...C}},{});return Q.useMemo(()=>({[`__scope${t.scopeName}`]:g}),[g])}};return r.scopeName=t.scopeName,r}var Nd=Q.forwardRef((e,t)=>{const{children:r,...i}=e,c=Q.Children.toArray(r),d=c.find(ore);if(d){const g=d.props.children,o=c.map(w=>w===d?Q.Children.count(g)>1?Q.Children.only(null):Q.isValidElement(g)?g.props.children:null:w);return z.jsx(WO,{...i,ref:t,children:Q.isValidElement(g)?Q.cloneElement(g,void 0,o):null})}return z.jsx(WO,{...i,ref:t,children:r})});Nd.displayName="Slot";var WO=Q.forwardRef((e,t)=>{const{children:r,...i}=e;if(Q.isValidElement(r)){const c=are(r);return Q.cloneElement(r,{...sre(i,r.props),ref:t?s2(t,c):c})}return Q.Children.count(r)>1?Q.Children.only(null):null});WO.displayName="SlotClone";var N8=({children:e})=>z.jsx(z.Fragment,{children:e});function ore(e){return Q.isValidElement(e)&&e.type===N8}function sre(e,t){const r={...t};for(const i in t){const c=e[i],d=t[i];/^on[A-Z]/.test(i)?c&&d?r[i]=(...o)=>{d(...o),c(...o)}:c&&(r[i]=c):i==="style"?r[i]={...c,...d}:i==="className"&&(r[i]=[c,d].filter(Boolean).join(" "))}return{...e,...r}}function are(e){var i,c;let t=(i=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:i.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(c=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:c.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function a2(e){const t=e+"CollectionProvider",[r,i]=nre(t),[c,d]=r(t,{collectionRef:{current:null},itemMap:new Map}),g=F=>{const{scope:G,children:j}=F,H=De.useRef(null),X=De.useRef(new Map).current;return z.jsx(c,{scope:G,itemMap:X,collectionRef:H,children:j})};g.displayName=t;const o=e+"CollectionSlot",w=De.forwardRef((F,G)=>{const{scope:j,children:H}=F,X=d(o,j),q=Ci(G,X.collectionRef);return z.jsx(Nd,{ref:q,children:H})});w.displayName=o;const T=e+"CollectionItemSlot",I="data-radix-collection-item",C=De.forwardRef((F,G)=>{const{scope:j,children:H,...X}=F,q=De.useRef(null),Z=Ci(G,q),J=d(T,j);return De.useEffect(()=>(J.itemMap.set(q,{ref:q,...X}),()=>void J.itemMap.delete(q))),z.jsx(Nd,{[I]:"",ref:Z,children:H})});C.displayName=T;function R(F){const G=d(e+"CollectionConsumer",F);return De.useCallback(()=>{const H=G.collectionRef.current;if(!H)return[];const X=Array.from(H.querySelectorAll(`[${I}]`));return Array.from(G.itemMap.values()).sort((J,ne)=>X.indexOf(J.ref.current)-X.indexOf(ne.ref.current))},[G.collectionRef,G.itemMap])}return[{Provider:g,Slot:w,ItemSlot:C},R,i]}function lre(e,t){const r=Q.createContext(t),i=d=>{const{children:g,...o}=d,w=Q.useMemo(()=>o,Object.values(o));return z.jsx(r.Provider,{value:w,children:g})};i.displayName=e+"Provider";function c(d){const g=Q.useContext(r);if(g)return g;if(t!==void 0)return t;throw new Error(`\`${d}\` must be used within \`${e}\``)}return[i,c]}function nm(e,t=[]){let r=[];function i(d,g){const o=Q.createContext(g),w=r.length;r=[...r,g];const T=C=>{var X;const{scope:R,children:F,...G}=C,j=((X=R==null?void 0:R[e])==null?void 0:X[w])||o,H=Q.useMemo(()=>G,Object.values(G));return z.jsx(j.Provider,{value:H,children:F})};T.displayName=d+"Provider";function I(C,R){var j;const F=((j=R==null?void 0:R[e])==null?void 0:j[w])||o,G=Q.useContext(F);if(G)return G;if(g!==void 0)return g;throw new Error(`\`${C}\` must be used within \`${d}\``)}return[T,I]}const c=()=>{const d=r.map(g=>Q.createContext(g));return function(o){const w=(o==null?void 0:o[e])||d;return Q.useMemo(()=>({[`__scope${e}`]:{...o,[e]:w}}),[o,w])}};return c.scopeName=e,[i,cre(c,...t)]}function cre(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const i=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const g=i.reduce((o,{useScope:w,scopeName:T})=>{const C=w(d)[`__scope${T}`];return{...o,...C}},{});return Q.useMemo(()=>({[`__scope${t.scopeName}`]:g}),[g])}};return r.scopeName=t.scopeName,r}var ure=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Sn=ure.reduce((e,t)=>{const r=Q.forwardRef((i,c)=>{const{asChild:d,...g}=i,o=d?Nd:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),z.jsx(o,{...g,ref:c})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function Wk(e,t){e&&rm.flushSync(()=>e.dispatchEvent(t))}function js(e){const t=Q.useRef(e);return Q.useEffect(()=>{t.current=e}),Q.useMemo(()=>(...r)=>{var i;return(i=t.current)==null?void 0:i.call(t,...r)},[])}function hre(e,t=globalThis==null?void 0:globalThis.document){const r=js(e);Q.useEffect(()=>{const i=c=>{c.key==="Escape"&&r(c)};return t.addEventListener("keydown",i,{capture:!0}),()=>t.removeEventListener("keydown",i,{capture:!0})},[r,t])}var dre="DismissableLayer",qO="dismissableLayer.update",fre="dismissableLayer.pointerDownOutside",pre="dismissableLayer.focusOutside",JF,j8=Q.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),hy=Q.forwardRef((e,t)=>{const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:g,onDismiss:o,...w}=e,T=Q.useContext(j8),[I,C]=Q.useState(null),R=(I==null?void 0:I.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,F]=Q.useState({}),G=Ci(t,me=>C(me)),j=Array.from(T.layers),[H]=[...T.layersWithOutsidePointerEventsDisabled].slice(-1),X=j.indexOf(H),q=I?j.indexOf(I):-1,Z=T.layersWithOutsidePointerEventsDisabled.size>0,J=q>=X,ne=gre(me=>{const Se=me.target,qe=[...T.branches].some(Ze=>Ze.contains(Se));!J||qe||(c==null||c(me),g==null||g(me),me.defaultPrevented||o==null||o())},R),he=_re(me=>{const Se=me.target;[...T.branches].some(Ze=>Ze.contains(Se))||(d==null||d(me),g==null||g(me),me.defaultPrevented||o==null||o())},R);return hre(me=>{q===T.layers.size-1&&(i==null||i(me),!me.defaultPrevented&&o&&(me.preventDefault(),o()))},R),Q.useEffect(()=>{if(I)return r&&(T.layersWithOutsidePointerEventsDisabled.size===0&&(JF=R.body.style.pointerEvents,R.body.style.pointerEvents="none"),T.layersWithOutsidePointerEventsDisabled.add(I)),T.layers.add(I),QF(),()=>{r&&T.layersWithOutsidePointerEventsDisabled.size===1&&(R.body.style.pointerEvents=JF)}},[I,R,r,T]),Q.useEffect(()=>()=>{I&&(T.layers.delete(I),T.layersWithOutsidePointerEventsDisabled.delete(I),QF())},[I,T]),Q.useEffect(()=>{const me=()=>F({});return document.addEventListener(qO,me),()=>document.removeEventListener(qO,me)},[]),z.jsx(Sn.div,{...w,ref:G,style:{pointerEvents:Z?J?"auto":"none":void 0,...e.style},onFocusCapture:Er(e.onFocusCapture,he.onFocusCapture),onBlurCapture:Er(e.onBlurCapture,he.onBlurCapture),onPointerDownCapture:Er(e.onPointerDownCapture,ne.onPointerDownCapture)})});hy.displayName=dre;var mre="DismissableLayerBranch",F8=Q.forwardRef((e,t)=>{const r=Q.useContext(j8),i=Q.useRef(null),c=Ci(t,i);return Q.useEffect(()=>{const d=i.current;if(d)return r.branches.add(d),()=>{r.branches.delete(d)}},[r.branches]),z.jsx(Sn.div,{...e,ref:c})});F8.displayName=mre;function gre(e,t=globalThis==null?void 0:globalThis.document){const r=js(e),i=Q.useRef(!1),c=Q.useRef(()=>{});return Q.useEffect(()=>{const d=o=>{if(o.target&&!i.current){let w=function(){B8(fre,r,T,{discrete:!0})};const T={originalEvent:o};o.pointerType==="touch"?(t.removeEventListener("click",c.current),c.current=w,t.addEventListener("click",c.current,{once:!0})):w()}else t.removeEventListener("click",c.current);i.current=!1},g=window.setTimeout(()=>{t.addEventListener("pointerdown",d)},0);return()=>{window.clearTimeout(g),t.removeEventListener("pointerdown",d),t.removeEventListener("click",c.current)}},[t,r]),{onPointerDownCapture:()=>i.current=!0}}function _re(e,t=globalThis==null?void 0:globalThis.document){const r=js(e),i=Q.useRef(!1);return Q.useEffect(()=>{const c=d=>{d.target&&!i.current&&B8(pre,r,{originalEvent:d},{discrete:!1})};return t.addEventListener("focusin",c),()=>t.removeEventListener("focusin",c)},[t,r]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}function QF(){const e=new CustomEvent(qO);document.dispatchEvent(e)}function B8(e,t,r,{discrete:i}){const c=r.originalEvent.target,d=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:r});t&&c.addEventListener(e,t,{once:!0}),i?Wk(c,d):c.dispatchEvent(d)}var yre=hy,vre=F8,Fs=globalThis!=null&&globalThis.document?Q.useLayoutEffect:()=>{},xre="Portal",z1=Q.forwardRef((e,t)=>{var o;const{container:r,...i}=e,[c,d]=Q.useState(!1);Fs(()=>d(!0),[]);const g=r||c&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return g?L8.createPortal(z.jsx(Sn.div,{...i,ref:t}),g):null});z1.displayName=xre;function bre(e,t){return Q.useReducer((r,i)=>t[r][i]??r,e)}var hc=e=>{const{present:t,children:r}=e,i=wre(t),c=typeof r=="function"?r({present:i.isPresent}):Q.Children.only(r),d=Ci(i.ref,Sre(c));return typeof r=="function"||i.isPresent?Q.cloneElement(c,{ref:d}):null};hc.displayName="Presence";function wre(e){const[t,r]=Q.useState(),i=Q.useRef({}),c=Q.useRef(e),d=Q.useRef("none"),g=e?"mounted":"unmounted",[o,w]=bre(g,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return Q.useEffect(()=>{const T=gS(i.current);d.current=o==="mounted"?T:"none"},[o]),Fs(()=>{const T=i.current,I=c.current;if(I!==e){const R=d.current,F=gS(T);e?w("MOUNT"):F==="none"||(T==null?void 0:T.display)==="none"?w("UNMOUNT"):w(I&&R!==F?"ANIMATION_OUT":"UNMOUNT"),c.current=e}},[e,w]),Fs(()=>{if(t){let T;const I=t.ownerDocument.defaultView??window,C=F=>{const j=gS(i.current).includes(F.animationName);if(F.target===t&&j&&(w("ANIMATION_END"),!c.current)){const H=t.style.animationFillMode;t.style.animationFillMode="forwards",T=I.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=H)})}},R=F=>{F.target===t&&(d.current=gS(i.current))};return t.addEventListener("animationstart",R),t.addEventListener("animationcancel",C),t.addEventListener("animationend",C),()=>{I.clearTimeout(T),t.removeEventListener("animationstart",R),t.removeEventListener("animationcancel",C),t.removeEventListener("animationend",C)}}else w("ANIMATION_END")},[t,w]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:Q.useCallback(T=>{T&&(i.current=getComputedStyle(T)),r(T)},[])}}function gS(e){return(e==null?void 0:e.animationName)||"none"}function Sre(e){var i,c;let t=(i=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:i.get,r=t&&"isReactWarning"in t&&t.isReactWarning;return r?e.ref:(t=(c=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:c.get,r=t&&"isReactWarning"in t&&t.isReactWarning,r?e.props.ref:e.props.ref||e.ref)}function Gp({prop:e,defaultProp:t,onChange:r=()=>{}}){const[i,c]=Tre({defaultProp:t,onChange:r}),d=e!==void 0,g=d?e:i,o=js(r),w=Q.useCallback(T=>{if(d){const C=typeof T=="function"?T(e):T;C!==e&&o(C)}else c(T)},[d,e,c,o]);return[g,w]}function Tre({defaultProp:e,onChange:t}){const r=Q.useState(e),[i]=r,c=Q.useRef(i),d=js(t);return Q.useEffect(()=>{c.current!==i&&(d(i),c.current=i)},[i,c,d]),r}var Ere="VisuallyHidden",N1=Q.forwardRef((e,t)=>z.jsx(Sn.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));N1.displayName=Ere;var Are=N1,qk="ToastProvider",[Zk,Pre,Cre]=a2("Toast"),[$8,Pje]=nm("Toast",[Cre]),[Ire,l2]=$8(qk),U8=e=>{const{__scopeToast:t,label:r="Notification",duration:i=5e3,swipeDirection:c="right",swipeThreshold:d=50,children:g}=e,[o,w]=Q.useState(null),[T,I]=Q.useState(0),C=Q.useRef(!1),R=Q.useRef(!1);return r.trim()||console.error(`Invalid prop \`label\` supplied to \`${qk}\`. Expected non-empty \`string\`.`),z.jsx(Zk.Provider,{scope:t,children:z.jsx(Ire,{scope:t,label:r,duration:i,swipeDirection:c,swipeThreshold:d,toastCount:T,viewport:o,onViewportChange:w,onToastAdd:Q.useCallback(()=>I(F=>F+1),[]),onToastRemove:Q.useCallback(()=>I(F=>F-1),[]),isFocusedToastEscapeKeyDownRef:C,isClosePausedRef:R,children:g})})};U8.displayName=qk;var V8="ToastViewport",Ore=["F8"],ZO="toast.viewportPause",XO="toast.viewportResume",G8=Q.forwardRef((e,t)=>{const{__scopeToast:r,hotkey:i=Ore,label:c="Notifications ({hotkey})",...d}=e,g=l2(V8,r),o=Pre(r),w=Q.useRef(null),T=Q.useRef(null),I=Q.useRef(null),C=Q.useRef(null),R=Ci(t,C,g.onViewportChange),F=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),G=g.toastCount>0;Q.useEffect(()=>{const H=X=>{var Z;i.length!==0&&i.every(J=>X[J]||X.code===J)&&((Z=C.current)==null||Z.focus())};return document.addEventListener("keydown",H),()=>document.removeEventListener("keydown",H)},[i]),Q.useEffect(()=>{const H=w.current,X=C.current;if(G&&H&&X){const q=()=>{if(!g.isClosePausedRef.current){const he=new CustomEvent(ZO);X.dispatchEvent(he),g.isClosePausedRef.current=!0}},Z=()=>{if(g.isClosePausedRef.current){const he=new CustomEvent(XO);X.dispatchEvent(he),g.isClosePausedRef.current=!1}},J=he=>{!H.contains(he.relatedTarget)&&Z()},ne=()=>{H.contains(document.activeElement)||Z()};return H.addEventListener("focusin",q),H.addEventListener("focusout",J),H.addEventListener("pointermove",q),H.addEventListener("pointerleave",ne),window.addEventListener("blur",q),window.addEventListener("focus",Z),()=>{H.removeEventListener("focusin",q),H.removeEventListener("focusout",J),H.removeEventListener("pointermove",q),H.removeEventListener("pointerleave",ne),window.removeEventListener("blur",q),window.removeEventListener("focus",Z)}}},[G,g.isClosePausedRef]);const j=Q.useCallback(({tabbingDirection:H})=>{const q=o().map(Z=>{const J=Z.ref.current,ne=[J,...Vre(J)];return H==="forwards"?ne:ne.reverse()});return(H==="forwards"?q.reverse():q).flat()},[o]);return Q.useEffect(()=>{const H=C.current;if(H){const X=q=>{var ne,he,me;const Z=q.altKey||q.ctrlKey||q.metaKey;if(q.key==="Tab"&&!Z){const Se=document.activeElement,qe=q.shiftKey;if(q.target===H&&qe){(ne=T.current)==null||ne.focus();return}const Ke=j({tabbingDirection:qe?"backwards":"forwards"}),dt=Ke.findIndex($e=>$e===Se);sI(Ke.slice(dt+1))?q.preventDefault():qe?(he=T.current)==null||he.focus():(me=I.current)==null||me.focus()}};return H.addEventListener("keydown",X),()=>H.removeEventListener("keydown",X)}},[o,j]),z.jsxs(vre,{ref:w,role:"region","aria-label":c.replace("{hotkey}",F),tabIndex:-1,style:{pointerEvents:G?void 0:"none"},children:[G&&z.jsx(KO,{ref:T,onFocusFromOutsideViewport:()=>{const H=j({tabbingDirection:"forwards"});sI(H)}}),z.jsx(Zk.Slot,{scope:r,children:z.jsx(Sn.ol,{tabIndex:-1,...d,ref:R})}),G&&z.jsx(KO,{ref:I,onFocusFromOutsideViewport:()=>{const H=j({tabbingDirection:"backwards"});sI(H)}})]})});G8.displayName=V8;var H8="ToastFocusProxy",KO=Q.forwardRef((e,t)=>{const{__scopeToast:r,onFocusFromOutsideViewport:i,...c}=e,d=l2(H8,r);return z.jsx(N1,{"aria-hidden":!0,tabIndex:0,...c,ref:t,style:{position:"fixed"},onFocus:g=>{var T;const o=g.relatedTarget;!((T=d.viewport)!=null&&T.contains(o))&&i()}})});KO.displayName=H8;var c2="Toast",Mre="toast.swipeStart",Rre="toast.swipeMove",kre="toast.swipeCancel",Dre="toast.swipeEnd",W8=Q.forwardRef((e,t)=>{const{forceMount:r,open:i,defaultOpen:c,onOpenChange:d,...g}=e,[o=!0,w]=Gp({prop:i,defaultProp:c,onChange:d});return z.jsx(hc,{present:r||o,children:z.jsx(Nre,{open:o,...g,ref:t,onClose:()=>w(!1),onPause:js(e.onPause),onResume:js(e.onResume),onSwipeStart:Er(e.onSwipeStart,T=>{T.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Er(e.onSwipeMove,T=>{const{x:I,y:C}=T.detail.delta;T.currentTarget.setAttribute("data-swipe","move"),T.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${I}px`),T.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${C}px`)}),onSwipeCancel:Er(e.onSwipeCancel,T=>{T.currentTarget.setAttribute("data-swipe","cancel"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),T.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Er(e.onSwipeEnd,T=>{const{x:I,y:C}=T.detail.delta;T.currentTarget.setAttribute("data-swipe","end"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),T.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),T.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${I}px`),T.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${C}px`),w(!1)})})})});W8.displayName=c2;var[Lre,zre]=$8(c2,{onClose(){}}),Nre=Q.forwardRef((e,t)=>{const{__scopeToast:r,type:i="foreground",duration:c,open:d,onClose:g,onEscapeKeyDown:o,onPause:w,onResume:T,onSwipeStart:I,onSwipeMove:C,onSwipeCancel:R,onSwipeEnd:F,...G}=e,j=l2(c2,r),[H,X]=Q.useState(null),q=Ci(t,$e=>X($e)),Z=Q.useRef(null),J=Q.useRef(null),ne=c||j.duration,he=Q.useRef(0),me=Q.useRef(ne),Se=Q.useRef(0),{onToastAdd:qe,onToastRemove:Ze}=j,He=js(()=>{var mt;(H==null?void 0:H.contains(document.activeElement))&&((mt=j.viewport)==null||mt.focus()),g()}),Ke=Q.useCallback($e=>{!$e||$e===1/0||(window.clearTimeout(Se.current),he.current=new Date().getTime(),Se.current=window.setTimeout(He,$e))},[He]);Q.useEffect(()=>{const $e=j.viewport;if($e){const mt=()=>{Ke(me.current),T==null||T()},ct=()=>{const St=new Date().getTime()-he.current;me.current=me.current-St,window.clearTimeout(Se.current),w==null||w()};return $e.addEventListener(ZO,ct),$e.addEventListener(XO,mt),()=>{$e.removeEventListener(ZO,ct),$e.removeEventListener(XO,mt)}}},[j.viewport,ne,w,T,Ke]),Q.useEffect(()=>{d&&!j.isClosePausedRef.current&&Ke(ne)},[d,ne,j.isClosePausedRef,Ke]),Q.useEffect(()=>(qe(),()=>Ze()),[qe,Ze]);const dt=Q.useMemo(()=>H?Q8(H):null,[H]);return j.viewport?z.jsxs(z.Fragment,{children:[dt&&z.jsx(jre,{__scopeToast:r,role:"status","aria-live":i==="foreground"?"assertive":"polite","aria-atomic":!0,children:dt}),z.jsx(Lre,{scope:r,onClose:He,children:rm.createPortal(z.jsx(Zk.ItemSlot,{scope:r,children:z.jsx(yre,{asChild:!0,onEscapeKeyDown:Er(o,()=>{j.isFocusedToastEscapeKeyDownRef.current||He(),j.isFocusedToastEscapeKeyDownRef.current=!1}),children:z.jsx(Sn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":d?"open":"closed","data-swipe-direction":j.swipeDirection,...G,ref:q,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Er(e.onKeyDown,$e=>{$e.key==="Escape"&&(o==null||o($e.nativeEvent),$e.nativeEvent.defaultPrevented||(j.isFocusedToastEscapeKeyDownRef.current=!0,He()))}),onPointerDown:Er(e.onPointerDown,$e=>{$e.button===0&&(Z.current={x:$e.clientX,y:$e.clientY})}),onPointerMove:Er(e.onPointerMove,$e=>{if(!Z.current)return;const mt=$e.clientX-Z.current.x,ct=$e.clientY-Z.current.y,St=!!J.current,Ue=["left","right"].includes(j.swipeDirection),st=["left","up"].includes(j.swipeDirection)?Math.min:Math.max,bt=Ue?st(0,mt):0,At=Ue?0:st(0,ct),zt=$e.pointerType==="touch"?10:2,or={x:bt,y:At},Mr={originalEvent:$e,delta:or};St?(J.current=or,_S(Rre,C,Mr,{discrete:!1})):eB(or,j.swipeDirection,zt)?(J.current=or,_S(Mre,I,Mr,{discrete:!1}),$e.target.setPointerCapture($e.pointerId)):(Math.abs(mt)>zt||Math.abs(ct)>zt)&&(Z.current=null)}),onPointerUp:Er(e.onPointerUp,$e=>{const mt=J.current,ct=$e.target;if(ct.hasPointerCapture($e.pointerId)&&ct.releasePointerCapture($e.pointerId),J.current=null,Z.current=null,mt){const St=$e.currentTarget,Ue={originalEvent:$e,delta:mt};eB(mt,j.swipeDirection,j.swipeThreshold)?_S(Dre,F,Ue,{discrete:!0}):_S(kre,R,Ue,{discrete:!0}),St.addEventListener("click",st=>st.preventDefault(),{once:!0})}})})})}),j.viewport)})]}):null}),jre=e=>{const{__scopeToast:t,children:r,...i}=e,c=l2(c2,t),[d,g]=Q.useState(!1),[o,w]=Q.useState(!1);return $re(()=>g(!0)),Q.useEffect(()=>{const T=window.setTimeout(()=>w(!0),1e3);return()=>window.clearTimeout(T)},[]),o?null:z.jsx(z1,{asChild:!0,children:z.jsx(N1,{...i,children:d&&z.jsxs(z.Fragment,{children:[c.label," ",r]})})})},Fre="ToastTitle",q8=Q.forwardRef((e,t)=>{const{__scopeToast:r,...i}=e;return z.jsx(Sn.div,{...i,ref:t})});q8.displayName=Fre;var Bre="ToastDescription",Z8=Q.forwardRef((e,t)=>{const{__scopeToast:r,...i}=e;return z.jsx(Sn.div,{...i,ref:t})});Z8.displayName=Bre;var X8="ToastAction",K8=Q.forwardRef((e,t)=>{const{altText:r,...i}=e;return r.trim()?z.jsx(J8,{altText:r,asChild:!0,children:z.jsx(Xk,{...i,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${X8}\`. Expected non-empty \`string\`.`),null)});K8.displayName=X8;var Y8="ToastClose",Xk=Q.forwardRef((e,t)=>{const{__scopeToast:r,...i}=e,c=zre(Y8,r);return z.jsx(J8,{asChild:!0,children:z.jsx(Sn.button,{type:"button",...i,ref:t,onClick:Er(e.onClick,c.onClose)})})});Xk.displayName=Y8;var J8=Q.forwardRef((e,t)=>{const{__scopeToast:r,altText:i,...c}=e;return z.jsx(Sn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":i||void 0,...c,ref:t})});function Q8(e){const t=[];return Array.from(e.childNodes).forEach(i=>{if(i.nodeType===i.TEXT_NODE&&i.textContent&&t.push(i.textContent),Ure(i)){const c=i.ariaHidden||i.hidden||i.style.display==="none",d=i.dataset.radixToastAnnounceExclude==="";if(!c)if(d){const g=i.dataset.radixToastAnnounceAlt;g&&t.push(g)}else t.push(...Q8(i))}}),t}function _S(e,t,r,{discrete:i}){const c=r.originalEvent.currentTarget,d=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&c.addEventListener(e,t,{once:!0}),i?Wk(c,d):c.dispatchEvent(d)}var eB=(e,t,r=0)=>{const i=Math.abs(e.x),c=Math.abs(e.y),d=i>c;return t==="left"||t==="right"?d&&i>r:!d&&c>r};function $re(e=()=>{}){const t=js(e);Fs(()=>{let r=0,i=0;return r=window.requestAnimationFrame(()=>i=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(r),window.cancelAnimationFrame(i)}},[t])}function Ure(e){return e.nodeType===e.ELEMENT_NODE}function Vre(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const c=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||c?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function sI(e){const t=document.activeElement;return e.some(r=>r===t?!0:(r.focus(),document.activeElement!==t))}var Gre=U8,eG=G8,tG=W8,rG=q8,nG=Z8,iG=K8,oG=Xk;function sG(e){var t,r,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var c=e.length;for(t=0;t<c;t++)e[t]&&(r=sG(e[t]))&&(i&&(i+=" "),i+=r)}else for(r in e)e[r]&&(i&&(i+=" "),i+=r);return i}function Gn(){for(var e,t,r=0,i="",c=arguments.length;r<c;r++)(e=arguments[r])&&(t=sG(e))&&(i&&(i+=" "),i+=t);return i}const tB=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,rB=Gn,j1=(e,t)=>r=>{var i;if((t==null?void 0:t.variants)==null)return rB(e,r==null?void 0:r.class,r==null?void 0:r.className);const{variants:c,defaultVariants:d}=t,g=Object.keys(c).map(T=>{const I=r==null?void 0:r[T],C=d==null?void 0:d[T];if(I===null)return null;const R=tB(I)||tB(C);return c[T][R]}),o=r&&Object.entries(r).reduce((T,I)=>{let[C,R]=I;return R===void 0||(T[C]=R),T},{}),w=t==null||(i=t.compoundVariants)===null||i===void 0?void 0:i.reduce((T,I)=>{let{class:C,className:R,...F}=I;return Object.entries(F).every(G=>{let[j,H]=G;return Array.isArray(H)?H.includes({...d,...o}[j]):{...d,...o}[j]===H})?[...T,C,R]:T},[]);return rB(e,g,w,r==null?void 0:r.class,r==null?void 0:r.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hre=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aG=(...e)=>e.filter((t,r,i)=>!!t&&t.trim()!==""&&i.indexOf(t)===r).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Wre={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qre=Q.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:i,className:c="",children:d,iconNode:g,...o},w)=>Q.createElement("svg",{ref:w,...Wre,width:t,height:t,stroke:e,strokeWidth:i?Number(r)*24/Number(t):r,className:aG("lucide",c),...o},[...g.map(([T,I])=>Q.createElement(T,I)),...Array.isArray(d)?d:[d]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=(e,t)=>{const r=Q.forwardRef(({className:i,...c},d)=>Q.createElement(qre,{ref:d,iconNode:t,className:aG(`lucide-${Hre(e)}`,i),...c}));return r.displayName=`${e}`,r};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nB=Nn("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zre=Nn("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kk=Nn("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lG=Nn("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cG=Nn("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xre=Nn("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kre=Nn("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uG=Nn("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yre=Nn("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yk=Nn("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jre=Nn("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jk=Nn("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sx=Nn("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hG=Nn("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qre=Nn("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ene=Nn("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tne=Nn("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rne=Nn("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iB=Nn("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nne=Nn("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hp=Nn("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ine=Nn("Map",[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const one=Nn("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=Nn("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oB=Nn("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sne=Nn("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dG=Nn("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ane=Nn("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lne=Nn("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cne=Nn("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sB=Nn("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ax=Nn("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aB=Nn("Siren",[["path",{d:"M7 18v-6a5 5 0 1 1 10 0v6",key:"pcx96s"}],["path",{d:"M5 21a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-1a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2z",key:"1b4s83"}],["path",{d:"M21 12h1",key:"jtio3y"}],["path",{d:"M18.5 4.5 18 5",key:"g5sp9y"}],["path",{d:"M2 12h1",key:"1uaihz"}],["path",{d:"M12 2v1",key:"11qlp1"}],["path",{d:"m4.929 4.929.707.707",key:"1i51kw"}],["path",{d:"M12 12v6",key:"3ahymv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lB=Nn("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cB=Nn("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fG=Nn("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=Nn("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const une=Nn("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lx=Nn("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qk=Nn("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pG=Nn("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),eD="-",hne=e=>{const t=fne(e),{conflictingClassGroups:r,conflictingClassGroupModifiers:i}=e;return{getClassGroupId:g=>{const o=g.split(eD);return o[0]===""&&o.length!==1&&o.shift(),mG(o,t)||dne(g)},getConflictingClassGroupIds:(g,o)=>{const w=r[g]||[];return o&&i[g]?[...w,...i[g]]:w}}},mG=(e,t)=>{var g;if(e.length===0)return t.classGroupId;const r=e[0],i=t.nextPart.get(r),c=i?mG(e.slice(1),i):void 0;if(c)return c;if(t.validators.length===0)return;const d=e.join(eD);return(g=t.validators.find(({validator:o})=>o(d)))==null?void 0:g.classGroupId},uB=/^\[(.+)\]$/,dne=e=>{if(uB.test(e)){const t=uB.exec(e)[1],r=t==null?void 0:t.substring(0,t.indexOf(":"));if(r)return"arbitrary.."+r}},fne=e=>{const{theme:t,prefix:r}=e,i={nextPart:new Map,validators:[]};return mne(Object.entries(e.classGroups),r).forEach(([d,g])=>{YO(g,i,d,t)}),i},YO=(e,t,r,i)=>{e.forEach(c=>{if(typeof c=="string"){const d=c===""?t:hB(t,c);d.classGroupId=r;return}if(typeof c=="function"){if(pne(c)){YO(c(i),t,r,i);return}t.validators.push({validator:c,classGroupId:r});return}Object.entries(c).forEach(([d,g])=>{YO(g,hB(t,d),r,i)})})},hB=(e,t)=>{let r=e;return t.split(eD).forEach(i=>{r.nextPart.has(i)||r.nextPart.set(i,{nextPart:new Map,validators:[]}),r=r.nextPart.get(i)}),r},pne=e=>e.isThemeGetter,mne=(e,t)=>t?e.map(([r,i])=>{const c=i.map(d=>typeof d=="string"?t+d:typeof d=="object"?Object.fromEntries(Object.entries(d).map(([g,o])=>[t+g,o])):d);return[r,c]}):e,gne=e=>{if(e<1)return{get:()=>{},set:()=>{}};let t=0,r=new Map,i=new Map;const c=(d,g)=>{r.set(d,g),t++,t>e&&(t=0,i=r,r=new Map)};return{get(d){let g=r.get(d);if(g!==void 0)return g;if((g=i.get(d))!==void 0)return c(d,g),g},set(d,g){r.has(d)?r.set(d,g):c(d,g)}}},gG="!",_ne=e=>{const{separator:t,experimentalParseClassName:r}=e,i=t.length===1,c=t[0],d=t.length,g=o=>{const w=[];let T=0,I=0,C;for(let H=0;H<o.length;H++){let X=o[H];if(T===0){if(X===c&&(i||o.slice(H,H+d)===t)){w.push(o.slice(I,H)),I=H+d;continue}if(X==="/"){C=H;continue}}X==="["?T++:X==="]"&&T--}const R=w.length===0?o:o.substring(I),F=R.startsWith(gG),G=F?R.substring(1):R,j=C&&C>I?C-I:void 0;return{modifiers:w,hasImportantModifier:F,baseClassName:G,maybePostfixModifierPosition:j}};return r?o=>r({className:o,parseClassName:g}):g},yne=e=>{if(e.length<=1)return e;const t=[];let r=[];return e.forEach(i=>{i[0]==="["?(t.push(...r.sort(),i),r=[]):r.push(i)}),t.push(...r.sort()),t},vne=e=>({cache:gne(e.cacheSize),parseClassName:_ne(e),...hne(e)}),xne=/\s+/,bne=(e,t)=>{const{parseClassName:r,getClassGroupId:i,getConflictingClassGroupIds:c}=t,d=[],g=e.trim().split(xne);let o="";for(let w=g.length-1;w>=0;w-=1){const T=g[w],{modifiers:I,hasImportantModifier:C,baseClassName:R,maybePostfixModifierPosition:F}=r(T);let G=!!F,j=i(G?R.substring(0,F):R);if(!j){if(!G){o=T+(o.length>0?" "+o:o);continue}if(j=i(R),!j){o=T+(o.length>0?" "+o:o);continue}G=!1}const H=yne(I).join(":"),X=C?H+gG:H,q=X+j;if(d.includes(q))continue;d.push(q);const Z=c(j,G);for(let J=0;J<Z.length;++J){const ne=Z[J];d.push(X+ne)}o=T+(o.length>0?" "+o:o)}return o};function wne(){let e=0,t,r,i="";for(;e<arguments.length;)(t=arguments[e++])&&(r=_G(t))&&(i&&(i+=" "),i+=r);return i}const _G=e=>{if(typeof e=="string")return e;let t,r="";for(let i=0;i<e.length;i++)e[i]&&(t=_G(e[i]))&&(r&&(r+=" "),r+=t);return r};function Sne(e,...t){let r,i,c,d=g;function g(w){const T=t.reduce((I,C)=>C(I),e());return r=vne(T),i=r.cache.get,c=r.cache.set,d=o,o(w)}function o(w){const T=i(w);if(T)return T;const I=bne(w,r);return c(w,I),I}return function(){return d(wne.apply(null,arguments))}}const Qi=e=>{const t=r=>r[e]||[];return t.isThemeGetter=!0,t},yG=/^\[(?:([a-z-]+):)?(.+)\]$/i,Tne=/^\d+\/\d+$/,Ene=new Set(["px","full","screen"]),Ane=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Pne=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Cne=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Ine=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,One=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Ou=e=>u_(e)||Ene.has(e)||Tne.test(e),Qh=e=>dy(e,"length",jne),u_=e=>!!e&&!Number.isNaN(Number(e)),aI=e=>dy(e,"number",u_),I0=e=>!!e&&Number.isInteger(Number(e)),Mne=e=>e.endsWith("%")&&u_(e.slice(0,-1)),Dn=e=>yG.test(e),ed=e=>Ane.test(e),Rne=new Set(["length","size","percentage"]),kne=e=>dy(e,Rne,vG),Dne=e=>dy(e,"position",vG),Lne=new Set(["image","url"]),zne=e=>dy(e,Lne,Bne),Nne=e=>dy(e,"",Fne),O0=()=>!0,dy=(e,t,r)=>{const i=yG.exec(e);return i?i[1]?typeof t=="string"?i[1]===t:t.has(i[1]):r(i[2]):!1},jne=e=>Pne.test(e)&&!Cne.test(e),vG=()=>!1,Fne=e=>Ine.test(e),Bne=e=>One.test(e),$ne=()=>{const e=Qi("colors"),t=Qi("spacing"),r=Qi("blur"),i=Qi("brightness"),c=Qi("borderColor"),d=Qi("borderRadius"),g=Qi("borderSpacing"),o=Qi("borderWidth"),w=Qi("contrast"),T=Qi("grayscale"),I=Qi("hueRotate"),C=Qi("invert"),R=Qi("gap"),F=Qi("gradientColorStops"),G=Qi("gradientColorStopPositions"),j=Qi("inset"),H=Qi("margin"),X=Qi("opacity"),q=Qi("padding"),Z=Qi("saturate"),J=Qi("scale"),ne=Qi("sepia"),he=Qi("skew"),me=Qi("space"),Se=Qi("translate"),qe=()=>["auto","contain","none"],Ze=()=>["auto","hidden","clip","visible","scroll"],He=()=>["auto",Dn,t],Ke=()=>[Dn,t],dt=()=>["",Ou,Qh],$e=()=>["auto",u_,Dn],mt=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],ct=()=>["solid","dashed","dotted","double","none"],St=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],Ue=()=>["start","end","center","between","around","evenly","stretch"],st=()=>["","0",Dn],bt=()=>["auto","avoid","all","avoid-page","page","left","right","column"],At=()=>[u_,Dn];return{cacheSize:500,separator:":",theme:{colors:[O0],spacing:[Ou,Qh],blur:["none","",ed,Dn],brightness:At(),borderColor:[e],borderRadius:["none","","full",ed,Dn],borderSpacing:Ke(),borderWidth:dt(),contrast:At(),grayscale:st(),hueRotate:At(),invert:st(),gap:Ke(),gradientColorStops:[e],gradientColorStopPositions:[Mne,Qh],inset:He(),margin:He(),opacity:At(),padding:Ke(),saturate:At(),scale:At(),sepia:st(),skew:At(),space:Ke(),translate:Ke()},classGroups:{aspect:[{aspect:["auto","square","video",Dn]}],container:["container"],columns:[{columns:[ed]}],"break-after":[{"break-after":bt()}],"break-before":[{"break-before":bt()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...mt(),Dn]}],overflow:[{overflow:Ze()}],"overflow-x":[{"overflow-x":Ze()}],"overflow-y":[{"overflow-y":Ze()}],overscroll:[{overscroll:qe()}],"overscroll-x":[{"overscroll-x":qe()}],"overscroll-y":[{"overscroll-y":qe()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[j]}],"inset-x":[{"inset-x":[j]}],"inset-y":[{"inset-y":[j]}],start:[{start:[j]}],end:[{end:[j]}],top:[{top:[j]}],right:[{right:[j]}],bottom:[{bottom:[j]}],left:[{left:[j]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",I0,Dn]}],basis:[{basis:He()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Dn]}],grow:[{grow:st()}],shrink:[{shrink:st()}],order:[{order:["first","last","none",I0,Dn]}],"grid-cols":[{"grid-cols":[O0]}],"col-start-end":[{col:["auto",{span:["full",I0,Dn]},Dn]}],"col-start":[{"col-start":$e()}],"col-end":[{"col-end":$e()}],"grid-rows":[{"grid-rows":[O0]}],"row-start-end":[{row:["auto",{span:[I0,Dn]},Dn]}],"row-start":[{"row-start":$e()}],"row-end":[{"row-end":$e()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Dn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Dn]}],gap:[{gap:[R]}],"gap-x":[{"gap-x":[R]}],"gap-y":[{"gap-y":[R]}],"justify-content":[{justify:["normal",...Ue()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...Ue(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...Ue(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[q]}],px:[{px:[q]}],py:[{py:[q]}],ps:[{ps:[q]}],pe:[{pe:[q]}],pt:[{pt:[q]}],pr:[{pr:[q]}],pb:[{pb:[q]}],pl:[{pl:[q]}],m:[{m:[H]}],mx:[{mx:[H]}],my:[{my:[H]}],ms:[{ms:[H]}],me:[{me:[H]}],mt:[{mt:[H]}],mr:[{mr:[H]}],mb:[{mb:[H]}],ml:[{ml:[H]}],"space-x":[{"space-x":[me]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[me]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Dn,t]}],"min-w":[{"min-w":[Dn,t,"min","max","fit"]}],"max-w":[{"max-w":[Dn,t,"none","full","min","max","fit","prose",{screen:[ed]},ed]}],h:[{h:[Dn,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Dn,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Dn,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Dn,t,"auto","min","max","fit"]}],"font-size":[{text:["base",ed,Qh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",aI]}],"font-family":[{font:[O0]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractons"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Dn]}],"line-clamp":[{"line-clamp":["none",u_,aI]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Ou,Dn]}],"list-image":[{"list-image":["none",Dn]}],"list-style-type":[{list:["none","disc","decimal",Dn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[X]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[X]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...ct(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Ou,Qh]}],"underline-offset":[{"underline-offset":["auto",Ou,Dn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ke()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Dn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Dn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[X]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...mt(),Dne]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",kne]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},zne]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[G]}],"gradient-via-pos":[{via:[G]}],"gradient-to-pos":[{to:[G]}],"gradient-from":[{from:[F]}],"gradient-via":[{via:[F]}],"gradient-to":[{to:[F]}],rounded:[{rounded:[d]}],"rounded-s":[{"rounded-s":[d]}],"rounded-e":[{"rounded-e":[d]}],"rounded-t":[{"rounded-t":[d]}],"rounded-r":[{"rounded-r":[d]}],"rounded-b":[{"rounded-b":[d]}],"rounded-l":[{"rounded-l":[d]}],"rounded-ss":[{"rounded-ss":[d]}],"rounded-se":[{"rounded-se":[d]}],"rounded-ee":[{"rounded-ee":[d]}],"rounded-es":[{"rounded-es":[d]}],"rounded-tl":[{"rounded-tl":[d]}],"rounded-tr":[{"rounded-tr":[d]}],"rounded-br":[{"rounded-br":[d]}],"rounded-bl":[{"rounded-bl":[d]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[X]}],"border-style":[{border:[...ct(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[X]}],"divide-style":[{divide:ct()}],"border-color":[{border:[c]}],"border-color-x":[{"border-x":[c]}],"border-color-y":[{"border-y":[c]}],"border-color-s":[{"border-s":[c]}],"border-color-e":[{"border-e":[c]}],"border-color-t":[{"border-t":[c]}],"border-color-r":[{"border-r":[c]}],"border-color-b":[{"border-b":[c]}],"border-color-l":[{"border-l":[c]}],"divide-color":[{divide:[c]}],"outline-style":[{outline:["",...ct()]}],"outline-offset":[{"outline-offset":[Ou,Dn]}],"outline-w":[{outline:[Ou,Qh]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:dt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[X]}],"ring-offset-w":[{"ring-offset":[Ou,Qh]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",ed,Nne]}],"shadow-color":[{shadow:[O0]}],opacity:[{opacity:[X]}],"mix-blend":[{"mix-blend":[...St(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":St()}],filter:[{filter:["","none"]}],blur:[{blur:[r]}],brightness:[{brightness:[i]}],contrast:[{contrast:[w]}],"drop-shadow":[{"drop-shadow":["","none",ed,Dn]}],grayscale:[{grayscale:[T]}],"hue-rotate":[{"hue-rotate":[I]}],invert:[{invert:[C]}],saturate:[{saturate:[Z]}],sepia:[{sepia:[ne]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[r]}],"backdrop-brightness":[{"backdrop-brightness":[i]}],"backdrop-contrast":[{"backdrop-contrast":[w]}],"backdrop-grayscale":[{"backdrop-grayscale":[T]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[I]}],"backdrop-invert":[{"backdrop-invert":[C]}],"backdrop-opacity":[{"backdrop-opacity":[X]}],"backdrop-saturate":[{"backdrop-saturate":[Z]}],"backdrop-sepia":[{"backdrop-sepia":[ne]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[g]}],"border-spacing-x":[{"border-spacing-x":[g]}],"border-spacing-y":[{"border-spacing-y":[g]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Dn]}],duration:[{duration:At()}],ease:[{ease:["linear","in","out","in-out",Dn]}],delay:[{delay:At()}],animate:[{animate:["none","spin","ping","pulse","bounce",Dn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[J]}],"scale-x":[{"scale-x":[J]}],"scale-y":[{"scale-y":[J]}],rotate:[{rotate:[I0,Dn]}],"translate-x":[{"translate-x":[Se]}],"translate-y":[{"translate-y":[Se]}],"skew-x":[{"skew-x":[he]}],"skew-y":[{"skew-y":[he]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Dn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Dn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ke()}],"scroll-mx":[{"scroll-mx":Ke()}],"scroll-my":[{"scroll-my":Ke()}],"scroll-ms":[{"scroll-ms":Ke()}],"scroll-me":[{"scroll-me":Ke()}],"scroll-mt":[{"scroll-mt":Ke()}],"scroll-mr":[{"scroll-mr":Ke()}],"scroll-mb":[{"scroll-mb":Ke()}],"scroll-ml":[{"scroll-ml":Ke()}],"scroll-p":[{"scroll-p":Ke()}],"scroll-px":[{"scroll-px":Ke()}],"scroll-py":[{"scroll-py":Ke()}],"scroll-ps":[{"scroll-ps":Ke()}],"scroll-pe":[{"scroll-pe":Ke()}],"scroll-pt":[{"scroll-pt":Ke()}],"scroll-pr":[{"scroll-pr":Ke()}],"scroll-pb":[{"scroll-pb":Ke()}],"scroll-pl":[{"scroll-pl":Ke()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Dn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Ou,Qh,aI]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Une=Sne($ne);function zn(...e){return Une(Gn(e))}const Vne=Gre,xG=Q.forwardRef(({className:e,...t},r)=>z.jsx(eG,{ref:r,className:zn("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...t}));xG.displayName=eG.displayName;const Gne=j1("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),bG=Q.forwardRef(({className:e,variant:t,...r},i)=>z.jsx(tG,{ref:i,className:zn(Gne({variant:t}),e),...r}));bG.displayName=tG.displayName;const Hne=Q.forwardRef(({className:e,...t},r)=>z.jsx(iG,{ref:r,className:zn("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...t}));Hne.displayName=iG.displayName;const wG=Q.forwardRef(({className:e,...t},r)=>z.jsx(oG,{ref:r,className:zn("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...t,children:z.jsx(pG,{className:"h-4 w-4"})}));wG.displayName=oG.displayName;const SG=Q.forwardRef(({className:e,...t},r)=>z.jsx(rG,{ref:r,className:zn("text-sm font-semibold",e),...t}));SG.displayName=rG.displayName;const TG=Q.forwardRef(({className:e,...t},r)=>z.jsx(nG,{ref:r,className:zn("text-sm opacity-90",e),...t}));TG.displayName=nG.displayName;function Wne(){const{toasts:e}=Wd();return z.jsxs(Vne,{children:[e.map(function({id:t,title:r,description:i,action:c,...d}){return z.jsxs(bG,{...d,children:[z.jsxs("div",{className:"grid gap-1",children:[r&&z.jsx(SG,{children:r}),i&&z.jsx(TG,{children:i})]}),c,z.jsx(wG,{})]},t)}),z.jsx(xG,{})]})}var dB=["light","dark"],qne="(prefers-color-scheme: dark)",Zne=Q.createContext(void 0),Xne={setTheme:e=>{},themes:[]},Kne=()=>{var e;return(e=Q.useContext(Zne))!=null?e:Xne};Q.memo(({forcedTheme:e,storageKey:t,attribute:r,enableSystem:i,enableColorScheme:c,defaultTheme:d,value:g,attrs:o,nonce:w})=>{let T=d==="system",I=r==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(G=>`'${G}'`).join(",")})`};`:`var d=document.documentElement,n='${r}',s='setAttribute';`,C=c?dB.includes(d)&&d?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${d}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",R=(G,j=!1,H=!0)=>{let X=g?g[G]:G,q=j?G+"|| ''":`'${X}'`,Z="";return c&&H&&!j&&dB.includes(G)&&(Z+=`d.style.colorScheme = '${G}';`),r==="class"?j||X?Z+=`c.add(${q})`:Z+="null":X&&(Z+=`d[s](n,${q})`),Z},F=e?`!function(){${I}${R(e)}}()`:i?`!function(){try{${I}var e=localStorage.getItem('${t}');if('system'===e||(!e&&${T})){var t='${qne}',m=window.matchMedia(t);if(m.media!==t||m.matches){${R("dark")}}else{${R("light")}}}else if(e){${g?`var x=${JSON.stringify(g)};`:""}${R(g?"x[e]":"e",!0)}}${T?"":"else{"+R(d,!1,!1)+"}"}${C}}catch(e){}}()`:`!function(){try{${I}var e=localStorage.getItem('${t}');if(e){${g?`var x=${JSON.stringify(g)};`:""}${R(g?"x[e]":"e",!0)}}else{${R(d,!1,!1)};}${C}}catch(t){}}();`;return Q.createElement("script",{nonce:w,dangerouslySetInnerHTML:{__html:F}})});var Yne=e=>{switch(e){case"success":return eie;case"info":return rie;case"warning":return tie;case"error":return nie;default:return null}},Jne=Array(12).fill(0),Qne=({visible:e})=>De.createElement("div",{className:"sonner-loading-wrapper","data-visible":e},De.createElement("div",{className:"sonner-spinner"},Jne.map((t,r)=>De.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),eie=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),tie=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),rie=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),nie=De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},De.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),iie=()=>{let[e,t]=De.useState(document.hidden);return De.useEffect(()=>{let r=()=>{t(document.hidden)};return document.addEventListener("visibilitychange",r),()=>window.removeEventListener("visibilitychange",r)},[]),e},JO=1,oie=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;let{message:r,...i}=e,c=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:JO++,d=this.toasts.find(o=>o.id===c),g=e.dismissible===void 0?!0:e.dismissible;return d?this.toasts=this.toasts.map(o=>o.id===c?(this.publish({...o,...e,id:c,title:r}),{...o,...e,id:c,dismissible:g,title:r}):o):this.addToast({title:r,...i,dismissible:g,id:c}),c},this.dismiss=e=>(e||this.toasts.forEach(t=>{this.subscribers.forEach(r=>r({id:t.id,dismiss:!0}))}),this.subscribers.forEach(t=>t({id:e,dismiss:!0})),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let r;t.loading!==void 0&&(r=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));let i=e instanceof Promise?e:e(),c=r!==void 0;return i.then(async d=>{if(aie(d)&&!d.ok){c=!1;let g=typeof t.error=="function"?await t.error(`HTTP error! status: ${d.status}`):t.error,o=typeof t.description=="function"?await t.description(`HTTP error! status: ${d.status}`):t.description;this.create({id:r,type:"error",message:g,description:o})}else if(t.success!==void 0){c=!1;let g=typeof t.success=="function"?await t.success(d):t.success,o=typeof t.description=="function"?await t.description(d):t.description;this.create({id:r,type:"success",message:g,description:o})}}).catch(async d=>{if(t.error!==void 0){c=!1;let g=typeof t.error=="function"?await t.error(d):t.error,o=typeof t.description=="function"?await t.description(d):t.description;this.create({id:r,type:"error",message:g,description:o})}}).finally(()=>{var d;c&&(this.dismiss(r),r=void 0),(d=t.finally)==null||d.call(t)}),r},this.custom=(e,t)=>{let r=(t==null?void 0:t.id)||JO++;return this.create({jsx:e(r),id:r,...t}),r},this.subscribers=[],this.toasts=[]}},Da=new oie,sie=(e,t)=>{let r=(t==null?void 0:t.id)||JO++;return Da.addToast({title:e,...t,id:r}),r},aie=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",lie=sie,cie=()=>Da.toasts;Object.assign(lie,{success:Da.success,info:Da.info,warning:Da.warning,error:Da.error,custom:Da.custom,message:Da.message,promise:Da.promise,dismiss:Da.dismiss,loading:Da.loading},{getHistory:cie});function uie(e,{insertAt:t}={}){if(typeof document>"u")return;let r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",t==="top"&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}uie(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999}:where([data-sonner-toaster][data-x-position="right"]){right:max(var(--offset),env(safe-area-inset-right))}:where([data-sonner-toaster][data-x-position="left"]){left:max(var(--offset),env(safe-area-inset-left))}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:max(var(--offset),env(safe-area-inset-top))}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:max(var(--offset),env(safe-area-inset-bottom))}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;background:var(--gray1);color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:0;right:0;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount, 0px));transition:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation:swipe-out .2s ease-out forwards}@keyframes swipe-out{0%{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount)));opacity:1}to{transform:translateY(calc(var(--lift) * var(--offset) + var(--swipe-amount) + var(--lift) * -100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;--mobile-offset: 16px;right:var(--mobile-offset);left:var(--mobile-offset);width:100%}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset)}[data-sonner-toaster][data-y-position=bottom]{bottom:20px}[data-sonner-toaster][data-y-position=top]{top:20px}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset);right:var(--mobile-offset);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function yS(e){return e.label!==void 0}var hie=3,die="32px",fie=4e3,pie=356,mie=14,gie=20,_ie=200;function yie(...e){return e.filter(Boolean).join(" ")}var vie=e=>{var t,r,i,c,d,g,o,w,T,I;let{invert:C,toast:R,unstyled:F,interacting:G,setHeights:j,visibleToasts:H,heights:X,index:q,toasts:Z,expanded:J,removeToast:ne,defaultRichColors:he,closeButton:me,style:Se,cancelButtonStyle:qe,actionButtonStyle:Ze,className:He="",descriptionClassName:Ke="",duration:dt,position:$e,gap:mt,loadingIcon:ct,expandByDefault:St,classNames:Ue,icons:st,closeButtonAriaLabel:bt="Close toast",pauseWhenPageIsHidden:At,cn:zt}=e,[or,Mr]=De.useState(!1),[Ar,vr]=De.useState(!1),[nr,Xr]=De.useState(!1),[Lt,ur]=De.useState(!1),[_r,Mt]=De.useState(0),[Nr,Yr]=De.useState(0),Hn=De.useRef(null),en=De.useRef(null),Ei=q===0,xo=q+1<=H,On=R.type,Ai=R.dismissible!==!1,Io=R.className||"",vs=R.descriptionClassName||"",Zo=De.useMemo(()=>X.findIndex(wr=>wr.toastId===R.id)||0,[X,R.id]),ao=De.useMemo(()=>{var wr;return(wr=R.closeButton)!=null?wr:me},[R.closeButton,me]),bl=De.useMemo(()=>R.duration||dt||fie,[R.duration,dt]),qa=De.useRef(0),lo=De.useRef(0),pc=De.useRef(0),Xo=De.useRef(null),[wl,bo]=$e.split("-"),ls=De.useMemo(()=>X.reduce((wr,oi,si)=>si>=Zo?wr:wr+oi.height,0),[X,Zo]),Za=iie(),Xa=R.invert||C,wa=On==="loading";lo.current=De.useMemo(()=>Zo*mt+ls,[Zo,ls]),De.useEffect(()=>{Mr(!0)},[]),De.useLayoutEffect(()=>{if(!or)return;let wr=en.current,oi=wr.style.height;wr.style.height="auto";let si=wr.getBoundingClientRect().height;wr.style.height=oi,Yr(si),j(Fi=>Fi.find(xs=>xs.toastId===R.id)?Fi.map(xs=>xs.toastId===R.id?{...xs,height:si}:xs):[{toastId:R.id,height:si,position:R.position},...Fi])},[or,R.title,R.description,j,R.id]);let zo=De.useCallback(()=>{vr(!0),Mt(lo.current),j(wr=>wr.filter(oi=>oi.toastId!==R.id)),setTimeout(()=>{ne(R)},_ie)},[R,ne,j,lo]);De.useEffect(()=>{if(R.promise&&On==="loading"||R.duration===1/0||R.type==="loading")return;let wr,oi=bl;return J||G||At&&Za?(()=>{if(pc.current<qa.current){let si=new Date().getTime()-qa.current;oi=oi-si}pc.current=new Date().getTime()})():oi!==1/0&&(qa.current=new Date().getTime(),wr=setTimeout(()=>{var si;(si=R.onAutoClose)==null||si.call(R,R),zo()},oi)),()=>clearTimeout(wr)},[J,G,St,R,bl,zo,R.promise,On,At,Za]),De.useEffect(()=>{let wr=en.current;if(wr){let oi=wr.getBoundingClientRect().height;return Yr(oi),j(si=>[{toastId:R.id,height:oi,position:R.position},...si]),()=>j(si=>si.filter(Fi=>Fi.toastId!==R.id))}},[j,R.id]),De.useEffect(()=>{R.delete&&zo()},[zo,R.delete]);function mc(){return st!=null&&st.loading?De.createElement("div",{className:"sonner-loader","data-visible":On==="loading"},st.loading):ct?De.createElement("div",{className:"sonner-loader","data-visible":On==="loading"},ct):De.createElement(Qne,{visible:On==="loading"})}return De.createElement("li",{"aria-live":R.important?"assertive":"polite","aria-atomic":"true",role:"status",tabIndex:0,ref:en,className:zt(He,Io,Ue==null?void 0:Ue.toast,(t=R==null?void 0:R.classNames)==null?void 0:t.toast,Ue==null?void 0:Ue.default,Ue==null?void 0:Ue[On],(r=R==null?void 0:R.classNames)==null?void 0:r[On]),"data-sonner-toast":"","data-rich-colors":(i=R.richColors)!=null?i:he,"data-styled":!(R.jsx||R.unstyled||F),"data-mounted":or,"data-promise":!!R.promise,"data-removed":Ar,"data-visible":xo,"data-y-position":wl,"data-x-position":bo,"data-index":q,"data-front":Ei,"data-swiping":nr,"data-dismissible":Ai,"data-type":On,"data-invert":Xa,"data-swipe-out":Lt,"data-expanded":!!(J||St&&or),style:{"--index":q,"--toasts-before":q,"--z-index":Z.length-q,"--offset":`${Ar?_r:lo.current}px`,"--initial-height":St?"auto":`${Nr}px`,...Se,...R.style},onPointerDown:wr=>{wa||!Ai||(Hn.current=new Date,Mt(lo.current),wr.target.setPointerCapture(wr.pointerId),wr.target.tagName!=="BUTTON"&&(Xr(!0),Xo.current={x:wr.clientX,y:wr.clientY}))},onPointerUp:()=>{var wr,oi,si,Fi;if(Lt||!Ai)return;Xo.current=null;let xs=Number(((wr=en.current)==null?void 0:wr.style.getPropertyValue("--swipe-amount").replace("px",""))||0),Sl=new Date().getTime()-((oi=Hn.current)==null?void 0:oi.getTime()),Tl=Math.abs(xs)/Sl;if(Math.abs(xs)>=gie||Tl>.11){Mt(lo.current),(si=R.onDismiss)==null||si.call(R,R),zo(),ur(!0);return}(Fi=en.current)==null||Fi.style.setProperty("--swipe-amount","0px"),Xr(!1)},onPointerMove:wr=>{var oi;if(!Xo.current||!Ai)return;let si=wr.clientY-Xo.current.y,Fi=wr.clientX-Xo.current.x,xs=(wl==="top"?Math.min:Math.max)(0,si),Sl=wr.pointerType==="touch"?10:2;Math.abs(xs)>Sl?(oi=en.current)==null||oi.style.setProperty("--swipe-amount",`${si}px`):Math.abs(Fi)>Sl&&(Xo.current=null)}},ao&&!R.jsx?De.createElement("button",{"aria-label":bt,"data-disabled":wa,"data-close-button":!0,onClick:wa||!Ai?()=>{}:()=>{var wr;zo(),(wr=R.onDismiss)==null||wr.call(R,R)},className:zt(Ue==null?void 0:Ue.closeButton,(c=R==null?void 0:R.classNames)==null?void 0:c.closeButton)},De.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},De.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),De.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))):null,R.jsx||De.isValidElement(R.title)?R.jsx||R.title:De.createElement(De.Fragment,null,On||R.icon||R.promise?De.createElement("div",{"data-icon":"",className:zt(Ue==null?void 0:Ue.icon,(d=R==null?void 0:R.classNames)==null?void 0:d.icon)},R.promise||R.type==="loading"&&!R.icon?R.icon||mc():null,R.type!=="loading"?R.icon||(st==null?void 0:st[On])||Yne(On):null):null,De.createElement("div",{"data-content":"",className:zt(Ue==null?void 0:Ue.content,(g=R==null?void 0:R.classNames)==null?void 0:g.content)},De.createElement("div",{"data-title":"",className:zt(Ue==null?void 0:Ue.title,(o=R==null?void 0:R.classNames)==null?void 0:o.title)},R.title),R.description?De.createElement("div",{"data-description":"",className:zt(Ke,vs,Ue==null?void 0:Ue.description,(w=R==null?void 0:R.classNames)==null?void 0:w.description)},R.description):null),De.isValidElement(R.cancel)?R.cancel:R.cancel&&yS(R.cancel)?De.createElement("button",{"data-button":!0,"data-cancel":!0,style:R.cancelButtonStyle||qe,onClick:wr=>{var oi,si;yS(R.cancel)&&Ai&&((si=(oi=R.cancel).onClick)==null||si.call(oi,wr),zo())},className:zt(Ue==null?void 0:Ue.cancelButton,(T=R==null?void 0:R.classNames)==null?void 0:T.cancelButton)},R.cancel.label):null,De.isValidElement(R.action)?R.action:R.action&&yS(R.action)?De.createElement("button",{"data-button":!0,"data-action":!0,style:R.actionButtonStyle||Ze,onClick:wr=>{var oi,si;yS(R.action)&&(wr.defaultPrevented||((si=(oi=R.action).onClick)==null||si.call(oi,wr),zo()))},className:zt(Ue==null?void 0:Ue.actionButton,(I=R==null?void 0:R.classNames)==null?void 0:I.actionButton)},R.action.label):null))};function fB(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}var xie=e=>{let{invert:t,position:r="bottom-right",hotkey:i=["altKey","KeyT"],expand:c,closeButton:d,className:g,offset:o,theme:w="light",richColors:T,duration:I,style:C,visibleToasts:R=hie,toastOptions:F,dir:G=fB(),gap:j=mie,loadingIcon:H,icons:X,containerAriaLabel:q="Notifications",pauseWhenPageIsHidden:Z,cn:J=yie}=e,[ne,he]=De.useState([]),me=De.useMemo(()=>Array.from(new Set([r].concat(ne.filter(At=>At.position).map(At=>At.position)))),[ne,r]),[Se,qe]=De.useState([]),[Ze,He]=De.useState(!1),[Ke,dt]=De.useState(!1),[$e,mt]=De.useState(w!=="system"?w:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),ct=De.useRef(null),St=i.join("+").replace(/Key/g,"").replace(/Digit/g,""),Ue=De.useRef(null),st=De.useRef(!1),bt=De.useCallback(At=>{var zt;(zt=ne.find(or=>or.id===At.id))!=null&&zt.delete||Da.dismiss(At.id),he(or=>or.filter(({id:Mr})=>Mr!==At.id))},[ne]);return De.useEffect(()=>Da.subscribe(At=>{if(At.dismiss){he(zt=>zt.map(or=>or.id===At.id?{...or,delete:!0}:or));return}setTimeout(()=>{L8.flushSync(()=>{he(zt=>{let or=zt.findIndex(Mr=>Mr.id===At.id);return or!==-1?[...zt.slice(0,or),{...zt[or],...At},...zt.slice(or+1)]:[At,...zt]})})})}),[]),De.useEffect(()=>{if(w!=="system"){mt(w);return}w==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?mt("dark"):mt("light")),typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:At})=>{mt(At?"dark":"light")})},[w]),De.useEffect(()=>{ne.length<=1&&He(!1)},[ne]),De.useEffect(()=>{let At=zt=>{var or,Mr;i.every(Ar=>zt[Ar]||zt.code===Ar)&&(He(!0),(or=ct.current)==null||or.focus()),zt.code==="Escape"&&(document.activeElement===ct.current||(Mr=ct.current)!=null&&Mr.contains(document.activeElement))&&He(!1)};return document.addEventListener("keydown",At),()=>document.removeEventListener("keydown",At)},[i]),De.useEffect(()=>{if(ct.current)return()=>{Ue.current&&(Ue.current.focus({preventScroll:!0}),Ue.current=null,st.current=!1)}},[ct.current]),ne.length?De.createElement("section",{"aria-label":`${q} ${St}`,tabIndex:-1},me.map((At,zt)=>{var or;let[Mr,Ar]=At.split("-");return De.createElement("ol",{key:At,dir:G==="auto"?fB():G,tabIndex:-1,ref:ct,className:g,"data-sonner-toaster":!0,"data-theme":$e,"data-y-position":Mr,"data-x-position":Ar,style:{"--front-toast-height":`${((or=Se[0])==null?void 0:or.height)||0}px`,"--offset":typeof o=="number"?`${o}px`:o||die,"--width":`${pie}px`,"--gap":`${j}px`,...C},onBlur:vr=>{st.current&&!vr.currentTarget.contains(vr.relatedTarget)&&(st.current=!1,Ue.current&&(Ue.current.focus({preventScroll:!0}),Ue.current=null))},onFocus:vr=>{vr.target instanceof HTMLElement&&vr.target.dataset.dismissible==="false"||st.current||(st.current=!0,Ue.current=vr.relatedTarget)},onMouseEnter:()=>He(!0),onMouseMove:()=>He(!0),onMouseLeave:()=>{Ke||He(!1)},onPointerDown:vr=>{vr.target instanceof HTMLElement&&vr.target.dataset.dismissible==="false"||dt(!0)},onPointerUp:()=>dt(!1)},ne.filter(vr=>!vr.position&&zt===0||vr.position===At).map((vr,nr)=>{var Xr,Lt;return De.createElement(vie,{key:vr.id,icons:X,index:nr,toast:vr,defaultRichColors:T,duration:(Xr=F==null?void 0:F.duration)!=null?Xr:I,className:F==null?void 0:F.className,descriptionClassName:F==null?void 0:F.descriptionClassName,invert:t,visibleToasts:R,closeButton:(Lt=F==null?void 0:F.closeButton)!=null?Lt:d,interacting:Ke,position:At,style:F==null?void 0:F.style,unstyled:F==null?void 0:F.unstyled,classNames:F==null?void 0:F.classNames,cancelButtonStyle:F==null?void 0:F.cancelButtonStyle,actionButtonStyle:F==null?void 0:F.actionButtonStyle,removeToast:bt,toasts:ne.filter(ur=>ur.position==vr.position),heights:Se.filter(ur=>ur.position==vr.position),setHeights:qe,expandByDefault:c,gap:j,loadingIcon:H,expanded:Ze,pauseWhenPageIsHidden:Z,cn:J})}))})):null};const bie=({...e})=>{const{theme:t="system"}=Kne();return z.jsx(xie,{theme:t,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})};var wie=RV.useId||(()=>{}),Sie=0;function Kc(e){const[t,r]=Q.useState(wie());return Fs(()=>{r(i=>i??String(Sie++))},[e]),t?`radix-${t}`:""}const Tie=["top","right","bottom","left"],Fd=Math.min,Na=Math.max,kT=Math.round,vS=Math.floor,Bd=e=>({x:e,y:e}),Eie={left:"right",right:"left",bottom:"top",top:"bottom"},Aie={start:"end",end:"start"};function QO(e,t,r){return Na(e,Fd(t,r))}function Yu(e,t){return typeof e=="function"?e(t):e}function Ju(e){return e.split("-")[0]}function fy(e){return e.split("-")[1]}function tD(e){return e==="x"?"y":"x"}function rD(e){return e==="y"?"height":"width"}function $d(e){return["top","bottom"].includes(Ju(e))?"y":"x"}function nD(e){return tD($d(e))}function Pie(e,t,r){r===void 0&&(r=!1);const i=fy(e),c=nD(e),d=rD(c);let g=c==="x"?i===(r?"end":"start")?"right":"left":i==="start"?"bottom":"top";return t.reference[d]>t.floating[d]&&(g=DT(g)),[g,DT(g)]}function Cie(e){const t=DT(e);return[eM(e),t,eM(t)]}function eM(e){return e.replace(/start|end/g,t=>Aie[t])}function Iie(e,t,r){const i=["left","right"],c=["right","left"],d=["top","bottom"],g=["bottom","top"];switch(e){case"top":case"bottom":return r?t?c:i:t?i:c;case"left":case"right":return t?d:g;default:return[]}}function Oie(e,t,r,i){const c=fy(e);let d=Iie(Ju(e),r==="start",i);return c&&(d=d.map(g=>g+"-"+c),t&&(d=d.concat(d.map(eM)))),d}function DT(e){return e.replace(/left|right|bottom|top/g,t=>Eie[t])}function Mie(e){return{top:0,right:0,bottom:0,left:0,...e}}function EG(e){return typeof e!="number"?Mie(e):{top:e,right:e,bottom:e,left:e}}function LT(e){const{x:t,y:r,width:i,height:c}=e;return{width:i,height:c,top:r,left:t,right:t+i,bottom:r+c,x:t,y:r}}function pB(e,t,r){let{reference:i,floating:c}=e;const d=$d(t),g=nD(t),o=rD(g),w=Ju(t),T=d==="y",I=i.x+i.width/2-c.width/2,C=i.y+i.height/2-c.height/2,R=i[o]/2-c[o]/2;let F;switch(w){case"top":F={x:I,y:i.y-c.height};break;case"bottom":F={x:I,y:i.y+i.height};break;case"right":F={x:i.x+i.width,y:C};break;case"left":F={x:i.x-c.width,y:C};break;default:F={x:i.x,y:i.y}}switch(fy(t)){case"start":F[g]-=R*(r&&T?-1:1);break;case"end":F[g]+=R*(r&&T?-1:1);break}return F}const Rie=async(e,t,r)=>{const{placement:i="bottom",strategy:c="absolute",middleware:d=[],platform:g}=r,o=d.filter(Boolean),w=await(g.isRTL==null?void 0:g.isRTL(t));let T=await g.getElementRects({reference:e,floating:t,strategy:c}),{x:I,y:C}=pB(T,i,w),R=i,F={},G=0;for(let j=0;j<o.length;j++){const{name:H,fn:X}=o[j],{x:q,y:Z,data:J,reset:ne}=await X({x:I,y:C,initialPlacement:i,placement:R,strategy:c,middlewareData:F,rects:T,platform:g,elements:{reference:e,floating:t}});I=q??I,C=Z??C,F={...F,[H]:{...F[H],...J}},ne&&G<=50&&(G++,typeof ne=="object"&&(ne.placement&&(R=ne.placement),ne.rects&&(T=ne.rects===!0?await g.getElementRects({reference:e,floating:t,strategy:c}):ne.rects),{x:I,y:C}=pB(T,R,w)),j=-1)}return{x:I,y:C,placement:R,strategy:c,middlewareData:F}};async function Nx(e,t){var r;t===void 0&&(t={});const{x:i,y:c,platform:d,rects:g,elements:o,strategy:w}=e,{boundary:T="clippingAncestors",rootBoundary:I="viewport",elementContext:C="floating",altBoundary:R=!1,padding:F=0}=Yu(t,e),G=EG(F),H=o[R?C==="floating"?"reference":"floating":C],X=LT(await d.getClippingRect({element:(r=await(d.isElement==null?void 0:d.isElement(H)))==null||r?H:H.contextElement||await(d.getDocumentElement==null?void 0:d.getDocumentElement(o.floating)),boundary:T,rootBoundary:I,strategy:w})),q=C==="floating"?{x:i,y:c,width:g.floating.width,height:g.floating.height}:g.reference,Z=await(d.getOffsetParent==null?void 0:d.getOffsetParent(o.floating)),J=await(d.isElement==null?void 0:d.isElement(Z))?await(d.getScale==null?void 0:d.getScale(Z))||{x:1,y:1}:{x:1,y:1},ne=LT(d.convertOffsetParentRelativeRectToViewportRelativeRect?await d.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:q,offsetParent:Z,strategy:w}):q);return{top:(X.top-ne.top+G.top)/J.y,bottom:(ne.bottom-X.bottom+G.bottom)/J.y,left:(X.left-ne.left+G.left)/J.x,right:(ne.right-X.right+G.right)/J.x}}const kie=e=>({name:"arrow",options:e,async fn(t){const{x:r,y:i,placement:c,rects:d,platform:g,elements:o,middlewareData:w}=t,{element:T,padding:I=0}=Yu(e,t)||{};if(T==null)return{};const C=EG(I),R={x:r,y:i},F=nD(c),G=rD(F),j=await g.getDimensions(T),H=F==="y",X=H?"top":"left",q=H?"bottom":"right",Z=H?"clientHeight":"clientWidth",J=d.reference[G]+d.reference[F]-R[F]-d.floating[G],ne=R[F]-d.reference[F],he=await(g.getOffsetParent==null?void 0:g.getOffsetParent(T));let me=he?he[Z]:0;(!me||!await(g.isElement==null?void 0:g.isElement(he)))&&(me=o.floating[Z]||d.floating[G]);const Se=J/2-ne/2,qe=me/2-j[G]/2-1,Ze=Fd(C[X],qe),He=Fd(C[q],qe),Ke=Ze,dt=me-j[G]-He,$e=me/2-j[G]/2+Se,mt=QO(Ke,$e,dt),ct=!w.arrow&&fy(c)!=null&&$e!==mt&&d.reference[G]/2-($e<Ke?Ze:He)-j[G]/2<0,St=ct?$e<Ke?$e-Ke:$e-dt:0;return{[F]:R[F]+St,data:{[F]:mt,centerOffset:$e-mt-St,...ct&&{alignmentOffset:St}},reset:ct}}}),Die=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var r,i;const{placement:c,middlewareData:d,rects:g,initialPlacement:o,platform:w,elements:T}=t,{mainAxis:I=!0,crossAxis:C=!0,fallbackPlacements:R,fallbackStrategy:F="bestFit",fallbackAxisSideDirection:G="none",flipAlignment:j=!0,...H}=Yu(e,t);if((r=d.arrow)!=null&&r.alignmentOffset)return{};const X=Ju(c),q=$d(o),Z=Ju(o)===o,J=await(w.isRTL==null?void 0:w.isRTL(T.floating)),ne=R||(Z||!j?[DT(o)]:Cie(o)),he=G!=="none";!R&&he&&ne.push(...Oie(o,j,G,J));const me=[o,...ne],Se=await Nx(t,H),qe=[];let Ze=((i=d.flip)==null?void 0:i.overflows)||[];if(I&&qe.push(Se[X]),C){const $e=Pie(c,g,J);qe.push(Se[$e[0]],Se[$e[1]])}if(Ze=[...Ze,{placement:c,overflows:qe}],!qe.every($e=>$e<=0)){var He,Ke;const $e=(((He=d.flip)==null?void 0:He.index)||0)+1,mt=me[$e];if(mt)return{data:{index:$e,overflows:Ze},reset:{placement:mt}};let ct=(Ke=Ze.filter(St=>St.overflows[0]<=0).sort((St,Ue)=>St.overflows[1]-Ue.overflows[1])[0])==null?void 0:Ke.placement;if(!ct)switch(F){case"bestFit":{var dt;const St=(dt=Ze.filter(Ue=>{if(he){const st=$d(Ue.placement);return st===q||st==="y"}return!0}).map(Ue=>[Ue.placement,Ue.overflows.filter(st=>st>0).reduce((st,bt)=>st+bt,0)]).sort((Ue,st)=>Ue[1]-st[1])[0])==null?void 0:dt[0];St&&(ct=St);break}case"initialPlacement":ct=o;break}if(c!==ct)return{reset:{placement:ct}}}return{}}}};function mB(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function gB(e){return Tie.some(t=>e[t]>=0)}const Lie=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:r}=t,{strategy:i="referenceHidden",...c}=Yu(e,t);switch(i){case"referenceHidden":{const d=await Nx(t,{...c,elementContext:"reference"}),g=mB(d,r.reference);return{data:{referenceHiddenOffsets:g,referenceHidden:gB(g)}}}case"escaped":{const d=await Nx(t,{...c,altBoundary:!0}),g=mB(d,r.floating);return{data:{escapedOffsets:g,escaped:gB(g)}}}default:return{}}}}};async function zie(e,t){const{placement:r,platform:i,elements:c}=e,d=await(i.isRTL==null?void 0:i.isRTL(c.floating)),g=Ju(r),o=fy(r),w=$d(r)==="y",T=["left","top"].includes(g)?-1:1,I=d&&w?-1:1,C=Yu(t,e);let{mainAxis:R,crossAxis:F,alignmentAxis:G}=typeof C=="number"?{mainAxis:C,crossAxis:0,alignmentAxis:null}:{mainAxis:C.mainAxis||0,crossAxis:C.crossAxis||0,alignmentAxis:C.alignmentAxis};return o&&typeof G=="number"&&(F=o==="end"?G*-1:G),w?{x:F*I,y:R*T}:{x:R*T,y:F*I}}const Nie=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){var r,i;const{x:c,y:d,placement:g,middlewareData:o}=t,w=await zie(t,e);return g===((r=o.offset)==null?void 0:r.placement)&&(i=o.arrow)!=null&&i.alignmentOffset?{}:{x:c+w.x,y:d+w.y,data:{...w,placement:g}}}}},jie=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:r,y:i,placement:c}=t,{mainAxis:d=!0,crossAxis:g=!1,limiter:o={fn:H=>{let{x:X,y:q}=H;return{x:X,y:q}}},...w}=Yu(e,t),T={x:r,y:i},I=await Nx(t,w),C=$d(Ju(c)),R=tD(C);let F=T[R],G=T[C];if(d){const H=R==="y"?"top":"left",X=R==="y"?"bottom":"right",q=F+I[H],Z=F-I[X];F=QO(q,F,Z)}if(g){const H=C==="y"?"top":"left",X=C==="y"?"bottom":"right",q=G+I[H],Z=G-I[X];G=QO(q,G,Z)}const j=o.fn({...t,[R]:F,[C]:G});return{...j,data:{x:j.x-r,y:j.y-i,enabled:{[R]:d,[C]:g}}}}}},Fie=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:r,y:i,placement:c,rects:d,middlewareData:g}=t,{offset:o=0,mainAxis:w=!0,crossAxis:T=!0}=Yu(e,t),I={x:r,y:i},C=$d(c),R=tD(C);let F=I[R],G=I[C];const j=Yu(o,t),H=typeof j=="number"?{mainAxis:j,crossAxis:0}:{mainAxis:0,crossAxis:0,...j};if(w){const Z=R==="y"?"height":"width",J=d.reference[R]-d.floating[Z]+H.mainAxis,ne=d.reference[R]+d.reference[Z]-H.mainAxis;F<J?F=J:F>ne&&(F=ne)}if(T){var X,q;const Z=R==="y"?"width":"height",J=["top","left"].includes(Ju(c)),ne=d.reference[C]-d.floating[Z]+(J&&((X=g.offset)==null?void 0:X[C])||0)+(J?0:H.crossAxis),he=d.reference[C]+d.reference[Z]+(J?0:((q=g.offset)==null?void 0:q[C])||0)-(J?H.crossAxis:0);G<ne?G=ne:G>he&&(G=he)}return{[R]:F,[C]:G}}}},Bie=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){var r,i;const{placement:c,rects:d,platform:g,elements:o}=t,{apply:w=()=>{},...T}=Yu(e,t),I=await Nx(t,T),C=Ju(c),R=fy(c),F=$d(c)==="y",{width:G,height:j}=d.floating;let H,X;C==="top"||C==="bottom"?(H=C,X=R===(await(g.isRTL==null?void 0:g.isRTL(o.floating))?"start":"end")?"left":"right"):(X=C,H=R==="end"?"top":"bottom");const q=j-I.top-I.bottom,Z=G-I.left-I.right,J=Fd(j-I[H],q),ne=Fd(G-I[X],Z),he=!t.middlewareData.shift;let me=J,Se=ne;if((r=t.middlewareData.shift)!=null&&r.enabled.x&&(Se=Z),(i=t.middlewareData.shift)!=null&&i.enabled.y&&(me=q),he&&!R){const Ze=Na(I.left,0),He=Na(I.right,0),Ke=Na(I.top,0),dt=Na(I.bottom,0);F?Se=G-2*(Ze!==0||He!==0?Ze+He:Na(I.left,I.right)):me=j-2*(Ke!==0||dt!==0?Ke+dt:Na(I.top,I.bottom))}await w({...t,availableWidth:Se,availableHeight:me});const qe=await g.getDimensions(o.floating);return G!==qe.width||j!==qe.height?{reset:{rects:!0}}:{}}}};function u2(){return typeof window<"u"}function py(e){return AG(e)?(e.nodeName||"").toLowerCase():"#document"}function Ua(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function tu(e){var t;return(t=(AG(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function AG(e){return u2()?e instanceof Node||e instanceof Ua(e).Node:!1}function cc(e){return u2()?e instanceof Element||e instanceof Ua(e).Element:!1}function Qc(e){return u2()?e instanceof HTMLElement||e instanceof Ua(e).HTMLElement:!1}function _B(e){return!u2()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Ua(e).ShadowRoot}function F1(e){const{overflow:t,overflowX:r,overflowY:i,display:c}=uc(e);return/auto|scroll|overlay|hidden|clip/.test(t+i+r)&&!["inline","contents"].includes(c)}function $ie(e){return["table","td","th"].includes(py(e))}function h2(e){return[":popover-open",":modal"].some(t=>{try{return e.matches(t)}catch{return!1}})}function iD(e){const t=oD(),r=cc(e)?uc(e):e;return r.transform!=="none"||r.perspective!=="none"||(r.containerType?r.containerType!=="normal":!1)||!t&&(r.backdropFilter?r.backdropFilter!=="none":!1)||!t&&(r.filter?r.filter!=="none":!1)||["transform","perspective","filter"].some(i=>(r.willChange||"").includes(i))||["paint","layout","strict","content"].some(i=>(r.contain||"").includes(i))}function Uie(e){let t=Ud(e);for(;Qc(t)&&!L_(t);){if(iD(t))return t;if(h2(t))return null;t=Ud(t)}return null}function oD(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function L_(e){return["html","body","#document"].includes(py(e))}function uc(e){return Ua(e).getComputedStyle(e)}function d2(e){return cc(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Ud(e){if(py(e)==="html")return e;const t=e.assignedSlot||e.parentNode||_B(e)&&e.host||tu(e);return _B(t)?t.host:t}function PG(e){const t=Ud(e);return L_(t)?e.ownerDocument?e.ownerDocument.body:e.body:Qc(t)&&F1(t)?t:PG(t)}function jx(e,t,r){var i;t===void 0&&(t=[]),r===void 0&&(r=!0);const c=PG(e),d=c===((i=e.ownerDocument)==null?void 0:i.body),g=Ua(c);if(d){const o=tM(g);return t.concat(g,g.visualViewport||[],F1(c)?c:[],o&&r?jx(o):[])}return t.concat(c,jx(c,[],r))}function tM(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function CG(e){const t=uc(e);let r=parseFloat(t.width)||0,i=parseFloat(t.height)||0;const c=Qc(e),d=c?e.offsetWidth:r,g=c?e.offsetHeight:i,o=kT(r)!==d||kT(i)!==g;return o&&(r=d,i=g),{width:r,height:i,$:o}}function sD(e){return cc(e)?e:e.contextElement}function h_(e){const t=sD(e);if(!Qc(t))return Bd(1);const r=t.getBoundingClientRect(),{width:i,height:c,$:d}=CG(t);let g=(d?kT(r.width):r.width)/i,o=(d?kT(r.height):r.height)/c;return(!g||!Number.isFinite(g))&&(g=1),(!o||!Number.isFinite(o))&&(o=1),{x:g,y:o}}const Vie=Bd(0);function IG(e){const t=Ua(e);return!oD()||!t.visualViewport?Vie:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function Gie(e,t,r){return t===void 0&&(t=!1),!r||t&&r!==Ua(e)?!1:t}function Wp(e,t,r,i){t===void 0&&(t=!1),r===void 0&&(r=!1);const c=e.getBoundingClientRect(),d=sD(e);let g=Bd(1);t&&(i?cc(i)&&(g=h_(i)):g=h_(e));const o=Gie(d,r,i)?IG(d):Bd(0);let w=(c.left+o.x)/g.x,T=(c.top+o.y)/g.y,I=c.width/g.x,C=c.height/g.y;if(d){const R=Ua(d),F=i&&cc(i)?Ua(i):i;let G=R,j=tM(G);for(;j&&i&&F!==G;){const H=h_(j),X=j.getBoundingClientRect(),q=uc(j),Z=X.left+(j.clientLeft+parseFloat(q.paddingLeft))*H.x,J=X.top+(j.clientTop+parseFloat(q.paddingTop))*H.y;w*=H.x,T*=H.y,I*=H.x,C*=H.y,w+=Z,T+=J,G=Ua(j),j=tM(G)}}return LT({width:I,height:C,x:w,y:T})}function Hie(e){let{elements:t,rect:r,offsetParent:i,strategy:c}=e;const d=c==="fixed",g=tu(i),o=t?h2(t.floating):!1;if(i===g||o&&d)return r;let w={scrollLeft:0,scrollTop:0},T=Bd(1);const I=Bd(0),C=Qc(i);if((C||!C&&!d)&&((py(i)!=="body"||F1(g))&&(w=d2(i)),Qc(i))){const R=Wp(i);T=h_(i),I.x=R.x+i.clientLeft,I.y=R.y+i.clientTop}return{width:r.width*T.x,height:r.height*T.y,x:r.x*T.x-w.scrollLeft*T.x+I.x,y:r.y*T.y-w.scrollTop*T.y+I.y}}function Wie(e){return Array.from(e.getClientRects())}function rM(e,t){const r=d2(e).scrollLeft;return t?t.left+r:Wp(tu(e)).left+r}function qie(e){const t=tu(e),r=d2(e),i=e.ownerDocument.body,c=Na(t.scrollWidth,t.clientWidth,i.scrollWidth,i.clientWidth),d=Na(t.scrollHeight,t.clientHeight,i.scrollHeight,i.clientHeight);let g=-r.scrollLeft+rM(e);const o=-r.scrollTop;return uc(i).direction==="rtl"&&(g+=Na(t.clientWidth,i.clientWidth)-c),{width:c,height:d,x:g,y:o}}function Zie(e,t){const r=Ua(e),i=tu(e),c=r.visualViewport;let d=i.clientWidth,g=i.clientHeight,o=0,w=0;if(c){d=c.width,g=c.height;const T=oD();(!T||T&&t==="fixed")&&(o=c.offsetLeft,w=c.offsetTop)}return{width:d,height:g,x:o,y:w}}function Xie(e,t){const r=Wp(e,!0,t==="fixed"),i=r.top+e.clientTop,c=r.left+e.clientLeft,d=Qc(e)?h_(e):Bd(1),g=e.clientWidth*d.x,o=e.clientHeight*d.y,w=c*d.x,T=i*d.y;return{width:g,height:o,x:w,y:T}}function yB(e,t,r){let i;if(t==="viewport")i=Zie(e,r);else if(t==="document")i=qie(tu(e));else if(cc(t))i=Xie(t,r);else{const c=IG(e);i={...t,x:t.x-c.x,y:t.y-c.y}}return LT(i)}function OG(e,t){const r=Ud(e);return r===t||!cc(r)||L_(r)?!1:uc(r).position==="fixed"||OG(r,t)}function Kie(e,t){const r=t.get(e);if(r)return r;let i=jx(e,[],!1).filter(o=>cc(o)&&py(o)!=="body"),c=null;const d=uc(e).position==="fixed";let g=d?Ud(e):e;for(;cc(g)&&!L_(g);){const o=uc(g),w=iD(g);!w&&o.position==="fixed"&&(c=null),(d?!w&&!c:!w&&o.position==="static"&&!!c&&["absolute","fixed"].includes(c.position)||F1(g)&&!w&&OG(e,g))?i=i.filter(I=>I!==g):c=o,g=Ud(g)}return t.set(e,i),i}function Yie(e){let{element:t,boundary:r,rootBoundary:i,strategy:c}=e;const g=[...r==="clippingAncestors"?h2(t)?[]:Kie(t,this._c):[].concat(r),i],o=g[0],w=g.reduce((T,I)=>{const C=yB(t,I,c);return T.top=Na(C.top,T.top),T.right=Fd(C.right,T.right),T.bottom=Fd(C.bottom,T.bottom),T.left=Na(C.left,T.left),T},yB(t,o,c));return{width:w.right-w.left,height:w.bottom-w.top,x:w.left,y:w.top}}function Jie(e){const{width:t,height:r}=CG(e);return{width:t,height:r}}function Qie(e,t,r){const i=Qc(t),c=tu(t),d=r==="fixed",g=Wp(e,!0,d,t);let o={scrollLeft:0,scrollTop:0};const w=Bd(0);if(i||!i&&!d)if((py(t)!=="body"||F1(c))&&(o=d2(t)),i){const F=Wp(t,!0,d,t);w.x=F.x+t.clientLeft,w.y=F.y+t.clientTop}else c&&(w.x=rM(c));let T=0,I=0;if(c&&!i&&!d){const F=c.getBoundingClientRect();I=F.top+o.scrollTop,T=F.left+o.scrollLeft-rM(c,F)}const C=g.left+o.scrollLeft-w.x-T,R=g.top+o.scrollTop-w.y-I;return{x:C,y:R,width:g.width,height:g.height}}function lI(e){return uc(e).position==="static"}function vB(e,t){if(!Qc(e)||uc(e).position==="fixed")return null;if(t)return t(e);let r=e.offsetParent;return tu(e)===r&&(r=r.ownerDocument.body),r}function MG(e,t){const r=Ua(e);if(h2(e))return r;if(!Qc(e)){let c=Ud(e);for(;c&&!L_(c);){if(cc(c)&&!lI(c))return c;c=Ud(c)}return r}let i=vB(e,t);for(;i&&$ie(i)&&lI(i);)i=vB(i,t);return i&&L_(i)&&lI(i)&&!iD(i)?r:i||Uie(e)||r}const eoe=async function(e){const t=this.getOffsetParent||MG,r=this.getDimensions,i=await r(e.floating);return{reference:Qie(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:i.width,height:i.height}}};function toe(e){return uc(e).direction==="rtl"}const roe={convertOffsetParentRelativeRectToViewportRelativeRect:Hie,getDocumentElement:tu,getClippingRect:Yie,getOffsetParent:MG,getElementRects:eoe,getClientRects:Wie,getDimensions:Jie,getScale:h_,isElement:cc,isRTL:toe};function noe(e,t){let r=null,i;const c=tu(e);function d(){var o;clearTimeout(i),(o=r)==null||o.disconnect(),r=null}function g(o,w){o===void 0&&(o=!1),w===void 0&&(w=1),d();const{left:T,top:I,width:C,height:R}=e.getBoundingClientRect();if(o||t(),!C||!R)return;const F=vS(I),G=vS(c.clientWidth-(T+C)),j=vS(c.clientHeight-(I+R)),H=vS(T),q={rootMargin:-F+"px "+-G+"px "+-j+"px "+-H+"px",threshold:Na(0,Fd(1,w))||1};let Z=!0;function J(ne){const he=ne[0].intersectionRatio;if(he!==w){if(!Z)return g();he?g(!1,he):i=setTimeout(()=>{g(!1,1e-7)},1e3)}Z=!1}try{r=new IntersectionObserver(J,{...q,root:c.ownerDocument})}catch{r=new IntersectionObserver(J,q)}r.observe(e)}return g(!0),d}function ioe(e,t,r,i){i===void 0&&(i={});const{ancestorScroll:c=!0,ancestorResize:d=!0,elementResize:g=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:w=!1}=i,T=sD(e),I=c||d?[...T?jx(T):[],...jx(t)]:[];I.forEach(X=>{c&&X.addEventListener("scroll",r,{passive:!0}),d&&X.addEventListener("resize",r)});const C=T&&o?noe(T,r):null;let R=-1,F=null;g&&(F=new ResizeObserver(X=>{let[q]=X;q&&q.target===T&&F&&(F.unobserve(t),cancelAnimationFrame(R),R=requestAnimationFrame(()=>{var Z;(Z=F)==null||Z.observe(t)})),r()}),T&&!w&&F.observe(T),F.observe(t));let G,j=w?Wp(e):null;w&&H();function H(){const X=Wp(e);j&&(X.x!==j.x||X.y!==j.y||X.width!==j.width||X.height!==j.height)&&r(),j=X,G=requestAnimationFrame(H)}return r(),()=>{var X;I.forEach(q=>{c&&q.removeEventListener("scroll",r),d&&q.removeEventListener("resize",r)}),C==null||C(),(X=F)==null||X.disconnect(),F=null,w&&cancelAnimationFrame(G)}}const ooe=Nie,soe=jie,aoe=Die,loe=Bie,coe=Lie,xB=kie,uoe=Fie,hoe=(e,t,r)=>{const i=new Map,c={platform:roe,...r},d={...c.platform,_c:i};return Rie(e,t,{...c,platform:d})};var iT=typeof document<"u"?Q.useLayoutEffect:Q.useEffect;function zT(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let r,i,c;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(r=e.length,r!==t.length)return!1;for(i=r;i--!==0;)if(!zT(e[i],t[i]))return!1;return!0}if(c=Object.keys(e),r=c.length,r!==Object.keys(t).length)return!1;for(i=r;i--!==0;)if(!{}.hasOwnProperty.call(t,c[i]))return!1;for(i=r;i--!==0;){const d=c[i];if(!(d==="_owner"&&e.$$typeof)&&!zT(e[d],t[d]))return!1}return!0}return e!==e&&t!==t}function RG(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function bB(e,t){const r=RG(e);return Math.round(t*r)/r}function cI(e){const t=Q.useRef(e);return iT(()=>{t.current=e}),t}function doe(e){e===void 0&&(e={});const{placement:t="bottom",strategy:r="absolute",middleware:i=[],platform:c,elements:{reference:d,floating:g}={},transform:o=!0,whileElementsMounted:w,open:T}=e,[I,C]=Q.useState({x:0,y:0,strategy:r,placement:t,middlewareData:{},isPositioned:!1}),[R,F]=Q.useState(i);zT(R,i)||F(i);const[G,j]=Q.useState(null),[H,X]=Q.useState(null),q=Q.useCallback(Ue=>{Ue!==he.current&&(he.current=Ue,j(Ue))},[]),Z=Q.useCallback(Ue=>{Ue!==me.current&&(me.current=Ue,X(Ue))},[]),J=d||G,ne=g||H,he=Q.useRef(null),me=Q.useRef(null),Se=Q.useRef(I),qe=w!=null,Ze=cI(w),He=cI(c),Ke=cI(T),dt=Q.useCallback(()=>{if(!he.current||!me.current)return;const Ue={placement:t,strategy:r,middleware:R};He.current&&(Ue.platform=He.current),hoe(he.current,me.current,Ue).then(st=>{const bt={...st,isPositioned:Ke.current!==!1};$e.current&&!zT(Se.current,bt)&&(Se.current=bt,rm.flushSync(()=>{C(bt)}))})},[R,t,r,He,Ke]);iT(()=>{T===!1&&Se.current.isPositioned&&(Se.current.isPositioned=!1,C(Ue=>({...Ue,isPositioned:!1})))},[T]);const $e=Q.useRef(!1);iT(()=>($e.current=!0,()=>{$e.current=!1}),[]),iT(()=>{if(J&&(he.current=J),ne&&(me.current=ne),J&&ne){if(Ze.current)return Ze.current(J,ne,dt);dt()}},[J,ne,dt,Ze,qe]);const mt=Q.useMemo(()=>({reference:he,floating:me,setReference:q,setFloating:Z}),[q,Z]),ct=Q.useMemo(()=>({reference:J,floating:ne}),[J,ne]),St=Q.useMemo(()=>{const Ue={position:r,left:0,top:0};if(!ct.floating)return Ue;const st=bB(ct.floating,I.x),bt=bB(ct.floating,I.y);return o?{...Ue,transform:"translate("+st+"px, "+bt+"px)",...RG(ct.floating)>=1.5&&{willChange:"transform"}}:{position:r,left:st,top:bt}},[r,o,ct.floating,I.x,I.y]);return Q.useMemo(()=>({...I,update:dt,refs:mt,elements:ct,floatingStyles:St}),[I,dt,mt,ct,St])}const foe=e=>{function t(r){return{}.hasOwnProperty.call(r,"current")}return{name:"arrow",options:e,fn(r){const{element:i,padding:c}=typeof e=="function"?e(r):e;return i&&t(i)?i.current!=null?xB({element:i.current,padding:c}).fn(r):{}:i?xB({element:i,padding:c}).fn(r):{}}}},poe=(e,t)=>({...ooe(e),options:[e,t]}),moe=(e,t)=>({...soe(e),options:[e,t]}),goe=(e,t)=>({...uoe(e),options:[e,t]}),_oe=(e,t)=>({...aoe(e),options:[e,t]}),yoe=(e,t)=>({...loe(e),options:[e,t]}),voe=(e,t)=>({...coe(e),options:[e,t]}),xoe=(e,t)=>({...foe(e),options:[e,t]});var boe="Arrow",kG=Q.forwardRef((e,t)=>{const{children:r,width:i=10,height:c=5,...d}=e;return z.jsx(Sn.svg,{...d,ref:t,width:i,height:c,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?r:z.jsx("polygon",{points:"0,0 30,0 15,10"})})});kG.displayName=boe;var woe=kG;function Soe(e,t=[]){let r=[];function i(d,g){const o=Q.createContext(g),w=r.length;r=[...r,g];function T(C){const{scope:R,children:F,...G}=C,j=(R==null?void 0:R[e][w])||o,H=Q.useMemo(()=>G,Object.values(G));return z.jsx(j.Provider,{value:H,children:F})}function I(C,R){const F=(R==null?void 0:R[e][w])||o,G=Q.useContext(F);if(G)return G;if(g!==void 0)return g;throw new Error(`\`${C}\` must be used within \`${d}\``)}return T.displayName=d+"Provider",[T,I]}const c=()=>{const d=r.map(g=>Q.createContext(g));return function(o){const w=(o==null?void 0:o[e])||d;return Q.useMemo(()=>({[`__scope${e}`]:{...o,[e]:w}}),[o,w])}};return c.scopeName=e,[i,Toe(c,...t)]}function Toe(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const i=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const g=i.reduce((o,{useScope:w,scopeName:T})=>{const C=w(d)[`__scope${T}`];return{...o,...C}},{});return Q.useMemo(()=>({[`__scope${t.scopeName}`]:g}),[g])}};return r.scopeName=t.scopeName,r}function Eoe(e){const[t,r]=Q.useState(void 0);return Fs(()=>{if(e){r({width:e.offsetWidth,height:e.offsetHeight});const i=new ResizeObserver(c=>{if(!Array.isArray(c)||!c.length)return;const d=c[0];let g,o;if("borderBoxSize"in d){const w=d.borderBoxSize,T=Array.isArray(w)?w[0]:w;g=T.inlineSize,o=T.blockSize}else g=e.offsetWidth,o=e.offsetHeight;r({width:g,height:o})});return i.observe(e,{box:"border-box"}),()=>i.unobserve(e)}else r(void 0)},[e]),t}var aD="Popper",[DG,my]=Soe(aD),[Aoe,LG]=DG(aD),zG=e=>{const{__scopePopper:t,children:r}=e,[i,c]=Q.useState(null);return z.jsx(Aoe,{scope:t,anchor:i,onAnchorChange:c,children:r})};zG.displayName=aD;var NG="PopperAnchor",jG=Q.forwardRef((e,t)=>{const{__scopePopper:r,virtualRef:i,...c}=e,d=LG(NG,r),g=Q.useRef(null),o=Ci(t,g);return Q.useEffect(()=>{d.onAnchorChange((i==null?void 0:i.current)||g.current)}),i?null:z.jsx(Sn.div,{...c,ref:o})});jG.displayName=NG;var lD="PopperContent",[Poe,Coe]=DG(lD),FG=Q.forwardRef((e,t)=>{var nr,Xr,Lt,ur,_r,Mt;const{__scopePopper:r,side:i="bottom",sideOffset:c=0,align:d="center",alignOffset:g=0,arrowPadding:o=0,avoidCollisions:w=!0,collisionBoundary:T=[],collisionPadding:I=0,sticky:C="partial",hideWhenDetached:R=!1,updatePositionStrategy:F="optimized",onPlaced:G,...j}=e,H=LG(lD,r),[X,q]=Q.useState(null),Z=Ci(t,Nr=>q(Nr)),[J,ne]=Q.useState(null),he=Eoe(J),me=(he==null?void 0:he.width)??0,Se=(he==null?void 0:he.height)??0,qe=i+(d!=="center"?"-"+d:""),Ze=typeof I=="number"?I:{top:0,right:0,bottom:0,left:0,...I},He=Array.isArray(T)?T:[T],Ke=He.length>0,dt={padding:Ze,boundary:He.filter(Ooe),altBoundary:Ke},{refs:$e,floatingStyles:mt,placement:ct,isPositioned:St,middlewareData:Ue}=doe({strategy:"fixed",placement:qe,whileElementsMounted:(...Nr)=>ioe(...Nr,{animationFrame:F==="always"}),elements:{reference:H.anchor},middleware:[poe({mainAxis:c+Se,alignmentAxis:g}),w&&moe({mainAxis:!0,crossAxis:!1,limiter:C==="partial"?goe():void 0,...dt}),w&&_oe({...dt}),yoe({...dt,apply:({elements:Nr,rects:Yr,availableWidth:Hn,availableHeight:en})=>{const{width:Ei,height:xo}=Yr.reference,On=Nr.floating.style;On.setProperty("--radix-popper-available-width",`${Hn}px`),On.setProperty("--radix-popper-available-height",`${en}px`),On.setProperty("--radix-popper-anchor-width",`${Ei}px`),On.setProperty("--radix-popper-anchor-height",`${xo}px`)}}),J&&xoe({element:J,padding:o}),Moe({arrowWidth:me,arrowHeight:Se}),R&&voe({strategy:"referenceHidden",...dt})]}),[st,bt]=UG(ct),At=js(G);Fs(()=>{St&&(At==null||At())},[St,At]);const zt=(nr=Ue.arrow)==null?void 0:nr.x,or=(Xr=Ue.arrow)==null?void 0:Xr.y,Mr=((Lt=Ue.arrow)==null?void 0:Lt.centerOffset)!==0,[Ar,vr]=Q.useState();return Fs(()=>{X&&vr(window.getComputedStyle(X).zIndex)},[X]),z.jsx("div",{ref:$e.setFloating,"data-radix-popper-content-wrapper":"",style:{...mt,transform:St?mt.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Ar,"--radix-popper-transform-origin":[(ur=Ue.transformOrigin)==null?void 0:ur.x,(_r=Ue.transformOrigin)==null?void 0:_r.y].join(" "),...((Mt=Ue.hide)==null?void 0:Mt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:z.jsx(Poe,{scope:r,placedSide:st,onArrowChange:ne,arrowX:zt,arrowY:or,shouldHideArrow:Mr,children:z.jsx(Sn.div,{"data-side":st,"data-align":bt,...j,ref:Z,style:{...j.style,animation:St?void 0:"none"}})})})});FG.displayName=lD;var BG="PopperArrow",Ioe={top:"bottom",right:"left",bottom:"top",left:"right"},$G=Q.forwardRef(function(t,r){const{__scopePopper:i,...c}=t,d=Coe(BG,i),g=Ioe[d.placedSide];return z.jsx("span",{ref:d.onArrowChange,style:{position:"absolute",left:d.arrowX,top:d.arrowY,[g]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[d.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[d.placedSide],visibility:d.shouldHideArrow?"hidden":void 0},children:z.jsx(woe,{...c,ref:r,style:{...c.style,display:"block"}})})});$G.displayName=BG;function Ooe(e){return e!==null}var Moe=e=>({name:"transformOrigin",options:e,fn(t){var H,X,q;const{placement:r,rects:i,middlewareData:c}=t,g=((H=c.arrow)==null?void 0:H.centerOffset)!==0,o=g?0:e.arrowWidth,w=g?0:e.arrowHeight,[T,I]=UG(r),C={start:"0%",center:"50%",end:"100%"}[I],R=(((X=c.arrow)==null?void 0:X.x)??0)+o/2,F=(((q=c.arrow)==null?void 0:q.y)??0)+w/2;let G="",j="";return T==="bottom"?(G=g?C:`${R}px`,j=`${-w}px`):T==="top"?(G=g?C:`${R}px`,j=`${i.floating.height+w}px`):T==="right"?(G=`${-w}px`,j=g?C:`${F}px`):T==="left"&&(G=`${i.floating.width+w}px`,j=g?C:`${F}px`),{data:{x:G,y:j}}}});function UG(e){const[t,r="center"]=e.split("-");return[t,r]}var VG=zG,cD=jG,uD=FG,hD=$G,[f2,Cje]=nm("Tooltip",[my]),dD=my(),GG="TooltipProvider",Roe=700,wB="tooltip.open",[koe,HG]=f2(GG),WG=e=>{const{__scopeTooltip:t,delayDuration:r=Roe,skipDelayDuration:i=300,disableHoverableContent:c=!1,children:d}=e,[g,o]=Q.useState(!0),w=Q.useRef(!1),T=Q.useRef(0);return Q.useEffect(()=>{const I=T.current;return()=>window.clearTimeout(I)},[]),z.jsx(koe,{scope:t,isOpenDelayed:g,delayDuration:r,onOpen:Q.useCallback(()=>{window.clearTimeout(T.current),o(!1)},[]),onClose:Q.useCallback(()=>{window.clearTimeout(T.current),T.current=window.setTimeout(()=>o(!0),i)},[i]),isPointerInTransitRef:w,onPointerInTransitChange:Q.useCallback(I=>{w.current=I},[]),disableHoverableContent:c,children:d})};WG.displayName=GG;var qG="Tooltip",[Ije,p2]=f2(qG),nM="TooltipTrigger",Doe=Q.forwardRef((e,t)=>{const{__scopeTooltip:r,...i}=e,c=p2(nM,r),d=HG(nM,r),g=dD(r),o=Q.useRef(null),w=Ci(t,o,c.onTriggerChange),T=Q.useRef(!1),I=Q.useRef(!1),C=Q.useCallback(()=>T.current=!1,[]);return Q.useEffect(()=>()=>document.removeEventListener("pointerup",C),[C]),z.jsx(cD,{asChild:!0,...g,children:z.jsx(Sn.button,{"aria-describedby":c.open?c.contentId:void 0,"data-state":c.stateAttribute,...i,ref:w,onPointerMove:Er(e.onPointerMove,R=>{R.pointerType!=="touch"&&!I.current&&!d.isPointerInTransitRef.current&&(c.onTriggerEnter(),I.current=!0)}),onPointerLeave:Er(e.onPointerLeave,()=>{c.onTriggerLeave(),I.current=!1}),onPointerDown:Er(e.onPointerDown,()=>{T.current=!0,document.addEventListener("pointerup",C,{once:!0})}),onFocus:Er(e.onFocus,()=>{T.current||c.onOpen()}),onBlur:Er(e.onBlur,c.onClose),onClick:Er(e.onClick,c.onClose)})})});Doe.displayName=nM;var Loe="TooltipPortal",[Oje,zoe]=f2(Loe,{forceMount:void 0}),z_="TooltipContent",ZG=Q.forwardRef((e,t)=>{const r=zoe(z_,e.__scopeTooltip),{forceMount:i=r.forceMount,side:c="top",...d}=e,g=p2(z_,e.__scopeTooltip);return z.jsx(hc,{present:i||g.open,children:g.disableHoverableContent?z.jsx(XG,{side:c,...d,ref:t}):z.jsx(Noe,{side:c,...d,ref:t})})}),Noe=Q.forwardRef((e,t)=>{const r=p2(z_,e.__scopeTooltip),i=HG(z_,e.__scopeTooltip),c=Q.useRef(null),d=Ci(t,c),[g,o]=Q.useState(null),{trigger:w,onClose:T}=r,I=c.current,{onPointerInTransitChange:C}=i,R=Q.useCallback(()=>{o(null),C(!1)},[C]),F=Q.useCallback((G,j)=>{const H=G.currentTarget,X={x:G.clientX,y:G.clientY},q=$oe(X,H.getBoundingClientRect()),Z=Uoe(X,q),J=Voe(j.getBoundingClientRect()),ne=Hoe([...Z,...J]);o(ne),C(!0)},[C]);return Q.useEffect(()=>()=>R(),[R]),Q.useEffect(()=>{if(w&&I){const G=H=>F(H,I),j=H=>F(H,w);return w.addEventListener("pointerleave",G),I.addEventListener("pointerleave",j),()=>{w.removeEventListener("pointerleave",G),I.removeEventListener("pointerleave",j)}}},[w,I,F,R]),Q.useEffect(()=>{if(g){const G=j=>{const H=j.target,X={x:j.clientX,y:j.clientY},q=(w==null?void 0:w.contains(H))||(I==null?void 0:I.contains(H)),Z=!Goe(X,g);q?R():Z&&(R(),T())};return document.addEventListener("pointermove",G),()=>document.removeEventListener("pointermove",G)}},[w,I,g,T,R]),z.jsx(XG,{...e,ref:d})}),[joe,Foe]=f2(qG,{isInside:!1}),XG=Q.forwardRef((e,t)=>{const{__scopeTooltip:r,children:i,"aria-label":c,onEscapeKeyDown:d,onPointerDownOutside:g,...o}=e,w=p2(z_,r),T=dD(r),{onClose:I}=w;return Q.useEffect(()=>(document.addEventListener(wB,I),()=>document.removeEventListener(wB,I)),[I]),Q.useEffect(()=>{if(w.trigger){const C=R=>{const F=R.target;F!=null&&F.contains(w.trigger)&&I()};return window.addEventListener("scroll",C,{capture:!0}),()=>window.removeEventListener("scroll",C,{capture:!0})}},[w.trigger,I]),z.jsx(hy,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:C=>C.preventDefault(),onDismiss:I,children:z.jsxs(uD,{"data-state":w.stateAttribute,...T,...o,ref:t,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[z.jsx(N8,{children:i}),z.jsx(joe,{scope:r,isInside:!0,children:z.jsx(Are,{id:w.contentId,role:"tooltip",children:c||i})})]})})});ZG.displayName=z_;var KG="TooltipArrow",Boe=Q.forwardRef((e,t)=>{const{__scopeTooltip:r,...i}=e,c=dD(r);return Foe(KG,r).isInside?null:z.jsx(hD,{...c,...i,ref:t})});Boe.displayName=KG;function $oe(e,t){const r=Math.abs(t.top-e.y),i=Math.abs(t.bottom-e.y),c=Math.abs(t.right-e.x),d=Math.abs(t.left-e.x);switch(Math.min(r,i,c,d)){case d:return"left";case c:return"right";case r:return"top";case i:return"bottom";default:throw new Error("unreachable")}}function Uoe(e,t,r=5){const i=[];switch(t){case"top":i.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":i.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":i.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":i.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r});break}return i}function Voe(e){const{top:t,right:r,bottom:i,left:c}=e;return[{x:c,y:t},{x:r,y:t},{x:r,y:i},{x:c,y:i}]}function Goe(e,t){const{x:r,y:i}=e;let c=!1;for(let d=0,g=t.length-1;d<t.length;g=d++){const o=t[d].x,w=t[d].y,T=t[g].x,I=t[g].y;w>i!=I>i&&r<(T-o)*(i-w)/(I-w)+o&&(c=!c)}return c}function Hoe(e){const t=e.slice();return t.sort((r,i)=>r.x<i.x?-1:r.x>i.x?1:r.y<i.y?-1:r.y>i.y?1:0),Woe(t)}function Woe(e){if(e.length<=1)return e.slice();const t=[];for(let i=0;i<e.length;i++){const c=e[i];for(;t.length>=2;){const d=t[t.length-1],g=t[t.length-2];if((d.x-g.x)*(c.y-g.y)>=(d.y-g.y)*(c.x-g.x))t.pop();else break}t.push(c)}t.pop();const r=[];for(let i=e.length-1;i>=0;i--){const c=e[i];for(;r.length>=2;){const d=r[r.length-1],g=r[r.length-2];if((d.x-g.x)*(c.y-g.y)>=(d.y-g.y)*(c.x-g.x))r.pop();else break}r.push(c)}return r.pop(),t.length===1&&r.length===1&&t[0].x===r[0].x&&t[0].y===r[0].y?t:t.concat(r)}var qoe=WG,YG=ZG;const Zoe=qoe,Xoe=Q.forwardRef(({className:e,sideOffset:t=4,...r},i)=>z.jsx(YG,{ref:i,sideOffset:t,className:zn("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r}));Xoe.displayName=YG.displayName;var m2=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},g2=typeof window>"u"||"Deno"in globalThis;function Kl(){}function Koe(e,t){return typeof e=="function"?e(t):e}function Yoe(e){return typeof e=="number"&&e>=0&&e!==1/0}function Joe(e,t){return Math.max(e+(t||0)-Date.now(),0)}function SB(e,t){return typeof e=="function"?e(t):e}function Qoe(e,t){return typeof e=="function"?e(t):e}function TB(e,t){const{type:r="all",exact:i,fetchStatus:c,predicate:d,queryKey:g,stale:o}=e;if(g){if(i){if(t.queryHash!==fD(g,t.options))return!1}else if(!Bx(t.queryKey,g))return!1}if(r!=="all"){const w=t.isActive();if(r==="active"&&!w||r==="inactive"&&w)return!1}return!(typeof o=="boolean"&&t.isStale()!==o||c&&c!==t.state.fetchStatus||d&&!d(t))}function EB(e,t){const{exact:r,status:i,predicate:c,mutationKey:d}=e;if(d){if(!t.options.mutationKey)return!1;if(r){if(Fx(t.options.mutationKey)!==Fx(d))return!1}else if(!Bx(t.options.mutationKey,d))return!1}return!(i&&t.state.status!==i||c&&!c(t))}function fD(e,t){return((t==null?void 0:t.queryKeyHashFn)||Fx)(e)}function Fx(e){return JSON.stringify(e,(t,r)=>iM(r)?Object.keys(r).sort().reduce((i,c)=>(i[c]=r[c],i),{}):r)}function Bx(e,t){return e===t?!0:typeof e!=typeof t?!1:e&&t&&typeof e=="object"&&typeof t=="object"?!Object.keys(t).some(r=>!Bx(e[r],t[r])):!1}function JG(e,t){if(e===t)return e;const r=AB(e)&&AB(t);if(r||iM(e)&&iM(t)){const i=r?e:Object.keys(e),c=i.length,d=r?t:Object.keys(t),g=d.length,o=r?[]:{};let w=0;for(let T=0;T<g;T++){const I=r?T:d[T];(!r&&i.includes(I)||r)&&e[I]===void 0&&t[I]===void 0?(o[I]=void 0,w++):(o[I]=JG(e[I],t[I]),o[I]===e[I]&&e[I]!==void 0&&w++)}return c===g&&w===c?e:o}return t}function AB(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function iM(e){if(!PB(e))return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(!PB(r)||!r.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function PB(e){return Object.prototype.toString.call(e)==="[object Object]"}function ese(e){return new Promise(t=>{setTimeout(t,e)})}function tse(e,t,r){return typeof r.structuralSharing=="function"?r.structuralSharing(e,t):r.structuralSharing!==!1?JG(e,t):t}function rse(e,t,r=0){const i=[...e,t];return r&&i.length>r?i.slice(1):i}function nse(e,t,r=0){const i=[t,...e];return r&&i.length>r?i.slice(0,-1):i}var pD=Symbol();function QG(e,t){return!e.queryFn&&(t!=null&&t.initialPromise)?()=>t.initialPromise:!e.queryFn||e.queryFn===pD?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var Ip,md,v_,pV,ise=(pV=class extends m2{constructor(){super();Oi(this,Ip);Oi(this,md);Oi(this,v_);Vn(this,v_,t=>{if(!g2&&window.addEventListener){const r=()=>t();return window.addEventListener("visibilitychange",r,!1),()=>{window.removeEventListener("visibilitychange",r)}}})}onSubscribe(){Qt(this,md)||this.setEventListener(Qt(this,v_))}onUnsubscribe(){var t;this.hasListeners()||((t=Qt(this,md))==null||t.call(this),Vn(this,md,void 0))}setEventListener(t){var r;Vn(this,v_,t),(r=Qt(this,md))==null||r.call(this),Vn(this,md,t(i=>{typeof i=="boolean"?this.setFocused(i):this.onFocus()}))}setFocused(t){Qt(this,Ip)!==t&&(Vn(this,Ip,t),this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(r=>{r(t)})}isFocused(){var t;return typeof Qt(this,Ip)=="boolean"?Qt(this,Ip):((t=globalThis.document)==null?void 0:t.visibilityState)!=="hidden"}},Ip=new WeakMap,md=new WeakMap,v_=new WeakMap,pV),eH=new ise,x_,gd,b_,mV,ose=(mV=class extends m2{constructor(){super();Oi(this,x_,!0);Oi(this,gd);Oi(this,b_);Vn(this,b_,t=>{if(!g2&&window.addEventListener){const r=()=>t(!0),i=()=>t(!1);return window.addEventListener("online",r,!1),window.addEventListener("offline",i,!1),()=>{window.removeEventListener("online",r),window.removeEventListener("offline",i)}}})}onSubscribe(){Qt(this,gd)||this.setEventListener(Qt(this,b_))}onUnsubscribe(){var t;this.hasListeners()||((t=Qt(this,gd))==null||t.call(this),Vn(this,gd,void 0))}setEventListener(t){var r;Vn(this,b_,t),(r=Qt(this,gd))==null||r.call(this),Vn(this,gd,t(this.setOnline.bind(this)))}setOnline(t){Qt(this,x_)!==t&&(Vn(this,x_,t),this.listeners.forEach(i=>{i(t)}))}isOnline(){return Qt(this,x_)}},x_=new WeakMap,gd=new WeakMap,b_=new WeakMap,mV),NT=new ose;function sse(){let e,t;const r=new Promise((c,d)=>{e=c,t=d});r.status="pending",r.catch(()=>{});function i(c){Object.assign(r,c),delete r.resolve,delete r.reject}return r.resolve=c=>{i({status:"fulfilled",value:c}),e(c)},r.reject=c=>{i({status:"rejected",reason:c}),t(c)},r}function ase(e){return Math.min(1e3*2**e,3e4)}function tH(e){return(e??"online")==="online"?NT.isOnline():!0}var rH=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function uI(e){return e instanceof rH}function nH(e){let t=!1,r=0,i=!1,c;const d=sse(),g=j=>{var H;i||(R(new rH(j)),(H=e.abort)==null||H.call(e))},o=()=>{t=!0},w=()=>{t=!1},T=()=>eH.isFocused()&&(e.networkMode==="always"||NT.isOnline())&&e.canRun(),I=()=>tH(e.networkMode)&&e.canRun(),C=j=>{var H;i||(i=!0,(H=e.onSuccess)==null||H.call(e,j),c==null||c(),d.resolve(j))},R=j=>{var H;i||(i=!0,(H=e.onError)==null||H.call(e,j),c==null||c(),d.reject(j))},F=()=>new Promise(j=>{var H;c=X=>{(i||T())&&j(X)},(H=e.onPause)==null||H.call(e)}).then(()=>{var j;c=void 0,i||(j=e.onContinue)==null||j.call(e)}),G=()=>{if(i)return;let j;const H=r===0?e.initialPromise:void 0;try{j=H??e.fn()}catch(X){j=Promise.reject(X)}Promise.resolve(j).then(C).catch(X=>{var he;if(i)return;const q=e.retry??(g2?0:3),Z=e.retryDelay??ase,J=typeof Z=="function"?Z(r,X):Z,ne=q===!0||typeof q=="number"&&r<q||typeof q=="function"&&q(r,X);if(t||!ne){R(X);return}r++,(he=e.onFail)==null||he.call(e,r,X),ese(J).then(()=>T()?void 0:F()).then(()=>{t?R(X):G()})})};return{promise:d,cancel:g,continue:()=>(c==null||c(),d),cancelRetry:o,continueRetry:w,canStart:I,start:()=>(I()?G():F().then(G),d)}}function lse(){let e=[],t=0,r=o=>{o()},i=o=>{o()},c=o=>setTimeout(o,0);const d=o=>{t?e.push(o):c(()=>{r(o)})},g=()=>{const o=e;e=[],o.length&&c(()=>{i(()=>{o.forEach(w=>{r(w)})})})};return{batch:o=>{let w;t++;try{w=o()}finally{t--,t||g()}return w},batchCalls:o=>(...w)=>{d(()=>{o(...w)})},schedule:d,setNotifyFunction:o=>{r=o},setBatchNotifyFunction:o=>{i=o},setScheduler:o=>{c=o}}}var Ks=lse(),Op,gV,iH=(gV=class{constructor(){Oi(this,Op)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Yoe(this.gcTime)&&Vn(this,Op,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(g2?1/0:5*60*1e3))}clearGcTimeout(){Qt(this,Op)&&(clearTimeout(Qt(this,Op)),Vn(this,Op,void 0))}},Op=new WeakMap,gV),w_,S_,al,Ms,I1,Mp,Yl,Ru,_V,cse=(_V=class extends iH{constructor(t){super();Oi(this,Yl);Oi(this,w_);Oi(this,S_);Oi(this,al);Oi(this,Ms);Oi(this,I1);Oi(this,Mp);Vn(this,Mp,!1),Vn(this,I1,t.defaultOptions),this.setOptions(t.options),this.observers=[],Vn(this,al,t.cache),this.queryKey=t.queryKey,this.queryHash=t.queryHash,Vn(this,w_,hse(this.options)),this.state=t.state??Qt(this,w_),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=Qt(this,Ms))==null?void 0:t.promise}setOptions(t){this.options={...Qt(this,I1),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Qt(this,al).remove(this)}setData(t,r){const i=tse(this.state.data,t,this.options);return Ps(this,Yl,Ru).call(this,{data:i,type:"success",dataUpdatedAt:r==null?void 0:r.updatedAt,manual:r==null?void 0:r.manual}),i}setState(t,r){Ps(this,Yl,Ru).call(this,{type:"setState",state:t,setStateOptions:r})}cancel(t){var i,c;const r=(i=Qt(this,Ms))==null?void 0:i.promise;return(c=Qt(this,Ms))==null||c.cancel(t),r?r.then(Kl).catch(Kl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Qt(this,w_))}isActive(){return this.observers.some(t=>Qoe(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===pD||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!Joe(this.state.dataUpdatedAt,t)}onFocus(){var r;const t=this.observers.find(i=>i.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(r=Qt(this,Ms))==null||r.continue()}onOnline(){var r;const t=this.observers.find(i=>i.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(r=Qt(this,Ms))==null||r.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),Qt(this,al).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(r=>r!==t),this.observers.length||(Qt(this,Ms)&&(Qt(this,Mp)?Qt(this,Ms).cancel({revert:!0}):Qt(this,Ms).cancelRetry()),this.scheduleGc()),Qt(this,al).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Ps(this,Yl,Ru).call(this,{type:"invalidate"})}fetch(t,r){var w,T,I;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(r!=null&&r.cancelRefetch))this.cancel({silent:!0});else if(Qt(this,Ms))return Qt(this,Ms).continueRetry(),Qt(this,Ms).promise}if(t&&this.setOptions(t),!this.options.queryFn){const C=this.observers.find(R=>R.options.queryFn);C&&this.setOptions(C.options)}const i=new AbortController,c=C=>{Object.defineProperty(C,"signal",{enumerable:!0,get:()=>(Vn(this,Mp,!0),i.signal)})},d=()=>{const C=QG(this.options,r),R={queryKey:this.queryKey,meta:this.meta};return c(R),Vn(this,Mp,!1),this.options.persister?this.options.persister(C,R,this):C(R)},g={fetchOptions:r,options:this.options,queryKey:this.queryKey,state:this.state,fetchFn:d};c(g),(w=this.options.behavior)==null||w.onFetch(g,this),Vn(this,S_,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((T=g.fetchOptions)==null?void 0:T.meta))&&Ps(this,Yl,Ru).call(this,{type:"fetch",meta:(I=g.fetchOptions)==null?void 0:I.meta});const o=C=>{var R,F,G,j;uI(C)&&C.silent||Ps(this,Yl,Ru).call(this,{type:"error",error:C}),uI(C)||((F=(R=Qt(this,al).config).onError)==null||F.call(R,C,this),(j=(G=Qt(this,al).config).onSettled)==null||j.call(G,this.state.data,C,this)),this.scheduleGc()};return Vn(this,Ms,nH({initialPromise:r==null?void 0:r.initialPromise,fn:g.fetchFn,abort:i.abort.bind(i),onSuccess:C=>{var R,F,G,j;if(C===void 0){o(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(C)}catch(H){o(H);return}(F=(R=Qt(this,al).config).onSuccess)==null||F.call(R,C,this),(j=(G=Qt(this,al).config).onSettled)==null||j.call(G,C,this.state.error,this),this.scheduleGc()},onError:o,onFail:(C,R)=>{Ps(this,Yl,Ru).call(this,{type:"failed",failureCount:C,error:R})},onPause:()=>{Ps(this,Yl,Ru).call(this,{type:"pause"})},onContinue:()=>{Ps(this,Yl,Ru).call(this,{type:"continue"})},retry:g.options.retry,retryDelay:g.options.retryDelay,networkMode:g.options.networkMode,canRun:()=>!0})),Qt(this,Ms).start()}},w_=new WeakMap,S_=new WeakMap,al=new WeakMap,Ms=new WeakMap,I1=new WeakMap,Mp=new WeakMap,Yl=new WeakSet,Ru=function(t){const r=i=>{switch(t.type){case"failed":return{...i,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...use(i.data,this.options),fetchMeta:t.meta??null};case"success":return{...i,data:t.data,dataUpdateCount:i.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const c=t.error;return uI(c)&&c.revert&&Qt(this,S_)?{...Qt(this,S_),fetchStatus:"idle"}:{...i,error:c,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:c,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...t.state}}};this.state=r(this.state),Ks.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),Qt(this,al).notify({query:this,type:"updated",action:t})})},_V);function use(e,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:tH(t.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function hse(e){const t=typeof e.initialData=="function"?e.initialData():e.initialData,r=t!==void 0,i=r?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:r?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:r?"success":"pending",fetchStatus:"idle"}}var Uc,yV,dse=(yV=class extends m2{constructor(t={}){super();Oi(this,Uc);this.config=t,Vn(this,Uc,new Map)}build(t,r,i){const c=r.queryKey,d=r.queryHash??fD(c,r);let g=this.get(d);return g||(g=new cse({cache:this,queryKey:c,queryHash:d,options:t.defaultQueryOptions(r),state:i,defaultOptions:t.getQueryDefaults(c)}),this.add(g)),g}add(t){Qt(this,Uc).has(t.queryHash)||(Qt(this,Uc).set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const r=Qt(this,Uc).get(t.queryHash);r&&(t.destroy(),r===t&&Qt(this,Uc).delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){Ks.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return Qt(this,Uc).get(t)}getAll(){return[...Qt(this,Uc).values()]}find(t){const r={exact:!0,...t};return this.getAll().find(i=>TB(r,i))}findAll(t={}){const r=this.getAll();return Object.keys(t).length>0?r.filter(i=>TB(t,i)):r}notify(t){Ks.batch(()=>{this.listeners.forEach(r=>{r(t)})})}onFocus(){Ks.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){Ks.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},Uc=new WeakMap,yV),Vc,qs,Rp,Gc,nd,vV,fse=(vV=class extends iH{constructor(t){super();Oi(this,Gc);Oi(this,Vc);Oi(this,qs);Oi(this,Rp);this.mutationId=t.mutationId,Vn(this,qs,t.mutationCache),Vn(this,Vc,[]),this.state=t.state||pse(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){Qt(this,Vc).includes(t)||(Qt(this,Vc).push(t),this.clearGcTimeout(),Qt(this,qs).notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){Vn(this,Vc,Qt(this,Vc).filter(r=>r!==t)),this.scheduleGc(),Qt(this,qs).notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){Qt(this,Vc).length||(this.state.status==="pending"?this.scheduleGc():Qt(this,qs).remove(this))}continue(){var t;return((t=Qt(this,Rp))==null?void 0:t.continue())??this.execute(this.state.variables)}async execute(t){var c,d,g,o,w,T,I,C,R,F,G,j,H,X,q,Z,J,ne,he,me;Vn(this,Rp,nH({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(new Error("No mutationFn found")),onFail:(Se,qe)=>{Ps(this,Gc,nd).call(this,{type:"failed",failureCount:Se,error:qe})},onPause:()=>{Ps(this,Gc,nd).call(this,{type:"pause"})},onContinue:()=>{Ps(this,Gc,nd).call(this,{type:"continue"})},retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Qt(this,qs).canRun(this)}));const r=this.state.status==="pending",i=!Qt(this,Rp).canStart();try{if(!r){Ps(this,Gc,nd).call(this,{type:"pending",variables:t,isPaused:i}),await((d=(c=Qt(this,qs).config).onMutate)==null?void 0:d.call(c,t,this));const qe=await((o=(g=this.options).onMutate)==null?void 0:o.call(g,t));qe!==this.state.context&&Ps(this,Gc,nd).call(this,{type:"pending",context:qe,variables:t,isPaused:i})}const Se=await Qt(this,Rp).start();return await((T=(w=Qt(this,qs).config).onSuccess)==null?void 0:T.call(w,Se,t,this.state.context,this)),await((C=(I=this.options).onSuccess)==null?void 0:C.call(I,Se,t,this.state.context)),await((F=(R=Qt(this,qs).config).onSettled)==null?void 0:F.call(R,Se,null,this.state.variables,this.state.context,this)),await((j=(G=this.options).onSettled)==null?void 0:j.call(G,Se,null,t,this.state.context)),Ps(this,Gc,nd).call(this,{type:"success",data:Se}),Se}catch(Se){try{throw await((X=(H=Qt(this,qs).config).onError)==null?void 0:X.call(H,Se,t,this.state.context,this)),await((Z=(q=this.options).onError)==null?void 0:Z.call(q,Se,t,this.state.context)),await((ne=(J=Qt(this,qs).config).onSettled)==null?void 0:ne.call(J,void 0,Se,this.state.variables,this.state.context,this)),await((me=(he=this.options).onSettled)==null?void 0:me.call(he,void 0,Se,t,this.state.context)),Se}finally{Ps(this,Gc,nd).call(this,{type:"error",error:Se})}}finally{Qt(this,qs).runNext(this)}}},Vc=new WeakMap,qs=new WeakMap,Rp=new WeakMap,Gc=new WeakSet,nd=function(t){const r=i=>{switch(t.type){case"failed":return{...i,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...i,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:t.error,failureCount:i.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}};this.state=r(this.state),Ks.batch(()=>{Qt(this,Vc).forEach(i=>{i.onMutationUpdate(t)}),Qt(this,qs).notify({mutation:this,type:"updated",action:t})})},vV);function pse(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var ka,O1,xV,mse=(xV=class extends m2{constructor(t={}){super();Oi(this,ka);Oi(this,O1);this.config=t,Vn(this,ka,new Map),Vn(this,O1,Date.now())}build(t,r,i){const c=new fse({mutationCache:this,mutationId:++Jw(this,O1)._,options:t.defaultMutationOptions(r),state:i});return this.add(c),c}add(t){const r=xS(t),i=Qt(this,ka).get(r)??[];i.push(t),Qt(this,ka).set(r,i),this.notify({type:"added",mutation:t})}remove(t){var i;const r=xS(t);if(Qt(this,ka).has(r)){const c=(i=Qt(this,ka).get(r))==null?void 0:i.filter(d=>d!==t);c&&(c.length===0?Qt(this,ka).delete(r):Qt(this,ka).set(r,c))}this.notify({type:"removed",mutation:t})}canRun(t){var i;const r=(i=Qt(this,ka).get(xS(t)))==null?void 0:i.find(c=>c.state.status==="pending");return!r||r===t}runNext(t){var i;const r=(i=Qt(this,ka).get(xS(t)))==null?void 0:i.find(c=>c!==t&&c.state.isPaused);return(r==null?void 0:r.continue())??Promise.resolve()}clear(){Ks.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}getAll(){return[...Qt(this,ka).values()].flat()}find(t){const r={exact:!0,...t};return this.getAll().find(i=>EB(r,i))}findAll(t={}){return this.getAll().filter(r=>EB(t,r))}notify(t){Ks.batch(()=>{this.listeners.forEach(r=>{r(t)})})}resumePausedMutations(){const t=this.getAll().filter(r=>r.state.isPaused);return Ks.batch(()=>Promise.all(t.map(r=>r.continue().catch(Kl))))}},ka=new WeakMap,O1=new WeakMap,xV);function xS(e){var t;return((t=e.options.scope)==null?void 0:t.id)??String(e.mutationId)}function CB(e){return{onFetch:(t,r)=>{var I,C,R,F,G;const i=t.options,c=(R=(C=(I=t.fetchOptions)==null?void 0:I.meta)==null?void 0:C.fetchMore)==null?void 0:R.direction,d=((F=t.state.data)==null?void 0:F.pages)||[],g=((G=t.state.data)==null?void 0:G.pageParams)||[];let o={pages:[],pageParams:[]},w=0;const T=async()=>{let j=!1;const H=Z=>{Object.defineProperty(Z,"signal",{enumerable:!0,get:()=>(t.signal.aborted?j=!0:t.signal.addEventListener("abort",()=>{j=!0}),t.signal)})},X=QG(t.options,t.fetchOptions),q=async(Z,J,ne)=>{if(j)return Promise.reject();if(J==null&&Z.pages.length)return Promise.resolve(Z);const he={queryKey:t.queryKey,pageParam:J,direction:ne?"backward":"forward",meta:t.options.meta};H(he);const me=await X(he),{maxPages:Se}=t.options,qe=ne?nse:rse;return{pages:qe(Z.pages,me,Se),pageParams:qe(Z.pageParams,J,Se)}};if(c&&d.length){const Z=c==="backward",J=Z?gse:IB,ne={pages:d,pageParams:g},he=J(i,ne);o=await q(ne,he,Z)}else{const Z=e??d.length;do{const J=w===0?g[0]??i.initialPageParam:IB(i,o);if(w>0&&J==null)break;o=await q(o,J),w++}while(w<Z)}return o};t.options.persister?t.fetchFn=()=>{var j,H;return(H=(j=t.options).persister)==null?void 0:H.call(j,T,{queryKey:t.queryKey,meta:t.options.meta,signal:t.signal},r)}:t.fetchFn=T}}}function IB(e,{pages:t,pageParams:r}){const i=t.length-1;return t.length>0?e.getNextPageParam(t[i],t,r[i],r):void 0}function gse(e,{pages:t,pageParams:r}){var i;return t.length>0?(i=e.getPreviousPageParam)==null?void 0:i.call(e,t[0],t,r[0],r):void 0}var _o,_d,yd,T_,E_,vd,A_,P_,bV,_se=(bV=class{constructor(e={}){Oi(this,_o);Oi(this,_d);Oi(this,yd);Oi(this,T_);Oi(this,E_);Oi(this,vd);Oi(this,A_);Oi(this,P_);Vn(this,_o,e.queryCache||new dse),Vn(this,_d,e.mutationCache||new mse),Vn(this,yd,e.defaultOptions||{}),Vn(this,T_,new Map),Vn(this,E_,new Map),Vn(this,vd,0)}mount(){Jw(this,vd)._++,Qt(this,vd)===1&&(Vn(this,A_,eH.subscribe(async e=>{e&&(await this.resumePausedMutations(),Qt(this,_o).onFocus())})),Vn(this,P_,NT.subscribe(async e=>{e&&(await this.resumePausedMutations(),Qt(this,_o).onOnline())})))}unmount(){var e,t;Jw(this,vd)._--,Qt(this,vd)===0&&((e=Qt(this,A_))==null||e.call(this),Vn(this,A_,void 0),(t=Qt(this,P_))==null||t.call(this),Vn(this,P_,void 0))}isFetching(e){return Qt(this,_o).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Qt(this,_d).findAll({...e,status:"pending"}).length}getQueryData(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Qt(this,_o).get(t.queryHash))==null?void 0:r.state.data}ensureQueryData(e){const t=this.getQueryData(e.queryKey);if(t===void 0)return this.fetchQuery(e);{const r=this.defaultQueryOptions(e),i=Qt(this,_o).build(this,r);return e.revalidateIfStale&&i.isStaleByTime(SB(r.staleTime,i))&&this.prefetchQuery(r),Promise.resolve(t)}}getQueriesData(e){return Qt(this,_o).findAll(e).map(({queryKey:t,state:r})=>{const i=r.data;return[t,i]})}setQueryData(e,t,r){const i=this.defaultQueryOptions({queryKey:e}),c=Qt(this,_o).get(i.queryHash),d=c==null?void 0:c.state.data,g=Koe(t,d);if(g!==void 0)return Qt(this,_o).build(this,i).setData(g,{...r,manual:!0})}setQueriesData(e,t,r){return Ks.batch(()=>Qt(this,_o).findAll(e).map(({queryKey:i})=>[i,this.setQueryData(i,t,r)]))}getQueryState(e){var r;const t=this.defaultQueryOptions({queryKey:e});return(r=Qt(this,_o).get(t.queryHash))==null?void 0:r.state}removeQueries(e){const t=Qt(this,_o);Ks.batch(()=>{t.findAll(e).forEach(r=>{t.remove(r)})})}resetQueries(e,t){const r=Qt(this,_o),i={type:"active",...e};return Ks.batch(()=>(r.findAll(e).forEach(c=>{c.reset()}),this.refetchQueries(i,t)))}cancelQueries(e={},t={}){const r={revert:!0,...t},i=Ks.batch(()=>Qt(this,_o).findAll(e).map(c=>c.cancel(r)));return Promise.all(i).then(Kl).catch(Kl)}invalidateQueries(e={},t={}){return Ks.batch(()=>{if(Qt(this,_o).findAll(e).forEach(i=>{i.invalidate()}),e.refetchType==="none")return Promise.resolve();const r={...e,type:e.refetchType??e.type??"active"};return this.refetchQueries(r,t)})}refetchQueries(e={},t){const r={...t,cancelRefetch:(t==null?void 0:t.cancelRefetch)??!0},i=Ks.batch(()=>Qt(this,_o).findAll(e).filter(c=>!c.isDisabled()).map(c=>{let d=c.fetch(void 0,r);return r.throwOnError||(d=d.catch(Kl)),c.state.fetchStatus==="paused"?Promise.resolve():d}));return Promise.all(i).then(Kl)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const r=Qt(this,_o).build(this,t);return r.isStaleByTime(SB(t.staleTime,r))?r.fetch(t):Promise.resolve(r.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Kl).catch(Kl)}fetchInfiniteQuery(e){return e.behavior=CB(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Kl).catch(Kl)}ensureInfiniteQueryData(e){return e.behavior=CB(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return NT.isOnline()?Qt(this,_d).resumePausedMutations():Promise.resolve()}getQueryCache(){return Qt(this,_o)}getMutationCache(){return Qt(this,_d)}getDefaultOptions(){return Qt(this,yd)}setDefaultOptions(e){Vn(this,yd,e)}setQueryDefaults(e,t){Qt(this,T_).set(Fx(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...Qt(this,T_).values()];let r={};return t.forEach(i=>{Bx(e,i.queryKey)&&(r={...r,...i.defaultOptions})}),r}setMutationDefaults(e,t){Qt(this,E_).set(Fx(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...Qt(this,E_).values()];let r={};return t.forEach(i=>{Bx(e,i.mutationKey)&&(r={...r,...i.defaultOptions})}),r}defaultQueryOptions(e){if(e._defaulted)return e;const t={...Qt(this,yd).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=fD(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.enabled!==!0&&t.queryFn===pD&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Qt(this,yd).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Qt(this,_o).clear(),Qt(this,_d).clear()}},_o=new WeakMap,_d=new WeakMap,yd=new WeakMap,T_=new WeakMap,E_=new WeakMap,vd=new WeakMap,A_=new WeakMap,P_=new WeakMap,bV),yse=Q.createContext(void 0),vse=({client:e,children:t})=>(Q.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),z.jsx(yse.Provider,{value:e,children:t}));/**
 * @remix-run/router v1.20.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $x(){return $x=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},$x.apply(this,arguments)}var wd;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(wd||(wd={}));const OB="popstate";function xse(e){e===void 0&&(e={});function t(i,c){let{pathname:d,search:g,hash:o}=i.location;return oM("",{pathname:d,search:g,hash:o},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function r(i,c){return typeof c=="string"?c:jT(c)}return wse(t,r,null,e)}function Co(e,t){if(e===!1||e===null||typeof e>"u")throw new Error(t)}function oH(e,t){if(!e){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function bse(){return Math.random().toString(36).substr(2,8)}function MB(e,t){return{usr:e.state,key:e.key,idx:t}}function oM(e,t,r,i){return r===void 0&&(r=null),$x({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof t=="string"?gy(t):t,{state:r,key:t&&t.key||i||bse()})}function jT(e){let{pathname:t="/",search:r="",hash:i=""}=e;return r&&r!=="?"&&(t+=r.charAt(0)==="?"?r:"?"+r),i&&i!=="#"&&(t+=i.charAt(0)==="#"?i:"#"+i),t}function gy(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let i=e.indexOf("?");i>=0&&(t.search=e.substr(i),e=e.substr(0,i)),e&&(t.pathname=e)}return t}function wse(e,t,r,i){i===void 0&&(i={});let{window:c=document.defaultView,v5Compat:d=!1}=i,g=c.history,o=wd.Pop,w=null,T=I();T==null&&(T=0,g.replaceState($x({},g.state,{idx:T}),""));function I(){return(g.state||{idx:null}).idx}function C(){o=wd.Pop;let H=I(),X=H==null?null:H-T;T=H,w&&w({action:o,location:j.location,delta:X})}function R(H,X){o=wd.Push;let q=oM(j.location,H,X);T=I()+1;let Z=MB(q,T),J=j.createHref(q);try{g.pushState(Z,"",J)}catch(ne){if(ne instanceof DOMException&&ne.name==="DataCloneError")throw ne;c.location.assign(J)}d&&w&&w({action:o,location:j.location,delta:1})}function F(H,X){o=wd.Replace;let q=oM(j.location,H,X);T=I();let Z=MB(q,T),J=j.createHref(q);g.replaceState(Z,"",J),d&&w&&w({action:o,location:j.location,delta:0})}function G(H){let X=c.location.origin!=="null"?c.location.origin:c.location.href,q=typeof H=="string"?H:jT(H);return q=q.replace(/ $/,"%20"),Co(X,"No window.location.(origin|href) available to create URL for href: "+q),new URL(q,X)}let j={get action(){return o},get location(){return e(c,g)},listen(H){if(w)throw new Error("A history only accepts one active listener");return c.addEventListener(OB,C),w=H,()=>{c.removeEventListener(OB,C),w=null}},createHref(H){return t(c,H)},createURL:G,encodeLocation(H){let X=G(H);return{pathname:X.pathname,search:X.search,hash:X.hash}},push:R,replace:F,go(H){return g.go(H)}};return j}var RB;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(RB||(RB={}));function Sse(e,t,r){return r===void 0&&(r="/"),Tse(e,t,r,!1)}function Tse(e,t,r,i){let c=typeof t=="string"?gy(t):t,d=mD(c.pathname||"/",r);if(d==null)return null;let g=sH(e);Ese(g);let o=null;for(let w=0;o==null&&w<g.length;++w){let T=zse(d);o=Dse(g[w],T,i)}return o}function sH(e,t,r,i){t===void 0&&(t=[]),r===void 0&&(r=[]),i===void 0&&(i="");let c=(d,g,o)=>{let w={relativePath:o===void 0?d.path||"":o,caseSensitive:d.caseSensitive===!0,childrenIndex:g,route:d};w.relativePath.startsWith("/")&&(Co(w.relativePath.startsWith(i),'Absolute route path "'+w.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),w.relativePath=w.relativePath.slice(i.length));let T=Rd([i,w.relativePath]),I=r.concat(w);d.children&&d.children.length>0&&(Co(d.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+T+'".')),sH(d.children,t,I,T)),!(d.path==null&&!d.index)&&t.push({path:T,score:Rse(T,d.index),routesMeta:I})};return e.forEach((d,g)=>{var o;if(d.path===""||!((o=d.path)!=null&&o.includes("?")))c(d,g);else for(let w of aH(d.path))c(d,g,w)}),t}function aH(e){let t=e.split("/");if(t.length===0)return[];let[r,...i]=t,c=r.endsWith("?"),d=r.replace(/\?$/,"");if(i.length===0)return c?[d,""]:[d];let g=aH(i.join("/")),o=[];return o.push(...g.map(w=>w===""?d:[d,w].join("/"))),c&&o.push(...g),o.map(w=>e.startsWith("/")&&w===""?"/":w)}function Ese(e){e.sort((t,r)=>t.score!==r.score?r.score-t.score:kse(t.routesMeta.map(i=>i.childrenIndex),r.routesMeta.map(i=>i.childrenIndex)))}const Ase=/^:[\w-]+$/,Pse=3,Cse=2,Ise=1,Ose=10,Mse=-2,kB=e=>e==="*";function Rse(e,t){let r=e.split("/"),i=r.length;return r.some(kB)&&(i+=Mse),t&&(i+=Cse),r.filter(c=>!kB(c)).reduce((c,d)=>c+(Ase.test(d)?Pse:d===""?Ise:Ose),i)}function kse(e,t){return e.length===t.length&&e.slice(0,-1).every((i,c)=>i===t[c])?e[e.length-1]-t[t.length-1]:0}function Dse(e,t,r){let{routesMeta:i}=e,c={},d="/",g=[];for(let o=0;o<i.length;++o){let w=i[o],T=o===i.length-1,I=d==="/"?t:t.slice(d.length)||"/",C=DB({path:w.relativePath,caseSensitive:w.caseSensitive,end:T},I),R=w.route;if(!C&&T&&r&&!i[i.length-1].route.index&&(C=DB({path:w.relativePath,caseSensitive:w.caseSensitive,end:!1},I)),!C)return null;Object.assign(c,C.params),g.push({params:c,pathname:Rd([d,C.pathname]),pathnameBase:Bse(Rd([d,C.pathnameBase])),route:R}),C.pathnameBase!=="/"&&(d=Rd([d,C.pathnameBase]))}return g}function DB(e,t){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[r,i]=Lse(e.path,e.caseSensitive,e.end),c=t.match(r);if(!c)return null;let d=c[0],g=d.replace(/(.)\/+$/,"$1"),o=c.slice(1);return{params:i.reduce((T,I,C)=>{let{paramName:R,isOptional:F}=I;if(R==="*"){let j=o[C]||"";g=d.slice(0,d.length-j.length).replace(/(.)\/+$/,"$1")}const G=o[C];return F&&!G?T[R]=void 0:T[R]=(G||"").replace(/%2F/g,"/"),T},{}),pathname:d,pathnameBase:g,pattern:e}}function Lse(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!0),oH(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let i=[],c="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(g,o,w)=>(i.push({paramName:o,isOptional:w!=null}),w?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(i.push({paramName:"*"}),c+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?c+="\\/*$":e!==""&&e!=="/"&&(c+="(?:(?=\\/|$))"),[new RegExp(c,t?void 0:"i"),i]}function zse(e){try{return e.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return oH(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+t+").")),e}}function mD(e,t){if(t==="/")return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,i=e.charAt(r);return i&&i!=="/"?null:e.slice(r)||"/"}function Nse(e,t){t===void 0&&(t="/");let{pathname:r,search:i="",hash:c=""}=typeof e=="string"?gy(e):e;return{pathname:r?r.startsWith("/")?r:jse(r,t):t,search:$se(i),hash:Use(c)}}function jse(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(c=>{c===".."?r.length>1&&r.pop():c!=="."&&r.push(c)}),r.length>1?r.join("/"):"/"}function hI(e,t,r,i){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+t+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Fse(e){return e.filter((t,r)=>r===0||t.route.path&&t.route.path.length>0)}function gD(e,t){let r=Fse(e);return t?r.map((i,c)=>c===r.length-1?i.pathname:i.pathnameBase):r.map(i=>i.pathnameBase)}function _D(e,t,r,i){i===void 0&&(i=!1);let c;typeof e=="string"?c=gy(e):(c=$x({},e),Co(!c.pathname||!c.pathname.includes("?"),hI("?","pathname","search",c)),Co(!c.pathname||!c.pathname.includes("#"),hI("#","pathname","hash",c)),Co(!c.search||!c.search.includes("#"),hI("#","search","hash",c)));let d=e===""||c.pathname==="",g=d?"/":c.pathname,o;if(g==null)o=r;else{let C=t.length-1;if(!i&&g.startsWith("..")){let R=g.split("/");for(;R[0]==="..";)R.shift(),C-=1;c.pathname=R.join("/")}o=C>=0?t[C]:"/"}let w=Nse(c,o),T=g&&g!=="/"&&g.endsWith("/"),I=(d||g===".")&&r.endsWith("/");return!w.pathname.endsWith("/")&&(T||I)&&(w.pathname+="/"),w}const Rd=e=>e.join("/").replace(/\/\/+/g,"/"),Bse=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),$se=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,Use=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function Vse(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const lH=["post","put","patch","delete"];new Set(lH);const Gse=["get",...lH];new Set(Gse);/**
 * React Router v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ux(){return Ux=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ux.apply(this,arguments)}const yD=Q.createContext(null),Hse=Q.createContext(null),qd=Q.createContext(null),_2=Q.createContext(null),Zd=Q.createContext({outlet:null,matches:[],isDataRoute:!1}),cH=Q.createContext(null);function Wse(e,t){let{relative:r}=t===void 0?{}:t;_y()||Co(!1);let{basename:i,navigator:c}=Q.useContext(qd),{hash:d,pathname:g,search:o}=hH(e,{relative:r}),w=g;return i!=="/"&&(w=g==="/"?i:Rd([i,g])),c.createHref({pathname:w,search:o,hash:d})}function _y(){return Q.useContext(_2)!=null}function im(){return _y()||Co(!1),Q.useContext(_2).location}function uH(e){Q.useContext(qd).static||Q.useLayoutEffect(e)}function y2(){let{isDataRoute:e}=Q.useContext(Zd);return e?oae():qse()}function qse(){_y()||Co(!1);let e=Q.useContext(yD),{basename:t,future:r,navigator:i}=Q.useContext(qd),{matches:c}=Q.useContext(Zd),{pathname:d}=im(),g=JSON.stringify(gD(c,r.v7_relativeSplatPath)),o=Q.useRef(!1);return uH(()=>{o.current=!0}),Q.useCallback(function(T,I){if(I===void 0&&(I={}),!o.current)return;if(typeof T=="number"){i.go(T);return}let C=_D(T,JSON.parse(g),d,I.relative==="path");e==null&&t!=="/"&&(C.pathname=C.pathname==="/"?t:Rd([t,C.pathname])),(I.replace?i.replace:i.push)(C,I.state,I)},[t,i,g,d,e])}function hH(e,t){let{relative:r}=t===void 0?{}:t,{future:i}=Q.useContext(qd),{matches:c}=Q.useContext(Zd),{pathname:d}=im(),g=JSON.stringify(gD(c,i.v7_relativeSplatPath));return Q.useMemo(()=>_D(e,JSON.parse(g),d,r==="path"),[e,g,d,r])}function Zse(e,t){return Xse(e,t)}function Xse(e,t,r,i){_y()||Co(!1);let{navigator:c}=Q.useContext(qd),{matches:d}=Q.useContext(Zd),g=d[d.length-1],o=g?g.params:{};g&&g.pathname;let w=g?g.pathnameBase:"/";g&&g.route;let T=im(),I;if(t){var C;let H=typeof t=="string"?gy(t):t;w==="/"||(C=H.pathname)!=null&&C.startsWith(w)||Co(!1),I=H}else I=T;let R=I.pathname||"/",F=R;if(w!=="/"){let H=w.replace(/^\//,"").split("/");F="/"+R.replace(/^\//,"").split("/").slice(H.length).join("/")}let G=Sse(e,{pathname:F}),j=eae(G&&G.map(H=>Object.assign({},H,{params:Object.assign({},o,H.params),pathname:Rd([w,c.encodeLocation?c.encodeLocation(H.pathname).pathname:H.pathname]),pathnameBase:H.pathnameBase==="/"?w:Rd([w,c.encodeLocation?c.encodeLocation(H.pathnameBase).pathname:H.pathnameBase])})),d,r,i);return t&&j?Q.createElement(_2.Provider,{value:{location:Ux({pathname:"/",search:"",hash:"",state:null,key:"default"},I),navigationType:wd.Pop}},j):j}function Kse(){let e=iae(),t=Vse(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,c={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Q.createElement(Q.Fragment,null,Q.createElement("h2",null,"Unexpected Application Error!"),Q.createElement("h3",{style:{fontStyle:"italic"}},t),r?Q.createElement("pre",{style:c},r):null,null)}const Yse=Q.createElement(Kse,null);class Jse extends Q.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,r){return r.location!==t.location||r.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:r.error,location:r.location,revalidation:t.revalidation||r.revalidation}}componentDidCatch(t,r){console.error("React Router caught the following error during render",t,r)}render(){return this.state.error!==void 0?Q.createElement(Zd.Provider,{value:this.props.routeContext},Q.createElement(cH.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Qse(e){let{routeContext:t,match:r,children:i}=e,c=Q.useContext(yD);return c&&c.static&&c.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(c.staticContext._deepestRenderedBoundaryId=r.route.id),Q.createElement(Zd.Provider,{value:t},i)}function eae(e,t,r,i){var c;if(t===void 0&&(t=[]),r===void 0&&(r=null),i===void 0&&(i=null),e==null){var d;if(!r)return null;if(r.errors)e=r.matches;else if((d=i)!=null&&d.v7_partialHydration&&t.length===0&&!r.initialized&&r.matches.length>0)e=r.matches;else return null}let g=e,o=(c=r)==null?void 0:c.errors;if(o!=null){let I=g.findIndex(C=>C.route.id&&(o==null?void 0:o[C.route.id])!==void 0);I>=0||Co(!1),g=g.slice(0,Math.min(g.length,I+1))}let w=!1,T=-1;if(r&&i&&i.v7_partialHydration)for(let I=0;I<g.length;I++){let C=g[I];if((C.route.HydrateFallback||C.route.hydrateFallbackElement)&&(T=I),C.route.id){let{loaderData:R,errors:F}=r,G=C.route.loader&&R[C.route.id]===void 0&&(!F||F[C.route.id]===void 0);if(C.route.lazy||G){w=!0,T>=0?g=g.slice(0,T+1):g=[g[0]];break}}}return g.reduceRight((I,C,R)=>{let F,G=!1,j=null,H=null;r&&(F=o&&C.route.id?o[C.route.id]:void 0,j=C.route.errorElement||Yse,w&&(T<0&&R===0?(G=!0,H=null):T===R&&(G=!0,H=C.route.hydrateFallbackElement||null)));let X=t.concat(g.slice(0,R+1)),q=()=>{let Z;return F?Z=j:G?Z=H:C.route.Component?Z=Q.createElement(C.route.Component,null):C.route.element?Z=C.route.element:Z=I,Q.createElement(Qse,{match:C,routeContext:{outlet:I,matches:X,isDataRoute:r!=null},children:Z})};return r&&(C.route.ErrorBoundary||C.route.errorElement||R===0)?Q.createElement(Jse,{location:r.location,revalidation:r.revalidation,component:j,error:F,children:q(),routeContext:{outlet:null,matches:X,isDataRoute:!0}}):q()},null)}var dH=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(dH||{}),FT=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(FT||{});function tae(e){let t=Q.useContext(yD);return t||Co(!1),t}function rae(e){let t=Q.useContext(Hse);return t||Co(!1),t}function nae(e){let t=Q.useContext(Zd);return t||Co(!1),t}function fH(e){let t=nae(),r=t.matches[t.matches.length-1];return r.route.id||Co(!1),r.route.id}function iae(){var e;let t=Q.useContext(cH),r=rae(FT.UseRouteError),i=fH(FT.UseRouteError);return t!==void 0?t:(e=r.errors)==null?void 0:e[i]}function oae(){let{router:e}=tae(dH.UseNavigateStable),t=fH(FT.UseNavigateStable),r=Q.useRef(!1);return uH(()=>{r.current=!0}),Q.useCallback(function(c,d){d===void 0&&(d={}),r.current&&(typeof c=="number"?e.navigate(c):e.navigate(c,Ux({fromRouteId:t},d)))},[e,t])}function sae(e){let{to:t,replace:r,state:i,relative:c}=e;_y()||Co(!1);let{future:d,static:g}=Q.useContext(qd),{matches:o}=Q.useContext(Zd),{pathname:w}=im(),T=y2(),I=_D(t,gD(o,d.v7_relativeSplatPath),w,c==="path"),C=JSON.stringify(I);return Q.useEffect(()=>T(JSON.parse(C),{replace:r,state:i,relative:c}),[T,C,c,r,i]),null}function Wl(e){Co(!1)}function aae(e){let{basename:t="/",children:r=null,location:i,navigationType:c=wd.Pop,navigator:d,static:g=!1,future:o}=e;_y()&&Co(!1);let w=t.replace(/^\/*/,"/"),T=Q.useMemo(()=>({basename:w,navigator:d,static:g,future:Ux({v7_relativeSplatPath:!1},o)}),[w,o,d,g]);typeof i=="string"&&(i=gy(i));let{pathname:I="/",search:C="",hash:R="",state:F=null,key:G="default"}=i,j=Q.useMemo(()=>{let H=mD(I,w);return H==null?null:{location:{pathname:H,search:C,hash:R,state:F,key:G},navigationType:c}},[w,I,C,R,F,G,c]);return j==null?null:Q.createElement(qd.Provider,{value:T},Q.createElement(_2.Provider,{children:r,value:j}))}function lae(e){let{children:t,location:r}=e;return Zse(sM(t),r)}new Promise(()=>{});function sM(e,t){t===void 0&&(t=[]);let r=[];return Q.Children.forEach(e,(i,c)=>{if(!Q.isValidElement(i))return;let d=[...t,c];if(i.type===Q.Fragment){r.push.apply(r,sM(i.props.children,d));return}i.type!==Wl&&Co(!1),!i.props.index||!i.props.children||Co(!1);let g={id:i.props.id||d.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(g.children=sM(i.props.children,d)),r.push(g)}),r}/**
 * React Router DOM v6.27.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function aM(){return aM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},aM.apply(this,arguments)}function cae(e,t){if(e==null)return{};var r={},i=Object.keys(e),c,d;for(d=0;d<i.length;d++)c=i[d],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function uae(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function hae(e,t){return e.button===0&&(!t||t==="_self")&&!uae(e)}const dae=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],fae="6";try{window.__reactRouterVersion=fae}catch{}const pae="startTransition",LB=RV[pae];function mae(e){let{basename:t,children:r,future:i,window:c}=e,d=Q.useRef();d.current==null&&(d.current=xse({window:c,v5Compat:!0}));let g=d.current,[o,w]=Q.useState({action:g.action,location:g.location}),{v7_startTransition:T}=i||{},I=Q.useCallback(C=>{T&&LB?LB(()=>w(C)):w(C)},[w,T]);return Q.useLayoutEffect(()=>g.listen(I),[g,I]),Q.createElement(aae,{basename:t,children:r,location:o.location,navigationType:o.action,navigator:g,future:i})}const gae=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",_ae=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xs=Q.forwardRef(function(t,r){let{onClick:i,relative:c,reloadDocument:d,replace:g,state:o,target:w,to:T,preventScrollReset:I,viewTransition:C}=t,R=cae(t,dae),{basename:F}=Q.useContext(qd),G,j=!1;if(typeof T=="string"&&_ae.test(T)&&(G=T,gae))try{let Z=new URL(window.location.href),J=T.startsWith("//")?new URL(Z.protocol+T):new URL(T),ne=mD(J.pathname,F);J.origin===Z.origin&&ne!=null?T=ne+J.search+J.hash:j=!0}catch{}let H=Wse(T,{relative:c}),X=yae(T,{replace:g,state:o,target:w,preventScrollReset:I,relative:c,viewTransition:C});function q(Z){i&&i(Z),Z.defaultPrevented||X(Z)}return Q.createElement("a",aM({},R,{href:G||H,onClick:j||d?i:q,ref:r,target:w}))});var zB;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(zB||(zB={}));var NB;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(NB||(NB={}));function yae(e,t){let{target:r,replace:i,state:c,preventScrollReset:d,relative:g,viewTransition:o}=t===void 0?{}:t,w=y2(),T=im(),I=hH(e,{relative:g});return Q.useCallback(C=>{if(hae(C,r)){C.preventDefault();let R=i!==void 0?i:jT(T)===jT(I);w(e,{replace:R,state:c,preventScrollReset:d,relative:g,viewTransition:o})}},[T,w,I,i,c,r,e,d,g,o])}const vae="modulepreload",xae=function(e){return"/"+e},jB={},B1=function(t,r,i){let c=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),o=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));c=Promise.allSettled(r.map(w=>{if(w=xae(w),w in jB)return;jB[w]=!0;const T=w.endsWith(".css"),I=T?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${I}`))return;const C=document.createElement("link");if(C.rel=T?"stylesheet":vae,T||(C.as="script"),C.crossOrigin="",C.href=w,o&&C.setAttribute("nonce",o),document.head.appendChild(C),T)return new Promise((R,F)=>{C.addEventListener("load",R),C.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${w}`)))})}))}function d(g){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=g,window.dispatchEvent(o),!o.defaultPrevented)throw g}return c.then(g=>{for(const o of g||[])o.status==="rejected"&&d(o.reason);return t().catch(d)})},bae=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>B1(async()=>{const{default:i}=await Promise.resolve().then(()=>yy);return{default:i}},void 0).then(({default:i})=>i(...r)):t=fetch,(...r)=>t(...r)};class vD extends Error{constructor(t,r="FunctionsError",i){super(t),this.name=r,this.context=i}}class wae extends vD{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class FB extends vD{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class BB extends vD{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var lM;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(lM||(lM={}));var Sae=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};class Tae{constructor(t,{headers:r={},customFetch:i,region:c=lM.Any}={}){this.url=t,this.headers=r,this.region=c,this.fetch=bae(i)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,r={}){var i;return Sae(this,void 0,void 0,function*(){try{const{headers:c,method:d,body:g}=r;let o={},{region:w}=r;w||(w=this.region);const T=new URL(`${this.url}/${t}`);w&&w!=="any"&&(o["x-region"]=w,T.searchParams.set("forceFunctionRegion",w));let I;g&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)&&(typeof Blob<"u"&&g instanceof Blob||g instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",I=g):typeof g=="string"?(o["Content-Type"]="text/plain",I=g):typeof FormData<"u"&&g instanceof FormData?I=g:(o["Content-Type"]="application/json",I=JSON.stringify(g)));const C=yield this.fetch(T.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),c),body:I}).catch(j=>{throw new wae(j)}),R=C.headers.get("x-relay-error");if(R&&R==="true")throw new FB(C);if(!C.ok)throw new BB(C);let F=((i=C.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),G;return F==="application/json"?G=yield C.json():F==="application/octet-stream"?G=yield C.blob():F==="text/event-stream"?G=C:F==="multipart/form-data"?G=yield C.formData():G=yield C.text(),{data:G,error:null,response:C}}catch(c){return{data:null,error:c,response:c instanceof BB||c instanceof FB?c.context:void 0}}})}}var pa={},xD={},v2={},$1={},x2={},b2={},Eae=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},N_=Eae();const Aae=N_.fetch,pH=N_.fetch.bind(N_),mH=N_.Headers,Pae=N_.Request,Cae=N_.Response,yy=Object.freeze(Object.defineProperty({__proto__:null,Headers:mH,Request:Pae,Response:Cae,default:pH,fetch:Aae},Symbol.toStringTag,{value:"Module"})),Iae=EQ(yy);var w2={};Object.defineProperty(w2,"__esModule",{value:!0});let Oae=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};w2.default=Oae;var gH=gs&&gs.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(b2,"__esModule",{value:!0});const Mae=gH(Iae),Rae=gH(w2);let kae=class{constructor(t){var r,i;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(r=t.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=t.signal,this.isMaybeSingle=(i=t.isMaybeSingle)!==null&&i!==void 0?i:!1,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=Mae.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,r){return this.headers=new Headers(this.headers),this.headers.set(t,r),this}then(t,r){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const i=this.fetch;let c=i(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async d=>{var g,o,w,T;let I=null,C=null,R=null,F=d.status,G=d.statusText;if(d.ok){if(this.method!=="HEAD"){const q=await d.text();q===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((g=this.headers.get("Accept"))===null||g===void 0)&&g.includes("application/vnd.pgrst.plan+text"))?C=q:C=JSON.parse(q))}const H=(o=this.headers.get("Prefer"))===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),X=(w=d.headers.get("content-range"))===null||w===void 0?void 0:w.split("/");H&&X&&X.length>1&&(R=parseInt(X[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(C)&&(C.length>1?(I={code:"PGRST116",details:`Results contain ${C.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},C=null,R=null,F=406,G="Not Acceptable"):C.length===1?C=C[0]:C=null)}else{const H=await d.text();try{I=JSON.parse(H),Array.isArray(I)&&d.status===404&&(C=[],I=null,F=200,G="OK")}catch{d.status===404&&H===""?(F=204,G="No Content"):I={message:H}}if(I&&this.isMaybeSingle&&(!((T=I==null?void 0:I.details)===null||T===void 0)&&T.includes("0 rows"))&&(I=null,F=200,G="OK"),I&&this.shouldThrowOnError)throw new Rae.default(I)}return{error:I,data:C,count:R,status:F,statusText:G}});return this.shouldThrowOnError||(c=c.catch(d=>{var g,o,w;return{error:{message:`${(g=d==null?void 0:d.name)!==null&&g!==void 0?g:"FetchError"}: ${d==null?void 0:d.message}`,details:`${(o=d==null?void 0:d.stack)!==null&&o!==void 0?o:""}`,hint:"",code:`${(w=d==null?void 0:d.code)!==null&&w!==void 0?w:""}`},data:null,count:null,status:0,statusText:""}})),c.then(t,r)}returns(){return this}overrideTypes(){return this}};b2.default=kae;var Dae=gs&&gs.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(x2,"__esModule",{value:!0});const Lae=Dae(b2);let zae=class extends Lae.default{select(t){let r=!1;const i=(t??"*").split("").map(c=>/\s/.test(c)&&!r?"":(c==='"'&&(r=!r),c)).join("");return this.url.searchParams.set("select",i),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:r=!0,nullsFirst:i,foreignTable:c,referencedTable:d=c}={}){const g=d?`${d}.order`:"order",o=this.url.searchParams.get(g);return this.url.searchParams.set(g,`${o?`${o},`:""}${t}.${r?"asc":"desc"}${i===void 0?"":i?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:r,referencedTable:i=r}={}){const c=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(c,`${t}`),this}range(t,r,{foreignTable:i,referencedTable:c=i}={}){const d=typeof c>"u"?"offset":`${c}.offset`,g=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${t}`),this.url.searchParams.set(g,`${r-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:r=!1,settings:i=!1,buffers:c=!1,wal:d=!1,format:g="text"}={}){var o;const w=[t?"analyze":null,r?"verbose":null,i?"settings":null,c?"buffers":null,d?"wal":null].filter(Boolean).join("|"),T=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${g}; for="${T}"; options=${w};`),g==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};x2.default=zae;var Nae=gs&&gs.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($1,"__esModule",{value:!0});const jae=Nae(x2);let Fae=class extends jae.default{eq(t,r){return this.url.searchParams.append(t,`eq.${r}`),this}neq(t,r){return this.url.searchParams.append(t,`neq.${r}`),this}gt(t,r){return this.url.searchParams.append(t,`gt.${r}`),this}gte(t,r){return this.url.searchParams.append(t,`gte.${r}`),this}lt(t,r){return this.url.searchParams.append(t,`lt.${r}`),this}lte(t,r){return this.url.searchParams.append(t,`lte.${r}`),this}like(t,r){return this.url.searchParams.append(t,`like.${r}`),this}likeAllOf(t,r){return this.url.searchParams.append(t,`like(all).{${r.join(",")}}`),this}likeAnyOf(t,r){return this.url.searchParams.append(t,`like(any).{${r.join(",")}}`),this}ilike(t,r){return this.url.searchParams.append(t,`ilike.${r}`),this}ilikeAllOf(t,r){return this.url.searchParams.append(t,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(t,r){return this.url.searchParams.append(t,`ilike(any).{${r.join(",")}}`),this}is(t,r){return this.url.searchParams.append(t,`is.${r}`),this}in(t,r){const i=Array.from(new Set(r)).map(c=>typeof c=="string"&&new RegExp("[,()]").test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(t,`in.(${i})`),this}contains(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cs.{${r.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(r)}`),this}containedBy(t,r){return typeof r=="string"?this.url.searchParams.append(t,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(t,`cd.{${r.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(r)}`),this}rangeGt(t,r){return this.url.searchParams.append(t,`sr.${r}`),this}rangeGte(t,r){return this.url.searchParams.append(t,`nxl.${r}`),this}rangeLt(t,r){return this.url.searchParams.append(t,`sl.${r}`),this}rangeLte(t,r){return this.url.searchParams.append(t,`nxr.${r}`),this}rangeAdjacent(t,r){return this.url.searchParams.append(t,`adj.${r}`),this}overlaps(t,r){return typeof r=="string"?this.url.searchParams.append(t,`ov.${r}`):this.url.searchParams.append(t,`ov.{${r.join(",")}}`),this}textSearch(t,r,{config:i,type:c}={}){let d="";c==="plain"?d="pl":c==="phrase"?d="ph":c==="websearch"&&(d="w");const g=i===void 0?"":`(${i})`;return this.url.searchParams.append(t,`${d}fts${g}.${r}`),this}match(t){return Object.entries(t).forEach(([r,i])=>{this.url.searchParams.append(r,`eq.${i}`)}),this}not(t,r,i){return this.url.searchParams.append(t,`not.${r}.${i}`),this}or(t,{foreignTable:r,referencedTable:i=r}={}){const c=i?`${i}.or`:"or";return this.url.searchParams.append(c,`(${t})`),this}filter(t,r,i){return this.url.searchParams.append(t,`${r}.${i}`),this}};$1.default=Fae;var Bae=gs&&gs.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v2,"__esModule",{value:!0});const M0=Bae($1);let $ae=class{constructor(t,{headers:r={},schema:i,fetch:c}){this.url=t,this.headers=new Headers(r),this.schema=i,this.fetch=c}select(t,{head:r=!1,count:i}={}){const c=r?"HEAD":"GET";let d=!1;const g=(t??"*").split("").map(o=>/\s/.test(o)&&!d?"":(o==='"'&&(d=!d),o)).join("");return this.url.searchParams.set("select",g),i&&this.headers.append("Prefer",`count=${i}`),new M0.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:r,defaultToNull:i=!0}={}){var c;const d="POST";if(r&&this.headers.append("Prefer",`count=${r}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const g=t.reduce((o,w)=>o.concat(Object.keys(w)),[]);if(g.length>0){const o=[...new Set(g)].map(w=>`"${w}"`);this.url.searchParams.set("columns",o.join(","))}}return new M0.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}upsert(t,{onConflict:r,ignoreDuplicates:i=!1,count:c,defaultToNull:d=!0}={}){var g;const o="POST";if(this.headers.append("Prefer",`resolution=${i?"ignore":"merge"}-duplicates`),r!==void 0&&this.url.searchParams.set("on_conflict",r),c&&this.headers.append("Prefer",`count=${c}`),d||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const w=t.reduce((T,I)=>T.concat(Object.keys(I)),[]);if(w.length>0){const T=[...new Set(w)].map(I=>`"${I}"`);this.url.searchParams.set("columns",T.join(","))}}return new M0.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}update(t,{count:r}={}){var i;const c="PATCH";return r&&this.headers.append("Prefer",`count=${r}`),new M0.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}delete({count:t}={}){var r;const i="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new M0.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}};v2.default=$ae;var _H=gs&&gs.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xD,"__esModule",{value:!0});const Uae=_H(v2),Vae=_H($1);let Gae=class yH{constructor(t,{headers:r={},schema:i,fetch:c}={}){this.url=t,this.headers=new Headers(r),this.schemaName=i,this.fetch=c}from(t){const r=new URL(`${this.url}/${t}`);return new Uae.default(r,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new yH(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,r={},{head:i=!1,get:c=!1,count:d}={}){var g;let o;const w=new URL(`${this.url}/rpc/${t}`);let T;i||c?(o=i?"HEAD":"GET",Object.entries(r).filter(([C,R])=>R!==void 0).map(([C,R])=>[C,Array.isArray(R)?`{${R.join(",")}}`:`${R}`]).forEach(([C,R])=>{w.searchParams.append(C,R)})):(o="POST",T=r);const I=new Headers(this.headers);return d&&I.set("Prefer",`count=${d}`),new Vae.default({method:o,url:w,headers:I,schema:this.schemaName,body:T,fetch:(g=this.fetch)!==null&&g!==void 0?g:fetch})}};xD.default=Gae;var vy=gs&&gs.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(pa,"__esModule",{value:!0});pa.PostgrestError=pa.PostgrestBuilder=pa.PostgrestTransformBuilder=pa.PostgrestFilterBuilder=pa.PostgrestQueryBuilder=pa.PostgrestClient=void 0;const vH=vy(xD);pa.PostgrestClient=vH.default;const xH=vy(v2);pa.PostgrestQueryBuilder=xH.default;const bH=vy($1);pa.PostgrestFilterBuilder=bH.default;const wH=vy(x2);pa.PostgrestTransformBuilder=wH.default;const SH=vy(b2);pa.PostgrestBuilder=SH.default;const TH=vy(w2);pa.PostgrestError=TH.default;var Hae=pa.default={PostgrestClient:vH.default,PostgrestQueryBuilder:xH.default,PostgrestFilterBuilder:bH.default,PostgrestTransformBuilder:wH.default,PostgrestBuilder:SH.default,PostgrestError:TH.default};const{PostgrestClient:Wae,PostgrestQueryBuilder:zje,PostgrestFilterBuilder:Nje,PostgrestTransformBuilder:jje,PostgrestBuilder:Fje,PostgrestError:Bje}=Hae;function qae(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const Zae=qae(),Xae="2.11.15",Kae=`realtime-js/${Xae}`,Yae="1.0.0",EH=1e4,Jae=1e3;var cx;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(cx||(cx={}));var Os;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(Os||(Os={}));var Ql;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Ql||(Ql={}));var cM;(function(e){e.websocket="websocket"})(cM||(cM={}));var xp;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(xp||(xp={}));class Qae{constructor(){this.HEADER_LENGTH=1}decode(t,r){return t.constructor===ArrayBuffer?r(this._binaryDecode(t)):r(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const r=new DataView(t),i=new TextDecoder;return this._decodeBroadcast(t,r,i)}_decodeBroadcast(t,r,i){const c=r.getUint8(1),d=r.getUint8(2);let g=this.HEADER_LENGTH+2;const o=i.decode(t.slice(g,g+c));g=g+c;const w=i.decode(t.slice(g,g+d));g=g+d;const T=JSON.parse(i.decode(t.slice(g,t.byteLength)));return{ref:null,topic:o,event:w,payload:T}}}class AH{constructor(t,r){this.callback=t,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var qi;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(qi||(qi={}));const $B=(e,t,r={})=>{var i;const c=(i=r.skipTypes)!==null&&i!==void 0?i:[];return Object.keys(t).reduce((d,g)=>(d[g]=ele(g,e,t,c),d),{})},ele=(e,t,r,i)=>{const c=t.find(o=>o.name===e),d=c==null?void 0:c.type,g=r[e];return d&&!i.includes(d)?PH(d,g):uM(g)},PH=(e,t)=>{if(e.charAt(0)==="_"){const r=e.slice(1,e.length);return ile(t,r)}switch(e){case qi.bool:return tle(t);case qi.float4:case qi.float8:case qi.int2:case qi.int4:case qi.int8:case qi.numeric:case qi.oid:return rle(t);case qi.json:case qi.jsonb:return nle(t);case qi.timestamp:return ole(t);case qi.abstime:case qi.date:case qi.daterange:case qi.int4range:case qi.int8range:case qi.money:case qi.reltime:case qi.text:case qi.time:case qi.timestamptz:case qi.timetz:case qi.tsrange:case qi.tstzrange:return uM(t);default:return uM(t)}},uM=e=>e,tle=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},rle=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},nle=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},ile=(e,t)=>{if(typeof e!="string")return e;const r=e.length-1,i=e[r];if(e[0]==="{"&&i==="}"){let d;const g=e.slice(1,r);try{d=JSON.parse("["+g+"]")}catch{d=g?g.split(","):[]}return d.map(o=>PH(t,o))}return e},ole=e=>typeof e=="string"?e.replace(" ","T"):e,CH=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class dI{constructor(t,r,i={},c=EH){this.channel=t,this.event=r,this.payload=i,this.timeout=c,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,r){var i;return this._hasReceived(t)&&r((i=this.receivedResp)===null||i===void 0?void 0:i.response),this.recHooks.push({status:t,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:r}){this.recHooks.filter(i=>i.status===t).forEach(i=>i.callback(r))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var UB;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(UB||(UB={}));class ux{constructor(t,r){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const i=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(i.state,{},c=>{const{onJoin:d,onLeave:g,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ux.syncState(this.state,c,d,g),this.pendingDiffs.forEach(w=>{this.state=ux.syncDiff(this.state,w,d,g)}),this.pendingDiffs=[],o()}),this.channel._on(i.diff,{},c=>{const{onJoin:d,onLeave:g,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(c):(this.state=ux.syncDiff(this.state,c,d,g),o())}),this.onJoin((c,d,g)=>{this.channel._trigger("presence",{event:"join",key:c,currentPresences:d,newPresences:g})}),this.onLeave((c,d,g)=>{this.channel._trigger("presence",{event:"leave",key:c,currentPresences:d,leftPresences:g})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,r,i,c){const d=this.cloneDeep(t),g=this.transformState(r),o={},w={};return this.map(d,(T,I)=>{g[T]||(w[T]=I)}),this.map(g,(T,I)=>{const C=d[T];if(C){const R=I.map(H=>H.presence_ref),F=C.map(H=>H.presence_ref),G=I.filter(H=>F.indexOf(H.presence_ref)<0),j=C.filter(H=>R.indexOf(H.presence_ref)<0);G.length>0&&(o[T]=G),j.length>0&&(w[T]=j)}else o[T]=I}),this.syncDiff(d,{joins:o,leaves:w},i,c)}static syncDiff(t,r,i,c){const{joins:d,leaves:g}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return i||(i=()=>{}),c||(c=()=>{}),this.map(d,(o,w)=>{var T;const I=(T=t[o])!==null&&T!==void 0?T:[];if(t[o]=this.cloneDeep(w),I.length>0){const C=t[o].map(F=>F.presence_ref),R=I.filter(F=>C.indexOf(F.presence_ref)<0);t[o].unshift(...R)}i(o,I,w)}),this.map(g,(o,w)=>{let T=t[o];if(!T)return;const I=w.map(C=>C.presence_ref);T=T.filter(C=>I.indexOf(C.presence_ref)<0),t[o]=T,c(o,T,w),T.length===0&&delete t[o]}),t}static map(t,r){return Object.getOwnPropertyNames(t).map(i=>r(i,t[i]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((r,i)=>{const c=t[i];return"metas"in c?r[i]=c.metas.map(d=>(d.presence_ref=d.phx_ref,delete d.phx_ref,delete d.phx_ref_prev,d)):r[i]=c,r},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var VB;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(VB||(VB={}));var GB;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(GB||(GB={}));var Lu;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Lu||(Lu={}));class bD{constructor(t,r={config:{}},i){this.topic=t,this.params=r,this.socket=i,this.bindings={},this.state=Os.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new dI(this,Ql.join,this.params,this.timeout),this.rejoinTimer=new AH(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Os.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Os.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Os.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Os.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ql.reply,{},(c,d)=>{this._trigger(this._replyEventName(d),c)}),this.presence=new ux(this),this.broadcastEndpointURL=CH(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(t,r=this.timeout){var i,c;if(this.socket.isConnected()||this.socket.connect(),this.state==Os.closed){const{config:{broadcast:d,presence:g,private:o}}=this.params;this._onError(I=>t==null?void 0:t(Lu.CHANNEL_ERROR,I)),this._onClose(()=>t==null?void 0:t(Lu.CLOSED));const w={},T={broadcast:d,presence:g,postgres_changes:(c=(i=this.bindings.postgres_changes)===null||i===void 0?void 0:i.map(I=>I.filter))!==null&&c!==void 0?c:[],private:o};this.socket.accessTokenValue&&(w.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:T},w)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:I})=>{var C;if(this.socket.setAuth(),I===void 0){t==null||t(Lu.SUBSCRIBED);return}else{const R=this.bindings.postgres_changes,F=(C=R==null?void 0:R.length)!==null&&C!==void 0?C:0,G=[];for(let j=0;j<F;j++){const H=R[j],{filter:{event:X,schema:q,table:Z,filter:J}}=H,ne=I&&I[j];if(ne&&ne.event===X&&ne.schema===q&&ne.table===Z&&ne.filter===J)G.push(Object.assign(Object.assign({},H),{id:ne.id}));else{this.unsubscribe(),this.state=Os.errored,t==null||t(Lu.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=G,t&&t(Lu.SUBSCRIBED);return}}).receive("error",I=>{this.state=Os.errored,t==null||t(Lu.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(I).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Lu.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,r={}){return await this.send({type:"presence",event:"track",payload:t},r.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,r,i){return this._on(t,r,i)}async send(t,r={}){var i,c;if(!this._canPush()&&t.type==="broadcast"){const{event:d,payload:g}=t,w={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:d,payload:g,private:this.private}]})};try{const T=await this._fetchWithTimeout(this.broadcastEndpointURL,w,(i=r.timeout)!==null&&i!==void 0?i:this.timeout);return await((c=T.body)===null||c===void 0?void 0:c.cancel()),T.ok?"ok":"error"}catch(T){return T.name==="AbortError"?"timed out":"error"}}else return new Promise(d=>{var g,o,w;const T=this._push(t.type,t,r.timeout||this.timeout);t.type==="broadcast"&&!(!((w=(o=(g=this.params)===null||g===void 0?void 0:g.config)===null||o===void 0?void 0:o.broadcast)===null||w===void 0)&&w.ack)&&d("ok"),T.receive("ok",()=>d("ok")),T.receive("error",()=>d("error")),T.receive("timeout",()=>d("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=Os.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ql.close,"leave",this._joinRef())};this.joinPush.destroy();let i=null;return new Promise(c=>{i=new dI(this,Ql.leave,{},t),i.receive("ok",()=>{r(),c("ok")}).receive("timeout",()=>{r(),c("timed out")}).receive("error",()=>{c("error")}),i.send(),this._canPush()||i.trigger("ok",{})}).finally(()=>{i==null||i.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(t,r,i){const c=new AbortController,d=setTimeout(()=>c.abort(),i),g=await this.socket.fetch(t,Object.assign(Object.assign({},r),{signal:c.signal}));return clearTimeout(d),g}_push(t,r,i=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let c=new dI(this,t,r,i);return this._canPush()?c.send():(c.startTimeout(),this.pushBuffer.push(c)),c}_onMessage(t,r,i){return r}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,r,i){var c,d;const g=t.toLocaleLowerCase(),{close:o,error:w,leave:T,join:I}=Ql;if(i&&[o,w,T,I].indexOf(g)>=0&&i!==this._joinRef())return;let R=this._onMessage(g,r,i);if(r&&!R)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(g)?(c=this.bindings.postgres_changes)===null||c===void 0||c.filter(F=>{var G,j,H;return((G=F.filter)===null||G===void 0?void 0:G.event)==="*"||((H=(j=F.filter)===null||j===void 0?void 0:j.event)===null||H===void 0?void 0:H.toLocaleLowerCase())===g}).map(F=>F.callback(R,i)):(d=this.bindings[g])===null||d===void 0||d.filter(F=>{var G,j,H,X,q,Z;if(["broadcast","presence","postgres_changes"].includes(g))if("id"in F){const J=F.id,ne=(G=F.filter)===null||G===void 0?void 0:G.event;return J&&((j=r.ids)===null||j===void 0?void 0:j.includes(J))&&(ne==="*"||(ne==null?void 0:ne.toLocaleLowerCase())===((H=r.data)===null||H===void 0?void 0:H.type.toLocaleLowerCase()))}else{const J=(q=(X=F==null?void 0:F.filter)===null||X===void 0?void 0:X.event)===null||q===void 0?void 0:q.toLocaleLowerCase();return J==="*"||J===((Z=r==null?void 0:r.event)===null||Z===void 0?void 0:Z.toLocaleLowerCase())}else return F.type.toLocaleLowerCase()===g}).map(F=>{if(typeof R=="object"&&"ids"in R){const G=R.data,{schema:j,table:H,commit_timestamp:X,type:q,errors:Z}=G;R=Object.assign(Object.assign({},{schema:j,table:H,commit_timestamp:X,eventType:q,new:{},old:{},errors:Z}),this._getPayloadRecords(G))}F.callback(R,i)})}_isClosed(){return this.state===Os.closed}_isJoined(){return this.state===Os.joined}_isJoining(){return this.state===Os.joining}_isLeaving(){return this.state===Os.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,r,i){const c=t.toLocaleLowerCase(),d={type:c,filter:r,callback:i};return this.bindings[c]?this.bindings[c].push(d):this.bindings[c]=[d],this}_off(t,r){const i=t.toLocaleLowerCase();return this.bindings[i]=this.bindings[i].filter(c=>{var d;return!(((d=c.type)===null||d===void 0?void 0:d.toLocaleLowerCase())===i&&bD.isEqual(c.filter,r))}),this}static isEqual(t,r){if(Object.keys(t).length!==Object.keys(r).length)return!1;for(const i in t)if(t[i]!==r[i])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Ql.close,{},t)}_onError(t){this._on(Ql.error,{},r=>t(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Os.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const r={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(r.new=$B(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(r.old=$B(t.columns,t.old_record)),r}}const HB=()=>{},sle=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ale{constructor(t,r){var i;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=EH,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=HB,this.ref=0,this.logger=HB,this.conn=null,this.sendBuffer=[],this.serializer=new Qae,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=d=>{let g;return d?g=d:typeof fetch>"u"?g=(...o)=>B1(async()=>{const{default:w}=await Promise.resolve().then(()=>yy);return{default:w}},void 0).then(({default:w})=>w(...o)):g=fetch,(...o)=>g(...o)},this.endPoint=`${t}/${cM.websocket}`,this.httpEndpoint=CH(t),r!=null&&r.transport?this.transport=r.transport:this.transport=null,r!=null&&r.params&&(this.params=r.params),r!=null&&r.timeout&&(this.timeout=r.timeout),r!=null&&r.logger&&(this.logger=r.logger),(r!=null&&r.logLevel||r!=null&&r.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),r!=null&&r.heartbeatIntervalMs&&(this.heartbeatIntervalMs=r.heartbeatIntervalMs);const c=(i=r==null?void 0:r.params)===null||i===void 0?void 0:i.apikey;if(c&&(this.accessTokenValue=c,this.apiKey=c),this.reconnectAfterMs=r!=null&&r.reconnectAfterMs?r.reconnectAfterMs:d=>[1e3,2e3,5e3,1e4][d-1]||1e4,this.encode=r!=null&&r.encode?r.encode:(d,g)=>g(JSON.stringify(d)),this.decode=r!=null&&r.decode?r.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new AH(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(r==null?void 0:r.fetch),r!=null&&r.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(r==null?void 0:r.worker)||!1,this.workerUrl=r==null?void 0:r.workerUrl}this.accessToken=(r==null?void 0:r.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=Zae),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Yae}))}disconnect(t,r){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,r??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(i=>i.teardown()))}getChannels(){return this.channels}async removeChannel(t){const r=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const t=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,r,i){this.logger(t,r,i)}connectionState(){switch(this.conn&&this.conn.readyState){case cx.connecting:return xp.Connecting;case cx.open:return xp.Open;case cx.closing:return xp.Closing;default:return xp.Closed}}isConnected(){return this.connectionState()===xp.Open}channel(t,r={config:{}}){const i=`realtime:${t}`,c=this.getChannels().find(d=>d.topic===i);if(c)return c;{const d=new bD(`realtime:${t}`,r,this);return this.channels.push(d),d}}push(t){const{topic:r,event:i,payload:c,ref:d}=t,g=()=>{this.encode(t,o=>{var w;(w=this.conn)===null||w===void 0||w.send(o)})};this.log("push",`${r} ${i} (${d})`,c),this.isConnected()?g():this.sendBuffer.push(g)}async setAuth(t=null){let r=t||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(i=>{const c={access_token:r,version:Kae};r&&i.updateJoinPayload(c),i.joinedOnce&&i._isJoined()&&i._push(Ql.access_token,{access_token:r})}))}async sendHeartbeat(){var t;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(t=this.conn)===null||t===void 0||t.close(Jae,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let r=this.channels.find(i=>i.topic===t&&(i._isJoined()||i._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${t}"`),r.unsubscribe())}_remove(t){this.channels=this.channels.filter(r=>r.topic!==t.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_onConnMessage(t){this.decode(t.data,r=>{let{topic:i,event:c,payload:d,ref:g}=r;i==="phoenix"&&c==="phx_reply"&&this.heartbeatCallback(r.payload.status=="ok"?"ok":"error"),g&&g===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${d.status||""} ${i} ${c} ${g&&"("+g+")"||""}`,d),Array.from(this.channels).filter(o=>o._isMember(i)).forEach(o=>o._trigger(c,d,g)),this.stateChangeCallbacks.message.forEach(o=>o(r))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(t=>t())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this.workerRef.terminate()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(r=>r(t))}_onConnError(t){this.log("transport",`${t}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(r=>r(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(Ql.error))}_appendParams(t,r){if(Object.keys(r).length===0)return t;const i=t.match(/\?/)?"&":"?",c=new URLSearchParams(r);return`${t}${i}${c}`}_workerObjectUrl(t){let r;if(t)r=t;else{const i=new Blob([sle],{type:"application/javascript"});r=URL.createObjectURL(i)}return r}}class wD extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function rs(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class lle extends wD{constructor(t,r){super(t),this.name="StorageApiError",this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class hM extends wD{constructor(t,r){super(t),this.name="StorageUnknownError",this.originalError=r}}var cle=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};const IH=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>B1(async()=>{const{default:i}=await Promise.resolve().then(()=>yy);return{default:i}},void 0).then(({default:i})=>i(...r)):t=fetch,(...r)=>t(...r)},ule=()=>cle(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield B1(()=>Promise.resolve().then(()=>yy),void 0)).Response:Response}),dM=e=>{if(Array.isArray(e))return e.map(r=>dM(r));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([r,i])=>{const c=r.replace(/([-_][a-z])/gi,d=>d.toUpperCase().replace(/[-_]/g,""));t[c]=dM(i)}),t};var om=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};const fI=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),hle=(e,t,r)=>om(void 0,void 0,void 0,function*(){const i=yield ule();e instanceof i&&!(r!=null&&r.noResolveJson)?e.json().then(c=>{t(new lle(fI(c),e.status||500))}).catch(c=>{t(new hM(fI(c),c))}):t(new hM(fI(e),e))}),dle=(e,t,r,i)=>{const c={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),i&&(c.body=JSON.stringify(i)),Object.assign(Object.assign({},c),r))};function U1(e,t,r,i,c,d){return om(this,void 0,void 0,function*(){return new Promise((g,o)=>{e(r,dle(t,i,c,d)).then(w=>{if(!w.ok)throw w;return i!=null&&i.noResolveJson?w:w.json()}).then(w=>g(w)).catch(w=>hle(w,o,i))})})}function BT(e,t,r,i){return om(this,void 0,void 0,function*(){return U1(e,"GET",t,r,i)})}function ld(e,t,r,i,c){return om(this,void 0,void 0,function*(){return U1(e,"POST",t,i,c,r)})}function fle(e,t,r,i,c){return om(this,void 0,void 0,function*(){return U1(e,"PUT",t,i,c,r)})}function ple(e,t,r,i){return om(this,void 0,void 0,function*(){return U1(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),i)})}function OH(e,t,r,i,c){return om(this,void 0,void 0,function*(){return U1(e,"DELETE",t,i,c,r)})}var da=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};const mle={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},WB={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class gle{constructor(t,r={},i,c){this.url=t,this.headers=r,this.bucketId=i,this.fetch=IH(c)}uploadOrUpdate(t,r,i,c){return da(this,void 0,void 0,function*(){try{let d;const g=Object.assign(Object.assign({},WB),c);let o=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(g.upsert)});const w=g.metadata;typeof Blob<"u"&&i instanceof Blob?(d=new FormData,d.append("cacheControl",g.cacheControl),w&&d.append("metadata",this.encodeMetadata(w)),d.append("",i)):typeof FormData<"u"&&i instanceof FormData?(d=i,d.append("cacheControl",g.cacheControl),w&&d.append("metadata",this.encodeMetadata(w))):(d=i,o["cache-control"]=`max-age=${g.cacheControl}`,o["content-type"]=g.contentType,w&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(w)))),c!=null&&c.headers&&(o=Object.assign(Object.assign({},o),c.headers));const T=this._removeEmptyFolders(r),I=this._getFinalPath(T),C=yield this.fetch(`${this.url}/object/${I}`,Object.assign({method:t,body:d,headers:o},g!=null&&g.duplex?{duplex:g.duplex}:{})),R=yield C.json();return C.ok?{data:{path:T,id:R.Id,fullPath:R.Key},error:null}:{data:null,error:R}}catch(d){if(rs(d))return{data:null,error:d};throw d}})}upload(t,r,i){return da(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,r,i)})}uploadToSignedUrl(t,r,i,c){return da(this,void 0,void 0,function*(){const d=this._removeEmptyFolders(t),g=this._getFinalPath(d),o=new URL(this.url+`/object/upload/sign/${g}`);o.searchParams.set("token",r);try{let w;const T=Object.assign({upsert:WB.upsert},c),I=Object.assign(Object.assign({},this.headers),{"x-upsert":String(T.upsert)});typeof Blob<"u"&&i instanceof Blob?(w=new FormData,w.append("cacheControl",T.cacheControl),w.append("",i)):typeof FormData<"u"&&i instanceof FormData?(w=i,w.append("cacheControl",T.cacheControl)):(w=i,I["cache-control"]=`max-age=${T.cacheControl}`,I["content-type"]=T.contentType);const C=yield this.fetch(o.toString(),{method:"PUT",body:w,headers:I}),R=yield C.json();return C.ok?{data:{path:d,fullPath:R.Key},error:null}:{data:null,error:R}}catch(w){if(rs(w))return{data:null,error:w};throw w}})}createSignedUploadUrl(t,r){return da(this,void 0,void 0,function*(){try{let i=this._getFinalPath(t);const c=Object.assign({},this.headers);r!=null&&r.upsert&&(c["x-upsert"]="true");const d=yield ld(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:c}),g=new URL(this.url+d.url),o=g.searchParams.get("token");if(!o)throw new wD("No token returned by API");return{data:{signedUrl:g.toString(),path:t,token:o},error:null}}catch(i){if(rs(i))return{data:null,error:i};throw i}})}update(t,r,i){return da(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,r,i)})}move(t,r,i){return da(this,void 0,void 0,function*(){try{return{data:yield ld(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:i==null?void 0:i.destinationBucket},{headers:this.headers}),error:null}}catch(c){if(rs(c))return{data:null,error:c};throw c}})}copy(t,r,i){return da(this,void 0,void 0,function*(){try{return{data:{path:(yield ld(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:r,destinationBucket:i==null?void 0:i.destinationBucket},{headers:this.headers})).Key},error:null}}catch(c){if(rs(c))return{data:null,error:c};throw c}})}createSignedUrl(t,r,i){return da(this,void 0,void 0,function*(){try{let c=this._getFinalPath(t),d=yield ld(this.fetch,`${this.url}/object/sign/${c}`,Object.assign({expiresIn:r},i!=null&&i.transform?{transform:i.transform}:{}),{headers:this.headers});const g=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return d={signedUrl:encodeURI(`${this.url}${d.signedURL}${g}`)},{data:d,error:null}}catch(c){if(rs(c))return{data:null,error:c};throw c}})}createSignedUrls(t,r,i){return da(this,void 0,void 0,function*(){try{const c=yield ld(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:r,paths:t},{headers:this.headers}),d=i!=null&&i.download?`&download=${i.download===!0?"":i.download}`:"";return{data:c.map(g=>Object.assign(Object.assign({},g),{signedUrl:g.signedURL?encodeURI(`${this.url}${g.signedURL}${d}`):null})),error:null}}catch(c){if(rs(c))return{data:null,error:c};throw c}})}download(t,r){return da(this,void 0,void 0,function*(){const c=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",d=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),g=d?`?${d}`:"";try{const o=this._getFinalPath(t);return{data:yield(yield BT(this.fetch,`${this.url}/${c}/${o}${g}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(rs(o))return{data:null,error:o};throw o}})}info(t){return da(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{const i=yield BT(this.fetch,`${this.url}/object/info/${r}`,{headers:this.headers});return{data:dM(i),error:null}}catch(i){if(rs(i))return{data:null,error:i};throw i}})}exists(t){return da(this,void 0,void 0,function*(){const r=this._getFinalPath(t);try{return yield ple(this.fetch,`${this.url}/object/${r}`,{headers:this.headers}),{data:!0,error:null}}catch(i){if(rs(i)&&i instanceof hM){const c=i.originalError;if([400,404].includes(c==null?void 0:c.status))return{data:!1,error:i}}throw i}})}getPublicUrl(t,r){const i=this._getFinalPath(t),c=[],d=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";d!==""&&c.push(d);const o=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",w=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});w!==""&&c.push(w);let T=c.join("&");return T!==""&&(T=`?${T}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${i}${T}`)}}}remove(t){return da(this,void 0,void 0,function*(){try{return{data:yield OH(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(r){if(rs(r))return{data:null,error:r};throw r}})}list(t,r,i){return da(this,void 0,void 0,function*(){try{const c=Object.assign(Object.assign(Object.assign({},mle),r),{prefix:t||""});return{data:yield ld(this.fetch,`${this.url}/object/list/${this.bucketId}`,c,{headers:this.headers},i),error:null}}catch(c){if(rs(c))return{data:null,error:c};throw c}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const r=[];return t.width&&r.push(`width=${t.width}`),t.height&&r.push(`height=${t.height}`),t.resize&&r.push(`resize=${t.resize}`),t.format&&r.push(`format=${t.format}`),t.quality&&r.push(`quality=${t.quality}`),r.join("&")}}const _le="2.7.1",yle={"X-Client-Info":`storage-js/${_le}`};var Mg=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};class vle{constructor(t,r={},i){this.url=t,this.headers=Object.assign(Object.assign({},yle),r),this.fetch=IH(i)}listBuckets(){return Mg(this,void 0,void 0,function*(){try{return{data:yield BT(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(rs(t))return{data:null,error:t};throw t}})}getBucket(t){return Mg(this,void 0,void 0,function*(){try{return{data:yield BT(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(r){if(rs(r))return{data:null,error:r};throw r}})}createBucket(t,r={public:!1}){return Mg(this,void 0,void 0,function*(){try{return{data:yield ld(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(rs(i))return{data:null,error:i};throw i}})}updateBucket(t,r){return Mg(this,void 0,void 0,function*(){try{return{data:yield fle(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(rs(i))return{data:null,error:i};throw i}})}emptyBucket(t){return Mg(this,void 0,void 0,function*(){try{return{data:yield ld(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(r){if(rs(r))return{data:null,error:r};throw r}})}deleteBucket(t){return Mg(this,void 0,void 0,function*(){try{return{data:yield OH(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(r){if(rs(r))return{data:null,error:r};throw r}})}}class xle extends vle{constructor(t,r={},i){super(t,r,i)}from(t){return new gle(this.url,this.headers,t,this.fetch)}}const ble="2.50.4";let W0="";typeof Deno<"u"?W0="deno":typeof document<"u"?W0="web":typeof navigator<"u"&&navigator.product==="ReactNative"?W0="react-native":W0="node";const wle={"X-Client-Info":`supabase-js-${W0}/${ble}`},Sle={headers:wle},Tle={schema:"public"},Ele={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ale={};var Ple=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};const Cle=e=>{let t;return e?t=e:typeof fetch>"u"?t=pH:t=fetch,(...r)=>t(...r)},Ile=()=>typeof Headers>"u"?mH:Headers,Ole=(e,t,r)=>{const i=Cle(r),c=Ile();return(d,g)=>Ple(void 0,void 0,void 0,function*(){var o;const w=(o=yield t())!==null&&o!==void 0?o:e;let T=new c(g==null?void 0:g.headers);return T.has("apikey")||T.set("apikey",e),T.has("Authorization")||T.set("Authorization",`Bearer ${w}`),i(d,Object.assign(Object.assign({},g),{headers:T}))})};var Mle=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};function Rle(e){return e.endsWith("/")?e:e+"/"}function kle(e,t){var r,i;const{db:c,auth:d,realtime:g,global:o}=e,{db:w,auth:T,realtime:I,global:C}=t,R={db:Object.assign(Object.assign({},w),c),auth:Object.assign(Object.assign({},T),d),realtime:Object.assign(Object.assign({},I),g),global:Object.assign(Object.assign(Object.assign({},C),o),{headers:Object.assign(Object.assign({},(r=C==null?void 0:C.headers)!==null&&r!==void 0?r:{}),(i=o==null?void 0:o.headers)!==null&&i!==void 0?i:{})}),accessToken:()=>Mle(this,void 0,void 0,function*(){return""})};return e.accessToken?R.accessToken=e.accessToken:delete R.accessToken,R}const MH="2.70.0",$g=30*1e3,fM=3,pI=fM*$g,Dle="http://localhost:9999",Lle="supabase.auth.token",zle={"X-Client-Info":`gotrue-js/${MH}`},pM="X-Supabase-Api-Version",RH={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Nle=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,jle=6e5;class SD extends Error{constructor(t,r,i){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=i}}function In(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Fle extends SD{constructor(t,r,i){super(t,r,i),this.name="AuthApiError",this.status=r,this.code=i}}function Ble(e){return In(e)&&e.name==="AuthApiError"}class kH extends SD{constructor(t,r){super(t),this.name="AuthUnknownError",this.originalError=r}}class Xd extends SD{constructor(t,r,i,c){super(t,i,c),this.name=r,this.status=i}}class id extends Xd{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function $le(e){return In(e)&&e.name==="AuthSessionMissingError"}class bS extends Xd{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class wS extends Xd{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class SS extends Xd{constructor(t,r=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Ule(e){return In(e)&&e.name==="AuthImplicitGrantRedirectError"}class qB extends Xd{constructor(t,r=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class mM extends Xd{constructor(t,r){super(t,"AuthRetryableFetchError",r,void 0)}}function mI(e){return In(e)&&e.name==="AuthRetryableFetchError"}class ZB extends Xd{constructor(t,r,i){super(t,"AuthWeakPasswordError",r,"weak_password"),this.reasons=i}}class hx extends Xd{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const $T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),XB=` 	
\r=`.split(""),Vle=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<XB.length;t+=1)e[XB[t].charCodeAt(0)]=-2;for(let t=0;t<$T.length;t+=1)e[$T[t].charCodeAt(0)]=t;return e})();function KB(e,t,r){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const i=t.queue>>t.queuedBits-6&63;r($T[i]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const i=t.queue>>t.queuedBits-6&63;r($T[i]),t.queuedBits-=6}}function DH(e,t,r){const i=Vle[e];if(i>-1)for(t.queue=t.queue<<6|i,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(i===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function YB(e){const t=[],r=g=>{t.push(String.fromCodePoint(g))},i={utf8seq:0,codepoint:0},c={queue:0,queuedBits:0},d=g=>{Wle(g,i,r)};for(let g=0;g<e.length;g+=1)DH(e.charCodeAt(g),c,d);return t.join("")}function Gle(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function Hle(e,t){for(let r=0;r<e.length;r+=1){let i=e.charCodeAt(r);if(i>55295&&i<=56319){const c=(i-55296)*1024&65535;i=(e.charCodeAt(r+1)-56320&65535|c)+65536,r+=1}Gle(i,t)}}function Wle(e,t,r){if(t.utf8seq===0){if(e<=127){r(e);return}for(let i=1;i<6;i+=1)if(!(e>>7-i&1)){t.utf8seq=i;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&r(t.codepoint)}}function qle(e){const t=[],r={queue:0,queuedBits:0},i=c=>{t.push(c)};for(let c=0;c<e.length;c+=1)DH(e.charCodeAt(c),r,i);return new Uint8Array(t)}function Zle(e){const t=[];return Hle(e,r=>t.push(r)),new Uint8Array(t)}function Xle(e){const t=[],r={queue:0,queuedBits:0},i=c=>{t.push(c)};return e.forEach(c=>KB(c,r,i)),KB(null,r,i),t.join("")}function Kle(e){return Math.round(Date.now()/1e3)+e}function Yle(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const ql=()=>typeof window<"u"&&typeof document<"u",up={tested:!1,writable:!1},dx=()=>{if(!ql())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(up.tested)return up.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),up.tested=!0,up.writable=!0}catch{up.tested=!0,up.writable=!1}return up.writable};function Jle(e){const t={},r=new URL(e);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((c,d)=>{t[d]=c})}catch{}return r.searchParams.forEach((i,c)=>{t[c]=i}),t}const LH=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...r)=>B1(async()=>{const{default:i}=await Promise.resolve().then(()=>yy);return{default:i}},void 0).then(({default:i})=>i(...r)):t=fetch,(...r)=>t(...r)},Qle=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",zH=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},TS=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch{return r}},ES=async(e,t)=>{await e.removeItem(t)};class S2{constructor(){this.promise=new S2.promiseConstructor((t,r)=>{this.resolve=t,this.reject=r})}}S2.promiseConstructor=Promise;function gI(e){const t=e.split(".");if(t.length!==3)throw new hx("Invalid JWT structure");for(let i=0;i<t.length;i++)if(!Nle.test(t[i]))throw new hx("JWT not in base64url format");return{header:JSON.parse(YB(t[0])),payload:JSON.parse(YB(t[1])),signature:qle(t[2]),raw:{header:t[0],payload:t[1]}}}async function ece(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function tce(e,t){return new Promise((i,c)=>{(async()=>{for(let d=0;d<1/0;d++)try{const g=await e(d);if(!t(d,null,g)){i(g);return}}catch(g){if(!t(d,g)){c(g);return}}})()})}function rce(e){return("0"+e.toString(16)).substr(-2)}function nce(){const t=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",i=r.length;let c="";for(let d=0;d<56;d++)c+=r.charAt(Math.floor(Math.random()*i));return c}return crypto.getRandomValues(t),Array.from(t,rce).join("")}async function ice(e){const r=new TextEncoder().encode(e),i=await crypto.subtle.digest("SHA-256",r),c=new Uint8Array(i);return Array.from(c).map(d=>String.fromCharCode(d)).join("")}async function oce(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const r=await ice(e);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Rg(e,t,r=!1){const i=nce();let c=i;r&&(c+="/PASSWORD_RECOVERY"),await zH(e,`${t}-code-verifier`,c);const d=await oce(i);return[d,i===d?"plain":"s256"]}const sce=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ace(e){const t=e.headers.get(pM);if(!t||!t.match(sce))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function lce(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function cce(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const uce=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function kg(e){if(!uce.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var hce=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(e);c<i.length;c++)t.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(e,i[c])&&(r[i[c]]=e[i[c]]);return r};const gp=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),dce=[502,503,504];async function JB(e){var t;if(!Qle(e))throw new mM(gp(e),0);if(dce.includes(e.status))throw new mM(gp(e),e.status);let r;try{r=await e.json()}catch(d){throw new kH(gp(d),d)}let i;const c=ace(e);if(c&&c.getTime()>=RH["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?i=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(i=r.error_code),i){if(i==="weak_password")throw new ZB(gp(r),e.status,((t=r.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(i==="session_not_found")throw new id}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((d,g)=>d&&typeof g=="string",!0))throw new ZB(gp(r),e.status,r.weak_password.reasons);throw new Fle(gp(r),e.status||500,i)}const fce=(e,t,r,i)=>{const c={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?c:(c.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),c.body=JSON.stringify(i),Object.assign(Object.assign({},c),r))};async function ri(e,t,r,i){var c;const d=Object.assign({},i==null?void 0:i.headers);d[pM]||(d[pM]=RH["2024-01-01"].name),i!=null&&i.jwt&&(d.Authorization=`Bearer ${i.jwt}`);const g=(c=i==null?void 0:i.query)!==null&&c!==void 0?c:{};i!=null&&i.redirectTo&&(g.redirect_to=i.redirectTo);const o=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",w=await pce(e,t,r+o,{headers:d,noResolveJson:i==null?void 0:i.noResolveJson},{},i==null?void 0:i.body);return i!=null&&i.xform?i==null?void 0:i.xform(w):{data:Object.assign({},w),error:null}}async function pce(e,t,r,i,c,d){const g=fce(t,i,c,d);let o;try{o=await e(r,Object.assign({},g))}catch(w){throw console.error(w),new mM(gp(w),0)}if(o.ok||await JB(o),i!=null&&i.noResolveJson)return o;try{return await o.json()}catch(w){await JB(w)}}function ku(e){var t;let r=null;yce(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=Kle(e.expires_in)));const i=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:r,user:i},error:null}}function QB(e){const t=ku(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((r,i)=>r&&typeof i=="string",!0)&&(t.data.weak_password=e.weak_password),t}function fd(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function mce(e){return{data:e,error:null}}function gce(e){const{action_link:t,email_otp:r,hashed_token:i,redirect_to:c,verification_type:d}=e,g=hce(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:t,email_otp:r,hashed_token:i,redirect_to:c,verification_type:d},w=Object.assign({},g);return{data:{properties:o,user:w},error:null}}function _ce(e){return e}function yce(e){return e.access_token&&e.refresh_token&&e.expires_in}const _I=["global","local","others"];var vce=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(e);c<i.length;c++)t.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(e,i[c])&&(r[i[c]]=e[i[c]]);return r};class xce{constructor({url:t="",headers:r={},fetch:i}){this.url=t,this.headers=r,this.fetch=LH(i),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,r=_I[0]){if(_I.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${_I.join(", ")}`);try{return await ri(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(i){if(In(i))return{data:null,error:i};throw i}}async inviteUserByEmail(t,r={}){try{return await ri(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:fd})}catch(i){if(In(i))return{data:{user:null},error:i};throw i}}async generateLink(t){try{const{options:r}=t,i=vce(t,["options"]),c=Object.assign(Object.assign({},i),r);return"newEmail"in i&&(c.new_email=i==null?void 0:i.newEmail,delete c.newEmail),await ri(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:c,headers:this.headers,xform:gce,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(In(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(t){try{return await ri(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:fd})}catch(r){if(In(r))return{data:{user:null},error:r};throw r}}async listUsers(t){var r,i,c,d,g,o,w;try{const T={nextPage:null,lastPage:0,total:0},I=await ri(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(i=(r=t==null?void 0:t.page)===null||r===void 0?void 0:r.toString())!==null&&i!==void 0?i:"",per_page:(d=(c=t==null?void 0:t.perPage)===null||c===void 0?void 0:c.toString())!==null&&d!==void 0?d:""},xform:_ce});if(I.error)throw I.error;const C=await I.json(),R=(g=I.headers.get("x-total-count"))!==null&&g!==void 0?g:0,F=(w=(o=I.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&w!==void 0?w:[];return F.length>0&&(F.forEach(G=>{const j=parseInt(G.split(";")[0].split("=")[1].substring(0,1)),H=JSON.parse(G.split(";")[1].split("=")[1]);T[`${H}Page`]=j}),T.total=parseInt(R)),{data:Object.assign(Object.assign({},C),T),error:null}}catch(T){if(In(T))return{data:{users:[]},error:T};throw T}}async getUserById(t){kg(t);try{return await ri(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:fd})}catch(r){if(In(r))return{data:{user:null},error:r};throw r}}async updateUserById(t,r){kg(t);try{return await ri(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:r,headers:this.headers,xform:fd})}catch(i){if(In(i))return{data:{user:null},error:i};throw i}}async deleteUser(t,r=!1){kg(t);try{return await ri(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:r},xform:fd})}catch(i){if(In(i))return{data:{user:null},error:i};throw i}}async _listFactors(t){kg(t.userId);try{const{data:r,error:i}=await ri(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:c=>({data:{factors:c},error:null})});return{data:r,error:i}}catch(r){if(In(r))return{data:null,error:r};throw r}}async _deleteFactor(t){kg(t.userId),kg(t.id);try{return{data:await ri(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(r){if(In(r))return{data:null,error:r};throw r}}}const bce={getItem:e=>dx()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{dx()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{dx()&&globalThis.localStorage.removeItem(e)}};function e4(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}function wce(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Dg={debug:!!(globalThis&&dx()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class NH extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Sce extends NH{}async function Tce(e,t,r){Dg.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const i=new globalThis.AbortController;return t>0&&setTimeout(()=>{i.abort(),Dg.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:i.signal},async c=>{if(c){Dg.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,c.name);try{return await r()}finally{Dg.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,c.name)}}else{if(t===0)throw Dg.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Sce(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Dg.debug)try{const d=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(d,null,"  "))}catch(d){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",d)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}wce();const Ece={url:Dle,storageKey:Lle,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:zle,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function t4(e,t,r){return await r()}class Vx{constructor(t){var r,i;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Vx.nextInstanceID,Vx.nextInstanceID+=1,this.instanceID>0&&ql()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const c=Object.assign(Object.assign({},Ece),t);if(this.logDebugMessages=!!c.debug,typeof c.debug=="function"&&(this.logger=c.debug),this.persistSession=c.persistSession,this.storageKey=c.storageKey,this.autoRefreshToken=c.autoRefreshToken,this.admin=new xce({url:c.url,headers:c.headers,fetch:c.fetch}),this.url=c.url,this.headers=c.headers,this.fetch=LH(c.fetch),this.lock=c.lock||t4,this.detectSessionInUrl=c.detectSessionInUrl,this.flowType=c.flowType,this.hasCustomAuthorizationHeader=c.hasCustomAuthorizationHeader,c.lock?this.lock=c.lock:ql()&&(!((r=globalThis==null?void 0:globalThis.navigator)===null||r===void 0)&&r.locks)?this.lock=Tce:this.lock=t4,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?c.storage?this.storage=c.storage:dx()?this.storage=bce:(this.memoryStorage={},this.storage=e4(this.memoryStorage)):(this.memoryStorage={},this.storage=e4(this.memoryStorage)),ql()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(d){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",d)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async d=>{this._debug("received broadcast notification from other tab or client",d),await this._notifyAllSubscribers(d.data.event,d.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${MH}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const r=Jle(window.location.href);let i="none";if(this._isImplicitGrantCallback(r)?i="implicit":await this._isPKCECallback(r)&&(i="pkce"),ql()&&this.detectSessionInUrl&&i!=="none"){const{data:c,error:d}=await this._getSessionFromURL(r,i);if(d){if(this._debug("#_initialize()","error detecting session from URL",d),Ule(d)){const w=(t=d.details)===null||t===void 0?void 0:t.code;if(w==="identity_already_exists"||w==="identity_not_found"||w==="single_identity_not_deletable")return{error:d}}return await this._removeSession(),{error:d}}const{session:g,redirectType:o}=c;return this._debug("#_initialize()","detected session in URL",g,"redirect type",o),await this._saveSession(g),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",g):await this._notifyAllSubscribers("SIGNED_IN",g)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return In(r)?{error:r}:{error:new kH("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var r,i,c;try{const d=await ri(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(i=(r=t==null?void 0:t.options)===null||r===void 0?void 0:r.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:(c=t==null?void 0:t.options)===null||c===void 0?void 0:c.captchaToken}},xform:ku}),{data:g,error:o}=d;if(o||!g)return{data:{user:null,session:null},error:o};const w=g.session,T=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",w)),{data:{user:T,session:w},error:null}}catch(d){if(In(d))return{data:{user:null,session:null},error:d};throw d}}async signUp(t){var r,i,c;try{let d;if("email"in t){const{email:I,password:C,options:R}=t;let F=null,G=null;this.flowType==="pkce"&&([F,G]=await Rg(this.storage,this.storageKey)),d=await ri(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:R==null?void 0:R.emailRedirectTo,body:{email:I,password:C,data:(r=R==null?void 0:R.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken},code_challenge:F,code_challenge_method:G},xform:ku})}else if("phone"in t){const{phone:I,password:C,options:R}=t;d=await ri(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:I,password:C,data:(i=R==null?void 0:R.data)!==null&&i!==void 0?i:{},channel:(c=R==null?void 0:R.channel)!==null&&c!==void 0?c:"sms",gotrue_meta_security:{captcha_token:R==null?void 0:R.captchaToken}},xform:ku})}else throw new wS("You must provide either an email or phone number and a password");const{data:g,error:o}=d;if(o||!g)return{data:{user:null,session:null},error:o};const w=g.session,T=g.user;return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",w)),{data:{user:T,session:w},error:null}}catch(d){if(In(d))return{data:{user:null,session:null},error:d};throw d}}async signInWithPassword(t){try{let r;if("email"in t){const{email:d,password:g,options:o}=t;r=await ri(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:d,password:g,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:QB})}else if("phone"in t){const{phone:d,password:g,options:o}=t;r=await ri(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:d,password:g,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:QB})}else throw new wS("You must provide either an email or phone number and a password");const{data:i,error:c}=r;return c?{data:{user:null,session:null},error:c}:!i||!i.session||!i.user?{data:{user:null,session:null},error:new bS}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign({user:i.user,session:i.session},i.weak_password?{weakPassword:i.weak_password}:null),error:c})}catch(r){if(In(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(t){var r,i,c,d;return await this._handleProviderSignIn(t.provider,{redirectTo:(r=t.options)===null||r===void 0?void 0:r.redirectTo,scopes:(i=t.options)===null||i===void 0?void 0:i.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:(d=t.options)===null||d===void 0?void 0:d.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:r}=t;if(r==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}async signInWithSolana(t){var r,i,c,d,g,o,w,T,I,C,R,F;let G,j;if("message"in t)G=t.message,j=t.signature;else{const{chain:H,wallet:X,statement:q,options:Z}=t;let J;if(ql())if(typeof X=="object")J=X;else{const he=window;if("solana"in he&&typeof he.solana=="object"&&("signIn"in he.solana&&typeof he.solana.signIn=="function"||"signMessage"in he.solana&&typeof he.solana.signMessage=="function"))J=he.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof X!="object"||!(Z!=null&&Z.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");J=X}const ne=new URL((r=Z==null?void 0:Z.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in J&&J.signIn){const he=await J.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},Z==null?void 0:Z.signInWithSolana),{version:"1",domain:ne.host,uri:ne.href}),q?{statement:q}:null));let me;if(Array.isArray(he)&&he[0]&&typeof he[0]=="object")me=he[0];else if(he&&typeof he=="object"&&"signedMessage"in he&&"signature"in he)me=he;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in me&&"signature"in me&&(typeof me.signedMessage=="string"||me.signedMessage instanceof Uint8Array)&&me.signature instanceof Uint8Array)G=typeof me.signedMessage=="string"?me.signedMessage:new TextDecoder().decode(me.signedMessage),j=me.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in J)||typeof J.signMessage!="function"||!("publicKey"in J)||typeof J!="object"||!J.publicKey||!("toBase58"in J.publicKey)||typeof J.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");G=[`${ne.host} wants you to sign in with your Solana account:`,J.publicKey.toBase58(),...q?["",q,""]:[""],"Version: 1",`URI: ${ne.href}`,`Issued At: ${(c=(i=Z==null?void 0:Z.signInWithSolana)===null||i===void 0?void 0:i.issuedAt)!==null&&c!==void 0?c:new Date().toISOString()}`,...!((d=Z==null?void 0:Z.signInWithSolana)===null||d===void 0)&&d.notBefore?[`Not Before: ${Z.signInWithSolana.notBefore}`]:[],...!((g=Z==null?void 0:Z.signInWithSolana)===null||g===void 0)&&g.expirationTime?[`Expiration Time: ${Z.signInWithSolana.expirationTime}`]:[],...!((o=Z==null?void 0:Z.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${Z.signInWithSolana.chainId}`]:[],...!((w=Z==null?void 0:Z.signInWithSolana)===null||w===void 0)&&w.nonce?[`Nonce: ${Z.signInWithSolana.nonce}`]:[],...!((T=Z==null?void 0:Z.signInWithSolana)===null||T===void 0)&&T.requestId?[`Request ID: ${Z.signInWithSolana.requestId}`]:[],...!((C=(I=Z==null?void 0:Z.signInWithSolana)===null||I===void 0?void 0:I.resources)===null||C===void 0)&&C.length?["Resources",...Z.signInWithSolana.resources.map(me=>`- ${me}`)]:[]].join(`
`);const he=await J.signMessage(new TextEncoder().encode(G),"utf8");if(!he||!(he instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");j=he}}try{const{data:H,error:X}=await ri(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:G,signature:Xle(j)},!((R=t.options)===null||R===void 0)&&R.captchaToken?{gotrue_meta_security:{captcha_token:(F=t.options)===null||F===void 0?void 0:F.captchaToken}}:null),xform:ku});if(X)throw X;return!H||!H.session||!H.user?{data:{user:null,session:null},error:new bS}:(H.session&&(await this._saveSession(H.session),await this._notifyAllSubscribers("SIGNED_IN",H.session)),{data:Object.assign({},H),error:X})}catch(H){if(In(H))return{data:{user:null,session:null},error:H};throw H}}async _exchangeCodeForSession(t){const r=await TS(this.storage,`${this.storageKey}-code-verifier`),[i,c]=(r??"").split("/");try{const{data:d,error:g}=await ri(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:i},xform:ku});if(await ES(this.storage,`${this.storageKey}-code-verifier`),g)throw g;return!d||!d.session||!d.user?{data:{user:null,session:null,redirectType:null},error:new bS}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:Object.assign(Object.assign({},d),{redirectType:c??null}),error:g})}catch(d){if(In(d))return{data:{user:null,session:null,redirectType:null},error:d};throw d}}async signInWithIdToken(t){try{const{options:r,provider:i,token:c,access_token:d,nonce:g}=t,o=await ri(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:i,id_token:c,access_token:d,nonce:g,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:ku}),{data:w,error:T}=o;return T?{data:{user:null,session:null},error:T}:!w||!w.session||!w.user?{data:{user:null,session:null},error:new bS}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:w,error:T})}catch(r){if(In(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(t){var r,i,c,d,g;try{if("email"in t){const{email:o,options:w}=t;let T=null,I=null;this.flowType==="pkce"&&([T,I]=await Rg(this.storage,this.storageKey));const{error:C}=await ri(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(r=w==null?void 0:w.data)!==null&&r!==void 0?r:{},create_user:(i=w==null?void 0:w.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},code_challenge:T,code_challenge_method:I},redirectTo:w==null?void 0:w.emailRedirectTo});return{data:{user:null,session:null},error:C}}if("phone"in t){const{phone:o,options:w}=t,{data:T,error:I}=await ri(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(c=w==null?void 0:w.data)!==null&&c!==void 0?c:{},create_user:(d=w==null?void 0:w.shouldCreateUser)!==null&&d!==void 0?d:!0,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken},channel:(g=w==null?void 0:w.channel)!==null&&g!==void 0?g:"sms"}});return{data:{user:null,session:null,messageId:T==null?void 0:T.message_id},error:I}}throw new wS("You must provide either an email or phone number.")}catch(o){if(In(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(t){var r,i;try{let c,d;"options"in t&&(c=(r=t.options)===null||r===void 0?void 0:r.redirectTo,d=(i=t.options)===null||i===void 0?void 0:i.captchaToken);const{data:g,error:o}=await ri(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:d}}),redirectTo:c,xform:ku});if(o)throw o;if(!g)throw new Error("An error occurred on token verification.");const w=g.session,T=g.user;return w!=null&&w.access_token&&(await this._saveSession(w),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",w)),{data:{user:T,session:w},error:null}}catch(c){if(In(c))return{data:{user:null,session:null},error:c};throw c}}async signInWithSSO(t){var r,i,c;try{let d=null,g=null;return this.flowType==="pkce"&&([d,g]=await Rg(this.storage,this.storageKey)),await ri(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(i=(r=t.options)===null||r===void 0?void 0:r.redirectTo)!==null&&i!==void 0?i:void 0}),!((c=t==null?void 0:t.options)===null||c===void 0)&&c.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:d,code_challenge_method:g}),headers:this.headers,xform:mce})}catch(d){if(In(d))return{data:null,error:d};throw d}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:r},error:i}=t;if(i)throw i;if(!r)throw new id;const{error:c}=await ri(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:c}})}catch(t){if(In(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const r=`${this.url}/resend`;if("email"in t){const{email:i,type:c,options:d}=t,{error:g}=await ri(this.fetch,"POST",r,{headers:this.headers,body:{email:i,type:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}},redirectTo:d==null?void 0:d.emailRedirectTo});return{data:{user:null,session:null},error:g}}else if("phone"in t){const{phone:i,type:c,options:d}=t,{data:g,error:o}=await ri(this.fetch,"POST",r,{headers:this.headers,body:{phone:i,type:c,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken}}});return{data:{user:null,session:null,messageId:g==null?void 0:g.message_id},error:o}}throw new wS("You must provide either an email or phone number and a type")}catch(r){if(In(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(t,r){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const i=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await i,await r()))();return this.pendingInLock.push((async()=>{try{await c}catch{}})()),c}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const i=r();for(this.pendingInLock.push((async()=>{try{await i}catch{}})()),await i;this.pendingInLock.length;){const c=[...this.pendingInLock];await Promise.all(c),this.pendingInLock.splice(0,c.length)}return await i}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await t(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const r=await TS(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?t=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const i=t.expires_at?t.expires_at*1e3-Date.now()<pI:!1;if(this._debug("#__loadSession()",`session has${i?"":" not"} expired`,"expires_at",t.expires_at),!i){if(this.storage.isServer){let g=this.suppressGetSessionWarning;t=new Proxy(t,{get:(w,T,I)=>(!g&&T==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),g=!0,this.suppressGetSessionWarning=!0),Reflect.get(w,T,I))})}return{data:{session:t},error:null}}const{session:c,error:d}=await this._callRefreshToken(t.refresh_token);return d?{data:{session:null},error:d}:{data:{session:c},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await ri(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:fd}):await this._useSession(async r=>{var i,c,d;const{data:g,error:o}=r;if(o)throw o;return!(!((i=g.session)===null||i===void 0)&&i.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new id}:await ri(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(d=(c=g.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0,xform:fd})})}catch(r){if(In(r))return $le(r)&&(await this._removeSession(),await ES(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(t,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,r))}async _updateUser(t,r={}){try{return await this._useSession(async i=>{const{data:c,error:d}=i;if(d)throw d;if(!c.session)throw new id;const g=c.session;let o=null,w=null;this.flowType==="pkce"&&t.email!=null&&([o,w]=await Rg(this.storage,this.storageKey));const{data:T,error:I}=await ri(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:o,code_challenge_method:w}),jwt:g.access_token,xform:fd});if(I)throw I;return g.user=T.user,await this._saveSession(g),await this._notifyAllSubscribers("USER_UPDATED",g),{data:{user:g.user},error:null}})}catch(i){if(In(i))return{data:{user:null},error:i};throw i}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new id;const r=Date.now()/1e3;let i=r,c=!0,d=null;const{payload:g}=gI(t.access_token);if(g.exp&&(i=g.exp,c=i<=r),c){const{session:o,error:w}=await this._callRefreshToken(t.refresh_token);if(w)return{data:{user:null,session:null},error:w};if(!o)return{data:{user:null,session:null},error:null};d=o}else{const{data:o,error:w}=await this._getUser(t.access_token);if(w)throw w;d={access_token:t.access_token,refresh_token:t.refresh_token,user:o.user,token_type:"bearer",expires_in:i-r,expires_at:i},await this._saveSession(d),await this._notifyAllSubscribers("SIGNED_IN",d)}return{data:{user:d.user,session:d},error:null}}catch(r){if(In(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async r=>{var i;if(!t){const{data:g,error:o}=r;if(o)throw o;t=(i=g.session)!==null&&i!==void 0?i:void 0}if(!(t!=null&&t.refresh_token))throw new id;const{session:c,error:d}=await this._callRefreshToken(t.refresh_token);return d?{data:{user:null,session:null},error:d}:c?{data:{user:c.user,session:c},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(In(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(t,r){try{if(!ql())throw new SS("No browser detected.");if(t.error||t.error_description||t.error_code)throw new SS(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new qB("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new SS("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new qB("No code detected.");const{data:q,error:Z}=await this._exchangeCodeForSession(t.code);if(Z)throw Z;const J=new URL(window.location.href);return J.searchParams.delete("code"),window.history.replaceState(window.history.state,"",J.toString()),{data:{session:q.session,redirectType:null},error:null}}const{provider_token:i,provider_refresh_token:c,access_token:d,refresh_token:g,expires_in:o,expires_at:w,token_type:T}=t;if(!d||!o||!g||!T)throw new SS("No session defined in URL");const I=Math.round(Date.now()/1e3),C=parseInt(o);let R=I+C;w&&(R=parseInt(w));const F=R-I;F*1e3<=$g&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${F}s, should have been closer to ${C}s`);const G=R-C;I-G>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",G,R,I):I-G<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",G,R,I);const{data:j,error:H}=await this._getUser(d);if(H)throw H;const X={provider_token:i,provider_refresh_token:c,access_token:d,expires_in:C,expires_at:R,refresh_token:g,token_type:T,user:j.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:X,redirectType:t.type},error:null}}catch(i){if(In(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const r=await TS(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&r)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async r=>{var i;const{data:c,error:d}=r;if(d)return{error:d};const g=(i=c.session)===null||i===void 0?void 0:i.access_token;if(g){const{error:o}=await this.admin.signOut(g,t);if(o&&!(Ble(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return t!=="others"&&(await this._removeSession(),await ES(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const r=Yle(),i={id:r,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,i),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:i}}}async _emitInitialSession(t){return await this._useSession(async r=>{var i,c;try{const{data:{session:d},error:g}=r;if(g)throw g;await((i=this.stateChangeEmitters.get(t))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",t,"session",d)}catch(d){await((c=this.stateChangeEmitters.get(t))===null||c===void 0?void 0:c.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",d),console.error(d)}})}async resetPasswordForEmail(t,r={}){let i=null,c=null;this.flowType==="pkce"&&([i,c]=await Rg(this.storage,this.storageKey,!0));try{return await ri(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:i,code_challenge_method:c,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(d){if(In(d))return{data:null,error:d};throw d}}async getUserIdentities(){var t;try{const{data:r,error:i}=await this.getUser();if(i)throw i;return{data:{identities:(t=r.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(r){if(In(r))return{data:null,error:r};throw r}}async linkIdentity(t){var r;try{const{data:i,error:c}=await this._useSession(async d=>{var g,o,w,T,I;const{data:C,error:R}=d;if(R)throw R;const F=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(g=t.options)===null||g===void 0?void 0:g.redirectTo,scopes:(o=t.options)===null||o===void 0?void 0:o.scopes,queryParams:(w=t.options)===null||w===void 0?void 0:w.queryParams,skipBrowserRedirect:!0});return await ri(this.fetch,"GET",F,{headers:this.headers,jwt:(I=(T=C.session)===null||T===void 0?void 0:T.access_token)!==null&&I!==void 0?I:void 0})});if(c)throw c;return ql()&&!(!((r=t.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(i==null?void 0:i.url),{data:{provider:t.provider,url:i==null?void 0:i.url},error:null}}catch(i){if(In(i))return{data:{provider:t.provider,url:null},error:i};throw i}}async unlinkIdentity(t){try{return await this._useSession(async r=>{var i,c;const{data:d,error:g}=r;if(g)throw g;return await ri(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(c=(i=d.session)===null||i===void 0?void 0:i.access_token)!==null&&c!==void 0?c:void 0})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _refreshAccessToken(t){const r=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(r,"begin");try{const i=Date.now();return await tce(async c=>(c>0&&await ece(200*Math.pow(2,c-1)),this._debug(r,"refreshing attempt",c),await ri(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:ku})),(c,d)=>{const g=200*Math.pow(2,c);return d&&mI(d)&&Date.now()+g-i<$g})}catch(i){if(this._debug(r,"error",i),In(i))return{data:{session:null,user:null},error:i};throw i}finally{this._debug(r,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,r){const i=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",r,"url",i),ql()&&!r.skipBrowserRedirect&&window.location.assign(i),{data:{provider:t,url:i},error:null}}async _recoverAndRefresh(){var t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await TS(this.storage,this.storageKey);if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const c=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<pI;if(this._debug(r,`session has${c?"":" not"} expired with margin of ${pI}s`),c){if(this.autoRefreshToken&&i.refresh_token){const{error:d}=await this._callRefreshToken(i.refresh_token);d&&(console.error(d),mI(d)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",d),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var r,i;if(!t)throw new id;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const c=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(c,"begin");try{this.refreshingDeferred=new S2;const{data:d,error:g}=await this._refreshAccessToken(t);if(g)throw g;if(!d.session)throw new id;await this._saveSession(d.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",d.session);const o={session:d.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(d){if(this._debug(c,"error",d),In(d)){const g={session:null,error:d};return mI(d)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(g),g}throw(i=this.refreshingDeferred)===null||i===void 0||i.reject(d),d}finally{this.refreshingDeferred=null,this._debug(c,"end")}}async _notifyAllSubscribers(t,r,i=!0){const c=`#_notifyAllSubscribers(${t})`;this._debug(c,"begin",r,`broadcast = ${i}`);try{this.broadcastChannel&&i&&this.broadcastChannel.postMessage({event:t,session:r});const d=[],g=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(t,r)}catch(w){d.push(w)}});if(await Promise.all(g),d.length>0){for(let o=0;o<d.length;o+=1)console.error(d[o]);throw d[0]}}finally{this._debug(c,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0,await zH(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await ES(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ql()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),$g);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async r=>{const{data:{session:i}}=r;if(!i||!i.refresh_token||!i.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const c=Math.floor((i.expires_at*1e3-t)/$g);this._debug("#_autoRefreshTokenTick()",`access token expires in ${c} ticks, a tick lasts ${$g}ms, refresh threshold is ${fM} ticks`),c<=fM&&await this._callRefreshToken(i.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof NH)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ql()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const r=`#_onVisibilityChanged(${t})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,r,i){const c=[`provider=${encodeURIComponent(r)}`];if(i!=null&&i.redirectTo&&c.push(`redirect_to=${encodeURIComponent(i.redirectTo)}`),i!=null&&i.scopes&&c.push(`scopes=${encodeURIComponent(i.scopes)}`),this.flowType==="pkce"){const[d,g]=await Rg(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(d)}`,code_challenge_method:`${encodeURIComponent(g)}`});c.push(o.toString())}if(i!=null&&i.queryParams){const d=new URLSearchParams(i.queryParams);c.push(d.toString())}return i!=null&&i.skipBrowserRedirect&&c.push(`skip_http_redirect=${i.skipBrowserRedirect}`),`${t}?${c.join("&")}`}async _unenroll(t){try{return await this._useSession(async r=>{var i;const{data:c,error:d}=r;return d?{data:null,error:d}:await ri(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(i=c==null?void 0:c.session)===null||i===void 0?void 0:i.access_token})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _enroll(t){try{return await this._useSession(async r=>{var i,c;const{data:d,error:g}=r;if(g)return{data:null,error:g};const o=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:w,error:T}=await ri(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(i=d==null?void 0:d.session)===null||i===void 0?void 0:i.access_token});return T?{data:null,error:T}:(t.factorType==="totp"&&(!((c=w==null?void 0:w.totp)===null||c===void 0)&&c.qr_code)&&(w.totp.qr_code=`data:image/svg+xml;utf-8,${w.totp.qr_code}`),{data:w,error:null})})}catch(r){if(In(r))return{data:null,error:r};throw r}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var i;const{data:c,error:d}=r;if(d)return{data:null,error:d};const{data:g,error:o}=await ri(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(i=c==null?void 0:c.session)===null||i===void 0?void 0:i.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+g.expires_in},g)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",g),{data:g,error:o})})}catch(r){if(In(r))return{data:null,error:r};throw r}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var i;const{data:c,error:d}=r;return d?{data:null,error:d}:await ri(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(i=c==null?void 0:c.session)===null||i===void 0?void 0:i.access_token})})}catch(r){if(In(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(t){const{data:r,error:i}=await this._challenge({factorId:t.factorId});return i?{data:null,error:i}:await this._verify({factorId:t.factorId,challengeId:r.id,code:t.code})}async _listFactors(){const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const i=(t==null?void 0:t.factors)||[],c=i.filter(g=>g.factor_type==="totp"&&g.status==="verified"),d=i.filter(g=>g.factor_type==="phone"&&g.status==="verified");return{data:{all:i,totp:c,phone:d},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var r,i;const{data:{session:c},error:d}=t;if(d)return{data:null,error:d};if(!c)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:g}=gI(c.access_token);let o=null;g.aal&&(o=g.aal);let w=o;((i=(r=c.user.factors)===null||r===void 0?void 0:r.filter(C=>C.status==="verified"))!==null&&i!==void 0?i:[]).length>0&&(w="aal2");const I=g.amr||[];return{data:{currentLevel:o,nextLevel:w,currentAuthenticationMethods:I},error:null}}))}async fetchJwk(t,r={keys:[]}){let i=r.keys.find(g=>g.kid===t);if(i||(i=this.jwks.keys.find(g=>g.kid===t),i&&this.jwks_cached_at+jle>Date.now()))return i;const{data:c,error:d}=await ri(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(d)throw d;if(!c.keys||c.keys.length===0)throw new hx("JWKS is empty");if(this.jwks=c,this.jwks_cached_at=Date.now(),i=c.keys.find(g=>g.kid===t),!i)throw new hx("No matching signing key found in JWKS");return i}async getClaims(t,r={keys:[]}){try{let i=t;if(!i){const{data:F,error:G}=await this.getSession();if(G||!F.session)return{data:null,error:G};i=F.session.access_token}const{header:c,payload:d,signature:g,raw:{header:o,payload:w}}=gI(i);if(lce(d.exp),!c.kid||c.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:F}=await this.getUser(i);if(F)throw F;return{data:{claims:d,header:c,signature:g},error:null}}const T=cce(c.alg),I=await this.fetchJwk(c.kid,r),C=await crypto.subtle.importKey("jwk",I,T,!0,["verify"]);if(!await crypto.subtle.verify(T,C,g,Zle(`${o}.${w}`)))throw new hx("Invalid JWT signature");return{data:{claims:d,header:c,signature:g},error:null}}catch(i){if(In(i))return{data:null,error:i};throw i}}}Vx.nextInstanceID=0;const Ace=Vx;class Pce extends Ace{constructor(t){super(t)}}var Cce=function(e,t,r,i){function c(d){return d instanceof r?d:new r(function(g){g(d)})}return new(r||(r=Promise))(function(d,g){function o(I){try{T(i.next(I))}catch(C){g(C)}}function w(I){try{T(i.throw(I))}catch(C){g(C)}}function T(I){I.done?d(I.value):c(I.value).then(o,w)}T((i=i.apply(e,t||[])).next())})};class Ice{constructor(t,r,i){var c,d,g;if(this.supabaseUrl=t,this.supabaseKey=r,!t)throw new Error("supabaseUrl is required.");if(!r)throw new Error("supabaseKey is required.");const o=Rle(t),w=new URL(o);this.realtimeUrl=new URL("realtime/v1",w),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",w),this.storageUrl=new URL("storage/v1",w),this.functionsUrl=new URL("functions/v1",w);const T=`sb-${w.hostname.split(".")[0]}-auth-token`,I={db:Tle,realtime:Ale,auth:Object.assign(Object.assign({},Ele),{storageKey:T}),global:Sle},C=kle(i??{},I);this.storageKey=(c=C.auth.storageKey)!==null&&c!==void 0?c:"",this.headers=(d=C.global.headers)!==null&&d!==void 0?d:{},C.accessToken?(this.accessToken=C.accessToken,this.auth=new Proxy({},{get:(R,F)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(F)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((g=C.auth)!==null&&g!==void 0?g:{},this.headers,C.global.fetch),this.fetch=Ole(r,this._getAccessToken.bind(this),C.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},C.realtime)),this.rest=new Wae(new URL("rest/v1",w).href,{headers:this.headers,schema:C.db.schema,fetch:this.fetch}),C.accessToken||this._listenForAuthEvents()}get functions(){return new Tae(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new xle(this.storageUrl.href,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,r={},i={}){return this.rest.rpc(t,r,i)}channel(t,r={config:{}}){return this.realtime.channel(t,r)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,r;return Cce(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:i}=yield this.auth.getSession();return(r=(t=i.session)===null||t===void 0?void 0:t.access_token)!==null&&r!==void 0?r:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:r,detectSessionInUrl:i,storage:c,storageKey:d,flowType:g,lock:o,debug:w},T,I){const C={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Pce({url:this.authUrl.href,headers:Object.assign(Object.assign({},C),T),storageKey:d,autoRefreshToken:t,persistSession:r,detectSessionInUrl:i,storage:c,flowType:g,lock:o,debug:w,fetch:I,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new ale(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((r,i)=>{this._handleTokenChanged(r,"CLIENT",i==null?void 0:i.access_token)})}_handleTokenChanged(t,r,i){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==i?this.changedAccessToken=i:t==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Oce=(e,t,r)=>new Ice(e,t,r),Mce="https://jxyjxoesikdbayyfqkdp.supabase.co",Rce="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4eWp4b2VzaWtkYmF5eWZxa2RwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MzQxODUsImV4cCI6MjA2NzMxMDE4NX0.9W8jr19MrfQh9PUWaLaUIv7YcMgKwTRmVSQXVgDvpzg",ja=Oce(Mce,Rce,{auth:{storage:localStorage,persistSession:!0,autoRefreshToken:!0}}),jH=Q.createContext(void 0),Kd=()=>{const e=Q.useContext(jH);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},kce=({children:e})=>{const[t,r]=Q.useState(null),[i,c]=Q.useState(null),[d,g]=Q.useState(!0);Q.useEffect(()=>{const{data:{subscription:C}}=ja.auth.onAuthStateChange((R,F)=>{console.log("Auth state changed:",R,F),c(F),r((F==null?void 0:F.user)??null),g(!1)});return ja.auth.getSession().then(({data:{session:R}})=>{c(R),r((R==null?void 0:R.user)??null),g(!1)}),()=>C.unsubscribe()},[]);const I={user:t,session:i,loading:d,signUp:async(C,R,F)=>{const G=`${window.location.origin}/`,{error:j}=await ja.auth.signUp({email:C,password:R,options:{emailRedirectTo:G,data:{full_name:F}}});return{error:j}},signIn:async(C,R)=>{const{error:F}=await ja.auth.signInWithPassword({email:C,password:R});return{error:F}},signOut:async()=>{await ja.auth.signOut()}};return z.jsx(jH.Provider,{value:I,children:e})},FH=Q.createContext(void 0),Dce=()=>{const e=Q.useContext(FH);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e},Lce=({children:e})=>{const[t,r]=Q.useState(()=>typeof window<"u"&&localStorage.getItem("theme")||"light");Q.useEffect(()=>{const c=window.document.documentElement;c.classList.remove("light","dark"),c.classList.add(t),localStorage.setItem("theme",t)},[t]);const i=()=>{r(c=>c==="light"?"dark":"light")};return z.jsx(FH.Provider,{value:{theme:t,toggleTheme:i},children:e})},td=({children:e,adminOnly:t=!1})=>{const{user:r,loading:i}=Kd();return i?z.jsx("div",{className:"min-h-screen flex items-center justify-center",children:z.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):r?z.jsx(z.Fragment,{children:e}):z.jsx(sae,{to:"/auth"})},zce=j1("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),pi=Q.forwardRef(({className:e,variant:t,size:r,asChild:i=!1,...c},d)=>{const g=i?Nd:"button";return z.jsx(g,{className:zn(zce({variant:t,size:r,className:e})),ref:d,...c})});pi.displayName="Button";var Nce=Q.createContext(void 0);function T2(e){const t=Q.useContext(Nce);return e||t||"ltr"}var yI=0;function TD(){Q.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??r4()),document.body.insertAdjacentElement("beforeend",e[1]??r4()),yI++,()=>{yI===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),yI--}},[])}function r4(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var vI="focusScope.autoFocusOnMount",xI="focusScope.autoFocusOnUnmount",n4={bubbles:!1,cancelable:!0},jce="FocusScope",E2=Q.forwardRef((e,t)=>{const{loop:r=!1,trapped:i=!1,onMountAutoFocus:c,onUnmountAutoFocus:d,...g}=e,[o,w]=Q.useState(null),T=js(c),I=js(d),C=Q.useRef(null),R=Ci(t,j=>w(j)),F=Q.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;Q.useEffect(()=>{if(i){let j=function(Z){if(F.paused||!o)return;const J=Z.target;o.contains(J)?C.current=J:od(C.current,{select:!0})},H=function(Z){if(F.paused||!o)return;const J=Z.relatedTarget;J!==null&&(o.contains(J)||od(C.current,{select:!0}))},X=function(Z){if(document.activeElement===document.body)for(const ne of Z)ne.removedNodes.length>0&&od(o)};document.addEventListener("focusin",j),document.addEventListener("focusout",H);const q=new MutationObserver(X);return o&&q.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",j),document.removeEventListener("focusout",H),q.disconnect()}}},[i,o,F.paused]),Q.useEffect(()=>{if(o){o4.add(F);const j=document.activeElement;if(!o.contains(j)){const X=new CustomEvent(vI,n4);o.addEventListener(vI,T),o.dispatchEvent(X),X.defaultPrevented||(Fce(Gce(BH(o)),{select:!0}),document.activeElement===j&&od(o))}return()=>{o.removeEventListener(vI,T),setTimeout(()=>{const X=new CustomEvent(xI,n4);o.addEventListener(xI,I),o.dispatchEvent(X),X.defaultPrevented||od(j??document.body,{select:!0}),o.removeEventListener(xI,I),o4.remove(F)},0)}}},[o,T,I,F]);const G=Q.useCallback(j=>{if(!r&&!i||F.paused)return;const H=j.key==="Tab"&&!j.altKey&&!j.ctrlKey&&!j.metaKey,X=document.activeElement;if(H&&X){const q=j.currentTarget,[Z,J]=Bce(q);Z&&J?!j.shiftKey&&X===J?(j.preventDefault(),r&&od(Z,{select:!0})):j.shiftKey&&X===Z&&(j.preventDefault(),r&&od(J,{select:!0})):X===q&&j.preventDefault()}},[r,i,F.paused]);return z.jsx(Sn.div,{tabIndex:-1,...g,ref:R,onKeyDown:G})});E2.displayName=jce;function Fce(e,{select:t=!1}={}){const r=document.activeElement;for(const i of e)if(od(i,{select:t}),document.activeElement!==r)return}function Bce(e){const t=BH(e),r=i4(t,e),i=i4(t.reverse(),e);return[r,i]}function BH(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:i=>{const c=i.tagName==="INPUT"&&i.type==="hidden";return i.disabled||i.hidden||c?NodeFilter.FILTER_SKIP:i.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function i4(e,t){for(const r of e)if(!$ce(r,{upTo:t}))return r}function $ce(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Uce(e){return e instanceof HTMLInputElement&&"select"in e}function od(e,{select:t=!1}={}){if(e&&e.focus){const r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&Uce(e)&&t&&e.select()}}var o4=Vce();function Vce(){let e=[];return{add(t){const r=e[0];t!==r&&(r==null||r.pause()),e=s4(e,t),e.unshift(t)},remove(t){var r;e=s4(e,t),(r=e[0])==null||r.resume()}}}function s4(e,t){const r=[...e],i=r.indexOf(t);return i!==-1&&r.splice(i,1),r}function Gce(e){return e.filter(t=>t.tagName!=="A")}function Hce(e,t=[]){let r=[];function i(d,g){const o=Q.createContext(g),w=r.length;r=[...r,g];function T(C){const{scope:R,children:F,...G}=C,j=(R==null?void 0:R[e][w])||o,H=Q.useMemo(()=>G,Object.values(G));return z.jsx(j.Provider,{value:H,children:F})}function I(C,R){const F=(R==null?void 0:R[e][w])||o,G=Q.useContext(F);if(G)return G;if(g!==void 0)return g;throw new Error(`\`${C}\` must be used within \`${d}\``)}return T.displayName=d+"Provider",[T,I]}const c=()=>{const d=r.map(g=>Q.createContext(g));return function(o){const w=(o==null?void 0:o[e])||d;return Q.useMemo(()=>({[`__scope${e}`]:{...o,[e]:w}}),[o,w])}};return c.scopeName=e,[i,Wce(c,...t)]}function Wce(...e){const t=e[0];if(e.length===1)return t;const r=()=>{const i=e.map(c=>({useScope:c(),scopeName:c.scopeName}));return function(d){const g=i.reduce((o,{useScope:w,scopeName:T})=>{const C=w(d)[`__scope${T}`];return{...o,...C}},{});return Q.useMemo(()=>({[`__scope${t.scopeName}`]:g}),[g])}};return r.scopeName=t.scopeName,r}var bI="rovingFocusGroup.onEntryFocus",qce={bubbles:!1,cancelable:!0},A2="RovingFocusGroup",[gM,$H,Zce]=a2(A2),[Xce,P2]=Hce(A2,[Zce]),[Kce,Yce]=Xce(A2),UH=Q.forwardRef((e,t)=>z.jsx(gM.Provider,{scope:e.__scopeRovingFocusGroup,children:z.jsx(gM.Slot,{scope:e.__scopeRovingFocusGroup,children:z.jsx(Jce,{...e,ref:t})})}));UH.displayName=A2;var Jce=Q.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,orientation:i,loop:c=!1,dir:d,currentTabStopId:g,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:w,onEntryFocus:T,preventScrollOnEntryFocus:I=!1,...C}=e,R=Q.useRef(null),F=Ci(t,R),G=T2(d),[j=null,H]=Gp({prop:g,defaultProp:o,onChange:w}),[X,q]=Q.useState(!1),Z=js(T),J=$H(r),ne=Q.useRef(!1),[he,me]=Q.useState(0);return Q.useEffect(()=>{const Se=R.current;if(Se)return Se.addEventListener(bI,Z),()=>Se.removeEventListener(bI,Z)},[Z]),z.jsx(Kce,{scope:r,orientation:i,dir:G,loop:c,currentTabStopId:j,onItemFocus:Q.useCallback(Se=>H(Se),[H]),onItemShiftTab:Q.useCallback(()=>q(!0),[]),onFocusableItemAdd:Q.useCallback(()=>me(Se=>Se+1),[]),onFocusableItemRemove:Q.useCallback(()=>me(Se=>Se-1),[]),children:z.jsx(Sn.div,{tabIndex:X||he===0?-1:0,"data-orientation":i,...C,ref:F,style:{outline:"none",...e.style},onMouseDown:Er(e.onMouseDown,()=>{ne.current=!0}),onFocus:Er(e.onFocus,Se=>{const qe=!ne.current;if(Se.target===Se.currentTarget&&qe&&!X){const Ze=new CustomEvent(bI,qce);if(Se.currentTarget.dispatchEvent(Ze),!Ze.defaultPrevented){const He=J().filter(ct=>ct.focusable),Ke=He.find(ct=>ct.active),dt=He.find(ct=>ct.id===j),mt=[Ke,dt,...He].filter(Boolean).map(ct=>ct.ref.current);HH(mt,I)}}ne.current=!1}),onBlur:Er(e.onBlur,()=>q(!1))})})}),VH="RovingFocusGroupItem",GH=Q.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:r,focusable:i=!0,active:c=!1,tabStopId:d,...g}=e,o=Kc(),w=d||o,T=Yce(VH,r),I=T.currentTabStopId===w,C=$H(r),{onFocusableItemAdd:R,onFocusableItemRemove:F}=T;return Q.useEffect(()=>{if(i)return R(),()=>F()},[i,R,F]),z.jsx(gM.ItemSlot,{scope:r,id:w,focusable:i,active:c,children:z.jsx(Sn.span,{tabIndex:I?0:-1,"data-orientation":T.orientation,...g,ref:t,onMouseDown:Er(e.onMouseDown,G=>{i?T.onItemFocus(w):G.preventDefault()}),onFocus:Er(e.onFocus,()=>T.onItemFocus(w)),onKeyDown:Er(e.onKeyDown,G=>{if(G.key==="Tab"&&G.shiftKey){T.onItemShiftTab();return}if(G.target!==G.currentTarget)return;const j=tue(G,T.orientation,T.dir);if(j!==void 0){if(G.metaKey||G.ctrlKey||G.altKey||G.shiftKey)return;G.preventDefault();let X=C().filter(q=>q.focusable).map(q=>q.ref.current);if(j==="last")X.reverse();else if(j==="prev"||j==="next"){j==="prev"&&X.reverse();const q=X.indexOf(G.currentTarget);X=T.loop?rue(X,q+1):X.slice(q+1)}setTimeout(()=>HH(X))}})})})});GH.displayName=VH;var Qce={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function eue(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function tue(e,t,r){const i=eue(e.key,r);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(i))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(i)))return Qce[i]}function HH(e,t=!1){const r=document.activeElement;for(const i of e)if(i===r||(i.focus({preventScroll:t}),document.activeElement!==r))return}function rue(e,t){return e.map((r,i)=>e[(t+i)%e.length])}var WH=UH,qH=GH,nue=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},Lg=new WeakMap,AS=new WeakMap,PS={},wI=0,ZH=function(e){return e&&(e.host||ZH(e.parentNode))},iue=function(e,t){return t.map(function(r){if(e.contains(r))return r;var i=ZH(r);return i&&e.contains(i)?i:(console.error("aria-hidden",r,"in not contained inside",e,". Doing nothing"),null)}).filter(function(r){return!!r})},oue=function(e,t,r,i){var c=iue(t,Array.isArray(e)?e:[e]);PS[r]||(PS[r]=new WeakMap);var d=PS[r],g=[],o=new Set,w=new Set(c),T=function(C){!C||o.has(C)||(o.add(C),T(C.parentNode))};c.forEach(T);var I=function(C){!C||w.has(C)||Array.prototype.forEach.call(C.children,function(R){if(o.has(R))I(R);else try{var F=R.getAttribute(i),G=F!==null&&F!=="false",j=(Lg.get(R)||0)+1,H=(d.get(R)||0)+1;Lg.set(R,j),d.set(R,H),g.push(R),j===1&&G&&AS.set(R,!0),H===1&&R.setAttribute(r,"true"),G||R.setAttribute(i,"true")}catch(X){console.error("aria-hidden: cannot operate on ",R,X)}})};return I(t),o.clear(),wI++,function(){g.forEach(function(C){var R=Lg.get(C)-1,F=d.get(C)-1;Lg.set(C,R),d.set(C,F),R||(AS.has(C)||C.removeAttribute(i),AS.delete(C)),F||C.removeAttribute(r)}),wI--,wI||(Lg=new WeakMap,Lg=new WeakMap,AS=new WeakMap,PS={})}},ED=function(e,t,r){r===void 0&&(r="data-aria-hidden");var i=Array.from(Array.isArray(e)?e:[e]),c=nue(e);return c?(i.push.apply(i,Array.from(c.querySelectorAll("[aria-live]"))),oue(i,c,r,"aria-hidden")):function(){return null}},Wc=function(){return Wc=Object.assign||function(t){for(var r,i=1,c=arguments.length;i<c;i++){r=arguments[i];for(var d in r)Object.prototype.hasOwnProperty.call(r,d)&&(t[d]=r[d])}return t},Wc.apply(this,arguments)};function XH(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(e);c<i.length;c++)t.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(e,i[c])&&(r[i[c]]=e[i[c]]);return r}function sue(e,t,r){if(r||arguments.length===2)for(var i=0,c=t.length,d;i<c;i++)(d||!(i in t))&&(d||(d=Array.prototype.slice.call(t,0,i)),d[i]=t[i]);return e.concat(d||Array.prototype.slice.call(t))}var oT="right-scroll-bar-position",sT="width-before-scroll-bar",aue="with-scroll-bars-hidden",lue="--removed-body-scroll-bar-size";function SI(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function cue(e,t){var r=Q.useState(function(){return{value:e,callback:t,facade:{get current(){return r.value},set current(i){var c=r.value;c!==i&&(r.value=i,r.callback(i,c))}}}})[0];return r.callback=t,r.facade}var uue=typeof window<"u"?Q.useLayoutEffect:Q.useEffect,a4=new WeakMap;function hue(e,t){var r=cue(null,function(i){return e.forEach(function(c){return SI(c,i)})});return uue(function(){var i=a4.get(r);if(i){var c=new Set(i),d=new Set(e),g=r.current;c.forEach(function(o){d.has(o)||SI(o,null)}),d.forEach(function(o){c.has(o)||SI(o,g)})}a4.set(r,e)},[e]),r}function due(e){return e}function fue(e,t){t===void 0&&(t=due);var r=[],i=!1,c={read:function(){if(i)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return r.length?r[r.length-1]:e},useMedium:function(d){var g=t(d,i);return r.push(g),function(){r=r.filter(function(o){return o!==g})}},assignSyncMedium:function(d){for(i=!0;r.length;){var g=r;r=[],g.forEach(d)}r={push:function(o){return d(o)},filter:function(){return r}}},assignMedium:function(d){i=!0;var g=[];if(r.length){var o=r;r=[],o.forEach(d),g=r}var w=function(){var I=g;g=[],I.forEach(d)},T=function(){return Promise.resolve().then(w)};T(),r={push:function(I){g.push(I),T()},filter:function(I){return g=g.filter(I),r}}}};return c}function pue(e){e===void 0&&(e={});var t=fue(null);return t.options=Wc({async:!0,ssr:!1},e),t}var KH=function(e){var t=e.sideCar,r=XH(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var i=t.read();if(!i)throw new Error("Sidecar medium not found");return Q.createElement(i,Wc({},r))};KH.isSideCarExport=!0;function mue(e,t){return e.useMedium(t),KH}var YH=pue(),TI=function(){},C2=Q.forwardRef(function(e,t){var r=Q.useRef(null),i=Q.useState({onScrollCapture:TI,onWheelCapture:TI,onTouchMoveCapture:TI}),c=i[0],d=i[1],g=e.forwardProps,o=e.children,w=e.className,T=e.removeScrollBar,I=e.enabled,C=e.shards,R=e.sideCar,F=e.noIsolation,G=e.inert,j=e.allowPinchZoom,H=e.as,X=H===void 0?"div":H,q=e.gapMode,Z=XH(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),J=R,ne=hue([r,t]),he=Wc(Wc({},Z),c);return Q.createElement(Q.Fragment,null,I&&Q.createElement(J,{sideCar:YH,removeScrollBar:T,shards:C,noIsolation:F,inert:G,setCallbacks:d,allowPinchZoom:!!j,lockRef:r,gapMode:q}),g?Q.cloneElement(Q.Children.only(o),Wc(Wc({},he),{ref:ne})):Q.createElement(X,Wc({},he,{className:w,ref:ne}),o))});C2.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};C2.classNames={fullWidth:sT,zeroRight:oT};var gue=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function _ue(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=gue();return t&&e.setAttribute("nonce",t),e}function yue(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function vue(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var xue=function(){var e=0,t=null;return{add:function(r){e==0&&(t=_ue())&&(yue(t,r),vue(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},bue=function(){var e=xue();return function(t,r){Q.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&r])}},JH=function(){var e=bue(),t=function(r){var i=r.styles,c=r.dynamic;return e(i,c),null};return t},wue={left:0,top:0,right:0,gap:0},EI=function(e){return parseInt(e||"",10)||0},Sue=function(e){var t=window.getComputedStyle(document.body),r=t[e==="padding"?"paddingLeft":"marginLeft"],i=t[e==="padding"?"paddingTop":"marginTop"],c=t[e==="padding"?"paddingRight":"marginRight"];return[EI(r),EI(i),EI(c)]},Tue=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return wue;var t=Sue(e),r=document.documentElement.clientWidth,i=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,i-r+t[2]-t[0])}},Eue=JH(),d_="data-scroll-locked",Aue=function(e,t,r,i){var c=e.left,d=e.top,g=e.right,o=e.gap;return r===void 0&&(r="margin"),`
  .`.concat(aue,` {
   overflow: hidden `).concat(i,`;
   padding-right: `).concat(o,"px ").concat(i,`;
  }
  body[`).concat(d_,`] {
    overflow: hidden `).concat(i,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(i,";"),r==="margin"&&`
    padding-left: `.concat(c,`px;
    padding-top: `).concat(d,`px;
    padding-right: `).concat(g,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(i,`;
    `),r==="padding"&&"padding-right: ".concat(o,"px ").concat(i,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(oT,` {
    right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(sT,` {
    margin-right: `).concat(o,"px ").concat(i,`;
  }
  
  .`).concat(oT," .").concat(oT,` {
    right: 0 `).concat(i,`;
  }
  
  .`).concat(sT," .").concat(sT,` {
    margin-right: 0 `).concat(i,`;
  }
  
  body[`).concat(d_,`] {
    `).concat(lue,": ").concat(o,`px;
  }
`)},l4=function(){var e=parseInt(document.body.getAttribute(d_)||"0",10);return isFinite(e)?e:0},Pue=function(){Q.useEffect(function(){return document.body.setAttribute(d_,(l4()+1).toString()),function(){var e=l4()-1;e<=0?document.body.removeAttribute(d_):document.body.setAttribute(d_,e.toString())}},[])},Cue=function(e){var t=e.noRelative,r=e.noImportant,i=e.gapMode,c=i===void 0?"margin":i;Pue();var d=Q.useMemo(function(){return Tue(c)},[c]);return Q.createElement(Eue,{styles:Aue(d,!t,c,r?"":"!important")})},_M=!1;if(typeof window<"u")try{var CS=Object.defineProperty({},"passive",{get:function(){return _M=!0,!0}});window.addEventListener("test",CS,CS),window.removeEventListener("test",CS,CS)}catch{_M=!1}var zg=_M?{passive:!1}:!1,Iue=function(e){return e.tagName==="TEXTAREA"},QH=function(e,t){if(!(e instanceof Element))return!1;var r=window.getComputedStyle(e);return r[t]!=="hidden"&&!(r.overflowY===r.overflowX&&!Iue(e)&&r[t]==="visible")},Oue=function(e){return QH(e,"overflowY")},Mue=function(e){return QH(e,"overflowX")},c4=function(e,t){var r=t.ownerDocument,i=t;do{typeof ShadowRoot<"u"&&i instanceof ShadowRoot&&(i=i.host);var c=eW(e,i);if(c){var d=tW(e,i),g=d[1],o=d[2];if(g>o)return!0}i=i.parentNode}while(i&&i!==r.body);return!1},Rue=function(e){var t=e.scrollTop,r=e.scrollHeight,i=e.clientHeight;return[t,r,i]},kue=function(e){var t=e.scrollLeft,r=e.scrollWidth,i=e.clientWidth;return[t,r,i]},eW=function(e,t){return e==="v"?Oue(t):Mue(t)},tW=function(e,t){return e==="v"?Rue(t):kue(t)},Due=function(e,t){return e==="h"&&t==="rtl"?-1:1},Lue=function(e,t,r,i,c){var d=Due(e,window.getComputedStyle(t).direction),g=d*i,o=r.target,w=t.contains(o),T=!1,I=g>0,C=0,R=0;do{var F=tW(e,o),G=F[0],j=F[1],H=F[2],X=j-H-d*G;(G||X)&&eW(e,o)&&(C+=X,R+=G),o instanceof ShadowRoot?o=o.host:o=o.parentNode}while(!w&&o!==document.body||w&&(t.contains(o)||t===o));return(I&&(Math.abs(C)<1||!c)||!I&&(Math.abs(R)<1||!c))&&(T=!0),T},IS=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},u4=function(e){return[e.deltaX,e.deltaY]},h4=function(e){return e&&"current"in e?e.current:e},zue=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Nue=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},jue=0,Ng=[];function Fue(e){var t=Q.useRef([]),r=Q.useRef([0,0]),i=Q.useRef(),c=Q.useState(jue++)[0],d=Q.useState(JH)[0],g=Q.useRef(e);Q.useEffect(function(){g.current=e},[e]),Q.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(c));var j=sue([e.lockRef.current],(e.shards||[]).map(h4),!0).filter(Boolean);return j.forEach(function(H){return H.classList.add("allow-interactivity-".concat(c))}),function(){document.body.classList.remove("block-interactivity-".concat(c)),j.forEach(function(H){return H.classList.remove("allow-interactivity-".concat(c))})}}},[e.inert,e.lockRef.current,e.shards]);var o=Q.useCallback(function(j,H){if("touches"in j&&j.touches.length===2||j.type==="wheel"&&j.ctrlKey)return!g.current.allowPinchZoom;var X=IS(j),q=r.current,Z="deltaX"in j?j.deltaX:q[0]-X[0],J="deltaY"in j?j.deltaY:q[1]-X[1],ne,he=j.target,me=Math.abs(Z)>Math.abs(J)?"h":"v";if("touches"in j&&me==="h"&&he.type==="range")return!1;var Se=c4(me,he);if(!Se)return!0;if(Se?ne=me:(ne=me==="v"?"h":"v",Se=c4(me,he)),!Se)return!1;if(!i.current&&"changedTouches"in j&&(Z||J)&&(i.current=ne),!ne)return!0;var qe=i.current||ne;return Lue(qe,H,j,qe==="h"?Z:J,!0)},[]),w=Q.useCallback(function(j){var H=j;if(!(!Ng.length||Ng[Ng.length-1]!==d)){var X="deltaY"in H?u4(H):IS(H),q=t.current.filter(function(ne){return ne.name===H.type&&(ne.target===H.target||H.target===ne.shadowParent)&&zue(ne.delta,X)})[0];if(q&&q.should){H.cancelable&&H.preventDefault();return}if(!q){var Z=(g.current.shards||[]).map(h4).filter(Boolean).filter(function(ne){return ne.contains(H.target)}),J=Z.length>0?o(H,Z[0]):!g.current.noIsolation;J&&H.cancelable&&H.preventDefault()}}},[]),T=Q.useCallback(function(j,H,X,q){var Z={name:j,delta:H,target:X,should:q,shadowParent:Bue(X)};t.current.push(Z),setTimeout(function(){t.current=t.current.filter(function(J){return J!==Z})},1)},[]),I=Q.useCallback(function(j){r.current=IS(j),i.current=void 0},[]),C=Q.useCallback(function(j){T(j.type,u4(j),j.target,o(j,e.lockRef.current))},[]),R=Q.useCallback(function(j){T(j.type,IS(j),j.target,o(j,e.lockRef.current))},[]);Q.useEffect(function(){return Ng.push(d),e.setCallbacks({onScrollCapture:C,onWheelCapture:C,onTouchMoveCapture:R}),document.addEventListener("wheel",w,zg),document.addEventListener("touchmove",w,zg),document.addEventListener("touchstart",I,zg),function(){Ng=Ng.filter(function(j){return j!==d}),document.removeEventListener("wheel",w,zg),document.removeEventListener("touchmove",w,zg),document.removeEventListener("touchstart",I,zg)}},[]);var F=e.removeScrollBar,G=e.inert;return Q.createElement(Q.Fragment,null,G?Q.createElement(d,{styles:Nue(c)}):null,F?Q.createElement(Cue,{gapMode:e.gapMode}):null)}function Bue(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const $ue=mue(YH,Fue);var I2=Q.forwardRef(function(e,t){return Q.createElement(C2,Wc({},e,{ref:t,sideCar:$ue}))});I2.classNames=C2.classNames;var yM=["Enter"," "],Uue=["ArrowDown","PageUp","Home"],rW=["ArrowUp","PageDown","End"],Vue=[...Uue,...rW],Gue={ltr:[...yM,"ArrowRight"],rtl:[...yM,"ArrowLeft"]},Hue={ltr:["ArrowLeft"],rtl:["ArrowRight"]},V1="Menu",[Gx,Wue,que]=a2(V1),[sm,nW]=nm(V1,[que,my,P2]),O2=my(),iW=P2(),[Zue,am]=sm(V1),[Xue,G1]=sm(V1),oW=e=>{const{__scopeMenu:t,open:r=!1,children:i,dir:c,onOpenChange:d,modal:g=!0}=e,o=O2(t),[w,T]=Q.useState(null),I=Q.useRef(!1),C=js(d),R=T2(c);return Q.useEffect(()=>{const F=()=>{I.current=!0,document.addEventListener("pointerdown",G,{capture:!0,once:!0}),document.addEventListener("pointermove",G,{capture:!0,once:!0})},G=()=>I.current=!1;return document.addEventListener("keydown",F,{capture:!0}),()=>{document.removeEventListener("keydown",F,{capture:!0}),document.removeEventListener("pointerdown",G,{capture:!0}),document.removeEventListener("pointermove",G,{capture:!0})}},[]),z.jsx(VG,{...o,children:z.jsx(Zue,{scope:t,open:r,onOpenChange:C,content:w,onContentChange:T,children:z.jsx(Xue,{scope:t,onClose:Q.useCallback(()=>C(!1),[C]),isUsingKeyboardRef:I,dir:R,modal:g,children:i})})})};oW.displayName=V1;var Kue="MenuAnchor",AD=Q.forwardRef((e,t)=>{const{__scopeMenu:r,...i}=e,c=O2(r);return z.jsx(cD,{...c,...i,ref:t})});AD.displayName=Kue;var PD="MenuPortal",[Yue,sW]=sm(PD,{forceMount:void 0}),aW=e=>{const{__scopeMenu:t,forceMount:r,children:i,container:c}=e,d=am(PD,t);return z.jsx(Yue,{scope:t,forceMount:r,children:z.jsx(hc,{present:r||d.open,children:z.jsx(z1,{asChild:!0,container:c,children:i})})})};aW.displayName=PD;var pl="MenuContent",[Jue,CD]=sm(pl),lW=Q.forwardRef((e,t)=>{const r=sW(pl,e.__scopeMenu),{forceMount:i=r.forceMount,...c}=e,d=am(pl,e.__scopeMenu),g=G1(pl,e.__scopeMenu);return z.jsx(Gx.Provider,{scope:e.__scopeMenu,children:z.jsx(hc,{present:i||d.open,children:z.jsx(Gx.Slot,{scope:e.__scopeMenu,children:g.modal?z.jsx(Que,{...c,ref:t}):z.jsx(ehe,{...c,ref:t})})})})}),Que=Q.forwardRef((e,t)=>{const r=am(pl,e.__scopeMenu),i=Q.useRef(null),c=Ci(t,i);return Q.useEffect(()=>{const d=i.current;if(d)return ED(d)},[]),z.jsx(ID,{...e,ref:c,trapFocus:r.open,disableOutsidePointerEvents:r.open,disableOutsideScroll:!0,onFocusOutside:Er(e.onFocusOutside,d=>d.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>r.onOpenChange(!1)})}),ehe=Q.forwardRef((e,t)=>{const r=am(pl,e.__scopeMenu);return z.jsx(ID,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>r.onOpenChange(!1)})}),ID=Q.forwardRef((e,t)=>{const{__scopeMenu:r,loop:i=!1,trapFocus:c,onOpenAutoFocus:d,onCloseAutoFocus:g,disableOutsidePointerEvents:o,onEntryFocus:w,onEscapeKeyDown:T,onPointerDownOutside:I,onFocusOutside:C,onInteractOutside:R,onDismiss:F,disableOutsideScroll:G,...j}=e,H=am(pl,r),X=G1(pl,r),q=O2(r),Z=iW(r),J=Wue(r),[ne,he]=Q.useState(null),me=Q.useRef(null),Se=Ci(t,me,H.onContentChange),qe=Q.useRef(0),Ze=Q.useRef(""),He=Q.useRef(0),Ke=Q.useRef(null),dt=Q.useRef("right"),$e=Q.useRef(0),mt=G?I2:Q.Fragment,ct=G?{as:Nd,allowPinchZoom:!0}:void 0,St=st=>{var nr,Xr;const bt=Ze.current+st,At=J().filter(Lt=>!Lt.disabled),zt=document.activeElement,or=(nr=At.find(Lt=>Lt.ref.current===zt))==null?void 0:nr.textValue,Mr=At.map(Lt=>Lt.textValue),Ar=dhe(Mr,bt,or),vr=(Xr=At.find(Lt=>Lt.textValue===Ar))==null?void 0:Xr.ref.current;(function Lt(ur){Ze.current=ur,window.clearTimeout(qe.current),ur!==""&&(qe.current=window.setTimeout(()=>Lt(""),1e3))})(bt),vr&&setTimeout(()=>vr.focus())};Q.useEffect(()=>()=>window.clearTimeout(qe.current),[]),TD();const Ue=Q.useCallback(st=>{var At,zt;return dt.current===((At=Ke.current)==null?void 0:At.side)&&phe(st,(zt=Ke.current)==null?void 0:zt.area)},[]);return z.jsx(Jue,{scope:r,searchRef:Ze,onItemEnter:Q.useCallback(st=>{Ue(st)&&st.preventDefault()},[Ue]),onItemLeave:Q.useCallback(st=>{var bt;Ue(st)||((bt=me.current)==null||bt.focus(),he(null))},[Ue]),onTriggerLeave:Q.useCallback(st=>{Ue(st)&&st.preventDefault()},[Ue]),pointerGraceTimerRef:He,onPointerGraceIntentChange:Q.useCallback(st=>{Ke.current=st},[]),children:z.jsx(mt,{...ct,children:z.jsx(E2,{asChild:!0,trapped:c,onMountAutoFocus:Er(d,st=>{var bt;st.preventDefault(),(bt=me.current)==null||bt.focus({preventScroll:!0})}),onUnmountAutoFocus:g,children:z.jsx(hy,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:T,onPointerDownOutside:I,onFocusOutside:C,onInteractOutside:R,onDismiss:F,children:z.jsx(WH,{asChild:!0,...Z,dir:X.dir,orientation:"vertical",loop:i,currentTabStopId:ne,onCurrentTabStopIdChange:he,onEntryFocus:Er(w,st=>{X.isUsingKeyboardRef.current||st.preventDefault()}),preventScrollOnEntryFocus:!0,children:z.jsx(uD,{role:"menu","aria-orientation":"vertical","data-state":TW(H.open),"data-radix-menu-content":"",dir:X.dir,...q,...j,ref:Se,style:{outline:"none",...j.style},onKeyDown:Er(j.onKeyDown,st=>{const At=st.target.closest("[data-radix-menu-content]")===st.currentTarget,zt=st.ctrlKey||st.altKey||st.metaKey,or=st.key.length===1;At&&(st.key==="Tab"&&st.preventDefault(),!zt&&or&&St(st.key));const Mr=me.current;if(st.target!==Mr||!Vue.includes(st.key))return;st.preventDefault();const vr=J().filter(nr=>!nr.disabled).map(nr=>nr.ref.current);rW.includes(st.key)&&vr.reverse(),uhe(vr)}),onBlur:Er(e.onBlur,st=>{st.currentTarget.contains(st.target)||(window.clearTimeout(qe.current),Ze.current="")}),onPointerMove:Er(e.onPointerMove,Hx(st=>{const bt=st.target,At=$e.current!==st.clientX;if(st.currentTarget.contains(bt)&&At){const zt=st.clientX>$e.current?"right":"left";dt.current=zt,$e.current=st.clientX}}))})})})})})})});lW.displayName=pl;var the="MenuGroup",OD=Q.forwardRef((e,t)=>{const{__scopeMenu:r,...i}=e;return z.jsx(Sn.div,{role:"group",...i,ref:t})});OD.displayName=the;var rhe="MenuLabel",cW=Q.forwardRef((e,t)=>{const{__scopeMenu:r,...i}=e;return z.jsx(Sn.div,{...i,ref:t})});cW.displayName=rhe;var UT="MenuItem",d4="menu.itemSelect",M2=Q.forwardRef((e,t)=>{const{disabled:r=!1,onSelect:i,...c}=e,d=Q.useRef(null),g=G1(UT,e.__scopeMenu),o=CD(UT,e.__scopeMenu),w=Ci(t,d),T=Q.useRef(!1),I=()=>{const C=d.current;if(!r&&C){const R=new CustomEvent(d4,{bubbles:!0,cancelable:!0});C.addEventListener(d4,F=>i==null?void 0:i(F),{once:!0}),Wk(C,R),R.defaultPrevented?T.current=!1:g.onClose()}};return z.jsx(uW,{...c,ref:w,disabled:r,onClick:Er(e.onClick,I),onPointerDown:C=>{var R;(R=e.onPointerDown)==null||R.call(e,C),T.current=!0},onPointerUp:Er(e.onPointerUp,C=>{var R;T.current||(R=C.currentTarget)==null||R.click()}),onKeyDown:Er(e.onKeyDown,C=>{const R=o.searchRef.current!=="";r||R&&C.key===" "||yM.includes(C.key)&&(C.currentTarget.click(),C.preventDefault())})})});M2.displayName=UT;var uW=Q.forwardRef((e,t)=>{const{__scopeMenu:r,disabled:i=!1,textValue:c,...d}=e,g=CD(UT,r),o=iW(r),w=Q.useRef(null),T=Ci(t,w),[I,C]=Q.useState(!1),[R,F]=Q.useState("");return Q.useEffect(()=>{const G=w.current;G&&F((G.textContent??"").trim())},[d.children]),z.jsx(Gx.ItemSlot,{scope:r,disabled:i,textValue:c??R,children:z.jsx(qH,{asChild:!0,...o,focusable:!i,children:z.jsx(Sn.div,{role:"menuitem","data-highlighted":I?"":void 0,"aria-disabled":i||void 0,"data-disabled":i?"":void 0,...d,ref:T,onPointerMove:Er(e.onPointerMove,Hx(G=>{i?g.onItemLeave(G):(g.onItemEnter(G),G.defaultPrevented||G.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Er(e.onPointerLeave,Hx(G=>g.onItemLeave(G))),onFocus:Er(e.onFocus,()=>C(!0)),onBlur:Er(e.onBlur,()=>C(!1))})})})}),nhe="MenuCheckboxItem",hW=Q.forwardRef((e,t)=>{const{checked:r=!1,onCheckedChange:i,...c}=e;return z.jsx(gW,{scope:e.__scopeMenu,checked:r,children:z.jsx(M2,{role:"menuitemcheckbox","aria-checked":VT(r)?"mixed":r,...c,ref:t,"data-state":RD(r),onSelect:Er(c.onSelect,()=>i==null?void 0:i(VT(r)?!0:!r),{checkForDefaultPrevented:!1})})})});hW.displayName=nhe;var dW="MenuRadioGroup",[ihe,ohe]=sm(dW,{value:void 0,onValueChange:()=>{}}),fW=Q.forwardRef((e,t)=>{const{value:r,onValueChange:i,...c}=e,d=js(i);return z.jsx(ihe,{scope:e.__scopeMenu,value:r,onValueChange:d,children:z.jsx(OD,{...c,ref:t})})});fW.displayName=dW;var pW="MenuRadioItem",mW=Q.forwardRef((e,t)=>{const{value:r,...i}=e,c=ohe(pW,e.__scopeMenu),d=r===c.value;return z.jsx(gW,{scope:e.__scopeMenu,checked:d,children:z.jsx(M2,{role:"menuitemradio","aria-checked":d,...i,ref:t,"data-state":RD(d),onSelect:Er(i.onSelect,()=>{var g;return(g=c.onValueChange)==null?void 0:g.call(c,r)},{checkForDefaultPrevented:!1})})})});mW.displayName=pW;var MD="MenuItemIndicator",[gW,she]=sm(MD,{checked:!1}),_W=Q.forwardRef((e,t)=>{const{__scopeMenu:r,forceMount:i,...c}=e,d=she(MD,r);return z.jsx(hc,{present:i||VT(d.checked)||d.checked===!0,children:z.jsx(Sn.span,{...c,ref:t,"data-state":RD(d.checked)})})});_W.displayName=MD;var ahe="MenuSeparator",yW=Q.forwardRef((e,t)=>{const{__scopeMenu:r,...i}=e;return z.jsx(Sn.div,{role:"separator","aria-orientation":"horizontal",...i,ref:t})});yW.displayName=ahe;var lhe="MenuArrow",vW=Q.forwardRef((e,t)=>{const{__scopeMenu:r,...i}=e,c=O2(r);return z.jsx(hD,{...c,...i,ref:t})});vW.displayName=lhe;var che="MenuSub",[$je,xW]=sm(che),q0="MenuSubTrigger",bW=Q.forwardRef((e,t)=>{const r=am(q0,e.__scopeMenu),i=G1(q0,e.__scopeMenu),c=xW(q0,e.__scopeMenu),d=CD(q0,e.__scopeMenu),g=Q.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:w}=d,T={__scopeMenu:e.__scopeMenu},I=Q.useCallback(()=>{g.current&&window.clearTimeout(g.current),g.current=null},[]);return Q.useEffect(()=>I,[I]),Q.useEffect(()=>{const C=o.current;return()=>{window.clearTimeout(C),w(null)}},[o,w]),z.jsx(AD,{asChild:!0,...T,children:z.jsx(uW,{id:c.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":c.contentId,"data-state":TW(r.open),...e,ref:s2(t,c.onTriggerChange),onClick:C=>{var R;(R=e.onClick)==null||R.call(e,C),!(e.disabled||C.defaultPrevented)&&(C.currentTarget.focus(),r.open||r.onOpenChange(!0))},onPointerMove:Er(e.onPointerMove,Hx(C=>{d.onItemEnter(C),!C.defaultPrevented&&!e.disabled&&!r.open&&!g.current&&(d.onPointerGraceIntentChange(null),g.current=window.setTimeout(()=>{r.onOpenChange(!0),I()},100))})),onPointerLeave:Er(e.onPointerLeave,Hx(C=>{var F,G;I();const R=(F=r.content)==null?void 0:F.getBoundingClientRect();if(R){const j=(G=r.content)==null?void 0:G.dataset.side,H=j==="right",X=H?-5:5,q=R[H?"left":"right"],Z=R[H?"right":"left"];d.onPointerGraceIntentChange({area:[{x:C.clientX+X,y:C.clientY},{x:q,y:R.top},{x:Z,y:R.top},{x:Z,y:R.bottom},{x:q,y:R.bottom}],side:j}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>d.onPointerGraceIntentChange(null),300)}else{if(d.onTriggerLeave(C),C.defaultPrevented)return;d.onPointerGraceIntentChange(null)}})),onKeyDown:Er(e.onKeyDown,C=>{var F;const R=d.searchRef.current!=="";e.disabled||R&&C.key===" "||Gue[i.dir].includes(C.key)&&(r.onOpenChange(!0),(F=r.content)==null||F.focus(),C.preventDefault())})})})});bW.displayName=q0;var wW="MenuSubContent",SW=Q.forwardRef((e,t)=>{const r=sW(pl,e.__scopeMenu),{forceMount:i=r.forceMount,...c}=e,d=am(pl,e.__scopeMenu),g=G1(pl,e.__scopeMenu),o=xW(wW,e.__scopeMenu),w=Q.useRef(null),T=Ci(t,w);return z.jsx(Gx.Provider,{scope:e.__scopeMenu,children:z.jsx(hc,{present:i||d.open,children:z.jsx(Gx.Slot,{scope:e.__scopeMenu,children:z.jsx(ID,{id:o.contentId,"aria-labelledby":o.triggerId,...c,ref:T,align:"start",side:g.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:I=>{var C;g.isUsingKeyboardRef.current&&((C=w.current)==null||C.focus()),I.preventDefault()},onCloseAutoFocus:I=>I.preventDefault(),onFocusOutside:Er(e.onFocusOutside,I=>{I.target!==o.trigger&&d.onOpenChange(!1)}),onEscapeKeyDown:Er(e.onEscapeKeyDown,I=>{g.onClose(),I.preventDefault()}),onKeyDown:Er(e.onKeyDown,I=>{var F;const C=I.currentTarget.contains(I.target),R=Hue[g.dir].includes(I.key);C&&R&&(d.onOpenChange(!1),(F=o.trigger)==null||F.focus(),I.preventDefault())})})})})})});SW.displayName=wW;function TW(e){return e?"open":"closed"}function VT(e){return e==="indeterminate"}function RD(e){return VT(e)?"indeterminate":e?"checked":"unchecked"}function uhe(e){const t=document.activeElement;for(const r of e)if(r===t||(r.focus(),document.activeElement!==t))return}function hhe(e,t){return e.map((r,i)=>e[(t+i)%e.length])}function dhe(e,t,r){const c=t.length>1&&Array.from(t).every(T=>T===t[0])?t[0]:t,d=r?e.indexOf(r):-1;let g=hhe(e,Math.max(d,0));c.length===1&&(g=g.filter(T=>T!==r));const w=g.find(T=>T.toLowerCase().startsWith(c.toLowerCase()));return w!==r?w:void 0}function fhe(e,t){const{x:r,y:i}=e;let c=!1;for(let d=0,g=t.length-1;d<t.length;g=d++){const o=t[d].x,w=t[d].y,T=t[g].x,I=t[g].y;w>i!=I>i&&r<(T-o)*(i-w)/(I-w)+o&&(c=!c)}return c}function phe(e,t){if(!t)return!1;const r={x:e.clientX,y:e.clientY};return fhe(r,t)}function Hx(e){return t=>t.pointerType==="mouse"?e(t):void 0}var mhe=oW,ghe=AD,_he=aW,yhe=lW,vhe=OD,xhe=cW,bhe=M2,whe=hW,She=fW,The=mW,Ehe=_W,Ahe=yW,Phe=vW,Che=bW,Ihe=SW,kD="DropdownMenu",[Ohe,Uje]=nm(kD,[nW]),na=nW(),[Mhe,EW]=Ohe(kD),AW=e=>{const{__scopeDropdownMenu:t,children:r,dir:i,open:c,defaultOpen:d,onOpenChange:g,modal:o=!0}=e,w=na(t),T=Q.useRef(null),[I=!1,C]=Gp({prop:c,defaultProp:d,onChange:g});return z.jsx(Mhe,{scope:t,triggerId:Kc(),triggerRef:T,contentId:Kc(),open:I,onOpenChange:C,onOpenToggle:Q.useCallback(()=>C(R=>!R),[C]),modal:o,children:z.jsx(mhe,{...w,open:I,onOpenChange:C,dir:i,modal:o,children:r})})};AW.displayName=kD;var PW="DropdownMenuTrigger",CW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,disabled:i=!1,...c}=e,d=EW(PW,r),g=na(r);return z.jsx(ghe,{asChild:!0,...g,children:z.jsx(Sn.button,{type:"button",id:d.triggerId,"aria-haspopup":"menu","aria-expanded":d.open,"aria-controls":d.open?d.contentId:void 0,"data-state":d.open?"open":"closed","data-disabled":i?"":void 0,disabled:i,...c,ref:s2(t,d.triggerRef),onPointerDown:Er(e.onPointerDown,o=>{!i&&o.button===0&&o.ctrlKey===!1&&(d.onOpenToggle(),d.open||o.preventDefault())}),onKeyDown:Er(e.onKeyDown,o=>{i||(["Enter"," "].includes(o.key)&&d.onOpenToggle(),o.key==="ArrowDown"&&d.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});CW.displayName=PW;var Rhe="DropdownMenuPortal",IW=e=>{const{__scopeDropdownMenu:t,...r}=e,i=na(t);return z.jsx(_he,{...i,...r})};IW.displayName=Rhe;var OW="DropdownMenuContent",MW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=EW(OW,r),d=na(r),g=Q.useRef(!1);return z.jsx(yhe,{id:c.contentId,"aria-labelledby":c.triggerId,...d,...i,ref:t,onCloseAutoFocus:Er(e.onCloseAutoFocus,o=>{var w;g.current||(w=c.triggerRef.current)==null||w.focus(),g.current=!1,o.preventDefault()}),onInteractOutside:Er(e.onInteractOutside,o=>{const w=o.detail.originalEvent,T=w.button===0&&w.ctrlKey===!0,I=w.button===2||T;(!c.modal||I)&&(g.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});MW.displayName=OW;var khe="DropdownMenuGroup",Dhe=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(vhe,{...c,...i,ref:t})});Dhe.displayName=khe;var Lhe="DropdownMenuLabel",RW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(xhe,{...c,...i,ref:t})});RW.displayName=Lhe;var zhe="DropdownMenuItem",kW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(bhe,{...c,...i,ref:t})});kW.displayName=zhe;var Nhe="DropdownMenuCheckboxItem",DW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(whe,{...c,...i,ref:t})});DW.displayName=Nhe;var jhe="DropdownMenuRadioGroup",Fhe=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(She,{...c,...i,ref:t})});Fhe.displayName=jhe;var Bhe="DropdownMenuRadioItem",LW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(The,{...c,...i,ref:t})});LW.displayName=Bhe;var $he="DropdownMenuItemIndicator",zW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(Ehe,{...c,...i,ref:t})});zW.displayName=$he;var Uhe="DropdownMenuSeparator",NW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(Ahe,{...c,...i,ref:t})});NW.displayName=Uhe;var Vhe="DropdownMenuArrow",Ghe=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(Phe,{...c,...i,ref:t})});Ghe.displayName=Vhe;var Hhe="DropdownMenuSubTrigger",jW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(Che,{...c,...i,ref:t})});jW.displayName=Hhe;var Whe="DropdownMenuSubContent",FW=Q.forwardRef((e,t)=>{const{__scopeDropdownMenu:r,...i}=e,c=na(r);return z.jsx(Ihe,{...c,...i,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});FW.displayName=Whe;var qhe=AW,Zhe=CW,Xhe=IW,BW=MW,$W=RW,UW=kW,VW=DW,GW=LW,HW=zW,WW=NW,qW=jW,ZW=FW;const Khe=qhe,Yhe=Zhe,Jhe=Q.forwardRef(({className:e,inset:t,children:r,...i},c)=>z.jsxs(qW,{ref:c,className:zn("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",t&&"pl-8",e),...i,children:[r,z.jsx(Xre,{className:"ml-auto h-4 w-4"})]}));Jhe.displayName=qW.displayName;const Qhe=Q.forwardRef(({className:e,...t},r)=>z.jsx(ZW,{ref:r,className:zn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t}));Qhe.displayName=ZW.displayName;const XW=Q.forwardRef(({className:e,sideOffset:t=4,...r},i)=>z.jsx(Xhe,{children:z.jsx(BW,{ref:i,sideOffset:t,className:zn("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));XW.displayName=BW.displayName;const vM=Q.forwardRef(({className:e,inset:t,...r},i)=>z.jsx(UW,{ref:i,className:zn("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t&&"pl-8",e),...r}));vM.displayName=UW.displayName;const ede=Q.forwardRef(({className:e,children:t,checked:r,...i},c)=>z.jsxs(VW,{ref:c,className:zn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:r,...i,children:[z.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:z.jsx(HW,{children:z.jsx(lG,{className:"h-4 w-4"})})}),t]}));ede.displayName=VW.displayName;const tde=Q.forwardRef(({className:e,children:t,...r},i)=>z.jsxs(GW,{ref:i,className:zn("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[z.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:z.jsx(HW,{children:z.jsx(Yre,{className:"h-2 w-2 fill-current"})})}),t]}));tde.displayName=GW.displayName;const rde=Q.forwardRef(({className:e,inset:t,...r},i)=>z.jsx($W,{ref:i,className:zn("px-2 py-1.5 text-sm font-semibold",t&&"pl-8",e),...r}));rde.displayName=$W.displayName;const KW=Q.forwardRef(({className:e,...t},r)=>z.jsx(WW,{ref:r,className:zn("-mx-1 my-1 h-px bg-muted",e),...t}));KW.displayName=WW.displayName;var DD="Dialog",[YW,Vje]=nm(DD),[nde,dc]=YW(DD),JW=e=>{const{__scopeDialog:t,children:r,open:i,defaultOpen:c,onOpenChange:d,modal:g=!0}=e,o=Q.useRef(null),w=Q.useRef(null),[T=!1,I]=Gp({prop:i,defaultProp:c,onChange:d});return z.jsx(nde,{scope:t,triggerRef:o,contentRef:w,contentId:Kc(),titleId:Kc(),descriptionId:Kc(),open:T,onOpenChange:I,onOpenToggle:Q.useCallback(()=>I(C=>!C),[I]),modal:g,children:r})};JW.displayName=DD;var QW="DialogTrigger",eq=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...i}=e,c=dc(QW,r),d=Ci(t,c.triggerRef);return z.jsx(Sn.button,{type:"button","aria-haspopup":"dialog","aria-expanded":c.open,"aria-controls":c.contentId,"data-state":ND(c.open),...i,ref:d,onClick:Er(e.onClick,c.onOpenToggle)})});eq.displayName=QW;var LD="DialogPortal",[ide,tq]=YW(LD,{forceMount:void 0}),rq=e=>{const{__scopeDialog:t,forceMount:r,children:i,container:c}=e,d=dc(LD,t);return z.jsx(ide,{scope:t,forceMount:r,children:Q.Children.map(i,g=>z.jsx(hc,{present:r||d.open,children:z.jsx(z1,{asChild:!0,container:c,children:g})}))})};rq.displayName=LD;var GT="DialogOverlay",nq=Q.forwardRef((e,t)=>{const r=tq(GT,e.__scopeDialog),{forceMount:i=r.forceMount,...c}=e,d=dc(GT,e.__scopeDialog);return d.modal?z.jsx(hc,{present:i||d.open,children:z.jsx(ode,{...c,ref:t})}):null});nq.displayName=GT;var ode=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...i}=e,c=dc(GT,r);return z.jsx(I2,{as:Nd,allowPinchZoom:!0,shards:[c.contentRef],children:z.jsx(Sn.div,{"data-state":ND(c.open),...i,ref:t,style:{pointerEvents:"auto",...i.style}})})}),qp="DialogContent",iq=Q.forwardRef((e,t)=>{const r=tq(qp,e.__scopeDialog),{forceMount:i=r.forceMount,...c}=e,d=dc(qp,e.__scopeDialog);return z.jsx(hc,{present:i||d.open,children:d.modal?z.jsx(sde,{...c,ref:t}):z.jsx(ade,{...c,ref:t})})});iq.displayName=qp;var sde=Q.forwardRef((e,t)=>{const r=dc(qp,e.__scopeDialog),i=Q.useRef(null),c=Ci(t,r.contentRef,i);return Q.useEffect(()=>{const d=i.current;if(d)return ED(d)},[]),z.jsx(oq,{...e,ref:c,trapFocus:r.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Er(e.onCloseAutoFocus,d=>{var g;d.preventDefault(),(g=r.triggerRef.current)==null||g.focus()}),onPointerDownOutside:Er(e.onPointerDownOutside,d=>{const g=d.detail.originalEvent,o=g.button===0&&g.ctrlKey===!0;(g.button===2||o)&&d.preventDefault()}),onFocusOutside:Er(e.onFocusOutside,d=>d.preventDefault())})}),ade=Q.forwardRef((e,t)=>{const r=dc(qp,e.__scopeDialog),i=Q.useRef(!1),c=Q.useRef(!1);return z.jsx(oq,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:d=>{var g,o;(g=e.onCloseAutoFocus)==null||g.call(e,d),d.defaultPrevented||(i.current||(o=r.triggerRef.current)==null||o.focus(),d.preventDefault()),i.current=!1,c.current=!1},onInteractOutside:d=>{var w,T;(w=e.onInteractOutside)==null||w.call(e,d),d.defaultPrevented||(i.current=!0,d.detail.originalEvent.type==="pointerdown"&&(c.current=!0));const g=d.target;((T=r.triggerRef.current)==null?void 0:T.contains(g))&&d.preventDefault(),d.detail.originalEvent.type==="focusin"&&c.current&&d.preventDefault()}})}),oq=Q.forwardRef((e,t)=>{const{__scopeDialog:r,trapFocus:i,onOpenAutoFocus:c,onCloseAutoFocus:d,...g}=e,o=dc(qp,r),w=Q.useRef(null),T=Ci(t,w);return TD(),z.jsxs(z.Fragment,{children:[z.jsx(E2,{asChild:!0,loop:!0,trapped:i,onMountAutoFocus:c,onUnmountAutoFocus:d,children:z.jsx(hy,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":ND(o.open),...g,ref:T,onDismiss:()=>o.onOpenChange(!1)})}),z.jsxs(z.Fragment,{children:[z.jsx(lde,{titleId:o.titleId}),z.jsx(ude,{contentRef:w,descriptionId:o.descriptionId})]})]})}),zD="DialogTitle",sq=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...i}=e,c=dc(zD,r);return z.jsx(Sn.h2,{id:c.titleId,...i,ref:t})});sq.displayName=zD;var aq="DialogDescription",lq=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...i}=e,c=dc(aq,r);return z.jsx(Sn.p,{id:c.descriptionId,...i,ref:t})});lq.displayName=aq;var cq="DialogClose",uq=Q.forwardRef((e,t)=>{const{__scopeDialog:r,...i}=e,c=dc(cq,r);return z.jsx(Sn.button,{type:"button",...i,ref:t,onClick:Er(e.onClick,()=>c.onOpenChange(!1))})});uq.displayName=cq;function ND(e){return e?"open":"closed"}var hq="DialogTitleWarning",[Gje,dq]=lre(hq,{contentName:qp,titleName:zD,docsSlug:"dialog"}),lde=({titleId:e})=>{const t=dq(hq),r=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return Q.useEffect(()=>{e&&(document.getElementById(e)||console.error(r))},[r,e]),null},cde="DialogDescriptionWarning",ude=({contentRef:e,descriptionId:t})=>{const i=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${dq(cde).contentName}}.`;return Q.useEffect(()=>{var d;const c=(d=e.current)==null?void 0:d.getAttribute("aria-describedby");t&&c&&(document.getElementById(t)||console.warn(i))},[i,e,t]),null},hde=JW,dde=eq,fde=rq,fq=nq,pq=iq,mq=sq,gq=lq,pde=uq;const mde=hde,gde=dde,_de=fde,_q=Q.forwardRef(({className:e,...t},r)=>z.jsx(fq,{className:zn("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:r}));_q.displayName=fq.displayName;const yde=j1("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),yq=Q.forwardRef(({side:e="right",className:t,children:r,...i},c)=>z.jsxs(_de,{children:[z.jsx(_q,{}),z.jsxs(pq,{ref:c,className:zn(yde({side:e}),t),...i,children:[r,z.jsxs(pde,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[z.jsx(pG,{className:"h-4 w-4"}),z.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));yq.displayName=pq.displayName;const vde=Q.forwardRef(({className:e,...t},r)=>z.jsx(mq,{ref:r,className:zn("text-lg font-semibold text-foreground",e),...t}));vde.displayName=mq.displayName;const xde=Q.forwardRef(({className:e,...t},r)=>z.jsx(gq,{ref:r,className:zn("text-sm text-muted-foreground",e),...t}));xde.displayName=gq.displayName;const vq=()=>{const{user:e}=Kd(),[t,r]=Q.useState(null),[i,c]=Q.useState(!0);Q.useEffect(()=>{e?d():(r(null),c(!1))},[e]);const d=async()=>{if(e)try{const{data:o,error:w}=await ja.from("profiles").select("*").eq("id",e.id).single();w?console.error("Error fetching profile:",w):r(o)}catch(o){console.error("Error fetching profile:",o)}finally{c(!1)}};return{profile:t,loading:i,updateProfile:async o=>{if(!e)return{error:"No user"};try{const{data:w,error:T}=await ja.from("profiles").update(o).eq("id",e.id).select().single();return T?{error:T}:(r(w),{data:w})}catch(w){return{error:w}}},refetch:d}},rd=()=>{const e=im(),t=y2(),{user:r,signOut:i}=Kd(),{profile:c}=vq(),{theme:d,toggleTheme:g}=Dce(),[o,w]=Q.useState(!1),T=F=>e.pathname===F,I=async()=>{await i(),t("/auth")},C=[{path:"/",label:"Dashboard",icon:ene},{path:"/report",label:"Report",icon:sx},{path:"/view-crimes",label:"View Crimes",icon:Jk},{path:"/community",label:"Community",icon:RT},{path:"/emergency",label:"Emergency",icon:jd},{path:"/map",label:"Map",icon:ine}],R=({mobile:F=!1})=>z.jsx(z.Fragment,{children:C.map(G=>z.jsx(pi,{variant:T(G.path)?"default":"ghost",asChild:!0,className:`transition-all duration-200 ${F?"w-full justify-start":""}`,onClick:F?()=>w(!1):void 0,children:z.jsxs(Xs,{to:G.path,className:"flex items-center space-x-2",children:[z.jsx(G.icon,{className:"h-4 w-4"}),z.jsx("span",{children:G.label})]})},G.path))});return z.jsx("header",{className:"bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm border-b border-slate-200 dark:border-slate-700 sticky top-0 z-50",children:z.jsx("div",{className:"container mx-auto px-4 py-4",children:z.jsxs("div",{className:"flex items-center justify-between",children:[z.jsxs(Xs,{to:"/",className:"flex items-center space-x-3 group",children:[z.jsx("div",{className:"p-2 bg-blue-600 rounded-lg group-hover:bg-blue-700 transition-colors",children:z.jsx(ax,{className:"h-6 w-6 text-white"})}),z.jsxs("div",{className:"hidden sm:block",children:[z.jsx("h1",{className:"text-xl font-bold text-slate-800 dark:text-slate-200",children:"UrbanEye"}),z.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Crime Report System"})]})]}),r?z.jsxs(z.Fragment,{children:[z.jsxs("nav",{className:"hidden lg:flex items-center space-x-2",children:[z.jsx(R,{}),(c==null?void 0:c.is_admin)&&z.jsx(pi,{variant:T("/admin")?"default":"ghost",asChild:!0,className:"transition-all duration-200",children:z.jsxs(Xs,{to:"/admin",className:"flex items-center space-x-2",children:[z.jsx(sB,{className:"h-4 w-4"}),z.jsx("span",{children:"Admin"})]})})]}),z.jsx("div",{className:"lg:hidden",children:z.jsxs(mde,{open:o,onOpenChange:w,children:[z.jsx(gde,{asChild:!0,children:z.jsx(pi,{variant:"ghost",size:"sm",children:z.jsx(one,{className:"h-5 w-5"})})}),z.jsx(yq,{side:"right",className:"w-[300px] sm:w-[400px]",children:z.jsxs("div",{className:"flex flex-col space-y-4 mt-6",children:[z.jsx(R,{mobile:!0}),(c==null?void 0:c.is_admin)&&z.jsx(pi,{variant:T("/admin")?"default":"ghost",asChild:!0,className:"w-full justify-start",onClick:()=>w(!1),children:z.jsxs(Xs,{to:"/admin",className:"flex items-center space-x-2",children:[z.jsx(sB,{className:"h-4 w-4"}),z.jsx("span",{children:"Admin"})]})}),z.jsxs("div",{className:"border-t pt-4",children:[z.jsx(pi,{variant:"ghost",asChild:!0,className:"w-full justify-start mb-2",onClick:()=>w(!1),children:z.jsxs(Xs,{to:"/profile",className:"flex items-center space-x-2",children:[z.jsx(lx,{className:"h-4 w-4"}),z.jsx("span",{children:"Profile"})]})}),z.jsxs(pi,{variant:"ghost",onClick:I,className:"w-full justify-start text-red-600",children:[z.jsx(iB,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})})]})}),z.jsxs("div",{className:"hidden lg:flex items-center space-x-2",children:[z.jsx(pi,{variant:"ghost",size:"sm",onClick:g,className:"transition-all duration-200",children:d==="light"?z.jsx(oB,{className:"h-4 w-4"}):z.jsx(cB,{className:"h-4 w-4"})}),z.jsxs(Khe,{children:[z.jsx(Yhe,{asChild:!0,children:z.jsxs(pi,{variant:"ghost",className:"flex items-center space-x-2",children:[z.jsx(lx,{className:"h-4 w-4"}),z.jsx("span",{className:"max-w-[150px] truncate",children:(c==null?void 0:c.full_name)||(r==null?void 0:r.email)})]})}),z.jsxs(XW,{align:"end",className:"w-48",children:[z.jsx(vM,{asChild:!0,children:z.jsxs(Xs,{to:"/profile",className:"flex items-center",children:[z.jsx(lx,{className:"h-4 w-4 mr-2"}),"Profile"]})}),z.jsx(KW,{}),z.jsxs(vM,{onClick:I,className:"text-red-600",children:[z.jsx(iB,{className:"h-4 w-4 mr-2"}),"Sign Out"]})]})]})]})]}):z.jsxs("div",{className:"flex items-center space-x-2",children:[z.jsx(pi,{variant:"ghost",size:"sm",onClick:g,className:"transition-all duration-200",children:d==="light"?z.jsx(oB,{className:"h-4 w-4"}):z.jsx(cB,{className:"h-4 w-4"})}),z.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[z.jsx(pi,{variant:"outline",asChild:!0,size:"sm",children:z.jsx(Xs,{to:"/auth",children:"Sign In"})}),z.jsx(pi,{asChild:!0,size:"sm",children:z.jsx(Xs,{to:"/auth",children:"Sign Up"})})]})]})]})})})},wi=Q.forwardRef(({className:e,...t},r)=>z.jsx("div",{ref:r,className:zn("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));wi.displayName="Card";const Mi=Q.forwardRef(({className:e,...t},r)=>z.jsx("div",{ref:r,className:zn("flex flex-col space-y-1.5 p-6",e),...t}));Mi.displayName="CardHeader";const Ri=Q.forwardRef(({className:e,...t},r)=>z.jsx("h3",{ref:r,className:zn("text-2xl font-semibold leading-none tracking-tight",e),...t}));Ri.displayName="CardTitle";const xa=Q.forwardRef(({className:e,...t},r)=>z.jsx("p",{ref:r,className:zn("text-sm text-muted-foreground",e),...t}));xa.displayName="CardDescription";const Si=Q.forwardRef(({className:e,...t},r)=>z.jsx("div",{ref:r,className:zn("p-6 pt-0",e),...t}));Si.displayName="CardContent";const bde=Q.forwardRef(({className:e,...t},r)=>z.jsx("div",{ref:r,className:zn("flex items-center p-6 pt-0",e),...t}));bde.displayName="CardFooter";var wde=Array.isArray,ba=wde,Sde=typeof gs=="object"&&gs&&gs.Object===Object&&gs,xq=Sde,Tde=xq,Ede=typeof self=="object"&&self&&self.Object===Object&&self,Ade=Tde||Ede||Function("return this")(),ru=Ade,Pde=ru,Cde=Pde.Symbol,H1=Cde,f4=H1,bq=Object.prototype,Ide=bq.hasOwnProperty,Ode=bq.toString,R0=f4?f4.toStringTag:void 0;function Mde(e){var t=Ide.call(e,R0),r=e[R0];try{e[R0]=void 0;var i=!0}catch{}var c=Ode.call(e);return i&&(t?e[R0]=r:delete e[R0]),c}var Rde=Mde,kde=Object.prototype,Dde=kde.toString;function Lde(e){return Dde.call(e)}var zde=Lde,p4=H1,Nde=Rde,jde=zde,Fde="[object Null]",Bde="[object Undefined]",m4=p4?p4.toStringTag:void 0;function $de(e){return e==null?e===void 0?Bde:Fde:m4&&m4 in Object(e)?Nde(e):jde(e)}var ih=$de;function Ude(e){return e!=null&&typeof e=="object"}var oh=Ude,Vde=ih,Gde=oh,Hde="[object Symbol]";function Wde(e){return typeof e=="symbol"||Gde(e)&&Vde(e)==Hde}var xy=Wde,qde=ba,Zde=xy,Xde=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kde=/^\w*$/;function Yde(e,t){if(qde(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||Zde(e)?!0:Kde.test(e)||!Xde.test(e)||t!=null&&e in Object(t)}var jD=Yde;function Jde(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Yd=Jde;const by=Ii(Yd);var Qde=ih,efe=Yd,tfe="[object AsyncFunction]",rfe="[object Function]",nfe="[object GeneratorFunction]",ife="[object Proxy]";function ofe(e){if(!efe(e))return!1;var t=Qde(e);return t==rfe||t==nfe||t==tfe||t==ife}var FD=ofe;const An=Ii(FD);var sfe=ru,afe=sfe["__core-js_shared__"],lfe=afe,AI=lfe,g4=function(){var e=/[^.]+$/.exec(AI&&AI.keys&&AI.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function cfe(e){return!!g4&&g4 in e}var ufe=cfe,hfe=Function.prototype,dfe=hfe.toString;function ffe(e){if(e!=null){try{return dfe.call(e)}catch{}try{return e+""}catch{}}return""}var wq=ffe,pfe=FD,mfe=ufe,gfe=Yd,_fe=wq,yfe=/[\\^$.*+?()[\]{}|]/g,vfe=/^\[object .+?Constructor\]$/,xfe=Function.prototype,bfe=Object.prototype,wfe=xfe.toString,Sfe=bfe.hasOwnProperty,Tfe=RegExp("^"+wfe.call(Sfe).replace(yfe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Efe(e){if(!gfe(e)||mfe(e))return!1;var t=pfe(e)?Tfe:vfe;return t.test(_fe(e))}var Afe=Efe;function Pfe(e,t){return e==null?void 0:e[t]}var Cfe=Pfe,Ife=Afe,Ofe=Cfe;function Mfe(e,t){var r=Ofe(e,t);return Ife(r)?r:void 0}var lm=Mfe,Rfe=lm,kfe=Rfe(Object,"create"),R2=kfe,_4=R2;function Dfe(){this.__data__=_4?_4(null):{},this.size=0}var Lfe=Dfe;function zfe(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var Nfe=zfe,jfe=R2,Ffe="__lodash_hash_undefined__",Bfe=Object.prototype,$fe=Bfe.hasOwnProperty;function Ufe(e){var t=this.__data__;if(jfe){var r=t[e];return r===Ffe?void 0:r}return $fe.call(t,e)?t[e]:void 0}var Vfe=Ufe,Gfe=R2,Hfe=Object.prototype,Wfe=Hfe.hasOwnProperty;function qfe(e){var t=this.__data__;return Gfe?t[e]!==void 0:Wfe.call(t,e)}var Zfe=qfe,Xfe=R2,Kfe="__lodash_hash_undefined__";function Yfe(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=Xfe&&t===void 0?Kfe:t,this}var Jfe=Yfe,Qfe=Lfe,epe=Nfe,tpe=Vfe,rpe=Zfe,npe=Jfe;function wy(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}wy.prototype.clear=Qfe;wy.prototype.delete=epe;wy.prototype.get=tpe;wy.prototype.has=rpe;wy.prototype.set=npe;var ipe=wy;function ope(){this.__data__=[],this.size=0}var spe=ope;function ape(e,t){return e===t||e!==e&&t!==t}var BD=ape,lpe=BD;function cpe(e,t){for(var r=e.length;r--;)if(lpe(e[r][0],t))return r;return-1}var k2=cpe,upe=k2,hpe=Array.prototype,dpe=hpe.splice;function fpe(e){var t=this.__data__,r=upe(t,e);if(r<0)return!1;var i=t.length-1;return r==i?t.pop():dpe.call(t,r,1),--this.size,!0}var ppe=fpe,mpe=k2;function gpe(e){var t=this.__data__,r=mpe(t,e);return r<0?void 0:t[r][1]}var _pe=gpe,ype=k2;function vpe(e){return ype(this.__data__,e)>-1}var xpe=vpe,bpe=k2;function wpe(e,t){var r=this.__data__,i=bpe(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}var Spe=wpe,Tpe=spe,Epe=ppe,Ape=_pe,Ppe=xpe,Cpe=Spe;function Sy(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Sy.prototype.clear=Tpe;Sy.prototype.delete=Epe;Sy.prototype.get=Ape;Sy.prototype.has=Ppe;Sy.prototype.set=Cpe;var D2=Sy,Ipe=lm,Ope=ru,Mpe=Ipe(Ope,"Map"),$D=Mpe,y4=ipe,Rpe=D2,kpe=$D;function Dpe(){this.size=0,this.__data__={hash:new y4,map:new(kpe||Rpe),string:new y4}}var Lpe=Dpe;function zpe(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var Npe=zpe,jpe=Npe;function Fpe(e,t){var r=e.__data__;return jpe(t)?r[typeof t=="string"?"string":"hash"]:r.map}var L2=Fpe,Bpe=L2;function $pe(e){var t=Bpe(this,e).delete(e);return this.size-=t?1:0,t}var Upe=$pe,Vpe=L2;function Gpe(e){return Vpe(this,e).get(e)}var Hpe=Gpe,Wpe=L2;function qpe(e){return Wpe(this,e).has(e)}var Zpe=qpe,Xpe=L2;function Kpe(e,t){var r=Xpe(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}var Ype=Kpe,Jpe=Lpe,Qpe=Upe,eme=Hpe,tme=Zpe,rme=Ype;function Ty(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var i=e[t];this.set(i[0],i[1])}}Ty.prototype.clear=Jpe;Ty.prototype.delete=Qpe;Ty.prototype.get=eme;Ty.prototype.has=tme;Ty.prototype.set=rme;var UD=Ty,Sq=UD,nme="Expected a function";function VD(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(nme);var r=function(){var i=arguments,c=t?t.apply(this,i):i[0],d=r.cache;if(d.has(c))return d.get(c);var g=e.apply(this,i);return r.cache=d.set(c,g)||d,g};return r.cache=new(VD.Cache||Sq),r}VD.Cache=Sq;var Tq=VD;const ime=Ii(Tq);var ome=Tq,sme=500;function ame(e){var t=ome(e,function(i){return r.size===sme&&r.clear(),i}),r=t.cache;return t}var lme=ame,cme=lme,ume=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hme=/\\(\\)?/g,dme=cme(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(ume,function(r,i,c,d){t.push(c?d.replace(hme,"$1"):i||r)}),t}),fme=dme;function pme(e,t){for(var r=-1,i=e==null?0:e.length,c=Array(i);++r<i;)c[r]=t(e[r],r,e);return c}var GD=pme,v4=H1,mme=GD,gme=ba,_me=xy,yme=1/0,x4=v4?v4.prototype:void 0,b4=x4?x4.toString:void 0;function Eq(e){if(typeof e=="string")return e;if(gme(e))return mme(e,Eq)+"";if(_me(e))return b4?b4.call(e):"";var t=e+"";return t=="0"&&1/e==-yme?"-0":t}var vme=Eq,xme=vme;function bme(e){return e==null?"":xme(e)}var Aq=bme,wme=ba,Sme=jD,Tme=fme,Eme=Aq;function Ame(e,t){return wme(e)?e:Sme(e,t)?[e]:Tme(Eme(e))}var Pq=Ame,Pme=xy,Cme=1/0;function Ime(e){if(typeof e=="string"||Pme(e))return e;var t=e+"";return t=="0"&&1/e==-Cme?"-0":t}var z2=Ime,Ome=Pq,Mme=z2;function Rme(e,t){t=Ome(t,e);for(var r=0,i=t.length;e!=null&&r<i;)e=e[Mme(t[r++])];return r&&r==i?e:void 0}var HD=Rme,kme=HD;function Dme(e,t,r){var i=e==null?void 0:kme(e,t);return i===void 0?r:i}var Cq=Dme;const Va=Ii(Cq);function Lme(e){return e==null}var zme=Lme;const ni=Ii(zme);var Nme=ih,jme=ba,Fme=oh,Bme="[object String]";function $me(e){return typeof e=="string"||!jme(e)&&Fme(e)&&Nme(e)==Bme}var Ume=$me;const W1=Ii(Ume);var Iq={exports:{}},Ni={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var WD=Symbol.for("react.element"),qD=Symbol.for("react.portal"),N2=Symbol.for("react.fragment"),j2=Symbol.for("react.strict_mode"),F2=Symbol.for("react.profiler"),B2=Symbol.for("react.provider"),$2=Symbol.for("react.context"),Vme=Symbol.for("react.server_context"),U2=Symbol.for("react.forward_ref"),V2=Symbol.for("react.suspense"),G2=Symbol.for("react.suspense_list"),H2=Symbol.for("react.memo"),W2=Symbol.for("react.lazy"),Gme=Symbol.for("react.offscreen"),Oq;Oq=Symbol.for("react.module.reference");function vl(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case WD:switch(e=e.type,e){case N2:case F2:case j2:case V2:case G2:return e;default:switch(e=e&&e.$$typeof,e){case Vme:case $2:case U2:case W2:case H2:case B2:return e;default:return t}}case qD:return t}}}Ni.ContextConsumer=$2;Ni.ContextProvider=B2;Ni.Element=WD;Ni.ForwardRef=U2;Ni.Fragment=N2;Ni.Lazy=W2;Ni.Memo=H2;Ni.Portal=qD;Ni.Profiler=F2;Ni.StrictMode=j2;Ni.Suspense=V2;Ni.SuspenseList=G2;Ni.isAsyncMode=function(){return!1};Ni.isConcurrentMode=function(){return!1};Ni.isContextConsumer=function(e){return vl(e)===$2};Ni.isContextProvider=function(e){return vl(e)===B2};Ni.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===WD};Ni.isForwardRef=function(e){return vl(e)===U2};Ni.isFragment=function(e){return vl(e)===N2};Ni.isLazy=function(e){return vl(e)===W2};Ni.isMemo=function(e){return vl(e)===H2};Ni.isPortal=function(e){return vl(e)===qD};Ni.isProfiler=function(e){return vl(e)===F2};Ni.isStrictMode=function(e){return vl(e)===j2};Ni.isSuspense=function(e){return vl(e)===V2};Ni.isSuspenseList=function(e){return vl(e)===G2};Ni.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===N2||e===F2||e===j2||e===V2||e===G2||e===Gme||typeof e=="object"&&e!==null&&(e.$$typeof===W2||e.$$typeof===H2||e.$$typeof===B2||e.$$typeof===$2||e.$$typeof===U2||e.$$typeof===Oq||e.getModuleId!==void 0)};Ni.typeOf=vl;Iq.exports=Ni;var Mq=Iq.exports,Hme=ih,Wme=oh,qme="[object Number]";function Zme(e){return typeof e=="number"||Wme(e)&&Hme(e)==qme}var Rq=Zme;const Xme=Ii(Rq);var Kme=Rq;function Yme(e){return Kme(e)&&e!=+e}var Jme=Yme;const q1=Ii(Jme);var Ys=function(t){return t===0?0:t>0?1:-1},Ep=function(t){return W1(t)&&t.indexOf("%")===t.length-1},gr=function(t){return Xme(t)&&!q1(t)},Wo=function(t){return gr(t)||W1(t)},Qme=0,Z1=function(t){var r=++Qme;return"".concat(t||"").concat(r)},Js=function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!gr(t)&&!W1(t))return i;var d;if(Ep(t)){var g=t.indexOf("%");d=r*parseFloat(t.slice(0,g))/100}else d=+t;return q1(d)&&(d=i),c&&d>r&&(d=r),d},pd=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},ege=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,i={},c=0;c<r;c++)if(!i[t[c]])i[t[c]]=!0;else return!0;return!1},cd=function(t,r){return gr(t)&&gr(r)?function(i){return t+i*(r-t)}:function(){return r}};function xM(e,t,r){return!e||!e.length?null:e.find(function(i){return i&&(typeof t=="function"?t(i):Va(i,t))===r})}function f_(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var i in t)if({}.hasOwnProperty.call(t,i)&&!{}.hasOwnProperty.call(e,i))return!1;return!0}function bM(e){"@babel/helpers - typeof";return bM=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bM(e)}var tge=["viewBox","children"],rge=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],w4=["points","pathLength"],PI={svg:tge,polygon:w4,polyline:w4},ZD=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],HT=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var i=t;if(Q.isValidElement(t)&&(i=t.props),!by(i))return null;var c={};return Object.keys(i).forEach(function(d){ZD.includes(d)&&(c[d]=r||function(g){return i[d](i,g)})}),c},nge=function(t,r,i){return function(c){return t(r,i,c),null}},Zp=function(t,r,i){if(!by(t)||bM(t)!=="object")return null;var c=null;return Object.keys(t).forEach(function(d){var g=t[d];ZD.includes(d)&&typeof g=="function"&&(c||(c={}),c[d]=nge(g,r,i))}),c},ige=["children"],oge=["children"];function S4(e,t){if(e==null)return{};var r=sge(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function sge(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}var T4={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"},Gu=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},E4=null,CI=null,XD=function e(t){if(t===E4&&Array.isArray(CI))return CI;var r=[];return Q.Children.forEach(t,function(i){ni(i)||(Mq.isFragment(i)?r=r.concat(e(i.props.children)):r.push(i))}),CI=r,E4=t,r};function ml(e,t){var r=[],i=[];return Array.isArray(t)?i=t.map(function(c){return Gu(c)}):i=[Gu(t)],XD(e).forEach(function(c){var d=Va(c,"type.displayName")||Va(c,"type.name");i.indexOf(d)!==-1&&r.push(c)}),r}function za(e,t){var r=ml(e,t);return r&&r[0]}var A4=function(t){if(!t||!t.props)return!1;var r=t.props,i=r.width,c=r.height;return!(!gr(i)||i<=0||!gr(c)||c<=0)},age=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],lge=function(t){return t&&t.type&&W1(t.type)&&age.indexOf(t.type)>=0},cge=function(t,r,i,c){var d,g=(d=PI==null?void 0:PI[c])!==null&&d!==void 0?d:[];return!An(t)&&(c&&g.includes(r)||rge.includes(r))||i&&ZD.includes(r)},hn=function(t,r,i){if(!t||typeof t=="function"||typeof t=="boolean")return null;var c=t;if(Q.isValidElement(t)&&(c=t.props),!by(c))return null;var d={};return Object.keys(c).forEach(function(g){var o;cge((o=c)===null||o===void 0?void 0:o[g],g,r,i)&&(d[g]=c[g])}),d},wM=function e(t,r){if(t===r)return!0;var i=Q.Children.count(t);if(i!==Q.Children.count(r))return!1;if(i===0)return!0;if(i===1)return P4(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var c=0;c<i;c++){var d=t[c],g=r[c];if(Array.isArray(d)||Array.isArray(g)){if(!e(d,g))return!1}else if(!P4(d,g))return!1}return!0},P4=function(t,r){if(ni(t)&&ni(r))return!0;if(!ni(t)&&!ni(r)){var i=t.props||{},c=i.children,d=S4(i,ige),g=r.props||{},o=g.children,w=S4(g,oge);return c&&o?f_(d,w)&&wM(c,o):!c&&!o?f_(d,w):!1}return!1},C4=function(t,r){var i=[],c={};return XD(t).forEach(function(d,g){if(lge(d))i.push(d);else if(d){var o=Gu(d.type),w=r[o]||{},T=w.handler,I=w.once;if(T&&(!I||!c[o])){var C=T(d,o,g);i.push(C),c[o]=!0}}}),i},uge=function(t){var r=t&&t.type;return r&&T4[r]?T4[r]:null},hge=function(t,r){return XD(r).indexOf(t)},dge=["children","width","height","viewBox","className","style","title","desc"];function SM(){return SM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},SM.apply(this,arguments)}function fge(e,t){if(e==null)return{};var r=pge(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function pge(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function TM(e){var t=e.children,r=e.width,i=e.height,c=e.viewBox,d=e.className,g=e.style,o=e.title,w=e.desc,T=fge(e,dge),I=c||{width:r,height:i,x:0,y:0},C=Gn("recharts-surface",d);return De.createElement("svg",SM({},hn(T,!0,"svg"),{className:C,width:r,height:i,style:g,viewBox:"".concat(I.x," ").concat(I.y," ").concat(I.width," ").concat(I.height)}),De.createElement("title",null,o),De.createElement("desc",null,w),t)}var mge=["children","className"];function EM(){return EM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},EM.apply(this,arguments)}function gge(e,t){if(e==null)return{};var r=_ge(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function _ge(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}var Li=De.forwardRef(function(e,t){var r=e.children,i=e.className,c=gge(e,mge),d=Gn("recharts-layer",i);return De.createElement("g",EM({className:d},hn(c,!0),{ref:t}),r)}),sc=function(t,r){for(var i=arguments.length,c=new Array(i>2?i-2:0),d=2;d<i;d++)c[d-2]=arguments[d]};function yge(e,t,r){var i=-1,c=e.length;t<0&&(t=-t>c?0:c+t),r=r>c?c:r,r<0&&(r+=c),c=t>r?0:r-t>>>0,t>>>=0;for(var d=Array(c);++i<c;)d[i]=e[i+t];return d}var vge=yge,xge=vge;function bge(e,t,r){var i=e.length;return r=r===void 0?i:r,!t&&r>=i?e:xge(e,t,r)}var wge=bge,Sge="\\ud800-\\udfff",Tge="\\u0300-\\u036f",Ege="\\ufe20-\\ufe2f",Age="\\u20d0-\\u20ff",Pge=Tge+Ege+Age,Cge="\\ufe0e\\ufe0f",Ige="\\u200d",Oge=RegExp("["+Ige+Sge+Pge+Cge+"]");function Mge(e){return Oge.test(e)}var kq=Mge;function Rge(e){return e.split("")}var kge=Rge,Dq="\\ud800-\\udfff",Dge="\\u0300-\\u036f",Lge="\\ufe20-\\ufe2f",zge="\\u20d0-\\u20ff",Nge=Dge+Lge+zge,jge="\\ufe0e\\ufe0f",Fge="["+Dq+"]",AM="["+Nge+"]",PM="\\ud83c[\\udffb-\\udfff]",Bge="(?:"+AM+"|"+PM+")",Lq="[^"+Dq+"]",zq="(?:\\ud83c[\\udde6-\\uddff]){2}",Nq="[\\ud800-\\udbff][\\udc00-\\udfff]",$ge="\\u200d",jq=Bge+"?",Fq="["+jge+"]?",Uge="(?:"+$ge+"(?:"+[Lq,zq,Nq].join("|")+")"+Fq+jq+")*",Vge=Fq+jq+Uge,Gge="(?:"+[Lq+AM+"?",AM,zq,Nq,Fge].join("|")+")",Hge=RegExp(PM+"(?="+PM+")|"+Gge+Vge,"g");function Wge(e){return e.match(Hge)||[]}var qge=Wge,Zge=kge,Xge=kq,Kge=qge;function Yge(e){return Xge(e)?Kge(e):Zge(e)}var Jge=Yge,Qge=wge,e_e=kq,t_e=Jge,r_e=Aq;function n_e(e){return function(t){t=r_e(t);var r=e_e(t)?t_e(t):void 0,i=r?r[0]:t.charAt(0),c=r?Qge(r,1).join(""):t.slice(1);return i[e]()+c}}var i_e=n_e,o_e=i_e,s_e=o_e("toUpperCase"),a_e=s_e;const q2=Ii(a_e);function Xi(e){return function(){return e}}const Bq=Math.cos,WT=Math.sin,fc=Math.sqrt,qT=Math.PI,Z2=2*qT,CM=Math.PI,IM=2*CM,_p=1e-6,l_e=IM-_p;function $q(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function c_e(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return $q;const r=10**t;return function(i){this._+=i[0];for(let c=1,d=i.length;c<d;++c)this._+=Math.round(arguments[c]*r)/r+i[c]}}class u_e{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?$q:c_e(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,i,c){this._append`Q${+t},${+r},${this._x1=+i},${this._y1=+c}`}bezierCurveTo(t,r,i,c,d,g){this._append`C${+t},${+r},${+i},${+c},${this._x1=+d},${this._y1=+g}`}arcTo(t,r,i,c,d){if(t=+t,r=+r,i=+i,c=+c,d=+d,d<0)throw new Error(`negative radius: ${d}`);let g=this._x1,o=this._y1,w=i-t,T=c-r,I=g-t,C=o-r,R=I*I+C*C;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(R>_p)if(!(Math.abs(C*w-T*I)>_p)||!d)this._append`L${this._x1=t},${this._y1=r}`;else{let F=i-g,G=c-o,j=w*w+T*T,H=F*F+G*G,X=Math.sqrt(j),q=Math.sqrt(R),Z=d*Math.tan((CM-Math.acos((j+R-H)/(2*X*q)))/2),J=Z/q,ne=Z/X;Math.abs(J-1)>_p&&this._append`L${t+J*I},${r+J*C}`,this._append`A${d},${d},0,0,${+(C*F>I*G)},${this._x1=t+ne*w},${this._y1=r+ne*T}`}}arc(t,r,i,c,d,g){if(t=+t,r=+r,i=+i,g=!!g,i<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(c),w=i*Math.sin(c),T=t+o,I=r+w,C=1^g,R=g?c-d:d-c;this._x1===null?this._append`M${T},${I}`:(Math.abs(this._x1-T)>_p||Math.abs(this._y1-I)>_p)&&this._append`L${T},${I}`,i&&(R<0&&(R=R%IM+IM),R>l_e?this._append`A${i},${i},0,1,${C},${t-o},${r-w}A${i},${i},0,1,${C},${this._x1=T},${this._y1=I}`:R>_p&&this._append`A${i},${i},0,${+(R>=CM)},${C},${this._x1=t+i*Math.cos(d)},${this._y1=r+i*Math.sin(d)}`)}rect(t,r,i,c){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${i=+i}v${+c}h${-i}Z`}toString(){return this._}}function KD(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const i=Math.floor(r);if(!(i>=0))throw new RangeError(`invalid digits: ${r}`);t=i}return e},()=>new u_e(t)}function YD(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Uq(e){this._context=e}Uq.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function X2(e){return new Uq(e)}function Vq(e){return e[0]}function Gq(e){return e[1]}function Hq(e,t){var r=Xi(!0),i=null,c=X2,d=null,g=KD(o);e=typeof e=="function"?e:e===void 0?Vq:Xi(e),t=typeof t=="function"?t:t===void 0?Gq:Xi(t);function o(w){var T,I=(w=YD(w)).length,C,R=!1,F;for(i==null&&(d=c(F=g())),T=0;T<=I;++T)!(T<I&&r(C=w[T],T,w))===R&&((R=!R)?d.lineStart():d.lineEnd()),R&&d.point(+e(C,T,w),+t(C,T,w));if(F)return d=null,F+""||null}return o.x=function(w){return arguments.length?(e=typeof w=="function"?w:Xi(+w),o):e},o.y=function(w){return arguments.length?(t=typeof w=="function"?w:Xi(+w),o):t},o.defined=function(w){return arguments.length?(r=typeof w=="function"?w:Xi(!!w),o):r},o.curve=function(w){return arguments.length?(c=w,i!=null&&(d=c(i)),o):c},o.context=function(w){return arguments.length?(w==null?i=d=null:d=c(i=w),o):i},o}function OS(e,t,r){var i=null,c=Xi(!0),d=null,g=X2,o=null,w=KD(T);e=typeof e=="function"?e:e===void 0?Vq:Xi(+e),t=typeof t=="function"?t:Xi(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?Gq:Xi(+r);function T(C){var R,F,G,j=(C=YD(C)).length,H,X=!1,q,Z=new Array(j),J=new Array(j);for(d==null&&(o=g(q=w())),R=0;R<=j;++R){if(!(R<j&&c(H=C[R],R,C))===X)if(X=!X)F=R,o.areaStart(),o.lineStart();else{for(o.lineEnd(),o.lineStart(),G=R-1;G>=F;--G)o.point(Z[G],J[G]);o.lineEnd(),o.areaEnd()}X&&(Z[R]=+e(H,R,C),J[R]=+t(H,R,C),o.point(i?+i(H,R,C):Z[R],r?+r(H,R,C):J[R]))}if(q)return o=null,q+""||null}function I(){return Hq().defined(c).curve(g).context(d)}return T.x=function(C){return arguments.length?(e=typeof C=="function"?C:Xi(+C),i=null,T):e},T.x0=function(C){return arguments.length?(e=typeof C=="function"?C:Xi(+C),T):e},T.x1=function(C){return arguments.length?(i=C==null?null:typeof C=="function"?C:Xi(+C),T):i},T.y=function(C){return arguments.length?(t=typeof C=="function"?C:Xi(+C),r=null,T):t},T.y0=function(C){return arguments.length?(t=typeof C=="function"?C:Xi(+C),T):t},T.y1=function(C){return arguments.length?(r=C==null?null:typeof C=="function"?C:Xi(+C),T):r},T.lineX0=T.lineY0=function(){return I().x(e).y(t)},T.lineY1=function(){return I().x(e).y(r)},T.lineX1=function(){return I().x(i).y(t)},T.defined=function(C){return arguments.length?(c=typeof C=="function"?C:Xi(!!C),T):c},T.curve=function(C){return arguments.length?(g=C,d!=null&&(o=g(d)),T):g},T.context=function(C){return arguments.length?(C==null?d=o=null:o=g(d=C),T):d},T}class Wq{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function h_e(e){return new Wq(e,!0)}function d_e(e){return new Wq(e,!1)}const JD={draw(e,t){const r=fc(t/qT);e.moveTo(r,0),e.arc(0,0,r,0,Z2)}},f_e={draw(e,t){const r=fc(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},qq=fc(1/3),p_e=qq*2,m_e={draw(e,t){const r=fc(t/p_e),i=r*qq;e.moveTo(0,-r),e.lineTo(i,0),e.lineTo(0,r),e.lineTo(-i,0),e.closePath()}},g_e={draw(e,t){const r=fc(t),i=-r/2;e.rect(i,i,r,r)}},__e=.8908130915292852,Zq=WT(qT/10)/WT(7*qT/10),y_e=WT(Z2/10)*Zq,v_e=-Bq(Z2/10)*Zq,x_e={draw(e,t){const r=fc(t*__e),i=y_e*r,c=v_e*r;e.moveTo(0,-r),e.lineTo(i,c);for(let d=1;d<5;++d){const g=Z2*d/5,o=Bq(g),w=WT(g);e.lineTo(w*r,-o*r),e.lineTo(o*i-w*c,w*i+o*c)}e.closePath()}},II=fc(3),b_e={draw(e,t){const r=-fc(t/(II*3));e.moveTo(0,r*2),e.lineTo(-II*r,-r),e.lineTo(II*r,-r),e.closePath()}},il=-.5,ol=fc(3)/2,OM=1/fc(12),w_e=(OM/2+1)*3,S_e={draw(e,t){const r=fc(t/w_e),i=r/2,c=r*OM,d=i,g=r*OM+r,o=-d,w=g;e.moveTo(i,c),e.lineTo(d,g),e.lineTo(o,w),e.lineTo(il*i-ol*c,ol*i+il*c),e.lineTo(il*d-ol*g,ol*d+il*g),e.lineTo(il*o-ol*w,ol*o+il*w),e.lineTo(il*i+ol*c,il*c-ol*i),e.lineTo(il*d+ol*g,il*g-ol*d),e.lineTo(il*o+ol*w,il*w-ol*o),e.closePath()}};function T_e(e,t){let r=null,i=KD(c);e=typeof e=="function"?e:Xi(e||JD),t=typeof t=="function"?t:Xi(t===void 0?64:+t);function c(){let d;if(r||(r=d=i()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),d)return r=null,d+""||null}return c.type=function(d){return arguments.length?(e=typeof d=="function"?d:Xi(d),c):e},c.size=function(d){return arguments.length?(t=typeof d=="function"?d:Xi(+d),c):t},c.context=function(d){return arguments.length?(r=d??null,c):r},c}function ZT(){}function XT(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function Xq(e){this._context=e}Xq.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:XT(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:XT(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function E_e(e){return new Xq(e)}function Kq(e){this._context=e}Kq.prototype={areaStart:ZT,areaEnd:ZT,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:XT(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function A_e(e){return new Kq(e)}function Yq(e){this._context=e}Yq.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,i=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,i):this._context.moveTo(r,i);break;case 3:this._point=4;default:XT(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function P_e(e){return new Yq(e)}function Jq(e){this._context=e}Jq.prototype={areaStart:ZT,areaEnd:ZT,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function C_e(e){return new Jq(e)}function I4(e){return e<0?-1:1}function O4(e,t,r){var i=e._x1-e._x0,c=t-e._x1,d=(e._y1-e._y0)/(i||c<0&&-0),g=(r-e._y1)/(c||i<0&&-0),o=(d*c+g*i)/(i+c);return(I4(d)+I4(g))*Math.min(Math.abs(d),Math.abs(g),.5*Math.abs(o))||0}function M4(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function OI(e,t,r){var i=e._x0,c=e._y0,d=e._x1,g=e._y1,o=(d-i)/3;e._context.bezierCurveTo(i+o,c+o*t,d-o,g-o*r,d,g)}function KT(e){this._context=e}KT.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:OI(this,this._t0,M4(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,OI(this,M4(this,r=O4(this,e,t)),r);break;default:OI(this,this._t0,r=O4(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function Qq(e){this._context=new e9(e)}(Qq.prototype=Object.create(KT.prototype)).point=function(e,t){KT.prototype.point.call(this,t,e)};function e9(e){this._context=e}e9.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,i,c,d){this._context.bezierCurveTo(t,e,i,r,d,c)}};function I_e(e){return new KT(e)}function O_e(e){return new Qq(e)}function t9(e){this._context=e}t9.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var i=R4(e),c=R4(t),d=0,g=1;g<r;++d,++g)this._context.bezierCurveTo(i[0][d],c[0][d],i[1][d],c[1][d],e[g],t[g]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function R4(e){var t,r=e.length-1,i,c=new Array(r),d=new Array(r),g=new Array(r);for(c[0]=0,d[0]=2,g[0]=e[0]+2*e[1],t=1;t<r-1;++t)c[t]=1,d[t]=4,g[t]=4*e[t]+2*e[t+1];for(c[r-1]=2,d[r-1]=7,g[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)i=c[t]/d[t-1],d[t]-=i,g[t]-=i*g[t-1];for(c[r-1]=g[r-1]/d[r-1],t=r-2;t>=0;--t)c[t]=(g[t]-c[t+1])/d[t];for(d[r-1]=(e[r]+c[r-1])/2,t=0;t<r-1;++t)d[t]=2*e[t+1]-c[t+1];return[c,d]}function M_e(e){return new t9(e)}function K2(e,t){this._context=e,this._t=t}K2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function R_e(e){return new K2(e,.5)}function k_e(e){return new K2(e,0)}function D_e(e){return new K2(e,1)}function j_(e,t){if((g=e.length)>1)for(var r=1,i,c,d=e[t[0]],g,o=d.length;r<g;++r)for(c=d,d=e[t[r]],i=0;i<o;++i)d[i][1]+=d[i][0]=isNaN(c[i][1])?c[i][0]:c[i][1]}function MM(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function L_e(e,t){return e[t]}function z_e(e){const t=[];return t.key=e,t}function N_e(){var e=Xi([]),t=MM,r=j_,i=L_e;function c(d){var g=Array.from(e.apply(this,arguments),z_e),o,w=g.length,T=-1,I;for(const C of d)for(o=0,++T;o<w;++o)(g[o][T]=[0,+i(C,g[o].key,T,d)]).data=C;for(o=0,I=YD(t(g));o<w;++o)g[I[o]].index=o;return r(g,I),g}return c.keys=function(d){return arguments.length?(e=typeof d=="function"?d:Xi(Array.from(d)),c):e},c.value=function(d){return arguments.length?(i=typeof d=="function"?d:Xi(+d),c):i},c.order=function(d){return arguments.length?(t=d==null?MM:typeof d=="function"?d:Xi(Array.from(d)),c):t},c.offset=function(d){return arguments.length?(r=d??j_,c):r},c}function j_e(e,t){if((i=e.length)>0){for(var r,i,c=0,d=e[0].length,g;c<d;++c){for(g=r=0;r<i;++r)g+=e[r][c][1]||0;if(g)for(r=0;r<i;++r)e[r][c][1]/=g}j_(e,t)}}function F_e(e,t){if((c=e.length)>0){for(var r=0,i=e[t[0]],c,d=i.length;r<d;++r){for(var g=0,o=0;g<c;++g)o+=e[g][r][1]||0;i[r][1]+=i[r][0]=-o/2}j_(e,t)}}function B_e(e,t){if(!(!((g=e.length)>0)||!((d=(c=e[t[0]]).length)>0))){for(var r=0,i=1,c,d,g;i<d;++i){for(var o=0,w=0,T=0;o<g;++o){for(var I=e[t[o]],C=I[i][1]||0,R=I[i-1][1]||0,F=(C-R)/2,G=0;G<o;++G){var j=e[t[G]],H=j[i][1]||0,X=j[i-1][1]||0;F+=H-X}w+=C,T+=F*C}c[i-1][1]+=c[i-1][0]=r,w&&(r-=T/w)}c[i-1][1]+=c[i-1][0]=r,j_(e,t)}}function Wx(e){"@babel/helpers - typeof";return Wx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wx(e)}var $_e=["type","size","sizeType"];function RM(){return RM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},RM.apply(this,arguments)}function k4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function D4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k4(Object(r),!0).forEach(function(i){U_e(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k4(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function U_e(e,t,r){return t=V_e(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function V_e(e){var t=G_e(e,"string");return Wx(t)=="symbol"?t:t+""}function G_e(e,t){if(Wx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Wx(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function H_e(e,t){if(e==null)return{};var r=W_e(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function W_e(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}var r9={symbolCircle:JD,symbolCross:f_e,symbolDiamond:m_e,symbolSquare:g_e,symbolStar:x_e,symbolTriangle:b_e,symbolWye:S_e},q_e=Math.PI/180,Z_e=function(t){var r="symbol".concat(q2(t));return r9[r]||JD},X_e=function(t,r,i){if(r==="area")return t;switch(i){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var c=18*q_e;return 1.25*t*t*(Math.tan(c)-Math.tan(c*2)*Math.pow(Math.tan(c),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},K_e=function(t,r){r9["symbol".concat(q2(t))]=r},QD=function(t){var r=t.type,i=r===void 0?"circle":r,c=t.size,d=c===void 0?64:c,g=t.sizeType,o=g===void 0?"area":g,w=H_e(t,$_e),T=D4(D4({},w),{},{type:i,size:d,sizeType:o}),I=function(){var H=Z_e(i),X=T_e().type(H).size(X_e(d,o,i));return X()},C=T.className,R=T.cx,F=T.cy,G=hn(T,!0);return R===+R&&F===+F&&d===+d?De.createElement("path",RM({},G,{className:Gn("recharts-symbols",C),transform:"translate(".concat(R,", ").concat(F,")"),d:I()})):null};QD.registerSymbol=K_e;function F_(e){"@babel/helpers - typeof";return F_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},F_(e)}function kM(){return kM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},kM.apply(this,arguments)}function L4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Y_e(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L4(Object(r),!0).forEach(function(i){qx(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L4(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function J_e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q_e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i9(i.key),i)}}function eye(e,t,r){return t&&Q_e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tye(e,t,r){return t=YT(t),rye(e,n9()?Reflect.construct(t,r||[],YT(e).constructor):t.apply(e,r))}function rye(e,t){if(t&&(F_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nye(e)}function nye(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n9(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(n9=function(){return!!e})()}function YT(e){return YT=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},YT(e)}function iye(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DM(e,t)}function DM(e,t){return DM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},DM(e,t)}function qx(e,t,r){return t=i9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i9(e){var t=oye(e,"string");return F_(t)=="symbol"?t:t+""}function oye(e,t){if(F_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(F_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var sl=32,eL=function(e){function t(){return J_e(this,t),tye(this,t,arguments)}return iye(t,e),eye(t,[{key:"renderIcon",value:function(i){var c=this.props.inactiveColor,d=sl/2,g=sl/6,o=sl/3,w=i.inactive?c:i.color;if(i.type==="plainline")return De.createElement("line",{strokeWidth:4,fill:"none",stroke:w,strokeDasharray:i.payload.strokeDasharray,x1:0,y1:d,x2:sl,y2:d,className:"recharts-legend-icon"});if(i.type==="line")return De.createElement("path",{strokeWidth:4,fill:"none",stroke:w,d:"M0,".concat(d,"h").concat(o,`
            A`).concat(g,",").concat(g,",0,1,1,").concat(2*o,",").concat(d,`
            H`).concat(sl,"M").concat(2*o,",").concat(d,`
            A`).concat(g,",").concat(g,",0,1,1,").concat(o,",").concat(d),className:"recharts-legend-icon"});if(i.type==="rect")return De.createElement("path",{stroke:"none",fill:w,d:"M0,".concat(sl/8,"h").concat(sl,"v").concat(sl*3/4,"h").concat(-sl,"z"),className:"recharts-legend-icon"});if(De.isValidElement(i.legendIcon)){var T=Y_e({},i);return delete T.legendIcon,De.cloneElement(i.legendIcon,T)}return De.createElement(QD,{fill:w,cx:d,cy:d,size:sl,sizeType:"diameter",type:i.type})}},{key:"renderItems",value:function(){var i=this,c=this.props,d=c.payload,g=c.iconSize,o=c.layout,w=c.formatter,T=c.inactiveColor,I={x:0,y:0,width:sl,height:sl},C={display:o==="horizontal"?"inline-block":"block",marginRight:10},R={display:"inline-block",verticalAlign:"middle",marginRight:4};return d.map(function(F,G){var j=F.formatter||w,H=Gn(qx(qx({"recharts-legend-item":!0},"legend-item-".concat(G),!0),"inactive",F.inactive));if(F.type==="none")return null;var X=An(F.value)?null:F.value;sc(!An(F.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var q=F.inactive?T:F.color;return De.createElement("li",kM({className:H,style:C,key:"legend-item-".concat(G)},Zp(i.props,F,G)),De.createElement(TM,{width:g,height:g,viewBox:I,style:R},i.renderIcon(F)),De.createElement("span",{className:"recharts-legend-item-text",style:{color:q}},j?j(X,F,G):X))})}},{key:"render",value:function(){var i=this.props,c=i.payload,d=i.layout,g=i.align;if(!c||!c.length)return null;var o={padding:0,margin:0,textAlign:d==="horizontal"?g:"left"};return De.createElement("ul",{className:"recharts-default-legend",style:o},this.renderItems())}}])}(Q.PureComponent);qx(eL,"displayName","Legend");qx(eL,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var sye=D2;function aye(){this.__data__=new sye,this.size=0}var lye=aye;function cye(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var uye=cye;function hye(e){return this.__data__.get(e)}var dye=hye;function fye(e){return this.__data__.has(e)}var pye=fye,mye=D2,gye=$D,_ye=UD,yye=200;function vye(e,t){var r=this.__data__;if(r instanceof mye){var i=r.__data__;if(!gye||i.length<yye-1)return i.push([e,t]),this.size=++r.size,this;r=this.__data__=new _ye(i)}return r.set(e,t),this.size=r.size,this}var xye=vye,bye=D2,wye=lye,Sye=uye,Tye=dye,Eye=pye,Aye=xye;function Ey(e){var t=this.__data__=new bye(e);this.size=t.size}Ey.prototype.clear=wye;Ey.prototype.delete=Sye;Ey.prototype.get=Tye;Ey.prototype.has=Eye;Ey.prototype.set=Aye;var o9=Ey,Pye="__lodash_hash_undefined__";function Cye(e){return this.__data__.set(e,Pye),this}var Iye=Cye;function Oye(e){return this.__data__.has(e)}var Mye=Oye,Rye=UD,kye=Iye,Dye=Mye;function JT(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new Rye;++t<r;)this.add(e[t])}JT.prototype.add=JT.prototype.push=kye;JT.prototype.has=Dye;var s9=JT;function Lye(e,t){for(var r=-1,i=e==null?0:e.length;++r<i;)if(t(e[r],r,e))return!0;return!1}var a9=Lye;function zye(e,t){return e.has(t)}var l9=zye,Nye=s9,jye=a9,Fye=l9,Bye=1,$ye=2;function Uye(e,t,r,i,c,d){var g=r&Bye,o=e.length,w=t.length;if(o!=w&&!(g&&w>o))return!1;var T=d.get(e),I=d.get(t);if(T&&I)return T==t&&I==e;var C=-1,R=!0,F=r&$ye?new Nye:void 0;for(d.set(e,t),d.set(t,e);++C<o;){var G=e[C],j=t[C];if(i)var H=g?i(j,G,C,t,e,d):i(G,j,C,e,t,d);if(H!==void 0){if(H)continue;R=!1;break}if(F){if(!jye(t,function(X,q){if(!Fye(F,q)&&(G===X||c(G,X,r,i,d)))return F.push(q)})){R=!1;break}}else if(!(G===j||c(G,j,r,i,d))){R=!1;break}}return d.delete(e),d.delete(t),R}var c9=Uye,Vye=ru,Gye=Vye.Uint8Array,Hye=Gye;function Wye(e){var t=-1,r=Array(e.size);return e.forEach(function(i,c){r[++t]=[c,i]}),r}var qye=Wye;function Zye(e){var t=-1,r=Array(e.size);return e.forEach(function(i){r[++t]=i}),r}var tL=Zye,z4=H1,N4=Hye,Xye=BD,Kye=c9,Yye=qye,Jye=tL,Qye=1,eve=2,tve="[object Boolean]",rve="[object Date]",nve="[object Error]",ive="[object Map]",ove="[object Number]",sve="[object RegExp]",ave="[object Set]",lve="[object String]",cve="[object Symbol]",uve="[object ArrayBuffer]",hve="[object DataView]",j4=z4?z4.prototype:void 0,MI=j4?j4.valueOf:void 0;function dve(e,t,r,i,c,d,g){switch(r){case hve:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case uve:return!(e.byteLength!=t.byteLength||!d(new N4(e),new N4(t)));case tve:case rve:case ove:return Xye(+e,+t);case nve:return e.name==t.name&&e.message==t.message;case sve:case lve:return e==t+"";case ive:var o=Yye;case ave:var w=i&Qye;if(o||(o=Jye),e.size!=t.size&&!w)return!1;var T=g.get(e);if(T)return T==t;i|=eve,g.set(e,t);var I=Kye(o(e),o(t),i,c,d,g);return g.delete(e),I;case cve:if(MI)return MI.call(e)==MI.call(t)}return!1}var fve=dve;function pve(e,t){for(var r=-1,i=t.length,c=e.length;++r<i;)e[c+r]=t[r];return e}var u9=pve,mve=u9,gve=ba;function _ve(e,t,r){var i=t(e);return gve(e)?i:mve(i,r(e))}var yve=_ve;function vve(e,t){for(var r=-1,i=e==null?0:e.length,c=0,d=[];++r<i;){var g=e[r];t(g,r,e)&&(d[c++]=g)}return d}var xve=vve;function bve(){return[]}var wve=bve,Sve=xve,Tve=wve,Eve=Object.prototype,Ave=Eve.propertyIsEnumerable,F4=Object.getOwnPropertySymbols,Pve=F4?function(e){return e==null?[]:(e=Object(e),Sve(F4(e),function(t){return Ave.call(e,t)}))}:Tve,Cve=Pve;function Ive(e,t){for(var r=-1,i=Array(e);++r<e;)i[r]=t(r);return i}var Ove=Ive,Mve=ih,Rve=oh,kve="[object Arguments]";function Dve(e){return Rve(e)&&Mve(e)==kve}var Lve=Dve,B4=Lve,zve=oh,h9=Object.prototype,Nve=h9.hasOwnProperty,jve=h9.propertyIsEnumerable,Fve=B4(function(){return arguments}())?B4:function(e){return zve(e)&&Nve.call(e,"callee")&&!jve.call(e,"callee")},rL=Fve,QT={exports:{}};function Bve(){return!1}var $ve=Bve;QT.exports;(function(e,t){var r=ru,i=$ve,c=t&&!t.nodeType&&t,d=c&&!0&&e&&!e.nodeType&&e,g=d&&d.exports===c,o=g?r.Buffer:void 0,w=o?o.isBuffer:void 0,T=w||i;e.exports=T})(QT,QT.exports);var d9=QT.exports,Uve=9007199254740991,Vve=/^(?:0|[1-9]\d*)$/;function Gve(e,t){var r=typeof e;return t=t??Uve,!!t&&(r=="number"||r!="symbol"&&Vve.test(e))&&e>-1&&e%1==0&&e<t}var nL=Gve,Hve=9007199254740991;function Wve(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Hve}var iL=Wve,qve=ih,Zve=iL,Xve=oh,Kve="[object Arguments]",Yve="[object Array]",Jve="[object Boolean]",Qve="[object Date]",e0e="[object Error]",t0e="[object Function]",r0e="[object Map]",n0e="[object Number]",i0e="[object Object]",o0e="[object RegExp]",s0e="[object Set]",a0e="[object String]",l0e="[object WeakMap]",c0e="[object ArrayBuffer]",u0e="[object DataView]",h0e="[object Float32Array]",d0e="[object Float64Array]",f0e="[object Int8Array]",p0e="[object Int16Array]",m0e="[object Int32Array]",g0e="[object Uint8Array]",_0e="[object Uint8ClampedArray]",y0e="[object Uint16Array]",v0e="[object Uint32Array]",to={};to[h0e]=to[d0e]=to[f0e]=to[p0e]=to[m0e]=to[g0e]=to[_0e]=to[y0e]=to[v0e]=!0;to[Kve]=to[Yve]=to[c0e]=to[Jve]=to[u0e]=to[Qve]=to[e0e]=to[t0e]=to[r0e]=to[n0e]=to[i0e]=to[o0e]=to[s0e]=to[a0e]=to[l0e]=!1;function x0e(e){return Xve(e)&&Zve(e.length)&&!!to[qve(e)]}var b0e=x0e;function w0e(e){return function(t){return e(t)}}var f9=w0e,eE={exports:{}};eE.exports;(function(e,t){var r=xq,i=t&&!t.nodeType&&t,c=i&&!0&&e&&!e.nodeType&&e,d=c&&c.exports===i,g=d&&r.process,o=function(){try{var w=c&&c.require&&c.require("util").types;return w||g&&g.binding&&g.binding("util")}catch{}}();e.exports=o})(eE,eE.exports);var S0e=eE.exports,T0e=b0e,E0e=f9,$4=S0e,U4=$4&&$4.isTypedArray,A0e=U4?E0e(U4):T0e,p9=A0e,P0e=Ove,C0e=rL,I0e=ba,O0e=d9,M0e=nL,R0e=p9,k0e=Object.prototype,D0e=k0e.hasOwnProperty;function L0e(e,t){var r=I0e(e),i=!r&&C0e(e),c=!r&&!i&&O0e(e),d=!r&&!i&&!c&&R0e(e),g=r||i||c||d,o=g?P0e(e.length,String):[],w=o.length;for(var T in e)(t||D0e.call(e,T))&&!(g&&(T=="length"||c&&(T=="offset"||T=="parent")||d&&(T=="buffer"||T=="byteLength"||T=="byteOffset")||M0e(T,w)))&&o.push(T);return o}var z0e=L0e,N0e=Object.prototype;function j0e(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||N0e;return e===r}var F0e=j0e;function B0e(e,t){return function(r){return e(t(r))}}var m9=B0e,$0e=m9,U0e=$0e(Object.keys,Object),V0e=U0e,G0e=F0e,H0e=V0e,W0e=Object.prototype,q0e=W0e.hasOwnProperty;function Z0e(e){if(!G0e(e))return H0e(e);var t=[];for(var r in Object(e))q0e.call(e,r)&&r!="constructor"&&t.push(r);return t}var X0e=Z0e,K0e=FD,Y0e=iL;function J0e(e){return e!=null&&Y0e(e.length)&&!K0e(e)}var X1=J0e,Q0e=z0e,exe=X0e,txe=X1;function rxe(e){return txe(e)?Q0e(e):exe(e)}var Y2=rxe,nxe=yve,ixe=Cve,oxe=Y2;function sxe(e){return nxe(e,oxe,ixe)}var axe=sxe,V4=axe,lxe=1,cxe=Object.prototype,uxe=cxe.hasOwnProperty;function hxe(e,t,r,i,c,d){var g=r&lxe,o=V4(e),w=o.length,T=V4(t),I=T.length;if(w!=I&&!g)return!1;for(var C=w;C--;){var R=o[C];if(!(g?R in t:uxe.call(t,R)))return!1}var F=d.get(e),G=d.get(t);if(F&&G)return F==t&&G==e;var j=!0;d.set(e,t),d.set(t,e);for(var H=g;++C<w;){R=o[C];var X=e[R],q=t[R];if(i)var Z=g?i(q,X,R,t,e,d):i(X,q,R,e,t,d);if(!(Z===void 0?X===q||c(X,q,r,i,d):Z)){j=!1;break}H||(H=R=="constructor")}if(j&&!H){var J=e.constructor,ne=t.constructor;J!=ne&&"constructor"in e&&"constructor"in t&&!(typeof J=="function"&&J instanceof J&&typeof ne=="function"&&ne instanceof ne)&&(j=!1)}return d.delete(e),d.delete(t),j}var dxe=hxe,fxe=lm,pxe=ru,mxe=fxe(pxe,"DataView"),gxe=mxe,_xe=lm,yxe=ru,vxe=_xe(yxe,"Promise"),xxe=vxe,bxe=lm,wxe=ru,Sxe=bxe(wxe,"Set"),g9=Sxe,Txe=lm,Exe=ru,Axe=Txe(Exe,"WeakMap"),Pxe=Axe,LM=gxe,zM=$D,NM=xxe,jM=g9,FM=Pxe,_9=ih,Ay=wq,G4="[object Map]",Cxe="[object Object]",H4="[object Promise]",W4="[object Set]",q4="[object WeakMap]",Z4="[object DataView]",Ixe=Ay(LM),Oxe=Ay(zM),Mxe=Ay(NM),Rxe=Ay(jM),kxe=Ay(FM),yp=_9;(LM&&yp(new LM(new ArrayBuffer(1)))!=Z4||zM&&yp(new zM)!=G4||NM&&yp(NM.resolve())!=H4||jM&&yp(new jM)!=W4||FM&&yp(new FM)!=q4)&&(yp=function(e){var t=_9(e),r=t==Cxe?e.constructor:void 0,i=r?Ay(r):"";if(i)switch(i){case Ixe:return Z4;case Oxe:return G4;case Mxe:return H4;case Rxe:return W4;case kxe:return q4}return t});var Dxe=yp,RI=o9,Lxe=c9,zxe=fve,Nxe=dxe,X4=Dxe,K4=ba,Y4=d9,jxe=p9,Fxe=1,J4="[object Arguments]",Q4="[object Array]",MS="[object Object]",Bxe=Object.prototype,e5=Bxe.hasOwnProperty;function $xe(e,t,r,i,c,d){var g=K4(e),o=K4(t),w=g?Q4:X4(e),T=o?Q4:X4(t);w=w==J4?MS:w,T=T==J4?MS:T;var I=w==MS,C=T==MS,R=w==T;if(R&&Y4(e)){if(!Y4(t))return!1;g=!0,I=!1}if(R&&!I)return d||(d=new RI),g||jxe(e)?Lxe(e,t,r,i,c,d):zxe(e,t,w,r,i,c,d);if(!(r&Fxe)){var F=I&&e5.call(e,"__wrapped__"),G=C&&e5.call(t,"__wrapped__");if(F||G){var j=F?e.value():e,H=G?t.value():t;return d||(d=new RI),c(j,H,r,i,d)}}return R?(d||(d=new RI),Nxe(e,t,r,i,c,d)):!1}var Uxe=$xe,Vxe=Uxe,t5=oh;function y9(e,t,r,i,c){return e===t?!0:e==null||t==null||!t5(e)&&!t5(t)?e!==e&&t!==t:Vxe(e,t,r,i,y9,c)}var oL=y9,Gxe=o9,Hxe=oL,Wxe=1,qxe=2;function Zxe(e,t,r,i){var c=r.length,d=c,g=!i;if(e==null)return!d;for(e=Object(e);c--;){var o=r[c];if(g&&o[2]?o[1]!==e[o[0]]:!(o[0]in e))return!1}for(;++c<d;){o=r[c];var w=o[0],T=e[w],I=o[1];if(g&&o[2]){if(T===void 0&&!(w in e))return!1}else{var C=new Gxe;if(i)var R=i(T,I,w,e,t,C);if(!(R===void 0?Hxe(I,T,Wxe|qxe,i,C):R))return!1}}return!0}var Xxe=Zxe,Kxe=Yd;function Yxe(e){return e===e&&!Kxe(e)}var v9=Yxe,Jxe=v9,Qxe=Y2;function e1e(e){for(var t=Qxe(e),r=t.length;r--;){var i=t[r],c=e[i];t[r]=[i,c,Jxe(c)]}return t}var t1e=e1e;function r1e(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var x9=r1e,n1e=Xxe,i1e=t1e,o1e=x9;function s1e(e){var t=i1e(e);return t.length==1&&t[0][2]?o1e(t[0][0],t[0][1]):function(r){return r===e||n1e(r,e,t)}}var a1e=s1e;function l1e(e,t){return e!=null&&t in Object(e)}var c1e=l1e,u1e=Pq,h1e=rL,d1e=ba,f1e=nL,p1e=iL,m1e=z2;function g1e(e,t,r){t=u1e(t,e);for(var i=-1,c=t.length,d=!1;++i<c;){var g=m1e(t[i]);if(!(d=e!=null&&r(e,g)))break;e=e[g]}return d||++i!=c?d:(c=e==null?0:e.length,!!c&&p1e(c)&&f1e(g,c)&&(d1e(e)||h1e(e)))}var _1e=g1e,y1e=c1e,v1e=_1e;function x1e(e,t){return e!=null&&v1e(e,t,y1e)}var b1e=x1e,w1e=oL,S1e=Cq,T1e=b1e,E1e=jD,A1e=v9,P1e=x9,C1e=z2,I1e=1,O1e=2;function M1e(e,t){return E1e(e)&&A1e(t)?P1e(C1e(e),t):function(r){var i=S1e(r,e);return i===void 0&&i===t?T1e(r,e):w1e(t,i,I1e|O1e)}}var R1e=M1e;function k1e(e){return e}var Py=k1e;function D1e(e){return function(t){return t==null?void 0:t[e]}}var L1e=D1e,z1e=HD;function N1e(e){return function(t){return z1e(t,e)}}var j1e=N1e,F1e=L1e,B1e=j1e,$1e=jD,U1e=z2;function V1e(e){return $1e(e)?F1e(U1e(e)):B1e(e)}var G1e=V1e,H1e=a1e,W1e=R1e,q1e=Py,Z1e=ba,X1e=G1e;function K1e(e){return typeof e=="function"?e:e==null?q1e:typeof e=="object"?Z1e(e)?W1e(e[0],e[1]):H1e(e):X1e(e)}var nu=K1e;function Y1e(e,t,r,i){for(var c=e.length,d=r+(i?1:-1);i?d--:++d<c;)if(t(e[d],d,e))return d;return-1}var b9=Y1e;function J1e(e){return e!==e}var Q1e=J1e;function ebe(e,t,r){for(var i=r-1,c=e.length;++i<c;)if(e[i]===t)return i;return-1}var tbe=ebe,rbe=b9,nbe=Q1e,ibe=tbe;function obe(e,t,r){return t===t?ibe(e,t,r):rbe(e,nbe,r)}var sbe=obe,abe=sbe;function lbe(e,t){var r=e==null?0:e.length;return!!r&&abe(e,t,0)>-1}var cbe=lbe;function ube(e,t,r){for(var i=-1,c=e==null?0:e.length;++i<c;)if(r(t,e[i]))return!0;return!1}var hbe=ube;function dbe(){}var fbe=dbe,kI=g9,pbe=fbe,mbe=tL,gbe=1/0,_be=kI&&1/mbe(new kI([,-0]))[1]==gbe?function(e){return new kI(e)}:pbe,ybe=_be,vbe=s9,xbe=cbe,bbe=hbe,wbe=l9,Sbe=ybe,Tbe=tL,Ebe=200;function Abe(e,t,r){var i=-1,c=xbe,d=e.length,g=!0,o=[],w=o;if(r)g=!1,c=bbe;else if(d>=Ebe){var T=t?null:Sbe(e);if(T)return Tbe(T);g=!1,c=wbe,w=new vbe}else w=t?[]:o;e:for(;++i<d;){var I=e[i],C=t?t(I):I;if(I=r||I!==0?I:0,g&&C===C){for(var R=w.length;R--;)if(w[R]===C)continue e;t&&w.push(C),o.push(I)}else c(w,C,r)||(w!==o&&w.push(C),o.push(I))}return o}var Pbe=Abe,Cbe=nu,Ibe=Pbe;function Obe(e,t){return e&&e.length?Ibe(e,Cbe(t)):[]}var Mbe=Obe;const r5=Ii(Mbe);function w9(e,t,r){return t===!0?r5(e,r):An(t)?r5(e,t):e}function B_(e){"@babel/helpers - typeof";return B_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},B_(e)}var Rbe=["ref"];function n5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Mu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n5(Object(r),!0).forEach(function(i){J2(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function kbe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i5(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,T9(i.key),i)}}function Dbe(e,t,r){return t&&i5(e.prototype,t),r&&i5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lbe(e,t,r){return t=tE(t),zbe(e,S9()?Reflect.construct(t,r||[],tE(e).constructor):t.apply(e,r))}function zbe(e,t){if(t&&(B_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Nbe(e)}function Nbe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S9(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(S9=function(){return!!e})()}function tE(e){return tE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tE(e)}function jbe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BM(e,t)}function BM(e,t){return BM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},BM(e,t)}function J2(e,t,r){return t=T9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T9(e){var t=Fbe(e,"string");return B_(t)=="symbol"?t:t+""}function Fbe(e,t){if(B_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(B_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Bbe(e,t){if(e==null)return{};var r=$be(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function $be(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function Ube(e){return e.value}function Vbe(e,t){if(De.isValidElement(e))return De.cloneElement(e,t);if(typeof e=="function")return De.createElement(e,t);t.ref;var r=Bbe(t,Rbe);return De.createElement(eL,r)}var o5=1,p_=function(e){function t(){var r;kbe(this,t);for(var i=arguments.length,c=new Array(i),d=0;d<i;d++)c[d]=arguments[d];return r=Lbe(this,t,[].concat(c)),J2(r,"lastBoundingBox",{width:-1,height:-1}),r}return jbe(t,e),Dbe(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var i=this.wrapperNode.getBoundingClientRect();return i.height=this.wrapperNode.offsetHeight,i.width=this.wrapperNode.offsetWidth,i}return null}},{key:"updateBBox",value:function(){var i=this.props.onBBoxUpdate,c=this.getBBox();c?(Math.abs(c.width-this.lastBoundingBox.width)>o5||Math.abs(c.height-this.lastBoundingBox.height)>o5)&&(this.lastBoundingBox.width=c.width,this.lastBoundingBox.height=c.height,i&&i(c)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,i&&i(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?Mu({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(i){var c=this.props,d=c.layout,g=c.align,o=c.verticalAlign,w=c.margin,T=c.chartWidth,I=c.chartHeight,C,R;if(!i||(i.left===void 0||i.left===null)&&(i.right===void 0||i.right===null))if(g==="center"&&d==="vertical"){var F=this.getBBoxSnapshot();C={left:((T||0)-F.width)/2}}else C=g==="right"?{right:w&&w.right||0}:{left:w&&w.left||0};if(!i||(i.top===void 0||i.top===null)&&(i.bottom===void 0||i.bottom===null))if(o==="middle"){var G=this.getBBoxSnapshot();R={top:((I||0)-G.height)/2}}else R=o==="bottom"?{bottom:w&&w.bottom||0}:{top:w&&w.top||0};return Mu(Mu({},C),R)}},{key:"render",value:function(){var i=this,c=this.props,d=c.content,g=c.width,o=c.height,w=c.wrapperStyle,T=c.payloadUniqBy,I=c.payload,C=Mu(Mu({position:"absolute",width:g||"auto",height:o||"auto"},this.getDefaultPosition(w)),w);return De.createElement("div",{className:"recharts-legend-wrapper",style:C,ref:function(F){i.wrapperNode=F}},Vbe(d,Mu(Mu({},this.props),{},{payload:w9(I,T,Ube)})))}}],[{key:"getWithHeight",value:function(i,c){var d=Mu(Mu({},this.defaultProps),i.props),g=d.layout;return g==="vertical"&&gr(i.props.height)?{height:i.props.height}:g==="horizontal"?{width:i.props.width||c}:null}}])}(Q.PureComponent);J2(p_,"displayName","Legend");J2(p_,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var s5=H1,Gbe=rL,Hbe=ba,a5=s5?s5.isConcatSpreadable:void 0;function Wbe(e){return Hbe(e)||Gbe(e)||!!(a5&&e&&e[a5])}var qbe=Wbe,Zbe=u9,Xbe=qbe;function E9(e,t,r,i,c){var d=-1,g=e.length;for(r||(r=Xbe),c||(c=[]);++d<g;){var o=e[d];t>0&&r(o)?t>1?E9(o,t-1,r,i,c):Zbe(c,o):i||(c[c.length]=o)}return c}var A9=E9;function Kbe(e){return function(t,r,i){for(var c=-1,d=Object(t),g=i(t),o=g.length;o--;){var w=g[e?o:++c];if(r(d[w],w,d)===!1)break}return t}}var Ybe=Kbe,Jbe=Ybe,Qbe=Jbe(),ewe=Qbe,twe=ewe,rwe=Y2;function nwe(e,t){return e&&twe(e,t,rwe)}var P9=nwe,iwe=X1;function owe(e,t){return function(r,i){if(r==null)return r;if(!iwe(r))return e(r,i);for(var c=r.length,d=t?c:-1,g=Object(r);(t?d--:++d<c)&&i(g[d],d,g)!==!1;);return r}}var swe=owe,awe=P9,lwe=swe,cwe=lwe(awe),sL=cwe,uwe=sL,hwe=X1;function dwe(e,t){var r=-1,i=hwe(e)?Array(e.length):[];return uwe(e,function(c,d,g){i[++r]=t(c,d,g)}),i}var C9=dwe;function fwe(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var pwe=fwe,l5=xy;function mwe(e,t){if(e!==t){var r=e!==void 0,i=e===null,c=e===e,d=l5(e),g=t!==void 0,o=t===null,w=t===t,T=l5(t);if(!o&&!T&&!d&&e>t||d&&g&&w&&!o&&!T||i&&g&&w||!r&&w||!c)return 1;if(!i&&!d&&!T&&e<t||T&&r&&c&&!i&&!d||o&&r&&c||!g&&c||!w)return-1}return 0}var gwe=mwe,_we=gwe;function ywe(e,t,r){for(var i=-1,c=e.criteria,d=t.criteria,g=c.length,o=r.length;++i<g;){var w=_we(c[i],d[i]);if(w){if(i>=o)return w;var T=r[i];return w*(T=="desc"?-1:1)}}return e.index-t.index}var vwe=ywe,DI=GD,xwe=HD,bwe=nu,wwe=C9,Swe=pwe,Twe=f9,Ewe=vwe,Awe=Py,Pwe=ba;function Cwe(e,t,r){t.length?t=DI(t,function(d){return Pwe(d)?function(g){return xwe(g,d.length===1?d[0]:d)}:d}):t=[Awe];var i=-1;t=DI(t,Twe(bwe));var c=wwe(e,function(d,g,o){var w=DI(t,function(T){return T(d)});return{criteria:w,index:++i,value:d}});return Swe(c,function(d,g){return Ewe(d,g,r)})}var Iwe=Cwe;function Owe(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var Mwe=Owe,Rwe=Mwe,c5=Math.max;function kwe(e,t,r){return t=c5(t===void 0?e.length-1:t,0),function(){for(var i=arguments,c=-1,d=c5(i.length-t,0),g=Array(d);++c<d;)g[c]=i[t+c];c=-1;for(var o=Array(t+1);++c<t;)o[c]=i[c];return o[t]=r(g),Rwe(e,this,o)}}var Dwe=kwe;function Lwe(e){return function(){return e}}var zwe=Lwe,Nwe=lm,jwe=function(){try{var e=Nwe(Object,"defineProperty");return e({},"",{}),e}catch{}}(),I9=jwe,Fwe=zwe,u5=I9,Bwe=Py,$we=u5?function(e,t){return u5(e,"toString",{configurable:!0,enumerable:!1,value:Fwe(t),writable:!0})}:Bwe,Uwe=$we,Vwe=800,Gwe=16,Hwe=Date.now;function Wwe(e){var t=0,r=0;return function(){var i=Hwe(),c=Gwe-(i-r);if(r=i,c>0){if(++t>=Vwe)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var qwe=Wwe,Zwe=Uwe,Xwe=qwe,Kwe=Xwe(Zwe),Ywe=Kwe,Jwe=Py,Qwe=Dwe,eSe=Ywe;function tSe(e,t){return eSe(Qwe(e,t,Jwe),e+"")}var rSe=tSe,nSe=BD,iSe=X1,oSe=nL,sSe=Yd;function aSe(e,t,r){if(!sSe(r))return!1;var i=typeof t;return(i=="number"?iSe(r)&&oSe(t,r.length):i=="string"&&t in r)?nSe(r[t],e):!1}var Q2=aSe,lSe=A9,cSe=Iwe,uSe=rSe,h5=Q2,hSe=uSe(function(e,t){if(e==null)return[];var r=t.length;return r>1&&h5(e,t[0],t[1])?t=[]:r>2&&h5(t[0],t[1],t[2])&&(t=[t[0]]),cSe(e,lSe(t,1),[])}),dSe=hSe;const aL=Ii(dSe);function Zx(e){"@babel/helpers - typeof";return Zx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zx(e)}function $M(){return $M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},$M.apply(this,arguments)}function fSe(e,t){return _Se(e)||gSe(e,t)||mSe(e,t)||pSe()}function pSe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mSe(e,t){if(e){if(typeof e=="string")return d5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d5(e,t)}}function d5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function gSe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function _Se(e){if(Array.isArray(e))return e}function f5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function LI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?f5(Object(r),!0).forEach(function(i){ySe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ySe(e,t,r){return t=vSe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vSe(e){var t=xSe(e,"string");return Zx(t)=="symbol"?t:t+""}function xSe(e,t){if(Zx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Zx(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bSe(e){return Array.isArray(e)&&Wo(e[0])&&Wo(e[1])?e.join(" ~ "):e}var wSe=function(t){var r=t.separator,i=r===void 0?" : ":r,c=t.contentStyle,d=c===void 0?{}:c,g=t.itemStyle,o=g===void 0?{}:g,w=t.labelStyle,T=w===void 0?{}:w,I=t.payload,C=t.formatter,R=t.itemSorter,F=t.wrapperClassName,G=t.labelClassName,j=t.label,H=t.labelFormatter,X=t.accessibilityLayer,q=X===void 0?!1:X,Z=function(){if(I&&I.length){var Ke={padding:0,margin:0},dt=(R?aL(I,R):I).map(function($e,mt){if($e.type==="none")return null;var ct=LI({display:"block",paddingTop:4,paddingBottom:4,color:$e.color||"#000"},o),St=$e.formatter||C||bSe,Ue=$e.value,st=$e.name,bt=Ue,At=st;if(St&&bt!=null&&At!=null){var zt=St(Ue,st,$e,mt,I);if(Array.isArray(zt)){var or=fSe(zt,2);bt=or[0],At=or[1]}else bt=zt}return De.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(mt),style:ct},Wo(At)?De.createElement("span",{className:"recharts-tooltip-item-name"},At):null,Wo(At)?De.createElement("span",{className:"recharts-tooltip-item-separator"},i):null,De.createElement("span",{className:"recharts-tooltip-item-value"},bt),De.createElement("span",{className:"recharts-tooltip-item-unit"},$e.unit||""))});return De.createElement("ul",{className:"recharts-tooltip-item-list",style:Ke},dt)}return null},J=LI({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},d),ne=LI({margin:0},T),he=!ni(j),me=he?j:"",Se=Gn("recharts-default-tooltip",F),qe=Gn("recharts-tooltip-label",G);he&&H&&I!==void 0&&I!==null&&(me=H(j,I));var Ze=q?{role:"status","aria-live":"assertive"}:{};return De.createElement("div",$M({className:Se,style:J},Ze),De.createElement("p",{className:qe,style:ne},De.isValidElement(me)?me:"".concat(me)),Z())};function Xx(e){"@babel/helpers - typeof";return Xx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xx(e)}function RS(e,t,r){return t=SSe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SSe(e){var t=TSe(e,"string");return Xx(t)=="symbol"?t:t+""}function TSe(e,t){if(Xx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Xx(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var k0="recharts-tooltip-wrapper",ESe={visibility:"hidden"};function ASe(e){var t=e.coordinate,r=e.translateX,i=e.translateY;return Gn(k0,RS(RS(RS(RS({},"".concat(k0,"-right"),gr(r)&&t&&gr(t.x)&&r>=t.x),"".concat(k0,"-left"),gr(r)&&t&&gr(t.x)&&r<t.x),"".concat(k0,"-bottom"),gr(i)&&t&&gr(t.y)&&i>=t.y),"".concat(k0,"-top"),gr(i)&&t&&gr(t.y)&&i<t.y))}function p5(e){var t=e.allowEscapeViewBox,r=e.coordinate,i=e.key,c=e.offsetTopLeft,d=e.position,g=e.reverseDirection,o=e.tooltipDimension,w=e.viewBox,T=e.viewBoxDimension;if(d&&gr(d[i]))return d[i];var I=r[i]-o-c,C=r[i]+c;if(t[i])return g[i]?I:C;if(g[i]){var R=I,F=w[i];return R<F?Math.max(C,w[i]):Math.max(I,w[i])}var G=C+o,j=w[i]+T;return G>j?Math.max(I,w[i]):Math.max(C,w[i])}function PSe(e){var t=e.translateX,r=e.translateY,i=e.useTranslate3d;return{transform:i?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function CSe(e){var t=e.allowEscapeViewBox,r=e.coordinate,i=e.offsetTopLeft,c=e.position,d=e.reverseDirection,g=e.tooltipBox,o=e.useTranslate3d,w=e.viewBox,T,I,C;return g.height>0&&g.width>0&&r?(I=p5({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:i,position:c,reverseDirection:d,tooltipDimension:g.width,viewBox:w,viewBoxDimension:w.width}),C=p5({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:i,position:c,reverseDirection:d,tooltipDimension:g.height,viewBox:w,viewBoxDimension:w.height}),T=PSe({translateX:I,translateY:C,useTranslate3d:o})):T=ESe,{cssProperties:T,cssClasses:ASe({translateX:I,translateY:C,coordinate:r})}}function $_(e){"@babel/helpers - typeof";return $_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$_(e)}function m5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function g5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m5(Object(r),!0).forEach(function(i){VM(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ISe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OSe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,M9(i.key),i)}}function MSe(e,t,r){return t&&OSe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function RSe(e,t,r){return t=rE(t),kSe(e,O9()?Reflect.construct(t,r||[],rE(e).constructor):t.apply(e,r))}function kSe(e,t){if(t&&($_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DSe(e)}function DSe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O9(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(O9=function(){return!!e})()}function rE(e){return rE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},rE(e)}function LSe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&UM(e,t)}function UM(e,t){return UM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},UM(e,t)}function VM(e,t,r){return t=M9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function M9(e){var t=zSe(e,"string");return $_(t)=="symbol"?t:t+""}function zSe(e,t){if($_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if($_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var _5=1,NSe=function(e){function t(){var r;ISe(this,t);for(var i=arguments.length,c=new Array(i),d=0;d<i;d++)c[d]=arguments[d];return r=RSe(this,t,[].concat(c)),VM(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),VM(r,"handleKeyDown",function(g){if(g.key==="Escape"){var o,w,T,I;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(o=(w=r.props.coordinate)===null||w===void 0?void 0:w.x)!==null&&o!==void 0?o:0,y:(T=(I=r.props.coordinate)===null||I===void 0?void 0:I.y)!==null&&T!==void 0?T:0}})}}),r}return LSe(t,e),MSe(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var i=this.wrapperNode.getBoundingClientRect();(Math.abs(i.width-this.state.lastBoundingBox.width)>_5||Math.abs(i.height-this.state.lastBoundingBox.height)>_5)&&this.setState({lastBoundingBox:{width:i.width,height:i.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var i,c;this.props.active&&this.updateBBox(),this.state.dismissed&&(((i=this.props.coordinate)===null||i===void 0?void 0:i.x)!==this.state.dismissedAtCoordinate.x||((c=this.props.coordinate)===null||c===void 0?void 0:c.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var i=this,c=this.props,d=c.active,g=c.allowEscapeViewBox,o=c.animationDuration,w=c.animationEasing,T=c.children,I=c.coordinate,C=c.hasPayload,R=c.isAnimationActive,F=c.offset,G=c.position,j=c.reverseDirection,H=c.useTranslate3d,X=c.viewBox,q=c.wrapperStyle,Z=CSe({allowEscapeViewBox:g,coordinate:I,offsetTopLeft:F,position:G,reverseDirection:j,tooltipBox:this.state.lastBoundingBox,useTranslate3d:H,viewBox:X}),J=Z.cssClasses,ne=Z.cssProperties,he=g5(g5({transition:R&&d?"transform ".concat(o,"ms ").concat(w):void 0},ne),{},{pointerEvents:"none",visibility:!this.state.dismissed&&d&&C?"visible":"hidden",position:"absolute",top:0,left:0},q);return De.createElement("div",{tabIndex:-1,className:J,style:he,ref:function(Se){i.wrapperNode=Se}},T)}}])}(Q.PureComponent),jSe=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Hu={isSsr:jSe(),get:function(t){return Hu[t]},set:function(t,r){if(typeof t=="string")Hu[t]=r;else{var i=Object.keys(t);i&&i.length&&i.forEach(function(c){Hu[c]=t[c]})}}};function U_(e){"@babel/helpers - typeof";return U_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U_(e)}function y5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function v5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y5(Object(r),!0).forEach(function(i){lL(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function FSe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BSe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,k9(i.key),i)}}function $Se(e,t,r){return t&&BSe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function USe(e,t,r){return t=nE(t),VSe(e,R9()?Reflect.construct(t,r||[],nE(e).constructor):t.apply(e,r))}function VSe(e,t){if(t&&(U_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return GSe(e)}function GSe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R9(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(R9=function(){return!!e})()}function nE(e){return nE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},nE(e)}function HSe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GM(e,t)}function GM(e,t){return GM=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},GM(e,t)}function lL(e,t,r){return t=k9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function k9(e){var t=WSe(e,"string");return U_(t)=="symbol"?t:t+""}function WSe(e,t){if(U_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(U_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function qSe(e){return e.dataKey}function ZSe(e,t){return De.isValidElement(e)?De.cloneElement(e,t):typeof e=="function"?De.createElement(e,t):De.createElement(wSe,t)}var ec=function(e){function t(){return FSe(this,t),USe(this,t,arguments)}return HSe(t,e),$Se(t,[{key:"render",value:function(){var i=this,c=this.props,d=c.active,g=c.allowEscapeViewBox,o=c.animationDuration,w=c.animationEasing,T=c.content,I=c.coordinate,C=c.filterNull,R=c.isAnimationActive,F=c.offset,G=c.payload,j=c.payloadUniqBy,H=c.position,X=c.reverseDirection,q=c.useTranslate3d,Z=c.viewBox,J=c.wrapperStyle,ne=G??[];C&&ne.length&&(ne=w9(G.filter(function(me){return me.value!=null&&(me.hide!==!0||i.props.includeHidden)}),j,qSe));var he=ne.length>0;return De.createElement(NSe,{allowEscapeViewBox:g,animationDuration:o,animationEasing:w,isAnimationActive:R,active:d,coordinate:I,hasPayload:he,offset:F,position:H,reverseDirection:X,useTranslate3d:q,viewBox:Z,wrapperStyle:J},ZSe(T,v5(v5({},this.props),{},{payload:ne})))}}])}(Q.PureComponent);lL(ec,"displayName","Tooltip");lL(ec,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Hu.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var XSe=ru,KSe=function(){return XSe.Date.now()},YSe=KSe,JSe=/\s/;function QSe(e){for(var t=e.length;t--&&JSe.test(e.charAt(t)););return t}var eTe=QSe,tTe=eTe,rTe=/^\s+/;function nTe(e){return e&&e.slice(0,tTe(e)+1).replace(rTe,"")}var iTe=nTe,oTe=iTe,x5=Yd,sTe=xy,b5=NaN,aTe=/^[-+]0x[0-9a-f]+$/i,lTe=/^0b[01]+$/i,cTe=/^0o[0-7]+$/i,uTe=parseInt;function hTe(e){if(typeof e=="number")return e;if(sTe(e))return b5;if(x5(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=x5(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=oTe(e);var r=lTe.test(e);return r||cTe.test(e)?uTe(e.slice(2),r?2:8):aTe.test(e)?b5:+e}var D9=hTe,dTe=Yd,zI=YSe,w5=D9,fTe="Expected a function",pTe=Math.max,mTe=Math.min;function gTe(e,t,r){var i,c,d,g,o,w,T=0,I=!1,C=!1,R=!0;if(typeof e!="function")throw new TypeError(fTe);t=w5(t)||0,dTe(r)&&(I=!!r.leading,C="maxWait"in r,d=C?pTe(w5(r.maxWait)||0,t):d,R="trailing"in r?!!r.trailing:R);function F(he){var me=i,Se=c;return i=c=void 0,T=he,g=e.apply(Se,me),g}function G(he){return T=he,o=setTimeout(X,t),I?F(he):g}function j(he){var me=he-w,Se=he-T,qe=t-me;return C?mTe(qe,d-Se):qe}function H(he){var me=he-w,Se=he-T;return w===void 0||me>=t||me<0||C&&Se>=d}function X(){var he=zI();if(H(he))return q(he);o=setTimeout(X,j(he))}function q(he){return o=void 0,R&&i?F(he):(i=c=void 0,g)}function Z(){o!==void 0&&clearTimeout(o),T=0,i=w=c=o=void 0}function J(){return o===void 0?g:q(zI())}function ne(){var he=zI(),me=H(he);if(i=arguments,c=this,w=he,me){if(o===void 0)return G(w);if(C)return clearTimeout(o),o=setTimeout(X,t),F(w)}return o===void 0&&(o=setTimeout(X,t)),g}return ne.cancel=Z,ne.flush=J,ne}var _Te=gTe,yTe=_Te,vTe=Yd,xTe="Expected a function";function bTe(e,t,r){var i=!0,c=!0;if(typeof e!="function")throw new TypeError(xTe);return vTe(r)&&(i="leading"in r?!!r.leading:i,c="trailing"in r?!!r.trailing:c),yTe(e,t,{leading:i,maxWait:t,trailing:c})}var wTe=bTe;const L9=Ii(wTe);function Kx(e){"@babel/helpers - typeof";return Kx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kx(e)}function S5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function kS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S5(Object(r),!0).forEach(function(i){STe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function STe(e,t,r){return t=TTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TTe(e){var t=ETe(e,"string");return Kx(t)=="symbol"?t:t+""}function ETe(e,t){if(Kx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Kx(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ATe(e,t){return OTe(e)||ITe(e,t)||CTe(e,t)||PTe()}function PTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CTe(e,t){if(e){if(typeof e=="string")return T5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return T5(e,t)}}function T5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function ITe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function OTe(e){if(Array.isArray(e))return e}var E5=Q.forwardRef(function(e,t){var r=e.aspect,i=e.initialDimension,c=i===void 0?{width:-1,height:-1}:i,d=e.width,g=d===void 0?"100%":d,o=e.height,w=o===void 0?"100%":o,T=e.minWidth,I=T===void 0?0:T,C=e.minHeight,R=e.maxHeight,F=e.children,G=e.debounce,j=G===void 0?0:G,H=e.id,X=e.className,q=e.onResize,Z=e.style,J=Z===void 0?{}:Z,ne=Q.useRef(null),he=Q.useRef();he.current=q,Q.useImperativeHandle(t,function(){return Object.defineProperty(ne.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),ne.current},configurable:!0})});var me=Q.useState({containerWidth:c.width,containerHeight:c.height}),Se=ATe(me,2),qe=Se[0],Ze=Se[1],He=Q.useCallback(function(dt,$e){Ze(function(mt){var ct=Math.round(dt),St=Math.round($e);return mt.containerWidth===ct&&mt.containerHeight===St?mt:{containerWidth:ct,containerHeight:St}})},[]);Q.useEffect(function(){var dt=function(st){var bt,At=st[0].contentRect,zt=At.width,or=At.height;He(zt,or),(bt=he.current)===null||bt===void 0||bt.call(he,zt,or)};j>0&&(dt=L9(dt,j,{trailing:!0,leading:!1}));var $e=new ResizeObserver(dt),mt=ne.current.getBoundingClientRect(),ct=mt.width,St=mt.height;return He(ct,St),$e.observe(ne.current),function(){$e.disconnect()}},[He,j]);var Ke=Q.useMemo(function(){var dt=qe.containerWidth,$e=qe.containerHeight;if(dt<0||$e<0)return null;sc(Ep(g)||Ep(w),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,g,w),sc(!r||r>0,"The aspect(%s) must be greater than zero.",r);var mt=Ep(g)?dt:g,ct=Ep(w)?$e:w;r&&r>0&&(mt?ct=mt/r:ct&&(mt=ct*r),R&&ct>R&&(ct=R)),sc(mt>0||ct>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,mt,ct,g,w,I,C,r);var St=!Array.isArray(F)&&Gu(F.type).endsWith("Chart");return De.Children.map(F,function(Ue){return Mq.isElement(Ue)?Q.cloneElement(Ue,kS({width:mt,height:ct},St?{style:kS({height:"100%",width:"100%",maxHeight:ct,maxWidth:mt},Ue.props.style)}:{})):Ue})},[r,F,w,R,C,I,qe,g]);return De.createElement("div",{id:H?"".concat(H):void 0,className:Gn("recharts-responsive-container",X),style:kS(kS({},J),{},{width:g,height:w,minWidth:I,minHeight:C,maxHeight:R}),ref:ne},Ke)}),eA=function(t){return null};eA.displayName="Cell";function Yx(e){"@babel/helpers - typeof";return Yx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yx(e)}function A5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function HM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A5(Object(r),!0).forEach(function(i){MTe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A5(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function MTe(e,t,r){return t=RTe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RTe(e){var t=kTe(e,"string");return Yx(t)=="symbol"?t:t+""}function kTe(e,t){if(Yx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Yx(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var jg={widthCache:{},cacheCount:0},DTe=2e3,LTe={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},P5="recharts_measurement_span";function zTe(e){var t=HM({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var fx=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Hu.isSsr)return{width:0,height:0};var i=zTe(r),c=JSON.stringify({text:t,copyStyle:i});if(jg.widthCache[c])return jg.widthCache[c];try{var d=document.getElementById(P5);d||(d=document.createElement("span"),d.setAttribute("id",P5),d.setAttribute("aria-hidden","true"),document.body.appendChild(d));var g=HM(HM({},LTe),i);Object.assign(d.style,g),d.textContent="".concat(t);var o=d.getBoundingClientRect(),w={width:o.width,height:o.height};return jg.widthCache[c]=w,++jg.cacheCount>DTe&&(jg.cacheCount=0,jg.widthCache={}),w}catch{return{width:0,height:0}}},NTe=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Jx(e){"@babel/helpers - typeof";return Jx=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jx(e)}function iE(e,t){return $Te(e)||BTe(e,t)||FTe(e,t)||jTe()}function jTe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FTe(e,t){if(e){if(typeof e=="string")return C5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return C5(e,t)}}function C5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function BTe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;w=!1}else for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function $Te(e){if(Array.isArray(e))return e}function UTe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I5(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,GTe(i.key),i)}}function VTe(e,t,r){return t&&I5(e.prototype,t),r&&I5(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function GTe(e){var t=HTe(e,"string");return Jx(t)=="symbol"?t:t+""}function HTe(e,t){if(Jx(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(Jx(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var O5=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,M5=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,WTe=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,qTe=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,z9={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},ZTe=Object.keys(z9),e_="NaN";function XTe(e,t){return e*z9[t]}var DS=function(){function e(t,r){UTe(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!WTe.test(r)&&(this.num=NaN,this.unit=""),ZTe.includes(r)&&(this.num=XTe(t,r),this.unit="px")}return VTe(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var i,c=(i=qTe.exec(r))!==null&&i!==void 0?i:[],d=iE(c,3),g=d[1],o=d[2];return new e(parseFloat(g),o??"")}}])}();function N9(e){if(e.includes(e_))return e_;for(var t=e;t.includes("*")||t.includes("/");){var r,i=(r=O5.exec(t))!==null&&r!==void 0?r:[],c=iE(i,4),d=c[1],g=c[2],o=c[3],w=DS.parse(d??""),T=DS.parse(o??""),I=g==="*"?w.multiply(T):w.divide(T);if(I.isNaN())return e_;t=t.replace(O5,I.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var C,R=(C=M5.exec(t))!==null&&C!==void 0?C:[],F=iE(R,4),G=F[1],j=F[2],H=F[3],X=DS.parse(G??""),q=DS.parse(H??""),Z=j==="+"?X.add(q):X.subtract(q);if(Z.isNaN())return e_;t=t.replace(M5,Z.toString())}return t}var R5=/\(([^()]*)\)/;function KTe(e){for(var t=e;t.includes("(");){var r=R5.exec(t),i=iE(r,2),c=i[1];t=t.replace(R5,N9(c))}return t}function YTe(e){var t=e.replace(/\s+/g,"");return t=KTe(t),t=N9(t),t}function JTe(e){try{return YTe(e)}catch{return e_}}function NI(e){var t=JTe(e.slice(5,-1));return t===e_?"":t}var QTe=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],eEe=["dx","dy","angle","className","breakAll"];function WM(){return WM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},WM.apply(this,arguments)}function k5(e,t){if(e==null)return{};var r=tEe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function tEe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function D5(e,t){return oEe(e)||iEe(e,t)||nEe(e,t)||rEe()}function rEe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nEe(e,t){if(e){if(typeof e=="string")return L5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L5(e,t)}}function L5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function iEe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;w=!1}else for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function oEe(e){if(Array.isArray(e))return e}var j9=/[ \f\n\r\t\v\u2028\u2029]+/,F9=function(t){var r=t.children,i=t.breakAll,c=t.style;try{var d=[];ni(r)||(i?d=r.toString().split(""):d=r.toString().split(j9));var g=d.map(function(w){return{word:w,width:fx(w,c).width}}),o=i?0:fx("",c).width;return{wordsWithComputedWidth:g,spaceWidth:o}}catch{return null}},sEe=function(t,r,i,c,d){var g=t.maxLines,o=t.children,w=t.style,T=t.breakAll,I=gr(g),C=o,R=function(){var mt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return mt.reduce(function(ct,St){var Ue=St.word,st=St.width,bt=ct[ct.length-1];if(bt&&(c==null||d||bt.width+st+i<Number(c)))bt.words.push(Ue),bt.width+=st+i;else{var At={words:[Ue],width:st};ct.push(At)}return ct},[])},F=R(r),G=function(mt){return mt.reduce(function(ct,St){return ct.width>St.width?ct:St})};if(!I)return F;for(var j="",H=function(mt){var ct=C.slice(0,mt),St=F9({breakAll:T,style:w,children:ct+j}).wordsWithComputedWidth,Ue=R(St),st=Ue.length>g||G(Ue).width>Number(c);return[st,Ue]},X=0,q=C.length-1,Z=0,J;X<=q&&Z<=C.length-1;){var ne=Math.floor((X+q)/2),he=ne-1,me=H(he),Se=D5(me,2),qe=Se[0],Ze=Se[1],He=H(ne),Ke=D5(He,1),dt=Ke[0];if(!qe&&!dt&&(X=ne+1),qe&&dt&&(q=ne-1),!qe&&dt){J=Ze;break}Z++}return J||F},z5=function(t){var r=ni(t)?[]:t.toString().split(j9);return[{words:r}]},aEe=function(t){var r=t.width,i=t.scaleToFit,c=t.children,d=t.style,g=t.breakAll,o=t.maxLines;if((r||i)&&!Hu.isSsr){var w,T,I=F9({breakAll:g,children:c,style:d});if(I){var C=I.wordsWithComputedWidth,R=I.spaceWidth;w=C,T=R}else return z5(c);return sEe({breakAll:g,children:c,maxLines:o,style:d},w,T,r,i)}return z5(c)},N5="#808080",Xp=function(t){var r=t.x,i=r===void 0?0:r,c=t.y,d=c===void 0?0:c,g=t.lineHeight,o=g===void 0?"1em":g,w=t.capHeight,T=w===void 0?"0.71em":w,I=t.scaleToFit,C=I===void 0?!1:I,R=t.textAnchor,F=R===void 0?"start":R,G=t.verticalAnchor,j=G===void 0?"end":G,H=t.fill,X=H===void 0?N5:H,q=k5(t,QTe),Z=Q.useMemo(function(){return aEe({breakAll:q.breakAll,children:q.children,maxLines:q.maxLines,scaleToFit:C,style:q.style,width:q.width})},[q.breakAll,q.children,q.maxLines,C,q.style,q.width]),J=q.dx,ne=q.dy,he=q.angle,me=q.className,Se=q.breakAll,qe=k5(q,eEe);if(!Wo(i)||!Wo(d))return null;var Ze=i+(gr(J)?J:0),He=d+(gr(ne)?ne:0),Ke;switch(j){case"start":Ke=NI("calc(".concat(T,")"));break;case"middle":Ke=NI("calc(".concat((Z.length-1)/2," * -").concat(o," + (").concat(T," / 2))"));break;default:Ke=NI("calc(".concat(Z.length-1," * -").concat(o,")"));break}var dt=[];if(C){var $e=Z[0].width,mt=q.width;dt.push("scale(".concat((gr(mt)?mt/$e:1)/$e,")"))}return he&&dt.push("rotate(".concat(he,", ").concat(Ze,", ").concat(He,")")),dt.length&&(qe.transform=dt.join(" ")),De.createElement("text",WM({},hn(qe,!0),{x:Ze,y:He,className:Gn("recharts-text",me),textAnchor:F,fill:X.includes("url")?N5:X}),Z.map(function(ct,St){var Ue=ct.words.join(Se?"":" ");return De.createElement("tspan",{x:Ze,dy:St===0?Ke:o,key:"".concat(Ue,"-").concat(St)},Ue)}))};function kd(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lEe(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function cL(e){let t,r,i;e.length!==2?(t=kd,r=(o,w)=>kd(e(o),w),i=(o,w)=>e(o)-w):(t=e===kd||e===lEe?e:cEe,r=e,i=e);function c(o,w,T=0,I=o.length){if(T<I){if(t(w,w)!==0)return I;do{const C=T+I>>>1;r(o[C],w)<0?T=C+1:I=C}while(T<I)}return T}function d(o,w,T=0,I=o.length){if(T<I){if(t(w,w)!==0)return I;do{const C=T+I>>>1;r(o[C],w)<=0?T=C+1:I=C}while(T<I)}return T}function g(o,w,T=0,I=o.length){const C=c(o,w,T,I-1);return C>T&&i(o[C-1],w)>-i(o[C],w)?C-1:C}return{left:c,center:g,right:d}}function cEe(){return 0}function B9(e){return e===null?NaN:+e}function*uEe(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const hEe=cL(kd),K1=hEe.right;cL(B9).center;class j5 extends Map{constructor(t,r=pEe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[i,c]of t)this.set(i,c)}get(t){return super.get(F5(this,t))}has(t){return super.has(F5(this,t))}set(t,r){return super.set(dEe(this,t),r)}delete(t){return super.delete(fEe(this,t))}}function F5({_intern:e,_key:t},r){const i=t(r);return e.has(i)?e.get(i):r}function dEe({_intern:e,_key:t},r){const i=t(r);return e.has(i)?e.get(i):(e.set(i,r),r)}function fEe({_intern:e,_key:t},r){const i=t(r);return e.has(i)&&(r=e.get(i),e.delete(i)),r}function pEe(e){return e!==null&&typeof e=="object"?e.valueOf():e}function mEe(e=kd){if(e===kd)return $9;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const i=e(t,r);return i||i===0?i:(e(r,r)===0)-(e(t,t)===0)}}function $9(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const gEe=Math.sqrt(50),_Ee=Math.sqrt(10),yEe=Math.sqrt(2);function oE(e,t,r){const i=(t-e)/Math.max(0,r),c=Math.floor(Math.log10(i)),d=i/Math.pow(10,c),g=d>=gEe?10:d>=_Ee?5:d>=yEe?2:1;let o,w,T;return c<0?(T=Math.pow(10,-c)/g,o=Math.round(e*T),w=Math.round(t*T),o/T<e&&++o,w/T>t&&--w,T=-T):(T=Math.pow(10,c)*g,o=Math.round(e/T),w=Math.round(t/T),o*T<e&&++o,w*T>t&&--w),w<o&&.5<=r&&r<2?oE(e,t,r*2):[o,w,T]}function qM(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const i=t<e,[c,d,g]=i?oE(t,e,r):oE(e,t,r);if(!(d>=c))return[];const o=d-c+1,w=new Array(o);if(i)if(g<0)for(let T=0;T<o;++T)w[T]=(d-T)/-g;else for(let T=0;T<o;++T)w[T]=(d-T)*g;else if(g<0)for(let T=0;T<o;++T)w[T]=(c+T)/-g;else for(let T=0;T<o;++T)w[T]=(c+T)*g;return w}function ZM(e,t,r){return t=+t,e=+e,r=+r,oE(e,t,r)[2]}function XM(e,t,r){t=+t,e=+e,r=+r;const i=t<e,c=i?ZM(t,e,r):ZM(e,t,r);return(i?-1:1)*(c<0?1/-c:c)}function B5(e,t){let r;for(const i of e)i!=null&&(r<i||r===void 0&&i>=i)&&(r=i);return r}function $5(e,t){let r;for(const i of e)i!=null&&(r>i||r===void 0&&i>=i)&&(r=i);return r}function U9(e,t,r=0,i=1/0,c){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),i=Math.floor(Math.min(e.length-1,i)),!(r<=t&&t<=i))return e;for(c=c===void 0?$9:mEe(c);i>r;){if(i-r>600){const w=i-r+1,T=t-r+1,I=Math.log(w),C=.5*Math.exp(2*I/3),R=.5*Math.sqrt(I*C*(w-C)/w)*(T-w/2<0?-1:1),F=Math.max(r,Math.floor(t-T*C/w+R)),G=Math.min(i,Math.floor(t+(w-T)*C/w+R));U9(e,t,F,G,c)}const d=e[t];let g=r,o=i;for(D0(e,r,t),c(e[i],d)>0&&D0(e,r,i);g<o;){for(D0(e,g,o),++g,--o;c(e[g],d)<0;)++g;for(;c(e[o],d)>0;)--o}c(e[r],d)===0?D0(e,r,o):(++o,D0(e,o,i)),o<=t&&(r=o+1),t<=o&&(i=o-1)}return e}function D0(e,t,r){const i=e[t];e[t]=e[r],e[r]=i}function vEe(e,t,r){if(e=Float64Array.from(uEe(e)),!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return $5(e);if(t>=1)return B5(e);var i,c=(i-1)*t,d=Math.floor(c),g=B5(U9(e,d).subarray(0,d+1)),o=$5(e.subarray(d+1));return g+(o-g)*(c-d)}}function xEe(e,t,r=B9){if(!(!(i=e.length)||isNaN(t=+t))){if(t<=0||i<2)return+r(e[0],0,e);if(t>=1)return+r(e[i-1],i-1,e);var i,c=(i-1)*t,d=Math.floor(c),g=+r(e[d],d,e),o=+r(e[d+1],d+1,e);return g+(o-g)*(c-d)}}function bEe(e,t,r){e=+e,t=+t,r=(c=arguments.length)<2?(t=e,e=0,1):c<3?1:+r;for(var i=-1,c=Math.max(0,Math.ceil((t-e)/r))|0,d=new Array(c);++i<c;)d[i]=e+i*r;return d}function xl(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function sh(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const KM=Symbol("implicit");function uL(){var e=new j5,t=[],r=[],i=KM;function c(d){let g=e.get(d);if(g===void 0){if(i!==KM)return i;e.set(d,g=t.push(d)-1)}return r[g%r.length]}return c.domain=function(d){if(!arguments.length)return t.slice();t=[],e=new j5;for(const g of d)e.has(g)||e.set(g,t.push(g)-1);return c},c.range=function(d){return arguments.length?(r=Array.from(d),c):r.slice()},c.unknown=function(d){return arguments.length?(i=d,c):i},c.copy=function(){return uL(t,r).unknown(i)},xl.apply(c,arguments),c}function Qx(){var e=uL().unknown(void 0),t=e.domain,r=e.range,i=0,c=1,d,g,o=!1,w=0,T=0,I=.5;delete e.unknown;function C(){var R=t().length,F=c<i,G=F?c:i,j=F?i:c;d=(j-G)/Math.max(1,R-w+T*2),o&&(d=Math.floor(d)),G+=(j-G-d*(R-w))*I,g=d*(1-w),o&&(G=Math.round(G),g=Math.round(g));var H=bEe(R).map(function(X){return G+d*X});return r(F?H.reverse():H)}return e.domain=function(R){return arguments.length?(t(R),C()):t()},e.range=function(R){return arguments.length?([i,c]=R,i=+i,c=+c,C()):[i,c]},e.rangeRound=function(R){return[i,c]=R,i=+i,c=+c,o=!0,C()},e.bandwidth=function(){return g},e.step=function(){return d},e.round=function(R){return arguments.length?(o=!!R,C()):o},e.padding=function(R){return arguments.length?(w=Math.min(1,T=+R),C()):w},e.paddingInner=function(R){return arguments.length?(w=Math.min(1,R),C()):w},e.paddingOuter=function(R){return arguments.length?(T=+R,C()):T},e.align=function(R){return arguments.length?(I=Math.max(0,Math.min(1,R)),C()):I},e.copy=function(){return Qx(t(),[i,c]).round(o).paddingInner(w).paddingOuter(T).align(I)},xl.apply(C(),arguments)}function V9(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return V9(t())},e}function px(){return V9(Qx.apply(null,arguments).paddingInner(1))}function hL(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function G9(e,t){var r=Object.create(e.prototype);for(var i in t)r[i]=t[i];return r}function Y1(){}var e1=.7,sE=1/e1,m_="\\s*([+-]?\\d+)\\s*",t1="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Yc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",wEe=/^#([0-9a-f]{3,8})$/,SEe=new RegExp(`^rgb\\(${m_},${m_},${m_}\\)$`),TEe=new RegExp(`^rgb\\(${Yc},${Yc},${Yc}\\)$`),EEe=new RegExp(`^rgba\\(${m_},${m_},${m_},${t1}\\)$`),AEe=new RegExp(`^rgba\\(${Yc},${Yc},${Yc},${t1}\\)$`),PEe=new RegExp(`^hsl\\(${t1},${Yc},${Yc}\\)$`),CEe=new RegExp(`^hsla\\(${t1},${Yc},${Yc},${t1}\\)$`),U5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};hL(Y1,r1,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:V5,formatHex:V5,formatHex8:IEe,formatHsl:OEe,formatRgb:G5,toString:G5});function V5(){return this.rgb().formatHex()}function IEe(){return this.rgb().formatHex8()}function OEe(){return H9(this).formatHsl()}function G5(){return this.rgb().formatRgb()}function r1(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=wEe.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?H5(t):r===3?new ga(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?LS(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?LS(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=SEe.exec(e))?new ga(t[1],t[2],t[3],1):(t=TEe.exec(e))?new ga(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=EEe.exec(e))?LS(t[1],t[2],t[3],t[4]):(t=AEe.exec(e))?LS(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=PEe.exec(e))?Z5(t[1],t[2]/100,t[3]/100,1):(t=CEe.exec(e))?Z5(t[1],t[2]/100,t[3]/100,t[4]):U5.hasOwnProperty(e)?H5(U5[e]):e==="transparent"?new ga(NaN,NaN,NaN,0):null}function H5(e){return new ga(e>>16&255,e>>8&255,e&255,1)}function LS(e,t,r,i){return i<=0&&(e=t=r=NaN),new ga(e,t,r,i)}function MEe(e){return e instanceof Y1||(e=r1(e)),e?(e=e.rgb(),new ga(e.r,e.g,e.b,e.opacity)):new ga}function YM(e,t,r,i){return arguments.length===1?MEe(e):new ga(e,t,r,i??1)}function ga(e,t,r,i){this.r=+e,this.g=+t,this.b=+r,this.opacity=+i}hL(ga,YM,G9(Y1,{brighter(e){return e=e==null?sE:Math.pow(sE,e),new ga(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?e1:Math.pow(e1,e),new ga(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ga(Lp(this.r),Lp(this.g),Lp(this.b),aE(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:W5,formatHex:W5,formatHex8:REe,formatRgb:q5,toString:q5}));function W5(){return`#${Ap(this.r)}${Ap(this.g)}${Ap(this.b)}`}function REe(){return`#${Ap(this.r)}${Ap(this.g)}${Ap(this.b)}${Ap((isNaN(this.opacity)?1:this.opacity)*255)}`}function q5(){const e=aE(this.opacity);return`${e===1?"rgb(":"rgba("}${Lp(this.r)}, ${Lp(this.g)}, ${Lp(this.b)}${e===1?")":`, ${e})`}`}function aE(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Lp(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ap(e){return e=Lp(e),(e<16?"0":"")+e.toString(16)}function Z5(e,t,r,i){return i<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new nc(e,t,r,i)}function H9(e){if(e instanceof nc)return new nc(e.h,e.s,e.l,e.opacity);if(e instanceof Y1||(e=r1(e)),!e)return new nc;if(e instanceof nc)return e;e=e.rgb();var t=e.r/255,r=e.g/255,i=e.b/255,c=Math.min(t,r,i),d=Math.max(t,r,i),g=NaN,o=d-c,w=(d+c)/2;return o?(t===d?g=(r-i)/o+(r<i)*6:r===d?g=(i-t)/o+2:g=(t-r)/o+4,o/=w<.5?d+c:2-d-c,g*=60):o=w>0&&w<1?0:g,new nc(g,o,w,e.opacity)}function kEe(e,t,r,i){return arguments.length===1?H9(e):new nc(e,t,r,i??1)}function nc(e,t,r,i){this.h=+e,this.s=+t,this.l=+r,this.opacity=+i}hL(nc,kEe,G9(Y1,{brighter(e){return e=e==null?sE:Math.pow(sE,e),new nc(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?e1:Math.pow(e1,e),new nc(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*t,c=2*r-i;return new ga(jI(e>=240?e-240:e+120,c,i),jI(e,c,i),jI(e<120?e+240:e-120,c,i),this.opacity)},clamp(){return new nc(X5(this.h),zS(this.s),zS(this.l),aE(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=aE(this.opacity);return`${e===1?"hsl(":"hsla("}${X5(this.h)}, ${zS(this.s)*100}%, ${zS(this.l)*100}%${e===1?")":`, ${e})`}`}}));function X5(e){return e=(e||0)%360,e<0?e+360:e}function zS(e){return Math.max(0,Math.min(1,e||0))}function jI(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const dL=e=>()=>e;function DEe(e,t){return function(r){return e+r*t}}function LEe(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(i){return Math.pow(e+i*t,r)}}function zEe(e){return(e=+e)==1?W9:function(t,r){return r-t?LEe(t,r,e):dL(isNaN(t)?r:t)}}function W9(e,t){var r=t-e;return r?DEe(e,r):dL(isNaN(e)?t:e)}const K5=function e(t){var r=zEe(t);function i(c,d){var g=r((c=YM(c)).r,(d=YM(d)).r),o=r(c.g,d.g),w=r(c.b,d.b),T=W9(c.opacity,d.opacity);return function(I){return c.r=g(I),c.g=o(I),c.b=w(I),c.opacity=T(I),c+""}}return i.gamma=e,i}(1);function NEe(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,i=t.slice(),c;return function(d){for(c=0;c<r;++c)i[c]=e[c]*(1-d)+t[c]*d;return i}}function jEe(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function FEe(e,t){var r=t?t.length:0,i=e?Math.min(r,e.length):0,c=new Array(i),d=new Array(r),g;for(g=0;g<i;++g)c[g]=Cy(e[g],t[g]);for(;g<r;++g)d[g]=t[g];return function(o){for(g=0;g<i;++g)d[g]=c[g](o);return d}}function BEe(e,t){var r=new Date;return e=+e,t=+t,function(i){return r.setTime(e*(1-i)+t*i),r}}function lE(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function $Ee(e,t){var r={},i={},c;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(c in t)c in e?r[c]=Cy(e[c],t[c]):i[c]=t[c];return function(d){for(c in r)i[c]=r[c](d);return i}}var JM=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,FI=new RegExp(JM.source,"g");function UEe(e){return function(){return e}}function VEe(e){return function(t){return e(t)+""}}function GEe(e,t){var r=JM.lastIndex=FI.lastIndex=0,i,c,d,g=-1,o=[],w=[];for(e=e+"",t=t+"";(i=JM.exec(e))&&(c=FI.exec(t));)(d=c.index)>r&&(d=t.slice(r,d),o[g]?o[g]+=d:o[++g]=d),(i=i[0])===(c=c[0])?o[g]?o[g]+=c:o[++g]=c:(o[++g]=null,w.push({i:g,x:lE(i,c)})),r=FI.lastIndex;return r<t.length&&(d=t.slice(r),o[g]?o[g]+=d:o[++g]=d),o.length<2?w[0]?VEe(w[0].x):UEe(t):(t=w.length,function(T){for(var I=0,C;I<t;++I)o[(C=w[I]).i]=C.x(T);return o.join("")})}function Cy(e,t){var r=typeof t,i;return t==null||r==="boolean"?dL(t):(r==="number"?lE:r==="string"?(i=r1(t))?(t=i,K5):GEe:t instanceof r1?K5:t instanceof Date?BEe:jEe(t)?NEe:Array.isArray(t)?FEe:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?$Ee:lE)(e,t)}function fL(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function HEe(e,t){t===void 0&&(t=e,e=Cy);for(var r=0,i=t.length-1,c=t[0],d=new Array(i<0?0:i);r<i;)d[r]=e(c,c=t[++r]);return function(g){var o=Math.max(0,Math.min(i-1,Math.floor(g*=i)));return d[o](g-o)}}function WEe(e){return function(){return e}}function cE(e){return+e}var Y5=[0,1];function Qs(e){return e}function QM(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:WEe(isNaN(t)?NaN:.5)}function qEe(e,t){var r;return e>t&&(r=e,e=t,t=r),function(i){return Math.max(e,Math.min(t,i))}}function ZEe(e,t,r){var i=e[0],c=e[1],d=t[0],g=t[1];return c<i?(i=QM(c,i),d=r(g,d)):(i=QM(i,c),d=r(d,g)),function(o){return d(i(o))}}function XEe(e,t,r){var i=Math.min(e.length,t.length)-1,c=new Array(i),d=new Array(i),g=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++g<i;)c[g]=QM(e[g],e[g+1]),d[g]=r(t[g],t[g+1]);return function(o){var w=K1(e,o,1,i)-1;return d[w](c[w](o))}}function J1(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function tA(){var e=Y5,t=Y5,r=Cy,i,c,d,g=Qs,o,w,T;function I(){var R=Math.min(e.length,t.length);return g!==Qs&&(g=qEe(e[0],e[R-1])),o=R>2?XEe:ZEe,w=T=null,C}function C(R){return R==null||isNaN(R=+R)?d:(w||(w=o(e.map(i),t,r)))(i(g(R)))}return C.invert=function(R){return g(c((T||(T=o(t,e.map(i),lE)))(R)))},C.domain=function(R){return arguments.length?(e=Array.from(R,cE),I()):e.slice()},C.range=function(R){return arguments.length?(t=Array.from(R),I()):t.slice()},C.rangeRound=function(R){return t=Array.from(R),r=fL,I()},C.clamp=function(R){return arguments.length?(g=R?!0:Qs,I()):g!==Qs},C.interpolate=function(R){return arguments.length?(r=R,I()):r},C.unknown=function(R){return arguments.length?(d=R,C):d},function(R,F){return i=R,c=F,I()}}function pL(){return tA()(Qs,Qs)}function KEe(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function uE(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function V_(e){return e=uE(Math.abs(e)),e?e[1]:NaN}function YEe(e,t){return function(r,i){for(var c=r.length,d=[],g=0,o=e[0],w=0;c>0&&o>0&&(w+o+1>i&&(o=Math.max(1,i-w)),d.push(r.substring(c-=o,c+o)),!((w+=o+1)>i));)o=e[g=(g+1)%e.length];return d.reverse().join(t)}}function JEe(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var QEe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function n1(e){if(!(t=QEe.exec(e)))throw new Error("invalid format: "+e);var t;return new mL({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}n1.prototype=mL.prototype;function mL(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}mL.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function e2e(e){e:for(var t=e.length,r=1,i=-1,c;r<t;++r)switch(e[r]){case".":i=c=r;break;case"0":i===0&&(i=r),c=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(c+1):e}var q9;function t2e(e,t){var r=uE(e,t);if(!r)return e+"";var i=r[0],c=r[1],d=c-(q9=Math.max(-8,Math.min(8,Math.floor(c/3)))*3)+1,g=i.length;return d===g?i:d>g?i+new Array(d-g+1).join("0"):d>0?i.slice(0,d)+"."+i.slice(d):"0."+new Array(1-d).join("0")+uE(e,Math.max(0,t+d-1))[0]}function J5(e,t){var r=uE(e,t);if(!r)return e+"";var i=r[0],c=r[1];return c<0?"0."+new Array(-c).join("0")+i:i.length>c+1?i.slice(0,c+1)+"."+i.slice(c+1):i+new Array(c-i.length+2).join("0")}const Q5={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:KEe,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>J5(e*100,t),r:J5,s:t2e,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function e$(e){return e}var t$=Array.prototype.map,r$=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function r2e(e){var t=e.grouping===void 0||e.thousands===void 0?e$:YEe(t$.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",c=e.decimal===void 0?".":e.decimal+"",d=e.numerals===void 0?e$:JEe(t$.call(e.numerals,String)),g=e.percent===void 0?"%":e.percent+"",o=e.minus===void 0?"":e.minus+"",w=e.nan===void 0?"NaN":e.nan+"";function T(C){C=n1(C);var R=C.fill,F=C.align,G=C.sign,j=C.symbol,H=C.zero,X=C.width,q=C.comma,Z=C.precision,J=C.trim,ne=C.type;ne==="n"?(q=!0,ne="g"):Q5[ne]||(Z===void 0&&(Z=12),J=!0,ne="g"),(H||R==="0"&&F==="=")&&(H=!0,R="0",F="=");var he=j==="$"?r:j==="#"&&/[boxX]/.test(ne)?"0"+ne.toLowerCase():"",me=j==="$"?i:/[%p]/.test(ne)?g:"",Se=Q5[ne],qe=/[defgprs%]/.test(ne);Z=Z===void 0?6:/[gprs]/.test(ne)?Math.max(1,Math.min(21,Z)):Math.max(0,Math.min(20,Z));function Ze(He){var Ke=he,dt=me,$e,mt,ct;if(ne==="c")dt=Se(He)+dt,He="";else{He=+He;var St=He<0||1/He<0;if(He=isNaN(He)?w:Se(Math.abs(He),Z),J&&(He=e2e(He)),St&&+He==0&&G!=="+"&&(St=!1),Ke=(St?G==="("?G:o:G==="-"||G==="("?"":G)+Ke,dt=(ne==="s"?r$[8+q9/3]:"")+dt+(St&&G==="("?")":""),qe){for($e=-1,mt=He.length;++$e<mt;)if(ct=He.charCodeAt($e),48>ct||ct>57){dt=(ct===46?c+He.slice($e+1):He.slice($e))+dt,He=He.slice(0,$e);break}}}q&&!H&&(He=t(He,1/0));var Ue=Ke.length+He.length+dt.length,st=Ue<X?new Array(X-Ue+1).join(R):"";switch(q&&H&&(He=t(st+He,st.length?X-dt.length:1/0),st=""),F){case"<":He=Ke+He+dt+st;break;case"=":He=Ke+st+He+dt;break;case"^":He=st.slice(0,Ue=st.length>>1)+Ke+He+dt+st.slice(Ue);break;default:He=st+Ke+He+dt;break}return d(He)}return Ze.toString=function(){return C+""},Ze}function I(C,R){var F=T((C=n1(C),C.type="f",C)),G=Math.max(-8,Math.min(8,Math.floor(V_(R)/3)))*3,j=Math.pow(10,-G),H=r$[8+G/3];return function(X){return F(j*X)+H}}return{format:T,formatPrefix:I}}var NS,gL,Z9;n2e({thousands:",",grouping:[3],currency:["$",""]});function n2e(e){return NS=r2e(e),gL=NS.format,Z9=NS.formatPrefix,NS}function i2e(e){return Math.max(0,-V_(Math.abs(e)))}function o2e(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(V_(t)/3)))*3-V_(Math.abs(e)))}function s2e(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,V_(t)-V_(e))+1}function X9(e,t,r,i){var c=XM(e,t,r),d;switch(i=n1(i??",f"),i.type){case"s":{var g=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(d=o2e(c,g))&&(i.precision=d),Z9(i,g)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(d=s2e(c,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=d-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(d=i2e(c))&&(i.precision=d-(i.type==="%")*2);break}}return gL(i)}function Jd(e){var t=e.domain;return e.ticks=function(r){var i=t();return qM(i[0],i[i.length-1],r??10)},e.tickFormat=function(r,i){var c=t();return X9(c[0],c[c.length-1],r??10,i)},e.nice=function(r){r==null&&(r=10);var i=t(),c=0,d=i.length-1,g=i[c],o=i[d],w,T,I=10;for(o<g&&(T=g,g=o,o=T,T=c,c=d,d=T);I-- >0;){if(T=ZM(g,o,r),T===w)return i[c]=g,i[d]=o,t(i);if(T>0)g=Math.floor(g/T)*T,o=Math.ceil(o/T)*T;else if(T<0)g=Math.ceil(g*T)/T,o=Math.floor(o*T)/T;else break;w=T}return e},e}function hE(){var e=pL();return e.copy=function(){return J1(e,hE())},xl.apply(e,arguments),Jd(e)}function K9(e){var t;function r(i){return i==null||isNaN(i=+i)?t:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=Array.from(i,cE),r):e.slice()},r.unknown=function(i){return arguments.length?(t=i,r):t},r.copy=function(){return K9(e).unknown(t)},e=arguments.length?Array.from(e,cE):[0,1],Jd(r)}function Y9(e,t){e=e.slice();var r=0,i=e.length-1,c=e[r],d=e[i],g;return d<c&&(g=r,r=i,i=g,g=c,c=d,d=g),e[r]=t.floor(c),e[i]=t.ceil(d),e}function n$(e){return Math.log(e)}function i$(e){return Math.exp(e)}function a2e(e){return-Math.log(-e)}function l2e(e){return-Math.exp(-e)}function c2e(e){return isFinite(e)?+("1e"+e):e<0?0:e}function u2e(e){return e===10?c2e:e===Math.E?Math.exp:t=>Math.pow(e,t)}function h2e(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function o$(e){return(t,r)=>-e(-t,r)}function _L(e){const t=e(n$,i$),r=t.domain;let i=10,c,d;function g(){return c=h2e(i),d=u2e(i),r()[0]<0?(c=o$(c),d=o$(d),e(a2e,l2e)):e(n$,i$),t}return t.base=function(o){return arguments.length?(i=+o,g()):i},t.domain=function(o){return arguments.length?(r(o),g()):r()},t.ticks=o=>{const w=r();let T=w[0],I=w[w.length-1];const C=I<T;C&&([T,I]=[I,T]);let R=c(T),F=c(I),G,j;const H=o==null?10:+o;let X=[];if(!(i%1)&&F-R<H){if(R=Math.floor(R),F=Math.ceil(F),T>0){for(;R<=F;++R)for(G=1;G<i;++G)if(j=R<0?G/d(-R):G*d(R),!(j<T)){if(j>I)break;X.push(j)}}else for(;R<=F;++R)for(G=i-1;G>=1;--G)if(j=R>0?G/d(-R):G*d(R),!(j<T)){if(j>I)break;X.push(j)}X.length*2<H&&(X=qM(T,I,H))}else X=qM(R,F,Math.min(F-R,H)).map(d);return C?X.reverse():X},t.tickFormat=(o,w)=>{if(o==null&&(o=10),w==null&&(w=i===10?"s":","),typeof w!="function"&&(!(i%1)&&(w=n1(w)).precision==null&&(w.trim=!0),w=gL(w)),o===1/0)return w;const T=Math.max(1,i*o/t.ticks().length);return I=>{let C=I/d(Math.round(c(I)));return C*i<i-.5&&(C*=i),C<=T?w(I):""}},t.nice=()=>r(Y9(r(),{floor:o=>d(Math.floor(c(o))),ceil:o=>d(Math.ceil(c(o)))})),t}function J9(){const e=_L(tA()).domain([1,10]);return e.copy=()=>J1(e,J9()).base(e.base()),xl.apply(e,arguments),e}function s$(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function a$(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function yL(e){var t=1,r=e(s$(t),a$(t));return r.constant=function(i){return arguments.length?e(s$(t=+i),a$(t)):t},Jd(r)}function Q9(){var e=yL(tA());return e.copy=function(){return J1(e,Q9()).constant(e.constant())},xl.apply(e,arguments)}function l$(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function d2e(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function f2e(e){return e<0?-e*e:e*e}function vL(e){var t=e(Qs,Qs),r=1;function i(){return r===1?e(Qs,Qs):r===.5?e(d2e,f2e):e(l$(r),l$(1/r))}return t.exponent=function(c){return arguments.length?(r=+c,i()):r},Jd(t)}function xL(){var e=vL(tA());return e.copy=function(){return J1(e,xL()).exponent(e.exponent())},xl.apply(e,arguments),e}function p2e(){return xL.apply(null,arguments).exponent(.5)}function c$(e){return Math.sign(e)*e*e}function m2e(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function e7(){var e=pL(),t=[0,1],r=!1,i;function c(d){var g=m2e(e(d));return isNaN(g)?i:r?Math.round(g):g}return c.invert=function(d){return e.invert(c$(d))},c.domain=function(d){return arguments.length?(e.domain(d),c):e.domain()},c.range=function(d){return arguments.length?(e.range((t=Array.from(d,cE)).map(c$)),c):t.slice()},c.rangeRound=function(d){return c.range(d).round(!0)},c.round=function(d){return arguments.length?(r=!!d,c):r},c.clamp=function(d){return arguments.length?(e.clamp(d),c):e.clamp()},c.unknown=function(d){return arguments.length?(i=d,c):i},c.copy=function(){return e7(e.domain(),t).round(r).clamp(e.clamp()).unknown(i)},xl.apply(c,arguments),Jd(c)}function t7(){var e=[],t=[],r=[],i;function c(){var g=0,o=Math.max(1,t.length);for(r=new Array(o-1);++g<o;)r[g-1]=xEe(e,g/o);return d}function d(g){return g==null||isNaN(g=+g)?i:t[K1(r,g)]}return d.invertExtent=function(g){var o=t.indexOf(g);return o<0?[NaN,NaN]:[o>0?r[o-1]:e[0],o<r.length?r[o]:e[e.length-1]]},d.domain=function(g){if(!arguments.length)return e.slice();e=[];for(let o of g)o!=null&&!isNaN(o=+o)&&e.push(o);return e.sort(kd),c()},d.range=function(g){return arguments.length?(t=Array.from(g),c()):t.slice()},d.unknown=function(g){return arguments.length?(i=g,d):i},d.quantiles=function(){return r.slice()},d.copy=function(){return t7().domain(e).range(t).unknown(i)},xl.apply(d,arguments)}function r7(){var e=0,t=1,r=1,i=[.5],c=[0,1],d;function g(w){return w!=null&&w<=w?c[K1(i,w,0,r)]:d}function o(){var w=-1;for(i=new Array(r);++w<r;)i[w]=((w+1)*t-(w-r)*e)/(r+1);return g}return g.domain=function(w){return arguments.length?([e,t]=w,e=+e,t=+t,o()):[e,t]},g.range=function(w){return arguments.length?(r=(c=Array.from(w)).length-1,o()):c.slice()},g.invertExtent=function(w){var T=c.indexOf(w);return T<0?[NaN,NaN]:T<1?[e,i[0]]:T>=r?[i[r-1],t]:[i[T-1],i[T]]},g.unknown=function(w){return arguments.length&&(d=w),g},g.thresholds=function(){return i.slice()},g.copy=function(){return r7().domain([e,t]).range(c).unknown(d)},xl.apply(Jd(g),arguments)}function n7(){var e=[.5],t=[0,1],r,i=1;function c(d){return d!=null&&d<=d?t[K1(e,d,0,i)]:r}return c.domain=function(d){return arguments.length?(e=Array.from(d),i=Math.min(e.length,t.length-1),c):e.slice()},c.range=function(d){return arguments.length?(t=Array.from(d),i=Math.min(e.length,t.length-1),c):t.slice()},c.invertExtent=function(d){var g=t.indexOf(d);return[e[g-1],e[g]]},c.unknown=function(d){return arguments.length?(r=d,c):r},c.copy=function(){return n7().domain(e).range(t).unknown(r)},xl.apply(c,arguments)}const BI=new Date,$I=new Date;function qo(e,t,r,i){function c(d){return e(d=arguments.length===0?new Date:new Date(+d)),d}return c.floor=d=>(e(d=new Date(+d)),d),c.ceil=d=>(e(d=new Date(d-1)),t(d,1),e(d),d),c.round=d=>{const g=c(d),o=c.ceil(d);return d-g<o-d?g:o},c.offset=(d,g)=>(t(d=new Date(+d),g==null?1:Math.floor(g)),d),c.range=(d,g,o)=>{const w=[];if(d=c.ceil(d),o=o==null?1:Math.floor(o),!(d<g)||!(o>0))return w;let T;do w.push(T=new Date(+d)),t(d,o),e(d);while(T<d&&d<g);return w},c.filter=d=>qo(g=>{if(g>=g)for(;e(g),!d(g);)g.setTime(g-1)},(g,o)=>{if(g>=g)if(o<0)for(;++o<=0;)for(;t(g,-1),!d(g););else for(;--o>=0;)for(;t(g,1),!d(g););}),r&&(c.count=(d,g)=>(BI.setTime(+d),$I.setTime(+g),e(BI),e($I),Math.floor(r(BI,$I))),c.every=d=>(d=Math.floor(d),!isFinite(d)||!(d>0)?null:d>1?c.filter(i?g=>i(g)%d===0:g=>c.count(0,g)%d===0):c)),c}const dE=qo(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);dE.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?qo(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):dE);dE.range;const Bu=1e3,dl=Bu*60,$u=dl*60,Qu=$u*24,bL=Qu*7,u$=Qu*30,UI=Qu*365,Pp=qo(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*Bu)},(e,t)=>(t-e)/Bu,e=>e.getUTCSeconds());Pp.range;const wL=qo(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Bu)},(e,t)=>{e.setTime(+e+t*dl)},(e,t)=>(t-e)/dl,e=>e.getMinutes());wL.range;const SL=qo(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*dl)},(e,t)=>(t-e)/dl,e=>e.getUTCMinutes());SL.range;const TL=qo(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*Bu-e.getMinutes()*dl)},(e,t)=>{e.setTime(+e+t*$u)},(e,t)=>(t-e)/$u,e=>e.getHours());TL.range;const EL=qo(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*$u)},(e,t)=>(t-e)/$u,e=>e.getUTCHours());EL.range;const Q1=qo(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*dl)/Qu,e=>e.getDate()-1);Q1.range;const rA=qo(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Qu,e=>e.getUTCDate()-1);rA.range;const i7=qo(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Qu,e=>Math.floor(e/Qu));i7.range;function cm(e){return qo(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*dl)/bL)}const nA=cm(0),fE=cm(1),g2e=cm(2),_2e=cm(3),G_=cm(4),y2e=cm(5),v2e=cm(6);nA.range;fE.range;g2e.range;_2e.range;G_.range;y2e.range;v2e.range;function um(e){return qo(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/bL)}const iA=um(0),pE=um(1),x2e=um(2),b2e=um(3),H_=um(4),w2e=um(5),S2e=um(6);iA.range;pE.range;x2e.range;b2e.range;H_.range;w2e.range;S2e.range;const AL=qo(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());AL.range;const PL=qo(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());PL.range;const eh=qo(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());eh.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:qo(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});eh.range;const th=qo(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());th.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:qo(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});th.range;function o7(e,t,r,i,c,d){const g=[[Pp,1,Bu],[Pp,5,5*Bu],[Pp,15,15*Bu],[Pp,30,30*Bu],[d,1,dl],[d,5,5*dl],[d,15,15*dl],[d,30,30*dl],[c,1,$u],[c,3,3*$u],[c,6,6*$u],[c,12,12*$u],[i,1,Qu],[i,2,2*Qu],[r,1,bL],[t,1,u$],[t,3,3*u$],[e,1,UI]];function o(T,I,C){const R=I<T;R&&([T,I]=[I,T]);const F=C&&typeof C.range=="function"?C:w(T,I,C),G=F?F.range(T,+I+1):[];return R?G.reverse():G}function w(T,I,C){const R=Math.abs(I-T)/C,F=cL(([,,H])=>H).right(g,R);if(F===g.length)return e.every(XM(T/UI,I/UI,C));if(F===0)return dE.every(Math.max(XM(T,I,C),1));const[G,j]=g[R/g[F-1][2]<g[F][2]/R?F-1:F];return G.every(j)}return[o,w]}const[T2e,E2e]=o7(th,PL,iA,i7,EL,SL),[A2e,P2e]=o7(eh,AL,nA,Q1,TL,wL);function VI(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function GI(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function L0(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function C2e(e){var t=e.dateTime,r=e.date,i=e.time,c=e.periods,d=e.days,g=e.shortDays,o=e.months,w=e.shortMonths,T=z0(c),I=N0(c),C=z0(d),R=N0(d),F=z0(g),G=N0(g),j=z0(o),H=N0(o),X=z0(w),q=N0(w),Z={a:St,A:Ue,b:st,B:bt,c:null,d:g$,e:g$,f:Y2e,g:aAe,G:cAe,H:Z2e,I:X2e,j:K2e,L:s7,m:J2e,M:Q2e,p:At,q:zt,Q:v$,s:x$,S:eAe,u:tAe,U:rAe,V:nAe,w:iAe,W:oAe,x:null,X:null,y:sAe,Y:lAe,Z:uAe,"%":y$},J={a:or,A:Mr,b:Ar,B:vr,c:null,d:_$,e:_$,f:pAe,g:TAe,G:AAe,H:hAe,I:dAe,j:fAe,L:l7,m:mAe,M:gAe,p:nr,q:Xr,Q:v$,s:x$,S:_Ae,u:yAe,U:vAe,V:xAe,w:bAe,W:wAe,x:null,X:null,y:SAe,Y:EAe,Z:PAe,"%":y$},ne={a:Ze,A:He,b:Ke,B:dt,c:$e,d:p$,e:p$,f:G2e,g:f$,G:d$,H:m$,I:m$,j:B2e,L:V2e,m:F2e,M:$2e,p:qe,q:j2e,Q:W2e,s:q2e,S:U2e,u:k2e,U:D2e,V:L2e,w:R2e,W:z2e,x:mt,X:ct,y:f$,Y:d$,Z:N2e,"%":H2e};Z.x=he(r,Z),Z.X=he(i,Z),Z.c=he(t,Z),J.x=he(r,J),J.X=he(i,J),J.c=he(t,J);function he(Lt,ur){return function(_r){var Mt=[],Nr=-1,Yr=0,Hn=Lt.length,en,Ei,xo;for(_r instanceof Date||(_r=new Date(+_r));++Nr<Hn;)Lt.charCodeAt(Nr)===37&&(Mt.push(Lt.slice(Yr,Nr)),(Ei=h$[en=Lt.charAt(++Nr)])!=null?en=Lt.charAt(++Nr):Ei=en==="e"?" ":"0",(xo=ur[en])&&(en=xo(_r,Ei)),Mt.push(en),Yr=Nr+1);return Mt.push(Lt.slice(Yr,Nr)),Mt.join("")}}function me(Lt,ur){return function(_r){var Mt=L0(1900,void 0,1),Nr=Se(Mt,Lt,_r+="",0),Yr,Hn;if(Nr!=_r.length)return null;if("Q"in Mt)return new Date(Mt.Q);if("s"in Mt)return new Date(Mt.s*1e3+("L"in Mt?Mt.L:0));if(ur&&!("Z"in Mt)&&(Mt.Z=0),"p"in Mt&&(Mt.H=Mt.H%12+Mt.p*12),Mt.m===void 0&&(Mt.m="q"in Mt?Mt.q:0),"V"in Mt){if(Mt.V<1||Mt.V>53)return null;"w"in Mt||(Mt.w=1),"Z"in Mt?(Yr=GI(L0(Mt.y,0,1)),Hn=Yr.getUTCDay(),Yr=Hn>4||Hn===0?pE.ceil(Yr):pE(Yr),Yr=rA.offset(Yr,(Mt.V-1)*7),Mt.y=Yr.getUTCFullYear(),Mt.m=Yr.getUTCMonth(),Mt.d=Yr.getUTCDate()+(Mt.w+6)%7):(Yr=VI(L0(Mt.y,0,1)),Hn=Yr.getDay(),Yr=Hn>4||Hn===0?fE.ceil(Yr):fE(Yr),Yr=Q1.offset(Yr,(Mt.V-1)*7),Mt.y=Yr.getFullYear(),Mt.m=Yr.getMonth(),Mt.d=Yr.getDate()+(Mt.w+6)%7)}else("W"in Mt||"U"in Mt)&&("w"in Mt||(Mt.w="u"in Mt?Mt.u%7:"W"in Mt?1:0),Hn="Z"in Mt?GI(L0(Mt.y,0,1)).getUTCDay():VI(L0(Mt.y,0,1)).getDay(),Mt.m=0,Mt.d="W"in Mt?(Mt.w+6)%7+Mt.W*7-(Hn+5)%7:Mt.w+Mt.U*7-(Hn+6)%7);return"Z"in Mt?(Mt.H+=Mt.Z/100|0,Mt.M+=Mt.Z%100,GI(Mt)):VI(Mt)}}function Se(Lt,ur,_r,Mt){for(var Nr=0,Yr=ur.length,Hn=_r.length,en,Ei;Nr<Yr;){if(Mt>=Hn)return-1;if(en=ur.charCodeAt(Nr++),en===37){if(en=ur.charAt(Nr++),Ei=ne[en in h$?ur.charAt(Nr++):en],!Ei||(Mt=Ei(Lt,_r,Mt))<0)return-1}else if(en!=_r.charCodeAt(Mt++))return-1}return Mt}function qe(Lt,ur,_r){var Mt=T.exec(ur.slice(_r));return Mt?(Lt.p=I.get(Mt[0].toLowerCase()),_r+Mt[0].length):-1}function Ze(Lt,ur,_r){var Mt=F.exec(ur.slice(_r));return Mt?(Lt.w=G.get(Mt[0].toLowerCase()),_r+Mt[0].length):-1}function He(Lt,ur,_r){var Mt=C.exec(ur.slice(_r));return Mt?(Lt.w=R.get(Mt[0].toLowerCase()),_r+Mt[0].length):-1}function Ke(Lt,ur,_r){var Mt=X.exec(ur.slice(_r));return Mt?(Lt.m=q.get(Mt[0].toLowerCase()),_r+Mt[0].length):-1}function dt(Lt,ur,_r){var Mt=j.exec(ur.slice(_r));return Mt?(Lt.m=H.get(Mt[0].toLowerCase()),_r+Mt[0].length):-1}function $e(Lt,ur,_r){return Se(Lt,t,ur,_r)}function mt(Lt,ur,_r){return Se(Lt,r,ur,_r)}function ct(Lt,ur,_r){return Se(Lt,i,ur,_r)}function St(Lt){return g[Lt.getDay()]}function Ue(Lt){return d[Lt.getDay()]}function st(Lt){return w[Lt.getMonth()]}function bt(Lt){return o[Lt.getMonth()]}function At(Lt){return c[+(Lt.getHours()>=12)]}function zt(Lt){return 1+~~(Lt.getMonth()/3)}function or(Lt){return g[Lt.getUTCDay()]}function Mr(Lt){return d[Lt.getUTCDay()]}function Ar(Lt){return w[Lt.getUTCMonth()]}function vr(Lt){return o[Lt.getUTCMonth()]}function nr(Lt){return c[+(Lt.getUTCHours()>=12)]}function Xr(Lt){return 1+~~(Lt.getUTCMonth()/3)}return{format:function(Lt){var ur=he(Lt+="",Z);return ur.toString=function(){return Lt},ur},parse:function(Lt){var ur=me(Lt+="",!1);return ur.toString=function(){return Lt},ur},utcFormat:function(Lt){var ur=he(Lt+="",J);return ur.toString=function(){return Lt},ur},utcParse:function(Lt){var ur=me(Lt+="",!0);return ur.toString=function(){return Lt},ur}}}var h$={"-":"",_:" ",0:"0"},as=/^\s*\d+/,I2e=/^%/,O2e=/[\\^$*+?|[\]().{}]/g;function Ti(e,t,r){var i=e<0?"-":"",c=(i?-e:e)+"",d=c.length;return i+(d<r?new Array(r-d+1).join(t)+c:c)}function M2e(e){return e.replace(O2e,"\\$&")}function z0(e){return new RegExp("^(?:"+e.map(M2e).join("|")+")","i")}function N0(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function R2e(e,t,r){var i=as.exec(t.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function k2e(e,t,r){var i=as.exec(t.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function D2e(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function L2e(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function z2e(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function d$(e,t,r){var i=as.exec(t.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function f$(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function N2e(e,t,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function j2e(e,t,r){var i=as.exec(t.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function F2e(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function p$(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function B2e(e,t,r){var i=as.exec(t.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function m$(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function $2e(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function U2e(e,t,r){var i=as.exec(t.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function V2e(e,t,r){var i=as.exec(t.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function G2e(e,t,r){var i=as.exec(t.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function H2e(e,t,r){var i=I2e.exec(t.slice(r,r+1));return i?r+i[0].length:-1}function W2e(e,t,r){var i=as.exec(t.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function q2e(e,t,r){var i=as.exec(t.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function g$(e,t){return Ti(e.getDate(),t,2)}function Z2e(e,t){return Ti(e.getHours(),t,2)}function X2e(e,t){return Ti(e.getHours()%12||12,t,2)}function K2e(e,t){return Ti(1+Q1.count(eh(e),e),t,3)}function s7(e,t){return Ti(e.getMilliseconds(),t,3)}function Y2e(e,t){return s7(e,t)+"000"}function J2e(e,t){return Ti(e.getMonth()+1,t,2)}function Q2e(e,t){return Ti(e.getMinutes(),t,2)}function eAe(e,t){return Ti(e.getSeconds(),t,2)}function tAe(e){var t=e.getDay();return t===0?7:t}function rAe(e,t){return Ti(nA.count(eh(e)-1,e),t,2)}function a7(e){var t=e.getDay();return t>=4||t===0?G_(e):G_.ceil(e)}function nAe(e,t){return e=a7(e),Ti(G_.count(eh(e),e)+(eh(e).getDay()===4),t,2)}function iAe(e){return e.getDay()}function oAe(e,t){return Ti(fE.count(eh(e)-1,e),t,2)}function sAe(e,t){return Ti(e.getFullYear()%100,t,2)}function aAe(e,t){return e=a7(e),Ti(e.getFullYear()%100,t,2)}function lAe(e,t){return Ti(e.getFullYear()%1e4,t,4)}function cAe(e,t){var r=e.getDay();return e=r>=4||r===0?G_(e):G_.ceil(e),Ti(e.getFullYear()%1e4,t,4)}function uAe(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Ti(t/60|0,"0",2)+Ti(t%60,"0",2)}function _$(e,t){return Ti(e.getUTCDate(),t,2)}function hAe(e,t){return Ti(e.getUTCHours(),t,2)}function dAe(e,t){return Ti(e.getUTCHours()%12||12,t,2)}function fAe(e,t){return Ti(1+rA.count(th(e),e),t,3)}function l7(e,t){return Ti(e.getUTCMilliseconds(),t,3)}function pAe(e,t){return l7(e,t)+"000"}function mAe(e,t){return Ti(e.getUTCMonth()+1,t,2)}function gAe(e,t){return Ti(e.getUTCMinutes(),t,2)}function _Ae(e,t){return Ti(e.getUTCSeconds(),t,2)}function yAe(e){var t=e.getUTCDay();return t===0?7:t}function vAe(e,t){return Ti(iA.count(th(e)-1,e),t,2)}function c7(e){var t=e.getUTCDay();return t>=4||t===0?H_(e):H_.ceil(e)}function xAe(e,t){return e=c7(e),Ti(H_.count(th(e),e)+(th(e).getUTCDay()===4),t,2)}function bAe(e){return e.getUTCDay()}function wAe(e,t){return Ti(pE.count(th(e)-1,e),t,2)}function SAe(e,t){return Ti(e.getUTCFullYear()%100,t,2)}function TAe(e,t){return e=c7(e),Ti(e.getUTCFullYear()%100,t,2)}function EAe(e,t){return Ti(e.getUTCFullYear()%1e4,t,4)}function AAe(e,t){var r=e.getUTCDay();return e=r>=4||r===0?H_(e):H_.ceil(e),Ti(e.getUTCFullYear()%1e4,t,4)}function PAe(){return"+0000"}function y$(){return"%"}function v$(e){return+e}function x$(e){return Math.floor(+e/1e3)}var Fg,u7,h7;CAe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function CAe(e){return Fg=C2e(e),u7=Fg.format,Fg.parse,h7=Fg.utcFormat,Fg.utcParse,Fg}function IAe(e){return new Date(e)}function OAe(e){return e instanceof Date?+e:+new Date(+e)}function CL(e,t,r,i,c,d,g,o,w,T){var I=pL(),C=I.invert,R=I.domain,F=T(".%L"),G=T(":%S"),j=T("%I:%M"),H=T("%I %p"),X=T("%a %d"),q=T("%b %d"),Z=T("%B"),J=T("%Y");function ne(he){return(w(he)<he?F:o(he)<he?G:g(he)<he?j:d(he)<he?H:i(he)<he?c(he)<he?X:q:r(he)<he?Z:J)(he)}return I.invert=function(he){return new Date(C(he))},I.domain=function(he){return arguments.length?R(Array.from(he,OAe)):R().map(IAe)},I.ticks=function(he){var me=R();return e(me[0],me[me.length-1],he??10)},I.tickFormat=function(he,me){return me==null?ne:T(me)},I.nice=function(he){var me=R();return(!he||typeof he.range!="function")&&(he=t(me[0],me[me.length-1],he??10)),he?R(Y9(me,he)):I},I.copy=function(){return J1(I,CL(e,t,r,i,c,d,g,o,w,T))},I}function MAe(){return xl.apply(CL(A2e,P2e,eh,AL,nA,Q1,TL,wL,Pp,u7).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function RAe(){return xl.apply(CL(T2e,E2e,th,PL,iA,rA,EL,SL,Pp,h7).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function oA(){var e=0,t=1,r,i,c,d,g=Qs,o=!1,w;function T(C){return C==null||isNaN(C=+C)?w:g(c===0?.5:(C=(d(C)-r)*c,o?Math.max(0,Math.min(1,C)):C))}T.domain=function(C){return arguments.length?([e,t]=C,r=d(e=+e),i=d(t=+t),c=r===i?0:1/(i-r),T):[e,t]},T.clamp=function(C){return arguments.length?(o=!!C,T):o},T.interpolator=function(C){return arguments.length?(g=C,T):g};function I(C){return function(R){var F,G;return arguments.length?([F,G]=R,g=C(F,G),T):[g(0),g(1)]}}return T.range=I(Cy),T.rangeRound=I(fL),T.unknown=function(C){return arguments.length?(w=C,T):w},function(C){return d=C,r=C(e),i=C(t),c=r===i?0:1/(i-r),T}}function Qd(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function d7(){var e=Jd(oA()(Qs));return e.copy=function(){return Qd(e,d7())},sh.apply(e,arguments)}function f7(){var e=_L(oA()).domain([1,10]);return e.copy=function(){return Qd(e,f7()).base(e.base())},sh.apply(e,arguments)}function p7(){var e=yL(oA());return e.copy=function(){return Qd(e,p7()).constant(e.constant())},sh.apply(e,arguments)}function IL(){var e=vL(oA());return e.copy=function(){return Qd(e,IL()).exponent(e.exponent())},sh.apply(e,arguments)}function kAe(){return IL.apply(null,arguments).exponent(.5)}function m7(){var e=[],t=Qs;function r(i){if(i!=null&&!isNaN(i=+i))return t((K1(e,i,1)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(let c of i)c!=null&&!isNaN(c=+c)&&e.push(c);return e.sort(kd),r},r.interpolator=function(i){return arguments.length?(t=i,r):t},r.range=function(){return e.map((i,c)=>t(c/(e.length-1)))},r.quantiles=function(i){return Array.from({length:i+1},(c,d)=>vEe(e,d/i))},r.copy=function(){return m7(t).domain(e)},sh.apply(r,arguments)}function sA(){var e=0,t=.5,r=1,i=1,c,d,g,o,w,T=Qs,I,C=!1,R;function F(j){return isNaN(j=+j)?R:(j=.5+((j=+I(j))-d)*(i*j<i*d?o:w),T(C?Math.max(0,Math.min(1,j)):j))}F.domain=function(j){return arguments.length?([e,t,r]=j,c=I(e=+e),d=I(t=+t),g=I(r=+r),o=c===d?0:.5/(d-c),w=d===g?0:.5/(g-d),i=d<c?-1:1,F):[e,t,r]},F.clamp=function(j){return arguments.length?(C=!!j,F):C},F.interpolator=function(j){return arguments.length?(T=j,F):T};function G(j){return function(H){var X,q,Z;return arguments.length?([X,q,Z]=H,T=HEe(j,[X,q,Z]),F):[T(0),T(.5),T(1)]}}return F.range=G(Cy),F.rangeRound=G(fL),F.unknown=function(j){return arguments.length?(R=j,F):R},function(j){return I=j,c=j(e),d=j(t),g=j(r),o=c===d?0:.5/(d-c),w=d===g?0:.5/(g-d),i=d<c?-1:1,F}}function g7(){var e=Jd(sA()(Qs));return e.copy=function(){return Qd(e,g7())},sh.apply(e,arguments)}function _7(){var e=_L(sA()).domain([.1,1,10]);return e.copy=function(){return Qd(e,_7()).base(e.base())},sh.apply(e,arguments)}function y7(){var e=yL(sA());return e.copy=function(){return Qd(e,y7()).constant(e.constant())},sh.apply(e,arguments)}function OL(){var e=vL(sA());return e.copy=function(){return Qd(e,OL()).exponent(e.exponent())},sh.apply(e,arguments)}function DAe(){return OL.apply(null,arguments).exponent(.5)}const b$=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Qx,scaleDiverging:g7,scaleDivergingLog:_7,scaleDivergingPow:OL,scaleDivergingSqrt:DAe,scaleDivergingSymlog:y7,scaleIdentity:K9,scaleImplicit:KM,scaleLinear:hE,scaleLog:J9,scaleOrdinal:uL,scalePoint:px,scalePow:xL,scaleQuantile:t7,scaleQuantize:r7,scaleRadial:e7,scaleSequential:d7,scaleSequentialLog:f7,scaleSequentialPow:IL,scaleSequentialQuantile:m7,scaleSequentialSqrt:kAe,scaleSequentialSymlog:p7,scaleSqrt:p2e,scaleSymlog:Q9,scaleThreshold:n7,scaleTime:MAe,scaleUtc:RAe,tickFormat:X9},Symbol.toStringTag,{value:"Module"}));var LAe=xy;function zAe(e,t,r){for(var i=-1,c=e.length;++i<c;){var d=e[i],g=t(d);if(g!=null&&(o===void 0?g===g&&!LAe(g):r(g,o)))var o=g,w=d}return w}var aA=zAe;function NAe(e,t){return e>t}var v7=NAe,jAe=aA,FAe=v7,BAe=Py;function $Ae(e){return e&&e.length?jAe(e,BAe,FAe):void 0}var UAe=$Ae;const lA=Ii(UAe);function VAe(e,t){return e<t}var x7=VAe,GAe=aA,HAe=x7,WAe=Py;function qAe(e){return e&&e.length?GAe(e,WAe,HAe):void 0}var ZAe=qAe;const cA=Ii(ZAe);var XAe=GD,KAe=nu,YAe=C9,JAe=ba;function QAe(e,t){var r=JAe(e)?XAe:YAe;return r(e,KAe(t))}var ePe=QAe,tPe=A9,rPe=ePe;function nPe(e,t){return tPe(rPe(e,t),1)}var iPe=nPe;const oPe=Ii(iPe);var sPe=oL;function aPe(e,t){return sPe(e,t)}var lPe=aPe;const uA=Ii(lPe);var Iy=1e9,cPe={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},RL,so=!0,yl="[DecimalError] ",zp=yl+"Invalid argument: ",ML=yl+"Exponent out of range: ",Oy=Math.floor,vp=Math.pow,uPe=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Fa,ns=1e7,ro=7,b7=9007199254740991,mE=Oy(b7/ro),Br={};Br.absoluteValue=Br.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Br.comparedTo=Br.cmp=function(e){var t,r,i,c,d=this;if(e=new d.constructor(e),d.s!==e.s)return d.s||-e.s;if(d.e!==e.e)return d.e>e.e^d.s<0?1:-1;for(i=d.d.length,c=e.d.length,t=0,r=i<c?i:c;t<r;++t)if(d.d[t]!==e.d[t])return d.d[t]>e.d[t]^d.s<0?1:-1;return i===c?0:i>c^d.s<0?1:-1};Br.decimalPlaces=Br.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*ro;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Br.dividedBy=Br.div=function(e){return Wu(this,new this.constructor(e))};Br.dividedToIntegerBy=Br.idiv=function(e){var t=this,r=t.constructor;return Vi(Wu(t,new r(e),0,1),r.precision)};Br.equals=Br.eq=function(e){return!this.cmp(e)};Br.exponent=function(){return Lo(this)};Br.greaterThan=Br.gt=function(e){return this.cmp(e)>0};Br.greaterThanOrEqualTo=Br.gte=function(e){return this.cmp(e)>=0};Br.isInteger=Br.isint=function(){return this.e>this.d.length-2};Br.isNegative=Br.isneg=function(){return this.s<0};Br.isPositive=Br.ispos=function(){return this.s>0};Br.isZero=function(){return this.s===0};Br.lessThan=Br.lt=function(e){return this.cmp(e)<0};Br.lessThanOrEqualTo=Br.lte=function(e){return this.cmp(e)<1};Br.logarithm=Br.log=function(e){var t,r=this,i=r.constructor,c=i.precision,d=c+5;if(e===void 0)e=new i(10);else if(e=new i(e),e.s<1||e.eq(Fa))throw Error(yl+"NaN");if(r.s<1)throw Error(yl+(r.s?"NaN":"-Infinity"));return r.eq(Fa)?new i(0):(so=!1,t=Wu(i1(r,d),i1(e,d),d),so=!0,Vi(t,c))};Br.minus=Br.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?T7(t,e):w7(t,(e.s=-e.s,e))};Br.modulo=Br.mod=function(e){var t,r=this,i=r.constructor,c=i.precision;if(e=new i(e),!e.s)throw Error(yl+"NaN");return r.s?(so=!1,t=Wu(r,e,0,1).times(e),so=!0,r.minus(t)):Vi(new i(r),c)};Br.naturalExponential=Br.exp=function(){return S7(this)};Br.naturalLogarithm=Br.ln=function(){return i1(this)};Br.negated=Br.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Br.plus=Br.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?w7(t,e):T7(t,(e.s=-e.s,e))};Br.precision=Br.sd=function(e){var t,r,i,c=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(zp+e);if(t=Lo(c)+1,i=c.d.length-1,r=i*ro+1,i=c.d[i],i){for(;i%10==0;i/=10)r--;for(i=c.d[0];i>=10;i/=10)r++}return e&&t>r?t:r};Br.squareRoot=Br.sqrt=function(){var e,t,r,i,c,d,g,o=this,w=o.constructor;if(o.s<1){if(!o.s)return new w(0);throw Error(yl+"NaN")}for(e=Lo(o),so=!1,c=Math.sqrt(+o),c==0||c==1/0?(t=qc(o.d),(t.length+e)%2==0&&(t+="0"),c=Math.sqrt(t),e=Oy((e+1)/2)-(e<0||e%2),c==1/0?t="5e"+e:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),i=new w(t)):i=new w(c.toString()),r=w.precision,c=g=r+3;;)if(d=i,i=d.plus(Wu(o,d,g+2)).times(.5),qc(d.d).slice(0,g)===(t=qc(i.d)).slice(0,g)){if(t=t.slice(g-3,g+1),c==g&&t=="4999"){if(Vi(d,r+1,0),d.times(d).eq(o)){i=d;break}}else if(t!="9999")break;g+=4}return so=!0,Vi(i,r)};Br.times=Br.mul=function(e){var t,r,i,c,d,g,o,w,T,I=this,C=I.constructor,R=I.d,F=(e=new C(e)).d;if(!I.s||!e.s)return new C(0);for(e.s*=I.s,r=I.e+e.e,w=R.length,T=F.length,w<T&&(d=R,R=F,F=d,g=w,w=T,T=g),d=[],g=w+T,i=g;i--;)d.push(0);for(i=T;--i>=0;){for(t=0,c=w+i;c>i;)o=d[c]+F[i]*R[c-i-1]+t,d[c--]=o%ns|0,t=o/ns|0;d[c]=(d[c]+t)%ns|0}for(;!d[--g];)d.pop();return t?++r:d.shift(),e.d=d,e.e=r,so?Vi(e,C.precision):e};Br.toDecimalPlaces=Br.todp=function(e,t){var r=this,i=r.constructor;return r=new i(r),e===void 0?r:(eu(e,0,Iy),t===void 0?t=i.rounding:eu(t,0,8),Vi(r,e+Lo(r)+1,t))};Br.toExponential=function(e,t){var r,i=this,c=i.constructor;return e===void 0?r=Kp(i,!0):(eu(e,0,Iy),t===void 0?t=c.rounding:eu(t,0,8),i=Vi(new c(i),e+1,t),r=Kp(i,!0,e+1)),r};Br.toFixed=function(e,t){var r,i,c=this,d=c.constructor;return e===void 0?Kp(c):(eu(e,0,Iy),t===void 0?t=d.rounding:eu(t,0,8),i=Vi(new d(c),e+Lo(c)+1,t),r=Kp(i.abs(),!1,e+Lo(i)+1),c.isneg()&&!c.isZero()?"-"+r:r)};Br.toInteger=Br.toint=function(){var e=this,t=e.constructor;return Vi(new t(e),Lo(e)+1,t.rounding)};Br.toNumber=function(){return+this};Br.toPower=Br.pow=function(e){var t,r,i,c,d,g,o=this,w=o.constructor,T=12,I=+(e=new w(e));if(!e.s)return new w(Fa);if(o=new w(o),!o.s){if(e.s<1)throw Error(yl+"Infinity");return o}if(o.eq(Fa))return o;if(i=w.precision,e.eq(Fa))return Vi(o,i);if(t=e.e,r=e.d.length-1,g=t>=r,d=o.s,g){if((r=I<0?-I:I)<=b7){for(c=new w(Fa),t=Math.ceil(i/ro+4),so=!1;r%2&&(c=c.times(o),S$(c.d,t)),r=Oy(r/2),r!==0;)o=o.times(o),S$(o.d,t);return so=!0,e.s<0?new w(Fa).div(c):Vi(c,i)}}else if(d<0)throw Error(yl+"NaN");return d=d<0&&e.d[Math.max(t,r)]&1?-1:1,o.s=1,so=!1,c=e.times(i1(o,i+T)),so=!0,c=S7(c),c.s=d,c};Br.toPrecision=function(e,t){var r,i,c=this,d=c.constructor;return e===void 0?(r=Lo(c),i=Kp(c,r<=d.toExpNeg||r>=d.toExpPos)):(eu(e,1,Iy),t===void 0?t=d.rounding:eu(t,0,8),c=Vi(new d(c),e,t),r=Lo(c),i=Kp(c,e<=r||r<=d.toExpNeg,e)),i};Br.toSignificantDigits=Br.tosd=function(e,t){var r=this,i=r.constructor;return e===void 0?(e=i.precision,t=i.rounding):(eu(e,1,Iy),t===void 0?t=i.rounding:eu(t,0,8)),Vi(new i(r),e,t)};Br.toString=Br.valueOf=Br.val=Br.toJSON=Br[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Lo(e),r=e.constructor;return Kp(e,t<=r.toExpNeg||t>=r.toExpPos)};function w7(e,t){var r,i,c,d,g,o,w,T,I=e.constructor,C=I.precision;if(!e.s||!t.s)return t.s||(t=new I(e)),so?Vi(t,C):t;if(w=e.d,T=t.d,g=e.e,c=t.e,w=w.slice(),d=g-c,d){for(d<0?(i=w,d=-d,o=T.length):(i=T,c=g,o=w.length),g=Math.ceil(C/ro),o=g>o?g+1:o+1,d>o&&(d=o,i.length=1),i.reverse();d--;)i.push(0);i.reverse()}for(o=w.length,d=T.length,o-d<0&&(d=o,i=T,T=w,w=i),r=0;d;)r=(w[--d]=w[d]+T[d]+r)/ns|0,w[d]%=ns;for(r&&(w.unshift(r),++c),o=w.length;w[--o]==0;)w.pop();return t.d=w,t.e=c,so?Vi(t,C):t}function eu(e,t,r){if(e!==~~e||e<t||e>r)throw Error(zp+e)}function qc(e){var t,r,i,c=e.length-1,d="",g=e[0];if(c>0){for(d+=g,t=1;t<c;t++)i=e[t]+"",r=ro-i.length,r&&(d+=ud(r)),d+=i;g=e[t],i=g+"",r=ro-i.length,r&&(d+=ud(r))}else if(g===0)return"0";for(;g%10===0;)g/=10;return d+g}var Wu=function(){function e(i,c){var d,g=0,o=i.length;for(i=i.slice();o--;)d=i[o]*c+g,i[o]=d%ns|0,g=d/ns|0;return g&&i.unshift(g),i}function t(i,c,d,g){var o,w;if(d!=g)w=d>g?1:-1;else for(o=w=0;o<d;o++)if(i[o]!=c[o]){w=i[o]>c[o]?1:-1;break}return w}function r(i,c,d){for(var g=0;d--;)i[d]-=g,g=i[d]<c[d]?1:0,i[d]=g*ns+i[d]-c[d];for(;!i[0]&&i.length>1;)i.shift()}return function(i,c,d,g){var o,w,T,I,C,R,F,G,j,H,X,q,Z,J,ne,he,me,Se,qe=i.constructor,Ze=i.s==c.s?1:-1,He=i.d,Ke=c.d;if(!i.s)return new qe(i);if(!c.s)throw Error(yl+"Division by zero");for(w=i.e-c.e,me=Ke.length,ne=He.length,F=new qe(Ze),G=F.d=[],T=0;Ke[T]==(He[T]||0);)++T;if(Ke[T]>(He[T]||0)&&--w,d==null?q=d=qe.precision:g?q=d+(Lo(i)-Lo(c))+1:q=d,q<0)return new qe(0);if(q=q/ro+2|0,T=0,me==1)for(I=0,Ke=Ke[0],q++;(T<ne||I)&&q--;T++)Z=I*ns+(He[T]||0),G[T]=Z/Ke|0,I=Z%Ke|0;else{for(I=ns/(Ke[0]+1)|0,I>1&&(Ke=e(Ke,I),He=e(He,I),me=Ke.length,ne=He.length),J=me,j=He.slice(0,me),H=j.length;H<me;)j[H++]=0;Se=Ke.slice(),Se.unshift(0),he=Ke[0],Ke[1]>=ns/2&&++he;do I=0,o=t(Ke,j,me,H),o<0?(X=j[0],me!=H&&(X=X*ns+(j[1]||0)),I=X/he|0,I>1?(I>=ns&&(I=ns-1),C=e(Ke,I),R=C.length,H=j.length,o=t(C,j,R,H),o==1&&(I--,r(C,me<R?Se:Ke,R))):(I==0&&(o=I=1),C=Ke.slice()),R=C.length,R<H&&C.unshift(0),r(j,C,H),o==-1&&(H=j.length,o=t(Ke,j,me,H),o<1&&(I++,r(j,me<H?Se:Ke,H))),H=j.length):o===0&&(I++,j=[0]),G[T++]=I,o&&j[0]?j[H++]=He[J]||0:(j=[He[J]],H=1);while((J++<ne||j[0]!==void 0)&&q--)}return G[0]||G.shift(),F.e=w,Vi(F,g?d+Lo(F)+1:d)}}();function S7(e,t){var r,i,c,d,g,o,w=0,T=0,I=e.constructor,C=I.precision;if(Lo(e)>16)throw Error(ML+Lo(e));if(!e.s)return new I(Fa);for(t==null?(so=!1,o=C):o=t,g=new I(.03125);e.abs().gte(.1);)e=e.times(g),T+=5;for(i=Math.log(vp(2,T))/Math.LN10*2+5|0,o+=i,r=c=d=new I(Fa),I.precision=o;;){if(c=Vi(c.times(e),o),r=r.times(++w),g=d.plus(Wu(c,r,o)),qc(g.d).slice(0,o)===qc(d.d).slice(0,o)){for(;T--;)d=Vi(d.times(d),o);return I.precision=C,t==null?(so=!0,Vi(d,C)):d}d=g}}function Lo(e){for(var t=e.e*ro,r=e.d[0];r>=10;r/=10)t++;return t}function HI(e,t,r){if(t>e.LN10.sd())throw so=!0,r&&(e.precision=r),Error(yl+"LN10 precision limit exceeded");return Vi(new e(e.LN10),t)}function ud(e){for(var t="";e--;)t+="0";return t}function i1(e,t){var r,i,c,d,g,o,w,T,I,C=1,R=10,F=e,G=F.d,j=F.constructor,H=j.precision;if(F.s<1)throw Error(yl+(F.s?"NaN":"-Infinity"));if(F.eq(Fa))return new j(0);if(t==null?(so=!1,T=H):T=t,F.eq(10))return t==null&&(so=!0),HI(j,T);if(T+=R,j.precision=T,r=qc(G),i=r.charAt(0),d=Lo(F),Math.abs(d)<15e14){for(;i<7&&i!=1||i==1&&r.charAt(1)>3;)F=F.times(e),r=qc(F.d),i=r.charAt(0),C++;d=Lo(F),i>1?(F=new j("0."+r),d++):F=new j(i+"."+r.slice(1))}else return w=HI(j,T+2,H).times(d+""),F=i1(new j(i+"."+r.slice(1)),T-R).plus(w),j.precision=H,t==null?(so=!0,Vi(F,H)):F;for(o=g=F=Wu(F.minus(Fa),F.plus(Fa),T),I=Vi(F.times(F),T),c=3;;){if(g=Vi(g.times(I),T),w=o.plus(Wu(g,new j(c),T)),qc(w.d).slice(0,T)===qc(o.d).slice(0,T))return o=o.times(2),d!==0&&(o=o.plus(HI(j,T+2,H).times(d+""))),o=Wu(o,new j(C),T),j.precision=H,t==null?(so=!0,Vi(o,H)):o;o=w,c+=2}}function w$(e,t){var r,i,c;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(r<0&&(r=i),r+=+t.slice(i+1),t=t.substring(0,i)):r<0&&(r=t.length),i=0;t.charCodeAt(i)===48;)++i;for(c=t.length;t.charCodeAt(c-1)===48;)--c;if(t=t.slice(i,c),t){if(c-=i,r=r-i-1,e.e=Oy(r/ro),e.d=[],i=(r+1)%ro,r<0&&(i+=ro),i<c){for(i&&e.d.push(+t.slice(0,i)),c-=ro;i<c;)e.d.push(+t.slice(i,i+=ro));t=t.slice(i),i=ro-t.length}else i-=c;for(;i--;)t+="0";if(e.d.push(+t),so&&(e.e>mE||e.e<-mE))throw Error(ML+r)}else e.s=0,e.e=0,e.d=[0];return e}function Vi(e,t,r){var i,c,d,g,o,w,T,I,C=e.d;for(g=1,d=C[0];d>=10;d/=10)g++;if(i=t-g,i<0)i+=ro,c=t,T=C[I=0];else{if(I=Math.ceil((i+1)/ro),d=C.length,I>=d)return e;for(T=d=C[I],g=1;d>=10;d/=10)g++;i%=ro,c=i-ro+g}if(r!==void 0&&(d=vp(10,g-c-1),o=T/d%10|0,w=t<0||C[I+1]!==void 0||T%d,w=r<4?(o||w)&&(r==0||r==(e.s<0?3:2)):o>5||o==5&&(r==4||w||r==6&&(i>0?c>0?T/vp(10,g-c):0:C[I-1])%10&1||r==(e.s<0?8:7))),t<1||!C[0])return w?(d=Lo(e),C.length=1,t=t-d-1,C[0]=vp(10,(ro-t%ro)%ro),e.e=Oy(-t/ro)||0):(C.length=1,C[0]=e.e=e.s=0),e;if(i==0?(C.length=I,d=1,I--):(C.length=I+1,d=vp(10,ro-i),C[I]=c>0?(T/vp(10,g-c)%vp(10,c)|0)*d:0),w)for(;;)if(I==0){(C[0]+=d)==ns&&(C[0]=1,++e.e);break}else{if(C[I]+=d,C[I]!=ns)break;C[I--]=0,d=1}for(i=C.length;C[--i]===0;)C.pop();if(so&&(e.e>mE||e.e<-mE))throw Error(ML+Lo(e));return e}function T7(e,t){var r,i,c,d,g,o,w,T,I,C,R=e.constructor,F=R.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new R(e),so?Vi(t,F):t;if(w=e.d,C=t.d,i=t.e,T=e.e,w=w.slice(),g=T-i,g){for(I=g<0,I?(r=w,g=-g,o=C.length):(r=C,i=T,o=w.length),c=Math.max(Math.ceil(F/ro),o)+2,g>c&&(g=c,r.length=1),r.reverse(),c=g;c--;)r.push(0);r.reverse()}else{for(c=w.length,o=C.length,I=c<o,I&&(o=c),c=0;c<o;c++)if(w[c]!=C[c]){I=w[c]<C[c];break}g=0}for(I&&(r=w,w=C,C=r,t.s=-t.s),o=w.length,c=C.length-o;c>0;--c)w[o++]=0;for(c=C.length;c>g;){if(w[--c]<C[c]){for(d=c;d&&w[--d]===0;)w[d]=ns-1;--w[d],w[c]+=ns}w[c]-=C[c]}for(;w[--o]===0;)w.pop();for(;w[0]===0;w.shift())--i;return w[0]?(t.d=w,t.e=i,so?Vi(t,F):t):new R(0)}function Kp(e,t,r){var i,c=Lo(e),d=qc(e.d),g=d.length;return t?(r&&(i=r-g)>0?d=d.charAt(0)+"."+d.slice(1)+ud(i):g>1&&(d=d.charAt(0)+"."+d.slice(1)),d=d+(c<0?"e":"e+")+c):c<0?(d="0."+ud(-c-1)+d,r&&(i=r-g)>0&&(d+=ud(i))):c>=g?(d+=ud(c+1-g),r&&(i=r-c-1)>0&&(d=d+"."+ud(i))):((i=c+1)<g&&(d=d.slice(0,i)+"."+d.slice(i)),r&&(i=r-g)>0&&(c+1===g&&(d+="."),d+=ud(i))),e.s<0?"-"+d:d}function S$(e,t){if(e.length>t)return e.length=t,!0}function E7(e){var t,r,i;function c(d){var g=this;if(!(g instanceof c))return new c(d);if(g.constructor=c,d instanceof c){g.s=d.s,g.e=d.e,g.d=(d=d.d)?d.slice():d;return}if(typeof d=="number"){if(d*0!==0)throw Error(zp+d);if(d>0)g.s=1;else if(d<0)d=-d,g.s=-1;else{g.s=0,g.e=0,g.d=[0];return}if(d===~~d&&d<1e7){g.e=0,g.d=[d];return}return w$(g,d.toString())}else if(typeof d!="string")throw Error(zp+d);if(d.charCodeAt(0)===45?(d=d.slice(1),g.s=-1):g.s=1,uPe.test(d))w$(g,d);else throw Error(zp+d)}if(c.prototype=Br,c.ROUND_UP=0,c.ROUND_DOWN=1,c.ROUND_CEIL=2,c.ROUND_FLOOR=3,c.ROUND_HALF_UP=4,c.ROUND_HALF_DOWN=5,c.ROUND_HALF_EVEN=6,c.ROUND_HALF_CEIL=7,c.ROUND_HALF_FLOOR=8,c.clone=E7,c.config=c.set=hPe,e===void 0&&(e={}),e)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<i.length;)e.hasOwnProperty(r=i[t++])||(e[r]=this[r]);return c.config(e),c}function hPe(e){if(!e||typeof e!="object")throw Error(yl+"Object expected");var t,r,i,c=["precision",1,Iy,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<c.length;t+=3)if((i=e[r=c[t]])!==void 0)if(Oy(i)===i&&i>=c[t+1]&&i<=c[t+2])this[r]=i;else throw Error(zp+r+": "+i);if((i=e[r="LN10"])!==void 0)if(i==Math.LN10)this[r]=new this(i);else throw Error(zp+r+": "+i);return this}var RL=E7(cPe);Fa=new RL(1);const ji=RL;function dPe(e){return gPe(e)||mPe(e)||pPe(e)||fPe()}function fPe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pPe(e,t){if(e){if(typeof e=="string")return eR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eR(e,t)}}function mPe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function gPe(e){if(Array.isArray(e))return eR(e)}function eR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var _Pe=function(t){return t},A7={"@@functional/placeholder":!0},P7=function(t){return t===A7},T$=function(t){return function r(){return arguments.length===0||arguments.length===1&&P7(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},yPe=function e(t,r){return t===1?r:T$(function(){for(var i=arguments.length,c=new Array(i),d=0;d<i;d++)c[d]=arguments[d];var g=c.filter(function(o){return o!==A7}).length;return g>=t?r.apply(void 0,c):e(t-g,T$(function(){for(var o=arguments.length,w=new Array(o),T=0;T<o;T++)w[T]=arguments[T];var I=c.map(function(C){return P7(C)?w.shift():C});return r.apply(void 0,dPe(I).concat(w))}))})},hA=function(t){return yPe(t.length,t)},tR=function(t,r){for(var i=[],c=t;c<r;++c)i[c-t]=c;return i},vPe=hA(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),xPe=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];if(!r.length)return _Pe;var c=r.reverse(),d=c[0],g=c.slice(1);return function(){return g.reduce(function(o,w){return w(o)},d.apply(void 0,arguments))}},rR=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},C7=function(t){var r=null,i=null;return function(){for(var c=arguments.length,d=new Array(c),g=0;g<c;g++)d[g]=arguments[g];return r&&d.every(function(o,w){return o===r[w]})||(r=d,i=t.apply(void 0,d)),i}};function bPe(e){var t;return e===0?t=1:t=Math.floor(new ji(e).abs().log(10).toNumber())+1,t}function wPe(e,t,r){for(var i=new ji(e),c=0,d=[];i.lt(t)&&c<1e5;)d.push(i.toNumber()),i=i.add(r),c++;return d}var SPe=hA(function(e,t,r){var i=+e,c=+t;return i+r*(c-i)}),TPe=hA(function(e,t,r){var i=t-+e;return i=i||1/0,(r-e)/i}),EPe=hA(function(e,t,r){var i=t-+e;return i=i||1/0,Math.max(0,Math.min(1,(r-e)/i))});const dA={rangeStep:wPe,getDigitCount:bPe,interpolateNumber:SPe,uninterpolateNumber:TPe,uninterpolateTruncation:EPe};function nR(e){return CPe(e)||PPe(e)||I7(e)||APe()}function APe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PPe(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function CPe(e){if(Array.isArray(e))return iR(e)}function o1(e,t){return MPe(e)||OPe(e,t)||I7(e,t)||IPe()}function IPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function I7(e,t){if(e){if(typeof e=="string")return iR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return iR(e,t)}}function iR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function OPe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],i=!0,c=!1,d=void 0;try{for(var g=e[Symbol.iterator](),o;!(i=(o=g.next()).done)&&(r.push(o.value),!(t&&r.length===t));i=!0);}catch(w){c=!0,d=w}finally{try{!i&&g.return!=null&&g.return()}finally{if(c)throw d}}return r}}function MPe(e){if(Array.isArray(e))return e}function O7(e){var t=o1(e,2),r=t[0],i=t[1],c=r,d=i;return r>i&&(c=i,d=r),[c,d]}function M7(e,t,r){if(e.lte(0))return new ji(0);var i=dA.getDigitCount(e.toNumber()),c=new ji(10).pow(i),d=e.div(c),g=i!==1?.05:.1,o=new ji(Math.ceil(d.div(g).toNumber())).add(r).mul(g),w=o.mul(c);return t?w:new ji(Math.ceil(w))}function RPe(e,t,r){var i=1,c=new ji(e);if(!c.isint()&&r){var d=Math.abs(e);d<1?(i=new ji(10).pow(dA.getDigitCount(e)-1),c=new ji(Math.floor(c.div(i).toNumber())).mul(i)):d>1&&(c=new ji(Math.floor(e)))}else e===0?c=new ji(Math.floor((t-1)/2)):r||(c=new ji(Math.floor(e)));var g=Math.floor((t-1)/2),o=xPe(vPe(function(w){return c.add(new ji(w-g).mul(i)).toNumber()}),tR);return o(0,t)}function R7(e,t,r,i){var c=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new ji(0),tickMin:new ji(0),tickMax:new ji(0)};var d=M7(new ji(t).sub(e).div(r-1),i,c),g;e<=0&&t>=0?g=new ji(0):(g=new ji(e).add(t).div(2),g=g.sub(new ji(g).mod(d)));var o=Math.ceil(g.sub(e).div(d).toNumber()),w=Math.ceil(new ji(t).sub(g).div(d).toNumber()),T=o+w+1;return T>r?R7(e,t,r,i,c+1):(T<r&&(w=t>0?w+(r-T):w,o=t>0?o:o+(r-T)),{step:d,tickMin:g.sub(new ji(o).mul(d)),tickMax:g.add(new ji(w).mul(d))})}function kPe(e){var t=o1(e,2),r=t[0],i=t[1],c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,g=Math.max(c,2),o=O7([r,i]),w=o1(o,2),T=w[0],I=w[1];if(T===-1/0||I===1/0){var C=I===1/0?[T].concat(nR(tR(0,c-1).map(function(){return 1/0}))):[].concat(nR(tR(0,c-1).map(function(){return-1/0})),[I]);return r>i?rR(C):C}if(T===I)return RPe(T,c,d);var R=R7(T,I,g,d),F=R.step,G=R.tickMin,j=R.tickMax,H=dA.rangeStep(G,j.add(new ji(.1).mul(F)),F);return r>i?rR(H):H}function DPe(e,t){var r=o1(e,2),i=r[0],c=r[1],d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,g=O7([i,c]),o=o1(g,2),w=o[0],T=o[1];if(w===-1/0||T===1/0)return[i,c];if(w===T)return[w];var I=Math.max(t,2),C=M7(new ji(T).sub(w).div(I-1),d,0),R=[].concat(nR(dA.rangeStep(new ji(w),new ji(T).sub(new ji(.99).mul(C)),C)),[T]);return i>c?rR(R):R}var LPe=C7(kPe),zPe=C7(DPe),NPe="Invariant failed";function Yp(e,t){throw new Error(NPe)}var jPe=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function W_(e){"@babel/helpers - typeof";return W_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W_(e)}function gE(){return gE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},gE.apply(this,arguments)}function FPe(e,t){return VPe(e)||UPe(e,t)||$Pe(e,t)||BPe()}function BPe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Pe(e,t){if(e){if(typeof e=="string")return E$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return E$(e,t)}}function E$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function UPe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function VPe(e){if(Array.isArray(e))return e}function GPe(e,t){if(e==null)return{};var r=HPe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function HPe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function WPe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qPe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,L7(i.key),i)}}function ZPe(e,t,r){return t&&qPe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function XPe(e,t,r){return t=_E(t),KPe(e,k7()?Reflect.construct(t,r||[],_E(e).constructor):t.apply(e,r))}function KPe(e,t){if(t&&(W_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return YPe(e)}function YPe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k7(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(k7=function(){return!!e})()}function _E(e){return _E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_E(e)}function JPe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oR(e,t)}function oR(e,t){return oR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},oR(e,t)}function D7(e,t,r){return t=L7(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function L7(e){var t=QPe(e,"string");return W_(t)=="symbol"?t:t+""}function QPe(e,t){if(W_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(W_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fA=function(e){function t(){return WPe(this,t),XPe(this,t,arguments)}return JPe(t,e),ZPe(t,[{key:"render",value:function(){var i=this.props,c=i.offset,d=i.layout,g=i.width,o=i.dataKey,w=i.data,T=i.dataPointFormatter,I=i.xAxis,C=i.yAxis,R=GPe(i,jPe),F=hn(R,!1);this.props.direction==="x"&&I.type!=="number"&&Yp();var G=w.map(function(j){var H=T(j,o),X=H.x,q=H.y,Z=H.value,J=H.errorVal;if(!J)return null;var ne=[],he,me;if(Array.isArray(J)){var Se=FPe(J,2);he=Se[0],me=Se[1]}else he=me=J;if(d==="vertical"){var qe=I.scale,Ze=q+c,He=Ze+g,Ke=Ze-g,dt=qe(Z-he),$e=qe(Z+me);ne.push({x1:$e,y1:He,x2:$e,y2:Ke}),ne.push({x1:dt,y1:Ze,x2:$e,y2:Ze}),ne.push({x1:dt,y1:He,x2:dt,y2:Ke})}else if(d==="horizontal"){var mt=C.scale,ct=X+c,St=ct-g,Ue=ct+g,st=mt(Z-he),bt=mt(Z+me);ne.push({x1:St,y1:bt,x2:Ue,y2:bt}),ne.push({x1:ct,y1:st,x2:ct,y2:bt}),ne.push({x1:St,y1:st,x2:Ue,y2:st})}return De.createElement(Li,gE({className:"recharts-errorBar",key:"bar-".concat(ne.map(function(At){return"".concat(At.x1,"-").concat(At.x2,"-").concat(At.y1,"-").concat(At.y2)}))},F),ne.map(function(At){return De.createElement("line",gE({},At,{key:"line-".concat(At.x1,"-").concat(At.x2,"-").concat(At.y1,"-").concat(At.y2)}))}))});return De.createElement(Li,{className:"recharts-errorBars"},G)}}])}(De.Component);D7(fA,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});D7(fA,"displayName","ErrorBar");function s1(e){"@babel/helpers - typeof";return s1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s1(e)}function A$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function hp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A$(Object(r),!0).forEach(function(i){eCe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function eCe(e,t,r){return t=tCe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tCe(e){var t=rCe(e,"string");return s1(t)=="symbol"?t:t+""}function rCe(e,t){if(s1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(s1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var z7=function(t){var r=t.children,i=t.formattedGraphicalItems,c=t.legendWidth,d=t.legendContent,g=za(r,p_);if(!g)return null;var o=p_.defaultProps,w=o!==void 0?hp(hp({},o),g.props):{},T;return g.props&&g.props.payload?T=g.props&&g.props.payload:d==="children"?T=(i||[]).reduce(function(I,C){var R=C.item,F=C.props,G=F.sectors||F.data||[];return I.concat(G.map(function(j){return{type:g.props.iconType||R.props.legendType,value:j.name,color:j.fill,payload:j}}))},[]):T=(i||[]).map(function(I){var C=I.item,R=C.type.defaultProps,F=R!==void 0?hp(hp({},R),C.props):{},G=F.dataKey,j=F.name,H=F.legendType,X=F.hide;return{inactive:X,dataKey:G,type:w.iconType||H||"square",color:kL(C),value:j||G,payload:F}}),hp(hp(hp({},w),p_.getWithHeight(g,c)),{},{payload:T,item:g})};function a1(e){"@babel/helpers - typeof";return a1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a1(e)}function P$(e){return sCe(e)||oCe(e)||iCe(e)||nCe()}function nCe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iCe(e,t){if(e){if(typeof e=="string")return sR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return sR(e,t)}}function oCe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function sCe(e){if(Array.isArray(e))return sR(e)}function sR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function C$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function vo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?C$(Object(r),!0).forEach(function(i){g_(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function g_(e,t,r){return t=aCe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aCe(e){var t=lCe(e,"string");return a1(t)=="symbol"?t:t+""}function lCe(e,t){if(a1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(a1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ls(e,t,r){return ni(e)||ni(t)?r:Wo(t)?Va(e,t,r):An(t)?t(e):r}function mx(e,t,r,i){var c=oPe(e,function(o){return Ls(o,t)});if(r==="number"){var d=c.filter(function(o){return gr(o)||parseFloat(o)});return d.length?[cA(d),lA(d)]:[1/0,-1/0]}var g=i?c.filter(function(o){return!ni(o)}):c;return g.map(function(o){return Wo(o)||o instanceof Date?o:""})}var cCe=function(t){var r,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],c=arguments.length>2?arguments[2]:void 0,d=arguments.length>3?arguments[3]:void 0,g=-1,o=(r=i==null?void 0:i.length)!==null&&r!==void 0?r:0;if(o<=1)return 0;if(d&&d.axisType==="angleAxis"&&Math.abs(Math.abs(d.range[1]-d.range[0])-360)<=1e-6)for(var w=d.range,T=0;T<o;T++){var I=T>0?c[T-1].coordinate:c[o-1].coordinate,C=c[T].coordinate,R=T>=o-1?c[0].coordinate:c[T+1].coordinate,F=void 0;if(Ys(C-I)!==Ys(R-C)){var G=[];if(Ys(R-C)===Ys(w[1]-w[0])){F=R;var j=C+w[1]-w[0];G[0]=Math.min(j,(j+I)/2),G[1]=Math.max(j,(j+I)/2)}else{F=I;var H=R+w[1]-w[0];G[0]=Math.min(C,(H+C)/2),G[1]=Math.max(C,(H+C)/2)}var X=[Math.min(C,(F+C)/2),Math.max(C,(F+C)/2)];if(t>X[0]&&t<=X[1]||t>=G[0]&&t<=G[1]){g=c[T].index;break}}else{var q=Math.min(I,R),Z=Math.max(I,R);if(t>(q+C)/2&&t<=(Z+C)/2){g=c[T].index;break}}}else for(var J=0;J<o;J++)if(J===0&&t<=(i[J].coordinate+i[J+1].coordinate)/2||J>0&&J<o-1&&t>(i[J].coordinate+i[J-1].coordinate)/2&&t<=(i[J].coordinate+i[J+1].coordinate)/2||J===o-1&&t>(i[J].coordinate+i[J-1].coordinate)/2){g=i[J].index;break}return g},kL=function(t){var r,i=t,c=i.type.displayName,d=(r=t.type)!==null&&r!==void 0&&r.defaultProps?vo(vo({},t.type.defaultProps),t.props):t.props,g=d.stroke,o=d.fill,w;switch(c){case"Line":w=g;break;case"Area":case"Radar":w=g&&g!=="none"?g:o;break;default:w=o;break}return w},uCe=function(t){var r=t.barSize,i=t.totalSize,c=t.stackGroups,d=c===void 0?{}:c;if(!d)return{};for(var g={},o=Object.keys(d),w=0,T=o.length;w<T;w++)for(var I=d[o[w]].stackGroups,C=Object.keys(I),R=0,F=C.length;R<F;R++){var G=I[C[R]],j=G.items,H=G.cateAxisId,X=j.filter(function(me){return Gu(me.type).indexOf("Bar")>=0});if(X&&X.length){var q=X[0].type.defaultProps,Z=q!==void 0?vo(vo({},q),X[0].props):X[0].props,J=Z.barSize,ne=Z[H];g[ne]||(g[ne]=[]);var he=ni(J)?r:J;g[ne].push({item:X[0],stackList:X.slice(1),barSize:ni(he)?void 0:Js(he,i,0)})}}return g},hCe=function(t){var r=t.barGap,i=t.barCategoryGap,c=t.bandSize,d=t.sizeList,g=d===void 0?[]:d,o=t.maxBarSize,w=g.length;if(w<1)return null;var T=Js(r,c,0,!0),I,C=[];if(g[0].barSize===+g[0].barSize){var R=!1,F=c/w,G=g.reduce(function(J,ne){return J+ne.barSize||0},0);G+=(w-1)*T,G>=c&&(G-=(w-1)*T,T=0),G>=c&&F>0&&(R=!0,F*=.9,G=w*F);var j=(c-G)/2>>0,H={offset:j-T,size:0};I=g.reduce(function(J,ne){var he={item:ne.item,position:{offset:H.offset+H.size+T,size:R?F:ne.barSize}},me=[].concat(P$(J),[he]);return H=me[me.length-1].position,ne.stackList&&ne.stackList.length&&ne.stackList.forEach(function(Se){me.push({item:Se,position:H})}),me},C)}else{var X=Js(i,c,0,!0);c-2*X-(w-1)*T<=0&&(T=0);var q=(c-2*X-(w-1)*T)/w;q>1&&(q>>=0);var Z=o===+o?Math.min(q,o):q;I=g.reduce(function(J,ne,he){var me=[].concat(P$(J),[{item:ne.item,position:{offset:X+(q+T)*he+(q-Z)/2,size:Z}}]);return ne.stackList&&ne.stackList.length&&ne.stackList.forEach(function(Se){me.push({item:Se,position:me[me.length-1].position})}),me},C)}return I},dCe=function(t,r,i,c){var d=i.children,g=i.width,o=i.margin,w=g-(o.left||0)-(o.right||0),T=z7({children:d,legendWidth:w});if(T){var I=c||{},C=I.width,R=I.height,F=T.align,G=T.verticalAlign,j=T.layout;if((j==="vertical"||j==="horizontal"&&G==="middle")&&F!=="center"&&gr(t[F]))return vo(vo({},t),{},g_({},F,t[F]+(C||0)));if((j==="horizontal"||j==="vertical"&&F==="center")&&G!=="middle"&&gr(t[G]))return vo(vo({},t),{},g_({},G,t[G]+(R||0)))}return t},fCe=function(t,r,i){return ni(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||i==="x"?r==="xAxis":i==="y"?r==="yAxis":!0},N7=function(t,r,i,c,d){var g=r.props.children,o=ml(g,fA).filter(function(T){return fCe(c,d,T.props.direction)});if(o&&o.length){var w=o.map(function(T){return T.props.dataKey});return t.reduce(function(T,I){var C=Ls(I,i);if(ni(C))return T;var R=Array.isArray(C)?[cA(C),lA(C)]:[C,C],F=w.reduce(function(G,j){var H=Ls(I,j,0),X=R[0]-Math.abs(Array.isArray(H)?H[0]:H),q=R[1]+Math.abs(Array.isArray(H)?H[1]:H);return[Math.min(X,G[0]),Math.max(q,G[1])]},[1/0,-1/0]);return[Math.min(F[0],T[0]),Math.max(F[1],T[1])]},[1/0,-1/0])}return null},pCe=function(t,r,i,c,d){var g=r.map(function(o){return N7(t,o,i,d,c)}).filter(function(o){return!ni(o)});return g&&g.length?g.reduce(function(o,w){return[Math.min(o[0],w[0]),Math.max(o[1],w[1])]},[1/0,-1/0]):null},j7=function(t,r,i,c,d){var g=r.map(function(w){var T=w.props.dataKey;return i==="number"&&T&&N7(t,w,T,c)||mx(t,T,i,d)});if(i==="number")return g.reduce(function(w,T){return[Math.min(w[0],T[0]),Math.max(w[1],T[1])]},[1/0,-1/0]);var o={};return g.reduce(function(w,T){for(var I=0,C=T.length;I<C;I++)o[T[I]]||(o[T[I]]=!0,w.push(T[I]));return w},[])},F7=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},B7=function(t,r,i,c){if(c)return t.map(function(w){return w.coordinate});var d,g,o=t.map(function(w){return w.coordinate===r&&(d=!0),w.coordinate===i&&(g=!0),w.coordinate});return d||o.push(r),g||o.push(i),o},Uu=function(t,r,i){if(!t)return null;var c=t.scale,d=t.duplicateDomain,g=t.type,o=t.range,w=t.realScaleType==="scaleBand"?c.bandwidth()/2:2,T=(r||i)&&g==="category"&&c.bandwidth?c.bandwidth()/w:0;if(T=t.axisType==="angleAxis"&&(o==null?void 0:o.length)>=2?Ys(o[0]-o[1])*2*T:T,r&&(t.ticks||t.niceTicks)){var I=(t.ticks||t.niceTicks).map(function(C){var R=d?d.indexOf(C):C;return{coordinate:c(R)+T,value:C,offset:T}});return I.filter(function(C){return!q1(C.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(C,R){return{coordinate:c(C)+T,value:C,index:R,offset:T}}):c.ticks&&!i?c.ticks(t.tickCount).map(function(C){return{coordinate:c(C)+T,value:C,offset:T}}):c.domain().map(function(C,R){return{coordinate:c(C)+T,value:d?d[C]:C,index:R,offset:T}})},WI=new WeakMap,jS=function(t,r){if(typeof r!="function")return t;WI.has(t)||WI.set(t,new WeakMap);var i=WI.get(t);if(i.has(r))return i.get(r);var c=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return i.set(r,c),c},$7=function(t,r,i){var c=t.scale,d=t.type,g=t.layout,o=t.axisType;if(c==="auto")return g==="radial"&&o==="radiusAxis"?{scale:Qx(),realScaleType:"band"}:g==="radial"&&o==="angleAxis"?{scale:hE(),realScaleType:"linear"}:d==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!i)?{scale:px(),realScaleType:"point"}:d==="category"?{scale:Qx(),realScaleType:"band"}:{scale:hE(),realScaleType:"linear"};if(W1(c)){var w="scale".concat(q2(c));return{scale:(b$[w]||px)(),realScaleType:b$[w]?w:"point"}}return An(c)?{scale:c}:{scale:px(),realScaleType:"point"}},I$=1e-4,U7=function(t){var r=t.domain();if(!(!r||r.length<=2)){var i=r.length,c=t.range(),d=Math.min(c[0],c[1])-I$,g=Math.max(c[0],c[1])+I$,o=t(r[0]),w=t(r[i-1]);(o<d||o>g||w<d||w>g)&&t.domain([r[0],r[i-1]])}},mCe=function(t,r){if(!t)return null;for(var i=0,c=t.length;i<c;i++)if(t[i].item===r)return t[i].position;return null},gCe=function(t,r){if(!r||r.length!==2||!gr(r[0])||!gr(r[1]))return t;var i=Math.min(r[0],r[1]),c=Math.max(r[0],r[1]),d=[t[0],t[1]];return(!gr(t[0])||t[0]<i)&&(d[0]=i),(!gr(t[1])||t[1]>c)&&(d[1]=c),d[0]>c&&(d[0]=c),d[1]<i&&(d[1]=i),d},_Ce=function(t){var r=t.length;if(!(r<=0))for(var i=0,c=t[0].length;i<c;++i)for(var d=0,g=0,o=0;o<r;++o){var w=q1(t[o][i][1])?t[o][i][0]:t[o][i][1];w>=0?(t[o][i][0]=d,t[o][i][1]=d+w,d=t[o][i][1]):(t[o][i][0]=g,t[o][i][1]=g+w,g=t[o][i][1])}},yCe=function(t){var r=t.length;if(!(r<=0))for(var i=0,c=t[0].length;i<c;++i)for(var d=0,g=0;g<r;++g){var o=q1(t[g][i][1])?t[g][i][0]:t[g][i][1];o>=0?(t[g][i][0]=d,t[g][i][1]=d+o,d=t[g][i][1]):(t[g][i][0]=0,t[g][i][1]=0)}},vCe={sign:_Ce,expand:j_e,none:j_,silhouette:F_e,wiggle:B_e,positive:yCe},xCe=function(t,r,i){var c=r.map(function(o){return o.props.dataKey}),d=vCe[i],g=N_e().keys(c).value(function(o,w){return+Ls(o,w,0)}).order(MM).offset(d);return g(t)},bCe=function(t,r,i,c,d,g){if(!t)return null;var o=g?r.reverse():r,w={},T=o.reduce(function(C,R){var F,G=(F=R.type)!==null&&F!==void 0&&F.defaultProps?vo(vo({},R.type.defaultProps),R.props):R.props,j=G.stackId,H=G.hide;if(H)return C;var X=G[i],q=C[X]||{hasStack:!1,stackGroups:{}};if(Wo(j)){var Z=q.stackGroups[j]||{numericAxisId:i,cateAxisId:c,items:[]};Z.items.push(R),q.hasStack=!0,q.stackGroups[j]=Z}else q.stackGroups[Z1("_stackId_")]={numericAxisId:i,cateAxisId:c,items:[R]};return vo(vo({},C),{},g_({},X,q))},w),I={};return Object.keys(T).reduce(function(C,R){var F=T[R];if(F.hasStack){var G={};F.stackGroups=Object.keys(F.stackGroups).reduce(function(j,H){var X=F.stackGroups[H];return vo(vo({},j),{},g_({},H,{numericAxisId:i,cateAxisId:c,items:X.items,stackedData:xCe(t,X.items,d)}))},G)}return vo(vo({},C),{},g_({},R,F))},I)},V7=function(t,r){var i=r.realScaleType,c=r.type,d=r.tickCount,g=r.originalDomain,o=r.allowDecimals,w=i||r.scale;if(w!=="auto"&&w!=="linear")return null;if(d&&c==="number"&&g&&(g[0]==="auto"||g[1]==="auto")){var T=t.domain();if(!T.length)return null;var I=LPe(T,d,o);return t.domain([cA(I),lA(I)]),{niceTicks:I}}if(d&&c==="number"){var C=t.domain(),R=zPe(C,d,o);return{niceTicks:R}}return null},O$=function(t){var r=t.axis,i=t.ticks,c=t.offset,d=t.bandSize,g=t.entry,o=t.index;if(r.type==="category")return i[o]?i[o].coordinate+c:null;var w=Ls(g,r.dataKey,r.domain[o]);return ni(w)?null:r.scale(w)-d/2+c},wCe=function(t){var r=t.numericAxis,i=r.scale.domain();if(r.type==="number"){var c=Math.min(i[0],i[1]),d=Math.max(i[0],i[1]);return c<=0&&d>=0?0:d<0?d:c}return i[0]},SCe=function(t,r){var i,c=(i=t.type)!==null&&i!==void 0&&i.defaultProps?vo(vo({},t.type.defaultProps),t.props):t.props,d=c.stackId;if(Wo(d)){var g=r[d];if(g){var o=g.items.indexOf(t);return o>=0?g.stackedData[o]:null}}return null},TCe=function(t){return t.reduce(function(r,i){return[cA(i.concat([r[0]]).filter(gr)),lA(i.concat([r[1]]).filter(gr))]},[1/0,-1/0])},G7=function(t,r,i){return Object.keys(t).reduce(function(c,d){var g=t[d],o=g.stackedData,w=o.reduce(function(T,I){var C=TCe(I.slice(r,i+1));return[Math.min(T[0],C[0]),Math.max(T[1],C[1])]},[1/0,-1/0]);return[Math.min(w[0],c[0]),Math.max(w[1],c[1])]},[1/0,-1/0]).map(function(c){return c===1/0||c===-1/0?0:c})},M$=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,R$=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,aR=function(t,r,i){if(An(t))return t(r,i);if(!Array.isArray(t))return r;var c=[];if(gr(t[0]))c[0]=i?t[0]:Math.min(t[0],r[0]);else if(M$.test(t[0])){var d=+M$.exec(t[0])[1];c[0]=r[0]-d}else An(t[0])?c[0]=t[0](r[0]):c[0]=r[0];if(gr(t[1]))c[1]=i?t[1]:Math.max(t[1],r[1]);else if(R$.test(t[1])){var g=+R$.exec(t[1])[1];c[1]=r[1]+g}else An(t[1])?c[1]=t[1](r[1]):c[1]=r[1];return c},yE=function(t,r,i){if(t&&t.scale&&t.scale.bandwidth){var c=t.scale.bandwidth();if(!i||c>0)return c}if(t&&r&&r.length>=2){for(var d=aL(r,function(C){return C.coordinate}),g=1/0,o=1,w=d.length;o<w;o++){var T=d[o],I=d[o-1];g=Math.min((T.coordinate||0)-(I.coordinate||0),g)}return g===1/0?0:g}return i?void 0:0},k$=function(t,r,i){return!t||!t.length||uA(t,Va(i,"type.defaultProps.domain"))?r:t},H7=function(t,r){var i=t.type.defaultProps?vo(vo({},t.type.defaultProps),t.props):t.props,c=i.dataKey,d=i.name,g=i.unit,o=i.formatter,w=i.tooltipType,T=i.chartType,I=i.hide;return vo(vo({},hn(t,!1)),{},{dataKey:c,unit:g,formatter:o,name:d||c,color:kL(t),value:Ls(r,c),type:w,payload:r,chartType:T,hide:I})};function l1(e){"@babel/helpers - typeof";return l1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l1(e)}function D$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function zu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D$(Object(r),!0).forEach(function(i){W7(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function W7(e,t,r){return t=ECe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ECe(e){var t=ACe(e,"string");return l1(t)=="symbol"?t:t+""}function ACe(e,t){if(l1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(l1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function PCe(e,t){return MCe(e)||OCe(e,t)||ICe(e,t)||CCe()}function CCe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ICe(e,t){if(e){if(typeof e=="string")return L$(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return L$(e,t)}}function L$(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function OCe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function MCe(e){if(Array.isArray(e))return e}var vE=Math.PI/180,RCe=function(t){return t*180/Math.PI},Yi=function(t,r,i,c){return{x:t+Math.cos(-vE*c)*i,y:r+Math.sin(-vE*c)*i}},q7=function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{top:0,right:0,bottom:0,left:0};return Math.min(Math.abs(t-(i.left||0)-(i.right||0)),Math.abs(r-(i.top||0)-(i.bottom||0)))/2},kCe=function(t,r,i,c,d){var g=t.width,o=t.height,w=t.startAngle,T=t.endAngle,I=Js(t.cx,g,g/2),C=Js(t.cy,o,o/2),R=q7(g,o,i),F=Js(t.innerRadius,R,0),G=Js(t.outerRadius,R,R*.8),j=Object.keys(r);return j.reduce(function(H,X){var q=r[X],Z=q.domain,J=q.reversed,ne;if(ni(q.range))c==="angleAxis"?ne=[w,T]:c==="radiusAxis"&&(ne=[F,G]),J&&(ne=[ne[1],ne[0]]);else{ne=q.range;var he=ne,me=PCe(he,2);w=me[0],T=me[1]}var Se=$7(q,d),qe=Se.realScaleType,Ze=Se.scale;Ze.domain(Z).range(ne),U7(Ze);var He=V7(Ze,zu(zu({},q),{},{realScaleType:qe})),Ke=zu(zu(zu({},q),He),{},{range:ne,radius:G,realScaleType:qe,scale:Ze,cx:I,cy:C,innerRadius:F,outerRadius:G,startAngle:w,endAngle:T});return zu(zu({},H),{},W7({},X,Ke))},{})},DCe=function(t,r){var i=t.x,c=t.y,d=r.x,g=r.y;return Math.sqrt(Math.pow(i-d,2)+Math.pow(c-g,2))},LCe=function(t,r){var i=t.x,c=t.y,d=r.cx,g=r.cy,o=DCe({x:i,y:c},{x:d,y:g});if(o<=0)return{radius:o};var w=(i-d)/o,T=Math.acos(w);return c>g&&(T=2*Math.PI-T),{radius:o,angle:RCe(T),angleInRadian:T}},zCe=function(t){var r=t.startAngle,i=t.endAngle,c=Math.floor(r/360),d=Math.floor(i/360),g=Math.min(c,d);return{startAngle:r-g*360,endAngle:i-g*360}},NCe=function(t,r){var i=r.startAngle,c=r.endAngle,d=Math.floor(i/360),g=Math.floor(c/360),o=Math.min(d,g);return t+o*360},z$=function(t,r){var i=t.x,c=t.y,d=LCe({x:i,y:c},r),g=d.radius,o=d.angle,w=r.innerRadius,T=r.outerRadius;if(g<w||g>T)return!1;if(g===0)return!0;var I=zCe(r),C=I.startAngle,R=I.endAngle,F=o,G;if(C<=R){for(;F>R;)F-=360;for(;F<C;)F+=360;G=F>=C&&F<=R}else{for(;F>C;)F-=360;for(;F<R;)F+=360;G=F>=R&&F<=C}return G?zu(zu({},r),{},{radius:g,angle:NCe(F,r)}):null},Z7=function(t){return!Q.isValidElement(t)&&!An(t)&&typeof t!="boolean"?t.className:""};function c1(e){"@babel/helpers - typeof";return c1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c1(e)}var jCe=["offset"];function FCe(e){return VCe(e)||UCe(e)||$Ce(e)||BCe()}function BCe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $Ce(e,t){if(e){if(typeof e=="string")return lR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lR(e,t)}}function UCe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function VCe(e){if(Array.isArray(e))return lR(e)}function lR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function GCe(e,t){if(e==null)return{};var r=HCe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function HCe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function N$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Uo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N$(Object(r),!0).forEach(function(i){WCe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function WCe(e,t,r){return t=qCe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qCe(e){var t=ZCe(e,"string");return c1(t)=="symbol"?t:t+""}function ZCe(e,t){if(c1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(c1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function u1(){return u1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},u1.apply(this,arguments)}var XCe=function(t){var r=t.value,i=t.formatter,c=ni(t.children)?r:t.children;return An(i)?i(c):c},KCe=function(t,r){var i=Ys(r-t),c=Math.min(Math.abs(r-t),360);return i*c},YCe=function(t,r,i){var c=t.position,d=t.viewBox,g=t.offset,o=t.className,w=d,T=w.cx,I=w.cy,C=w.innerRadius,R=w.outerRadius,F=w.startAngle,G=w.endAngle,j=w.clockWise,H=(C+R)/2,X=KCe(F,G),q=X>=0?1:-1,Z,J;c==="insideStart"?(Z=F+q*g,J=j):c==="insideEnd"?(Z=G-q*g,J=!j):c==="end"&&(Z=G+q*g,J=j),J=X<=0?J:!J;var ne=Yi(T,I,H,Z),he=Yi(T,I,H,Z+(J?1:-1)*359),me="M".concat(ne.x,",").concat(ne.y,`
    A`).concat(H,",").concat(H,",0,1,").concat(J?0:1,`,
    `).concat(he.x,",").concat(he.y),Se=ni(t.id)?Z1("recharts-radial-line-"):t.id;return De.createElement("text",u1({},i,{dominantBaseline:"central",className:Gn("recharts-radial-bar-label",o)}),De.createElement("defs",null,De.createElement("path",{id:Se,d:me})),De.createElement("textPath",{xlinkHref:"#".concat(Se)},r))},JCe=function(t){var r=t.viewBox,i=t.offset,c=t.position,d=r,g=d.cx,o=d.cy,w=d.innerRadius,T=d.outerRadius,I=d.startAngle,C=d.endAngle,R=(I+C)/2;if(c==="outside"){var F=Yi(g,o,T+i,R),G=F.x,j=F.y;return{x:G,y:j,textAnchor:G>=g?"start":"end",verticalAnchor:"middle"}}if(c==="center")return{x:g,y:o,textAnchor:"middle",verticalAnchor:"middle"};if(c==="centerTop")return{x:g,y:o,textAnchor:"middle",verticalAnchor:"start"};if(c==="centerBottom")return{x:g,y:o,textAnchor:"middle",verticalAnchor:"end"};var H=(w+T)/2,X=Yi(g,o,H,R),q=X.x,Z=X.y;return{x:q,y:Z,textAnchor:"middle",verticalAnchor:"middle"}},QCe=function(t){var r=t.viewBox,i=t.parentViewBox,c=t.offset,d=t.position,g=r,o=g.x,w=g.y,T=g.width,I=g.height,C=I>=0?1:-1,R=C*c,F=C>0?"end":"start",G=C>0?"start":"end",j=T>=0?1:-1,H=j*c,X=j>0?"end":"start",q=j>0?"start":"end";if(d==="top"){var Z={x:o+T/2,y:w-C*c,textAnchor:"middle",verticalAnchor:F};return Uo(Uo({},Z),i?{height:Math.max(w-i.y,0),width:T}:{})}if(d==="bottom"){var J={x:o+T/2,y:w+I+R,textAnchor:"middle",verticalAnchor:G};return Uo(Uo({},J),i?{height:Math.max(i.y+i.height-(w+I),0),width:T}:{})}if(d==="left"){var ne={x:o-H,y:w+I/2,textAnchor:X,verticalAnchor:"middle"};return Uo(Uo({},ne),i?{width:Math.max(ne.x-i.x,0),height:I}:{})}if(d==="right"){var he={x:o+T+H,y:w+I/2,textAnchor:q,verticalAnchor:"middle"};return Uo(Uo({},he),i?{width:Math.max(i.x+i.width-he.x,0),height:I}:{})}var me=i?{width:T,height:I}:{};return d==="insideLeft"?Uo({x:o+H,y:w+I/2,textAnchor:q,verticalAnchor:"middle"},me):d==="insideRight"?Uo({x:o+T-H,y:w+I/2,textAnchor:X,verticalAnchor:"middle"},me):d==="insideTop"?Uo({x:o+T/2,y:w+R,textAnchor:"middle",verticalAnchor:G},me):d==="insideBottom"?Uo({x:o+T/2,y:w+I-R,textAnchor:"middle",verticalAnchor:F},me):d==="insideTopLeft"?Uo({x:o+H,y:w+R,textAnchor:q,verticalAnchor:G},me):d==="insideTopRight"?Uo({x:o+T-H,y:w+R,textAnchor:X,verticalAnchor:G},me):d==="insideBottomLeft"?Uo({x:o+H,y:w+I-R,textAnchor:q,verticalAnchor:F},me):d==="insideBottomRight"?Uo({x:o+T-H,y:w+I-R,textAnchor:X,verticalAnchor:F},me):by(d)&&(gr(d.x)||Ep(d.x))&&(gr(d.y)||Ep(d.y))?Uo({x:o+Js(d.x,T),y:w+Js(d.y,I),textAnchor:"end",verticalAnchor:"end"},me):Uo({x:o+T/2,y:w+I/2,textAnchor:"middle",verticalAnchor:"middle"},me)},eIe=function(t){return"cx"in t&&gr(t.cx)};function os(e){var t=e.offset,r=t===void 0?5:t,i=GCe(e,jCe),c=Uo({offset:r},i),d=c.viewBox,g=c.position,o=c.value,w=c.children,T=c.content,I=c.className,C=I===void 0?"":I,R=c.textBreakAll;if(!d||ni(o)&&ni(w)&&!Q.isValidElement(T)&&!An(T))return null;if(Q.isValidElement(T))return Q.cloneElement(T,c);var F;if(An(T)){if(F=Q.createElement(T,c),Q.isValidElement(F))return F}else F=XCe(c);var G=eIe(d),j=hn(c,!0);if(G&&(g==="insideStart"||g==="insideEnd"||g==="end"))return YCe(c,F,j);var H=G?JCe(c):QCe(c);return De.createElement(Xp,u1({className:Gn("recharts-label",C)},j,H,{breakAll:R}),F)}os.displayName="Label";var X7=function(t){var r=t.cx,i=t.cy,c=t.angle,d=t.startAngle,g=t.endAngle,o=t.r,w=t.radius,T=t.innerRadius,I=t.outerRadius,C=t.x,R=t.y,F=t.top,G=t.left,j=t.width,H=t.height,X=t.clockWise,q=t.labelViewBox;if(q)return q;if(gr(j)&&gr(H)){if(gr(C)&&gr(R))return{x:C,y:R,width:j,height:H};if(gr(F)&&gr(G))return{x:F,y:G,width:j,height:H}}return gr(C)&&gr(R)?{x:C,y:R,width:0,height:0}:gr(r)&&gr(i)?{cx:r,cy:i,startAngle:d||c||0,endAngle:g||c||0,innerRadius:T||0,outerRadius:I||w||o||0,clockWise:X}:t.viewBox?t.viewBox:{}},tIe=function(t,r){return t?t===!0?De.createElement(os,{key:"label-implicit",viewBox:r}):Wo(t)?De.createElement(os,{key:"label-implicit",viewBox:r,value:t}):Q.isValidElement(t)?t.type===os?Q.cloneElement(t,{key:"label-implicit",viewBox:r}):De.createElement(os,{key:"label-implicit",content:t,viewBox:r}):An(t)?De.createElement(os,{key:"label-implicit",content:t,viewBox:r}):by(t)?De.createElement(os,u1({viewBox:r},t,{key:"label-implicit"})):null:null},rIe=function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&i&&!t.label)return null;var c=t.children,d=X7(t),g=ml(c,os).map(function(w,T){return Q.cloneElement(w,{viewBox:r||d,key:"label-".concat(T)})});if(!i)return g;var o=tIe(t.label,r||d);return[o].concat(FCe(g))};os.parseViewBox=X7;os.renderCallByParent=rIe;function nIe(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var iIe=nIe;const oIe=Ii(iIe);function h1(e){"@babel/helpers - typeof";return h1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h1(e)}var sIe=["valueAccessor"],aIe=["data","dataKey","clockWise","id","textBreakAll"];function lIe(e){return dIe(e)||hIe(e)||uIe(e)||cIe()}function cIe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uIe(e,t){if(e){if(typeof e=="string")return cR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cR(e,t)}}function hIe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function dIe(e){if(Array.isArray(e))return cR(e)}function cR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function xE(){return xE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},xE.apply(this,arguments)}function j$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function F$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j$(Object(r),!0).forEach(function(i){fIe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function fIe(e,t,r){return t=pIe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pIe(e){var t=mIe(e,"string");return h1(t)=="symbol"?t:t+""}function mIe(e,t){if(h1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(h1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function B$(e,t){if(e==null)return{};var r=gIe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function gIe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}var _Ie=function(t){return Array.isArray(t.value)?oIe(t.value):t.value};function Dd(e){var t=e.valueAccessor,r=t===void 0?_Ie:t,i=B$(e,sIe),c=i.data,d=i.dataKey,g=i.clockWise,o=i.id,w=i.textBreakAll,T=B$(i,aIe);return!c||!c.length?null:De.createElement(Li,{className:"recharts-label-list"},c.map(function(I,C){var R=ni(d)?r(I,C):Ls(I&&I.payload,d),F=ni(o)?{}:{id:"".concat(o,"-").concat(C)};return De.createElement(os,xE({},hn(I,!0),T,F,{parentViewBox:I.parentViewBox,value:R,textBreakAll:w,viewBox:os.parseViewBox(ni(g)?I:F$(F$({},I),{},{clockWise:g})),key:"label-".concat(C),index:C}))}))}Dd.displayName="LabelList";function yIe(e,t){return e?e===!0?De.createElement(Dd,{key:"labelList-implicit",data:t}):De.isValidElement(e)||An(e)?De.createElement(Dd,{key:"labelList-implicit",data:t,content:e}):by(e)?De.createElement(Dd,xE({data:t},e,{key:"labelList-implicit"})):null:null}function vIe(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var i=e.children,c=ml(i,Dd).map(function(g,o){return Q.cloneElement(g,{data:t,key:"labelList-".concat(o)})});if(!r)return c;var d=yIe(e.label,t);return[d].concat(lIe(c))}Dd.renderCallByParent=vIe;function d1(e){"@babel/helpers - typeof";return d1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d1(e)}function uR(){return uR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},uR.apply(this,arguments)}function $$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function U$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$$(Object(r),!0).forEach(function(i){xIe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xIe(e,t,r){return t=bIe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bIe(e){var t=wIe(e,"string");return d1(t)=="symbol"?t:t+""}function wIe(e,t){if(d1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(d1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var SIe=function(t,r){var i=Ys(r-t),c=Math.min(Math.abs(r-t),359.999);return i*c},FS=function(t){var r=t.cx,i=t.cy,c=t.radius,d=t.angle,g=t.sign,o=t.isExternal,w=t.cornerRadius,T=t.cornerIsExternal,I=w*(o?1:-1)+c,C=Math.asin(w/I)/vE,R=T?d:d+g*C,F=Yi(r,i,I,R),G=Yi(r,i,c,R),j=T?d-g*C:d,H=Yi(r,i,I*Math.cos(C*vE),j);return{center:F,circleTangency:G,lineTangency:H,theta:C}},K7=function(t){var r=t.cx,i=t.cy,c=t.innerRadius,d=t.outerRadius,g=t.startAngle,o=t.endAngle,w=SIe(g,o),T=g+w,I=Yi(r,i,d,g),C=Yi(r,i,d,T),R="M ".concat(I.x,",").concat(I.y,`
    A `).concat(d,",").concat(d,`,0,
    `).concat(+(Math.abs(w)>180),",").concat(+(g>T),`,
    `).concat(C.x,",").concat(C.y,`
  `);if(c>0){var F=Yi(r,i,c,g),G=Yi(r,i,c,T);R+="L ".concat(G.x,",").concat(G.y,`
            A `).concat(c,",").concat(c,`,0,
            `).concat(+(Math.abs(w)>180),",").concat(+(g<=T),`,
            `).concat(F.x,",").concat(F.y," Z")}else R+="L ".concat(r,",").concat(i," Z");return R},TIe=function(t){var r=t.cx,i=t.cy,c=t.innerRadius,d=t.outerRadius,g=t.cornerRadius,o=t.forceCornerRadius,w=t.cornerIsExternal,T=t.startAngle,I=t.endAngle,C=Ys(I-T),R=FS({cx:r,cy:i,radius:d,angle:T,sign:C,cornerRadius:g,cornerIsExternal:w}),F=R.circleTangency,G=R.lineTangency,j=R.theta,H=FS({cx:r,cy:i,radius:d,angle:I,sign:-C,cornerRadius:g,cornerIsExternal:w}),X=H.circleTangency,q=H.lineTangency,Z=H.theta,J=w?Math.abs(T-I):Math.abs(T-I)-j-Z;if(J<0)return o?"M ".concat(G.x,",").concat(G.y,`
        a`).concat(g,",").concat(g,",0,0,1,").concat(g*2,`,0
        a`).concat(g,",").concat(g,",0,0,1,").concat(-g*2,`,0
      `):K7({cx:r,cy:i,innerRadius:c,outerRadius:d,startAngle:T,endAngle:I});var ne="M ".concat(G.x,",").concat(G.y,`
    A`).concat(g,",").concat(g,",0,0,").concat(+(C<0),",").concat(F.x,",").concat(F.y,`
    A`).concat(d,",").concat(d,",0,").concat(+(J>180),",").concat(+(C<0),",").concat(X.x,",").concat(X.y,`
    A`).concat(g,",").concat(g,",0,0,").concat(+(C<0),",").concat(q.x,",").concat(q.y,`
  `);if(c>0){var he=FS({cx:r,cy:i,radius:c,angle:T,sign:C,isExternal:!0,cornerRadius:g,cornerIsExternal:w}),me=he.circleTangency,Se=he.lineTangency,qe=he.theta,Ze=FS({cx:r,cy:i,radius:c,angle:I,sign:-C,isExternal:!0,cornerRadius:g,cornerIsExternal:w}),He=Ze.circleTangency,Ke=Ze.lineTangency,dt=Ze.theta,$e=w?Math.abs(T-I):Math.abs(T-I)-qe-dt;if($e<0&&g===0)return"".concat(ne,"L").concat(r,",").concat(i,"Z");ne+="L".concat(Ke.x,",").concat(Ke.y,`
      A`).concat(g,",").concat(g,",0,0,").concat(+(C<0),",").concat(He.x,",").concat(He.y,`
      A`).concat(c,",").concat(c,",0,").concat(+($e>180),",").concat(+(C>0),",").concat(me.x,",").concat(me.y,`
      A`).concat(g,",").concat(g,",0,0,").concat(+(C<0),",").concat(Se.x,",").concat(Se.y,"Z")}else ne+="L".concat(r,",").concat(i,"Z");return ne},EIe={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},Y7=function(t){var r=U$(U$({},EIe),t),i=r.cx,c=r.cy,d=r.innerRadius,g=r.outerRadius,o=r.cornerRadius,w=r.forceCornerRadius,T=r.cornerIsExternal,I=r.startAngle,C=r.endAngle,R=r.className;if(g<d||I===C)return null;var F=Gn("recharts-sector",R),G=g-d,j=Js(o,G,0,!0),H;return j>0&&Math.abs(I-C)<360?H=TIe({cx:i,cy:c,innerRadius:d,outerRadius:g,cornerRadius:Math.min(j,G/2),forceCornerRadius:w,cornerIsExternal:T,startAngle:I,endAngle:C}):H=K7({cx:i,cy:c,innerRadius:d,outerRadius:g,startAngle:I,endAngle:C}),De.createElement("path",uR({},hn(r,!0),{className:F,d:H,role:"img"}))};function f1(e){"@babel/helpers - typeof";return f1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f1(e)}function hR(){return hR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},hR.apply(this,arguments)}function V$(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function G$(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V$(Object(r),!0).forEach(function(i){AIe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V$(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function AIe(e,t,r){return t=PIe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PIe(e){var t=CIe(e,"string");return f1(t)=="symbol"?t:t+""}function CIe(e,t){if(f1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(f1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var H$={curveBasisClosed:A_e,curveBasisOpen:P_e,curveBasis:E_e,curveBumpX:h_e,curveBumpY:d_e,curveLinearClosed:C_e,curveLinear:X2,curveMonotoneX:I_e,curveMonotoneY:O_e,curveNatural:M_e,curveStep:R_e,curveStepAfter:D_e,curveStepBefore:k_e},BS=function(t){return t.x===+t.x&&t.y===+t.y},j0=function(t){return t.x},F0=function(t){return t.y},IIe=function(t,r){if(An(t))return t;var i="curve".concat(q2(t));return(i==="curveMonotone"||i==="curveBump")&&r?H$["".concat(i).concat(r==="vertical"?"Y":"X")]:H$[i]||X2},OIe=function(t){var r=t.type,i=r===void 0?"linear":r,c=t.points,d=c===void 0?[]:c,g=t.baseLine,o=t.layout,w=t.connectNulls,T=w===void 0?!1:w,I=IIe(i,o),C=T?d.filter(function(j){return BS(j)}):d,R;if(Array.isArray(g)){var F=T?g.filter(function(j){return BS(j)}):g,G=C.map(function(j,H){return G$(G$({},j),{},{base:F[H]})});return o==="vertical"?R=OS().y(F0).x1(j0).x0(function(j){return j.base.x}):R=OS().x(j0).y1(F0).y0(function(j){return j.base.y}),R.defined(BS).curve(I),R(G)}return o==="vertical"&&gr(g)?R=OS().y(F0).x1(j0).x0(g):gr(g)?R=OS().x(j0).y1(F0).y0(g):R=Hq().x(j0).y(F0),R.defined(BS).curve(I),R(C)},dR=function(t){var r=t.className,i=t.points,c=t.path,d=t.pathRef;if((!i||!i.length)&&!c)return null;var g=i&&i.length?OIe(t):c;return De.createElement("path",hR({},hn(t,!1),HT(t),{className:Gn("recharts-curve",r),d:g,ref:d}))},J7={exports:{}},MIe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",RIe=MIe,kIe=RIe;function Q7(){}function eZ(){}eZ.resetWarningCache=Q7;var DIe=function(){function e(i,c,d,g,o,w){if(w!==kIe){var T=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw T.name="Invariant Violation",T}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:eZ,resetWarningCache:Q7};return r.PropTypes=r,r};J7.exports=DIe();var LIe=J7.exports;const Ln=Ii(LIe);var zIe=Object.getOwnPropertyNames,NIe=Object.getOwnPropertySymbols,jIe=Object.prototype.hasOwnProperty;function W$(e,t){return function(i,c,d){return e(i,c,d)&&t(i,c,d)}}function $S(e){return function(r,i,c){if(!r||!i||typeof r!="object"||typeof i!="object")return e(r,i,c);var d=c.cache,g=d.get(r),o=d.get(i);if(g&&o)return g===i&&o===r;d.set(r,i),d.set(i,r);var w=e(r,i,c);return d.delete(r),d.delete(i),w}}function q$(e){return zIe(e).concat(NIe(e))}var tZ=Object.hasOwn||function(e,t){return jIe.call(e,t)};function My(e,t){return e||t?e===t:e===t||e!==e&&t!==t}var rZ="_owner",Z$=Object.getOwnPropertyDescriptor,X$=Object.keys;function FIe(e,t,r){var i=e.length;if(t.length!==i)return!1;for(;i-- >0;)if(!r.equals(e[i],t[i],i,i,e,t,r))return!1;return!0}function BIe(e,t){return My(e.getTime(),t.getTime())}function K$(e,t,r){if(e.size!==t.size)return!1;for(var i={},c=e.entries(),d=0,g,o;(g=c.next())&&!g.done;){for(var w=t.entries(),T=!1,I=0;(o=w.next())&&!o.done;){var C=g.value,R=C[0],F=C[1],G=o.value,j=G[0],H=G[1];!T&&!i[I]&&(T=r.equals(R,j,d,I,e,t,r)&&r.equals(F,H,R,j,e,t,r))&&(i[I]=!0),I++}if(!T)return!1;d++}return!0}function $Ie(e,t,r){var i=X$(e),c=i.length;if(X$(t).length!==c)return!1;for(var d;c-- >0;)if(d=i[c],d===rZ&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof||!tZ(t,d)||!r.equals(e[d],t[d],d,d,e,t,r))return!1;return!0}function B0(e,t,r){var i=q$(e),c=i.length;if(q$(t).length!==c)return!1;for(var d,g,o;c-- >0;)if(d=i[c],d===rZ&&(e.$$typeof||t.$$typeof)&&e.$$typeof!==t.$$typeof||!tZ(t,d)||!r.equals(e[d],t[d],d,d,e,t,r)||(g=Z$(e,d),o=Z$(t,d),(g||o)&&(!g||!o||g.configurable!==o.configurable||g.enumerable!==o.enumerable||g.writable!==o.writable)))return!1;return!0}function UIe(e,t){return My(e.valueOf(),t.valueOf())}function VIe(e,t){return e.source===t.source&&e.flags===t.flags}function Y$(e,t,r){if(e.size!==t.size)return!1;for(var i={},c=e.values(),d,g;(d=c.next())&&!d.done;){for(var o=t.values(),w=!1,T=0;(g=o.next())&&!g.done;)!w&&!i[T]&&(w=r.equals(d.value,g.value,d.value,g.value,e,t,r))&&(i[T]=!0),T++;if(!w)return!1}return!0}function GIe(e,t){var r=e.length;if(t.length!==r)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}var HIe="[object Arguments]",WIe="[object Boolean]",qIe="[object Date]",ZIe="[object Map]",XIe="[object Number]",KIe="[object Object]",YIe="[object RegExp]",JIe="[object Set]",QIe="[object String]",eOe=Array.isArray,J$=typeof ArrayBuffer=="function"&&ArrayBuffer.isView?ArrayBuffer.isView:null,Q$=Object.assign,tOe=Object.prototype.toString.call.bind(Object.prototype.toString);function rOe(e){var t=e.areArraysEqual,r=e.areDatesEqual,i=e.areMapsEqual,c=e.areObjectsEqual,d=e.arePrimitiveWrappersEqual,g=e.areRegExpsEqual,o=e.areSetsEqual,w=e.areTypedArraysEqual;return function(I,C,R){if(I===C)return!0;if(I==null||C==null||typeof I!="object"||typeof C!="object")return I!==I&&C!==C;var F=I.constructor;if(F!==C.constructor)return!1;if(F===Object)return c(I,C,R);if(eOe(I))return t(I,C,R);if(J$!=null&&J$(I))return w(I,C,R);if(F===Date)return r(I,C,R);if(F===RegExp)return g(I,C,R);if(F===Map)return i(I,C,R);if(F===Set)return o(I,C,R);var G=tOe(I);return G===qIe?r(I,C,R):G===YIe?g(I,C,R):G===ZIe?i(I,C,R):G===JIe?o(I,C,R):G===KIe?typeof I.then!="function"&&typeof C.then!="function"&&c(I,C,R):G===HIe?c(I,C,R):G===WIe||G===XIe||G===QIe?d(I,C,R):!1}}function nOe(e){var t=e.circular,r=e.createCustomConfig,i=e.strict,c={areArraysEqual:i?B0:FIe,areDatesEqual:BIe,areMapsEqual:i?W$(K$,B0):K$,areObjectsEqual:i?B0:$Ie,arePrimitiveWrappersEqual:UIe,areRegExpsEqual:VIe,areSetsEqual:i?W$(Y$,B0):Y$,areTypedArraysEqual:i?B0:GIe};if(r&&(c=Q$({},c,r(c))),t){var d=$S(c.areArraysEqual),g=$S(c.areMapsEqual),o=$S(c.areObjectsEqual),w=$S(c.areSetsEqual);c=Q$({},c,{areArraysEqual:d,areMapsEqual:g,areObjectsEqual:o,areSetsEqual:w})}return c}function iOe(e){return function(t,r,i,c,d,g,o){return e(t,r,o)}}function oOe(e){var t=e.circular,r=e.comparator,i=e.createState,c=e.equals,d=e.strict;if(i)return function(w,T){var I=i(),C=I.cache,R=C===void 0?t?new WeakMap:void 0:C,F=I.meta;return r(w,T,{cache:R,equals:c,meta:F,strict:d})};if(t)return function(w,T){return r(w,T,{cache:new WeakMap,equals:c,meta:void 0,strict:d})};var g={cache:void 0,equals:c,meta:void 0,strict:d};return function(w,T){return r(w,T,g)}}var sOe=ef();ef({strict:!0});ef({circular:!0});ef({circular:!0,strict:!0});ef({createInternalComparator:function(){return My}});ef({strict:!0,createInternalComparator:function(){return My}});ef({circular:!0,createInternalComparator:function(){return My}});ef({circular:!0,createInternalComparator:function(){return My},strict:!0});function ef(e){e===void 0&&(e={});var t=e.circular,r=t===void 0?!1:t,i=e.createInternalComparator,c=e.createState,d=e.strict,g=d===void 0?!1:d,o=nOe(e),w=rOe(o),T=i?i(w):iOe(w);return oOe({circular:r,comparator:w,createState:c,equals:T,strict:g})}function aOe(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function eU(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,i=function c(d){r<0&&(r=d),d-r>t?(e(d),r=-1):aOe(c)};requestAnimationFrame(i)}function fR(e){"@babel/helpers - typeof";return fR=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fR(e)}function lOe(e){return dOe(e)||hOe(e)||uOe(e)||cOe()}function cOe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uOe(e,t){if(e){if(typeof e=="string")return tU(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return tU(e,t)}}function tU(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function hOe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function dOe(e){if(Array.isArray(e))return e}function fOe(){var e={},t=function(){return null},r=!1,i=function c(d){if(!r){if(Array.isArray(d)){if(!d.length)return;var g=d,o=lOe(g),w=o[0],T=o.slice(1);if(typeof w=="number"){eU(c.bind(null,T),w);return}c(w),eU(c.bind(null,T));return}fR(d)==="object"&&(e=d,t(e)),typeof d=="function"&&d()}};return{stop:function(){r=!0},start:function(d){r=!1,i(d)},subscribe:function(d){return t=d,function(){t=function(){return null}}}}}function p1(e){"@babel/helpers - typeof";return p1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p1(e)}function rU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function nU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rU(Object(r),!0).forEach(function(i){nZ(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function nZ(e,t,r){return t=pOe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pOe(e){var t=mOe(e,"string");return p1(t)==="symbol"?t:String(t)}function mOe(e,t){if(p1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(p1(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gOe=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(i,c){return i.filter(function(d){return c.includes(d)})})},_Oe=function(t){return t},yOe=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},gx=function(t,r){return Object.keys(r).reduce(function(i,c){return nU(nU({},i),{},nZ({},c,t(c,r[c])))},{})},iU=function(t,r,i){return t.map(function(c){return"".concat(yOe(c)," ").concat(r,"ms ").concat(i)}).join(",")};function vOe(e,t){return wOe(e)||bOe(e,t)||iZ(e,t)||xOe()}function xOe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bOe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function wOe(e){if(Array.isArray(e))return e}function SOe(e){return AOe(e)||EOe(e)||iZ(e)||TOe()}function TOe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iZ(e,t){if(e){if(typeof e=="string")return pR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pR(e,t)}}function EOe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function AOe(e){if(Array.isArray(e))return pR(e)}function pR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var bE=1e-4,oZ=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},sZ=function(t,r){return t.map(function(i,c){return i*Math.pow(r,c)}).reduce(function(i,c){return i+c})},oU=function(t,r){return function(i){var c=oZ(t,r);return sZ(c,i)}},POe=function(t,r){return function(i){var c=oZ(t,r),d=[].concat(SOe(c.map(function(g,o){return g*o}).slice(1)),[0]);return sZ(d,i)}},sU=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var c=r[0],d=r[1],g=r[2],o=r[3];if(r.length===1)switch(r[0]){case"linear":c=0,d=0,g=1,o=1;break;case"ease":c=.25,d=.1,g=.25,o=1;break;case"ease-in":c=.42,d=0,g=1,o=1;break;case"ease-out":c=.42,d=0,g=.58,o=1;break;case"ease-in-out":c=0,d=0,g=.58,o=1;break;default:{var w=r[0].split("(");if(w[0]==="cubic-bezier"&&w[1].split(")")[0].split(",").length===4){var T=w[1].split(")")[0].split(",").map(function(H){return parseFloat(H)}),I=vOe(T,4);c=I[0],d=I[1],g=I[2],o=I[3]}}}var C=oU(c,g),R=oU(d,o),F=POe(c,g),G=function(X){return X>1?1:X<0?0:X},j=function(X){for(var q=X>1?1:X,Z=q,J=0;J<8;++J){var ne=C(Z)-q,he=F(Z);if(Math.abs(ne-q)<bE||he<bE)return R(Z);Z=G(Z-ne/he)}return R(Z)};return j.isStepper=!1,j},COe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,i=r===void 0?100:r,c=t.damping,d=c===void 0?8:c,g=t.dt,o=g===void 0?17:g,w=function(I,C,R){var F=-(I-C)*i,G=R*d,j=R+(F-G)*o/1e3,H=R*o/1e3+I;return Math.abs(H-C)<bE&&Math.abs(j)<bE?[C,0]:[H,j]};return w.isStepper=!0,w.dt=o,w},IOe=function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];var c=r[0];if(typeof c=="string")switch(c){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return sU(c);case"spring":return COe();default:if(c.split("(")[0]==="cubic-bezier")return sU(c)}return typeof c=="function"?c:null};function m1(e){"@babel/helpers - typeof";return m1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m1(e)}function aU(e){return ROe(e)||MOe(e)||aZ(e)||OOe()}function OOe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MOe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function ROe(e){if(Array.isArray(e))return gR(e)}function lU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function ps(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lU(Object(r),!0).forEach(function(i){mR(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function mR(e,t,r){return t=kOe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function kOe(e){var t=DOe(e,"string");return m1(t)==="symbol"?t:String(t)}function DOe(e,t){if(m1(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(m1(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function LOe(e,t){return jOe(e)||NOe(e,t)||aZ(e,t)||zOe()}function zOe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aZ(e,t){if(e){if(typeof e=="string")return gR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gR(e,t)}}function gR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function NOe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function jOe(e){if(Array.isArray(e))return e}var wE=function(t,r,i){return t+(r-t)*i},_R=function(t){var r=t.from,i=t.to;return r!==i},FOe=function e(t,r,i){var c=gx(function(d,g){if(_R(g)){var o=t(g.from,g.to,g.velocity),w=LOe(o,2),T=w[0],I=w[1];return ps(ps({},g),{},{from:T,velocity:I})}return g},r);return i<1?gx(function(d,g){return _R(g)?ps(ps({},g),{},{velocity:wE(g.velocity,c[d].velocity,i),from:wE(g.from,c[d].from,i)}):g},r):e(t,c,i-1)};const BOe=function(e,t,r,i,c){var d=gOe(e,t),g=d.reduce(function(H,X){return ps(ps({},H),{},mR({},X,[e[X],t[X]]))},{}),o=d.reduce(function(H,X){return ps(ps({},H),{},mR({},X,{from:e[X],velocity:0,to:t[X]}))},{}),w=-1,T,I,C=function(){return null},R=function(){return gx(function(X,q){return q.from},o)},F=function(){return!Object.values(o).filter(_R).length},G=function(X){T||(T=X);var q=X-T,Z=q/r.dt;o=FOe(r,o,Z),c(ps(ps(ps({},e),t),R())),T=X,F()||(w=requestAnimationFrame(C))},j=function(X){I||(I=X);var q=(X-I)/i,Z=gx(function(ne,he){return wE.apply(void 0,aU(he).concat([r(q)]))},g);if(c(ps(ps(ps({},e),t),Z)),q<1)w=requestAnimationFrame(C);else{var J=gx(function(ne,he){return wE.apply(void 0,aU(he).concat([r(1)]))},g);c(ps(ps(ps({},e),t),J))}};return C=r.isStepper?G:j,function(){return requestAnimationFrame(C),function(){cancelAnimationFrame(w)}}};function q_(e){"@babel/helpers - typeof";return q_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q_(e)}var $Oe=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function UOe(e,t){if(e==null)return{};var r=VOe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function VOe(e,t){if(e==null)return{};var r={},i=Object.keys(e),c,d;for(d=0;d<i.length;d++)c=i[d],!(t.indexOf(c)>=0)&&(r[c]=e[c]);return r}function qI(e){return qOe(e)||WOe(e)||HOe(e)||GOe()}function GOe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HOe(e,t){if(e){if(typeof e=="string")return yR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yR(e,t)}}function WOe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function qOe(e){if(Array.isArray(e))return yR(e)}function yR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function cU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Hl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cU(Object(r),!0).forEach(function(i){Z0(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Z0(e,t,r){return t=lZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZOe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function XOe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,lZ(i.key),i)}}function KOe(e,t,r){return t&&XOe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function lZ(e){var t=YOe(e,"string");return q_(t)==="symbol"?t:String(t)}function YOe(e,t){if(q_(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(q_(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function JOe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vR(e,t)}function vR(e,t){return vR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},vR(e,t)}function QOe(e){var t=eMe();return function(){var i=SE(e),c;if(t){var d=SE(this).constructor;c=Reflect.construct(i,arguments,d)}else c=i.apply(this,arguments);return xR(this,c)}}function xR(e,t){if(t&&(q_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bR(e)}function bR(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eMe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function SE(e){return SE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},SE(e)}var rh=function(e){JOe(r,e);var t=QOe(r);function r(i,c){var d;ZOe(this,r),d=t.call(this,i,c);var g=d.props,o=g.isActive,w=g.attributeName,T=g.from,I=g.to,C=g.steps,R=g.children,F=g.duration;if(d.handleStyleChange=d.handleStyleChange.bind(bR(d)),d.changeStyle=d.changeStyle.bind(bR(d)),!o||F<=0)return d.state={style:{}},typeof R=="function"&&(d.state={style:I}),xR(d);if(C&&C.length)d.state={style:C[0].style};else if(T){if(typeof R=="function")return d.state={style:T},xR(d);d.state={style:w?Z0({},w,T):T}}else d.state={style:{}};return d}return KOe(r,[{key:"componentDidMount",value:function(){var c=this.props,d=c.isActive,g=c.canBegin;this.mounted=!0,!(!d||!g)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(c){var d=this.props,g=d.isActive,o=d.canBegin,w=d.attributeName,T=d.shouldReAnimate,I=d.to,C=d.from,R=this.state.style;if(o){if(!g){var F={style:w?Z0({},w,I):I};this.state&&R&&(w&&R[w]!==I||!w&&R!==I)&&this.setState(F);return}if(!(sOe(c.to,I)&&c.canBegin&&c.isActive)){var G=!c.canBegin||!c.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var j=G||T?C:c.to;if(this.state&&R){var H={style:w?Z0({},w,j):j};(w&&R[w]!==j||!w&&R!==j)&&this.setState(H)}this.runAnimation(Hl(Hl({},this.props),{},{from:j,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var c=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),c&&c()}},{key:"handleStyleChange",value:function(c){this.changeStyle(c)}},{key:"changeStyle",value:function(c){this.mounted&&this.setState({style:c})}},{key:"runJSAnimation",value:function(c){var d=this,g=c.from,o=c.to,w=c.duration,T=c.easing,I=c.begin,C=c.onAnimationEnd,R=c.onAnimationStart,F=BOe(g,o,IOe(T),w,this.changeStyle),G=function(){d.stopJSAnimation=F()};this.manager.start([R,I,G,w,C])}},{key:"runStepAnimation",value:function(c){var d=this,g=c.steps,o=c.begin,w=c.onAnimationStart,T=g[0],I=T.style,C=T.duration,R=C===void 0?0:C,F=function(j,H,X){if(X===0)return j;var q=H.duration,Z=H.easing,J=Z===void 0?"ease":Z,ne=H.style,he=H.properties,me=H.onAnimationEnd,Se=X>0?g[X-1]:H,qe=he||Object.keys(ne);if(typeof J=="function"||J==="spring")return[].concat(qI(j),[d.runJSAnimation.bind(d,{from:Se.style,to:ne,duration:q,easing:J}),q]);var Ze=iU(qe,q,J),He=Hl(Hl(Hl({},Se.style),ne),{},{transition:Ze});return[].concat(qI(j),[He,q,me]).filter(_Oe)};return this.manager.start([w].concat(qI(g.reduce(F,[I,Math.max(R,o)])),[c.onAnimationEnd]))}},{key:"runAnimation",value:function(c){this.manager||(this.manager=fOe());var d=c.begin,g=c.duration,o=c.attributeName,w=c.to,T=c.easing,I=c.onAnimationStart,C=c.onAnimationEnd,R=c.steps,F=c.children,G=this.manager;if(this.unSubscribe=G.subscribe(this.handleStyleChange),typeof T=="function"||typeof F=="function"||T==="spring"){this.runJSAnimation(c);return}if(R.length>1){this.runStepAnimation(c);return}var j=o?Z0({},o,w):w,H=iU(Object.keys(j),g,T);G.start([I,d,Hl(Hl({},j),{},{transition:H}),g,C])}},{key:"render",value:function(){var c=this.props,d=c.children;c.begin;var g=c.duration;c.attributeName,c.easing;var o=c.isActive;c.steps,c.from,c.to,c.canBegin,c.onAnimationEnd,c.shouldReAnimate,c.onAnimationReStart;var w=UOe(c,$Oe),T=Q.Children.count(d),I=this.state.style;if(typeof d=="function")return d(I);if(!o||T===0||g<=0)return d;var C=function(F){var G=F.props,j=G.style,H=j===void 0?{}:j,X=G.className,q=Q.cloneElement(F,Hl(Hl({},w),{},{style:Hl(Hl({},H),I),className:X}));return q};return T===1?C(Q.Children.only(d)):De.createElement("div",null,Q.Children.map(d,function(R){return C(R)}))}}]),r}(Q.PureComponent);rh.displayName="Animate";rh.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};rh.propTypes={from:Ln.oneOfType([Ln.object,Ln.string]),to:Ln.oneOfType([Ln.object,Ln.string]),attributeName:Ln.string,duration:Ln.number,begin:Ln.number,easing:Ln.oneOfType([Ln.string,Ln.func]),steps:Ln.arrayOf(Ln.shape({duration:Ln.number.isRequired,style:Ln.object.isRequired,easing:Ln.oneOfType([Ln.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Ln.func]),properties:Ln.arrayOf("string"),onAnimationEnd:Ln.func})),children:Ln.oneOfType([Ln.node,Ln.func]),isActive:Ln.bool,canBegin:Ln.bool,onAnimationEnd:Ln.func,shouldReAnimate:Ln.bool,onAnimationStart:Ln.func,onAnimationReStart:Ln.func};Ln.object,Ln.object,Ln.object,Ln.element;Ln.object,Ln.object,Ln.object,Ln.oneOfType([Ln.array,Ln.element]),Ln.any;function g1(e){"@babel/helpers - typeof";return g1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g1(e)}function TE(){return TE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},TE.apply(this,arguments)}function tMe(e,t){return oMe(e)||iMe(e,t)||nMe(e,t)||rMe()}function rMe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nMe(e,t){if(e){if(typeof e=="string")return uU(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return uU(e,t)}}function uU(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function iMe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function oMe(e){if(Array.isArray(e))return e}function hU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function dU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hU(Object(r),!0).forEach(function(i){sMe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function sMe(e,t,r){return t=aMe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aMe(e){var t=lMe(e,"string");return g1(t)=="symbol"?t:t+""}function lMe(e,t){if(g1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(g1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fU=function(t,r,i,c,d){var g=Math.min(Math.abs(i)/2,Math.abs(c)/2),o=c>=0?1:-1,w=i>=0?1:-1,T=c>=0&&i>=0||c<0&&i<0?1:0,I;if(g>0&&d instanceof Array){for(var C=[0,0,0,0],R=0,F=4;R<F;R++)C[R]=d[R]>g?g:d[R];I="M".concat(t,",").concat(r+o*C[0]),C[0]>0&&(I+="A ".concat(C[0],",").concat(C[0],",0,0,").concat(T,",").concat(t+w*C[0],",").concat(r)),I+="L ".concat(t+i-w*C[1],",").concat(r),C[1]>0&&(I+="A ".concat(C[1],",").concat(C[1],",0,0,").concat(T,`,
        `).concat(t+i,",").concat(r+o*C[1])),I+="L ".concat(t+i,",").concat(r+c-o*C[2]),C[2]>0&&(I+="A ".concat(C[2],",").concat(C[2],",0,0,").concat(T,`,
        `).concat(t+i-w*C[2],",").concat(r+c)),I+="L ".concat(t+w*C[3],",").concat(r+c),C[3]>0&&(I+="A ".concat(C[3],",").concat(C[3],",0,0,").concat(T,`,
        `).concat(t,",").concat(r+c-o*C[3])),I+="Z"}else if(g>0&&d===+d&&d>0){var G=Math.min(g,d);I="M ".concat(t,",").concat(r+o*G,`
            A `).concat(G,",").concat(G,",0,0,").concat(T,",").concat(t+w*G,",").concat(r,`
            L `).concat(t+i-w*G,",").concat(r,`
            A `).concat(G,",").concat(G,",0,0,").concat(T,",").concat(t+i,",").concat(r+o*G,`
            L `).concat(t+i,",").concat(r+c-o*G,`
            A `).concat(G,",").concat(G,",0,0,").concat(T,",").concat(t+i-w*G,",").concat(r+c,`
            L `).concat(t+w*G,",").concat(r+c,`
            A `).concat(G,",").concat(G,",0,0,").concat(T,",").concat(t,",").concat(r+c-o*G," Z")}else I="M ".concat(t,",").concat(r," h ").concat(i," v ").concat(c," h ").concat(-i," Z");return I},cMe=function(t,r){if(!t||!r)return!1;var i=t.x,c=t.y,d=r.x,g=r.y,o=r.width,w=r.height;if(Math.abs(o)>0&&Math.abs(w)>0){var T=Math.min(d,d+o),I=Math.max(d,d+o),C=Math.min(g,g+w),R=Math.max(g,g+w);return i>=T&&i<=I&&c>=C&&c<=R}return!1},uMe={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},DL=function(t){var r=dU(dU({},uMe),t),i=Q.useRef(),c=Q.useState(-1),d=tMe(c,2),g=d[0],o=d[1];Q.useEffect(function(){if(i.current&&i.current.getTotalLength)try{var J=i.current.getTotalLength();J&&o(J)}catch{}},[]);var w=r.x,T=r.y,I=r.width,C=r.height,R=r.radius,F=r.className,G=r.animationEasing,j=r.animationDuration,H=r.animationBegin,X=r.isAnimationActive,q=r.isUpdateAnimationActive;if(w!==+w||T!==+T||I!==+I||C!==+C||I===0||C===0)return null;var Z=Gn("recharts-rectangle",F);return q?De.createElement(rh,{canBegin:g>0,from:{width:I,height:C,x:w,y:T},to:{width:I,height:C,x:w,y:T},duration:j,animationEasing:G,isActive:q},function(J){var ne=J.width,he=J.height,me=J.x,Se=J.y;return De.createElement(rh,{canBegin:g>0,from:"0px ".concat(g===-1?1:g,"px"),to:"".concat(g,"px 0px"),attributeName:"strokeDasharray",begin:H,duration:j,isActive:X,easing:G},De.createElement("path",TE({},hn(r,!0),{className:Z,d:fU(me,Se,ne,he,R),ref:i})))}):De.createElement("path",TE({},hn(r,!0),{className:Z,d:fU(w,T,I,C,R)}))},hMe=["points","className","baseLinePoints","connectNulls"];function t_(){return t_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},t_.apply(this,arguments)}function dMe(e,t){if(e==null)return{};var r=fMe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function fMe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function pU(e){return _Me(e)||gMe(e)||mMe(e)||pMe()}function pMe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mMe(e,t){if(e){if(typeof e=="string")return wR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wR(e,t)}}function gMe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function _Me(e){if(Array.isArray(e))return wR(e)}function wR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var mU=function(t){return t&&t.x===+t.x&&t.y===+t.y},yMe=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=[[]];return t.forEach(function(i){mU(i)?r[r.length-1].push(i):r[r.length-1].length>0&&r.push([])}),mU(t[0])&&r[r.length-1].push(t[0]),r[r.length-1].length<=0&&(r=r.slice(0,-1)),r},_x=function(t,r){var i=yMe(t);r&&(i=[i.reduce(function(d,g){return[].concat(pU(d),pU(g))},[])]);var c=i.map(function(d){return d.reduce(function(g,o,w){return"".concat(g).concat(w===0?"M":"L").concat(o.x,",").concat(o.y)},"")}).join("");return i.length===1?"".concat(c,"Z"):c},vMe=function(t,r,i){var c=_x(t,i);return"".concat(c.slice(-1)==="Z"?c.slice(0,-1):c,"L").concat(_x(r.reverse(),i).slice(1))},xMe=function(t){var r=t.points,i=t.className,c=t.baseLinePoints,d=t.connectNulls,g=dMe(t,hMe);if(!r||!r.length)return null;var o=Gn("recharts-polygon",i);if(c&&c.length){var w=g.stroke&&g.stroke!=="none",T=vMe(r,c,d);return De.createElement("g",{className:o},De.createElement("path",t_({},hn(g,!0),{fill:T.slice(-1)==="Z"?g.fill:"none",stroke:"none",d:T})),w?De.createElement("path",t_({},hn(g,!0),{fill:"none",d:_x(r,d)})):null,w?De.createElement("path",t_({},hn(g,!0),{fill:"none",d:_x(c,d)})):null)}var I=_x(r,d);return De.createElement("path",t_({},hn(g,!0),{fill:I.slice(-1)==="Z"?g.fill:"none",className:o,d:I}))};function SR(){return SR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},SR.apply(this,arguments)}var LL=function(t){var r=t.cx,i=t.cy,c=t.r,d=t.className,g=Gn("recharts-dot",d);return r===+r&&i===+i&&c===+c?De.createElement("circle",SR({},hn(t,!1),HT(t),{className:g,cx:r,cy:i,r:c})):null};function _1(e){"@babel/helpers - typeof";return _1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_1(e)}var bMe=["x","y","top","left","width","height","className"];function TR(){return TR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},TR.apply(this,arguments)}function gU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function wMe(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gU(Object(r),!0).forEach(function(i){SMe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function SMe(e,t,r){return t=TMe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TMe(e){var t=EMe(e,"string");return _1(t)=="symbol"?t:t+""}function EMe(e,t){if(_1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(_1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function AMe(e,t){if(e==null)return{};var r=PMe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function PMe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}var CMe=function(t,r,i,c,d,g){return"M".concat(t,",").concat(d,"v").concat(c,"M").concat(g,",").concat(r,"h").concat(i)},IMe=function(t){var r=t.x,i=r===void 0?0:r,c=t.y,d=c===void 0?0:c,g=t.top,o=g===void 0?0:g,w=t.left,T=w===void 0?0:w,I=t.width,C=I===void 0?0:I,R=t.height,F=R===void 0?0:R,G=t.className,j=AMe(t,bMe),H=wMe({x:i,y:d,top:o,left:T,width:C,height:F},j);return!gr(i)||!gr(d)||!gr(C)||!gr(F)||!gr(o)||!gr(T)?null:De.createElement("path",TR({},hn(H,!0),{className:Gn("recharts-cross",G),d:CMe(i,d,C,F,o,T)}))},OMe=aA,MMe=v7,RMe=nu;function kMe(e,t){return e&&e.length?OMe(e,RMe(t),MMe):void 0}var DMe=kMe;const LMe=Ii(DMe);var zMe=aA,NMe=nu,jMe=x7;function FMe(e,t){return e&&e.length?zMe(e,NMe(t),jMe):void 0}var BMe=FMe;const $Me=Ii(BMe);var UMe=["cx","cy","angle","ticks","axisLine"],VMe=["ticks","tick","angle","tickFormatter","stroke"];function Z_(e){"@babel/helpers - typeof";return Z_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Z_(e)}function yx(){return yx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},yx.apply(this,arguments)}function _U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function dp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_U(Object(r),!0).forEach(function(i){pA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_U(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function yU(e,t){if(e==null)return{};var r=GMe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function GMe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function HMe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vU(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,uZ(i.key),i)}}function WMe(e,t,r){return t&&vU(e.prototype,t),r&&vU(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function qMe(e,t,r){return t=EE(t),ZMe(e,cZ()?Reflect.construct(t,r||[],EE(e).constructor):t.apply(e,r))}function ZMe(e,t){if(t&&(Z_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return XMe(e)}function XMe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(cZ=function(){return!!e})()}function EE(e){return EE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},EE(e)}function KMe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ER(e,t)}function ER(e,t){return ER=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},ER(e,t)}function pA(e,t,r){return t=uZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uZ(e){var t=YMe(e,"string");return Z_(t)=="symbol"?t:t+""}function YMe(e,t){if(Z_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Z_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var mA=function(e){function t(){return HMe(this,t),qMe(this,t,arguments)}return KMe(t,e),WMe(t,[{key:"getTickValueCoord",value:function(i){var c=i.coordinate,d=this.props,g=d.angle,o=d.cx,w=d.cy;return Yi(o,w,c,g)}},{key:"getTickTextAnchor",value:function(){var i=this.props.orientation,c;switch(i){case"left":c="end";break;case"right":c="start";break;default:c="middle";break}return c}},{key:"getViewBox",value:function(){var i=this.props,c=i.cx,d=i.cy,g=i.angle,o=i.ticks,w=LMe(o,function(I){return I.coordinate||0}),T=$Me(o,function(I){return I.coordinate||0});return{cx:c,cy:d,startAngle:g,endAngle:g,innerRadius:T.coordinate||0,outerRadius:w.coordinate||0}}},{key:"renderAxisLine",value:function(){var i=this.props,c=i.cx,d=i.cy,g=i.angle,o=i.ticks,w=i.axisLine,T=yU(i,UMe),I=o.reduce(function(G,j){return[Math.min(G[0],j.coordinate),Math.max(G[1],j.coordinate)]},[1/0,-1/0]),C=Yi(c,d,I[0],g),R=Yi(c,d,I[1],g),F=dp(dp(dp({},hn(T,!1)),{},{fill:"none"},hn(w,!1)),{},{x1:C.x,y1:C.y,x2:R.x,y2:R.y});return De.createElement("line",yx({className:"recharts-polar-radius-axis-line"},F))}},{key:"renderTicks",value:function(){var i=this,c=this.props,d=c.ticks,g=c.tick,o=c.angle,w=c.tickFormatter,T=c.stroke,I=yU(c,VMe),C=this.getTickTextAnchor(),R=hn(I,!1),F=hn(g,!1),G=d.map(function(j,H){var X=i.getTickValueCoord(j),q=dp(dp(dp(dp({textAnchor:C,transform:"rotate(".concat(90-o,", ").concat(X.x,", ").concat(X.y,")")},R),{},{stroke:"none",fill:T},F),{},{index:H},X),{},{payload:j});return De.createElement(Li,yx({className:Gn("recharts-polar-radius-axis-tick",Z7(g)),key:"tick-".concat(j.coordinate)},Zp(i.props,j,H)),t.renderTickItem(g,q,w?w(j.value,H):j.value))});return De.createElement(Li,{className:"recharts-polar-radius-axis-ticks"},G)}},{key:"render",value:function(){var i=this.props,c=i.ticks,d=i.axisLine,g=i.tick;return!c||!c.length?null:De.createElement(Li,{className:Gn("recharts-polar-radius-axis",this.props.className)},d&&this.renderAxisLine(),g&&this.renderTicks(),os.renderCallByParent(this.props,this.getViewBox()))}}],[{key:"renderTickItem",value:function(i,c,d){var g;return De.isValidElement(i)?g=De.cloneElement(i,c):An(i)?g=i(c):g=De.createElement(Xp,yx({},c,{className:"recharts-polar-radius-axis-tick-value"}),d),g}}])}(Q.PureComponent);pA(mA,"displayName","PolarRadiusAxis");pA(mA,"axisType","radiusAxis");pA(mA,"defaultProps",{type:"number",radiusAxisId:0,cx:0,cy:0,angle:0,orientation:"right",stroke:"#ccc",axisLine:!0,tick:!0,tickCount:5,allowDataOverflow:!1,scale:"auto",allowDuplicatedCategory:!0});function X_(e){"@babel/helpers - typeof";return X_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X_(e)}function bp(){return bp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},bp.apply(this,arguments)}function xU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function fp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?xU(Object(r),!0).forEach(function(i){gA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function JMe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bU(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,dZ(i.key),i)}}function QMe(e,t,r){return t&&bU(e.prototype,t),r&&bU(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function eRe(e,t,r){return t=AE(t),tRe(e,hZ()?Reflect.construct(t,r||[],AE(e).constructor):t.apply(e,r))}function tRe(e,t){if(t&&(X_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rRe(e)}function rRe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hZ=function(){return!!e})()}function AE(e){return AE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},AE(e)}function nRe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&AR(e,t)}function AR(e,t){return AR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},AR(e,t)}function gA(e,t,r){return t=dZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dZ(e){var t=iRe(e,"string");return X_(t)=="symbol"?t:t+""}function iRe(e,t){if(X_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(X_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oRe=Math.PI/180,wU=1e-5,_A=function(e){function t(){return JMe(this,t),eRe(this,t,arguments)}return nRe(t,e),QMe(t,[{key:"getTickLineCoord",value:function(i){var c=this.props,d=c.cx,g=c.cy,o=c.radius,w=c.orientation,T=c.tickSize,I=T||8,C=Yi(d,g,o,i.coordinate),R=Yi(d,g,o+(w==="inner"?-1:1)*I,i.coordinate);return{x1:C.x,y1:C.y,x2:R.x,y2:R.y}}},{key:"getTickTextAnchor",value:function(i){var c=this.props.orientation,d=Math.cos(-i.coordinate*oRe),g;return d>wU?g=c==="outer"?"start":"end":d<-wU?g=c==="outer"?"end":"start":g="middle",g}},{key:"renderAxisLine",value:function(){var i=this.props,c=i.cx,d=i.cy,g=i.radius,o=i.axisLine,w=i.axisLineType,T=fp(fp({},hn(this.props,!1)),{},{fill:"none"},hn(o,!1));if(w==="circle")return De.createElement(LL,bp({className:"recharts-polar-angle-axis-line"},T,{cx:c,cy:d,r:g}));var I=this.props.ticks,C=I.map(function(R){return Yi(c,d,g,R.coordinate)});return De.createElement(xMe,bp({className:"recharts-polar-angle-axis-line"},T,{points:C}))}},{key:"renderTicks",value:function(){var i=this,c=this.props,d=c.ticks,g=c.tick,o=c.tickLine,w=c.tickFormatter,T=c.stroke,I=hn(this.props,!1),C=hn(g,!1),R=fp(fp({},I),{},{fill:"none"},hn(o,!1)),F=d.map(function(G,j){var H=i.getTickLineCoord(G),X=i.getTickTextAnchor(G),q=fp(fp(fp({textAnchor:X},I),{},{stroke:"none",fill:T},C),{},{index:j,payload:G,x:H.x2,y:H.y2});return De.createElement(Li,bp({className:Gn("recharts-polar-angle-axis-tick",Z7(g)),key:"tick-".concat(G.coordinate)},Zp(i.props,G,j)),o&&De.createElement("line",bp({className:"recharts-polar-angle-axis-tick-line"},R,H)),g&&t.renderTickItem(g,q,w?w(G.value,j):G.value))});return De.createElement(Li,{className:"recharts-polar-angle-axis-ticks"},F)}},{key:"render",value:function(){var i=this.props,c=i.ticks,d=i.radius,g=i.axisLine;return d<=0||!c||!c.length?null:De.createElement(Li,{className:Gn("recharts-polar-angle-axis",this.props.className)},g&&this.renderAxisLine(),this.renderTicks())}}],[{key:"renderTickItem",value:function(i,c,d){var g;return De.isValidElement(i)?g=De.cloneElement(i,c):An(i)?g=i(c):g=De.createElement(Xp,bp({},c,{className:"recharts-polar-angle-axis-tick-value"}),d),g}}])}(Q.PureComponent);gA(_A,"displayName","PolarAngleAxis");gA(_A,"axisType","angleAxis");gA(_A,"defaultProps",{type:"category",angleAxisId:0,scale:"auto",cx:0,cy:0,orientation:"outer",axisLine:!0,tickLine:!0,tickSize:8,tick:!0,hide:!1,allowDuplicatedCategory:!0});var sRe=m9,aRe=sRe(Object.getPrototypeOf,Object),lRe=aRe,cRe=ih,uRe=lRe,hRe=oh,dRe="[object Object]",fRe=Function.prototype,pRe=Object.prototype,fZ=fRe.toString,mRe=pRe.hasOwnProperty,gRe=fZ.call(Object);function _Re(e){if(!hRe(e)||cRe(e)!=dRe)return!1;var t=uRe(e);if(t===null)return!0;var r=mRe.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&fZ.call(r)==gRe}var yRe=_Re;const vRe=Ii(yRe);var xRe=ih,bRe=oh,wRe="[object Boolean]";function SRe(e){return e===!0||e===!1||bRe(e)&&xRe(e)==wRe}var TRe=SRe;const ERe=Ii(TRe);function y1(e){"@babel/helpers - typeof";return y1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y1(e)}function PE(){return PE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},PE.apply(this,arguments)}function ARe(e,t){return ORe(e)||IRe(e,t)||CRe(e,t)||PRe()}function PRe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CRe(e,t){if(e){if(typeof e=="string")return SU(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return SU(e,t)}}function SU(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function IRe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function ORe(e){if(Array.isArray(e))return e}function TU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function EU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TU(Object(r),!0).forEach(function(i){MRe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function MRe(e,t,r){return t=RRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function RRe(e){var t=kRe(e,"string");return y1(t)=="symbol"?t:t+""}function kRe(e,t){if(y1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(y1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AU=function(t,r,i,c,d){var g=i-c,o;return o="M ".concat(t,",").concat(r),o+="L ".concat(t+i,",").concat(r),o+="L ".concat(t+i-g/2,",").concat(r+d),o+="L ".concat(t+i-g/2-c,",").concat(r+d),o+="L ".concat(t,",").concat(r," Z"),o},DRe={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},LRe=function(t){var r=EU(EU({},DRe),t),i=Q.useRef(),c=Q.useState(-1),d=ARe(c,2),g=d[0],o=d[1];Q.useEffect(function(){if(i.current&&i.current.getTotalLength)try{var Z=i.current.getTotalLength();Z&&o(Z)}catch{}},[]);var w=r.x,T=r.y,I=r.upperWidth,C=r.lowerWidth,R=r.height,F=r.className,G=r.animationEasing,j=r.animationDuration,H=r.animationBegin,X=r.isUpdateAnimationActive;if(w!==+w||T!==+T||I!==+I||C!==+C||R!==+R||I===0&&C===0||R===0)return null;var q=Gn("recharts-trapezoid",F);return X?De.createElement(rh,{canBegin:g>0,from:{upperWidth:0,lowerWidth:0,height:R,x:w,y:T},to:{upperWidth:I,lowerWidth:C,height:R,x:w,y:T},duration:j,animationEasing:G,isActive:X},function(Z){var J=Z.upperWidth,ne=Z.lowerWidth,he=Z.height,me=Z.x,Se=Z.y;return De.createElement(rh,{canBegin:g>0,from:"0px ".concat(g===-1?1:g,"px"),to:"".concat(g,"px 0px"),attributeName:"strokeDasharray",begin:H,duration:j,easing:G},De.createElement("path",PE({},hn(r,!0),{className:q,d:AU(me,Se,J,ne,he),ref:i})))}):De.createElement("g",null,De.createElement("path",PE({},hn(r,!0),{className:q,d:AU(w,T,I,C,R)})))},zRe=["option","shapeType","propTransformer","activeClassName","isActive"];function v1(e){"@babel/helpers - typeof";return v1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v1(e)}function NRe(e,t){if(e==null)return{};var r=jRe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function jRe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function PU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function CE(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PU(Object(r),!0).forEach(function(i){FRe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function FRe(e,t,r){return t=BRe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BRe(e){var t=$Re(e,"string");return v1(t)=="symbol"?t:t+""}function $Re(e,t){if(v1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(v1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function URe(e,t){return CE(CE({},t),e)}function VRe(e,t){return e==="symbols"}function CU(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return De.createElement(DL,r);case"trapezoid":return De.createElement(LRe,r);case"sector":return De.createElement(Y7,r);case"symbols":if(VRe(t))return De.createElement(QD,r);break;default:return null}}function GRe(e){return Q.isValidElement(e)?e.props:e}function pZ(e){var t=e.option,r=e.shapeType,i=e.propTransformer,c=i===void 0?URe:i,d=e.activeClassName,g=d===void 0?"recharts-active-shape":d,o=e.isActive,w=NRe(e,zRe),T;if(Q.isValidElement(t))T=Q.cloneElement(t,CE(CE({},w),GRe(t)));else if(An(t))T=t(w);else if(vRe(t)&&!ERe(t)){var I=c(t,w);T=De.createElement(CU,{shapeType:r,elementProps:I})}else{var C=w;T=De.createElement(CU,{shapeType:r,elementProps:C})}return o?De.createElement(Li,{className:g},T):T}function yA(e,t){return t!=null&&"trapezoids"in e.props}function vA(e,t){return t!=null&&"sectors"in e.props}function x1(e,t){return t!=null&&"points"in e.props}function HRe(e,t){var r,i,c=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,d=e.y===(t==null||(i=t.labelViewBox)===null||i===void 0?void 0:i.y)||e.y===t.y;return c&&d}function WRe(e,t){var r=e.endAngle===t.endAngle,i=e.startAngle===t.startAngle;return r&&i}function qRe(e,t){var r=e.x===t.x,i=e.y===t.y,c=e.z===t.z;return r&&i&&c}function ZRe(e,t){var r;return yA(e,t)?r=HRe:vA(e,t)?r=WRe:x1(e,t)&&(r=qRe),r}function XRe(e,t){var r;return yA(e,t)?r="trapezoids":vA(e,t)?r="sectors":x1(e,t)&&(r="points"),r}function KRe(e,t){if(yA(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(vA(e,t)){var i;return(i=t.tooltipPayload)===null||i===void 0||(i=i[0])===null||i===void 0||(i=i.payload)===null||i===void 0?void 0:i.payload}return x1(e,t)?t.payload:{}}function YRe(e){var t=e.activeTooltipItem,r=e.graphicalItem,i=e.itemData,c=XRe(r,t),d=KRe(r,t),g=i.filter(function(w,T){var I=uA(d,w),C=r.props[c].filter(function(G){var j=ZRe(r,t);return j(G,t)}),R=r.props[c].indexOf(C[C.length-1]),F=T===R;return I&&F}),o=i.indexOf(g[g.length-1]);return o}var aT;function K_(e){"@babel/helpers - typeof";return K_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K_(e)}function r_(){return r_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},r_.apply(this,arguments)}function IU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Zi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IU(Object(r),!0).forEach(function(i){ul(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function JRe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OU(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,gZ(i.key),i)}}function QRe(e,t,r){return t&&OU(e.prototype,t),r&&OU(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function eke(e,t,r){return t=IE(t),tke(e,mZ()?Reflect.construct(t,r||[],IE(e).constructor):t.apply(e,r))}function tke(e,t){if(t&&(K_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return rke(e)}function rke(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(mZ=function(){return!!e})()}function IE(e){return IE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},IE(e)}function nke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&PR(e,t)}function PR(e,t){return PR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},PR(e,t)}function ul(e,t,r){return t=gZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gZ(e){var t=ike(e,"string");return K_(t)=="symbol"?t:t+""}function ike(e,t){if(K_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(K_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ah=function(e){function t(r){var i;return JRe(this,t),i=eke(this,t,[r]),ul(i,"pieRef",null),ul(i,"sectorRefs",[]),ul(i,"id",Z1("recharts-pie-")),ul(i,"handleAnimationEnd",function(){var c=i.props.onAnimationEnd;i.setState({isAnimationFinished:!0}),An(c)&&c()}),ul(i,"handleAnimationStart",function(){var c=i.props.onAnimationStart;i.setState({isAnimationFinished:!1}),An(c)&&c()}),i.state={isAnimationFinished:!r.isAnimationActive,prevIsAnimationActive:r.isAnimationActive,prevAnimationId:r.animationId,sectorToFocus:0},i}return nke(t,e),QRe(t,[{key:"isActiveIndex",value:function(i){var c=this.props.activeIndex;return Array.isArray(c)?c.indexOf(i)!==-1:i===c}},{key:"hasActiveIndex",value:function(){var i=this.props.activeIndex;return Array.isArray(i)?i.length!==0:i||i===0}},{key:"renderLabels",value:function(i){var c=this.props.isAnimationActive;if(c&&!this.state.isAnimationFinished)return null;var d=this.props,g=d.label,o=d.labelLine,w=d.dataKey,T=d.valueKey,I=hn(this.props,!1),C=hn(g,!1),R=hn(o,!1),F=g&&g.offsetRadius||20,G=i.map(function(j,H){var X=(j.startAngle+j.endAngle)/2,q=Yi(j.cx,j.cy,j.outerRadius+F,X),Z=Zi(Zi(Zi(Zi({},I),j),{},{stroke:"none"},C),{},{index:H,textAnchor:t.getTextAnchor(q.x,j.cx)},q),J=Zi(Zi(Zi(Zi({},I),j),{},{fill:"none",stroke:j.fill},R),{},{index:H,points:[Yi(j.cx,j.cy,j.outerRadius,X),q]}),ne=w;return ni(w)&&ni(T)?ne="value":ni(w)&&(ne=T),De.createElement(Li,{key:"label-".concat(j.startAngle,"-").concat(j.endAngle,"-").concat(j.midAngle,"-").concat(H)},o&&t.renderLabelLineItem(o,J,"line"),t.renderLabelItem(g,Z,Ls(j,ne)))});return De.createElement(Li,{className:"recharts-pie-labels"},G)}},{key:"renderSectorsStatically",value:function(i){var c=this,d=this.props,g=d.activeShape,o=d.blendStroke,w=d.inactiveShape;return i.map(function(T,I){if((T==null?void 0:T.startAngle)===0&&(T==null?void 0:T.endAngle)===0&&i.length!==1)return null;var C=c.isActiveIndex(I),R=w&&c.hasActiveIndex()?w:null,F=C?g:R,G=Zi(Zi({},T),{},{stroke:o?T.fill:T.stroke,tabIndex:-1});return De.createElement(Li,r_({ref:function(H){H&&!c.sectorRefs.includes(H)&&c.sectorRefs.push(H)},tabIndex:-1,className:"recharts-pie-sector"},Zp(c.props,T,I),{key:"sector-".concat(T==null?void 0:T.startAngle,"-").concat(T==null?void 0:T.endAngle,"-").concat(T.midAngle,"-").concat(I)}),De.createElement(pZ,r_({option:F,isActive:C,shapeType:"sector"},G)))})}},{key:"renderSectorsWithAnimation",value:function(){var i=this,c=this.props,d=c.sectors,g=c.isAnimationActive,o=c.animationBegin,w=c.animationDuration,T=c.animationEasing,I=c.animationId,C=this.state,R=C.prevSectors,F=C.prevIsAnimationActive;return De.createElement(rh,{begin:o,duration:w,isActive:g,easing:T,from:{t:0},to:{t:1},key:"pie-".concat(I,"-").concat(F),onAnimationStart:this.handleAnimationStart,onAnimationEnd:this.handleAnimationEnd},function(G){var j=G.t,H=[],X=d&&d[0],q=X.startAngle;return d.forEach(function(Z,J){var ne=R&&R[J],he=J>0?Va(Z,"paddingAngle",0):0;if(ne){var me=cd(ne.endAngle-ne.startAngle,Z.endAngle-Z.startAngle),Se=Zi(Zi({},Z),{},{startAngle:q+he,endAngle:q+me(j)+he});H.push(Se),q=Se.endAngle}else{var qe=Z.endAngle,Ze=Z.startAngle,He=cd(0,qe-Ze),Ke=He(j),dt=Zi(Zi({},Z),{},{startAngle:q+he,endAngle:q+Ke+he});H.push(dt),q=dt.endAngle}}),De.createElement(Li,null,i.renderSectorsStatically(H))})}},{key:"attachKeyboardHandlers",value:function(i){var c=this;i.onkeydown=function(d){if(!d.altKey)switch(d.key){case"ArrowLeft":{var g=++c.state.sectorToFocus%c.sectorRefs.length;c.sectorRefs[g].focus(),c.setState({sectorToFocus:g});break}case"ArrowRight":{var o=--c.state.sectorToFocus<0?c.sectorRefs.length-1:c.state.sectorToFocus%c.sectorRefs.length;c.sectorRefs[o].focus(),c.setState({sectorToFocus:o});break}case"Escape":{c.sectorRefs[c.state.sectorToFocus].blur(),c.setState({sectorToFocus:0});break}}}}},{key:"renderSectors",value:function(){var i=this.props,c=i.sectors,d=i.isAnimationActive,g=this.state.prevSectors;return d&&c&&c.length&&(!g||!uA(g,c))?this.renderSectorsWithAnimation():this.renderSectorsStatically(c)}},{key:"componentDidMount",value:function(){this.pieRef&&this.attachKeyboardHandlers(this.pieRef)}},{key:"render",value:function(){var i=this,c=this.props,d=c.hide,g=c.sectors,o=c.className,w=c.label,T=c.cx,I=c.cy,C=c.innerRadius,R=c.outerRadius,F=c.isAnimationActive,G=this.state.isAnimationFinished;if(d||!g||!g.length||!gr(T)||!gr(I)||!gr(C)||!gr(R))return null;var j=Gn("recharts-pie",o);return De.createElement(Li,{tabIndex:this.props.rootTabIndex,className:j,ref:function(X){i.pieRef=X}},this.renderSectors(),w&&this.renderLabels(g),os.renderCallByParent(this.props,null,!1),(!F||G)&&Dd.renderCallByParent(this.props,g,!1))}}],[{key:"getDerivedStateFromProps",value:function(i,c){return c.prevIsAnimationActive!==i.isAnimationActive?{prevIsAnimationActive:i.isAnimationActive,prevAnimationId:i.animationId,curSectors:i.sectors,prevSectors:[],isAnimationFinished:!0}:i.isAnimationActive&&i.animationId!==c.prevAnimationId?{prevAnimationId:i.animationId,curSectors:i.sectors,prevSectors:c.curSectors,isAnimationFinished:!0}:i.sectors!==c.curSectors?{curSectors:i.sectors,isAnimationFinished:!0}:null}},{key:"getTextAnchor",value:function(i,c){return i>c?"start":i<c?"end":"middle"}},{key:"renderLabelLineItem",value:function(i,c,d){if(De.isValidElement(i))return De.cloneElement(i,c);if(An(i))return i(c);var g=Gn("recharts-pie-label-line",typeof i!="boolean"?i.className:"");return De.createElement(dR,r_({},c,{key:d,type:"linear",className:g}))}},{key:"renderLabelItem",value:function(i,c,d){if(De.isValidElement(i))return De.cloneElement(i,c);var g=d;if(An(i)&&(g=i(c),De.isValidElement(g)))return g;var o=Gn("recharts-pie-label-text",typeof i!="boolean"&&!An(i)?i.className:"");return De.createElement(Xp,r_({},c,{alignmentBaseline:"middle",className:o}),g)}}])}(Q.PureComponent);aT=ah;ul(ah,"displayName","Pie");ul(ah,"defaultProps",{stroke:"#fff",fill:"#808080",legendType:"rect",cx:"50%",cy:"50%",startAngle:0,endAngle:360,innerRadius:0,outerRadius:"80%",paddingAngle:0,labelLine:!0,hide:!1,minAngle:0,isAnimationActive:!Hu.isSsr,animationBegin:400,animationDuration:1500,animationEasing:"ease",nameKey:"name",blendStroke:!1,rootTabIndex:0});ul(ah,"parseDeltaAngle",function(e,t){var r=Ys(t-e),i=Math.min(Math.abs(t-e),360);return r*i});ul(ah,"getRealPieData",function(e){var t=e.data,r=e.children,i=hn(e,!1),c=ml(r,eA);return t&&t.length?t.map(function(d,g){return Zi(Zi(Zi({payload:d},i),d),c&&c[g]&&c[g].props)}):c&&c.length?c.map(function(d){return Zi(Zi({},i),d.props)}):[]});ul(ah,"parseCoordinateOfPie",function(e,t){var r=t.top,i=t.left,c=t.width,d=t.height,g=q7(c,d),o=i+Js(e.cx,c,c/2),w=r+Js(e.cy,d,d/2),T=Js(e.innerRadius,g,0),I=Js(e.outerRadius,g,g*.8),C=e.maxRadius||Math.sqrt(c*c+d*d)/2;return{cx:o,cy:w,innerRadius:T,outerRadius:I,maxRadius:C}});ul(ah,"getComposedData",function(e){var t=e.item,r=e.offset,i=t.type.defaultProps!==void 0?Zi(Zi({},t.type.defaultProps),t.props):t.props,c=aT.getRealPieData(i);if(!c||!c.length)return null;var d=i.cornerRadius,g=i.startAngle,o=i.endAngle,w=i.paddingAngle,T=i.dataKey,I=i.nameKey,C=i.valueKey,R=i.tooltipType,F=Math.abs(i.minAngle),G=aT.parseCoordinateOfPie(i,r),j=aT.parseDeltaAngle(g,o),H=Math.abs(j),X=T;ni(T)&&ni(C)?(sc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),X="value"):ni(T)&&(sc(!1,`Use "dataKey" to specify the value of pie,
      the props "valueKey" will be deprecated in 1.1.0`),X=C);var q=c.filter(function(Se){return Ls(Se,X,0)!==0}).length,Z=(H>=360?q:q-1)*w,J=H-q*F-Z,ne=c.reduce(function(Se,qe){var Ze=Ls(qe,X,0);return Se+(gr(Ze)?Ze:0)},0),he;if(ne>0){var me;he=c.map(function(Se,qe){var Ze=Ls(Se,X,0),He=Ls(Se,I,qe),Ke=(gr(Ze)?Ze:0)/ne,dt;qe?dt=me.endAngle+Ys(j)*w*(Ze!==0?1:0):dt=g;var $e=dt+Ys(j)*((Ze!==0?F:0)+Ke*J),mt=(dt+$e)/2,ct=(G.innerRadius+G.outerRadius)/2,St=[{name:He,value:Ze,payload:Se,dataKey:X,type:R}],Ue=Yi(G.cx,G.cy,ct,mt);return me=Zi(Zi(Zi({percent:Ke,cornerRadius:d,name:He,tooltipPayload:St,midAngle:mt,middleRadius:ct,tooltipPosition:Ue},Se),G),{},{value:Ls(Se,X),startAngle:dt,endAngle:$e,payload:Se,paddingAngle:Ys(j)*w}),me})}return Zi(Zi({},G),{},{sectors:he,data:c})});var oke=Math.ceil,ske=Math.max;function ake(e,t,r,i){for(var c=-1,d=ske(oke((t-e)/(r||1)),0),g=Array(d);d--;)g[i?d:++c]=e,e+=r;return g}var lke=ake,cke=D9,MU=1/0,uke=17976931348623157e292;function hke(e){if(!e)return e===0?e:0;if(e=cke(e),e===MU||e===-MU){var t=e<0?-1:1;return t*uke}return e===e?e:0}var _Z=hke,dke=lke,fke=Q2,ZI=_Z;function pke(e){return function(t,r,i){return i&&typeof i!="number"&&fke(t,r,i)&&(r=i=void 0),t=ZI(t),r===void 0?(r=t,t=0):r=ZI(r),i=i===void 0?t<r?1:-1:ZI(i),dke(t,r,i,e)}}var mke=pke,gke=mke,_ke=gke(),yke=_ke;const OE=Ii(yke);function b1(e){"@babel/helpers - typeof";return b1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b1(e)}function RU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function kU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?RU(Object(r),!0).forEach(function(i){yZ(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):RU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function yZ(e,t,r){return t=vke(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function vke(e){var t=xke(e,"string");return b1(t)=="symbol"?t:t+""}function xke(e,t){if(b1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(b1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var bke=["Webkit","Moz","O","ms"],wke=function(t,r){var i=t.replace(/(\w)/,function(d){return d.toUpperCase()}),c=bke.reduce(function(d,g){return kU(kU({},d),{},yZ({},g+i,r))},{});return c[t]=r,c};function Y_(e){"@babel/helpers - typeof";return Y_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y_(e)}function ME(){return ME=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},ME.apply(this,arguments)}function DU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function XI(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DU(Object(r),!0).forEach(function(i){Ra(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ske(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function LU(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,xZ(i.key),i)}}function Tke(e,t,r){return t&&LU(e.prototype,t),r&&LU(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Eke(e,t,r){return t=RE(t),Ake(e,vZ()?Reflect.construct(t,r||[],RE(e).constructor):t.apply(e,r))}function Ake(e,t){if(t&&(Y_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Pke(e)}function Pke(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vZ=function(){return!!e})()}function RE(e){return RE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},RE(e)}function Cke(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&CR(e,t)}function CR(e,t){return CR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},CR(e,t)}function Ra(e,t,r){return t=xZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xZ(e){var t=Ike(e,"string");return Y_(t)=="symbol"?t:t+""}function Ike(e,t){if(Y_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Y_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Oke=function(t){var r=t.data,i=t.startIndex,c=t.endIndex,d=t.x,g=t.width,o=t.travellerWidth;if(!r||!r.length)return{};var w=r.length,T=px().domain(OE(0,w)).range([d,d+g-o]),I=T.domain().map(function(C){return T(C)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:T(i),endX:T(c),scale:T,scaleValues:I}},zU=function(t){return t.changedTouches&&!!t.changedTouches.length},J_=function(e){function t(r){var i;return Ske(this,t),i=Eke(this,t,[r]),Ra(i,"handleDrag",function(c){i.leaveTimer&&(clearTimeout(i.leaveTimer),i.leaveTimer=null),i.state.isTravellerMoving?i.handleTravellerMove(c):i.state.isSlideMoving&&i.handleSlideDrag(c)}),Ra(i,"handleTouchMove",function(c){c.changedTouches!=null&&c.changedTouches.length>0&&i.handleDrag(c.changedTouches[0])}),Ra(i,"handleDragEnd",function(){i.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var c=i.props,d=c.endIndex,g=c.onDragEnd,o=c.startIndex;g==null||g({endIndex:d,startIndex:o})}),i.detachDragEndListener()}),Ra(i,"handleLeaveWrapper",function(){(i.state.isTravellerMoving||i.state.isSlideMoving)&&(i.leaveTimer=window.setTimeout(i.handleDragEnd,i.props.leaveTimeOut))}),Ra(i,"handleEnterSlideOrTraveller",function(){i.setState({isTextActive:!0})}),Ra(i,"handleLeaveSlideOrTraveller",function(){i.setState({isTextActive:!1})}),Ra(i,"handleSlideDragStart",function(c){var d=zU(c)?c.changedTouches[0]:c;i.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:d.pageX}),i.attachDragEndListener()}),i.travellerDragStartHandlers={startX:i.handleTravellerDragStart.bind(i,"startX"),endX:i.handleTravellerDragStart.bind(i,"endX")},i.state={},i}return Cke(t,e),Tke(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(i){var c=i.startX,d=i.endX,g=this.state.scaleValues,o=this.props,w=o.gap,T=o.data,I=T.length-1,C=Math.min(c,d),R=Math.max(c,d),F=t.getIndexInRange(g,C),G=t.getIndexInRange(g,R);return{startIndex:F-F%w,endIndex:G===I?I:G-G%w}}},{key:"getTextOfTick",value:function(i){var c=this.props,d=c.data,g=c.tickFormatter,o=c.dataKey,w=Ls(d[i],o,i);return An(g)?g(w,i):w}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(i){var c=this.state,d=c.slideMoveStartX,g=c.startX,o=c.endX,w=this.props,T=w.x,I=w.width,C=w.travellerWidth,R=w.startIndex,F=w.endIndex,G=w.onChange,j=i.pageX-d;j>0?j=Math.min(j,T+I-C-o,T+I-C-g):j<0&&(j=Math.max(j,T-g,T-o));var H=this.getIndex({startX:g+j,endX:o+j});(H.startIndex!==R||H.endIndex!==F)&&G&&G(H),this.setState({startX:g+j,endX:o+j,slideMoveStartX:i.pageX})}},{key:"handleTravellerDragStart",value:function(i,c){var d=zU(c)?c.changedTouches[0]:c;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:i,brushMoveStartX:d.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(i){var c=this.state,d=c.brushMoveStartX,g=c.movingTravellerId,o=c.endX,w=c.startX,T=this.state[g],I=this.props,C=I.x,R=I.width,F=I.travellerWidth,G=I.onChange,j=I.gap,H=I.data,X={startX:this.state.startX,endX:this.state.endX},q=i.pageX-d;q>0?q=Math.min(q,C+R-F-T):q<0&&(q=Math.max(q,C-T)),X[g]=T+q;var Z=this.getIndex(X),J=Z.startIndex,ne=Z.endIndex,he=function(){var Se=H.length-1;return g==="startX"&&(o>w?J%j===0:ne%j===0)||o<w&&ne===Se||g==="endX"&&(o>w?ne%j===0:J%j===0)||o>w&&ne===Se};this.setState(Ra(Ra({},g,T+q),"brushMoveStartX",i.pageX),function(){G&&he()&&G(Z)})}},{key:"handleTravellerMoveKeyboard",value:function(i,c){var d=this,g=this.state,o=g.scaleValues,w=g.startX,T=g.endX,I=this.state[c],C=o.indexOf(I);if(C!==-1){var R=C+i;if(!(R===-1||R>=o.length)){var F=o[R];c==="startX"&&F>=T||c==="endX"&&F<=w||this.setState(Ra({},c,F),function(){d.props.onChange(d.getIndex({startX:d.state.startX,endX:d.state.endX}))})}}}},{key:"renderBackground",value:function(){var i=this.props,c=i.x,d=i.y,g=i.width,o=i.height,w=i.fill,T=i.stroke;return De.createElement("rect",{stroke:T,fill:w,x:c,y:d,width:g,height:o})}},{key:"renderPanorama",value:function(){var i=this.props,c=i.x,d=i.y,g=i.width,o=i.height,w=i.data,T=i.children,I=i.padding,C=Q.Children.only(T);return C?De.cloneElement(C,{x:c,y:d,width:g,height:o,margin:I,compact:!0,data:w}):null}},{key:"renderTravellerLayer",value:function(i,c){var d,g,o=this,w=this.props,T=w.y,I=w.travellerWidth,C=w.height,R=w.traveller,F=w.ariaLabel,G=w.data,j=w.startIndex,H=w.endIndex,X=Math.max(i,this.props.x),q=XI(XI({},hn(this.props,!1)),{},{x:X,y:T,width:I,height:C}),Z=F||"Min value: ".concat((d=G[j])===null||d===void 0?void 0:d.name,", Max value: ").concat((g=G[H])===null||g===void 0?void 0:g.name);return De.createElement(Li,{tabIndex:0,role:"slider","aria-label":Z,"aria-valuenow":i,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[c],onTouchStart:this.travellerDragStartHandlers[c],onKeyDown:function(ne){["ArrowLeft","ArrowRight"].includes(ne.key)&&(ne.preventDefault(),ne.stopPropagation(),o.handleTravellerMoveKeyboard(ne.key==="ArrowRight"?1:-1,c))},onFocus:function(){o.setState({isTravellerFocused:!0})},onBlur:function(){o.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(R,q))}},{key:"renderSlide",value:function(i,c){var d=this.props,g=d.y,o=d.height,w=d.stroke,T=d.travellerWidth,I=Math.min(i,c)+T,C=Math.max(Math.abs(c-i)-T,0);return De.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:w,fillOpacity:.2,x:I,y:g,width:C,height:o})}},{key:"renderText",value:function(){var i=this.props,c=i.startIndex,d=i.endIndex,g=i.y,o=i.height,w=i.travellerWidth,T=i.stroke,I=this.state,C=I.startX,R=I.endX,F=5,G={pointerEvents:"none",fill:T};return De.createElement(Li,{className:"recharts-brush-texts"},De.createElement(Xp,ME({textAnchor:"end",verticalAnchor:"middle",x:Math.min(C,R)-F,y:g+o/2},G),this.getTextOfTick(c)),De.createElement(Xp,ME({textAnchor:"start",verticalAnchor:"middle",x:Math.max(C,R)+w+F,y:g+o/2},G),this.getTextOfTick(d)))}},{key:"render",value:function(){var i=this.props,c=i.data,d=i.className,g=i.children,o=i.x,w=i.y,T=i.width,I=i.height,C=i.alwaysShowText,R=this.state,F=R.startX,G=R.endX,j=R.isTextActive,H=R.isSlideMoving,X=R.isTravellerMoving,q=R.isTravellerFocused;if(!c||!c.length||!gr(o)||!gr(w)||!gr(T)||!gr(I)||T<=0||I<=0)return null;var Z=Gn("recharts-brush",d),J=De.Children.count(g)===1,ne=wke("userSelect","none");return De.createElement(Li,{className:Z,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:ne},this.renderBackground(),J&&this.renderPanorama(),this.renderSlide(F,G),this.renderTravellerLayer(F,"startX"),this.renderTravellerLayer(G,"endX"),(j||H||X||q||C)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(i){var c=i.x,d=i.y,g=i.width,o=i.height,w=i.stroke,T=Math.floor(d+o/2)-1;return De.createElement(De.Fragment,null,De.createElement("rect",{x:c,y:d,width:g,height:o,fill:w,stroke:"none"}),De.createElement("line",{x1:c+1,y1:T,x2:c+g-1,y2:T,fill:"none",stroke:"#fff"}),De.createElement("line",{x1:c+1,y1:T+2,x2:c+g-1,y2:T+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(i,c){var d;return De.isValidElement(i)?d=De.cloneElement(i,c):An(i)?d=i(c):d=t.renderDefaultTraveller(c),d}},{key:"getDerivedStateFromProps",value:function(i,c){var d=i.data,g=i.width,o=i.x,w=i.travellerWidth,T=i.updateId,I=i.startIndex,C=i.endIndex;if(d!==c.prevData||T!==c.prevUpdateId)return XI({prevData:d,prevTravellerWidth:w,prevUpdateId:T,prevX:o,prevWidth:g},d&&d.length?Oke({data:d,width:g,x:o,travellerWidth:w,startIndex:I,endIndex:C}):{scale:null,scaleValues:null});if(c.scale&&(g!==c.prevWidth||o!==c.prevX||w!==c.prevTravellerWidth)){c.scale.range([o,o+g-w]);var R=c.scale.domain().map(function(F){return c.scale(F)});return{prevData:d,prevTravellerWidth:w,prevUpdateId:T,prevX:o,prevWidth:g,startX:c.scale(i.startIndex),endX:c.scale(i.endIndex),scaleValues:R}}return null}},{key:"getIndexInRange",value:function(i,c){for(var d=i.length,g=0,o=d-1;o-g>1;){var w=Math.floor((g+o)/2);i[w]>c?o=w:g=w}return c>=i[o]?o:g}}])}(Q.PureComponent);Ra(J_,"displayName","Brush");Ra(J_,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var Mke=sL;function Rke(e,t){var r;return Mke(e,function(i,c,d){return r=t(i,c,d),!r}),!!r}var kke=Rke,Dke=a9,Lke=nu,zke=kke,Nke=ba,jke=Q2;function Fke(e,t,r){var i=Nke(e)?Dke:zke;return r&&jke(e,t,r)&&(t=void 0),i(e,Lke(t))}var Bke=Fke;const $ke=Ii(Bke);var Jc=function(t,r){var i=t.alwaysShow,c=t.ifOverflow;return i&&(c="extendDomain"),c===r},NU=I9;function Uke(e,t,r){t=="__proto__"&&NU?NU(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Vke=Uke,Gke=Vke,Hke=P9,Wke=nu;function qke(e,t){var r={};return t=Wke(t),Hke(e,function(i,c,d){Gke(r,c,t(i,c,d))}),r}var Zke=qke;const Xke=Ii(Zke);function Kke(e,t){for(var r=-1,i=e==null?0:e.length;++r<i;)if(!t(e[r],r,e))return!1;return!0}var Yke=Kke,Jke=sL;function Qke(e,t){var r=!0;return Jke(e,function(i,c,d){return r=!!t(i,c,d),r}),r}var eDe=Qke,tDe=Yke,rDe=eDe,nDe=nu,iDe=ba,oDe=Q2;function sDe(e,t,r){var i=iDe(e)?tDe:rDe;return r&&oDe(e,t,r)&&(t=void 0),i(e,nDe(t))}var aDe=sDe;const bZ=Ii(aDe);var lDe=["x","y"];function w1(e){"@babel/helpers - typeof";return w1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w1(e)}function IR(){return IR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},IR.apply(this,arguments)}function jU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function $0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?jU(Object(r),!0).forEach(function(i){cDe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function cDe(e,t,r){return t=uDe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uDe(e){var t=hDe(e,"string");return w1(t)=="symbol"?t:t+""}function hDe(e,t){if(w1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(w1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dDe(e,t){if(e==null)return{};var r=fDe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function fDe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function pDe(e,t){var r=e.x,i=e.y,c=dDe(e,lDe),d="".concat(r),g=parseInt(d,10),o="".concat(i),w=parseInt(o,10),T="".concat(t.height||c.height),I=parseInt(T,10),C="".concat(t.width||c.width),R=parseInt(C,10);return $0($0($0($0($0({},t),c),g?{x:g}:{}),w?{y:w}:{}),{},{height:I,width:R,name:t.name,radius:t.radius})}function FU(e){return De.createElement(pZ,IR({shapeType:"rectangle",propTransformer:pDe,activeClassName:"recharts-active-bar"},e))}var mDe=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(i,c){if(typeof t=="number")return t;var d=typeof i=="number";return d?t(i,c):(d||Yp(),r)}},gDe=["value","background"],wZ;function Q_(e){"@babel/helpers - typeof";return Q_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Q_(e)}function _De(e,t){if(e==null)return{};var r=yDe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function yDe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function kE(){return kE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},kE.apply(this,arguments)}function BU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function ko(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?BU(Object(r),!0).forEach(function(i){Sd(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function vDe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function $U(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,TZ(i.key),i)}}function xDe(e,t,r){return t&&$U(e.prototype,t),r&&$U(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function bDe(e,t,r){return t=DE(t),wDe(e,SZ()?Reflect.construct(t,r||[],DE(e).constructor):t.apply(e,r))}function wDe(e,t){if(t&&(Q_(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return SDe(e)}function SDe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function SZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(SZ=function(){return!!e})()}function DE(e){return DE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},DE(e)}function TDe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&OR(e,t)}function OR(e,t){return OR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},OR(e,t)}function Sd(e,t,r){return t=TZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TZ(e){var t=EDe(e,"string");return Q_(t)=="symbol"?t:t+""}function EDe(e,t){if(Q_(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Q_(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hm=function(e){function t(){var r;vDe(this,t);for(var i=arguments.length,c=new Array(i),d=0;d<i;d++)c[d]=arguments[d];return r=bDe(this,t,[].concat(c)),Sd(r,"state",{isAnimationFinished:!1}),Sd(r,"id",Z1("recharts-bar-")),Sd(r,"handleAnimationEnd",function(){var g=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),g&&g()}),Sd(r,"handleAnimationStart",function(){var g=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),g&&g()}),r}return TDe(t,e),xDe(t,[{key:"renderRectanglesStatically",value:function(i){var c=this,d=this.props,g=d.shape,o=d.dataKey,w=d.activeIndex,T=d.activeBar,I=hn(this.props,!1);return i&&i.map(function(C,R){var F=R===w,G=F?T:g,j=ko(ko(ko({},I),C),{},{isActive:F,option:G,index:R,dataKey:o,onAnimationStart:c.handleAnimationStart,onAnimationEnd:c.handleAnimationEnd});return De.createElement(Li,kE({className:"recharts-bar-rectangle"},Zp(c.props,C,R),{key:"rectangle-".concat(C==null?void 0:C.x,"-").concat(C==null?void 0:C.y,"-").concat(C==null?void 0:C.value)}),De.createElement(FU,j))})}},{key:"renderRectanglesWithAnimation",value:function(){var i=this,c=this.props,d=c.data,g=c.layout,o=c.isAnimationActive,w=c.animationBegin,T=c.animationDuration,I=c.animationEasing,C=c.animationId,R=this.state.prevData;return De.createElement(rh,{begin:w,duration:T,isActive:o,easing:I,from:{t:0},to:{t:1},key:"bar-".concat(C),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(F){var G=F.t,j=d.map(function(H,X){var q=R&&R[X];if(q){var Z=cd(q.x,H.x),J=cd(q.y,H.y),ne=cd(q.width,H.width),he=cd(q.height,H.height);return ko(ko({},H),{},{x:Z(G),y:J(G),width:ne(G),height:he(G)})}if(g==="horizontal"){var me=cd(0,H.height),Se=me(G);return ko(ko({},H),{},{y:H.y+H.height-Se,height:Se})}var qe=cd(0,H.width),Ze=qe(G);return ko(ko({},H),{},{width:Ze})});return De.createElement(Li,null,i.renderRectanglesStatically(j))})}},{key:"renderRectangles",value:function(){var i=this.props,c=i.data,d=i.isAnimationActive,g=this.state.prevData;return d&&c&&c.length&&(!g||!uA(g,c))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(c)}},{key:"renderBackground",value:function(){var i=this,c=this.props,d=c.data,g=c.dataKey,o=c.activeIndex,w=hn(this.props.background,!1);return d.map(function(T,I){T.value;var C=T.background,R=_De(T,gDe);if(!C)return null;var F=ko(ko(ko(ko(ko({},R),{},{fill:"#eee"},C),w),Zp(i.props,T,I)),{},{onAnimationStart:i.handleAnimationStart,onAnimationEnd:i.handleAnimationEnd,dataKey:g,index:I,className:"recharts-bar-background-rectangle"});return De.createElement(FU,kE({key:"background-bar-".concat(I),option:i.props.background,isActive:I===o},F))})}},{key:"renderErrorBar",value:function(i,c){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var d=this.props,g=d.data,o=d.xAxis,w=d.yAxis,T=d.layout,I=d.children,C=ml(I,fA);if(!C)return null;var R=T==="vertical"?g[0].height/2:g[0].width/2,F=function(H,X){var q=Array.isArray(H.value)?H.value[1]:H.value;return{x:H.x,y:H.y,value:q,errorVal:Ls(H,X)}},G={clipPath:i?"url(#clipPath-".concat(c,")"):null};return De.createElement(Li,G,C.map(function(j){return De.cloneElement(j,{key:"error-bar-".concat(c,"-").concat(j.props.dataKey),data:g,xAxis:o,yAxis:w,layout:T,offset:R,dataPointFormatter:F})}))}},{key:"render",value:function(){var i=this.props,c=i.hide,d=i.data,g=i.className,o=i.xAxis,w=i.yAxis,T=i.left,I=i.top,C=i.width,R=i.height,F=i.isAnimationActive,G=i.background,j=i.id;if(c||!d||!d.length)return null;var H=this.state.isAnimationFinished,X=Gn("recharts-bar",g),q=o&&o.allowDataOverflow,Z=w&&w.allowDataOverflow,J=q||Z,ne=ni(j)?this.id:j;return De.createElement(Li,{className:X},q||Z?De.createElement("defs",null,De.createElement("clipPath",{id:"clipPath-".concat(ne)},De.createElement("rect",{x:q?T:T-C/2,y:Z?I:I-R/2,width:q?C:C*2,height:Z?R:R*2}))):null,De.createElement(Li,{className:"recharts-bar-rectangles",clipPath:J?"url(#clipPath-".concat(ne,")"):null},G?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(J,ne),(!F||H)&&Dd.renderCallByParent(this.props,d))}}],[{key:"getDerivedStateFromProps",value:function(i,c){return i.animationId!==c.prevAnimationId?{prevAnimationId:i.animationId,curData:i.data,prevData:c.curData}:i.data!==c.curData?{curData:i.data}:null}}])}(Q.PureComponent);wZ=hm;Sd(hm,"displayName","Bar");Sd(hm,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Hu.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});Sd(hm,"getComposedData",function(e){var t=e.props,r=e.item,i=e.barPosition,c=e.bandSize,d=e.xAxis,g=e.yAxis,o=e.xAxisTicks,w=e.yAxisTicks,T=e.stackedData,I=e.dataStartIndex,C=e.displayedData,R=e.offset,F=mCe(i,r);if(!F)return null;var G=t.layout,j=r.type.defaultProps,H=j!==void 0?ko(ko({},j),r.props):r.props,X=H.dataKey,q=H.children,Z=H.minPointSize,J=G==="horizontal"?g:d,ne=T?J.scale.domain():null,he=wCe({numericAxis:J}),me=ml(q,eA),Se=C.map(function(qe,Ze){var He,Ke,dt,$e,mt,ct;T?He=gCe(T[I+Ze],ne):(He=Ls(qe,X),Array.isArray(He)||(He=[he,He]));var St=mDe(Z,wZ.defaultProps.minPointSize)(He[1],Ze);if(G==="horizontal"){var Ue,st=[g.scale(He[0]),g.scale(He[1])],bt=st[0],At=st[1];Ke=O$({axis:d,ticks:o,bandSize:c,offset:F.offset,entry:qe,index:Ze}),dt=(Ue=At??bt)!==null&&Ue!==void 0?Ue:void 0,$e=F.size;var zt=bt-At;if(mt=Number.isNaN(zt)?0:zt,ct={x:Ke,y:g.y,width:$e,height:g.height},Math.abs(St)>0&&Math.abs(mt)<Math.abs(St)){var or=Ys(mt||St)*(Math.abs(St)-Math.abs(mt));dt-=or,mt+=or}}else{var Mr=[d.scale(He[0]),d.scale(He[1])],Ar=Mr[0],vr=Mr[1];if(Ke=Ar,dt=O$({axis:g,ticks:w,bandSize:c,offset:F.offset,entry:qe,index:Ze}),$e=vr-Ar,mt=F.size,ct={x:d.x,y:dt,width:d.width,height:mt},Math.abs(St)>0&&Math.abs($e)<Math.abs(St)){var nr=Ys($e||St)*(Math.abs(St)-Math.abs($e));$e+=nr}}return ko(ko(ko({},qe),{},{x:Ke,y:dt,width:$e,height:mt,value:T?He:He[1],payload:qe,background:ct},me&&me[Ze]&&me[Ze].props),{},{tooltipPayload:[H7(r,qe)],tooltipPosition:{x:Ke+$e/2,y:dt+mt/2}})});return ko({data:Se,layout:G},R)});function S1(e){"@babel/helpers - typeof";return S1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S1(e)}function ADe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function UU(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,EZ(i.key),i)}}function PDe(e,t,r){return t&&UU(e.prototype,t),r&&UU(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function VU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function tc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VU(Object(r),!0).forEach(function(i){xA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xA(e,t,r){return t=EZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EZ(e){var t=CDe(e,"string");return S1(t)=="symbol"?t:t+""}function CDe(e,t){if(S1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(S1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var IDe=function(t,r,i,c,d){var g=t.width,o=t.height,w=t.layout,T=t.children,I=Object.keys(r),C={left:i.left,leftMirror:i.left,right:g-i.right,rightMirror:g-i.right,top:i.top,topMirror:i.top,bottom:o-i.bottom,bottomMirror:o-i.bottom},R=!!za(T,hm);return I.reduce(function(F,G){var j=r[G],H=j.orientation,X=j.domain,q=j.padding,Z=q===void 0?{}:q,J=j.mirror,ne=j.reversed,he="".concat(H).concat(J?"Mirror":""),me,Se,qe,Ze,He;if(j.type==="number"&&(j.padding==="gap"||j.padding==="no-gap")){var Ke=X[1]-X[0],dt=1/0,$e=j.categoricalDomain.sort();if($e.forEach(function(Mr,Ar){Ar>0&&(dt=Math.min((Mr||0)-($e[Ar-1]||0),dt))}),Number.isFinite(dt)){var mt=dt/Ke,ct=j.layout==="vertical"?i.height:i.width;if(j.padding==="gap"&&(me=mt*ct/2),j.padding==="no-gap"){var St=Js(t.barCategoryGap,mt*ct),Ue=mt*ct/2;me=Ue-St-(Ue-St)/ct*St}}}c==="xAxis"?Se=[i.left+(Z.left||0)+(me||0),i.left+i.width-(Z.right||0)-(me||0)]:c==="yAxis"?Se=w==="horizontal"?[i.top+i.height-(Z.bottom||0),i.top+(Z.top||0)]:[i.top+(Z.top||0)+(me||0),i.top+i.height-(Z.bottom||0)-(me||0)]:Se=j.range,ne&&(Se=[Se[1],Se[0]]);var st=$7(j,d,R),bt=st.scale,At=st.realScaleType;bt.domain(X).range(Se),U7(bt);var zt=V7(bt,tc(tc({},j),{},{realScaleType:At}));c==="xAxis"?(He=H==="top"&&!J||H==="bottom"&&J,qe=i.left,Ze=C[he]-He*j.height):c==="yAxis"&&(He=H==="left"&&!J||H==="right"&&J,qe=C[he]-He*j.width,Ze=i.top);var or=tc(tc(tc({},j),zt),{},{realScaleType:At,x:qe,y:Ze,scale:bt,width:c==="xAxis"?i.width:j.width,height:c==="yAxis"?i.height:j.height});return or.bandSize=yE(or,zt),!j.hide&&c==="xAxis"?C[he]+=(He?-1:1)*or.height:j.hide||(C[he]+=(He?-1:1)*or.width),tc(tc({},F),{},xA({},G,or))},{})},AZ=function(t,r){var i=t.x,c=t.y,d=r.x,g=r.y;return{x:Math.min(i,d),y:Math.min(c,g),width:Math.abs(d-i),height:Math.abs(g-c)}},ODe=function(t){var r=t.x1,i=t.y1,c=t.x2,d=t.y2;return AZ({x:r,y:i},{x:c,y:d})},PZ=function(){function e(t){ADe(this,e),this.scale=t}return PDe(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=i.bandAware,d=i.position;if(r!==void 0){if(d)switch(d){case"start":return this.scale(r);case"middle":{var g=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+g}case"end":{var o=this.bandwidth?this.bandwidth():0;return this.scale(r)+o}default:return this.scale(r)}if(c){var w=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+w}return this.scale(r)}}},{key:"isInRange",value:function(r){var i=this.range(),c=i[0],d=i[i.length-1];return c<=d?r>=c&&r<=d:r>=d&&r<=c}}],[{key:"create",value:function(r){return new e(r)}}])}();xA(PZ,"EPS",1e-4);var zL=function(t){var r=Object.keys(t).reduce(function(i,c){return tc(tc({},i),{},xA({},c,PZ.create(t[c])))},{});return tc(tc({},r),{},{apply:function(c){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=d.bandAware,o=d.position;return Xke(c,function(w,T){return r[T].apply(w,{bandAware:g,position:o})})},isInRange:function(c){return bZ(c,function(d,g){return r[g].isInRange(d)})}})};function MDe(e){return(e%180+180)%180}var RDe=function(t){var r=t.width,i=t.height,c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,d=MDe(c),g=d*Math.PI/180,o=Math.atan(i/r),w=g>o&&g<Math.PI-o?i/Math.sin(g):r/Math.cos(g);return Math.abs(w)},kDe=nu,DDe=X1,LDe=Y2;function zDe(e){return function(t,r,i){var c=Object(t);if(!DDe(t)){var d=kDe(r);t=LDe(t),r=function(o){return d(c[o],o,c)}}var g=e(t,r,i);return g>-1?c[d?t[g]:g]:void 0}}var NDe=zDe,jDe=_Z;function FDe(e){var t=jDe(e),r=t%1;return t===t?r?t-r:t:0}var BDe=FDe,$De=b9,UDe=nu,VDe=BDe,GDe=Math.max;function HDe(e,t,r){var i=e==null?0:e.length;if(!i)return-1;var c=r==null?0:VDe(r);return c<0&&(c=GDe(i+c,0)),$De(e,UDe(t),c)}var WDe=HDe,qDe=NDe,ZDe=WDe,XDe=qDe(ZDe),KDe=XDe;const YDe=Ii(KDe);var JDe=ime(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),NL=Q.createContext(void 0),jL=Q.createContext(void 0),CZ=Q.createContext(void 0),IZ=Q.createContext({}),OZ=Q.createContext(void 0),MZ=Q.createContext(0),RZ=Q.createContext(0),GU=function(t){var r=t.state,i=r.xAxisMap,c=r.yAxisMap,d=r.offset,g=t.clipPathId,o=t.children,w=t.width,T=t.height,I=JDe(d);return De.createElement(NL.Provider,{value:i},De.createElement(jL.Provider,{value:c},De.createElement(IZ.Provider,{value:d},De.createElement(CZ.Provider,{value:I},De.createElement(OZ.Provider,{value:g},De.createElement(MZ.Provider,{value:T},De.createElement(RZ.Provider,{value:w},o)))))))},QDe=function(){return Q.useContext(OZ)},kZ=function(t){var r=Q.useContext(NL);r==null&&Yp();var i=r[t];return i==null&&Yp(),i},eLe=function(){var t=Q.useContext(NL);return pd(t)},tLe=function(){var t=Q.useContext(jL),r=YDe(t,function(i){return bZ(i.domain,Number.isFinite)});return r||pd(t)},DZ=function(t){var r=Q.useContext(jL);r==null&&Yp();var i=r[t];return i==null&&Yp(),i},rLe=function(){var t=Q.useContext(CZ);return t},nLe=function(){return Q.useContext(IZ)},FL=function(){return Q.useContext(RZ)},BL=function(){return Q.useContext(MZ)};function ey(e){"@babel/helpers - typeof";return ey=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ey(e)}function iLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oLe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,zZ(i.key),i)}}function sLe(e,t,r){return t&&oLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function aLe(e,t,r){return t=LE(t),lLe(e,LZ()?Reflect.construct(t,r||[],LE(e).constructor):t.apply(e,r))}function lLe(e,t){if(t&&(ey(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cLe(e)}function cLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function LZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(LZ=function(){return!!e})()}function LE(e){return LE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},LE(e)}function uLe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&MR(e,t)}function MR(e,t){return MR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},MR(e,t)}function HU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function WU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HU(Object(r),!0).forEach(function(i){$L(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function $L(e,t,r){return t=zZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function zZ(e){var t=hLe(e,"string");return ey(t)=="symbol"?t:t+""}function hLe(e,t){if(ey(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(ey(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dLe(e,t){return gLe(e)||mLe(e,t)||pLe(e,t)||fLe()}function fLe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function pLe(e,t){if(e){if(typeof e=="string")return qU(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qU(e,t)}}function qU(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function mLe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function gLe(e){if(Array.isArray(e))return e}function RR(){return RR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},RR.apply(this,arguments)}var _Le=function(t,r){var i;return De.isValidElement(t)?i=De.cloneElement(t,r):An(t)?i=t(r):i=De.createElement("line",RR({},r,{className:"recharts-reference-line-line"})),i},yLe=function(t,r,i,c,d,g,o,w,T){var I=d.x,C=d.y,R=d.width,F=d.height;if(i){var G=T.y,j=t.y.apply(G,{position:g});if(Jc(T,"discard")&&!t.y.isInRange(j))return null;var H=[{x:I+R,y:j},{x:I,y:j}];return w==="left"?H.reverse():H}if(r){var X=T.x,q=t.x.apply(X,{position:g});if(Jc(T,"discard")&&!t.x.isInRange(q))return null;var Z=[{x:q,y:C+F},{x:q,y:C}];return o==="top"?Z.reverse():Z}if(c){var J=T.segment,ne=J.map(function(he){return t.apply(he,{position:g})});return Jc(T,"discard")&&$ke(ne,function(he){return!t.isInRange(he)})?null:ne}return null};function vLe(e){var t=e.x,r=e.y,i=e.segment,c=e.xAxisId,d=e.yAxisId,g=e.shape,o=e.className,w=e.alwaysShow,T=QDe(),I=kZ(c),C=DZ(d),R=rLe();if(!T||!R)return null;sc(w===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var F=zL({x:I.scale,y:C.scale}),G=Wo(t),j=Wo(r),H=i&&i.length===2,X=yLe(F,G,j,H,R,e.position,I.orientation,C.orientation,e);if(!X)return null;var q=dLe(X,2),Z=q[0],J=Z.x,ne=Z.y,he=q[1],me=he.x,Se=he.y,qe=Jc(e,"hidden")?"url(#".concat(T,")"):void 0,Ze=WU(WU({clipPath:qe},hn(e,!0)),{},{x1:J,y1:ne,x2:me,y2:Se});return De.createElement(Li,{className:Gn("recharts-reference-line",o)},_Le(g,Ze),os.renderCallByParent(e,ODe({x1:J,y1:ne,x2:me,y2:Se})))}var UL=function(e){function t(){return iLe(this,t),aLe(this,t,arguments)}return uLe(t,e),sLe(t,[{key:"render",value:function(){return De.createElement(vLe,this.props)}}])}(De.Component);$L(UL,"displayName","ReferenceLine");$L(UL,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function kR(){return kR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},kR.apply(this,arguments)}function ty(e){"@babel/helpers - typeof";return ty=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ty(e)}function ZU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function XU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZU(Object(r),!0).forEach(function(i){bA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function xLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bLe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,jZ(i.key),i)}}function wLe(e,t,r){return t&&bLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function SLe(e,t,r){return t=zE(t),TLe(e,NZ()?Reflect.construct(t,r||[],zE(e).constructor):t.apply(e,r))}function TLe(e,t){if(t&&(ty(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ELe(e)}function ELe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NZ=function(){return!!e})()}function zE(e){return zE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zE(e)}function ALe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&DR(e,t)}function DR(e,t){return DR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},DR(e,t)}function bA(e,t,r){return t=jZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jZ(e){var t=PLe(e,"string");return ty(t)=="symbol"?t:t+""}function PLe(e,t){if(ty(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(ty(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var CLe=function(t){var r=t.x,i=t.y,c=t.xAxis,d=t.yAxis,g=zL({x:c.scale,y:d.scale}),o=g.apply({x:r,y:i},{bandAware:!0});return Jc(t,"discard")&&!g.isInRange(o)?null:o},wA=function(e){function t(){return xLe(this,t),SLe(this,t,arguments)}return ALe(t,e),wLe(t,[{key:"render",value:function(){var i=this.props,c=i.x,d=i.y,g=i.r,o=i.alwaysShow,w=i.clipPathId,T=Wo(c),I=Wo(d);if(sc(o===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!T||!I)return null;var C=CLe(this.props);if(!C)return null;var R=C.x,F=C.y,G=this.props,j=G.shape,H=G.className,X=Jc(this.props,"hidden")?"url(#".concat(w,")"):void 0,q=XU(XU({clipPath:X},hn(this.props,!0)),{},{cx:R,cy:F});return De.createElement(Li,{className:Gn("recharts-reference-dot",H)},t.renderDot(j,q),os.renderCallByParent(this.props,{x:R-g,y:F-g,width:2*g,height:2*g}))}}])}(De.Component);bA(wA,"displayName","ReferenceDot");bA(wA,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});bA(wA,"renderDot",function(e,t){var r;return De.isValidElement(e)?r=De.cloneElement(e,t):An(e)?r=e(t):r=De.createElement(LL,kR({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function LR(){return LR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},LR.apply(this,arguments)}function ry(e){"@babel/helpers - typeof";return ry=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ry(e)}function KU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function YU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?KU(Object(r),!0).forEach(function(i){SA(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):KU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ILe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OLe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,BZ(i.key),i)}}function MLe(e,t,r){return t&&OLe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function RLe(e,t,r){return t=NE(t),kLe(e,FZ()?Reflect.construct(t,r||[],NE(e).constructor):t.apply(e,r))}function kLe(e,t){if(t&&(ry(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return DLe(e)}function DLe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function FZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(FZ=function(){return!!e})()}function NE(e){return NE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},NE(e)}function LLe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zR(e,t)}function zR(e,t){return zR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},zR(e,t)}function SA(e,t,r){return t=BZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BZ(e){var t=zLe(e,"string");return ry(t)=="symbol"?t:t+""}function zLe(e,t){if(ry(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(ry(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var NLe=function(t,r,i,c,d){var g=d.x1,o=d.x2,w=d.y1,T=d.y2,I=d.xAxis,C=d.yAxis;if(!I||!C)return null;var R=zL({x:I.scale,y:C.scale}),F={x:t?R.x.apply(g,{position:"start"}):R.x.rangeMin,y:i?R.y.apply(w,{position:"start"}):R.y.rangeMin},G={x:r?R.x.apply(o,{position:"end"}):R.x.rangeMax,y:c?R.y.apply(T,{position:"end"}):R.y.rangeMax};return Jc(d,"discard")&&(!R.isInRange(F)||!R.isInRange(G))?null:AZ(F,G)},TA=function(e){function t(){return ILe(this,t),RLe(this,t,arguments)}return LLe(t,e),MLe(t,[{key:"render",value:function(){var i=this.props,c=i.x1,d=i.x2,g=i.y1,o=i.y2,w=i.className,T=i.alwaysShow,I=i.clipPathId;sc(T===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var C=Wo(c),R=Wo(d),F=Wo(g),G=Wo(o),j=this.props.shape;if(!C&&!R&&!F&&!G&&!j)return null;var H=NLe(C,R,F,G,this.props);if(!H&&!j)return null;var X=Jc(this.props,"hidden")?"url(#".concat(I,")"):void 0;return De.createElement(Li,{className:Gn("recharts-reference-area",w)},t.renderRect(j,YU(YU({clipPath:X},hn(this.props,!0)),H)),os.renderCallByParent(this.props,H))}}])}(De.Component);SA(TA,"displayName","ReferenceArea");SA(TA,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});SA(TA,"renderRect",function(e,t){var r;return De.isValidElement(e)?r=De.cloneElement(e,t):An(e)?r=e(t):r=De.createElement(DL,LR({},t,{className:"recharts-reference-area-rect"})),r});function $Z(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var i=[],c=0;c<e.length;c+=t)i.push(e[c]);return i}function jLe(e,t,r){var i={width:e.width+t.width,height:e.height+t.height};return RDe(i,r)}function FLe(e,t,r){var i=r==="width",c=e.x,d=e.y,g=e.width,o=e.height;return t===1?{start:i?c:d,end:i?c+g:d+o}:{start:i?c+g:d+o,end:i?c:d}}function jE(e,t,r,i,c){if(e*t<e*i||e*t>e*c)return!1;var d=r();return e*(t-e*d/2-i)>=0&&e*(t+e*d/2-c)<=0}function BLe(e,t){return $Z(e,t+1)}function $Le(e,t,r,i,c){for(var d=(i||[]).slice(),g=t.start,o=t.end,w=0,T=1,I=g,C=function(){var G=i==null?void 0:i[w];if(G===void 0)return{v:$Z(i,T)};var j=w,H,X=function(){return H===void 0&&(H=r(G,j)),H},q=G.coordinate,Z=w===0||jE(e,q,X,I,o);Z||(w=0,I=g,T+=1),Z&&(I=q+e*(X()/2+c),w+=T)},R;T<=d.length;)if(R=C(),R)return R.v;return[]}function T1(e){"@babel/helpers - typeof";return T1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},T1(e)}function JU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Rs(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?JU(Object(r),!0).forEach(function(i){ULe(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):JU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ULe(e,t,r){return t=VLe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VLe(e){var t=GLe(e,"string");return T1(t)=="symbol"?t:t+""}function GLe(e,t){if(T1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(T1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function HLe(e,t,r,i,c){for(var d=(i||[]).slice(),g=d.length,o=t.start,w=t.end,T=function(R){var F=d[R],G,j=function(){return G===void 0&&(G=r(F,R)),G};if(R===g-1){var H=e*(F.coordinate+e*j()/2-w);d[R]=F=Rs(Rs({},F),{},{tickCoord:H>0?F.coordinate-H*e:F.coordinate})}else d[R]=F=Rs(Rs({},F),{},{tickCoord:F.coordinate});var X=jE(e,F.tickCoord,j,o,w);X&&(w=F.tickCoord-e*(j()/2+c),d[R]=Rs(Rs({},F),{},{isShow:!0}))},I=g-1;I>=0;I--)T(I);return d}function WLe(e,t,r,i,c,d){var g=(i||[]).slice(),o=g.length,w=t.start,T=t.end;if(d){var I=i[o-1],C=r(I,o-1),R=e*(I.coordinate+e*C/2-T);g[o-1]=I=Rs(Rs({},I),{},{tickCoord:R>0?I.coordinate-R*e:I.coordinate});var F=jE(e,I.tickCoord,function(){return C},w,T);F&&(T=I.tickCoord-e*(C/2+c),g[o-1]=Rs(Rs({},I),{},{isShow:!0}))}for(var G=d?o-1:o,j=function(q){var Z=g[q],J,ne=function(){return J===void 0&&(J=r(Z,q)),J};if(q===0){var he=e*(Z.coordinate-e*ne()/2-w);g[q]=Z=Rs(Rs({},Z),{},{tickCoord:he<0?Z.coordinate-he*e:Z.coordinate})}else g[q]=Z=Rs(Rs({},Z),{},{tickCoord:Z.coordinate});var me=jE(e,Z.tickCoord,ne,w,T);me&&(w=Z.tickCoord+e*(ne()/2+c),g[q]=Rs(Rs({},Z),{},{isShow:!0}))},H=0;H<G;H++)j(H);return g}function VL(e,t,r){var i=e.tick,c=e.ticks,d=e.viewBox,g=e.minTickGap,o=e.orientation,w=e.interval,T=e.tickFormatter,I=e.unit,C=e.angle;if(!c||!c.length||!i)return[];if(gr(w)||Hu.isSsr)return BLe(c,typeof w=="number"&&gr(w)?w:0);var R=[],F=o==="top"||o==="bottom"?"width":"height",G=I&&F==="width"?fx(I,{fontSize:t,letterSpacing:r}):{width:0,height:0},j=function(Z,J){var ne=An(T)?T(Z.value,J):Z.value;return F==="width"?jLe(fx(ne,{fontSize:t,letterSpacing:r}),G,C):fx(ne,{fontSize:t,letterSpacing:r})[F]},H=c.length>=2?Ys(c[1].coordinate-c[0].coordinate):1,X=FLe(d,H,F);return w==="equidistantPreserveStart"?$Le(H,X,j,c,g):(w==="preserveStart"||w==="preserveStartEnd"?R=WLe(H,X,j,c,g,w==="preserveStartEnd"):R=HLe(H,X,j,c,g),R.filter(function(q){return q.isShow}))}var qLe=["viewBox"],ZLe=["viewBox"],XLe=["ticks"];function ny(e){"@babel/helpers - typeof";return ny=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ny(e)}function n_(){return n_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},n_.apply(this,arguments)}function QU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Ws(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?QU(Object(r),!0).forEach(function(i){GL(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QU(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function KI(e,t){if(e==null)return{};var r=KLe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function KLe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function YLe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eV(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,VZ(i.key),i)}}function JLe(e,t,r){return t&&eV(e.prototype,t),r&&eV(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function QLe(e,t,r){return t=FE(t),eze(e,UZ()?Reflect.construct(t,r||[],FE(e).constructor):t.apply(e,r))}function eze(e,t){if(t&&(ny(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tze(e)}function tze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function UZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(UZ=function(){return!!e})()}function FE(e){return FE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},FE(e)}function rze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&NR(e,t)}function NR(e,t){return NR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},NR(e,t)}function GL(e,t,r){return t=VZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VZ(e){var t=nze(e,"string");return ny(t)=="symbol"?t:t+""}function nze(e,t){if(ny(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(ny(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ry=function(e){function t(r){var i;return YLe(this,t),i=QLe(this,t,[r]),i.state={fontSize:"",letterSpacing:""},i}return rze(t,e),JLe(t,[{key:"shouldComponentUpdate",value:function(i,c){var d=i.viewBox,g=KI(i,qLe),o=this.props,w=o.viewBox,T=KI(o,ZLe);return!f_(d,w)||!f_(g,T)||!f_(c,this.state)}},{key:"componentDidMount",value:function(){var i=this.layerReference;if(i){var c=i.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];c&&this.setState({fontSize:window.getComputedStyle(c).fontSize,letterSpacing:window.getComputedStyle(c).letterSpacing})}}},{key:"getTickLineCoord",value:function(i){var c=this.props,d=c.x,g=c.y,o=c.width,w=c.height,T=c.orientation,I=c.tickSize,C=c.mirror,R=c.tickMargin,F,G,j,H,X,q,Z=C?-1:1,J=i.tickSize||I,ne=gr(i.tickCoord)?i.tickCoord:i.coordinate;switch(T){case"top":F=G=i.coordinate,H=g+ +!C*w,j=H-Z*J,q=j-Z*R,X=ne;break;case"left":j=H=i.coordinate,G=d+ +!C*o,F=G-Z*J,X=F-Z*R,q=ne;break;case"right":j=H=i.coordinate,G=d+ +C*o,F=G+Z*J,X=F+Z*R,q=ne;break;default:F=G=i.coordinate,H=g+ +C*w,j=H+Z*J,q=j+Z*R,X=ne;break}return{line:{x1:F,y1:j,x2:G,y2:H},tick:{x:X,y:q}}}},{key:"getTickTextAnchor",value:function(){var i=this.props,c=i.orientation,d=i.mirror,g;switch(c){case"left":g=d?"start":"end";break;case"right":g=d?"end":"start";break;default:g="middle";break}return g}},{key:"getTickVerticalAnchor",value:function(){var i=this.props,c=i.orientation,d=i.mirror,g="end";switch(c){case"left":case"right":g="middle";break;case"top":g=d?"start":"end";break;default:g=d?"end":"start";break}return g}},{key:"renderAxisLine",value:function(){var i=this.props,c=i.x,d=i.y,g=i.width,o=i.height,w=i.orientation,T=i.mirror,I=i.axisLine,C=Ws(Ws(Ws({},hn(this.props,!1)),hn(I,!1)),{},{fill:"none"});if(w==="top"||w==="bottom"){var R=+(w==="top"&&!T||w==="bottom"&&T);C=Ws(Ws({},C),{},{x1:c,y1:d+R*o,x2:c+g,y2:d+R*o})}else{var F=+(w==="left"&&!T||w==="right"&&T);C=Ws(Ws({},C),{},{x1:c+F*g,y1:d,x2:c+F*g,y2:d+o})}return De.createElement("line",n_({},C,{className:Gn("recharts-cartesian-axis-line",Va(I,"className"))}))}},{key:"renderTicks",value:function(i,c,d){var g=this,o=this.props,w=o.tickLine,T=o.stroke,I=o.tick,C=o.tickFormatter,R=o.unit,F=VL(Ws(Ws({},this.props),{},{ticks:i}),c,d),G=this.getTickTextAnchor(),j=this.getTickVerticalAnchor(),H=hn(this.props,!1),X=hn(I,!1),q=Ws(Ws({},H),{},{fill:"none"},hn(w,!1)),Z=F.map(function(J,ne){var he=g.getTickLineCoord(J),me=he.line,Se=he.tick,qe=Ws(Ws(Ws(Ws({textAnchor:G,verticalAnchor:j},H),{},{stroke:"none",fill:T},X),Se),{},{index:ne,payload:J,visibleTicksCount:F.length,tickFormatter:C});return De.createElement(Li,n_({className:"recharts-cartesian-axis-tick",key:"tick-".concat(J.value,"-").concat(J.coordinate,"-").concat(J.tickCoord)},Zp(g.props,J,ne)),w&&De.createElement("line",n_({},q,me,{className:Gn("recharts-cartesian-axis-tick-line",Va(w,"className"))})),I&&t.renderTickItem(I,qe,"".concat(An(C)?C(J.value,ne):J.value).concat(R||"")))});return De.createElement("g",{className:"recharts-cartesian-axis-ticks"},Z)}},{key:"render",value:function(){var i=this,c=this.props,d=c.axisLine,g=c.width,o=c.height,w=c.ticksGenerator,T=c.className,I=c.hide;if(I)return null;var C=this.props,R=C.ticks,F=KI(C,XLe),G=R;return An(w)&&(G=R&&R.length>0?w(this.props):w(F)),g<=0||o<=0||!G||!G.length?null:De.createElement(Li,{className:Gn("recharts-cartesian-axis",T),ref:function(H){i.layerReference=H}},d&&this.renderAxisLine(),this.renderTicks(G,this.state.fontSize,this.state.letterSpacing),os.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(i,c,d){var g;return De.isValidElement(i)?g=De.cloneElement(i,c):An(i)?g=i(c):g=De.createElement(Xp,n_({},c,{className:"recharts-cartesian-axis-tick-value"}),d),g}}])}(Q.Component);GL(Ry,"displayName","CartesianAxis");GL(Ry,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var ize=["x1","y1","x2","y2","key"],oze=["offset"];function Jp(e){"@babel/helpers - typeof";return Jp=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jp(e)}function tV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Ds(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tV(Object(r),!0).forEach(function(i){sze(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function sze(e,t,r){return t=aze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aze(e){var t=lze(e,"string");return Jp(t)=="symbol"?t:t+""}function lze(e,t){if(Jp(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(Jp(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Cp(){return Cp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Cp.apply(this,arguments)}function rV(e,t){if(e==null)return{};var r=cze(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function cze(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}var uze=function(t){var r=t.fill;if(!r||r==="none")return null;var i=t.fillOpacity,c=t.x,d=t.y,g=t.width,o=t.height,w=t.ry;return De.createElement("rect",{x:c,y:d,ry:w,width:g,height:o,stroke:"none",fill:r,fillOpacity:i,className:"recharts-cartesian-grid-bg"})};function GZ(e,t){var r;if(De.isValidElement(e))r=De.cloneElement(e,t);else if(An(e))r=e(t);else{var i=t.x1,c=t.y1,d=t.x2,g=t.y2,o=t.key,w=rV(t,ize),T=hn(w,!1);T.offset;var I=rV(T,oze);r=De.createElement("line",Cp({},I,{x1:i,y1:c,x2:d,y2:g,fill:"none",key:o}))}return r}function hze(e){var t=e.x,r=e.width,i=e.horizontal,c=i===void 0?!0:i,d=e.horizontalPoints;if(!c||!d||!d.length)return null;var g=d.map(function(o,w){var T=Ds(Ds({},e),{},{x1:t,y1:o,x2:t+r,y2:o,key:"line-".concat(w),index:w});return GZ(c,T)});return De.createElement("g",{className:"recharts-cartesian-grid-horizontal"},g)}function dze(e){var t=e.y,r=e.height,i=e.vertical,c=i===void 0?!0:i,d=e.verticalPoints;if(!c||!d||!d.length)return null;var g=d.map(function(o,w){var T=Ds(Ds({},e),{},{x1:o,y1:t,x2:o,y2:t+r,key:"line-".concat(w),index:w});return GZ(c,T)});return De.createElement("g",{className:"recharts-cartesian-grid-vertical"},g)}function fze(e){var t=e.horizontalFill,r=e.fillOpacity,i=e.x,c=e.y,d=e.width,g=e.height,o=e.horizontalPoints,w=e.horizontal,T=w===void 0?!0:w;if(!T||!t||!t.length)return null;var I=o.map(function(R){return Math.round(R+c-c)}).sort(function(R,F){return R-F});c!==I[0]&&I.unshift(0);var C=I.map(function(R,F){var G=!I[F+1],j=G?c+g-R:I[F+1]-R;if(j<=0)return null;var H=F%t.length;return De.createElement("rect",{key:"react-".concat(F),y:R,x:i,height:j,width:d,stroke:"none",fill:t[H],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return De.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},C)}function pze(e){var t=e.vertical,r=t===void 0?!0:t,i=e.verticalFill,c=e.fillOpacity,d=e.x,g=e.y,o=e.width,w=e.height,T=e.verticalPoints;if(!r||!i||!i.length)return null;var I=T.map(function(R){return Math.round(R+d-d)}).sort(function(R,F){return R-F});d!==I[0]&&I.unshift(0);var C=I.map(function(R,F){var G=!I[F+1],j=G?d+o-R:I[F+1]-R;if(j<=0)return null;var H=F%i.length;return De.createElement("rect",{key:"react-".concat(F),x:R,y:g,width:j,height:w,stroke:"none",fill:i[H],fillOpacity:c,className:"recharts-cartesian-grid-bg"})});return De.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},C)}var mze=function(t,r){var i=t.xAxis,c=t.width,d=t.height,g=t.offset;return B7(VL(Ds(Ds(Ds({},Ry.defaultProps),i),{},{ticks:Uu(i,!0),viewBox:{x:0,y:0,width:c,height:d}})),g.left,g.left+g.width,r)},gze=function(t,r){var i=t.yAxis,c=t.width,d=t.height,g=t.offset;return B7(VL(Ds(Ds(Ds({},Ry.defaultProps),i),{},{ticks:Uu(i,!0),viewBox:{x:0,y:0,width:c,height:d}})),g.top,g.top+g.height,r)},Bg={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function HZ(e){var t,r,i,c,d,g,o=FL(),w=BL(),T=nLe(),I=Ds(Ds({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:Bg.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:Bg.fill,horizontal:(i=e.horizontal)!==null&&i!==void 0?i:Bg.horizontal,horizontalFill:(c=e.horizontalFill)!==null&&c!==void 0?c:Bg.horizontalFill,vertical:(d=e.vertical)!==null&&d!==void 0?d:Bg.vertical,verticalFill:(g=e.verticalFill)!==null&&g!==void 0?g:Bg.verticalFill,x:gr(e.x)?e.x:T.left,y:gr(e.y)?e.y:T.top,width:gr(e.width)?e.width:T.width,height:gr(e.height)?e.height:T.height}),C=I.x,R=I.y,F=I.width,G=I.height,j=I.syncWithTicks,H=I.horizontalValues,X=I.verticalValues,q=eLe(),Z=tLe();if(!gr(F)||F<=0||!gr(G)||G<=0||!gr(C)||C!==+C||!gr(R)||R!==+R)return null;var J=I.verticalCoordinatesGenerator||mze,ne=I.horizontalCoordinatesGenerator||gze,he=I.horizontalPoints,me=I.verticalPoints;if((!he||!he.length)&&An(ne)){var Se=H&&H.length,qe=ne({yAxis:Z?Ds(Ds({},Z),{},{ticks:Se?H:Z.ticks}):void 0,width:o,height:w,offset:T},Se?!0:j);sc(Array.isArray(qe),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Jp(qe),"]")),Array.isArray(qe)&&(he=qe)}if((!me||!me.length)&&An(J)){var Ze=X&&X.length,He=J({xAxis:q?Ds(Ds({},q),{},{ticks:Ze?X:q.ticks}):void 0,width:o,height:w,offset:T},Ze?!0:j);sc(Array.isArray(He),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Jp(He),"]")),Array.isArray(He)&&(me=He)}return De.createElement("g",{className:"recharts-cartesian-grid"},De.createElement(uze,{fill:I.fill,fillOpacity:I.fillOpacity,x:I.x,y:I.y,width:I.width,height:I.height,ry:I.ry}),De.createElement(hze,Cp({},I,{offset:T,horizontalPoints:he,xAxis:q,yAxis:Z})),De.createElement(dze,Cp({},I,{offset:T,verticalPoints:me,xAxis:q,yAxis:Z})),De.createElement(fze,Cp({},I,{horizontalPoints:he})),De.createElement(pze,Cp({},I,{verticalPoints:me})))}HZ.displayName="CartesianGrid";function iy(e){"@babel/helpers - typeof";return iy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iy(e)}function _ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yze(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ZZ(i.key),i)}}function vze(e,t,r){return t&&yze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function xze(e,t,r){return t=BE(t),bze(e,WZ()?Reflect.construct(t,r||[],BE(e).constructor):t.apply(e,r))}function bze(e,t){if(t&&(iy(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wze(e)}function wze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function WZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(WZ=function(){return!!e})()}function BE(e){return BE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},BE(e)}function Sze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&jR(e,t)}function jR(e,t){return jR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},jR(e,t)}function qZ(e,t,r){return t=ZZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZZ(e){var t=Tze(e,"string");return iy(t)=="symbol"?t:t+""}function Tze(e,t){if(iy(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(iy(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function FR(){return FR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},FR.apply(this,arguments)}function Eze(e){var t=e.xAxisId,r=FL(),i=BL(),c=kZ(t);return c==null?null:De.createElement(Ry,FR({},c,{className:Gn("recharts-".concat(c.axisType," ").concat(c.axisType),c.className),viewBox:{x:0,y:0,width:r,height:i},ticksGenerator:function(g){return Uu(g,!0)}}))}var EA=function(e){function t(){return _ze(this,t),xze(this,t,arguments)}return Sze(t,e),vze(t,[{key:"render",value:function(){return De.createElement(Eze,this.props)}}])}(De.Component);qZ(EA,"displayName","XAxis");qZ(EA,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function oy(e){"@babel/helpers - typeof";return oy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oy(e)}function Aze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pze(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,YZ(i.key),i)}}function Cze(e,t,r){return t&&Pze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ize(e,t,r){return t=$E(t),Oze(e,XZ()?Reflect.construct(t,r||[],$E(e).constructor):t.apply(e,r))}function Oze(e,t){if(t&&(oy(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Mze(e)}function Mze(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function XZ(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(XZ=function(){return!!e})()}function $E(e){return $E=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},$E(e)}function Rze(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&BR(e,t)}function BR(e,t){return BR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},BR(e,t)}function KZ(e,t,r){return t=YZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YZ(e){var t=kze(e,"string");return oy(t)=="symbol"?t:t+""}function kze(e,t){if(oy(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(oy(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $R(){return $R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},$R.apply(this,arguments)}var Dze=function(t){var r=t.yAxisId,i=FL(),c=BL(),d=DZ(r);return d==null?null:De.createElement(Ry,$R({},d,{className:Gn("recharts-".concat(d.axisType," ").concat(d.axisType),d.className),viewBox:{x:0,y:0,width:i,height:c},ticksGenerator:function(o){return Uu(o,!0)}}))},AA=function(e){function t(){return Aze(this,t),Ize(this,t,arguments)}return Rze(t,e),Cze(t,[{key:"render",value:function(){return De.createElement(Dze,this.props)}}])}(De.Component);KZ(AA,"displayName","YAxis");KZ(AA,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function nV(e){return jze(e)||Nze(e)||zze(e)||Lze()}function Lze(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zze(e,t){if(e){if(typeof e=="string")return UR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return UR(e,t)}}function Nze(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function jze(e){if(Array.isArray(e))return UR(e)}function UR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var VR=function(t,r,i,c,d){var g=ml(t,UL),o=ml(t,wA),w=[].concat(nV(g),nV(o)),T=ml(t,TA),I="".concat(c,"Id"),C=c[0],R=r;if(w.length&&(R=w.reduce(function(j,H){if(H.props[I]===i&&Jc(H.props,"extendDomain")&&gr(H.props[C])){var X=H.props[C];return[Math.min(j[0],X),Math.max(j[1],X)]}return j},R)),T.length){var F="".concat(C,"1"),G="".concat(C,"2");R=T.reduce(function(j,H){if(H.props[I]===i&&Jc(H.props,"extendDomain")&&gr(H.props[F])&&gr(H.props[G])){var X=H.props[F],q=H.props[G];return[Math.min(j[0],X,q),Math.max(j[1],X,q)]}return j},R)}return d&&d.length&&(R=d.reduce(function(j,H){return gr(H)?[Math.min(j[0],H),Math.max(j[1],H)]:j},R)),R},JZ={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function c(w,T,I){this.fn=w,this.context=T,this.once=I||!1}function d(w,T,I,C,R){if(typeof I!="function")throw new TypeError("The listener must be a function");var F=new c(I,C||w,R),G=r?r+T:T;return w._events[G]?w._events[G].fn?w._events[G]=[w._events[G],F]:w._events[G].push(F):(w._events[G]=F,w._eventsCount++),w}function g(w,T){--w._eventsCount===0?w._events=new i:delete w._events[T]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var T=[],I,C;if(this._eventsCount===0)return T;for(C in I=this._events)t.call(I,C)&&T.push(r?C.slice(1):C);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(I)):T},o.prototype.listeners=function(T){var I=r?r+T:T,C=this._events[I];if(!C)return[];if(C.fn)return[C.fn];for(var R=0,F=C.length,G=new Array(F);R<F;R++)G[R]=C[R].fn;return G},o.prototype.listenerCount=function(T){var I=r?r+T:T,C=this._events[I];return C?C.fn?1:C.length:0},o.prototype.emit=function(T,I,C,R,F,G){var j=r?r+T:T;if(!this._events[j])return!1;var H=this._events[j],X=arguments.length,q,Z;if(H.fn){switch(H.once&&this.removeListener(T,H.fn,void 0,!0),X){case 1:return H.fn.call(H.context),!0;case 2:return H.fn.call(H.context,I),!0;case 3:return H.fn.call(H.context,I,C),!0;case 4:return H.fn.call(H.context,I,C,R),!0;case 5:return H.fn.call(H.context,I,C,R,F),!0;case 6:return H.fn.call(H.context,I,C,R,F,G),!0}for(Z=1,q=new Array(X-1);Z<X;Z++)q[Z-1]=arguments[Z];H.fn.apply(H.context,q)}else{var J=H.length,ne;for(Z=0;Z<J;Z++)switch(H[Z].once&&this.removeListener(T,H[Z].fn,void 0,!0),X){case 1:H[Z].fn.call(H[Z].context);break;case 2:H[Z].fn.call(H[Z].context,I);break;case 3:H[Z].fn.call(H[Z].context,I,C);break;case 4:H[Z].fn.call(H[Z].context,I,C,R);break;default:if(!q)for(ne=1,q=new Array(X-1);ne<X;ne++)q[ne-1]=arguments[ne];H[Z].fn.apply(H[Z].context,q)}}return!0},o.prototype.on=function(T,I,C){return d(this,T,I,C,!1)},o.prototype.once=function(T,I,C){return d(this,T,I,C,!0)},o.prototype.removeListener=function(T,I,C,R){var F=r?r+T:T;if(!this._events[F])return this;if(!I)return g(this,F),this;var G=this._events[F];if(G.fn)G.fn===I&&(!R||G.once)&&(!C||G.context===C)&&g(this,F);else{for(var j=0,H=[],X=G.length;j<X;j++)(G[j].fn!==I||R&&!G[j].once||C&&G[j].context!==C)&&H.push(G[j]);H.length?this._events[F]=H.length===1?H[0]:H:g(this,F)}return this},o.prototype.removeAllListeners=function(T){var I;return T?(I=r?r+T:T,this._events[I]&&g(this,I)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o})(JZ);var Fze=JZ.exports;const Bze=Ii(Fze);var YI=new Bze,JI="recharts.syncMouseEvents";function E1(e){"@babel/helpers - typeof";return E1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E1(e)}function $ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Uze(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,QZ(i.key),i)}}function Vze(e,t,r){return t&&Uze(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function QI(e,t,r){return t=QZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QZ(e){var t=Gze(e,"string");return E1(t)=="symbol"?t:t+""}function Gze(e,t){if(E1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t);if(E1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Hze=function(){function e(){$ze(this,e),QI(this,"activeIndex",0),QI(this,"coordinateList",[]),QI(this,"layout","horizontal")}return Vze(e,[{key:"setDetails",value:function(r){var i,c=r.coordinateList,d=c===void 0?null:c,g=r.container,o=g===void 0?null:g,w=r.layout,T=w===void 0?null:w,I=r.offset,C=I===void 0?null:I,R=r.mouseHandlerCallback,F=R===void 0?null:R;this.coordinateList=(i=d??this.coordinateList)!==null&&i!==void 0?i:[],this.container=o??this.container,this.layout=T??this.layout,this.offset=C??this.offset,this.mouseHandlerCallback=F??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,i;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var c=this.container.getBoundingClientRect(),d=c.x,g=c.y,o=c.height,w=this.coordinateList[this.activeIndex].coordinate,T=((r=window)===null||r===void 0?void 0:r.scrollX)||0,I=((i=window)===null||i===void 0?void 0:i.scrollY)||0,C=d+w+T,R=g+this.offset.top+o/2+I;this.mouseHandlerCallback({pageX:C,pageY:R})}}}])}();function Wze(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var i=e==null?void 0:e[0],c=e==null?void 0:e[1];if(i&&c&&gr(i)&&gr(c))return!0}return!1}function qze(e,t,r,i){var c=i/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-c:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-c,width:e==="horizontal"?i:r.width-1,height:e==="horizontal"?r.height-1:i}}function eX(e){var t=e.cx,r=e.cy,i=e.radius,c=e.startAngle,d=e.endAngle,g=Yi(t,r,i,c),o=Yi(t,r,i,d);return{points:[g,o],cx:t,cy:r,radius:i,startAngle:c,endAngle:d}}function Zze(e,t,r){var i,c,d,g;if(e==="horizontal")i=t.x,d=i,c=r.top,g=r.top+r.height;else if(e==="vertical")c=t.y,g=c,i=r.left,d=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var o=t.cx,w=t.cy,T=t.innerRadius,I=t.outerRadius,C=t.angle,R=Yi(o,w,T,C),F=Yi(o,w,I,C);i=R.x,c=R.y,d=F.x,g=F.y}else return eX(t);return[{x:i,y:c},{x:d,y:g}]}function A1(e){"@babel/helpers - typeof";return A1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A1(e)}function iV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function US(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?iV(Object(r),!0).forEach(function(i){Xze(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Xze(e,t,r){return t=Kze(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Kze(e){var t=Yze(e,"string");return A1(t)=="symbol"?t:t+""}function Yze(e,t){if(A1(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(A1(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Jze(e){var t,r,i=e.element,c=e.tooltipEventType,d=e.isActive,g=e.activeCoordinate,o=e.activePayload,w=e.offset,T=e.activeTooltipIndex,I=e.tooltipAxisBandSize,C=e.layout,R=e.chartName,F=(t=i.props.cursor)!==null&&t!==void 0?t:(r=i.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!i||!F||!d||!g||R!=="ScatterChart"&&c!=="axis")return null;var G,j=dR;if(R==="ScatterChart")G=g,j=IMe;else if(R==="BarChart")G=qze(C,g,w,I),j=DL;else if(C==="radial"){var H=eX(g),X=H.cx,q=H.cy,Z=H.radius,J=H.startAngle,ne=H.endAngle;G={cx:X,cy:q,startAngle:J,endAngle:ne,innerRadius:Z,outerRadius:Z},j=Y7}else G={points:Zze(C,g,w)},j=dR;var he=US(US(US(US({stroke:"#ccc",pointerEvents:"none"},w),G),hn(F,!1)),{},{payload:o,payloadIndex:T,className:Gn("recharts-tooltip-cursor",F.className)});return Q.isValidElement(F)?Q.cloneElement(F,he):Q.createElement(j,he)}var Qze=["item"],eNe=["children","className","width","height","style","compact","title","desc"];function sy(e){"@babel/helpers - typeof";return sy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},sy(e)}function vx(){return vx=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},vx.apply(this,arguments)}function oV(e,t){return nNe(e)||rNe(e,t)||rX(e,t)||tNe()}function tNe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rNe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i,c,d,g,o=[],w=!0,T=!1;try{if(d=(r=r.call(e)).next,t!==0)for(;!(w=(i=d.call(r)).done)&&(o.push(i.value),o.length!==t);w=!0);}catch(I){T=!0,c=I}finally{try{if(!w&&r.return!=null&&(g=r.return(),Object(g)!==g))return}finally{if(T)throw c}}return o}}function nNe(e){if(Array.isArray(e))return e}function sV(e,t){if(e==null)return{};var r=iNe(e,t),i,c;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(c=0;c<d.length;c++)i=d[c],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}function iNe(e,t){if(e==null)return{};var r={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function oNe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sNe(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,nX(i.key),i)}}function aNe(e,t,r){return t&&sNe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function lNe(e,t,r){return t=UE(t),cNe(e,tX()?Reflect.construct(t,r||[],UE(e).constructor):t.apply(e,r))}function cNe(e,t){if(t&&(sy(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uNe(e)}function uNe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tX(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tX=function(){return!!e})()}function UE(e){return UE=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},UE(e)}function hNe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&GR(e,t)}function GR(e,t){return GR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,c){return i.__proto__=c,i},GR(e,t)}function ay(e){return pNe(e)||fNe(e)||rX(e)||dNe()}function dNe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rX(e,t){if(e){if(typeof e=="string")return HR(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return HR(e,t)}}function fNe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function pNe(e){if(Array.isArray(e))return HR(e)}function HR(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function aV(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(e,c).enumerable})),r.push.apply(r,i)}return r}function Ut(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?aV(Object(r),!0).forEach(function(i){un(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aV(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function un(e,t,r){return t=nX(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nX(e){var t=mNe(e,"string");return sy(t)=="symbol"?t:t+""}function mNe(e,t){if(sy(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var i=r.call(e,t||"default");if(sy(i)!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var gNe={xAxis:["bottom","top"],yAxis:["left","right"]},_Ne={width:"100%",height:"100%"},iX={x:0,y:0};function VS(e){return e}var yNe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},vNe=function(t,r,i,c){var d=r.find(function(I){return I&&I.index===i});if(d){if(t==="horizontal")return{x:d.coordinate,y:c.y};if(t==="vertical")return{x:c.x,y:d.coordinate};if(t==="centric"){var g=d.coordinate,o=c.radius;return Ut(Ut(Ut({},c),Yi(c.cx,c.cy,o,g)),{},{angle:g,radius:o})}var w=d.coordinate,T=c.angle;return Ut(Ut(Ut({},c),Yi(c.cx,c.cy,w,T)),{},{angle:T,radius:w})}return iX},PA=function(t,r){var i=r.graphicalItems,c=r.dataStartIndex,d=r.dataEndIndex,g=(i??[]).reduce(function(o,w){var T=w.props.data;return T&&T.length?[].concat(ay(o),ay(T)):o},[]);return g.length>0?g:t&&t.length&&gr(c)&&gr(d)?t.slice(c,d+1):[]};function oX(e){return e==="number"?[0,"auto"]:void 0}var WR=function(t,r,i,c){var d=t.graphicalItems,g=t.tooltipAxis,o=PA(r,t);return i<0||!d||!d.length||i>=o.length?null:d.reduce(function(w,T){var I,C=(I=T.props.data)!==null&&I!==void 0?I:r;C&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=i&&(C=C.slice(t.dataStartIndex,t.dataEndIndex+1));var R;if(g.dataKey&&!g.allowDuplicatedCategory){var F=C===void 0?o:C;R=xM(F,g.dataKey,c)}else R=C&&C[i]||o[i];return R?[].concat(ay(w),[H7(T,R)]):w},[])},lV=function(t,r,i,c){var d=c||{x:t.chartX,y:t.chartY},g=yNe(d,i),o=t.orderedTooltipTicks,w=t.tooltipAxis,T=t.tooltipTicks,I=cCe(g,o,T,w);if(I>=0&&T){var C=T[I]&&T[I].value,R=WR(t,r,I,C),F=vNe(i,o,I,d);return{activeTooltipIndex:I,activeLabel:C,activePayload:R,activeCoordinate:F}}return null},xNe=function(t,r){var i=r.axes,c=r.graphicalItems,d=r.axisType,g=r.axisIdKey,o=r.stackGroups,w=r.dataStartIndex,T=r.dataEndIndex,I=t.layout,C=t.children,R=t.stackOffset,F=F7(I,d);return i.reduce(function(G,j){var H,X=j.type.defaultProps!==void 0?Ut(Ut({},j.type.defaultProps),j.props):j.props,q=X.type,Z=X.dataKey,J=X.allowDataOverflow,ne=X.allowDuplicatedCategory,he=X.scale,me=X.ticks,Se=X.includeHidden,qe=X[g];if(G[qe])return G;var Ze=PA(t.data,{graphicalItems:c.filter(function(zt){var or,Mr=g in zt.props?zt.props[g]:(or=zt.type.defaultProps)===null||or===void 0?void 0:or[g];return Mr===qe}),dataStartIndex:w,dataEndIndex:T}),He=Ze.length,Ke,dt,$e;Wze(X.domain,J,q)&&(Ke=aR(X.domain,null,J),F&&(q==="number"||he!=="auto")&&($e=mx(Ze,Z,"category")));var mt=oX(q);if(!Ke||Ke.length===0){var ct,St=(ct=X.domain)!==null&&ct!==void 0?ct:mt;if(Z){if(Ke=mx(Ze,Z,q),q==="category"&&F){var Ue=ege(Ke);ne&&Ue?(dt=Ke,Ke=OE(0,He)):ne||(Ke=k$(St,Ke,j).reduce(function(zt,or){return zt.indexOf(or)>=0?zt:[].concat(ay(zt),[or])},[]))}else if(q==="category")ne?Ke=Ke.filter(function(zt){return zt!==""&&!ni(zt)}):Ke=k$(St,Ke,j).reduce(function(zt,or){return zt.indexOf(or)>=0||or===""||ni(or)?zt:[].concat(ay(zt),[or])},[]);else if(q==="number"){var st=pCe(Ze,c.filter(function(zt){var or,Mr,Ar=g in zt.props?zt.props[g]:(or=zt.type.defaultProps)===null||or===void 0?void 0:or[g],vr="hide"in zt.props?zt.props.hide:(Mr=zt.type.defaultProps)===null||Mr===void 0?void 0:Mr.hide;return Ar===qe&&(Se||!vr)}),Z,d,I);st&&(Ke=st)}F&&(q==="number"||he!=="auto")&&($e=mx(Ze,Z,"category"))}else F?Ke=OE(0,He):o&&o[qe]&&o[qe].hasStack&&q==="number"?Ke=R==="expand"?[0,1]:G7(o[qe].stackGroups,w,T):Ke=j7(Ze,c.filter(function(zt){var or=g in zt.props?zt.props[g]:zt.type.defaultProps[g],Mr="hide"in zt.props?zt.props.hide:zt.type.defaultProps.hide;return or===qe&&(Se||!Mr)}),q,I,!0);if(q==="number")Ke=VR(C,Ke,qe,d,me),St&&(Ke=aR(St,Ke,J));else if(q==="category"&&St){var bt=St,At=Ke.every(function(zt){return bt.indexOf(zt)>=0});At&&(Ke=bt)}}return Ut(Ut({},G),{},un({},qe,Ut(Ut({},X),{},{axisType:d,domain:Ke,categoricalDomain:$e,duplicateDomain:dt,originalDomain:(H=X.domain)!==null&&H!==void 0?H:mt,isCategorical:F,layout:I})))},{})},bNe=function(t,r){var i=r.graphicalItems,c=r.Axis,d=r.axisType,g=r.axisIdKey,o=r.stackGroups,w=r.dataStartIndex,T=r.dataEndIndex,I=t.layout,C=t.children,R=PA(t.data,{graphicalItems:i,dataStartIndex:w,dataEndIndex:T}),F=R.length,G=F7(I,d),j=-1;return i.reduce(function(H,X){var q=X.type.defaultProps!==void 0?Ut(Ut({},X.type.defaultProps),X.props):X.props,Z=q[g],J=oX("number");if(!H[Z]){j++;var ne;return G?ne=OE(0,F):o&&o[Z]&&o[Z].hasStack?(ne=G7(o[Z].stackGroups,w,T),ne=VR(C,ne,Z,d)):(ne=aR(J,j7(R,i.filter(function(he){var me,Se,qe=g in he.props?he.props[g]:(me=he.type.defaultProps)===null||me===void 0?void 0:me[g],Ze="hide"in he.props?he.props.hide:(Se=he.type.defaultProps)===null||Se===void 0?void 0:Se.hide;return qe===Z&&!Ze}),"number",I),c.defaultProps.allowDataOverflow),ne=VR(C,ne,Z,d)),Ut(Ut({},H),{},un({},Z,Ut(Ut({axisType:d},c.defaultProps),{},{hide:!0,orientation:Va(gNe,"".concat(d,".").concat(j%2),null),domain:ne,originalDomain:J,isCategorical:G,layout:I})))}return H},{})},wNe=function(t,r){var i=r.axisType,c=i===void 0?"xAxis":i,d=r.AxisComp,g=r.graphicalItems,o=r.stackGroups,w=r.dataStartIndex,T=r.dataEndIndex,I=t.children,C="".concat(c,"Id"),R=ml(I,d),F={};return R&&R.length?F=xNe(t,{axes:R,graphicalItems:g,axisType:c,axisIdKey:C,stackGroups:o,dataStartIndex:w,dataEndIndex:T}):g&&g.length&&(F=bNe(t,{Axis:d,graphicalItems:g,axisType:c,axisIdKey:C,stackGroups:o,dataStartIndex:w,dataEndIndex:T})),F},SNe=function(t){var r=pd(t),i=Uu(r,!1,!0);return{tooltipTicks:i,orderedTooltipTicks:aL(i,function(c){return c.coordinate}),tooltipAxis:r,tooltipAxisBandSize:yE(r,i)}},cV=function(t){var r=t.children,i=t.defaultShowTooltip,c=za(r,J_),d=0,g=0;return t.data&&t.data.length!==0&&(g=t.data.length-1),c&&c.props&&(c.props.startIndex>=0&&(d=c.props.startIndex),c.props.endIndex>=0&&(g=c.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:d,dataEndIndex:g,activeTooltipIndex:-1,isTooltipActive:!!i}},TNe=function(t){return!t||!t.length?!1:t.some(function(r){var i=Gu(r&&r.type);return i&&i.indexOf("Bar")>=0})},uV=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},ENe=function(t,r){var i=t.props,c=t.graphicalItems,d=t.xAxisMap,g=d===void 0?{}:d,o=t.yAxisMap,w=o===void 0?{}:o,T=i.width,I=i.height,C=i.children,R=i.margin||{},F=za(C,J_),G=za(C,p_),j=Object.keys(w).reduce(function(ne,he){var me=w[he],Se=me.orientation;return!me.mirror&&!me.hide?Ut(Ut({},ne),{},un({},Se,ne[Se]+me.width)):ne},{left:R.left||0,right:R.right||0}),H=Object.keys(g).reduce(function(ne,he){var me=g[he],Se=me.orientation;return!me.mirror&&!me.hide?Ut(Ut({},ne),{},un({},Se,Va(ne,"".concat(Se))+me.height)):ne},{top:R.top||0,bottom:R.bottom||0}),X=Ut(Ut({},H),j),q=X.bottom;F&&(X.bottom+=F.props.height||J_.defaultProps.height),G&&r&&(X=dCe(X,c,i,r));var Z=T-X.left-X.right,J=I-X.top-X.bottom;return Ut(Ut({brushBottom:q},X),{},{width:Math.max(Z,0),height:Math.max(J,0)})},ANe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},sX=function(t){var r=t.chartName,i=t.GraphicalChild,c=t.defaultTooltipEventType,d=c===void 0?"axis":c,g=t.validateTooltipEventTypes,o=g===void 0?["axis"]:g,w=t.axisComponents,T=t.legendContent,I=t.formatAxisMap,C=t.defaultProps,R=function(H,X){var q=X.graphicalItems,Z=X.stackGroups,J=X.offset,ne=X.updateId,he=X.dataStartIndex,me=X.dataEndIndex,Se=H.barSize,qe=H.layout,Ze=H.barGap,He=H.barCategoryGap,Ke=H.maxBarSize,dt=uV(qe),$e=dt.numericAxisName,mt=dt.cateAxisName,ct=TNe(q),St=[];return q.forEach(function(Ue,st){var bt=PA(H.data,{graphicalItems:[Ue],dataStartIndex:he,dataEndIndex:me}),At=Ue.type.defaultProps!==void 0?Ut(Ut({},Ue.type.defaultProps),Ue.props):Ue.props,zt=At.dataKey,or=At.maxBarSize,Mr=At["".concat($e,"Id")],Ar=At["".concat(mt,"Id")],vr={},nr=w.reduce(function(Ai,Io){var vs=X["".concat(Io.axisType,"Map")],Zo=At["".concat(Io.axisType,"Id")];vs&&vs[Zo]||Io.axisType==="zAxis"||Yp();var ao=vs[Zo];return Ut(Ut({},Ai),{},un(un({},Io.axisType,ao),"".concat(Io.axisType,"Ticks"),Uu(ao)))},vr),Xr=nr[mt],Lt=nr["".concat(mt,"Ticks")],ur=Z&&Z[Mr]&&Z[Mr].hasStack&&SCe(Ue,Z[Mr].stackGroups),_r=Gu(Ue.type).indexOf("Bar")>=0,Mt=yE(Xr,Lt),Nr=[],Yr=ct&&uCe({barSize:Se,stackGroups:Z,totalSize:ANe(nr,mt)});if(_r){var Hn,en,Ei=ni(or)?Ke:or,xo=(Hn=(en=yE(Xr,Lt,!0))!==null&&en!==void 0?en:Ei)!==null&&Hn!==void 0?Hn:0;Nr=hCe({barGap:Ze,barCategoryGap:He,bandSize:xo!==Mt?xo:Mt,sizeList:Yr[Ar],maxBarSize:Ei}),xo!==Mt&&(Nr=Nr.map(function(Ai){return Ut(Ut({},Ai),{},{position:Ut(Ut({},Ai.position),{},{offset:Ai.position.offset-xo/2})})}))}var On=Ue&&Ue.type&&Ue.type.getComposedData;On&&St.push({props:Ut(Ut({},On(Ut(Ut({},nr),{},{displayedData:bt,props:H,dataKey:zt,item:Ue,bandSize:Mt,barPosition:Nr,offset:J,stackedData:ur,layout:qe,dataStartIndex:he,dataEndIndex:me}))),{},un(un(un({key:Ue.key||"item-".concat(st)},$e,nr[$e]),mt,nr[mt]),"animationId",ne)),childIndex:hge(Ue,H.children),item:Ue})}),St},F=function(H,X){var q=H.props,Z=H.dataStartIndex,J=H.dataEndIndex,ne=H.updateId;if(!A4({props:q}))return null;var he=q.children,me=q.layout,Se=q.stackOffset,qe=q.data,Ze=q.reverseStackOrder,He=uV(me),Ke=He.numericAxisName,dt=He.cateAxisName,$e=ml(he,i),mt=bCe(qe,$e,"".concat(Ke,"Id"),"".concat(dt,"Id"),Se,Ze),ct=w.reduce(function(At,zt){var or="".concat(zt.axisType,"Map");return Ut(Ut({},At),{},un({},or,wNe(q,Ut(Ut({},zt),{},{graphicalItems:$e,stackGroups:zt.axisType===Ke&&mt,dataStartIndex:Z,dataEndIndex:J}))))},{}),St=ENe(Ut(Ut({},ct),{},{props:q,graphicalItems:$e}),X==null?void 0:X.legendBBox);Object.keys(ct).forEach(function(At){ct[At]=I(q,ct[At],St,At.replace("Map",""),r)});var Ue=ct["".concat(dt,"Map")],st=SNe(Ue),bt=R(q,Ut(Ut({},ct),{},{dataStartIndex:Z,dataEndIndex:J,updateId:ne,graphicalItems:$e,stackGroups:mt,offset:St}));return Ut(Ut({formattedGraphicalItems:bt,graphicalItems:$e,offset:St,stackGroups:mt},st),ct)},G=function(j){function H(X){var q,Z,J;return oNe(this,H),J=lNe(this,H,[X]),un(J,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),un(J,"accessibilityManager",new Hze),un(J,"handleLegendBBoxUpdate",function(ne){if(ne){var he=J.state,me=he.dataStartIndex,Se=he.dataEndIndex,qe=he.updateId;J.setState(Ut({legendBBox:ne},F({props:J.props,dataStartIndex:me,dataEndIndex:Se,updateId:qe},Ut(Ut({},J.state),{},{legendBBox:ne}))))}}),un(J,"handleReceiveSyncEvent",function(ne,he,me){if(J.props.syncId===ne){if(me===J.eventEmitterSymbol&&typeof J.props.syncMethod!="function")return;J.applySyncEvent(he)}}),un(J,"handleBrushChange",function(ne){var he=ne.startIndex,me=ne.endIndex;if(he!==J.state.dataStartIndex||me!==J.state.dataEndIndex){var Se=J.state.updateId;J.setState(function(){return Ut({dataStartIndex:he,dataEndIndex:me},F({props:J.props,dataStartIndex:he,dataEndIndex:me,updateId:Se},J.state))}),J.triggerSyncEvent({dataStartIndex:he,dataEndIndex:me})}}),un(J,"handleMouseEnter",function(ne){var he=J.getMouseInfo(ne);if(he){var me=Ut(Ut({},he),{},{isTooltipActive:!0});J.setState(me),J.triggerSyncEvent(me);var Se=J.props.onMouseEnter;An(Se)&&Se(me,ne)}}),un(J,"triggeredAfterMouseMove",function(ne){var he=J.getMouseInfo(ne),me=he?Ut(Ut({},he),{},{isTooltipActive:!0}):{isTooltipActive:!1};J.setState(me),J.triggerSyncEvent(me);var Se=J.props.onMouseMove;An(Se)&&Se(me,ne)}),un(J,"handleItemMouseEnter",function(ne){J.setState(function(){return{isTooltipActive:!0,activeItem:ne,activePayload:ne.tooltipPayload,activeCoordinate:ne.tooltipPosition||{x:ne.cx,y:ne.cy}}})}),un(J,"handleItemMouseLeave",function(){J.setState(function(){return{isTooltipActive:!1}})}),un(J,"handleMouseMove",function(ne){ne.persist(),J.throttleTriggeredAfterMouseMove(ne)}),un(J,"handleMouseLeave",function(ne){J.throttleTriggeredAfterMouseMove.cancel();var he={isTooltipActive:!1};J.setState(he),J.triggerSyncEvent(he);var me=J.props.onMouseLeave;An(me)&&me(he,ne)}),un(J,"handleOuterEvent",function(ne){var he=uge(ne),me=Va(J.props,"".concat(he));if(he&&An(me)){var Se,qe;/.*touch.*/i.test(he)?qe=J.getMouseInfo(ne.changedTouches[0]):qe=J.getMouseInfo(ne),me((Se=qe)!==null&&Se!==void 0?Se:{},ne)}}),un(J,"handleClick",function(ne){var he=J.getMouseInfo(ne);if(he){var me=Ut(Ut({},he),{},{isTooltipActive:!0});J.setState(me),J.triggerSyncEvent(me);var Se=J.props.onClick;An(Se)&&Se(me,ne)}}),un(J,"handleMouseDown",function(ne){var he=J.props.onMouseDown;if(An(he)){var me=J.getMouseInfo(ne);he(me,ne)}}),un(J,"handleMouseUp",function(ne){var he=J.props.onMouseUp;if(An(he)){var me=J.getMouseInfo(ne);he(me,ne)}}),un(J,"handleTouchMove",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&J.throttleTriggeredAfterMouseMove(ne.changedTouches[0])}),un(J,"handleTouchStart",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&J.handleMouseDown(ne.changedTouches[0])}),un(J,"handleTouchEnd",function(ne){ne.changedTouches!=null&&ne.changedTouches.length>0&&J.handleMouseUp(ne.changedTouches[0])}),un(J,"triggerSyncEvent",function(ne){J.props.syncId!==void 0&&YI.emit(JI,J.props.syncId,ne,J.eventEmitterSymbol)}),un(J,"applySyncEvent",function(ne){var he=J.props,me=he.layout,Se=he.syncMethod,qe=J.state.updateId,Ze=ne.dataStartIndex,He=ne.dataEndIndex;if(ne.dataStartIndex!==void 0||ne.dataEndIndex!==void 0)J.setState(Ut({dataStartIndex:Ze,dataEndIndex:He},F({props:J.props,dataStartIndex:Ze,dataEndIndex:He,updateId:qe},J.state)));else if(ne.activeTooltipIndex!==void 0){var Ke=ne.chartX,dt=ne.chartY,$e=ne.activeTooltipIndex,mt=J.state,ct=mt.offset,St=mt.tooltipTicks;if(!ct)return;if(typeof Se=="function")$e=Se(St,ne);else if(Se==="value"){$e=-1;for(var Ue=0;Ue<St.length;Ue++)if(St[Ue].value===ne.activeLabel){$e=Ue;break}}var st=Ut(Ut({},ct),{},{x:ct.left,y:ct.top}),bt=Math.min(Ke,st.x+st.width),At=Math.min(dt,st.y+st.height),zt=St[$e]&&St[$e].value,or=WR(J.state,J.props.data,$e),Mr=St[$e]?{x:me==="horizontal"?St[$e].coordinate:bt,y:me==="horizontal"?At:St[$e].coordinate}:iX;J.setState(Ut(Ut({},ne),{},{activeLabel:zt,activeCoordinate:Mr,activePayload:or,activeTooltipIndex:$e}))}else J.setState(ne)}),un(J,"renderCursor",function(ne){var he,me=J.state,Se=me.isTooltipActive,qe=me.activeCoordinate,Ze=me.activePayload,He=me.offset,Ke=me.activeTooltipIndex,dt=me.tooltipAxisBandSize,$e=J.getTooltipEventType(),mt=(he=ne.props.active)!==null&&he!==void 0?he:Se,ct=J.props.layout,St=ne.key||"_recharts-cursor";return De.createElement(Jze,{key:St,activeCoordinate:qe,activePayload:Ze,activeTooltipIndex:Ke,chartName:r,element:ne,isActive:mt,layout:ct,offset:He,tooltipAxisBandSize:dt,tooltipEventType:$e})}),un(J,"renderPolarAxis",function(ne,he,me){var Se=Va(ne,"type.axisType"),qe=Va(J.state,"".concat(Se,"Map")),Ze=ne.type.defaultProps,He=Ze!==void 0?Ut(Ut({},Ze),ne.props):ne.props,Ke=qe&&qe[He["".concat(Se,"Id")]];return Q.cloneElement(ne,Ut(Ut({},Ke),{},{className:Gn(Se,Ke.className),key:ne.key||"".concat(he,"-").concat(me),ticks:Uu(Ke,!0)}))}),un(J,"renderPolarGrid",function(ne){var he=ne.props,me=he.radialLines,Se=he.polarAngles,qe=he.polarRadius,Ze=J.state,He=Ze.radiusAxisMap,Ke=Ze.angleAxisMap,dt=pd(He),$e=pd(Ke),mt=$e.cx,ct=$e.cy,St=$e.innerRadius,Ue=$e.outerRadius;return Q.cloneElement(ne,{polarAngles:Array.isArray(Se)?Se:Uu($e,!0).map(function(st){return st.coordinate}),polarRadius:Array.isArray(qe)?qe:Uu(dt,!0).map(function(st){return st.coordinate}),cx:mt,cy:ct,innerRadius:St,outerRadius:Ue,key:ne.key||"polar-grid",radialLines:me})}),un(J,"renderLegend",function(){var ne=J.state.formattedGraphicalItems,he=J.props,me=he.children,Se=he.width,qe=he.height,Ze=J.props.margin||{},He=Se-(Ze.left||0)-(Ze.right||0),Ke=z7({children:me,formattedGraphicalItems:ne,legendWidth:He,legendContent:T});if(!Ke)return null;var dt=Ke.item,$e=sV(Ke,Qze);return Q.cloneElement(dt,Ut(Ut({},$e),{},{chartWidth:Se,chartHeight:qe,margin:Ze,onBBoxUpdate:J.handleLegendBBoxUpdate}))}),un(J,"renderTooltip",function(){var ne,he=J.props,me=he.children,Se=he.accessibilityLayer,qe=za(me,ec);if(!qe)return null;var Ze=J.state,He=Ze.isTooltipActive,Ke=Ze.activeCoordinate,dt=Ze.activePayload,$e=Ze.activeLabel,mt=Ze.offset,ct=(ne=qe.props.active)!==null&&ne!==void 0?ne:He;return Q.cloneElement(qe,{viewBox:Ut(Ut({},mt),{},{x:mt.left,y:mt.top}),active:ct,label:$e,payload:ct?dt:[],coordinate:Ke,accessibilityLayer:Se})}),un(J,"renderBrush",function(ne){var he=J.props,me=he.margin,Se=he.data,qe=J.state,Ze=qe.offset,He=qe.dataStartIndex,Ke=qe.dataEndIndex,dt=qe.updateId;return Q.cloneElement(ne,{key:ne.key||"_recharts-brush",onChange:jS(J.handleBrushChange,ne.props.onChange),data:Se,x:gr(ne.props.x)?ne.props.x:Ze.left,y:gr(ne.props.y)?ne.props.y:Ze.top+Ze.height+Ze.brushBottom-(me.bottom||0),width:gr(ne.props.width)?ne.props.width:Ze.width,startIndex:He,endIndex:Ke,updateId:"brush-".concat(dt)})}),un(J,"renderReferenceElement",function(ne,he,me){if(!ne)return null;var Se=J,qe=Se.clipPathId,Ze=J.state,He=Ze.xAxisMap,Ke=Ze.yAxisMap,dt=Ze.offset,$e=ne.type.defaultProps||{},mt=ne.props,ct=mt.xAxisId,St=ct===void 0?$e.xAxisId:ct,Ue=mt.yAxisId,st=Ue===void 0?$e.yAxisId:Ue;return Q.cloneElement(ne,{key:ne.key||"".concat(he,"-").concat(me),xAxis:He[St],yAxis:Ke[st],viewBox:{x:dt.left,y:dt.top,width:dt.width,height:dt.height},clipPathId:qe})}),un(J,"renderActivePoints",function(ne){var he=ne.item,me=ne.activePoint,Se=ne.basePoint,qe=ne.childIndex,Ze=ne.isRange,He=[],Ke=he.props.key,dt=he.item.type.defaultProps!==void 0?Ut(Ut({},he.item.type.defaultProps),he.item.props):he.item.props,$e=dt.activeDot,mt=dt.dataKey,ct=Ut(Ut({index:qe,dataKey:mt,cx:me.x,cy:me.y,r:4,fill:kL(he.item),strokeWidth:2,stroke:"#fff",payload:me.payload,value:me.value},hn($e,!1)),HT($e));return He.push(H.renderActiveDot($e,ct,"".concat(Ke,"-activePoint-").concat(qe))),Se?He.push(H.renderActiveDot($e,Ut(Ut({},ct),{},{cx:Se.x,cy:Se.y}),"".concat(Ke,"-basePoint-").concat(qe))):Ze&&He.push(null),He}),un(J,"renderGraphicChild",function(ne,he,me){var Se=J.filterFormatItem(ne,he,me);if(!Se)return null;var qe=J.getTooltipEventType(),Ze=J.state,He=Ze.isTooltipActive,Ke=Ze.tooltipAxis,dt=Ze.activeTooltipIndex,$e=Ze.activeLabel,mt=J.props.children,ct=za(mt,ec),St=Se.props,Ue=St.points,st=St.isRange,bt=St.baseLine,At=Se.item.type.defaultProps!==void 0?Ut(Ut({},Se.item.type.defaultProps),Se.item.props):Se.item.props,zt=At.activeDot,or=At.hide,Mr=At.activeBar,Ar=At.activeShape,vr=!!(!or&&He&&ct&&(zt||Mr||Ar)),nr={};qe!=="axis"&&ct&&ct.props.trigger==="click"?nr={onClick:jS(J.handleItemMouseEnter,ne.props.onClick)}:qe!=="axis"&&(nr={onMouseLeave:jS(J.handleItemMouseLeave,ne.props.onMouseLeave),onMouseEnter:jS(J.handleItemMouseEnter,ne.props.onMouseEnter)});var Xr=Q.cloneElement(ne,Ut(Ut({},Se.props),nr));function Lt(Io){return typeof Ke.dataKey=="function"?Ke.dataKey(Io.payload):null}if(vr)if(dt>=0){var ur,_r;if(Ke.dataKey&&!Ke.allowDuplicatedCategory){var Mt=typeof Ke.dataKey=="function"?Lt:"payload.".concat(Ke.dataKey.toString());ur=xM(Ue,Mt,$e),_r=st&&bt&&xM(bt,Mt,$e)}else ur=Ue==null?void 0:Ue[dt],_r=st&&bt&&bt[dt];if(Ar||Mr){var Nr=ne.props.activeIndex!==void 0?ne.props.activeIndex:dt;return[Q.cloneElement(ne,Ut(Ut(Ut({},Se.props),nr),{},{activeIndex:Nr})),null,null]}if(!ni(ur))return[Xr].concat(ay(J.renderActivePoints({item:Se,activePoint:ur,basePoint:_r,childIndex:dt,isRange:st})))}else{var Yr,Hn=(Yr=J.getItemByXY(J.state.activeCoordinate))!==null&&Yr!==void 0?Yr:{graphicalItem:Xr},en=Hn.graphicalItem,Ei=en.item,xo=Ei===void 0?ne:Ei,On=en.childIndex,Ai=Ut(Ut(Ut({},Se.props),nr),{},{activeIndex:On});return[Q.cloneElement(xo,Ai),null,null]}return st?[Xr,null,null]:[Xr,null]}),un(J,"renderCustomized",function(ne,he,me){return Q.cloneElement(ne,Ut(Ut({key:"recharts-customized-".concat(me)},J.props),J.state))}),un(J,"renderMap",{CartesianGrid:{handler:VS,once:!0},ReferenceArea:{handler:J.renderReferenceElement},ReferenceLine:{handler:VS},ReferenceDot:{handler:J.renderReferenceElement},XAxis:{handler:VS},YAxis:{handler:VS},Brush:{handler:J.renderBrush,once:!0},Bar:{handler:J.renderGraphicChild},Line:{handler:J.renderGraphicChild},Area:{handler:J.renderGraphicChild},Radar:{handler:J.renderGraphicChild},RadialBar:{handler:J.renderGraphicChild},Scatter:{handler:J.renderGraphicChild},Pie:{handler:J.renderGraphicChild},Funnel:{handler:J.renderGraphicChild},Tooltip:{handler:J.renderCursor,once:!0},PolarGrid:{handler:J.renderPolarGrid,once:!0},PolarAngleAxis:{handler:J.renderPolarAxis},PolarRadiusAxis:{handler:J.renderPolarAxis},Customized:{handler:J.renderCustomized}}),J.clipPathId="".concat((q=X.id)!==null&&q!==void 0?q:Z1("recharts"),"-clip"),J.throttleTriggeredAfterMouseMove=L9(J.triggeredAfterMouseMove,(Z=X.throttleDelay)!==null&&Z!==void 0?Z:1e3/60),J.state={},J}return hNe(H,j),aNe(H,[{key:"componentDidMount",value:function(){var q,Z;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(q=this.props.margin.left)!==null&&q!==void 0?q:0,top:(Z=this.props.margin.top)!==null&&Z!==void 0?Z:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var q=this.props,Z=q.children,J=q.data,ne=q.height,he=q.layout,me=za(Z,ec);if(me){var Se=me.props.defaultIndex;if(!(typeof Se!="number"||Se<0||Se>this.state.tooltipTicks.length-1)){var qe=this.state.tooltipTicks[Se]&&this.state.tooltipTicks[Se].value,Ze=WR(this.state,J,Se,qe),He=this.state.tooltipTicks[Se].coordinate,Ke=(this.state.offset.top+ne)/2,dt=he==="horizontal",$e=dt?{x:He,y:Ke}:{y:He,x:Ke},mt=this.state.formattedGraphicalItems.find(function(St){var Ue=St.item;return Ue.type.name==="Scatter"});mt&&($e=Ut(Ut({},$e),mt.props.points[Se].tooltipPosition),Ze=mt.props.points[Se].tooltipPayload);var ct={activeTooltipIndex:Se,isTooltipActive:!0,activeLabel:qe,activePayload:Ze,activeCoordinate:$e};this.setState(ct),this.renderCursor(me),this.accessibilityManager.setIndex(Se)}}}},{key:"getSnapshotBeforeUpdate",value:function(q,Z){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==Z.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==q.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==q.margin){var J,ne;this.accessibilityManager.setDetails({offset:{left:(J=this.props.margin.left)!==null&&J!==void 0?J:0,top:(ne=this.props.margin.top)!==null&&ne!==void 0?ne:0}})}return null}},{key:"componentDidUpdate",value:function(q){wM([za(q.children,ec)],[za(this.props.children,ec)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var q=za(this.props.children,ec);if(q&&typeof q.props.shared=="boolean"){var Z=q.props.shared?"axis":"item";return o.indexOf(Z)>=0?Z:d}return d}},{key:"getMouseInfo",value:function(q){if(!this.container)return null;var Z=this.container,J=Z.getBoundingClientRect(),ne=NTe(J),he={chartX:Math.round(q.pageX-ne.left),chartY:Math.round(q.pageY-ne.top)},me=J.width/Z.offsetWidth||1,Se=this.inRange(he.chartX,he.chartY,me);if(!Se)return null;var qe=this.state,Ze=qe.xAxisMap,He=qe.yAxisMap,Ke=this.getTooltipEventType();if(Ke!=="axis"&&Ze&&He){var dt=pd(Ze).scale,$e=pd(He).scale,mt=dt&&dt.invert?dt.invert(he.chartX):null,ct=$e&&$e.invert?$e.invert(he.chartY):null;return Ut(Ut({},he),{},{xValue:mt,yValue:ct})}var St=lV(this.state,this.props.data,this.props.layout,Se);return St?Ut(Ut({},he),St):null}},{key:"inRange",value:function(q,Z){var J=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,ne=this.props.layout,he=q/J,me=Z/J;if(ne==="horizontal"||ne==="vertical"){var Se=this.state.offset,qe=he>=Se.left&&he<=Se.left+Se.width&&me>=Se.top&&me<=Se.top+Se.height;return qe?{x:he,y:me}:null}var Ze=this.state,He=Ze.angleAxisMap,Ke=Ze.radiusAxisMap;if(He&&Ke){var dt=pd(He);return z$({x:he,y:me},dt)}return null}},{key:"parseEventsOfWrapper",value:function(){var q=this.props.children,Z=this.getTooltipEventType(),J=za(q,ec),ne={};J&&Z==="axis"&&(J.props.trigger==="click"?ne={onClick:this.handleClick}:ne={onMouseEnter:this.handleMouseEnter,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd});var he=HT(this.props,this.handleOuterEvent);return Ut(Ut({},he),ne)}},{key:"addListener",value:function(){YI.on(JI,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){YI.removeListener(JI,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(q,Z,J){for(var ne=this.state.formattedGraphicalItems,he=0,me=ne.length;he<me;he++){var Se=ne[he];if(Se.item===q||Se.props.key===q.key||Z===Gu(Se.item.type)&&J===Se.childIndex)return Se}return null}},{key:"renderClipPath",value:function(){var q=this.clipPathId,Z=this.state.offset,J=Z.left,ne=Z.top,he=Z.height,me=Z.width;return De.createElement("defs",null,De.createElement("clipPath",{id:q},De.createElement("rect",{x:J,y:ne,height:he,width:me})))}},{key:"getXScales",value:function(){var q=this.state.xAxisMap;return q?Object.entries(q).reduce(function(Z,J){var ne=oV(J,2),he=ne[0],me=ne[1];return Ut(Ut({},Z),{},un({},he,me.scale))},{}):null}},{key:"getYScales",value:function(){var q=this.state.yAxisMap;return q?Object.entries(q).reduce(function(Z,J){var ne=oV(J,2),he=ne[0],me=ne[1];return Ut(Ut({},Z),{},un({},he,me.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(q){var Z;return(Z=this.state.xAxisMap)===null||Z===void 0||(Z=Z[q])===null||Z===void 0?void 0:Z.scale}},{key:"getYScaleByAxisId",value:function(q){var Z;return(Z=this.state.yAxisMap)===null||Z===void 0||(Z=Z[q])===null||Z===void 0?void 0:Z.scale}},{key:"getItemByXY",value:function(q){var Z=this.state,J=Z.formattedGraphicalItems,ne=Z.activeItem;if(J&&J.length)for(var he=0,me=J.length;he<me;he++){var Se=J[he],qe=Se.props,Ze=Se.item,He=Ze.type.defaultProps!==void 0?Ut(Ut({},Ze.type.defaultProps),Ze.props):Ze.props,Ke=Gu(Ze.type);if(Ke==="Bar"){var dt=(qe.data||[]).find(function(St){return cMe(q,St)});if(dt)return{graphicalItem:Se,payload:dt}}else if(Ke==="RadialBar"){var $e=(qe.data||[]).find(function(St){return z$(q,St)});if($e)return{graphicalItem:Se,payload:$e}}else if(yA(Se,ne)||vA(Se,ne)||x1(Se,ne)){var mt=YRe({graphicalItem:Se,activeTooltipItem:ne,itemData:He.data}),ct=He.activeIndex===void 0?mt:He.activeIndex;return{graphicalItem:Ut(Ut({},Se),{},{childIndex:ct}),payload:x1(Se,ne)?He.data[mt]:Se.props.data[mt]}}}return null}},{key:"render",value:function(){var q=this;if(!A4(this))return null;var Z=this.props,J=Z.children,ne=Z.className,he=Z.width,me=Z.height,Se=Z.style,qe=Z.compact,Ze=Z.title,He=Z.desc,Ke=sV(Z,eNe),dt=hn(Ke,!1);if(qe)return De.createElement(GU,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},De.createElement(TM,vx({},dt,{width:he,height:me,title:Ze,desc:He}),this.renderClipPath(),C4(J,this.renderMap)));if(this.props.accessibilityLayer){var $e,mt;dt.tabIndex=($e=this.props.tabIndex)!==null&&$e!==void 0?$e:0,dt.role=(mt=this.props.role)!==null&&mt!==void 0?mt:"application",dt.onKeyDown=function(St){q.accessibilityManager.keyboardEvent(St)},dt.onFocus=function(){q.accessibilityManager.focus()}}var ct=this.parseEventsOfWrapper();return De.createElement(GU,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},De.createElement("div",vx({className:Gn("recharts-wrapper",ne),style:Ut({position:"relative",cursor:"default",width:he,height:me},Se)},ct,{ref:function(Ue){q.container=Ue}}),De.createElement(TM,vx({},dt,{width:he,height:me,title:Ze,desc:He,style:_Ne}),this.renderClipPath(),C4(J,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(Q.Component);return un(G,"displayName",r),un(G,"defaultProps",Ut({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},C)),un(G,"getDerivedStateFromProps",function(j,H){var X=j.dataKey,q=j.data,Z=j.children,J=j.width,ne=j.height,he=j.layout,me=j.stackOffset,Se=j.margin,qe=H.dataStartIndex,Ze=H.dataEndIndex;if(H.updateId===void 0){var He=cV(j);return Ut(Ut(Ut({},He),{},{updateId:0},F(Ut(Ut({props:j},He),{},{updateId:0}),H)),{},{prevDataKey:X,prevData:q,prevWidth:J,prevHeight:ne,prevLayout:he,prevStackOffset:me,prevMargin:Se,prevChildren:Z})}if(X!==H.prevDataKey||q!==H.prevData||J!==H.prevWidth||ne!==H.prevHeight||he!==H.prevLayout||me!==H.prevStackOffset||!f_(Se,H.prevMargin)){var Ke=cV(j),dt={chartX:H.chartX,chartY:H.chartY,isTooltipActive:H.isTooltipActive},$e=Ut(Ut({},lV(H,q,he)),{},{updateId:H.updateId+1}),mt=Ut(Ut(Ut({},Ke),dt),$e);return Ut(Ut(Ut({},mt),F(Ut({props:j},mt),H)),{},{prevDataKey:X,prevData:q,prevWidth:J,prevHeight:ne,prevLayout:he,prevStackOffset:me,prevMargin:Se,prevChildren:Z})}if(!wM(Z,H.prevChildren)){var ct,St,Ue,st,bt=za(Z,J_),At=bt&&(ct=(St=bt.props)===null||St===void 0?void 0:St.startIndex)!==null&&ct!==void 0?ct:qe,zt=bt&&(Ue=(st=bt.props)===null||st===void 0?void 0:st.endIndex)!==null&&Ue!==void 0?Ue:Ze,or=At!==qe||zt!==Ze,Mr=!ni(q),Ar=Mr&&!or?H.updateId:H.updateId+1;return Ut(Ut({updateId:Ar},F(Ut(Ut({props:j},H),{},{updateId:Ar,dataStartIndex:At,dataEndIndex:zt}),H)),{},{prevChildren:Z,dataStartIndex:At,dataEndIndex:zt})}return null}),un(G,"renderActiveDot",function(j,H,X){var q;return Q.isValidElement(j)?q=Q.cloneElement(j,H):An(j)?q=j(H):q=De.createElement(LL,H),De.createElement(Li,{className:"recharts-active-dot",key:X},q)}),function(H){return De.createElement(G,H)}},PNe=sX({chartName:"BarChart",GraphicalChild:hm,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:EA},{axisType:"yAxis",AxisComp:AA}],formatAxisMap:IDe}),CNe=sX({chartName:"PieChart",GraphicalChild:ah,validateTooltipEventTypes:["item"],defaultTooltipEventType:"item",legendContent:"children",axisComponents:[{axisType:"angleAxis",AxisComp:_A},{axisType:"radiusAxis",AxisComp:mA}],formatAxisMap:kCe,defaultProps:{layout:"centric",startAngle:0,endAngle:360,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"}});const INe=[{month:"Jan",reports:45},{month:"Feb",reports:52},{month:"Mar",reports:38},{month:"Apr",reports:61},{month:"May",reports:55},{month:"Jun",reports:42}],hV=[{name:"Theft",value:35,color:"#3b82f6"},{name:"Vandalism",value:25,color:"#10b981"},{name:"Assault",value:20,color:"#f59e0b"},{name:"Burglary",value:15,color:"#ef4444"},{name:"Other",value:5,color:"#8b5cf6"}],ONe=()=>{const{user:e}=Kd();return e?z.jsxs("div",{className:"container mx-auto px-4 py-8 space-y-8",children:[z.jsxs("div",{className:"text-center space-y-4",children:[z.jsx("h1",{className:"text-4xl font-bold text-slate-800 dark:text-slate-200 animate-fade-in",children:"Urban Crime Reporting System"}),z.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-400 max-w-2xl mx-auto",children:"Help keep your community safe by reporting incidents and staying informed about local crime trends."}),z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 pt-6",children:[z.jsx(pi,{asChild:!0,size:"lg",className:"hover-scale h-auto py-4 px-6",children:z.jsxs(Xs,{to:"/report",className:"flex flex-col items-center space-y-2",children:[z.jsx(sx,{className:"h-6 w-6"}),z.jsx("span",{children:"Report Incident"})]})}),z.jsx(pi,{asChild:!0,variant:"outline",size:"lg",className:"hover-scale h-auto py-4 px-6",children:z.jsxs(Xs,{to:"/view-crimes",className:"flex flex-col items-center space-y-2",children:[z.jsx(ax,{className:"h-6 w-6"}),z.jsx("span",{children:"View Crime Data"})]})}),z.jsx(pi,{asChild:!0,variant:"outline",size:"lg",className:"hover-scale h-auto py-4 px-6",children:z.jsxs(Xs,{to:"/community",className:"flex flex-col items-center space-y-2",children:[z.jsx(RT,{className:"h-6 w-6"}),z.jsx("span",{children:"Community Insights"})]})}),z.jsx(pi,{asChild:!0,variant:"destructive",size:"lg",className:"hover-scale h-auto py-4 px-6",children:z.jsxs(Xs,{to:"/emergency",className:"flex flex-col items-center space-y-2",children:[z.jsx(aB,{className:"h-6 w-6"}),z.jsx("span",{children:"Emergency Alerts"})]})})]})]}),z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[z.jsxs(wi,{className:"hover-scale",children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Total Reports"}),z.jsx(sx,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsxs(Si,{children:[z.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"293"}),z.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% from last month"})]})]}),z.jsxs(wi,{className:"hover-scale",children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Resolved Cases"}),z.jsx(uG,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsxs(Si,{children:[z.jsx("div",{className:"text-2xl font-bold text-green-600",children:"247"}),z.jsx("p",{className:"text-xs text-muted-foreground",children:"84% resolution rate"})]})]}),z.jsxs(wi,{className:"hover-scale",children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Active Cases"}),z.jsx(Yk,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsxs(Si,{children:[z.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"46"}),z.jsx("p",{className:"text-xs text-muted-foreground",children:"Under investigation"})]})]}),z.jsxs(wi,{className:"hover-scale",children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Community Safety"}),z.jsx(ax,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsxs(Si,{children:[z.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"High"}),z.jsx("p",{className:"text-xs text-muted-foreground",children:"Based on recent trends"})]})]})]}),z.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[z.jsxs(wi,{className:"animate-fade-in",children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Monthly Crime Reports"}),z.jsx(xa,{children:"Number of reports submitted each month"})]}),z.jsx(Si,{children:z.jsx("div",{className:"h-80",children:z.jsx(E5,{width:"100%",height:"100%",children:z.jsxs(PNe,{data:INe,children:[z.jsx(HZ,{strokeDasharray:"3 3"}),z.jsx(EA,{dataKey:"month"}),z.jsx(AA,{}),z.jsx(ec,{}),z.jsx(hm,{dataKey:"reports",fill:"#3b82f6",radius:[4,4,0,0]})]})})})})]}),z.jsxs(wi,{className:"animate-fade-in",children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Crime Types Distribution"}),z.jsx(xa,{children:"Breakdown of reported crime categories"})]}),z.jsx(Si,{children:z.jsx("div",{className:"h-80",children:z.jsx(E5,{width:"100%",height:"100%",children:z.jsxs(CNe,{children:[z.jsx(ah,{data:hV,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:t,percent:r})=>`${t} ${(r*100).toFixed(0)}%`,children:hV.map((t,r)=>z.jsx(eA,{fill:t.color},`cell-${r}`))}),z.jsx(ec,{})]})})})})]})]}),z.jsxs(wi,{className:"animate-fade-in",children:[z.jsxs(Mi,{children:[z.jsxs(Ri,{className:"flex items-center space-x-2",children:[z.jsx(fG,{className:"h-5 w-5"}),z.jsx("span",{children:"Recent Activity"})]}),z.jsx(xa,{children:"Latest updates in your area"})]}),z.jsxs(Si,{className:"space-y-4",children:[z.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg",children:[z.jsx(jd,{className:"h-5 w-5 text-orange-500 mt-0.5"}),z.jsxs("div",{children:[z.jsx("p",{className:"font-medium",children:"Vandalism Reported"}),z.jsx("p",{className:"text-sm text-muted-foreground",children:"Downtown area - 2 hours ago"})]})]}),z.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg",children:[z.jsx(Hp,{className:"h-5 w-5 text-blue-500 mt-0.5"}),z.jsxs("div",{children:[z.jsx("p",{className:"font-medium",children:"Theft Investigation Complete"}),z.jsx("p",{className:"text-sm text-muted-foreground",children:"Market Street - 1 day ago"})]})]}),z.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg",children:[z.jsx(Qk,{className:"h-5 w-5 text-green-500 mt-0.5"}),z.jsxs("div",{children:[z.jsx("p",{className:"font-medium",children:"Community Safety Meeting"}),z.jsx("p",{className:"text-sm text-muted-foreground",children:"City Hall - Tomorrow 7 PM"})]})]})]})]})]}):z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:z.jsx("div",{className:"container mx-auto px-4 py-16",children:z.jsxs("div",{className:"text-center max-w-4xl mx-auto",children:[z.jsxs("div",{className:"mb-8",children:[z.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-blue-600 rounded-full mb-6",children:z.jsx(ax,{className:"h-12 w-12 text-white"})}),z.jsxs("h1",{className:"text-4xl md:text-6xl font-bold text-slate-900 dark:text-slate-100 mb-6",children:["Keep Your Community",z.jsx("span",{className:"text-blue-600 block",children:"Safe Together"})]}),z.jsx("p",{className:"text-xl md:text-2xl text-slate-600 dark:text-slate-400 mb-8 max-w-3xl mx-auto",children:"Join thousands of citizens working together to create safer neighborhoods through community reporting and real-time alerts."})]}),z.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mb-12",children:[z.jsx(pi,{asChild:!0,size:"lg",className:"text-lg px-8 py-6",children:z.jsxs(Xs,{to:"/auth",className:"flex items-center gap-2",children:["Get Started Free",z.jsx(nB,{className:"h-5 w-5"})]})}),z.jsx(pi,{variant:"outline",asChild:!0,size:"lg",className:"text-lg px-8 py-6",children:z.jsx(Xs,{to:"/auth",children:"Sign In"})})]}),z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 mb-16",children:[z.jsxs(wi,{className:"text-center hover:shadow-lg transition-shadow",children:[z.jsxs(Mi,{children:[z.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-green-100 dark:bg-green-900/20 rounded-full mb-4",children:z.jsx(sx,{className:"h-8 w-8 text-green-600"})}),z.jsx(Ri,{children:"Quick Reporting"})]}),z.jsx(Si,{children:z.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Report incidents quickly and securely with our easy-to-use interface. Your reports help keep everyone informed."})})]}),z.jsxs(wi,{className:"text-center hover:shadow-lg transition-shadow",children:[z.jsxs(Mi,{children:[z.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-blue-100 dark:bg-blue-900/20 rounded-full mb-4",children:z.jsx(RT,{className:"h-8 w-8 text-blue-600"})}),z.jsx(Ri,{children:"Community Insights"})]}),z.jsx(Si,{children:z.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Share experiences, safety tips, and connect with neighbors to build a stronger, safer community."})})]}),z.jsxs(wi,{className:"text-center hover:shadow-lg transition-shadow",children:[z.jsxs(Mi,{children:[z.jsx("div",{className:"inline-flex items-center justify-center p-3 bg-red-100 dark:bg-red-900/20 rounded-full mb-4",children:z.jsx(aB,{className:"h-8 w-8 text-red-600"})}),z.jsx(Ri,{children:"Real-time Alerts"})]}),z.jsx(Si,{children:z.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Stay informed with instant emergency alerts and important community updates delivered directly to you."})})]})]}),z.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-8 mb-16",children:[z.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-8",children:"What Our Community Says"}),z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[z.jsxs("div",{className:"text-left",children:[z.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((t,r)=>z.jsx(lB,{className:"h-5 w-5 text-yellow-400 fill-current"},r))}),z.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:`"UrbanEye has transformed how our neighborhood communicates about safety. We're more connected and informed than ever."`}),z.jsx("p",{className:"font-semibold text-slate-900 dark:text-slate-100",children:"- Sarah M., Community Leader"})]}),z.jsxs("div",{className:"text-left",children:[z.jsx("div",{className:"flex mb-4",children:[...Array(5)].map((t,r)=>z.jsx(lB,{className:"h-5 w-5 text-yellow-400 fill-current"},r))}),z.jsx("p",{className:"text-slate-600 dark:text-slate-400 mb-4",children:'"The real-time alerts have helped us stay safe and respond quickly to situations in our area. Highly recommended!"'}),z.jsx("p",{className:"font-semibold text-slate-900 dark:text-slate-100",children:"- Mike T., Resident"})]})]})]}),z.jsxs("div",{className:"text-center",children:[z.jsx("h2",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-4",children:"Ready to Make Your Community Safer?"}),z.jsx("p",{className:"text-xl text-slate-600 dark:text-slate-400 mb-8",children:"Join our community today and start making a difference."}),z.jsx(pi,{asChild:!0,size:"lg",className:"text-lg px-8 py-6",children:z.jsxs(Xs,{to:"/auth",className:"flex items-center gap-2",children:["Sign Up Now",z.jsx(nB,{className:"h-5 w-5"})]})})]})]})})})},zs=Q.forwardRef(({className:e,type:t,...r},i)=>z.jsx("input",{type:t,className:zn("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:i,...r}));zs.displayName="Input";var MNe="Label",aX=Q.forwardRef((e,t)=>z.jsx(Sn.label,{...e,ref:t,onMouseDown:r=>{var c;r.target.closest("button, input, select, textarea")||((c=e.onMouseDown)==null||c.call(e,r),!r.defaultPrevented&&r.detail>1&&r.preventDefault())}}));aX.displayName=MNe;var lX=aX;const RNe=j1("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Go=Q.forwardRef(({className:e,...t},r)=>z.jsx(lX,{ref:r,className:zn(RNe(),e),...t}));Go.displayName=lX.displayName;const eb=Q.forwardRef(({className:e,...t},r)=>z.jsx("textarea",{className:zn("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:r,...t}));eb.displayName="Textarea";function dV(e,[t,r]){return Math.min(r,Math.max(t,e))}function kNe(e){const t=Q.useRef({value:e,previous:e});return Q.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var DNe=[" ","Enter","ArrowUp","ArrowDown"],LNe=[" ","Enter"],tb="Select",[CA,IA,zNe]=a2(tb),[ky,Hje]=nm(tb,[zNe,my]),OA=my(),[NNe,tf]=ky(tb),[jNe,FNe]=ky(tb),cX=e=>{const{__scopeSelect:t,children:r,open:i,defaultOpen:c,onOpenChange:d,value:g,defaultValue:o,onValueChange:w,dir:T,name:I,autoComplete:C,disabled:R,required:F,form:G}=e,j=OA(t),[H,X]=Q.useState(null),[q,Z]=Q.useState(null),[J,ne]=Q.useState(!1),he=T2(T),[me=!1,Se]=Gp({prop:i,defaultProp:c,onChange:d}),[qe,Ze]=Gp({prop:g,defaultProp:o,onChange:w}),He=Q.useRef(null),Ke=H?G||!!H.closest("form"):!0,[dt,$e]=Q.useState(new Set),mt=Array.from(dt).map(ct=>ct.props.value).join(";");return z.jsx(VG,{...j,children:z.jsxs(NNe,{required:F,scope:t,trigger:H,onTriggerChange:X,valueNode:q,onValueNodeChange:Z,valueNodeHasChildren:J,onValueNodeHasChildrenChange:ne,contentId:Kc(),value:qe,onValueChange:Ze,open:me,onOpenChange:Se,dir:he,triggerPointerDownPosRef:He,disabled:R,children:[z.jsx(CA.Provider,{scope:t,children:z.jsx(jNe,{scope:e.__scopeSelect,onNativeOptionAdd:Q.useCallback(ct=>{$e(St=>new Set(St).add(ct))},[]),onNativeOptionRemove:Q.useCallback(ct=>{$e(St=>{const Ue=new Set(St);return Ue.delete(ct),Ue})},[]),children:r})}),Ke?z.jsxs(DX,{"aria-hidden":!0,required:F,tabIndex:-1,name:I,autoComplete:C,value:qe,onChange:ct=>Ze(ct.target.value),disabled:R,form:G,children:[qe===void 0?z.jsx("option",{value:""}):null,Array.from(dt)]},mt):null]})})};cX.displayName=tb;var uX="SelectTrigger",hX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,disabled:i=!1,...c}=e,d=OA(r),g=tf(uX,r),o=g.disabled||i,w=Ci(t,g.onTriggerChange),T=IA(r),I=Q.useRef("touch"),[C,R,F]=LX(j=>{const H=T().filter(Z=>!Z.disabled),X=H.find(Z=>Z.value===g.value),q=zX(H,j,X);q!==void 0&&g.onValueChange(q.value)}),G=j=>{o||(g.onOpenChange(!0),F()),j&&(g.triggerPointerDownPosRef.current={x:Math.round(j.pageX),y:Math.round(j.pageY)})};return z.jsx(cD,{asChild:!0,...d,children:z.jsx(Sn.button,{type:"button",role:"combobox","aria-controls":g.contentId,"aria-expanded":g.open,"aria-required":g.required,"aria-autocomplete":"none",dir:g.dir,"data-state":g.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":kX(g.value)?"":void 0,...c,ref:w,onClick:Er(c.onClick,j=>{j.currentTarget.focus(),I.current!=="mouse"&&G(j)}),onPointerDown:Er(c.onPointerDown,j=>{I.current=j.pointerType;const H=j.target;H.hasPointerCapture(j.pointerId)&&H.releasePointerCapture(j.pointerId),j.button===0&&j.ctrlKey===!1&&j.pointerType==="mouse"&&(G(j),j.preventDefault())}),onKeyDown:Er(c.onKeyDown,j=>{const H=C.current!=="";!(j.ctrlKey||j.altKey||j.metaKey)&&j.key.length===1&&R(j.key),!(H&&j.key===" ")&&DNe.includes(j.key)&&(G(),j.preventDefault())})})})});hX.displayName=uX;var dX="SelectValue",fX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,className:i,style:c,children:d,placeholder:g="",...o}=e,w=tf(dX,r),{onValueNodeHasChildrenChange:T}=w,I=d!==void 0,C=Ci(t,w.onValueNodeChange);return Fs(()=>{T(I)},[T,I]),z.jsx(Sn.span,{...o,ref:C,style:{pointerEvents:"none"},children:kX(w.value)?z.jsx(z.Fragment,{children:g}):d})});fX.displayName=dX;var BNe="SelectIcon",pX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,children:i,...c}=e;return z.jsx(Sn.span,{"aria-hidden":!0,...c,ref:t,children:i||""})});pX.displayName=BNe;var $Ne="SelectPortal",mX=e=>z.jsx(z1,{asChild:!0,...e});mX.displayName=$Ne;var Qp="SelectContent",gX=Q.forwardRef((e,t)=>{const r=tf(Qp,e.__scopeSelect),[i,c]=Q.useState();if(Fs(()=>{c(new DocumentFragment)},[]),!r.open){const d=i;return d?rm.createPortal(z.jsx(_X,{scope:e.__scopeSelect,children:z.jsx(CA.Slot,{scope:e.__scopeSelect,children:z.jsx("div",{children:e.children})})}),d):null}return z.jsx(yX,{...e,ref:t})});gX.displayName=Qp;var Zl=10,[_X,rf]=ky(Qp),UNe="SelectContentImpl",yX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,position:i="item-aligned",onCloseAutoFocus:c,onEscapeKeyDown:d,onPointerDownOutside:g,side:o,sideOffset:w,align:T,alignOffset:I,arrowPadding:C,collisionBoundary:R,collisionPadding:F,sticky:G,hideWhenDetached:j,avoidCollisions:H,...X}=e,q=tf(Qp,r),[Z,J]=Q.useState(null),[ne,he]=Q.useState(null),me=Ci(t,nr=>J(nr)),[Se,qe]=Q.useState(null),[Ze,He]=Q.useState(null),Ke=IA(r),[dt,$e]=Q.useState(!1),mt=Q.useRef(!1);Q.useEffect(()=>{if(Z)return ED(Z)},[Z]),TD();const ct=Q.useCallback(nr=>{const[Xr,...Lt]=Ke().map(Mt=>Mt.ref.current),[ur]=Lt.slice(-1),_r=document.activeElement;for(const Mt of nr)if(Mt===_r||(Mt==null||Mt.scrollIntoView({block:"nearest"}),Mt===Xr&&ne&&(ne.scrollTop=0),Mt===ur&&ne&&(ne.scrollTop=ne.scrollHeight),Mt==null||Mt.focus(),document.activeElement!==_r))return},[Ke,ne]),St=Q.useCallback(()=>ct([Se,Z]),[ct,Se,Z]);Q.useEffect(()=>{dt&&St()},[dt,St]);const{onOpenChange:Ue,triggerPointerDownPosRef:st}=q;Q.useEffect(()=>{if(Z){let nr={x:0,y:0};const Xr=ur=>{var _r,Mt;nr={x:Math.abs(Math.round(ur.pageX)-(((_r=st.current)==null?void 0:_r.x)??0)),y:Math.abs(Math.round(ur.pageY)-(((Mt=st.current)==null?void 0:Mt.y)??0))}},Lt=ur=>{nr.x<=10&&nr.y<=10?ur.preventDefault():Z.contains(ur.target)||Ue(!1),document.removeEventListener("pointermove",Xr),st.current=null};return st.current!==null&&(document.addEventListener("pointermove",Xr),document.addEventListener("pointerup",Lt,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Xr),document.removeEventListener("pointerup",Lt,{capture:!0})}}},[Z,Ue,st]),Q.useEffect(()=>{const nr=()=>Ue(!1);return window.addEventListener("blur",nr),window.addEventListener("resize",nr),()=>{window.removeEventListener("blur",nr),window.removeEventListener("resize",nr)}},[Ue]);const[bt,At]=LX(nr=>{const Xr=Ke().filter(_r=>!_r.disabled),Lt=Xr.find(_r=>_r.ref.current===document.activeElement),ur=zX(Xr,nr,Lt);ur&&setTimeout(()=>ur.ref.current.focus())}),zt=Q.useCallback((nr,Xr,Lt)=>{const ur=!mt.current&&!Lt;(q.value!==void 0&&q.value===Xr||ur)&&(qe(nr),ur&&(mt.current=!0))},[q.value]),or=Q.useCallback(()=>Z==null?void 0:Z.focus(),[Z]),Mr=Q.useCallback((nr,Xr,Lt)=>{const ur=!mt.current&&!Lt;(q.value!==void 0&&q.value===Xr||ur)&&He(nr)},[q.value]),Ar=i==="popper"?qR:vX,vr=Ar===qR?{side:o,sideOffset:w,align:T,alignOffset:I,arrowPadding:C,collisionBoundary:R,collisionPadding:F,sticky:G,hideWhenDetached:j,avoidCollisions:H}:{};return z.jsx(_X,{scope:r,content:Z,viewport:ne,onViewportChange:he,itemRefCallback:zt,selectedItem:Se,onItemLeave:or,itemTextRefCallback:Mr,focusSelectedItem:St,selectedItemText:Ze,position:i,isPositioned:dt,searchRef:bt,children:z.jsx(I2,{as:Nd,allowPinchZoom:!0,children:z.jsx(E2,{asChild:!0,trapped:q.open,onMountAutoFocus:nr=>{nr.preventDefault()},onUnmountAutoFocus:Er(c,nr=>{var Xr;(Xr=q.trigger)==null||Xr.focus({preventScroll:!0}),nr.preventDefault()}),children:z.jsx(hy,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:nr=>nr.preventDefault(),onDismiss:()=>q.onOpenChange(!1),children:z.jsx(Ar,{role:"listbox",id:q.contentId,"data-state":q.open?"open":"closed",dir:q.dir,onContextMenu:nr=>nr.preventDefault(),...X,...vr,onPlaced:()=>$e(!0),ref:me,style:{display:"flex",flexDirection:"column",outline:"none",...X.style},onKeyDown:Er(X.onKeyDown,nr=>{const Xr=nr.ctrlKey||nr.altKey||nr.metaKey;if(nr.key==="Tab"&&nr.preventDefault(),!Xr&&nr.key.length===1&&At(nr.key),["ArrowUp","ArrowDown","Home","End"].includes(nr.key)){let ur=Ke().filter(_r=>!_r.disabled).map(_r=>_r.ref.current);if(["ArrowUp","End"].includes(nr.key)&&(ur=ur.slice().reverse()),["ArrowUp","ArrowDown"].includes(nr.key)){const _r=nr.target,Mt=ur.indexOf(_r);ur=ur.slice(Mt+1)}setTimeout(()=>ct(ur)),nr.preventDefault()}})})})})})})});yX.displayName=UNe;var VNe="SelectItemAlignedPosition",vX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,onPlaced:i,...c}=e,d=tf(Qp,r),g=rf(Qp,r),[o,w]=Q.useState(null),[T,I]=Q.useState(null),C=Ci(t,me=>I(me)),R=IA(r),F=Q.useRef(!1),G=Q.useRef(!0),{viewport:j,selectedItem:H,selectedItemText:X,focusSelectedItem:q}=g,Z=Q.useCallback(()=>{if(d.trigger&&d.valueNode&&o&&T&&j&&H&&X){const me=d.trigger.getBoundingClientRect(),Se=T.getBoundingClientRect(),qe=d.valueNode.getBoundingClientRect(),Ze=X.getBoundingClientRect();if(d.dir!=="rtl"){const _r=Ze.left-Se.left,Mt=qe.left-_r,Nr=me.left-Mt,Yr=me.width+Nr,Hn=Math.max(Yr,Se.width),en=window.innerWidth-Zl,Ei=dV(Mt,[Zl,Math.max(Zl,en-Hn)]);o.style.minWidth=Yr+"px",o.style.left=Ei+"px"}else{const _r=Se.right-Ze.right,Mt=window.innerWidth-qe.right-_r,Nr=window.innerWidth-me.right-Mt,Yr=me.width+Nr,Hn=Math.max(Yr,Se.width),en=window.innerWidth-Zl,Ei=dV(Mt,[Zl,Math.max(Zl,en-Hn)]);o.style.minWidth=Yr+"px",o.style.right=Ei+"px"}const He=R(),Ke=window.innerHeight-Zl*2,dt=j.scrollHeight,$e=window.getComputedStyle(T),mt=parseInt($e.borderTopWidth,10),ct=parseInt($e.paddingTop,10),St=parseInt($e.borderBottomWidth,10),Ue=parseInt($e.paddingBottom,10),st=mt+ct+dt+Ue+St,bt=Math.min(H.offsetHeight*5,st),At=window.getComputedStyle(j),zt=parseInt(At.paddingTop,10),or=parseInt(At.paddingBottom,10),Mr=me.top+me.height/2-Zl,Ar=Ke-Mr,vr=H.offsetHeight/2,nr=H.offsetTop+vr,Xr=mt+ct+nr,Lt=st-Xr;if(Xr<=Mr){const _r=He.length>0&&H===He[He.length-1].ref.current;o.style.bottom="0px";const Mt=T.clientHeight-j.offsetTop-j.offsetHeight,Nr=Math.max(Ar,vr+(_r?or:0)+Mt+St),Yr=Xr+Nr;o.style.height=Yr+"px"}else{const _r=He.length>0&&H===He[0].ref.current;o.style.top="0px";const Nr=Math.max(Mr,mt+j.offsetTop+(_r?zt:0)+vr)+Lt;o.style.height=Nr+"px",j.scrollTop=Xr-Mr+j.offsetTop}o.style.margin=`${Zl}px 0`,o.style.minHeight=bt+"px",o.style.maxHeight=Ke+"px",i==null||i(),requestAnimationFrame(()=>F.current=!0)}},[R,d.trigger,d.valueNode,o,T,j,H,X,d.dir,i]);Fs(()=>Z(),[Z]);const[J,ne]=Q.useState();Fs(()=>{T&&ne(window.getComputedStyle(T).zIndex)},[T]);const he=Q.useCallback(me=>{me&&G.current===!0&&(Z(),q==null||q(),G.current=!1)},[Z,q]);return z.jsx(HNe,{scope:r,contentWrapper:o,shouldExpandOnScrollRef:F,onScrollButtonChange:he,children:z.jsx("div",{ref:w,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:J},children:z.jsx(Sn.div,{...c,ref:C,style:{boxSizing:"border-box",maxHeight:"100%",...c.style}})})})});vX.displayName=VNe;var GNe="SelectPopperPosition",qR=Q.forwardRef((e,t)=>{const{__scopeSelect:r,align:i="start",collisionPadding:c=Zl,...d}=e,g=OA(r);return z.jsx(uD,{...g,...d,ref:t,align:i,collisionPadding:c,style:{boxSizing:"border-box",...d.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});qR.displayName=GNe;var[HNe,HL]=ky(Qp,{}),ZR="SelectViewport",xX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,nonce:i,...c}=e,d=rf(ZR,r),g=HL(ZR,r),o=Ci(t,d.onViewportChange),w=Q.useRef(0);return z.jsxs(z.Fragment,{children:[z.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),z.jsx(CA.Slot,{scope:r,children:z.jsx(Sn.div,{"data-radix-select-viewport":"",role:"presentation",...c,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...c.style},onScroll:Er(c.onScroll,T=>{const I=T.currentTarget,{contentWrapper:C,shouldExpandOnScrollRef:R}=g;if(R!=null&&R.current&&C){const F=Math.abs(w.current-I.scrollTop);if(F>0){const G=window.innerHeight-Zl*2,j=parseFloat(C.style.minHeight),H=parseFloat(C.style.height),X=Math.max(j,H);if(X<G){const q=X+F,Z=Math.min(G,q),J=q-Z;C.style.height=Z+"px",C.style.bottom==="0px"&&(I.scrollTop=J>0?J:0,C.style.justifyContent="flex-end")}}}w.current=I.scrollTop})})})]})});xX.displayName=ZR;var bX="SelectGroup",[WNe,qNe]=ky(bX),ZNe=Q.forwardRef((e,t)=>{const{__scopeSelect:r,...i}=e,c=Kc();return z.jsx(WNe,{scope:r,id:c,children:z.jsx(Sn.div,{role:"group","aria-labelledby":c,...i,ref:t})})});ZNe.displayName=bX;var wX="SelectLabel",SX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,...i}=e,c=qNe(wX,r);return z.jsx(Sn.div,{id:c.id,...i,ref:t})});SX.displayName=wX;var VE="SelectItem",[XNe,TX]=ky(VE),EX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,value:i,disabled:c=!1,textValue:d,...g}=e,o=tf(VE,r),w=rf(VE,r),T=o.value===i,[I,C]=Q.useState(d??""),[R,F]=Q.useState(!1),G=Ci(t,q=>{var Z;return(Z=w.itemRefCallback)==null?void 0:Z.call(w,q,i,c)}),j=Kc(),H=Q.useRef("touch"),X=()=>{c||(o.onValueChange(i),o.onOpenChange(!1))};if(i==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return z.jsx(XNe,{scope:r,value:i,disabled:c,textId:j,isSelected:T,onItemTextChange:Q.useCallback(q=>{C(Z=>Z||((q==null?void 0:q.textContent)??"").trim())},[]),children:z.jsx(CA.ItemSlot,{scope:r,value:i,disabled:c,textValue:I,children:z.jsx(Sn.div,{role:"option","aria-labelledby":j,"data-highlighted":R?"":void 0,"aria-selected":T&&R,"data-state":T?"checked":"unchecked","aria-disabled":c||void 0,"data-disabled":c?"":void 0,tabIndex:c?void 0:-1,...g,ref:G,onFocus:Er(g.onFocus,()=>F(!0)),onBlur:Er(g.onBlur,()=>F(!1)),onClick:Er(g.onClick,()=>{H.current!=="mouse"&&X()}),onPointerUp:Er(g.onPointerUp,()=>{H.current==="mouse"&&X()}),onPointerDown:Er(g.onPointerDown,q=>{H.current=q.pointerType}),onPointerMove:Er(g.onPointerMove,q=>{var Z;H.current=q.pointerType,c?(Z=w.onItemLeave)==null||Z.call(w):H.current==="mouse"&&q.currentTarget.focus({preventScroll:!0})}),onPointerLeave:Er(g.onPointerLeave,q=>{var Z;q.currentTarget===document.activeElement&&((Z=w.onItemLeave)==null||Z.call(w))}),onKeyDown:Er(g.onKeyDown,q=>{var J;((J=w.searchRef)==null?void 0:J.current)!==""&&q.key===" "||(LNe.includes(q.key)&&X(),q.key===" "&&q.preventDefault())})})})})});EX.displayName=VE;var X0="SelectItemText",AX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,className:i,style:c,...d}=e,g=tf(X0,r),o=rf(X0,r),w=TX(X0,r),T=FNe(X0,r),[I,C]=Q.useState(null),R=Ci(t,X=>C(X),w.onItemTextChange,X=>{var q;return(q=o.itemTextRefCallback)==null?void 0:q.call(o,X,w.value,w.disabled)}),F=I==null?void 0:I.textContent,G=Q.useMemo(()=>z.jsx("option",{value:w.value,disabled:w.disabled,children:F},w.value),[w.disabled,w.value,F]),{onNativeOptionAdd:j,onNativeOptionRemove:H}=T;return Fs(()=>(j(G),()=>H(G)),[j,H,G]),z.jsxs(z.Fragment,{children:[z.jsx(Sn.span,{id:w.textId,...d,ref:R}),w.isSelected&&g.valueNode&&!g.valueNodeHasChildren?rm.createPortal(d.children,g.valueNode):null]})});AX.displayName=X0;var PX="SelectItemIndicator",CX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,...i}=e;return TX(PX,r).isSelected?z.jsx(Sn.span,{"aria-hidden":!0,...i,ref:t}):null});CX.displayName=PX;var XR="SelectScrollUpButton",IX=Q.forwardRef((e,t)=>{const r=rf(XR,e.__scopeSelect),i=HL(XR,e.__scopeSelect),[c,d]=Q.useState(!1),g=Ci(t,i.onScrollButtonChange);return Fs(()=>{if(r.viewport&&r.isPositioned){let o=function(){const T=w.scrollTop>0;d(T)};const w=r.viewport;return o(),w.addEventListener("scroll",o),()=>w.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),c?z.jsx(MX,{...e,ref:g,onAutoScroll:()=>{const{viewport:o,selectedItem:w}=r;o&&w&&(o.scrollTop=o.scrollTop-w.offsetHeight)}}):null});IX.displayName=XR;var KR="SelectScrollDownButton",OX=Q.forwardRef((e,t)=>{const r=rf(KR,e.__scopeSelect),i=HL(KR,e.__scopeSelect),[c,d]=Q.useState(!1),g=Ci(t,i.onScrollButtonChange);return Fs(()=>{if(r.viewport&&r.isPositioned){let o=function(){const T=w.scrollHeight-w.clientHeight,I=Math.ceil(w.scrollTop)<T;d(I)};const w=r.viewport;return o(),w.addEventListener("scroll",o),()=>w.removeEventListener("scroll",o)}},[r.viewport,r.isPositioned]),c?z.jsx(MX,{...e,ref:g,onAutoScroll:()=>{const{viewport:o,selectedItem:w}=r;o&&w&&(o.scrollTop=o.scrollTop+w.offsetHeight)}}):null});OX.displayName=KR;var MX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,onAutoScroll:i,...c}=e,d=rf("SelectScrollButton",r),g=Q.useRef(null),o=IA(r),w=Q.useCallback(()=>{g.current!==null&&(window.clearInterval(g.current),g.current=null)},[]);return Q.useEffect(()=>()=>w(),[w]),Fs(()=>{var I;const T=o().find(C=>C.ref.current===document.activeElement);(I=T==null?void 0:T.ref.current)==null||I.scrollIntoView({block:"nearest"})},[o]),z.jsx(Sn.div,{"aria-hidden":!0,...c,ref:t,style:{flexShrink:0,...c.style},onPointerDown:Er(c.onPointerDown,()=>{g.current===null&&(g.current=window.setInterval(i,50))}),onPointerMove:Er(c.onPointerMove,()=>{var T;(T=d.onItemLeave)==null||T.call(d),g.current===null&&(g.current=window.setInterval(i,50))}),onPointerLeave:Er(c.onPointerLeave,()=>{w()})})}),KNe="SelectSeparator",RX=Q.forwardRef((e,t)=>{const{__scopeSelect:r,...i}=e;return z.jsx(Sn.div,{"aria-hidden":!0,...i,ref:t})});RX.displayName=KNe;var YR="SelectArrow",YNe=Q.forwardRef((e,t)=>{const{__scopeSelect:r,...i}=e,c=OA(r),d=tf(YR,r),g=rf(YR,r);return d.open&&g.position==="popper"?z.jsx(hD,{...c,...i,ref:t}):null});YNe.displayName=YR;function kX(e){return e===""||e===void 0}var DX=Q.forwardRef((e,t)=>{const{value:r,...i}=e,c=Q.useRef(null),d=Ci(t,c),g=kNe(r);return Q.useEffect(()=>{const o=c.current,w=window.HTMLSelectElement.prototype,I=Object.getOwnPropertyDescriptor(w,"value").set;if(g!==r&&I){const C=new Event("change",{bubbles:!0});I.call(o,r),o.dispatchEvent(C)}},[g,r]),z.jsx(N1,{asChild:!0,children:z.jsx("select",{...i,ref:d,defaultValue:r})})});DX.displayName="BubbleSelect";function LX(e){const t=js(e),r=Q.useRef(""),i=Q.useRef(0),c=Q.useCallback(g=>{const o=r.current+g;t(o),function w(T){r.current=T,window.clearTimeout(i.current),T!==""&&(i.current=window.setTimeout(()=>w(""),1e3))}(o)},[t]),d=Q.useCallback(()=>{r.current="",window.clearTimeout(i.current)},[]);return Q.useEffect(()=>()=>window.clearTimeout(i.current),[]),[r,c,d]}function zX(e,t,r){const c=t.length>1&&Array.from(t).every(T=>T===t[0])?t[0]:t,d=r?e.indexOf(r):-1;let g=JNe(e,Math.max(d,0));c.length===1&&(g=g.filter(T=>T!==r));const w=g.find(T=>T.textValue.toLowerCase().startsWith(c.toLowerCase()));return w!==r?w:void 0}function JNe(e,t){return e.map((r,i)=>e[(t+i)%e.length])}var QNe=cX,NX=hX,eje=fX,tje=pX,rje=mX,jX=gX,nje=xX,FX=SX,BX=EX,ije=AX,oje=CX,$X=IX,UX=OX,VX=RX;const __=QNe,y_=eje,Np=Q.forwardRef(({className:e,children:t,...r},i)=>z.jsxs(NX,{ref:i,className:zn("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...r,children:[t,z.jsx(tje,{asChild:!0,children:z.jsx(cG,{className:"h-4 w-4 opacity-50"})})]}));Np.displayName=NX.displayName;const GX=Q.forwardRef(({className:e,...t},r)=>z.jsx($X,{ref:r,className:zn("flex cursor-default items-center justify-center py-1",e),...t,children:z.jsx(Kre,{className:"h-4 w-4"})}));GX.displayName=$X.displayName;const HX=Q.forwardRef(({className:e,...t},r)=>z.jsx(UX,{ref:r,className:zn("flex cursor-default items-center justify-center py-1",e),...t,children:z.jsx(cG,{className:"h-4 w-4"})}));HX.displayName=UX.displayName;const jp=Q.forwardRef(({className:e,children:t,position:r="popper",...i},c)=>z.jsx(rje,{children:z.jsxs(jX,{ref:c,className:zn("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...i,children:[z.jsx(GX,{}),z.jsx(nje,{className:zn("p-1",r==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),z.jsx(HX,{})]})}));jp.displayName=jX.displayName;const sje=Q.forwardRef(({className:e,...t},r)=>z.jsx(FX,{ref:r,className:zn("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));sje.displayName=FX.displayName;const Pi=Q.forwardRef(({className:e,children:t,...r},i)=>z.jsxs(BX,{ref:i,className:zn("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[z.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:z.jsx(oje,{children:z.jsx(lG,{className:"h-4 w-4"})})}),z.jsx(ije,{children:t})]}));Pi.displayName=BX.displayName;const aje=Q.forwardRef(({className:e,...t},r)=>z.jsx(VX,{ref:r,className:zn("-mx-1 my-1 h-px bg-muted",e),...t}));aje.displayName=VX.displayName;const lje=()=>{const[e,t]=Q.useState(!1),{toast:r}=Wd(),{user:i}=Kd(),c=async d=>{if(d.preventDefault(),!i){r({title:"Authentication Required",description:"Please sign in to report an incident.",variant:"destructive"});return}t(!0);const g=new FormData(d.currentTarget),o={user_id:i.id,title:g.get("title"),description:g.get("description"),incident_type:g.get("incidentType"),priority:g.get("priority"),address:g.get("address"),incident_date:g.get("incidentDate")};try{const{error:w}=await ja.from("crime_incidents").insert([o]);if(w)throw w;r({title:"Incident Reported Successfully",description:"Your incident report has been submitted and will be reviewed by authorities."}),d.target.reset()}catch(w){console.error("Error reporting incident:",w),r({title:"Error",description:"Failed to submit your report. Please try again.",variant:"destructive"})}finally{t(!1)}};return z.jsx("div",{className:"container mx-auto px-4 py-8",children:z.jsxs("div",{className:"max-w-2xl mx-auto",children:[z.jsxs("div",{className:"mb-8 text-center",children:[z.jsx("div",{className:"flex items-center justify-center mb-4",children:z.jsx("div",{className:"p-3 bg-red-100 rounded-full",children:z.jsx(jd,{className:"h-8 w-8 text-red-600"})})}),z.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Report an Incident"}),z.jsx("p",{className:"text-slate-600",children:"Help keep your community safe by reporting criminal activities or suspicious behavior."})]}),z.jsxs(wi,{children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Incident Details"}),z.jsx(xa,{children:"Please provide as much detail as possible to help authorities respond effectively."})]}),z.jsx(Si,{children:z.jsxs("form",{onSubmit:c,className:"space-y-6",children:[z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"title",children:"Incident Title *"}),z.jsx(zs,{id:"title",name:"title",placeholder:"Brief description of the incident",required:!0})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"incidentType",children:"Incident Type *"}),z.jsxs(__,{name:"incidentType",required:!0,children:[z.jsx(Np,{children:z.jsx(y_,{placeholder:"Select incident type"})}),z.jsxs(jp,{children:[z.jsx(Pi,{value:"theft",children:"Theft"}),z.jsx(Pi,{value:"assault",children:"Assault"}),z.jsx(Pi,{value:"vandalism",children:"Vandalism"}),z.jsx(Pi,{value:"burglary",children:"Burglary"}),z.jsx(Pi,{value:"drug_activity",children:"Drug Activity"}),z.jsx(Pi,{value:"domestic_violence",children:"Domestic Violence"}),z.jsx(Pi,{value:"suspicious_activity",children:"Suspicious Activity"}),z.jsx(Pi,{value:"other",children:"Other"})]})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"priority",children:"Priority Level"}),z.jsxs(__,{name:"priority",defaultValue:"medium",children:[z.jsx(Np,{children:z.jsx(y_,{})}),z.jsxs(jp,{children:[z.jsx(Pi,{value:"low",children:"Low"}),z.jsx(Pi,{value:"medium",children:"Medium"}),z.jsx(Pi,{value:"high",children:"High"}),z.jsx(Pi,{value:"critical",children:"Critical"})]})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsxs(Go,{htmlFor:"incidentDate",className:"flex items-center gap-2",children:[z.jsx(Kk,{className:"h-4 w-4"}),"Date & Time of Incident"]}),z.jsx(zs,{id:"incidentDate",name:"incidentDate",type:"datetime-local",defaultValue:new Date().toISOString().slice(0,16)})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsxs(Go,{htmlFor:"address",className:"flex items-center gap-2",children:[z.jsx(Hp,{className:"h-4 w-4"}),"Location/Address"]}),z.jsx(zs,{id:"address",name:"address",placeholder:"Where did this incident occur?"})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"description",children:"Detailed Description *"}),z.jsx(eb,{id:"description",name:"description",placeholder:"Provide a detailed description of what happened, including any relevant details about suspects, vehicles, or other important information.",rows:6,required:!0})]}),z.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:z.jsxs("div",{className:"flex items-start gap-3",children:[z.jsx(jd,{className:"h-5 w-5 text-amber-600 mt-0.5"}),z.jsxs("div",{children:[z.jsx("h3",{className:"font-medium text-amber-900",children:"Important Notice"}),z.jsx("p",{className:"text-sm text-amber-800 mt-1",children:"If this is an emergency or crime in progress, please call 911 immediately. This form is for reporting non-emergency incidents."})]})]})}),z.jsx("div",{className:"flex gap-4",children:z.jsxs(pi,{type:"submit",disabled:e,className:"flex-1",children:[z.jsx(cne,{className:"h-4 w-4 mr-2"}),e?"Submitting...":"Submit Report"]})})]})})]})]})})},cje=j1("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ac({className:e,variant:t,...r}){return z.jsx("div",{className:zn(cje({variant:t}),e),...r})}const fV=[{id:"CR001",type:"Theft",location:"Main Street & 5th Ave",date:"2024-01-15",time:"14:30",status:"Under Investigation",severity:"medium",description:"Bicycle stolen from bike rack outside library"},{id:"CR002",type:"Vandalism",location:"Central Park",date:"2024-01-14",time:"22:15",status:"Resolved",severity:"low",description:"Graffiti on park benches"},{id:"CR003",type:"Assault",location:"Downtown Plaza",date:"2024-01-13",time:"18:45",status:"Under Investigation",severity:"high",description:"Physical altercation between two individuals"},{id:"CR004",type:"Burglary",location:"Elm Street Residential",date:"2024-01-12",time:"03:20",status:"Resolved",severity:"high",description:"Break-in at residential property, electronics stolen"},{id:"CR005",type:"Vehicle Crime",location:"Shopping Mall Parking",date:"2024-01-11",time:"16:00",status:"Under Investigation",severity:"medium",description:"Car window broken, items stolen from vehicle"},{id:"CR006",type:"Public Disorder",location:"City Center",date:"2024-01-10",time:"23:30",status:"Resolved",severity:"low",description:"Noise complaint from late night gathering"}],uje=()=>{const[e,t]=Q.useState(""),[r,i]=Q.useState("all"),[c,d]=Q.useState("all"),[g,o]=Q.useState("all"),w=Q.useMemo(()=>fV.filter(C=>{const R=C.location.toLowerCase().includes(e.toLowerCase())||C.type.toLowerCase().includes(e.toLowerCase())||C.description.toLowerCase().includes(e.toLowerCase()),F=r==="all"||C.type===r,G=c==="all"||C.status===c,j=g==="all"||C.severity===g;return R&&F&&G&&j}),[e,r,c,g]),T=C=>{switch(C){case"high":return"bg-red-100 text-red-800 border-red-200";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"low":return"bg-green-100 text-green-800 border-green-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},I=C=>{switch(C){case"Resolved":return"bg-green-100 text-green-800 border-green-200";case"Under Investigation":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}};return z.jsxs("div",{className:"container mx-auto px-4 py-8",children:[z.jsxs("div",{className:"text-center mb-8",children:[z.jsx("h1",{className:"text-3xl font-bold text-slate-800 mb-2",children:"Crime Reports Database"}),z.jsx("p",{className:"text-slate-600",children:"Browse and filter reported incidents in your area"})]}),z.jsxs(wi,{className:"mb-6",children:[z.jsxs(Mi,{children:[z.jsxs(Ri,{className:"flex items-center space-x-2",children:[z.jsx(hG,{className:"h-5 w-5"}),z.jsx("span",{children:"Search & Filter"})]}),z.jsx(xa,{children:"Find specific incidents using the search and filter options below"})]}),z.jsxs(Si,{children:[z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[z.jsxs("div",{className:"lg:col-span-2 space-y-2",children:[z.jsx(Go,{htmlFor:"search",children:"Search"}),z.jsxs("div",{className:"relative",children:[z.jsx(lne,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),z.jsx(zs,{id:"search",value:e,onChange:C=>t(C.target.value),placeholder:"Search by location, type, or description...",className:"pl-10"})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{children:"Crime Type"}),z.jsxs(__,{value:r,onValueChange:i,children:[z.jsx(Np,{children:z.jsx(y_,{})}),z.jsxs(jp,{children:[z.jsx(Pi,{value:"all",children:"All Types"}),z.jsx(Pi,{value:"Theft",children:"Theft"}),z.jsx(Pi,{value:"Vandalism",children:"Vandalism"}),z.jsx(Pi,{value:"Assault",children:"Assault"}),z.jsx(Pi,{value:"Burglary",children:"Burglary"}),z.jsx(Pi,{value:"Vehicle Crime",children:"Vehicle Crime"}),z.jsx(Pi,{value:"Public Disorder",children:"Public Disorder"})]})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{children:"Status"}),z.jsxs(__,{value:c,onValueChange:d,children:[z.jsx(Np,{children:z.jsx(y_,{})}),z.jsxs(jp,{children:[z.jsx(Pi,{value:"all",children:"All Status"}),z.jsx(Pi,{value:"Under Investigation",children:"Under Investigation"}),z.jsx(Pi,{value:"Resolved",children:"Resolved"})]})]})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{children:"Severity"}),z.jsxs(__,{value:g,onValueChange:o,children:[z.jsx(Np,{children:z.jsx(y_,{})}),z.jsxs(jp,{children:[z.jsx(Pi,{value:"all",children:"All Levels"}),z.jsx(Pi,{value:"high",children:"High"}),z.jsx(Pi,{value:"medium",children:"Medium"}),z.jsx(Pi,{value:"low",children:"Low"})]})]})]})]}),z.jsxs("div",{className:"flex justify-between items-center mt-4",children:[z.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",w.length," of ",fV.length," reports"]}),z.jsxs(pi,{variant:"outline",className:"flex items-center space-x-2",children:[z.jsx(Jre,{className:"h-4 w-4"}),z.jsx("span",{children:"Export Data"})]})]})]})]}),z.jsxs("div",{className:"space-y-4",children:[w.map(C=>z.jsx(wi,{className:"hover:shadow-md transition-shadow",children:z.jsx(Si,{className:"p-6",children:z.jsxs("div",{className:"flex justify-between items-start mb-4",children:[z.jsxs("div",{className:"flex items-start space-x-4",children:[z.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:z.jsx(jd,{className:"h-5 w-5 text-blue-600"})}),z.jsxs("div",{children:[z.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[z.jsx("h3",{className:"font-semibold text-lg",children:C.type}),z.jsx(ac,{variant:"outline",className:"text-xs",children:C.id})]}),z.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mb-2",children:[z.jsxs("div",{className:"flex items-center space-x-1",children:[z.jsx(Hp,{className:"h-4 w-4"}),z.jsx("span",{children:C.location})]}),z.jsxs("div",{className:"flex items-center space-x-1",children:[z.jsx(Kk,{className:"h-4 w-4"}),z.jsx("span",{children:C.date})]}),z.jsxs("div",{className:"flex items-center space-x-1",children:[z.jsx(Yk,{className:"h-4 w-4"}),z.jsx("span",{children:C.time})]})]}),z.jsx("p",{className:"text-slate-700",children:C.description})]})]}),z.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[z.jsxs(ac,{className:I(C.status),children:[C.status==="Resolved"?z.jsx(uG,{className:"h-3 w-3 mr-1"}):z.jsx(Jk,{className:"h-3 w-3 mr-1"}),C.status]}),z.jsxs(ac,{className:T(C.severity),children:[C.severity.charAt(0).toUpperCase()+C.severity.slice(1)," Priority"]})]})]})})},C.id)),w.length===0&&z.jsx(wi,{children:z.jsxs(Si,{className:"text-center py-12",children:[z.jsx(jd,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),z.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"No reports found"}),z.jsx("p",{className:"text-gray-500",children:"Try adjusting your search terms or filters to find relevant reports."})]})})]})]})},hje=()=>{const[e,t]=Q.useState([]),[r,i]=Q.useState({}),[c,d]=Q.useState(!1),[g,o]=Q.useState(null),[w,T]=Q.useState(""),{user:I}=Kd(),{toast:C}=Wd(),[R,F]=Q.useState({title:"",content:"",category:"general"});Q.useEffect(()=>{G()},[]);const G=async()=>{try{const Z=[{id:"1",title:"Community Safety Tips",content:"Here are some important safety tips for our neighborhood. Always be aware of your surroundings and report any suspicious activities.",author_id:"1",author_name:"John Doe",created_at:new Date().toISOString(),views:45,likes:12,category:"safety"},{id:"2",title:"Neighborhood Watch Update",content:"Our neighborhood watch program is expanding. We are looking for more volunteers to help keep our community safe.",author_id:"2",author_name:"Jane Smith",created_at:new Date(Date.now()-864e5).toISOString(),views:32,likes:8,category:"community"}];t(Z)}catch(Z){console.error("Error fetching posts:",Z)}},j=async Z=>{try{const J=[{id:"1",post_id:Z,content:"Great post! Very helpful information.",author_name:"Community Member",created_at:new Date().toISOString()}];i(ne=>({...ne,[Z]:J}))}catch(J){console.error("Error fetching comments:",J)}},H=async()=>{if(!I||!R.title.trim()||!R.content.trim()){C({title:"Error",description:"Please fill in all fields",variant:"destructive"});return}try{const Z={id:Date.now().toString(),title:R.title,content:R.content,author_id:I.id,author_name:I.email||"Anonymous",created_at:new Date().toISOString(),views:0,likes:0,category:R.category};t(J=>[Z,...J]),F({title:"",content:"",category:"general"}),d(!1),C({title:"Success",description:"Post created successfully!"})}catch(Z){console.error("Error creating post:",Z),C({title:"Error",description:"Failed to create post",variant:"destructive"})}},X=async Z=>{if(!(!I||!w.trim()))try{const J={id:Date.now().toString(),post_id:Z,content:w,author_name:I.email||"Anonymous",created_at:new Date().toISOString()};i(ne=>({...ne,[Z]:[...ne[Z]||[],J]})),T(""),C({title:"Success",description:"Comment added successfully!"})}catch(J){console.error("Error adding comment:",J),C({title:"Error",description:"Failed to add comment",variant:"destructive"})}},q=Z=>{o(g===Z?null:Z),g!==Z&&j(Z)};return z.jsxs("div",{className:"container mx-auto px-4 py-8",children:[z.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[z.jsxs("div",{children:[z.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2",children:"Community Insights"}),z.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Share experiences, discuss safety tips, and connect with your community"})]}),I&&z.jsxs(pi,{onClick:()=>d(!c),className:"w-full md:w-auto",children:[z.jsx(dG,{className:"h-4 w-4 mr-2"}),"New Post"]})]}),c&&z.jsxs(wi,{className:"mb-8",children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Create New Post"}),z.jsx(xa,{children:"Share your insights with the community"})]}),z.jsxs(Si,{className:"space-y-4",children:[z.jsx(zs,{placeholder:"Post title",value:R.title,onChange:Z=>F({...R,title:Z.target.value})}),z.jsxs("select",{className:"w-full p-2 border rounded-md dark:bg-slate-800 dark:border-slate-600",value:R.category,onChange:Z=>F({...R,category:Z.target.value}),children:[z.jsx("option",{value:"general",children:"General"}),z.jsx("option",{value:"safety",children:"Safety Tips"}),z.jsx("option",{value:"community",children:"Community News"}),z.jsx("option",{value:"alerts",children:"Alerts"})]}),z.jsx(eb,{placeholder:"Write your post content here...",rows:6,value:R.content,onChange:Z=>F({...R,content:Z.target.value})}),z.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[z.jsx(pi,{onClick:H,className:"w-full sm:w-auto",children:"Publish Post"}),z.jsx(pi,{variant:"outline",onClick:()=>d(!1),className:"w-full sm:w-auto",children:"Cancel"})]})]})]}),z.jsx("div",{className:"space-y-6",children:e.map(Z=>{var J;return z.jsxs(wi,{className:"cursor-pointer hover:shadow-lg transition-shadow",children:[z.jsxs(Mi,{onClick:()=>q(Z.id),children:[z.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:[z.jsxs("div",{className:"flex-1",children:[z.jsx(Ri,{className:"text-xl mb-2",children:Z.title}),z.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(lx,{className:"h-4 w-4"}),z.jsx("span",{className:"truncate",children:Z.author_name})]}),z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(Kk,{className:"h-4 w-4"}),new Date(Z.created_at).toLocaleDateString()]}),z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(Jk,{className:"h-4 w-4"}),Z.views]}),z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(Qre,{className:"h-4 w-4"}),Z.likes]})]})]}),z.jsx(ac,{variant:"secondary",children:Z.category})]}),z.jsxs(xa,{className:"mt-2",children:[Z.content.substring(0,200),"..."]})]}),g===Z.id&&z.jsx(Si,{children:z.jsxs("div",{className:"border-t pt-4",children:[z.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:Z.content}),z.jsxs("div",{className:"space-y-4",children:[z.jsxs("h4",{className:"font-semibold flex items-center gap-2",children:[z.jsx(RT,{className:"h-4 w-4"}),"Comments"]}),(J=r[Z.id])==null?void 0:J.map(ne=>z.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800 rounded-lg p-3",children:[z.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-2 mb-2",children:[z.jsx("span",{className:"font-medium text-sm",children:ne.author_name}),z.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(ne.created_at).toLocaleDateString()})]}),z.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:ne.content})]},ne.id)),I&&z.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[z.jsx(zs,{placeholder:"Add a comment...",value:w,onChange:ne=>T(ne.target.value),onKeyPress:ne=>ne.key==="Enter"&&X(Z.id),className:"flex-1"}),z.jsx(pi,{onClick:()=>X(Z.id),className:"w-full sm:w-auto",children:"Post"})]})]})]})})]},Z.id)})})]})},dje=()=>{const[e,t]=Q.useState([]),[r,i]=Q.useState(!1),{user:c}=Kd(),{toast:d}=Wd(),[g,o]=Q.useState({title:"",message:"",severity:"medium",location:""});Q.useEffect(()=>{w()},[]);const w=async()=>{try{const R=[{id:"1",title:"Suspicious Activity Reported",message:"Multiple residents have reported suspicious individuals in the downtown area. Please be cautious and report any unusual activity to authorities.",severity:"high",location:"Downtown Area",created_at:new Date().toISOString(),author_name:"Community Watch",status:"active"},{id:"2",title:"Street Light Outage",message:"Several street lights are out on Main Street between 5th and 7th Avenue. Use caution when walking in this area after dark.",severity:"medium",location:"Main Street",created_at:new Date(Date.now()-36e5).toISOString(),author_name:"City Maintenance",status:"active"},{id:"3",title:"Road Closure - Maintenance",message:"Oak Street will be closed for emergency water main repair from 8 AM to 6 PM today. Please use alternate routes.",severity:"low",location:"Oak Street",created_at:new Date(Date.now()-72e5).toISOString(),author_name:"City Services",status:"resolved"}];t(R)}catch(R){console.error("Error fetching alerts:",R)}},T=async()=>{if(!c||!g.title.trim()||!g.message.trim()){d({title:"Error",description:"Please fill in all required fields",variant:"destructive"});return}try{const R={id:Date.now().toString(),title:g.title,message:g.message,severity:g.severity,location:g.location,created_at:new Date().toISOString(),author_name:c.email||"Anonymous",status:"active"};t(F=>[R,...F]),o({title:"",message:"",severity:"medium",location:""}),i(!1),d({title:"Success",description:"Emergency alert created successfully!"})}catch(R){console.error("Error creating alert:",R),d({title:"Error",description:"Failed to create alert",variant:"destructive"})}},I=R=>{switch(R){case"critical":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/20 dark:text-red-400";case"high":return"bg-orange-100 text-orange-800 border-orange-200 dark:bg-orange-900/20 dark:text-orange-400";case"medium":return"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-400";case"low":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-800 border-gray-200 dark:bg-gray-900/20 dark:text-gray-400"}},C=R=>{const F=new Date,G=new Date(R),j=Math.floor((F.getTime()-G.getTime())/(1e3*60));if(j<60)return`${j} minutes ago`;const H=Math.floor(j/60);return H<24?`${H} hours ago`:`${Math.floor(H/24)} days ago`};return z.jsxs("div",{className:"container mx-auto px-4 py-8",children:[z.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4",children:[z.jsxs("div",{children:[z.jsxs("h1",{className:"text-3xl font-bold text-slate-900 dark:text-slate-100 mb-2 flex items-center gap-2",children:[z.jsx(Zre,{className:"h-8 w-8"}),"Emergency Alerts"]}),z.jsx("p",{className:"text-slate-600 dark:text-slate-400",children:"Stay informed about emergency situations and community alerts"})]}),c&&z.jsxs(pi,{onClick:()=>i(!r),className:"w-full md:w-auto",children:[z.jsx(dG,{className:"h-4 w-4 mr-2"}),"New Alert"]})]}),r&&z.jsxs(wi,{className:"mb-8",children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Create Emergency Alert"}),z.jsx(xa,{children:"Report emergency situations or important community updates"})]}),z.jsxs(Si,{className:"space-y-4",children:[z.jsx(zs,{placeholder:"Alert title",value:g.title,onChange:R=>o({...g,title:R.target.value})}),z.jsx(zs,{placeholder:"Location (optional)",value:g.location,onChange:R=>o({...g,location:R.target.value})}),z.jsxs("select",{className:"w-full p-2 border rounded-md dark:bg-slate-800 dark:border-slate-600",value:g.severity,onChange:R=>o({...g,severity:R.target.value}),children:[z.jsx("option",{value:"low",children:"Low Priority"}),z.jsx("option",{value:"medium",children:"Medium Priority"}),z.jsx("option",{value:"high",children:"High Priority"}),z.jsx("option",{value:"critical",children:"Critical"})]}),z.jsx(eb,{placeholder:"Describe the emergency or situation...",rows:6,value:g.message,onChange:R=>o({...g,message:R.target.value})}),z.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[z.jsx(pi,{onClick:T,className:"w-full sm:w-auto",children:"Create Alert"}),z.jsx(pi,{variant:"outline",onClick:()=>i(!1),className:"w-full sm:w-auto",children:"Cancel"})]})]})]}),z.jsx("div",{className:"space-y-4",children:e.map(R=>z.jsxs(wi,{className:`${R.status==="resolved"?"opacity-70":""}`,children:[z.jsx(Mi,{children:z.jsx("div",{className:"flex flex-col lg:flex-row justify-between items-start gap-4",children:z.jsxs("div",{className:"flex-1",children:[z.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[z.jsx(jd,{className:"h-5 w-5 text-orange-500"}),z.jsx(Ri,{className:"text-xl",children:R.title}),z.jsx(ac,{className:I(R.severity),variant:"outline",children:R.severity.toUpperCase()}),R.status==="resolved"&&z.jsx(ac,{variant:"secondary",children:"RESOLVED"})]}),z.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400 mb-3",children:[z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(Yk,{className:"h-4 w-4"}),C(R.created_at)]}),R.location&&z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(Hp,{className:"h-4 w-4"}),R.location]}),z.jsxs("div",{className:"flex items-center gap-1",children:[z.jsx(Qk,{className:"h-4 w-4"}),R.author_name]})]})]})})}),z.jsx(Si,{children:z.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:R.message})})]},R.id))})]})};var WL="Tabs",[fje,Wje]=nm(WL,[P2]),WX=P2(),[pje,qL]=fje(WL),qX=Q.forwardRef((e,t)=>{const{__scopeTabs:r,value:i,onValueChange:c,defaultValue:d,orientation:g="horizontal",dir:o,activationMode:w="automatic",...T}=e,I=T2(o),[C,R]=Gp({prop:i,onChange:c,defaultProp:d});return z.jsx(pje,{scope:r,baseId:Kc(),value:C,onValueChange:R,orientation:g,dir:I,activationMode:w,children:z.jsx(Sn.div,{dir:I,"data-orientation":g,...T,ref:t})})});qX.displayName=WL;var ZX="TabsList",XX=Q.forwardRef((e,t)=>{const{__scopeTabs:r,loop:i=!0,...c}=e,d=qL(ZX,r),g=WX(r);return z.jsx(WH,{asChild:!0,...g,orientation:d.orientation,dir:d.dir,loop:i,children:z.jsx(Sn.div,{role:"tablist","aria-orientation":d.orientation,...c,ref:t})})});XX.displayName=ZX;var KX="TabsTrigger",YX=Q.forwardRef((e,t)=>{const{__scopeTabs:r,value:i,disabled:c=!1,...d}=e,g=qL(KX,r),o=WX(r),w=eK(g.baseId,i),T=tK(g.baseId,i),I=i===g.value;return z.jsx(qH,{asChild:!0,...o,focusable:!c,active:I,children:z.jsx(Sn.button,{type:"button",role:"tab","aria-selected":I,"aria-controls":T,"data-state":I?"active":"inactive","data-disabled":c?"":void 0,disabled:c,id:w,...d,ref:t,onMouseDown:Er(e.onMouseDown,C=>{!c&&C.button===0&&C.ctrlKey===!1?g.onValueChange(i):C.preventDefault()}),onKeyDown:Er(e.onKeyDown,C=>{[" ","Enter"].includes(C.key)&&g.onValueChange(i)}),onFocus:Er(e.onFocus,()=>{const C=g.activationMode!=="manual";!I&&!c&&C&&g.onValueChange(i)})})})});YX.displayName=KX;var JX="TabsContent",QX=Q.forwardRef((e,t)=>{const{__scopeTabs:r,value:i,forceMount:c,children:d,...g}=e,o=qL(JX,r),w=eK(o.baseId,i),T=tK(o.baseId,i),I=i===o.value,C=Q.useRef(I);return Q.useEffect(()=>{const R=requestAnimationFrame(()=>C.current=!1);return()=>cancelAnimationFrame(R)},[]),z.jsx(hc,{present:c||I,children:({present:R})=>z.jsx(Sn.div,{"data-state":I?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":w,hidden:!R,id:T,tabIndex:0,...g,ref:t,style:{...e.style,animationDuration:C.current?"0s":void 0},children:R&&d})})});QX.displayName=JX;function eK(e,t){return`${e}-trigger-${t}`}function tK(e,t){return`${e}-content-${t}`}var mje=qX,rK=XX,nK=YX,iK=QX;const oK=mje,ZL=Q.forwardRef(({className:e,...t},r)=>z.jsx(rK,{ref:r,className:zn("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...t}));ZL.displayName=rK.displayName;const P1=Q.forwardRef(({className:e,...t},r)=>z.jsx(nK,{ref:r,className:zn("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...t}));P1.displayName=nK.displayName;const C1=Q.forwardRef(({className:e,...t},r)=>z.jsx(iK,{ref:r,className:zn("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...t}));C1.displayName=iK.displayName;const gje=()=>{const e=y2(),{signIn:t,signUp:r,user:i}=Kd(),{toast:c}=Wd(),[d,g]=Q.useState(!1),[o,w]=Q.useState(!1);Q.useEffect(()=>{i&&e("/")},[i,e]);const T=async C=>{C.preventDefault(),g(!0);const R=new FormData(C.currentTarget),F=R.get("email"),G=R.get("password"),{error:j}=await t(F,G);c(j?{title:"Sign In Failed",description:j.message,variant:"destructive"}:{title:"Welcome back!",description:"You have been signed in successfully."}),g(!1)},I=async C=>{C.preventDefault(),g(!0);const R=new FormData(C.currentTarget),F=R.get("email"),G=R.get("password"),j=R.get("fullName"),{error:H}=await r(F,G,j);H?c({title:"Sign Up Failed",description:H.message,variant:"destructive"}):(w(!0),c({title:"Account Created!",description:"Please check your email to verify your account. If you don't receive an email within a few minutes, check your spam folder."})),g(!1)};return o?z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center p-4",children:z.jsxs(wi,{className:"w-full max-w-md",children:[z.jsxs(Mi,{className:"text-center",children:[z.jsx("div",{className:"flex justify-center mb-4",children:z.jsx("div",{className:"p-3 bg-green-100 dark:bg-green-900/20 rounded-full",children:z.jsx(nne,{className:"h-8 w-8 text-green-600"})})}),z.jsx(Ri,{children:"Check Your Email"}),z.jsx(xa,{children:"We've sent you a confirmation email. Please click the link in the email to verify your account and complete the registration process."})]}),z.jsx(Si,{children:z.jsxs("div",{className:"space-y-4",children:[z.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:z.jsxs("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[z.jsx("strong",{children:"Note:"})," If email verification is disabled in your Supabase settings, you may be able to sign in immediately. Otherwise, please check your email first."]})}),z.jsx(pi,{onClick:()=>w(!1),variant:"outline",className:"w-full",children:"Back to Sign In"})]})})]})}):z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800 flex items-center justify-center p-4",children:z.jsxs("div",{className:"w-full max-w-md",children:[z.jsxs("div",{className:"flex items-center justify-center mb-8",children:[z.jsx("div",{className:"p-3 bg-blue-600 rounded-lg",children:z.jsx(ax,{className:"h-8 w-8 text-white"})}),z.jsxs("div",{className:"ml-3",children:[z.jsx("h1",{className:"text-2xl font-bold text-slate-800 dark:text-slate-200",children:"UrbanEye"}),z.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Crime Report System"})]})]}),z.jsxs(wi,{children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Welcome"}),z.jsx(xa,{children:"Sign in to your account or create a new one to get started."})]}),z.jsx(Si,{children:z.jsxs(oK,{defaultValue:"signin",className:"w-full",children:[z.jsxs(ZL,{className:"grid w-full grid-cols-2",children:[z.jsx(P1,{value:"signin",children:"Sign In"}),z.jsx(P1,{value:"signup",children:"Sign Up"})]}),z.jsx(C1,{value:"signin",children:z.jsxs("form",{onSubmit:T,className:"space-y-4",children:[z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"signin-email",children:"Email"}),z.jsx(zs,{id:"signin-email",name:"email",type:"email",placeholder:"Enter your email",required:!0})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"signin-password",children:"Password"}),z.jsx(zs,{id:"signin-password",name:"password",type:"password",placeholder:"Enter your password",required:!0})]}),z.jsxs(pi,{type:"submit",className:"w-full",disabled:d,children:[z.jsx(rne,{className:"h-4 w-4 mr-2"}),d?"Signing In...":"Sign In"]})]})}),z.jsx(C1,{value:"signup",children:z.jsxs("form",{onSubmit:I,className:"space-y-4",children:[z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"signup-name",children:"Full Name"}),z.jsx(zs,{id:"signup-name",name:"fullName",type:"text",placeholder:"Enter your full name",required:!0})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"signup-email",children:"Email"}),z.jsx(zs,{id:"signup-email",name:"email",type:"email",placeholder:"Enter your email",required:!0})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"signup-password",children:"Password"}),z.jsx(zs,{id:"signup-password",name:"password",type:"password",placeholder:"Create a password (min. 6 characters)",required:!0,minLength:6})]}),z.jsxs(pi,{type:"submit",className:"w-full",disabled:d,children:[z.jsx(une,{className:"h-4 w-4 mr-2"}),d?"Creating Account...":"Sign Up"]})]})})]})})]}),z.jsx("div",{className:"mt-6 p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:z.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[z.jsx("strong",{children:"Email Verification:"}),` If you're not receiving verification emails, you can disable email confirmation in your Supabase project settings under Authentication  Settings  "Confirm email" for testing purposes.`]})})]})})},_je=()=>{const{profile:e,loading:t,updateProfile:r}=vq(),{toast:i}=Wd(),[c,d]=Q.useState(!1),g=async o=>{o.preventDefault(),d(!0);const w=new FormData(o.currentTarget),T={full_name:w.get("fullName"),phone:w.get("phone"),address:w.get("address")},{error:I}=await r(T);i(I?{title:"Update Failed",description:"Failed to update profile. Please try again.",variant:"destructive"}:{title:"Profile Updated",description:"Your profile has been updated successfully."}),d(!1)};return t?z.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:z.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.jsx("div",{className:"container mx-auto px-4 py-8",children:z.jsx("div",{className:"max-w-2xl mx-auto",children:z.jsxs(wi,{children:[z.jsxs(Mi,{children:[z.jsxs(Ri,{className:"flex items-center gap-2",children:[z.jsx(lx,{className:"h-5 w-5"}),"User Profile"]}),z.jsx(xa,{children:"Update your personal information and contact details."})]}),z.jsx(Si,{children:z.jsxs("form",{onSubmit:g,className:"space-y-6",children:[z.jsxs("div",{className:"space-y-2",children:[z.jsx(Go,{htmlFor:"fullName",children:"Full Name"}),z.jsx(zs,{id:"fullName",name:"fullName",type:"text",defaultValue:(e==null?void 0:e.full_name)||"",placeholder:"Enter your full name"})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsxs(Go,{htmlFor:"phone",className:"flex items-center gap-2",children:[z.jsx(sne,{className:"h-4 w-4"}),"Phone Number"]}),z.jsx(zs,{id:"phone",name:"phone",type:"tel",defaultValue:(e==null?void 0:e.phone)||"",placeholder:"Enter your phone number"})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsxs(Go,{htmlFor:"address",className:"flex items-center gap-2",children:[z.jsx(Hp,{className:"h-4 w-4"}),"Address"]}),z.jsx(eb,{id:"address",name:"address",defaultValue:(e==null?void 0:e.address)||"",placeholder:"Enter your address",rows:3})]}),(e==null?void 0:e.is_admin)&&z.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[z.jsx("p",{className:"text-sm font-medium text-blue-900",children:" Administrator Account"}),z.jsx("p",{className:"text-sm text-blue-700",children:"You have administrative privileges in this system."})]}),z.jsxs(pi,{type:"submit",disabled:c,className:"w-full",children:[z.jsx(ane,{className:"h-4 w-4 mr-2"}),c?"Saving...":"Save Changes"]})]})})]})})})},yje=()=>{const[e,t]=Q.useState([]),[r,i]=Q.useState([]),[c,d]=Q.useState(!0),{toast:g}=Wd();Q.useEffect(()=>{o()},[]);const o=async()=>{try{const{data:C,error:R}=await ja.from("crime_incidents").select(`
          *,
          profiles:user_id (
            full_name
          )
        `).order("created_at",{ascending:!1});if(R)throw R;const F=(C==null?void 0:C.map(H=>({...H,user_profile:H.profiles})))||[];t(F);const{data:G,error:j}=await ja.from("profiles").select("*").order("created_at",{ascending:!1});if(j)throw j;i(G||[])}catch(C){console.error("Error fetching data:",C),g({title:"Error",description:"Failed to fetch data",variant:"destructive"})}finally{d(!1)}},w=async(C,R)=>{try{const{error:F}=await ja.from("crime_incidents").update({status:R,updated_at:new Date().toISOString()}).eq("id",C);if(F)throw F;t(G=>G.map(j=>j.id===C?{...j,status:R}:j)),g({title:"Success",description:"Incident status updated successfully"})}catch(F){console.error("Error updating incident:",F),g({title:"Error",description:"Failed to update incident status",variant:"destructive"})}},T=async(C,R)=>{try{const{error:F}=await ja.from("profiles").update({is_admin:!R}).eq("id",C);if(F)throw F;i(G=>G.map(j=>j.id===C?{...j,is_admin:!R}:j)),g({title:"Success",description:"User admin status updated successfully"})}catch(F){console.error("Error updating user:",F),g({title:"Error",description:"Failed to update user status",variant:"destructive"})}};if(c)return z.jsx("div",{className:"container mx-auto px-4 py-8",children:z.jsx("div",{className:"flex items-center justify-center h-64",children:z.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})})});const I={totalIncidents:e.length,pendingIncidents:e.filter(C=>C.status==="pending").length,totalUsers:r.length,adminUsers:r.filter(C=>C.is_admin).length};return z.jsxs("div",{className:"container mx-auto px-4 py-8",children:[z.jsxs("div",{className:"mb-8",children:[z.jsx("h1",{className:"text-3xl font-bold text-slate-900 mb-2",children:"Admin Dashboard"}),z.jsx("p",{className:"text-slate-600",children:"Manage incidents, users, and system overview"})]}),z.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[z.jsxs(wi,{children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Total Incidents"}),z.jsx(sx,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsx(Si,{children:z.jsx("div",{className:"text-2xl font-bold",children:I.totalIncidents})})]}),z.jsxs(wi,{children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Pending Cases"}),z.jsx(jd,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsx(Si,{children:z.jsx("div",{className:"text-2xl font-bold text-orange-600",children:I.pendingIncidents})})]}),z.jsxs(wi,{children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Total Users"}),z.jsx(Qk,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsx(Si,{children:z.jsx("div",{className:"text-2xl font-bold",children:I.totalUsers})})]}),z.jsxs(wi,{children:[z.jsxs(Mi,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[z.jsx(Ri,{className:"text-sm font-medium",children:"Admin Users"}),z.jsx(fG,{className:"h-4 w-4 text-muted-foreground"})]}),z.jsx(Si,{children:z.jsx("div",{className:"text-2xl font-bold",children:I.adminUsers})})]})]}),z.jsxs(oK,{defaultValue:"incidents",className:"space-y-4",children:[z.jsxs(ZL,{children:[z.jsx(P1,{value:"incidents",children:"Incidents Management"}),z.jsx(P1,{value:"users",children:"Users Management"})]}),z.jsx(C1,{value:"incidents",children:z.jsxs(wi,{children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"Crime Incidents"}),z.jsx(xa,{children:"Manage and update incident statuses"})]}),z.jsx(Si,{children:z.jsx("div",{className:"space-y-4",children:e.map(C=>{var R;return z.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[z.jsxs("div",{className:"flex justify-between items-start",children:[z.jsxs("div",{className:"flex-1",children:[z.jsx("h3",{className:"font-semibold text-lg",children:C.title}),z.jsx("p",{className:"text-gray-600 mt-1",children:C.description}),z.jsxs("div",{className:"flex items-center space-x-4 mt-2 text-sm text-gray-500",children:[z.jsxs("span",{children:["Type: ",C.incident_type]}),z.jsxs("span",{children:["Reporter: ",((R=C.user_profile)==null?void 0:R.full_name)||"Unknown"]}),z.jsxs("span",{children:["Date: ",new Date(C.incident_date).toLocaleDateString()]}),C.address&&z.jsxs("span",{children:["Location: ",C.address]})]})]}),z.jsxs("div",{className:"flex items-center space-x-2",children:[z.jsx(ac,{variant:C.priority==="critical"||C.priority==="high"?"destructive":C.priority==="medium"?"default":"secondary",children:C.priority}),z.jsx(ac,{variant:C.status==="resolved"?"default":C.status==="investigating"?"secondary":"outline",children:C.status})]})]}),z.jsx("div",{className:"flex justify-end",children:z.jsxs(__,{value:C.status,onValueChange:F=>w(C.id,F),children:[z.jsx(Np,{className:"w-40",children:z.jsx(y_,{})}),z.jsxs(jp,{children:[z.jsx(Pi,{value:"pending",children:"Pending"}),z.jsx(Pi,{value:"investigating",children:"Investigating"}),z.jsx(Pi,{value:"resolved",children:"Resolved"}),z.jsx(Pi,{value:"closed",children:"Closed"})]})]})})]},C.id)})})})]})}),z.jsx(C1,{value:"users",children:z.jsxs(wi,{children:[z.jsxs(Mi,{children:[z.jsx(Ri,{children:"User Management"}),z.jsx(xa,{children:"Manage user accounts and permissions"})]}),z.jsx(Si,{children:z.jsx("div",{className:"space-y-4",children:r.map(C=>z.jsxs("div",{className:"border rounded-lg p-4 flex justify-between items-center",children:[z.jsxs("div",{children:[z.jsx("h3",{className:"font-semibold",children:C.full_name||"No name provided"}),z.jsxs("p",{className:"text-sm text-gray-500",children:["Joined: ",new Date(C.created_at).toLocaleDateString()]}),C.phone&&z.jsxs("p",{className:"text-sm text-gray-500",children:["Phone: ",C.phone]}),C.address&&z.jsxs("p",{className:"text-sm text-gray-500",children:["Address: ",C.address]})]}),z.jsxs("div",{className:"flex items-center space-x-2",children:[z.jsx(ac,{variant:C.is_admin?"default":"secondary",children:C.is_admin?"Admin":"User"}),z.jsx(pi,{variant:"outline",size:"sm",onClick:()=>T(C.id,C.is_admin),children:C.is_admin?"Remove Admin":"Make Admin"})]})]},C.id))})})]})})]})]})};var sK={exports:{}};(function(e,t){(function(r,i){e.exports=i()})(gs,function(){var r,i,c;function d(o,w){if(!r)r=w;else if(!i)i=w;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+r+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",I={};r(I),c=w(I),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(c.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}d(["exports"],function(o){var w=1e-6,T=typeof Float32Array<"u"?Float32Array:Array;function I(l,n){var a=n[0],h=n[1],f=n[2],_=n[3],y=a*_-f*h;return y?(l[0]=_*(y=1/y),l[1]=-h*y,l[2]=-f*y,l[3]=a*y,l):null}function C(){var l=new T(9);return T!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l}function R(l,n){var a=n[0],h=n[1],f=n[2],_=n[3],y=n[4],b=n[5],E=n[6],A=n[7],M=n[8];return l[0]=y*M-b*A,l[1]=f*A-h*M,l[2]=h*b-f*y,l[3]=b*E-_*M,l[4]=a*M-f*E,l[5]=f*_-a*b,l[6]=_*A-y*E,l[7]=h*E-a*A,l[8]=a*y-h*_,l}function F(l,n,a){var h=n[0],f=n[1],_=n[2],y=n[3],b=n[4],E=n[5],A=n[6],M=n[7],k=n[8],D=a[0],B=a[1],U=a[2],K=a[3],te=a[4],oe=a[5],de=a[6],fe=a[7],Y=a[8];return l[0]=D*h+B*y+U*A,l[1]=D*f+B*b+U*M,l[2]=D*_+B*E+U*k,l[3]=K*h+te*y+oe*A,l[4]=K*f+te*b+oe*M,l[5]=K*_+te*E+oe*k,l[6]=de*h+fe*y+Y*A,l[7]=de*f+fe*b+Y*M,l[8]=de*_+fe*E+Y*k,l}function G(){var l=new T(16);return T!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0),l[0]=1,l[5]=1,l[10]=1,l[15]=1,l}function j(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function H(l,n){var a=n[0],h=n[1],f=n[2],_=n[3],y=n[4],b=n[5],E=n[6],A=n[7],M=n[8],k=n[9],D=n[10],B=n[11],U=n[12],K=n[13],te=n[14],oe=n[15],de=a*b-h*y,fe=a*E-f*y,Y=a*A-_*y,le=h*E-f*b,pe=h*A-_*b,ye=f*A-_*E,Re=M*K-k*U,Ie=M*te-D*U,ke=M*oe-B*U,je=k*te-D*K,rt=k*oe-B*K,xt=D*oe-B*te,ft=de*xt-fe*rt+Y*je+le*ke-pe*Ie+ye*Re;return ft?(l[0]=(b*xt-E*rt+A*je)*(ft=1/ft),l[1]=(f*rt-h*xt-_*je)*ft,l[2]=(K*ye-te*pe+oe*le)*ft,l[3]=(D*pe-k*ye-B*le)*ft,l[4]=(E*ke-y*xt-A*Ie)*ft,l[5]=(a*xt-f*ke+_*Ie)*ft,l[6]=(te*Y-U*ye-oe*fe)*ft,l[7]=(M*ye-D*Y+B*fe)*ft,l[8]=(y*rt-b*ke+A*Re)*ft,l[9]=(h*ke-a*rt-_*Re)*ft,l[10]=(U*pe-K*Y+oe*de)*ft,l[11]=(k*Y-M*pe-B*de)*ft,l[12]=(b*Ie-y*je-E*Re)*ft,l[13]=(a*je-h*Ie+f*Re)*ft,l[14]=(K*fe-U*le-te*de)*ft,l[15]=(M*le-k*fe+D*de)*ft,l):null}function X(l,n,a){var h=n[0],f=n[1],_=n[2],y=n[3],b=n[4],E=n[5],A=n[6],M=n[7],k=n[8],D=n[9],B=n[10],U=n[11],K=n[12],te=n[13],oe=n[14],de=n[15],fe=a[0],Y=a[1],le=a[2],pe=a[3];return l[0]=fe*h+Y*b+le*k+pe*K,l[1]=fe*f+Y*E+le*D+pe*te,l[2]=fe*_+Y*A+le*B+pe*oe,l[3]=fe*y+Y*M+le*U+pe*de,l[4]=(fe=a[4])*h+(Y=a[5])*b+(le=a[6])*k+(pe=a[7])*K,l[5]=fe*f+Y*E+le*D+pe*te,l[6]=fe*_+Y*A+le*B+pe*oe,l[7]=fe*y+Y*M+le*U+pe*de,l[8]=(fe=a[8])*h+(Y=a[9])*b+(le=a[10])*k+(pe=a[11])*K,l[9]=fe*f+Y*E+le*D+pe*te,l[10]=fe*_+Y*A+le*B+pe*oe,l[11]=fe*y+Y*M+le*U+pe*de,l[12]=(fe=a[12])*h+(Y=a[13])*b+(le=a[14])*k+(pe=a[15])*K,l[13]=fe*f+Y*E+le*D+pe*te,l[14]=fe*_+Y*A+le*B+pe*oe,l[15]=fe*y+Y*M+le*U+pe*de,l}function q(l,n,a){var h,f,_,y,b,E,A,M,k,D,B,U,K=a[0],te=a[1],oe=a[2];return n===l?(l[12]=n[0]*K+n[4]*te+n[8]*oe+n[12],l[13]=n[1]*K+n[5]*te+n[9]*oe+n[13],l[14]=n[2]*K+n[6]*te+n[10]*oe+n[14],l[15]=n[3]*K+n[7]*te+n[11]*oe+n[15]):(f=n[1],_=n[2],y=n[3],b=n[4],E=n[5],A=n[6],M=n[7],k=n[8],D=n[9],B=n[10],U=n[11],l[0]=h=n[0],l[1]=f,l[2]=_,l[3]=y,l[4]=b,l[5]=E,l[6]=A,l[7]=M,l[8]=k,l[9]=D,l[10]=B,l[11]=U,l[12]=h*K+b*te+k*oe+n[12],l[13]=f*K+E*te+D*oe+n[13],l[14]=_*K+A*te+B*oe+n[14],l[15]=y*K+M*te+U*oe+n[15]),l}function Z(l,n,a){var h=a[0],f=a[1],_=a[2];return l[0]=n[0]*h,l[1]=n[1]*h,l[2]=n[2]*h,l[3]=n[3]*h,l[4]=n[4]*f,l[5]=n[5]*f,l[6]=n[6]*f,l[7]=n[7]*f,l[8]=n[8]*_,l[9]=n[9]*_,l[10]=n[10]*_,l[11]=n[11]*_,l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15],l}function J(l,n,a){var h=Math.sin(a),f=Math.cos(a),_=n[4],y=n[5],b=n[6],E=n[7],A=n[8],M=n[9],k=n[10],D=n[11];return n!==l&&(l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[3],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[4]=_*f+A*h,l[5]=y*f+M*h,l[6]=b*f+k*h,l[7]=E*f+D*h,l[8]=A*f-_*h,l[9]=M*f-y*h,l[10]=k*f-b*h,l[11]=D*f-E*h,l}function ne(l,n,a){var h=Math.sin(a),f=Math.cos(a),_=n[0],y=n[1],b=n[2],E=n[3],A=n[8],M=n[9],k=n[10],D=n[11];return n!==l&&(l[4]=n[4],l[5]=n[5],l[6]=n[6],l[7]=n[7],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=_*f-A*h,l[1]=y*f-M*h,l[2]=b*f-k*h,l[3]=E*f-D*h,l[8]=_*h+A*f,l[9]=y*h+M*f,l[10]=b*h+k*f,l[11]=E*h+D*f,l}function he(l,n,a){var h=Math.sin(a),f=Math.cos(a),_=n[0],y=n[1],b=n[2],E=n[3],A=n[4],M=n[5],k=n[6],D=n[7];return n!==l&&(l[8]=n[8],l[9]=n[9],l[10]=n[10],l[11]=n[11],l[12]=n[12],l[13]=n[13],l[14]=n[14],l[15]=n[15]),l[0]=_*f+A*h,l[1]=y*f+M*h,l[2]=b*f+k*h,l[3]=E*f+D*h,l[4]=A*f-_*h,l[5]=M*f-y*h,l[6]=k*f-b*h,l[7]=D*f-E*h,l}function me(l,n){return l[0]=n[0],l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=n[1],l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=n[2],l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function Se(l,n,a){var h,f,_,y=a[0],b=a[1],E=a[2],A=Math.hypot(y,b,E);return A<w?null:(y*=A=1/A,b*=A,E*=A,h=Math.sin(n),f=Math.cos(n),l[0]=y*y*(_=1-f)+f,l[1]=b*y*_+E*h,l[2]=E*y*_-b*h,l[3]=0,l[4]=y*b*_-E*h,l[5]=b*b*_+f,l[6]=E*b*_+y*h,l[7]=0,l[8]=y*E*_+b*h,l[9]=b*E*_-y*h,l[10]=E*E*_+f,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l)}function qe(l,n){var a=n[0],h=n[1],f=n[2],_=n[3],y=a+a,b=h+h,E=f+f,A=a*y,M=h*y,k=h*b,D=f*y,B=f*b,U=f*E,K=_*y,te=_*b,oe=_*E;return l[0]=1-k-U,l[1]=M+oe,l[2]=D-te,l[3]=0,l[4]=M-oe,l[5]=1-A-U,l[6]=B+K,l[7]=0,l[8]=D+te,l[9]=B-K,l[10]=1-A-k,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}Math.hypot||(Math.hypot=function(){for(var l=0,n=arguments.length;n--;)l+=arguments[n]*arguments[n];return Math.sqrt(l)});var Ze=X;function He(){var l=new T(3);return T!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l}function Ke(l){var n=new T(3);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n}function dt(l){return Math.hypot(l[0],l[1],l[2])}function $e(l,n,a){var h=new T(3);return h[0]=l,h[1]=n,h[2]=a,h}function mt(l,n,a){return l[0]=n[0]+a[0],l[1]=n[1]+a[1],l[2]=n[2]+a[2],l}function ct(l,n,a){return l[0]=n[0]-a[0],l[1]=n[1]-a[1],l[2]=n[2]-a[2],l}function St(l,n,a){return l[0]=n[0]*a[0],l[1]=n[1]*a[1],l[2]=n[2]*a[2],l}function Ue(l,n,a){return l[0]=Math.min(n[0],a[0]),l[1]=Math.min(n[1],a[1]),l[2]=Math.min(n[2],a[2]),l}function st(l,n,a){return l[0]=Math.max(n[0],a[0]),l[1]=Math.max(n[1],a[1]),l[2]=Math.max(n[2],a[2]),l}function bt(l,n,a){return l[0]=n[0]*a,l[1]=n[1]*a,l[2]=n[2]*a,l}function At(l,n,a,h){return l[0]=n[0]+a[0]*h,l[1]=n[1]+a[1]*h,l[2]=n[2]+a[2]*h,l}function zt(l,n){var a=n[0]-l[0],h=n[1]-l[1],f=n[2]-l[2];return a*a+h*h+f*f}function or(l){var n=l[0],a=l[1],h=l[2];return n*n+a*a+h*h}function Mr(l,n){return l[0]=-n[0],l[1]=-n[1],l[2]=-n[2],l}function Ar(l,n){var a=n[0],h=n[1],f=n[2],_=a*a+h*h+f*f;return _>0&&(_=1/Math.sqrt(_)),l[0]=n[0]*_,l[1]=n[1]*_,l[2]=n[2]*_,l}function vr(l,n){return l[0]*n[0]+l[1]*n[1]+l[2]*n[2]}function nr(l,n,a){var h=n[0],f=n[1],_=n[2],y=a[0],b=a[1],E=a[2];return l[0]=f*E-_*b,l[1]=_*y-h*E,l[2]=h*b-f*y,l}function Xr(l,n,a,h){var f=n[0],_=n[1],y=n[2];return l[0]=f+h*(a[0]-f),l[1]=_+h*(a[1]-_),l[2]=y+h*(a[2]-y),l}function Lt(l,n,a){var h=n[0],f=n[1],_=n[2],y=a[3]*h+a[7]*f+a[11]*_+a[15];return l[0]=(a[0]*h+a[4]*f+a[8]*_+a[12])/(y=y||1),l[1]=(a[1]*h+a[5]*f+a[9]*_+a[13])/y,l[2]=(a[2]*h+a[6]*f+a[10]*_+a[14])/y,l}function ur(l,n,a){var h=n[0],f=n[1],_=n[2];return l[0]=h*a[0]+f*a[3]+_*a[6],l[1]=h*a[1]+f*a[4]+_*a[7],l[2]=h*a[2]+f*a[5]+_*a[8],l}function _r(l,n,a){var h=a[0],f=a[1],_=a[2],y=n[0],b=n[1],E=n[2],A=f*E-_*b,M=_*y-h*E,k=h*b-f*y,D=f*k-_*M,B=_*A-h*k,U=h*M-f*A,K=2*a[3];return M*=K,k*=K,B*=2,U*=2,l[0]=y+(A*=K)+(D*=2),l[1]=b+M+B,l[2]=E+k+U,l}function Mt(l,n){return l[0]===n[0]&&l[1]===n[1]&&l[2]===n[2]}var Nr=ct,Yr=St,Hn=dt;function en(){var l=new T(4);return T!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0,l[3]=0),l}function Ei(l,n,a){return l[0]=n[0]*a,l[1]=n[1]*a,l[2]=n[2]*a,l[3]=n[3]*a,l}function xo(l,n){var a=n[0],h=n[1],f=n[2],_=n[3],y=a*a+h*h+f*f+_*_;return y>0&&(y=1/Math.sqrt(y)),l[0]=a*y,l[1]=h*y,l[2]=f*y,l[3]=_*y,l}function On(l,n,a){var h=n[0],f=n[1],_=n[2],y=n[3];return l[0]=a[0]*h+a[4]*f+a[8]*_+a[12]*y,l[1]=a[1]*h+a[5]*f+a[9]*_+a[13]*y,l[2]=a[2]*h+a[6]*f+a[10]*_+a[14]*y,l[3]=a[3]*h+a[7]*f+a[11]*_+a[15]*y,l}function Ai(){var l=new T(4);return T!=Float32Array&&(l[0]=0,l[1]=0,l[2]=0),l[3]=1,l}function Io(l){return l[0]=0,l[1]=0,l[2]=0,l[3]=1,l}function vs(l,n,a){a*=.5;var h=n[0],f=n[1],_=n[2],y=n[3],b=Math.sin(a),E=Math.cos(a);return l[0]=h*E+y*b,l[1]=f*E+_*b,l[2]=_*E-f*b,l[3]=y*E-h*b,l}function Zo(l,n,a){a*=.5;var h=n[0],f=n[1],_=n[2],y=n[3],b=Math.sin(a),E=Math.cos(a);return l[0]=h*E-_*b,l[1]=f*E+y*b,l[2]=_*E+h*b,l[3]=y*E-f*b,l}He(),en();var ao,bl,qa,lo,pc,Xo=xo,wl=(ao=He(),bl=$e(1,0,0),qa=$e(0,1,0),function(l,n,a){var h=vr(n,a);return h<-.999999?(nr(ao,bl,n),Hn(ao)<1e-6&&nr(ao,qa,n),Ar(ao,ao),function(f,_,y){y*=.5;var b=Math.sin(y);f[0]=b*_[0],f[1]=b*_[1],f[2]=b*_[2],f[3]=Math.cos(y)}(l,ao,Math.PI),l):h>.999999?(l[0]=0,l[1]=0,l[2]=0,l[3]=1,l):(nr(ao,n,a),l[0]=ao[0],l[1]=ao[1],l[2]=ao[2],l[3]=1+h,Xo(l,l))});function bo(){var l=new T(2);return T!=Float32Array&&(l[0]=0,l[1]=0),l}function ls(l,n){var a=new T(2);return a[0]=l,a[1]=n,a}function Za(l,n,a){return l[0]=n[0]+a[0],l[1]=n[1]+a[1],l}function Xa(l,n,a){return l[0]=n[0]-a[0],l[1]=n[1]-a[1],l}function wa(l,n,a){return l[0]=n[0]*a,l[1]=n[1]*a,l}function zo(l){return Math.hypot(l[0],l[1])}function mc(l,n){var a=n[0],h=n[1],f=a*a+h*h;return f>0&&(f=1/Math.sqrt(f)),l[0]=n[0]*f,l[1]=n[1]*f,l}function wr(l,n){return l[0]*n[0]+l[1]*n[1]}function oi(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}Ai(),Ai(),C(),bo();var si,Fi,xs=function(){if(pc)return lo;function l(n,a,h,f){this.cx=3*n,this.bx=3*(h-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=h,this.p2y=f}return pc=1,lo=l,l.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var h=n,f=0;f<8;f++){var _=this.sampleCurveX(h)-n;if(Math.abs(_)<a)return h;var y=this.sampleCurveDerivativeX(h);if(Math.abs(y)<1e-6)break;h-=_/y}var b=0,E=1;for(h=n,f=0;f<20&&(_=this.sampleCurveX(h),!(Math.abs(_-n)<a));f++)n>_?b=h:E=h,h=.5*(E-b)+b;return h},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},lo}(),Sl=oi(xs);function Tl(){if(Fi)return si;function l(n,a){this.x=n,this.y=a}return Fi=1,si=l,l.prototype={clone:function(){return new l(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,a){return this.clone()._rotateAround(n,a)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var a=n.x-this.x,h=n.y-this.y;return a*a+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,a){return Math.atan2(this.x*a-this.y*n,this.x*n+this.y*a)},_matMult:function(n){var a=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=a,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var a=Math.cos(n),h=Math.sin(n),f=h*this.x+a*this.y;return this.x=a*this.x-h*this.y,this.y=f,this},_rotateAround:function(n,a){var h=Math.cos(n),f=Math.sin(n),_=a.y+f*(this.x-a.x)+h*(this.y-a.y);return this.x=a.x+h*(this.x-a.x)-f*(this.y-a.y),this.y=_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},l.convert=function(n){return n instanceof l?n:Array.isArray(n)?new l(n[0],n[1]):n},si}var Dt=oi(Tl());function El(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let a=0;a<l.length;a++)if(!El(l[a],n[a]))return!1;return!0}if(typeof l=="object"&&l!==null&&n!==null){if(typeof n!="object"||Object.keys(l).length!==Object.keys(n).length)return!1;for(const a in l)if(!El(l[a],n[a]))return!1;return!0}return l===n}const Dy=Math.PI/180,nf=180/Math.PI;function nn(l){return l*Dy}function Je(l){return l*nf}const se=[[0,0],[1,0],[1,1],[0,1]];function ue(l){if(l<=0)return 0;if(l>=1)return 1;const n=l*l,a=n*l;return 4*(l<.5?a:3*(l-n)+a-.75)}function xe(l,n,a,h){const f=new Sl(l,n,a,h);return function(_){return f.solve(_)}}const Me=xe(.25,.1,.25,1);function Ee(l,n,a){return Math.min(a,Math.max(n,l))}function ze(l,n,a){return(a=Ee((a-l)/(n-l),0,1))*a*(3-2*a)}function We(l,n,a){const h=a-n,f=((l-n)%h+h)%h+n;return f===n?a:f}function Ne(l,n,a){if(!l.length)return a(null,[]);let h=l.length;const f=new Array(l.length);let _=null;l.forEach((y,b)=>{n(y,(E,A)=>{E&&(_=E),f[b]=A,--h==0&&a(_,f)})})}function Xe(l,...n){for(const a of n)for(const h in a)l[h]=a[h];return l}let pt=1;function Qe(){return pt++}function kt(l){return l<=1?1:Math.pow(2,Math.ceil(Math.log(l)/Math.LN2))}function Yt(l,n){l.forEach(a=>{n[a]&&(n[a]=n[a].bind(n))})}function er(l,n,a){const h={};for(const f in l)h[f]=n.call(this,l[f],f,l);return h}function xr(l,n,a){const h={};for(const f in l)n.call(this,l[f],f,l)&&(h[f]=l[f]);return h}function Sr(l){return Array.isArray(l)?l.map(Sr):typeof l=="object"&&l?er(l,Sr):l}function Pr(l,n){for(let a=0;a<l.length;a++)if(n.indexOf(l[a])>=0)return!0;return!1}const Gr={};function Rr(l){Gr[l]||(typeof console<"u"&&console.warn(l),Gr[l]=!0)}function Cn(l,n,a){return(a.y-l.y)*(n.x-l.x)>(n.y-l.y)*(a.x-l.x)}function Yn(l){let n=0;for(let a,h,f=0,_=l.length,y=_-1;f<_;y=f++)a=l[f],h=l[y],n+=(h.x-a.x)*(a.y+h.y);return n}function Jn([l,n,a]){const h=nn(n+90),f=nn(a);return{x:l*Math.cos(h)*Math.sin(f),y:l*Math.sin(h)*Math.sin(f),z:l*Math.cos(f),azimuthal:n,polar:a}}function _n(l){return(typeof self<"u"||l!==void 0)&&typeof WorkerGlobalScope<"u"&&(l!==void 0?l:self)instanceof WorkerGlobalScope}function sn(l){const n={};if(l.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,f,_)=>{const y=f||_;return n[h]=!y||y.toLowerCase(),""}),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}let vi=null;function hi(l,n){return[l[4*n],l[4*n+1],l[4*n+2],l[4*n+3]]}function ai(l,n,a,h){for(;n<a;){const f=n+a>>1;l[f]<h?n=f+1:a=f}return n}function po(l,n,a,h){for(;n<a;){const f=n+a>>1;l[f]<=h?n=f+1:a=f}return n}function cs(l){return l>0?1/(1.001-l):1+l}function No(l){return l>0?1-1/(1.001-l):-l}function of(l,n,a){return(l-n.min)*(a.max-a.min)/(n.max-n.min)+a.min}const wo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!wo.API_URL)return null;try{const l=new URL(wo.API_URL);return l.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":l.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function gc(l){return wo.API_URL_REGEX.test(l)}function dm(l){return wo.API_SPRITE_REGEX.test(l)}let sf,af,fm,pm,iu,lf;function mm(){return sf==null&&(sf=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),sf}const Sa={now:()=>pm!==void 0?pm:performance.now(),setNow(l){pm=l},restoreNow(){pm=void 0},frame(l){const n=requestAnimationFrame(l);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(l,n=0){const{width:a,height:h}=l;iu||(iu=document.createElement("canvas"));const f=iu.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return(a>iu.width||h>iu.height)&&(iu.width=a,iu.height=h),f.clearRect(-n,-n,a+2*n,h+2*n),f.drawImage(l,0,0,a,h),f.getImageData(-n,-n,a+2*n,h+2*n)},resolveURL:l=>(af||(af=document.createElement("a")),af.href=l,af.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(fm==null&&(fm=window.matchMedia("(prefers-reduced-motion: reduce)")),fm.matches)},hasCanvasFingerprintNoise(){if(lf!==void 0)return lf;if(!mm())return lf=!1,!1;const l=new OffscreenCanvas(85,1),n=l.getContext("2d",{willReadFrequently:!0});let a=0;for(let f=0;f<l.width;++f)n.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,n.fillRect(f,0,1,1);const h=n.getImageData(0,0,l.width,l.height);a=0;for(let f=0;f<h.data.length;++f)if(f%4!=3&&a++!==h.data[f])return lf=!0,!0;return lf=!1,!1}};function Bs(l,n){const a=l.indexOf("?");if(a<0)return`${l}?${new URLSearchParams(n).toString()}`;const h=new URLSearchParams(l.slice(a));for(const f in n)h.set(f,n[f]);return`${l.slice(0,a)}?${h.toString()}`}function ia(l,n={persistentParams:[]}){const a=l.indexOf("?");if(a<0)return l;const h=new URLSearchParams,f=new URLSearchParams(l.slice(a));for(const y of n.persistentParams){const b=f.get(y);b&&h.set(y,b)}const _=h.toString();return`${l.slice(0,a)}${_.length>0?`?${_}`:""}`}const Al="mapbox-tiles";let Ta=500,Pl=50;const cf=["language","worldview","jobid"];let Ka,uf;function ou(){try{return caches}catch{}}function lh(){const l=ou();l&&Ka==null&&(Ka=l.open(Al))}let Ly=1/0;const zy={supported:!1,testSupport:function(l){!hf&&su&&(ch?nb(l):us=l)}};let us,su,hf=!1,ch=!1;const rb=typeof self<"u"?self:{};function nb(l){const n=l.createTexture();l.bindTexture(l.TEXTURE_2D,n);try{if(l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,su),l.isContextLost())return;zy.supported=!0}catch{}l.deleteTexture(n),hf=!0}rb.document&&(su=rb.document.createElement("img"),su.onload=function(){us&&nb(us),us=null,ch=!0},su.onerror=function(){hf=!0,us=null},su.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const df={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(df);class tn extends Error{constructor(n,a,h){a===401&&gc(h)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=a,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const gm=_n()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,uh=function(l,n){if(!(/^file:/.test(a=l.url)||/^file:/.test(gm())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,f){const _=new AbortController,y=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:gm(),referrerPolicy:h.referrerPolicy,signal:_.signal});let b=!1,E=!1;const A=(M=y.url).indexOf("sku=")>0&&gc(M);var M;h.type==="json"&&y.headers.set("Accept","application/json");const k=(B,U,K)=>{if(E)return;if(B&&B.message!=="SecurityError"&&Rr(B.toString()),U&&K)return D(U);const te=Date.now();fetch(y).then(oe=>{if(oe.ok){const de=A?oe.clone():null;return D(oe,de,te)}return f(new tn(oe.statusText,oe.status,h.url))}).catch(oe=>{oe.name!=="AbortError"&&f(new Error(`${oe.message} ${h.url}`))})},D=(B,U,K)=>{(h.type==="arrayBuffer"?B.arrayBuffer():h.type==="json"?B.json():B.text()).then(te=>{E||(U&&K&&function(oe,de,fe){if(lh(),Ka==null)return;const Y=sn(de.headers.get("Cache-Control")||"");if(Y["no-store"])return;const le={status:de.status,statusText:de.statusText,headers:new Headers};de.headers.forEach((Re,Ie)=>le.headers.set(Ie,Re)),Y["max-age"]&&le.headers.set("Expires",new Date(fe+1e3*Y["max-age"]).toUTCString());const pe=le.headers.get("Expires");if(!pe||new Date(pe).getTime()-fe<42e4)return;let ye=ia(oe.url,{persistentParams:cf});if(de.status===206){const Re=oe.headers.get("Range");if(!Re)return;le.status=200,ye=Bs(ye,{range:Re})}(function(Re,Ie){if(uf===void 0)try{new Response(new ReadableStream),uf=!0}catch{uf=!1}uf?Ie(Re.body):Re.blob().then(Ie).catch(ke=>Rr(ke.message))})(de,Re=>{const Ie=new Response((ke=de.status)!==200&&ke!==404&&[101,103,204,205,304].includes(ke)?null:Re,le);var ke;lh(),Ka!=null&&Ka.then(je=>je.put(ye,Ie)).catch(je=>Rr(je.message))})}(y,U,K),b=!0,f(null,te,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(te=>{E||f(new Error(te.message))})};return A?function(B,U){if(lh(),Ka==null)return U(null);Ka.then(K=>{let te=ia(B.url,{persistentParams:cf});const oe=B.headers.get("Range");oe&&(te=Bs(te,{range:oe})),K.match(te).then(de=>{const fe=function(Y){if(!Y)return!1;const le=new Date(Y.headers.get("Expires")||0),pe=sn(Y.headers.get("Cache-Control")||"");return Number(le)>Date.now()&&!pe["no-cache"]}(de);K.delete(te).catch(U),fe&&K.put(te,de.clone()).catch(U),U(null,de,fe)}).catch(U)}).catch(U)}(y,k):k(null,null),{cancel:()=>{E=!0,b||_.abort()}}}(l,n);if(_n(self)&&self.worker.actor)return self.worker.actor.send("getResource",l,n,void 0,!0)}var a;return function(h,f){const _=new XMLHttpRequest;_.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const y in h.headers)_.setRequestHeader(y,h.headers[y]);return h.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=h.credentials==="include",_.onerror=()=>{f(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let y=_.response;if(h.type==="json")try{y=JSON.parse(_.response)}catch(b){return f(b)}f(null,y,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else f(new tn(_.statusText,_.status,h.url))},_.send(h.body),{cancel:()=>_.abort()}}(l,n)},ff=function(l,n){return uh(Xe(l,{type:"arrayBuffer"}),n)};function MA(l){const n=document.createElement("a");return n.href=l,n.protocol===location.protocol&&n.host===location.host}const pf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let au,_c;au=[],_c=0;const Ny=function(l,n){if(zy.supported&&(l.headers||(l.headers={}),l.headers.accept="image/webp,*/*"),_c>=wo.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:l,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return au.push(_),_}_c++;let a=!1;const h=()=>{if(!a)for(a=!0,_c--;au.length&&_c<wo.MAX_PARALLEL_IMAGE_REQUESTS;){const _=au.shift(),{requestParameters:y,callback:b,cancelled:E}=_;E||(_.cancel=Ny(y,b).cancel)}},f=ff(l,(_,y,b,E)=>{h(),_?n(_):y&&(self.createImageBitmap?function(A,M){const k=new Blob([new Uint8Array(A)],{type:"image/png"});createImageBitmap(k).then(D=>{M(null,D)}).catch(D=>{M(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(A,M)=>n(A,M,b,E)):function(A,M){const k=new Image;k.onload=()=>{M(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame(()=>{k.src=pf})},k.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(A)],{type:"image/png"});k.src=A.byteLength?URL.createObjectURL(D):pf}(y,(A,M)=>n(A,M,b,E)))});return{cancel:()=>{f.cancel(),h()}}};var jy,lu,ib,Cl={exports:{}},_m={exports:{}},ym={exports:{}},Ea=function(){if(ib)return Cl.exports;ib=1;var l=(jy||(jy=1,_m.exports=function(a,h){var f,_,y,b,E,A,M,k;for(_=a.length-(f=3&a.length),y=h,E=3432918353,A=461845907,k=0;k<_;)M=255&a.charCodeAt(k)|(255&a.charCodeAt(++k))<<8|(255&a.charCodeAt(++k))<<16|(255&a.charCodeAt(++k))<<24,++k,y=27492+(65535&(b=5*(65535&(y=(y^=M=(65535&(M=(M=(65535&M)*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(M=0,f){case 3:M^=(255&a.charCodeAt(k+2))<<16;case 2:M^=(255&a.charCodeAt(k+1))<<8;case 1:y^=M=(65535&(M=(M=(65535&(M^=255&a.charCodeAt(k)))*E+(((M>>>16)*E&65535)<<16)&4294967295)<<15|M>>>17))*A+(((M>>>16)*A&65535)<<16)&4294967295}return y^=a.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),_m.exports),n=(lu||(lu=1,ym.exports=function(a,h){for(var f,_=a.length,y=h^_,b=0;_>=4;)f=1540483477*(65535&(f=255&a.charCodeAt(b)|(255&a.charCodeAt(++b))<<8|(255&a.charCodeAt(++b))<<16|(255&a.charCodeAt(++b))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),_-=4,++b;switch(_){case 3:y^=(255&a.charCodeAt(b+2))<<16;case 2:y^=(255&a.charCodeAt(b+1))<<8;case 1:y=1540483477*(65535&(y^=255&a.charCodeAt(b)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),ym.exports);return Cl.exports=l,Cl.exports.murmur3=l,Cl.exports.murmur2=n,Cl.exports}(),mf=oi(Ea);class cu{constructor(n,...a){Xe(this,a[0]||{}),this.type=n}}class vm extends cu{constructor(n,a={}){super("error",Xe({error:n},a))}}function Fy(l,n,a){a[l]&&a[l].indexOf(n)!==-1||(a[l]=a[l]||[],a[l].push(n))}function xm(l,n,a){if(a&&a[l]){const h=a[l].indexOf(n);h!==-1&&a[l].splice(h,1)}}class uu{on(n,a){return this._listeners=this._listeners||{},Fy(n,a,this._listeners),this}off(n,a){return xm(n,a,this._listeners),xm(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Fy(n,a,this._oneTimeListeners),this):new Promise(h=>{this.once(n,h)})}fire(n,a){const h=typeof n=="string"?new cu(n,a):n,f=h.type;if(this.listens(f)){h.target=this;const _=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of _)E.call(this,h);const y=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of y)xm(f,E,this._oneTimeListeners),E.call(this,h);const b=this._eventedParent;b&&(Xe(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(h))}else h instanceof vm&&console.error(h.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}class bs{constructor(n){typeof n=="string"?this.name=n:(this.name=n.name,this.iconsetId=n.iconsetId)}static from(n){return new bs(n)}static toString(n){return n.iconsetId?`${n.name}${n.iconsetId}`:n.name}static parse(n){const[a,h]=n.split("");return new bs({name:a,iconsetId:h})}static isEqual(n,a){return n.name===a.name&&n.iconsetId===a.iconsetId}toString(){return bs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var By,hh={},hu=function(){if(By)return hh;By=1;var l={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(_){return(_=Math.round(_))<0?0:_>255?255:_}function a(_){return n(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function h(_){return(y=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:y>1?1:y;var y}function f(_,y,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?_+(y-_)*b*6:2*b<1?y:3*b<2?_+(y-_)*(2/3-b)*6:_}try{hh.parseCSSColor=function(_){var y,b=_.replace(/ /g,"").toLowerCase();if(b in l)return l[b].slice();if(b[0]==="#")return b.length===4?(y=parseInt(b.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:b.length===7&&(y=parseInt(b.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var E=b.indexOf("("),A=b.indexOf(")");if(E!==-1&&A+1===b.length){var M=b.substr(0,E),k=b.substr(E+1,A-(E+1)).split(","),D=1;switch(M){case"rgba":if(k.length!==4)return null;D=h(k.pop());case"rgb":return k.length!==3?null:[a(k[0]),a(k[1]),a(k[2]),D];case"hsla":if(k.length!==4)return null;D=h(k.pop());case"hsl":if(k.length!==3)return null;var B=(parseFloat(k[0])%360+360)%360/360,U=h(k[1]),K=h(k[2]),te=K<=.5?K*(U+1):K+U-K*U,oe=2*K-te;return[n(255*f(oe,te,B+1/3)),n(255*f(oe,te,B)),n(255*f(oe,te,B-1/3)),D];default:return null}}return null}}catch{}return hh}();class dn{constructor(n,a,h,f=1){this.r=n,this.g=a,this.b=h,this.a=f}static parse(n){if(!n)return;if(n instanceof dn)return n;if(typeof n!="string")return;const a=hu.parseCSSColor(n);return a?new dn(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[n,a,h,f]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*a)},${Math.round(255*h)},${f})`}toNonPremultipliedRenderColor(n){const{r:a,g:h,b:f,a:_}=this;return new RA(n,a,h,f,_)}toPremultipliedRenderColor(n){const{r:a,g:h,b:f,a:_}=this;return new $y(n,a*_,h*_,f*_,_)}clone(){return new dn(this.r,this.g,this.b,this.a)}}class Aa{constructor(n,a,h,f,_,y=!1){if(this.premultiplied=!1,this.premultiplied=y,n){const b=n.image.height,E=b*b;this.premultiplied?(a=_===0?0:a/_*(b-1),h=_===0?0:h/_*(b-1),f=_===0?0:f/_*(b-1)):(a*=b-1,h*=b-1,f*=b-1);const A=Math.floor(a),M=Math.floor(h),k=Math.floor(f),D=Math.ceil(a),B=Math.ceil(h),U=Math.ceil(f),K=a-A,te=h-M,oe=f-k,de=n.image.data,fe=4*(A+M*E+k*b),Y=4*(A+M*E+U*b),le=4*(A+B*E+k*b),pe=4*(A+B*E+U*b),ye=4*(D+M*E+k*b),Re=4*(D+M*E+U*b),Ie=4*(D+B*E+k*b),ke=4*(D+B*E+U*b);if(fe<0||ke>=de.length)throw new Error("out of range");this.r=pr(pr(pr(de[fe],de[Y],oe),pr(de[le],de[pe],oe),te),pr(pr(de[ye],de[Re],oe),pr(de[Ie],de[ke],oe),te),K)/255*(this.premultiplied?_:1),this.g=pr(pr(pr(de[fe+1],de[Y+1],oe),pr(de[le+1],de[pe+1],oe),te),pr(pr(de[ye+1],de[Re+1],oe),pr(de[Ie+1],de[ke+1],oe),te),K)/255*(this.premultiplied?_:1),this.b=pr(pr(pr(de[fe+2],de[Y+2],oe),pr(de[le+2],de[pe+2],oe),te),pr(pr(de[ye+2],de[Re+2],oe),pr(de[Ie+2],de[ke+2],oe),te),K)/255*(this.premultiplied?_:1),this.a=_}else this.r=a,this.g=h,this.b=f,this.a=_}toArray(){const{r:n,g:a,b:h,a:f}=this;return[255*n,255*a,255*h,f]}toHslaArray(){let{r:n,g:a,b:h,a:f}=this;if(this.premultiplied){if(f===0)return[0,0,0,0];n/=f,a/=f,h/=f}const _=Math.min(Math.max(n,0),1),y=Math.min(Math.max(a,0),1),b=Math.min(Math.max(h,0),1),E=Math.min(_,y,b),A=Math.max(_,y,b),M=(E+A)/2;if(E===A)return[0,0,100*M,f];const k=A-E,D=M>.5?k/(2-A-E):k/(A+E);let B=0;return A===_?B=(y-b)/k+(y<b?6:0):A===y?B=(b-_)/k+2:A===b&&(B=(_-y)/k+4),B*=60,[Math.min(Math.max(B,0),360),Math.min(Math.max(100*D,0),100),Math.min(Math.max(100*M,0),100),f]}toArray01(){const{r:n,g:a,b:h,a:f}=this;return[n,a,h,f]}toArray01Scaled(n){const{r:a,g:h,b:f}=this;return[a*n,h*n,f*n]}toArray01Linear(){const{r:n,g:a,b:h,a:f}=this;return[Math.pow(n,2.2),Math.pow(a,2.2),Math.pow(h,2.2),f]}}class RA extends Aa{constructor(n,a,h,f,_){super(n,a,h,f,_,!1)}}class $y extends Aa{constructor(n,a,h,f,_){super(n,a,h,f,_,!0)}}function pr(l,n,a){return l*(1-a)+n*a}function bm(l,n,a){return l.map((h,f)=>pr(h,n[f],a))}dn.black=new dn(0,0,0,1),dn.white=new dn(1,1,1,1),dn.transparent=new dn(0,0,0,0),dn.red=new dn(1,0,0,1),dn.blue=new dn(0,0,1,1);var gf=Object.freeze({__proto__:null,array:bm,color:function(l,n,a){return new dn(pr(l.r,n.r,a),pr(l.g,n.g,a),pr(l.b,n.b,a),pr(l.a,n.a,a))},number:pr});function du(l,...n){for(const a of n)for(const h in a)l[h]=a[h];return l}class $s extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class Uy{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[h,f]of a)this.bindings[h]=f}concat(n){return new Uy(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const dh={kind:"null"},rr={kind:"number"},xn={kind:"string"},ln={kind:"boolean"},ws={kind:"color"},Il={kind:"object"},fn={kind:"value"},wm={kind:"collator"},_f={kind:"formatted"},yf={kind:"resolvedImage"};function Ko(l,n){return{kind:"array",itemType:l,N:n}}function Gi(l){if(l.kind==="array"){const n=Gi(l.itemType);return typeof l.N=="number"?`array<${n}, ${l.N}>`:l.itemType.kind==="value"?"array":`array<${n}>`}return l.kind}const kA=[dh,rr,xn,ln,ws,_f,Il,Ko(fn),yf];function fh(l,n){if(n.kind==="error")return null;if(l.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!fh(l.itemType,n.itemType))&&(typeof l.N!="number"||l.N===n.N))return null}else{if(l.kind===n.kind)return null;if(l.kind==="value"){for(const a of kA)if(!fh(a,n))return null}}return`Expected ${Gi(l)} but found ${Gi(n)} instead.`}function yc(l,n){return n.some(a=>a.kind===l.kind)}function vf(l,n){return n.some(a=>a==="null"?l===null:a==="array"?Array.isArray(l):a==="object"?l&&!Array.isArray(l)&&typeof l=="object":a===typeof l)}function Sm(l,n){return l.kind==="array"&&n.kind==="array"?l.N===n.N&&Sm(l.itemType,n.itemType):l.kind===n.kind}class xf{constructor(n,a,h){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tm{constructor(n,a,h,f,_){this.text=n.normalize?n.normalize():n,this.image=a,this.scale=h,this.fontStack=f,this.textColor=_}}class Yo{constructor(n){this.sections=n}static fromString(n){return new Yo([new Tm(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||!!n.image&&n.image.hasPrimary())}static factory(n){return n instanceof Yo?n:Yo.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const a of this.sections){if(a.image){const f=a.image.getPrimary().id.toString();n.push(["image",f]);continue}n.push(a.text);const h={};a.fontStack&&(h["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(h["font-scale"]=a.scale),a.textColor&&(h["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),n.push(h)}return n}}class Ol{constructor(n,a={}){if(this.id=bs.from(n),this.options=Object.assign({},a),a.transform){const{a:h,b:f,c:_,d:y,e:b,f:E}=a.transform;this.options.transform=new DOMMatrix([h,f,_,y,b,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:n,b:a,c:h,d:f,e:_,f:y}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:n,b:a,c:h,d:f,e:_,f:y}})}static parse(n){let a,h,f,_;try{({name:a,iconsetId:h,params:f,transform:_}=JSON.parse(n)||{})}catch{return null}if(!a)return null;const{a:y,b,c:E,d:A,e:M,f:k}=_||{};return new Ol({name:a,iconsetId:h},{params:f,transform:new DOMMatrix([y,b,E,A,M,k])})}scaleSelf(n,a){return this.options.transform.scaleSelf(n,a),this}}class hs{constructor(n,a,h,f,_=!1){this.primaryId=bs.from(n),this.primaryOptions=a,h&&(this.secondaryId=bs.from(h)),this.secondaryOptions=f,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ol(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ol(this.secondaryId,this.secondaryOptions):null}static from(n){return typeof n=="string"?hs.build({name:n}):n}static build(n,a,h,f){return!n||typeof n=="object"&&!("name"in n)?null:new hs(n,h,a,f)}}function fu(l,n,a,h){return typeof l=="number"&&l>=0&&l<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[l,n,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[l,n,a,h]:[l,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $r(l){if(l===null||typeof l=="string"||typeof l=="boolean"||typeof l=="number"||l instanceof dn||l instanceof xf||l instanceof Yo||l instanceof hs)return!0;if(Array.isArray(l)){for(const n of l)if(!$r(n))return!1;return!0}if(typeof l=="object"){for(const n in l)if(!$r(l[n]))return!1;return!0}return!1}function Gt(l){if(l===null)return dh;if(typeof l=="string")return xn;if(typeof l=="boolean")return ln;if(typeof l=="number")return rr;if(l instanceof dn)return ws;if(l instanceof xf)return wm;if(l instanceof Yo)return _f;if(l instanceof hs)return yf;if(Array.isArray(l)){const n=l.length;let a;for(const h of l){const f=Gt(h);if(a){if(a===f)continue;a=fn;break}a=f}return Ko(a||fn,n)}return Il}function oa(l){const n=typeof l;return l===null?"":n==="string"||n==="number"||n==="boolean"?String(l):l instanceof Yo||l instanceof hs||l instanceof dn?l.toString():JSON.stringify(l)}class br{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!$r(n[1]))return a.error("invalid value");const h=n[1];let f=Gt(h);const _=a.expectedType;return f.kind!=="array"||f.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(f=_),new br(f,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof dn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Yo?this.value.serialize():this.value}}class Bi{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const bf={string:xn,number:rr,boolean:ln,object:Il};class dr{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let h,f=1;const _=n[0];if(_==="array"){let b,E;if(n.length>2){const A=n[1];if(typeof A!="string"||!(A in bf)||A==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);b=bf[A],f++}else b=fn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=n[2],f++}h=Ko(b,E)}else h=bf[_];const y=[];for(;f<n.length;f++){const b=a.parse(n[f],f,fn);if(!b)return null;y.push(b)}return new dr(h,y)}evaluate(n){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(n);if(!fh(this.type,Gt(h)))return h;if(a===this.args.length-1)throw new Bi(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Gi(Gt(h))} but was expected to be of type ${Gi(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,a=[n.kind];if(n.kind==="array"){const h=n.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){a.push(h.kind);const f=n.N;(typeof f=="number"||this.args.length>1)&&a.push(f)}}return a.concat(this.args.map(h=>h.serialize()))}}class ph{constructor(n){this.type=_f,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const h=n[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const f=[];let _=!1;for(let y=1;y<=n.length-1;++y){const b=n[y];if(_&&typeof b=="object"&&!Array.isArray(b)){_=!1;let E=null;if(b["font-scale"]&&(E=a.parseObjectValue(b["font-scale"],y,"font-scale",rr),!E))return null;let A=null;if(b["text-font"]&&(A=a.parseObjectValue(b["text-font"],y,"text-font",Ko(xn)),!A))return null;let M=null;if(b["text-color"]&&(M=a.parseObjectValue(b["text-color"],y,"text-color",ws),!M))return null;const k=f[f.length-1];k.scale=E,k.font=A,k.textColor=M}else{const E=a.parse(n[y],y,fn);if(!E)return null;const A=E.type.kind;if(A!=="string"&&A!=="value"&&A!=="null"&&A!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,f.push({content:E,scale:null,font:null,textColor:null})}}return new ph(f)}evaluate(n){return new Yo(this.sections.map(a=>{const h=a.content.evaluate(n);return Sm(Gt(h),yf)?new Tm("",h,null,null,null):new Tm(oa(h),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null)}))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const a of this.sections){n.push(a.content.serialize());const h={};a.scale&&(h["font-scale"]=a.scale.serialize()),a.font&&(h["text-font"]=a.font.serialize()),a.textColor&&(h["text-color"]=a.textColor.serialize()),n.push(h)}return n}}class mh{constructor(n,a,h,f){this._imageWarnHistory={},this.type=yf,this.namePrimary=n,this.nameSecondary=a,h&&(this.paramsPrimary=h.params,this.iconsetIdPrimary=h.iconset?h.iconset.id:void 0),f&&(this.paramsSecondary=f.params,this.iconsetIdSecondary=f.iconset?f.iconset.id:void 0)}static parse(n,a){if(n.length<2)return a.error("Expected two or more arguments.");let h=1;const f=[];function _(){if(h<n.length){const b=a.parse(n[h],h++,xn);return b?(f.push({image:b,options:{}}),!0):(a.error(f.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function y(){if(h<n.length){const E=n[h];if((b=E)===null||typeof b!="object"||Array.isArray(b))return!0;const A=E.params,M=E.iconset,k=a.concat(h);if(!A&&!M)return h++,!0;if(A){if(typeof A!="object"||A.constructor!==Object)return k.error('Image options "params" should be an object'),!1;const D={},B=k.concat(void 0,"params");for(const U in A){if(!U)return B.error("Image parameter name should be non-empty"),!1;const K=B.concat(void 0,U).parse(A[U],void 0,ws,void 0,{typeAnnotation:"coerce"});if(!K)return!1;D[U]=K}f[f.length-1].options.params=D}if(M){if(typeof M!="object"||M.constructor!==Object)return k.error('Image options "iconset" should be an object'),!1;if(!M.id)return k.error('Image options "iconset" should have an "id" property'),!1;f[f.length-1].options.iconset=M}return h++,!0}var b;return!0}for(let b=0;b<2;b++)if(!_()||!y())return;return new mh(f[0].image,f[1]?f[1].image:void 0,f[0].options,f[1]?f[1].options:void 0)}evaluateParams(n,a){const h={};if(a){for(const f in a)if(a[f])try{h[f]=a[f].evaluate(n)}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(n){const a={name:this.namePrimary.evaluate(n),iconsetId:this.iconsetIdPrimary},h=this.nameSecondary?{name:this.nameSecondary.evaluate(n),iconsetId:this.iconsetIdSecondary}:void 0,f=hs.build(a,h,this.paramsPrimary?this.evaluateParams(n,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(n,this.paramsSecondary):void 0);if(f&&n.availableImages){const _=f.getPrimary().id;if(f.available=n.availableImages.some(y=>bs.isEqual(y,_)),f.available){const y=f.getSecondary()?f.getSecondary().id:null;y&&(f.available=n.availableImages.some(b=>bs.isEqual(b,y)))}}return f}eachChild(n){if(n(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&n(this.paramsPrimary[a]);if(this.nameSecondary&&(n(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&n(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(n,a){const h={};if(a&&(h.iconset={id:a}),n){h.params={};for(const f in n)n[f]&&(h.params[f]=n[f].serialize())}return Object.keys(h).length>0?h:void 0}serialize(){const n=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&n.push(a)}if(this.nameSecondary&&(n.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&n.push(a)}return n}}function vc(l){return l instanceof Number?"number":l instanceof String?"string":l instanceof Boolean?"boolean":Array.isArray(l)?"array":l===null?"null":typeof l}const ob={"to-boolean":ln,"to-color":ws,"to-number":rr,"to-string":xn};class sa{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const h=n[0],f=[];let _=dh;if(h==="to-array"){if(!Array.isArray(n[1]))return null;const y=n[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);_=Ko(a.expectedType.itemType,y)}else{if(!(y>0&&$r(n[1][0])))return null;_=Ko(Gt(n[1][0]),y)}for(let b=0;b<y;b++){const E=n[1][b];let A;if(vc(E)==="array")A=a.parse(E,void 0,_.itemType);else{const M=vc(E);if(M!==_.itemType.kind)return a.error(`Expected ${_.itemType.kind} but found ${M}.`);A=a.registry.literal.parse(["literal",E===void 0?null:E],a)}if(!A)return null;f.push(A)}}else{if((h==="to-boolean"||h==="to-string")&&n.length!==2)return a.error("Expected one argument.");_=ob[h];for(let y=1;y<n.length;y++){const b=a.parse(n[y],y,fn);if(!b)return null;f.push(b)}}return new sa(_,f)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let a,h;for(const f of this.args){if(a=f.evaluate(n),h=null,a instanceof dn)return a;if(typeof a=="string"){const _=n.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:fu(a[0],a[1],a[2],a[3]),!h))return new dn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Bi(h||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const h of this.args){if(a=h.evaluate(n),a===null)return 0;const f=Number(a);if(!isNaN(f))return f}throw new Bi(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Yo.fromString(oa(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?hs.build(oa(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(a=>a.evaluate(n)):oa(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ph([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new mh(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{n.push(a.serialize())}),n}}const Jo=["Unknown","Point","LineString","Polygon"];class wf{constructor(n,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:h,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*a-n[0])+this.featureDistanceData.bearing[1]*(f*a-n[1])}return 0}parseColor(n){let a=this._parseColorCache[n];return a||(a=this._parseColorCache[n]=dn.parse(n)),a}getConfig(n){return this.options?this.options.get(n):null}}class mo{constructor(n,a,h,f,_){this.name=n,this.type=a,this._evaluate=h,this.args=f,this._overloadIndex=_}evaluate(n){if(!this._evaluate){const a=mo.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,a){const h=n[0],f=mo.definitions[h];if(!f)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,b=[];let E=null,A=-1;for(const[M,k]of y){if(Array.isArray(M)&&M.length!==n.length-1)continue;b.push(M),A++,E=new zm(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const D=[];let B=!1;for(let U=1;U<n.length;U++){const K=n[U],te=Array.isArray(M)?M[U-1]:M.type,oe=E.parse(K,1+D.length,te);if(!oe){B=!0;break}D.push(oe)}if(!B)if(Array.isArray(M)&&M.length!==D.length)E.error(`Expected ${M.length} arguments, but found ${D.length} instead.`);else{for(let U=0;U<D.length;U++){const K=Array.isArray(M)?M[U]:M.type,te=D[U];E.concat(U+1).checkSubtype(K,te.type)}if(E.errors.length===0)return new mo(h,_,k,D,A)}}if(b.length===1)a.errors.push(...E.errors);else{const M=(b.length?b:y.map(([D])=>D)).map(Vy).join(" | "),k=[];for(let D=1;D<n.length;D++){const B=a.parse(n[D],1+k.length);if(!B)return null;k.push(Gi(B.type))}a.error(`Expected arguments of type ${M}, but found (${k.join(", ")}) instead.`)}return null}static register(n,a){mo.definitions=a;for(const h in a)n[h]=mo}}function Vy(l){return Array.isArray(l)?`(${l.map(Gi).join(", ")})`:`(${Gi(l.type)}...)`}class Ya{constructor(n,a,h){this.type=wm,this.locale=h,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const h=n[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const f=h["case-sensitive"]===void 0?a.parse(!1,1,ln):a.parseObjectValue(h["case-sensitive"],1,"case-sensitive",ln);if(!f)return null;const _=h["diacritic-sensitive"]===void 0?a.parse(!1,1,ln):a.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",ln);if(!_)return null;let y=null;return h.locale&&(y=a.parseObjectValue(h.locale,1,"locale",xn),!y)?null:new Ya(f,_,y)}evaluate(n){return new xf(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function jo(l,n,a=0,h=l.length-1,f=DA){for(;h>a;){if(h-a>600){const E=h-a+1,A=n-a+1,M=Math.log(E),k=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*k*(E-k)/E)*(A-E/2<0?-1:1);jo(l,n,Math.max(a,Math.floor(n-A*k/E+D)),Math.min(h,Math.floor(n+(E-A)*k/E+D)),f)}const _=l[n];let y=a,b=h;for(Sf(l,a,n),f(l[h],_)>0&&Sf(l,a,h);y<b;){for(Sf(l,y,b),y++,b--;f(l[y],_)<0;)y++;for(;f(l[b],_)>0;)b--}f(l[a],_)===0?Sf(l,a,b):(b++,Sf(l,b,h)),b<=n&&(a=b+1),n<=b&&(h=b-1)}}function Sf(l,n,a){const h=l[n];l[n]=l[a],l[a]=h}function DA(l,n){return l<n?-1:l>n?1:0}function LA(l){let n=0;for(let a,h,f=0,_=l.length,y=_-1;f<_;y=f++)a=l[f],h=l[y],n+=(h.x-a.x)*(a.y+h.y);return n}function xc(l,n){l[0]=Math.min(l[0],n[0]),l[1]=Math.min(l[1],n[1]),l[2]=Math.max(l[2],n[0]),l[3]=Math.max(l[3],n[1])}function gh(l,n){return!(l[0]<=n[0]||l[2]>=n[2]||l[1]<=n[1]||l[3]>=n[3])}function pu(l,n,a){const h=l[0]-n[0],f=l[1]-n[1],_=l[0]-a[0],y=l[1]-a[1];return h*y-_*f==0&&h*_<=0&&f*y<=0}function _h(l,n,a=!1){let h=!1;for(let b=0,E=n.length;b<E;b++){const A=n[b];for(let M=0,k=A.length,D=k-1;M<k;D=M++){const B=A[D],U=A[M];if(pu(l,B,U))return a;(_=B)[1]>(f=l)[1]!=(y=U)[1]>f[1]&&f[0]<(y[0]-_[0])*(f[1]-_[1])/(y[1]-_[1])+_[0]&&(h=!h)}}var f,_,y;return h}function sb(l,n,a,h){const f=h[0]-a[0],_=h[1]-a[1],y=(l[0]-a[0])*_-f*(l[1]-a[1]),b=(n[0]-a[0])*_-f*(n[1]-a[1]);return y>0&&b<0||y<0&&b>0}function Em(l,n,a,h){return(f=[h[0]-a[0],h[1]-a[1]])[0]*(_=[n[0]-l[0],n[1]-l[1]])[1]-f[1]*_[0]!=0&&!(!sb(l,n,a,h)||!sb(a,h,l,n));var f,_}function Gy(l){const n=new Dt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Dt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const h of l[0])n.x>h.x&&(n.x=h.x),n.y>h.y&&(n.y=h.y),a.x<h.x&&(a.x=h.x),a.y<h.y&&(a.y=h.y);return{min:n,max:a}}const Ml=8192;function zA(l,n){const a=(180+l[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l[1]*Math.PI/360)))/360,f=Math.pow(2,n.z);return[Math.round(a*f*Ml),Math.round(h*f*Ml)]}function NA(l,n){for(let a=0;a<n.length;a++)if(_h(l,n[a]))return!0;return!1}function ab(l,n,a){for(const h of a)for(let f=0,_=h.length,y=_-1;f<_;y=f++)if(Em(l,n,h[y],h[f]))return!0;return!1}function lb(l,n){for(let a=0;a<l.length;++a)if(!_h(l[a],n))return!1;for(let a=0;a<l.length-1;++a)if(ab(l[a],l[a+1],n))return!1;return!0}function mu(l,n){for(let a=0;a<n.length;a++)if(lb(l,n[a]))return!0;return!1}function Hy(l,n,a){const h=[];for(let f=0;f<l.length;f++){const _=[];for(let y=0;y<l[f].length;y++){const b=zA(l[f][y],a);xc(n,b),_.push(b)}h.push(_)}return h}function cb(l,n,a){const h=[];for(let f=0;f<l.length;f++){const _=Hy(l[f],n,a);h.push(_)}return h}function Am(l,n,a,h){if(l[0]<a[0]||l[0]>a[2]){const f=.5*h;let _=l[0]-a[0]>f?-h:a[0]-l[0]>f?h:0;_===0&&(_=l[0]-a[2]>f?-h:a[2]-l[0]>f?h:0),l[0]+=_}xc(n,l)}function Wy(l,n,a,h){const f=Math.pow(2,h.z)*Ml,_=[h.x*Ml,h.y*Ml],y=[];if(!l)return y;for(const b of l)for(const E of b){const A=[E.x+_[0],E.y+_[1]];Am(A,n,a,f),y.push(A)}return y}function qy(l,n,a,h){const f=Math.pow(2,h.z)*Ml,_=[h.x*Ml,h.y*Ml],y=[];if(!l)return y;for(const E of l){const A=[];for(const M of E){const k=[M.x+_[0],M.y+_[1]];xc(n,k),A.push(k)}y.push(A)}if(n[2]-n[0]<=f/2){(b=n)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const E of y)for(const A of E)Am(A,n,a,f)}var b;return y}class Fo{constructor(n,a){this.type=ln,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if($r(n[1])){const h=n[1];if(h.type==="FeatureCollection")for(let f=0;f<h.features.length;++f){const _=h.features[f].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Fo(h,h.features[f].geometry)}else if(h.type==="Feature"){const f=h.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Fo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Fo(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const b=Hy(h.coordinates,_,y),E=Wy(a.geometry(),f,_,y);if(!gh(f,_))return!1;for(const A of E)if(!_h(A,b))return!1}if(h.type==="MultiPolygon"){const b=cb(h.coordinates,_,y),E=Wy(a.geometry(),f,_,y);if(!gh(f,_))return!1;for(const A of E)if(!NA(A,b))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,h){const f=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],y=a.canonicalID();if(!y)return!1;if(h.type==="Polygon"){const b=Hy(h.coordinates,_,y),E=qy(a.geometry(),f,_,y);if(!gh(f,_))return!1;for(const A of E)if(!lb(A,b))return!1}if(h.type==="MultiPolygon"){const b=cb(h.coordinates,_,y),E=qy(a.geometry(),f,_,y);if(!gh(f,_))return!1;for(const A of E)if(!mu(A,b))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Tf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zy=1/298.257223563,Xy=Zy*(2-Zy),yh=Math.PI/180;class vh{static fromTile(n,a,h){const f=Math.PI*(1-2*(n+.5)/Math.pow(2,a)),_=Math.atan(.5*(Math.exp(f)-Math.exp(-f)))/yh;return new vh(_,h)}static get units(){return Tf}constructor(n,a){if(n===void 0)throw new Error("No latitude given.");if(a&&!Tf[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Tf).join(", ")}`);const h=6378.137*yh*(a?Tf[a]:1),f=Math.cos(n*yh),_=1/(1-Xy*(1-f*f)),y=Math.sqrt(_);this.kx=h*y*f,this.ky=h*y*_*(1-Xy)}distance(n,a){const h=Us(n[0]-a[0])*this.kx,f=(n[1]-a[1])*this.ky;return Math.sqrt(h*h+f*f)}bearing(n,a){const h=Us(a[0]-n[0])*this.kx;return Math.atan2(h,(a[1]-n[1])*this.ky)/yh}destination(n,a,h){const f=h*yh;return this.offset(n,Math.sin(f)*a,Math.cos(f)*a)}offset(n,a,h){return[n[0]+a/this.kx,n[1]+h/this.ky]}lineDistance(n){let a=0;for(let h=0;h<n.length-1;h++)a+=this.distance(n[h],n[h+1]);return a}area(n){let a=0;for(let h=0;h<n.length;h++){const f=n[h];for(let _=0,y=f.length,b=y-1;_<y;b=_++)a+=Us(f[_][0]-f[b][0])*(f[_][1]+f[b][1])*(h?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(n,a){let h=0;if(a<=0)return n[0];for(let f=0;f<n.length-1;f++){const _=n[f],y=n[f+1],b=this.distance(_,y);if(h+=b,h>a)return Pm(_,y,(a-(h-b))/b)}return n[n.length-1]}pointToSegmentDistance(n,a,h){let[f,_]=a,y=Us(h[0]-f)*this.kx,b=(h[1]-_)*this.ky;if(y!==0||b!==0){const E=(Us(n[0]-f)*this.kx*y+(n[1]-_)*this.ky*b)/(y*y+b*b);E>1?(f=h[0],_=h[1]):E>0&&(f+=y/this.kx*E,_+=b/this.ky*E)}return y=Us(n[0]-f)*this.kx,b=(n[1]-_)*this.ky,Math.sqrt(y*y+b*b)}pointOnLine(n,a){let h=1/0,f=n[0][0],_=n[0][1],y=0,b=0;for(let E=0;E<n.length-1;E++){let A=n[E][0],M=n[E][1],k=Us(n[E+1][0]-A)*this.kx,D=(n[E+1][1]-M)*this.ky,B=0;k===0&&D===0||(B=(Us(a[0]-A)*this.kx*k+(a[1]-M)*this.ky*D)/(k*k+D*D),B>1?(A=n[E+1][0],M=n[E+1][1]):B>0&&(A+=k/this.kx*B,M+=D/this.ky*B)),k=Us(a[0]-A)*this.kx,D=(a[1]-M)*this.ky;const U=k*k+D*D;U<h&&(h=U,f=A,_=M,y=E,b=B)}return{point:[f,_],index:y,t:Math.max(0,Math.min(1,b))}}lineSlice(n,a,h){let f=this.pointOnLine(h,n),_=this.pointOnLine(h,a);if(f.index>_.index||f.index===_.index&&f.t>_.t){const A=f;f=_,_=A}const y=[f.point],b=f.index+1,E=_.index;!Ky(h[b],y[0])&&b<=E&&y.push(h[b]);for(let A=b+1;A<=E;A++)y.push(h[A]);return Ky(h[E],_.point)||y.push(_.point),y}lineSliceAlong(n,a,h){let f=0;const _=[];for(let y=0;y<h.length-1;y++){const b=h[y],E=h[y+1],A=this.distance(b,E);if(f+=A,f>n&&_.length===0&&_.push(Pm(b,E,(n-(f-A))/A)),f>=a)return _.push(Pm(b,E,(a-(f-A))/A)),_;f>n&&_.push(E)}return _}bufferPoint(n,a){const h=a/this.ky,f=a/this.kx;return[n[0]-f,n[1]-h,n[0]+f,n[1]+h]}bufferBBox(n,a){const h=a/this.ky,f=a/this.kx;return[n[0]-f,n[1]-h,n[2]+f,n[3]+h]}insideBBox(n,a){return Us(n[0]-a[0])>=0&&Us(n[0]-a[2])<=0&&n[1]>=a[1]&&n[1]<=a[3]}}function Ky(l,n){return l[0]===n[0]&&l[1]===n[1]}function Pm(l,n,a){const h=Us(n[0]-l[0]);return[l[0]+h*a,l[1]+(n[1]-l[1])*a]}function Us(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}class Cm{constructor(n=[],a=(h,f)=>h<f?-1:h>f?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:h}=this,f=a[n];for(;n>0;){const _=n-1>>1,y=a[_];if(h(f,y)>=0)break;a[n]=y,n=_}a[n]=f}_down(n){const{data:a,compare:h}=this,f=this.length>>1,_=a[n];for(;n<f;){let y=1+(n<<1);const b=y+1;if(b<this.length&&h(a[b],a[y])<0&&(y=b),h(a[y],_)>=0)break;a[n]=a[y],n=y}a[n]=_}}var Nt=8192;function Yy(l,n){return n.dist-l.dist}const xh=100,bh=50;function Ef(l){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==l.length)return!1;for(let a=0;a<n.length;a++)if(n[a]!==l[a])return!1;return!0}function Af(l){return l[1]-l[0]+1}function Ja(l,n){const a=l[1]>=l[0]&&l[1]<n;return a||console.warn("Distance Expression: Index is out of range"),a}function Im(l,n){if(l[0]>l[1])return[null,null];const a=Af(l);if(n){if(a===2)return[l,null];const h=Math.floor(a/2);return[[l[0],l[0]+h],[l[0]+h,l[1]]]}{if(a===1)return[l,null];const h=Math.floor(a/2)-1;return[[l[0],l[0]+h],[l[0]+h+1,l[1]]]}}function aa(l,n){const a=[1/0,1/0,-1/0,-1/0];if(!Ja(n,l.length))return a;for(let h=n[0];h<=n[1];++h)xc(a,l[h]);return a}function Kr(l){const n=[1/0,1/0,-1/0,-1/0];for(let a=0;a<l.length;++a)for(let h=0;h<l[a].length;++h)xc(n,l[a][h]);return n}function wh(l,n,a){if(Ef(l)||Ef(n))return NaN;let h=0,f=0;return l[2]<n[0]&&(h=n[0]-l[2]),l[0]>n[2]&&(h=l[0]-n[2]),l[1]>n[3]&&(f=l[1]-n[3]),l[3]<n[1]&&(f=n[1]-l[3]),a.distance([0,0],[h,f])}function jA(l){return 360*l-180}function FA(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Om(l,n){const a=Math.pow(2,n.z),h=(l.y/Nt+n.y)/a;return[jA((l.x/Nt+n.x)/a),FA(h)]}function BA(l,n){const a=[];for(let h=0;h<l.length;++h)a.push(Om(l[h],n));return a}function li(l,n,a){const h=a.pointOnLine(n,l).point;return a.distance(l,h)}function ub(l,n,a,h,f){const _=a.slice(h[0],h[1]+1);let y=1/0;for(let b=n[0];b<=n[1];++b)if((y=Math.min(y,li(l[b],_,f)))===0)return 0;return y}function Jy(l,n,a,h,f){const _=Math.min(f.pointToSegmentDistance(l,a,h),f.pointToSegmentDistance(n,a,h)),y=Math.min(f.pointToSegmentDistance(a,l,n),f.pointToSegmentDistance(h,l,n));return Math.min(_,y)}function $A(l,n,a,h,f){if(!Ja(n,l.length)||!Ja(h,a.length))return NaN;let _=1/0;for(let y=n[0];y<n[1];++y)for(let b=h[0];b<h[1];++b){if(Em(l[y],l[y+1],a[b],a[b+1]))return 0;_=Math.min(_,Jy(l[y],l[y+1],a[b],a[b+1],f))}return _}function UA(l,n,a,h,f){if(!Ja(n,l.length)||!Ja(h,a.length))return NaN;let _=1/0;for(let y=n[0];y<=n[1];++y)for(let b=h[0];b<=h[1];++b)if((_=Math.min(_,f.distance(l[y],a[b])))===0)return _;return _}function VA(l,n,a){if(_h(l,n,!0))return 0;let h=1/0;for(const f of n){const _=f.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(f[0]!==f[_-1]&&(h=Math.min(h,a.pointToSegmentDistance(l,f[_-1],f[0])))===0||(h=Math.min(h,li(l,f,a)))===0)return h}return h}function GA(l,n,a,h){if(!Ja(n,l.length))return NaN;for(let _=n[0];_<=n[1];++_)if(_h(l[_],a,!0))return 0;let f=1/0;for(let _=n[0];_<n[1];++_)for(const y of a)for(let b=0,E=y.length,A=E-1;b<E;A=b++){if(Em(l[_],l[_+1],y[A],y[b]))return 0;f=Math.min(f,Jy(l[_],l[_+1],y[A],y[b],h))}return f}function hb(l,n){for(const a of l)for(let h=0;h<=a.length-1;++h)if(_h(a[h],n,!0))return!0;return!1}function HA(l,n,a,h=1/0){const f=Kr(l),_=Kr(n);if(h!==1/0&&wh(f,_,a)>=h)return h;if(gh(f,_)){if(hb(l,n))return 0}else if(hb(n,l))return 0;let y=h;for(const b of l)for(let E=0,A=b.length,M=A-1;E<A;M=E++)for(const k of n)for(let D=0,B=k.length,U=B-1;D<B;U=D++){if(Em(b[M],b[E],k[U],k[D]))return 0;y=Math.min(y,Jy(b[M],b[E],k[U],k[D],a))}return y}function Mm(l,n,a,h,f,_,y){if(_===null||y===null)return;const b=wh(aa(h,_),aa(f,y),a);b<n&&l.push({dist:b,range1:_,range2:y})}function WA(l,n,a,h,f=1/0){let _=Math.min(h.distance(l[0],a[0][0]),f);if(_===0)return _;const y=new Cm([{dist:0,range1:[0,l.length-1],range2:[0,0]}],Yy),b=n?bh:xh,E=Kr(a);for(;y.length;){const A=y.pop();if(A.dist>=_)continue;const M=A.range1;if(Af(M)<=b){if(!Ja(M,l.length))return NaN;if(n){const k=GA(l,M,a,h);if((_=Math.min(_,k))===0)return _}else for(let k=M[0];k<=M[1];++k){const D=VA(l[k],a,h);if((_=Math.min(_,D))===0)return _}}else{const k=Im(M,n);if(k[0]!==null){const D=wh(aa(l,k[0]),E,h);D<_&&y.push({dist:D,range1:k[0],range2:[0,0]})}if(k[1]!==null){const D=wh(aa(l,k[1]),E,h);D<_&&y.push({dist:D,range1:k[1],range2:[0,0]})}}}return _}function db(l,n,a,h,f,_=1/0){let y=Math.min(_,f.distance(l[0],a[0]));if(y===0)return y;const b=new Cm([{dist:0,range1:[0,l.length-1],range2:[0,a.length-1]}],Yy),E=n?bh:xh,A=h?bh:xh;for(;b.length;){const M=b.pop();if(M.dist>=y)continue;const k=M.range1,D=M.range2;if(Af(k)<=E&&Af(D)<=A){if(!Ja(k,l.length)||!Ja(D,a.length))return NaN;if(n&&h?y=Math.min(y,$A(l,k,a,D,f)):n||h?n&&!h?y=Math.min(y,ub(a,D,l,k,f)):!n&&h&&(y=Math.min(y,ub(l,k,a,D,f))):y=Math.min(y,UA(l,k,a,D,f)),y===0)return y}else{const B=Im(k,n),U=Im(D,h);Mm(b,y,f,l,a,B[0],U[0]),Mm(b,y,f,l,a,B[0],U[1]),Mm(b,y,f,l,a,B[1],U[0]),Mm(b,y,f,l,a,B[1],U[1])}}return y}function Qy(l,n,a,h,f=1/0){let _=f;const y=aa(l,[0,l.length-1]);for(const b of a)if(!(_!==1/0&&wh(y,aa(b,[0,b.length-1]),h)>=_)&&(_=Math.min(_,db(l,n,b,!0,h,_)),_===0))return _;return _}function Rm(l,n,a,h,f=1/0){let _=f;const y=aa(l,[0,l.length-1]);for(const b of a){if(_!==1/0&&wh(y,Kr(b),h)>=_)continue;const E=WA(l,n,b,h,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}function ev(l){return l==="Point"||l==="MultiPoint"||l==="LineString"||l==="MultiLineString"||l==="Polygon"||l==="MultiPolygon"}class gu{constructor(n,a){this.type=rr,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if($r(n[1])){const h=n[1];if(h.type==="FeatureCollection"){for(let f=0;f<h.features.length;++f)if(ev(h.features[f].geometry.type))return new gu(h,h.features[f].geometry)}else if(h.type==="Feature"){if(ev(h.geometry.type))return new gu(h,h.geometry)}else if(ev(h.type))return new gu(h,h)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const a=n.geometry(),h=n.canonicalID();if(a!=null&&h!=null){if(n.geometryType()==="Point")return function(f,_,y){const b=[];for(const A of f)for(const M of A)b.push(Om(M,_));const E=new vh(b[0][1],"meters");return y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString"?db(b,!1,y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",E):y.type==="MultiLineString"?Qy(b,!1,y.coordinates,E):y.type==="Polygon"||y.type==="MultiPolygon"?Rm(b,!1,y.type==="Polygon"?[y.coordinates]:y.coordinates,E):null}(a,h,this.geometries);if(n.geometryType()==="LineString")return function(f,_,y){const b=[];for(const A of f){const M=[];for(const k of A)M.push(Om(k,_));b.push(M)}const E=new vh(b[0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Qy(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,E);if(y.type==="MultiLineString"){let A=1/0;for(let M=0;M<y.coordinates.length;M++){const k=Qy(y.coordinates[M],!0,b,E,A);if(isNaN(k))return k;if((A=Math.min(A,k))===0)return A}return A}if(y.type==="Polygon"||y.type==="MultiPolygon"){let A=1/0;for(let M=0;M<b.length;M++){const k=Rm(b[M],!0,y.type==="Polygon"?[y.coordinates]:y.coordinates,E,A);if(isNaN(k))return k;if((A=Math.min(A,k))===0)return A}return A}return null}(a,h,this.geometries);if(n.geometryType()==="Polygon")return function(f,_,y){const b=[];for(const A of function(M,k){const D=M.length;if(D<=1)return[M];const B=[];let U,K;for(let te=0;te<D;te++){const oe=LA(M[te]);oe!==0&&(M[te].area=Math.abs(oe),K===void 0&&(K=oe<0),K===oe<0?(U&&B.push(U),U=[M[te]]):U.push(M[te]))}return U&&B.push(U),B}(f)){const M=[];for(let k=0;k<A.length;++k)M.push(BA(A[k],_));b.push(M)}const E=new vh(b[0][0][0][1],"meters");if(y.type==="Point"||y.type==="MultiPoint"||y.type==="LineString")return Rm(y.type==="Point"?[y.coordinates]:y.coordinates,y.type==="LineString",b,E);if(y.type==="MultiLineString"){let A=1/0;for(let M=0;M<y.coordinates.length;M++){const k=Rm(y.coordinates[M],!0,b,E,A);if(isNaN(k))return k;if((A=Math.min(A,k))===0)return A}return A}return y.type==="Polygon"||y.type==="MultiPolygon"?function(A,M,k){let D=1/0;for(const B of A)for(const U of M){const K=HA(B,U,k,D);if(isNaN(K))return K;if((D=Math.min(D,K))===0)return D}return D}(y.type==="Polygon"?[y.coordinates]:y.coordinates,b,E):null}(a,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Sh(l){if(l instanceof mo&&(l.name==="get"&&l.args.length===1||l.name==="feature-state"||l.name==="has"&&l.args.length===1||l.name==="properties"||l.name==="geometry-type"||l.name==="id"||/^filter-/.test(l.name))||l instanceof Fo||l instanceof gu)return!1;if(l instanceof Eh)return l.featureConstant;let n=!0;return l.eachChild(a=>{n&&!Sh(a)&&(n=!1)}),n}function km(l){if(l instanceof mo&&l.name==="feature-state")return!1;let n=!0;return l.eachChild(a=>{n&&!km(a)&&(n=!1)}),n}function Dm(l){if(l instanceof Eh)return new Set([l.key]);let n=new Set;return l.eachChild(a=>{n=new Set([...n,...Dm(a)])}),n}function Th(l,n){if(l instanceof mo&&n.indexOf(l.name)>=0)return!1;let a=!0;return l.eachChild(h=>{a&&!Th(h,n)&&(a=!1)}),a}function fb(l,n,a){return[l,n,a].filter(Boolean).join("")}function tv(l,n){switch(l){case"string":return oa(n);case"number":return+n;case"boolean":return!!n;case"color":return dn.parse(n);case"formatted":return Yo.fromString(oa(n));case"resolvedImage":return hs.build(oa(n))}return n}function pb(l,n,a,h){return h!==void 0&&(l=h*Math.round(l/h)),n!==void 0&&l<n&&(l=n),a!==void 0&&l>a&&(l=a),l}class Eh{constructor(n,a,h,f=!1){this.type=n,this.key=a,this.scope=h,this.featureConstant=f}static parse(n,a){let h=a.expectedType;if(h==null&&(h=fn),n.length<2||n.length>3)return a.error("Invalid number of arguments for 'config' expression.");const f=a.parse(n[1],1);if(!(f instanceof br))return a.error("Key name of 'config' expression must be a string literal.");let _,y=!0;const b=oa(f.value);if(n.length>=3){const E=a.parse(n[2],2);if(!(E instanceof br))return a.error("Scope of 'config' expression must be a string literal.");_=oa(E.value)}if(a.options){const E=fb(b,_,a._scope),A=a.options.get(E);A&&(y=Sh(A.value||A.default))}return new Eh(h,b,_,y)}evaluate(n){const a=fb(this.key,this.scope,n.scope),h=n.getConfig(a);if(!h)return null;const{type:f,value:_,values:y,minValue:b,maxValue:E,stepValue:A}=h,M=h.default.evaluate(n);let k=M;if(_){const D=n.scope;n.scope=(D||"").split("").slice(1).join(""),k=_.evaluate(n),n.scope=D}return f&&(k=tv(f,k)),k===void 0||b===void 0&&E===void 0&&A===void 0||(typeof k=="number"?k=pb(k,b,E,A):Array.isArray(k)&&(k=k.map(D=>typeof D=="number"?pb(D,b,E,A):D))),_!==void 0&&k!==void 0&&y&&!y.includes(k)&&(k=M,f&&(k=tv(f,k))),(f&&f!==this.type||k!==void 0&&!Sm(Gt(k),this.type))&&(k=tv(this.type.kind,k)),k}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.scope),n}}class Lm{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=n[1];return a.scope.has(h)?new Lm(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class zm{constructor(n,a=[],h,f=new Uy,_=[],y,b){this.registry=n,this.path=a,this.key=a.map(E=>typeof E=="string"?`['${E}']`:`[${E}]`).join(""),this.scope=f,this.errors=_,this.expectedType=h,this._scope=y,this.options=b}parse(n,a,h,f,_={}){return a||h?this.concat(a,null,h,f)._parse(n,_):this._parse(n,_)}parseObjectValue(n,a,h,f,_,y={}){return this.concat(a,h,f,_)._parse(n,y)}_parse(n,a){function h(f,_,y){return y==="assert"?new dr(_,[f]):y==="coerce"?new sa(_,[f]):f}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(f){let _=f.parse(n,this);if(!_)return null;if(this.expectedType){const y=this.expectedType,b=_.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||b.kind!=="value")if(y.kind!=="color"&&y.kind!=="formatted"&&y.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(y,b))return null}else _=h(_,y,a.typeAnnotation||"coerce");else _=h(_,y,a.typeAnnotation||"assert")}if(!(_ instanceof br)&&_.type.kind!=="resolvedImage"&&rv(_)){const y=new wf(this._scope,this.options);try{_=new br(_.type,_.evaluate(y))}catch(b){return this.error(b.message),null}}return _}return sa.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,h,f){let _=typeof n=="number"?this.path.concat(n):this.path;_=typeof a=="string"?_.concat(a):_;const y=f?this.scope.concat(f):this.scope;return new zm(this.registry,_,h||null,y,this.errors,this._scope,this.options)}error(n,...a){const h=`${this.key}${a.map(f=>`[${f}]`).join("")}`;this.errors.push(new $s(h,n))}checkSubtype(n,a){const h=fh(n,a);return h&&this.error(h),h}}function rv(l){if(l instanceof Lm)return rv(l.boundExpression);if(l instanceof mo&&l.name==="error"||l instanceof Ya||l instanceof Fo||l instanceof gu||l instanceof Eh)return!1;const n=l instanceof sa||l instanceof dr;let a=!0;return l.eachChild(h=>{a=n?a&&rv(h):a&&h instanceof br}),!!a&&Sh(l)&&Th(l,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Nm(l,n){const a=l.length-1;let h,f,_=0,y=a,b=0;for(;_<=y;)if(b=Math.floor((_+y)/2),h=l[b],f=l[b+1],h<=n){if(b===a||n<f)return b;_=b+1}else{if(!(h>n))throw new Bi("Input is not a number.");y=b-1}return 0}class Pf{constructor(n,a,h){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[f,_]of h)this.labels.push(f),this.outputs.push(_)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(n[1],1,rr);if(!h)return null;const f=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let y=1;y<n.length;y+=2){const b=y===1?-1/0:n[y],E=n[y+1],A=y,M=y+1;if(typeof b!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(f.length&&f[f.length-1][0]>=b)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const k=a.parse(E,M,_);if(!k)return null;_=_||k.type,f.push([b,k])}return new Pf(_,h,f)}evaluate(n){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(n);const f=this.input.evaluate(n);if(f<=a[0])return h[0].evaluate(n);const _=a.length;return f>=a[_-1]?h[_-1].evaluate(n):h[Nm(a,f)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&n.push(this.labels[a]),n.push(this.outputs[a].serialize());return n}}const mb=.95047,gb=1.08883,_b=4/29,bc=6/29,yb=3*bc*bc,vb=bc*bc*bc,qA=Math.PI/180,ZA=180/Math.PI;function nv(l){return l>vb?Math.pow(l,1/3):l/yb+_b}function jm(l){return l>bc?l*l*l:yb*(l-_b)}function Fm(l){return 255*(l<=.0031308?12.92*l:1.055*Math.pow(l,1/2.4)-.055)}function wc(l){return(l/=255)<=.04045?l/12.92:Math.pow((l+.055)/1.055,2.4)}function iv(l){const n=wc(l.r),a=wc(l.g),h=wc(l.b),f=nv((.4124564*n+.3575761*a+.1804375*h)/mb),_=nv((.2126729*n+.7151522*a+.072175*h)/1);return{l:116*_-16,a:500*(f-_),b:200*(_-nv((.0193339*n+.119192*a+.9503041*h)/gb)),alpha:l.a}}function ov(l){let n=(l.l+16)/116,a=isNaN(l.a)?n:n+l.a/500,h=isNaN(l.b)?n:n-l.b/200;return n=1*jm(n),a=mb*jm(a),h=gb*jm(h),new dn(Fm(3.2404542*a-1.5371385*n-.4985314*h),Fm(-.969266*a+1.8760108*n+.041556*h),Fm(.0556434*a-.2040259*n+1.0572252*h),l.alpha)}function XA(l,n,a){const h=n-l;return l+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const _u={forward:iv,reverse:ov,interpolate:function(l,n,a){return{l:pr(l.l,n.l,a),a:pr(l.a,n.a,a),b:pr(l.b,n.b,a),alpha:pr(l.alpha,n.alpha,a)}}},yu={forward:function(l){const{l:n,a,b:h}=iv(l),f=Math.atan2(h,a)*ZA;return{h:f<0?f+360:f,c:Math.sqrt(a*a+h*h),l:n,alpha:l.a}},reverse:function(l){const n=l.h*qA,a=l.c;return ov({l:l.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:l.alpha})},interpolate:function(l,n,a){return{h:XA(l.h,n.h,a),c:pr(l.c,n.c,a),l:pr(l.l,n.l,a),alpha:pr(l.alpha,n.alpha,a)}}};var xb=Object.freeze({__proto__:null,hcl:yu,lab:_u});class Vs{constructor(n,a,h,f,_){this.type=n,this.operator=a,this.interpolation=h,this.input=f,this.labels=[],this.outputs=[];for(const[y,b]of _)this.labels.push(y),this.outputs.push(b)}static interpolationFactor(n,a,h,f){let _=0;if(n.name==="exponential")_=Bm(a,n.base,h,f);else if(n.name==="linear")_=Bm(a,1,h,f);else if(n.name==="cubic-bezier"){const y=n.controlPoints;_=new Sl(y[0],y[1],y[2],y[3]).solve(Bm(a,1,h,f))}return _}static parse(n,a){let[h,f,_,...y]=n;if(!Array.isArray(f)||f.length===0)return a.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const A=f[1];if(typeof A!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:A}}else{if(f[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const A=f.slice(1);if(A.length!==4||A.some(M=>typeof M!="number"||M<0||M>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:A}}}if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,rr),!_)return null;const b=[];let E=null;h==="interpolate-hcl"||h==="interpolate-lab"?E=ws:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType);for(let A=0;A<y.length;A+=2){const M=y[A],k=y[A+1],D=A+3,B=A+4;if(typeof M!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(b.length&&b[b.length-1][0]>=M)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const U=a.parse(k,B,E);if(!U)return null;E=E||U.type,b.push([M,U])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new Vs(E,h,f,_,b):a.error(`Type ${Gi(E)} is not interpolatable.`)}evaluate(n){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(n);const f=this.input.evaluate(n);if(f<=a[0])return h[0].evaluate(n);const _=a.length;if(f>=a[_-1])return h[_-1].evaluate(n);const y=Nm(a,f),b=Vs.interpolationFactor(this.interpolation,f,a[y],a[y+1]),E=h[y].evaluate(n),A=h[y+1].evaluate(n);return this.operator==="interpolate"?gf[this.type.kind.toLowerCase()](E,A,b):this.operator==="interpolate-hcl"?yu.reverse(yu.interpolate(yu.forward(E),yu.forward(A),b)):_u.reverse(_u.interpolate(_u.forward(E),_u.forward(A),b))}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,n,this.input.serialize()];for(let h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a}}function Bm(l,n,a,h){const f=h-a,_=l-a;return f===0?0:n===1?_/f:(Math.pow(n,_)-1)/(Math.pow(n,f)-1)}class Cf{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expectected at least one argument.");let h=null;const f=a.expectedType;f&&f.kind!=="value"&&(h=f);const _=[];for(const b of n.slice(1)){const E=a.parse(b,1+_.length,h,void 0,{typeAnnotation:"omit"});if(!E)return null;h=h||E.type,_.push(E)}const y=f&&_.some(b=>fh(f,b.type));return new Cf(y?fn:h,_)}evaluate(n){let a,h=null,f=0;for(const _ of this.args){if(f++,h=_.evaluate(n),h&&h instanceof hs&&!h.available&&(a||(a=h),h=null,f===this.args.length))return a;if(h!==null)break}return h}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class $m{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const h=[];for(let _=1;_<n.length-1;_+=2){const y=n[_];if(typeof y!="string")return a.error(`Expected string, but found ${typeof y} instead.`,_);if(/[^a-zA-Z0-9_]/.test(y))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const b=a.parse(n[_+1],_+1);if(!b)return null;h.push([y,b])}const f=a.parse(n[n.length-1],n.length-1,a.expectedType,h);return f?new $m(h,f):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[a,h]of this.bindings)n.push(a,h.serialize());return n.push(this.result.serialize()),n}}class sv{constructor(n,a,h){this.type=n,this.index=a,this.input=h}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,rr),f=a.parse(n[2],2,Ko(a.expectedType||fn));return h&&f?new sv(f.type.itemType,h,f):null}evaluate(n){const a=this.index.evaluate(n),h=this.input.evaluate(n);if(a<0)throw new Bi(`Array index out of bounds: ${a} < 0.`);if(a>=h.length)throw new Bi(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a!==Math.floor(a))throw new Bi(`Array index must be an integer, but found ${a} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return h[a]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class av{constructor(n,a,h){this.type=n,this.index=a,this.input=h}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,rr),f=a.parse(n[2],2,Ko(a.expectedType||fn));return h&&f?new av(f.type.itemType,h,f):null}evaluate(n){const a=this.index.evaluate(n),h=this.input.evaluate(n);if(a<0)throw new Bi(`Array index out of bounds: ${a} < 0.`);if(a>h.length-1)throw new Bi(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a===Math.floor(a))return h[a];const f=Math.floor(a),_=Math.ceil(a),y=h[f],b=h[_];if(typeof y!="number"||typeof b!="number")throw new Bi(`Cannot interpolate between non-number values at index ${a}.`);const E=a-f;return y*(1-E)+b*E}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Um{constructor(n,a){this.type=ln,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,fn),f=a.parse(n[2],2,fn);return h&&f?yc(h.type,[ln,xn,rr,dh,fn])?new Um(h,f):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(h.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(h==null)return!1;if(!vf(a,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(Gt(a))} instead.`);if(!vf(h,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${Gi(Gt(h))} instead.`);return h.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class If{constructor(n,a,h){this.type=rr,this.needle=n,this.haystack=a,this.fromIndex=h}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,fn),f=a.parse(n[2],2,fn);if(!h||!f)return null;if(!yc(h.type,[ln,xn,rr,dh,fn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(h.type)} instead`);if(n.length===4){const _=a.parse(n[3],3,rr);return _?new If(h,f,_):null}return new If(h,f)}evaluate(n){const a=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(!vf(a,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${Gi(Gt(a))} instead.`);if(!vf(h,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${Gi(Gt(h))} instead.`);if(this.fromIndex){const f=this.fromIndex.evaluate(n);return h.indexOf(a,f)}return h.indexOf(a)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ah{constructor(n,a,h,f,_,y){this.inputType=n,this.type=a,this.input=h,this.cases=f,this.outputs=_,this.otherwise=y}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let h,f;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);const _={},y=[];for(let A=2;A<n.length-1;A+=2){let M=n[A];const k=n[A+1];Array.isArray(M)||(M=[M]);const D=a.concat(A);if(M.length===0)return D.error("Expected at least one branch label.");for(const U of M){if(typeof U!="number"&&typeof U!="string")return D.error("Branch labels must be numbers or strings.");if(typeof U=="number"&&Math.abs(U)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof U=="number"&&Math.floor(U)!==U)return D.error("Numeric branch labels must be integer values.");if(h){if(D.checkSubtype(h,Gt(U)))return null}else h=Gt(U);if(_[String(U)]!==void 0)return D.error("Branch labels must be unique.");_[String(U)]=y.length}const B=a.parse(k,A,f);if(!B)return null;f=f||B.type,y.push(B)}const b=a.parse(n[1],1,fn);if(!b)return null;const E=a.parse(n[n.length-1],n.length-1,f);return E?b.type.kind!=="value"&&a.concat(1).checkSubtype(h,b.type)?null:new Ah(h,f,b,_,y,E):null}evaluate(n){const a=this.input.evaluate(n);return(Sm(Gt(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),h=[],f={};for(const y of a){const b=f[this.cases[y]];b===void 0?(f[this.cases[y]]=h.length,h.push([this.cases[y],[y]])):h[b][1].push(y)}const _=y=>this.inputType.kind==="number"?Number(y):y;for(const[y,b]of h)n.push(b.length===1?_(b[0]):b.map(_)),n.push(this.outputs[y].serialize());return n.push(this.otherwise.serialize()),n}}class lv{constructor(n,a,h){this.type=n,this.branches=a,this.otherwise=h}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const f=[];for(let y=1;y<n.length-1;y+=2){const b=a.parse(n[y],y,ln);if(!b)return null;const E=a.parse(n[y+1],y+1,h);if(!E)return null;f.push([b,E]),h=h||E.type}const _=a.parse(n[n.length-1],n.length-1,h);return _?new lv(h,f,_):null}evaluate(n){for(const[a,h]of this.branches)if(a.evaluate(n))return h.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,h]of this.branches)n(a),n(h);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class Of{constructor(n,a,h,f){this.type=n,this.input=a,this.beginIndex=h,this.endIndex=f}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,fn),f=a.parse(n[2],2,rr);if(!h||!f)return null;if(!yc(h.type,[Ko(fn),xn,fn]))return a.error(`Expected first argument to be of type array or string, but found ${Gi(h.type)} instead`);if(n.length===4){const _=a.parse(n[3],3,rr);return _?new Of(h.type,h,f,_):null}return new Of(h.type,h,f)}evaluate(n){const a=this.input.evaluate(n),h=this.beginIndex.evaluate(n);if(!vf(a,["string","array"]))throw new Bi(`Expected first argument to be of type array or string, but found ${Gi(Gt(a))} instead.`);if(this.endIndex){const f=this.endIndex.evaluate(n);return a.slice(h,f)}return a.slice(h)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function bb(l,n){return l==="=="||l==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function wb(l,n,a,h){return h.compare(n,a)===0}function vu(l,n,a){const h=l!=="=="&&l!=="!=";return class aK{constructor(_,y,b){this.type=ln,this.lhs=_,this.rhs=y,this.collator=b,this.hasUntypedArgument=_.type.kind==="value"||y.type.kind==="value"}static parse(_,y){if(_.length!==3&&_.length!==4)return y.error("Expected two or three arguments.");const b=_[0];let E=y.parse(_[1],1,fn);if(!E)return null;if(!bb(b,E.type))return y.concat(1).error(`"${b}" comparisons are not supported for type '${Gi(E.type)}'.`);let A=y.parse(_[2],2,fn);if(!A)return null;if(!bb(b,A.type))return y.concat(2).error(`"${b}" comparisons are not supported for type '${Gi(A.type)}'.`);if(E.type.kind!==A.type.kind&&E.type.kind!=="value"&&A.type.kind!=="value")return y.error(`Cannot compare types '${Gi(E.type)}' and '${Gi(A.type)}'.`);h&&(E.type.kind==="value"&&A.type.kind!=="value"?E=new dr(A.type,[E]):E.type.kind!=="value"&&A.type.kind==="value"&&(A=new dr(E.type,[A])));let M=null;if(_.length===4){if(E.type.kind!=="string"&&A.type.kind!=="string"&&E.type.kind!=="value"&&A.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(M=y.parse(_[3],3,wm),!M)return null}return new aK(E,A,M)}evaluate(_){const y=this.lhs.evaluate(_),b=this.rhs.evaluate(_);if(h&&this.hasUntypedArgument){const E=Gt(y),A=Gt(b);if(E.kind!==A.kind||E.kind!=="string"&&E.kind!=="number")throw new Bi(`Expected arguments for "${l}" to be (string, string) or (number, number), but found (${E.kind}, ${A.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const E=Gt(y),A=Gt(b);if(E.kind!=="string"||A.kind!=="string")return n(_,y,b)}return this.collator?a(_,y,b,this.collator.evaluate(_)):n(_,y,b)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[l];return this.eachChild(y=>{_.push(y.serialize())}),_}}}const Sb=vu("==",function(l,n,a){return n===a},wb),KA=vu("!=",function(l,n,a){return n!==a},function(l,n,a,h){return!wb(0,n,a,h)}),YA=vu("<",function(l,n,a){return n<a},function(l,n,a,h){return h.compare(n,a)<0}),JA=vu(">",function(l,n,a){return n>a},function(l,n,a,h){return h.compare(n,a)>0}),Vm=vu("<=",function(l,n,a){return n<=a},function(l,n,a,h){return h.compare(n,a)<=0}),QA=vu(">=",function(l,n,a){return n>=a},function(l,n,a,h){return h.compare(n,a)>=0});class Gm{constructor(n,a,h,f,_,y){this.type=xn,this.number=n,this.locale=a,this.currency=h,this.unit=f,this.minFractionDigits=_,this.maxFractionDigits=y}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const h=a.parse(n[1],1,rr);if(!h)return null;const f=n[2];if(typeof f!="object"||Array.isArray(f))return a.error("NumberFormat options argument must be an object.");let _=null;if(f.locale&&(_=a.parseObjectValue(f.locale,2,"locale",xn),!_))return null;let y=null;if(f.currency&&(y=a.parseObjectValue(f.currency,2,"currency",xn),!y))return null;let b=null;if(f.unit&&(b=a.parseObjectValue(f.unit,2,"unit",xn),!b))return null;let E=null;if(f["min-fraction-digits"]&&(E=a.parseObjectValue(f["min-fraction-digits"],2,"min-fraction-digits",rr),!E))return null;let A=null;return f["max-fraction-digits"]&&(A=a.parseObjectValue(f["max-fraction-digits"],2,"max-fraction-digits",rr),!A)?null:new Gm(h,_,y,b,E,A)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class cv{constructor(n){this.type=rr,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const h=a.parse(n[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Gi(h.type)} instead.`):new cv(h):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string"||Array.isArray(a))return a.length;throw new Bi(`Expected value to be of type string or array, but found ${Gi(Gt(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(a=>{n.push(a.serialize())}),n}}function Tb(l){return function(){l=1831565813+(l|=0)|0;let n=Math.imul(l^l>>>15,1|l);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const xu={"==":Sb,"!=":KA,">":JA,"<":YA,">=":QA,"<=":Vm,array:dr,at:sv,"at-interpolated":av,boolean:dr,case:lv,coalesce:Cf,collator:Ya,format:ph,image:mh,in:Um,"index-of":If,interpolate:Vs,"interpolate-hcl":Vs,"interpolate-lab":Vs,length:cv,let:$m,literal:br,match:Ah,number:dr,"number-format":Gm,object:dr,slice:Of,step:Pf,string:dr,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:Lm,within:Fo,distance:gu,config:Eh};function uv(l,[n,a,h,f]){n=n.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const _=f?f.evaluate(l):1,y=fu(n,a,h,_);if(y)throw new Bi(y);return new dn(n/255,a/255,h/255,_)}function hv(l,[n,a,h,f]){n=n.evaluate(l),a=a.evaluate(l),h=h.evaluate(l);const _=f?f.evaluate(l):1,y=function(A,M,k,D){return typeof A=="number"&&A>=0&&A<=360?typeof M=="number"&&M>=0&&M<=100&&typeof k=="number"&&k>=0&&k<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[A,M,k,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[A,M,k,D]:[A,M,k]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[A,M,k,D]:[A,M,k]).join(", ")}]: 'h' must be between 0 and 360.`}(n,a,h,_);if(y)throw new Bi(y);const b=`hsla(${n}, ${a}%, ${h}%, ${_})`,E=dn.parse(b);if(!E)throw new Bi(`Failed to parse HSLA color: ${b}`);return E}function Eb(l,n){return l in n}function Sc(l,n){const a=n[l];return a===void 0?null:a}function bu(l){return{type:l}}function Ab(l){return{result:"success",value:l}}function Tc(l){return{result:"error",value:l}}function Hm(l,n){return!!l&&!!l.parameters&&l.parameters.indexOf(n)>-1}function Mf(l){return l["property-type"]==="data-driven"}function dv(l){return Hm(l.expression,"measure-light")}function fv(l){return Hm(l.expression,"zoom")}function Rf(l){return!!l.expression&&l.expression.interpolated}function kf(l){return typeof l=="object"&&l!==null&&!Array.isArray(l)}function Pb(l){return l}function Cb(l,n){const a=n.type==="color",h=l.stops&&typeof l.stops[0][0]=="object",f=h||!(h||l.property!==void 0),_=l.type||(Rf(n)?"exponential":"interval");if(a&&((l=du({},l)).stops&&(l.stops=l.stops.map(A=>[A[0],dn.parse(A[1])])),l.default=dn.parse(l.default?l.default:n.default)),l.colorSpace&&l.colorSpace!=="rgb"&&!xb[l.colorSpace])throw new Error(`Unknown color space: ${l.colorSpace}`);let y,b,E;if(_==="exponential")y=pv;else if(_==="interval")y=tP;else if(_==="categorical"){y=eP,b=Object.create(null);for(const A of l.stops)b[A[0]]=A[1];E=typeof l.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);y=rP}if(h){const A={},M=[];for(let B=0;B<l.stops.length;B++){const U=l.stops[B],K=U[0].zoom;A[K]===void 0&&(A[K]={zoom:K,type:l.type,property:l.property,default:l.default,stops:[]},M.push(K)),A[K].stops.push([U[0].value,U[1]])}const k=[];for(const B of M)k.push([A[B].zoom,Cb(A[B],n)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Vs.interpolationFactor.bind(void 0,D),zoomStops:k.map(B=>B[0]),evaluate:({zoom:B},U)=>pv({stops:k,base:l.base},n,B).evaluate(B,U)}}if(f){const A=_==="exponential"?{name:"exponential",base:l.base!==void 0?l.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Vs.interpolationFactor.bind(void 0,A),zoomStops:l.stops.map(M=>M[0]),evaluate:({zoom:M})=>y(l,n,M,b,E)}}return{kind:"source",evaluate(A,M){const k=M&&M.properties?M.properties[l.property]:void 0;return k===void 0?la(l.default,n.default):y(l,n,k,b,E)}}}function la(l,n,a){return l!==void 0?l:n!==void 0?n:a!==void 0?a:void 0}function eP(l,n,a,h,f){return la(typeof a===f?h[a]:void 0,l.default,n.default)}function tP(l,n,a){if(vc(a)!=="number")return la(l.default,n.default);const h=l.stops.length;if(h===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[h-1][0])return l.stops[h-1][1];const f=Nm(l.stops.map(_=>_[0]),a);return l.stops[f][1]}function pv(l,n,a){const h=l.base!==void 0?l.base:1;if(vc(a)!=="number")return la(l.default,n.default);const f=l.stops.length;if(f===1||a<=l.stops[0][0])return l.stops[0][1];if(a>=l.stops[f-1][0])return l.stops[f-1][1];const _=Nm(l.stops.map(M=>M[0]),a),y=function(M,k,D,B){const U=B-D,K=M-D;return U===0?0:k===1?K/U:(Math.pow(k,K)-1)/(Math.pow(k,U)-1)}(a,h,l.stops[_][0],l.stops[_+1][0]),b=l.stops[_][1],E=l.stops[_+1][1];let A=gf[n.type]||Pb;if(l.colorSpace&&l.colorSpace!=="rgb"){const M=xb[l.colorSpace];A=(k,D)=>M.reverse(M.interpolate(M.forward(k),M.forward(D),y))}return typeof b.evaluate=="function"?{evaluate(...M){const k=b.evaluate.apply(void 0,M),D=E.evaluate.apply(void 0,M);if(k!==void 0&&D!==void 0)return A(k,D,y)}}:A(b,E,y)}function rP(l,n,a){return n.type==="color"?a=dn.parse(a):n.type==="formatted"?a=Yo.fromString(a.toString()):n.type==="resolvedImage"?a=hs.build(a.toString()):vc(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),la(a,l.default,n.default)}mo.register(xu,{error:[{kind:"error"},[xn],(l,[n])=>{throw new Bi(n.evaluate(l))}],typeof:[xn,[fn],(l,[n])=>Gi(Gt(n.evaluate(l)))],"to-rgba":[Ko(rr,4),[ws],(l,[n])=>n.evaluate(l).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ko(rr,4),[ws],(l,[n])=>n.evaluate(l).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ws,[rr,rr,rr],uv],rgba:[ws,[rr,rr,rr,rr],uv],hsl:[ws,[rr,rr,rr],hv],hsla:[ws,[rr,rr,rr,rr],hv],has:{type:ln,overloads:[[[xn],(l,[n])=>Eb(n.evaluate(l),l.properties())],[[xn,Il],(l,[n,a])=>Eb(n.evaluate(l),a.evaluate(l))]]},get:{type:fn,overloads:[[[xn],(l,[n])=>Sc(n.evaluate(l),l.properties())],[[xn,Il],(l,[n,a])=>Sc(n.evaluate(l),a.evaluate(l))]]},"feature-state":[fn,[xn],(l,[n])=>Sc(n.evaluate(l),l.featureState||{})],properties:[Il,[],l=>l.properties()],"geometry-type":[xn,[],l=>l.geometryType()],worldview:[xn,[],l=>l.globals.worldview||""],id:[fn,[],l=>l.id()],zoom:[rr,[],l=>l.globals.zoom],pitch:[rr,[],l=>l.globals.pitch||0],"distance-from-center":[rr,[],l=>l.distanceFromCenter()],"measure-light":[rr,[xn],(l,[n])=>l.measureLight(n.evaluate(l))],"heatmap-density":[rr,[],l=>l.globals.heatmapDensity||0],"line-progress":[rr,[],l=>l.globals.lineProgress||0],"raster-value":[rr,[],l=>l.globals.rasterValue||0],"raster-particle-speed":[rr,[],l=>l.globals.rasterParticleSpeed||0],"sky-radial-progress":[rr,[],l=>l.globals.skyRadialProgress||0],accumulated:[fn,[],l=>l.globals.accumulated===void 0?null:l.globals.accumulated],"+":[rr,bu(rr),(l,n)=>{let a=0;for(const h of n)a+=h.evaluate(l);return a}],"*":[rr,bu(rr),(l,n)=>{let a=1;for(const h of n)a*=h.evaluate(l);return a}],"-":{type:rr,overloads:[[[rr,rr],(l,[n,a])=>n.evaluate(l)-a.evaluate(l)],[[rr],(l,[n])=>-n.evaluate(l)]]},"/":[rr,[rr,rr],(l,[n,a])=>n.evaluate(l)/a.evaluate(l)],"%":[rr,[rr,rr],(l,[n,a])=>n.evaluate(l)%a.evaluate(l)],ln2:[rr,[],()=>Math.LN2],pi:[rr,[],()=>Math.PI],e:[rr,[],()=>Math.E],"^":[rr,[rr,rr],(l,[n,a])=>Math.pow(n.evaluate(l),a.evaluate(l))],sqrt:[rr,[rr],(l,[n])=>Math.sqrt(n.evaluate(l))],log10:[rr,[rr],(l,[n])=>Math.log(n.evaluate(l))/Math.LN10],ln:[rr,[rr],(l,[n])=>Math.log(n.evaluate(l))],log2:[rr,[rr],(l,[n])=>Math.log(n.evaluate(l))/Math.LN2],sin:[rr,[rr],(l,[n])=>Math.sin(n.evaluate(l))],cos:[rr,[rr],(l,[n])=>Math.cos(n.evaluate(l))],tan:[rr,[rr],(l,[n])=>Math.tan(n.evaluate(l))],asin:[rr,[rr],(l,[n])=>Math.asin(n.evaluate(l))],acos:[rr,[rr],(l,[n])=>Math.acos(n.evaluate(l))],atan:[rr,[rr],(l,[n])=>Math.atan(n.evaluate(l))],min:[rr,bu(rr),(l,n)=>Math.min(...n.map(a=>a.evaluate(l)))],max:[rr,bu(rr),(l,n)=>Math.max(...n.map(a=>a.evaluate(l)))],abs:[rr,[rr],(l,[n])=>Math.abs(n.evaluate(l))],round:[rr,[rr],(l,[n])=>{const a=n.evaluate(l);return a<0?-Math.round(-a):Math.round(a)}],floor:[rr,[rr],(l,[n])=>Math.floor(n.evaluate(l))],ceil:[rr,[rr],(l,[n])=>Math.ceil(n.evaluate(l))],"filter-==":[ln,[xn,fn],(l,[n,a])=>l.properties()[n.value]===a.value],"filter-id-==":[ln,[fn],(l,[n])=>l.id()===n.value],"filter-type-==":[ln,[xn],(l,[n])=>l.geometryType()===n.value],"filter-<":[ln,[xn,fn],(l,[n,a])=>{const h=l.properties()[n.value],f=a.value;return typeof h==typeof f&&h<f}],"filter-id-<":[ln,[fn],(l,[n])=>{const a=l.id(),h=n.value;return typeof a==typeof h&&a<h}],"filter->":[ln,[xn,fn],(l,[n,a])=>{const h=l.properties()[n.value],f=a.value;return typeof h==typeof f&&h>f}],"filter-id->":[ln,[fn],(l,[n])=>{const a=l.id(),h=n.value;return typeof a==typeof h&&a>h}],"filter-<=":[ln,[xn,fn],(l,[n,a])=>{const h=l.properties()[n.value],f=a.value;return typeof h==typeof f&&h<=f}],"filter-id-<=":[ln,[fn],(l,[n])=>{const a=l.id(),h=n.value;return typeof a==typeof h&&a<=h}],"filter->=":[ln,[xn,fn],(l,[n,a])=>{const h=l.properties()[n.value],f=a.value;return typeof h==typeof f&&h>=f}],"filter-id->=":[ln,[fn],(l,[n])=>{const a=l.id(),h=n.value;return typeof a==typeof h&&a>=h}],"filter-has":[ln,[fn],(l,[n])=>n.value in l.properties()],"filter-has-id":[ln,[],l=>l.id()!==null&&l.id()!==void 0],"filter-type-in":[ln,[Ko(xn)],(l,[n])=>n.value.indexOf(l.geometryType())>=0],"filter-id-in":[ln,[Ko(fn)],(l,[n])=>n.value.indexOf(l.id())>=0],"filter-in-small":[ln,[xn,Ko(fn)],(l,[n,a])=>a.value.indexOf(l.properties()[n.value])>=0],"filter-in-large":[ln,[xn,Ko(fn)],(l,[n,a])=>function(h,f,_,y){for(;_<=y;){const b=_+y>>1;if(f[b]===h)return!0;f[b]>h?y=b-1:_=b+1}return!1}(l.properties()[n.value],a.value,0,a.value.length-1)],all:{type:ln,overloads:[[[ln,ln],(l,[n,a])=>n.evaluate(l)&&a.evaluate(l)],[bu(ln),(l,n)=>{for(const a of n)if(!a.evaluate(l))return!1;return!0}]]},any:{type:ln,overloads:[[[ln,ln],(l,[n,a])=>n.evaluate(l)||a.evaluate(l)],[bu(ln),(l,n)=>{for(const a of n)if(a.evaluate(l))return!0;return!1}]]},"!":[ln,[ln],(l,[n])=>!n.evaluate(l)],"is-supported-script":[ln,[xn],(l,[n])=>{const a=l.globals&&l.globals.isSupportedScript;return!a||a(n.evaluate(l))}],upcase:[xn,[xn],(l,[n])=>n.evaluate(l).toUpperCase()],downcase:[xn,[xn],(l,[n])=>n.evaluate(l).toLowerCase()],concat:[xn,bu(fn),(l,n)=>n.map(a=>oa(a.evaluate(l))).join("")],"resolved-locale":[xn,[wm],(l,[n])=>n.evaluate(l).resolvedLocale()],random:[rr,[rr,rr,fn],(l,n)=>{const[a,h,f]=n.map(y=>y.evaluate(l));if(a>h||a===h)return a;let _;if(typeof f=="string")_=function(y){let b=0;if(y.length===0)return b;for(let E=0;E<y.length;E++)b=(b<<5)-b+y.charCodeAt(E),b|=0;return b}(f);else{if(typeof f!="number")throw new Bi(`Invalid seed input: ${f}`);_=f}return a+Tb(_)()*(h-a)}]});class Ph{constructor(n,a,h,f){this.expression=n,this._warningHistory={},this._evaluator=new wf(h,f),this._defaultValue=a?function(_){return _.type==="color"&&(kf(_.default)||Array.isArray(_.default))?new dn(0,0,0,0):_.type==="color"?dn.parse(_.default)||null:_.default===void 0?null:_.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=Dm(n)}evaluateWithoutErrorHandling(n,a,h,f,_,y,b,E){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(n,a,h,f,_,y,b,E){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=f||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=E||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${A.message}`)),this._defaultValue}}}function Wm(l){return Array.isArray(l)&&l.length>0&&typeof l[0]=="string"&&l[0]in xu}function Rl(l,n,a,h){const f=new zm(xu,[],n?function(y){const b={color:ws,string:xn,number:rr,enum:xn,boolean:ln,formatted:_f,resolvedImage:yf};return y.type==="array"?Ko(b[y.value]||fn,y.length):b[y.type]}(n):void 0,void 0,void 0,a,h),_=f.parse(l,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?Ab(new Ph(_,n,a,h)):Tc(f.errors)}class Df{constructor(n,a,h,f){this.kind=n,this._styleExpression=a,this.isLightConstant=h,this.isLineProgressConstant=f,this.isStateDependent=n!=="constant"&&!km(a.expression),this.configDependencies=Dm(a.expression)}evaluateWithoutErrorHandling(n,a,h,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,h,f,_,y)}evaluate(n,a,h,f,_,y){return this._styleExpression.evaluate(n,a,h,f,_,y)}}class Lf{constructor(n,a,h,f,_,y){this.kind=n,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!km(a.expression),this.isLightConstant=_,this.isLineProgressConstant=y,this.configDependencies=Dm(a.expression),this.interpolationType=f}evaluateWithoutErrorHandling(n,a,h,f,_,y){return this._styleExpression.evaluateWithoutErrorHandling(n,a,h,f,_,y)}evaluate(n,a,h,f,_,y){return this._styleExpression.evaluate(n,a,h,f,_,y)}interpolationFactor(n,a,h){return this.interpolationType?Vs.interpolationFactor(this.interpolationType,n,a,h):0}}function Ib(l,n,a,h){if((l=Rl(l,n,a,h)).result==="error")return l;const f=l.value.expression,_=Sh(f);if(!_&&!Mf(n))return Tc([new $s("","data expressions not supported")]);const y=Th(f,["zoom","pitch","distance-from-center"]);if(!y&&!fv(n))return Tc([new $s("","zoom expressions not supported")]);const b=Th(f,["measure-light"]);if(!b&&!dv(n))return Tc([new $s("","measure-light expression not supported")]);const E=Th(f,["line-progress"]);if(!E&&!function(k){return Hm(k.expression,"line-progress")}(n))return Tc([new $s("","line-progress expression not supported")]);const A=n.expression&&n.expression.relaxZoomRestriction,M=Ih(f);return M||y||A?M instanceof $s?Tc([M]):M instanceof Vs&&!Rf(n)?Tc([new $s("",'"interpolate" expressions cannot be used with this property')]):Ab(M?new Lf(_&&E?"camera":"composite",l.value,M.labels,M instanceof Vs?M.interpolation:void 0,b,E):new Df(_&&E?"constant":"source",l.value,b,E)):Tc([new $s("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ch{constructor(n,a){this._parameters=n,this._specification=a,du(this,Cb(this._parameters,this._specification))}static deserialize(n){return new Ch(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Ih(l){let n=null;if(l instanceof $m)n=Ih(l.result);else if(l instanceof Cf){for(const a of l.args)if(n=Ih(a),n)break}else(l instanceof Pf||l instanceof Vs)&&l.input instanceof mo&&l.input.name==="zoom"&&(n=l);return n instanceof $s||l.eachChild(a=>{const h=Ih(a);h instanceof $s?n=h:n&&h&&n!==h&&(n=new $s("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var qm,mv,gv=function(){if(mv)return qm;mv=1,qm=n;var l=3;function n(a,h,f){var _=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var y=new Int32Array(this.arrayBuffer);a=y[0],this.d=(h=y[1])+2*(f=y[2]);for(var b=0;b<this.d*this.d;b++){var E=y[l+b],A=y[l+b+1];_.push(E===A?null:y.subarray(E,A))}var M=y[l+_.length+1];this.keys=y.subarray(y[l+_.length],M),this.bboxes=y.subarray(M),this.insert=this._insertReadonly}else{this.d=h+2*f;for(var k=0;k<this.d*this.d;k++)_.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=f,this.scale=h/a,this.uid=0;var D=f/h*a;this.min=-D,this.max=a+D}return n.prototype.insert=function(a,h,f,_,y){this._forEachCell(h,f,_,y,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(_),this.bboxes.push(y)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(a,h,f,_,y,b){this.cells[y].push(b)},n.prototype.query=function(a,h,f,_,y){var b=this.min,E=this.max;if(a<=b&&h<=b&&E<=f&&E<=_&&!y)return Array.prototype.slice.call(this.keys);var A=[];return this._forEachCell(a,h,f,_,this._queryCell,A,{},y),A},n.prototype._queryCell=function(a,h,f,_,y,b,E,A){var M=this.cells[y];if(M!==null)for(var k=this.keys,D=this.bboxes,B=0;B<M.length;B++){var U=M[B];if(E[U]===void 0){var K=4*U;(A?A(D[K+0],D[K+1],D[K+2],D[K+3]):a<=D[K+2]&&h<=D[K+3]&&f>=D[K+0]&&_>=D[K+1])?(E[U]=!0,b.push(k[U])):E[U]=!1}}},n.prototype._forEachCell=function(a,h,f,_,y,b,E,A){for(var M=this._convertToCellCoord(a),k=this._convertToCellCoord(h),D=this._convertToCellCoord(f),B=this._convertToCellCoord(_),U=M;U<=D;U++)for(var K=k;K<=B;K++){var te=this.d*K+U;if((!A||A(this._convertFromCellCoord(U),this._convertFromCellCoord(K),this._convertFromCellCoord(U+1),this._convertFromCellCoord(K+1)))&&y.call(this,a,h,f,_,te,b,E,A))return}},n.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},n.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=l+this.cells.length+1+1,f=0,_=0;_<this.cells.length;_++)f+=this.cells[_].length;var y=new Int32Array(h+f+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=h,E=0;E<a.length;E++){var A=a[E];y[l+E]=b,y.set(A,b),b+=A.length}return y[l+a.length]=b,y.set(this.keys,b),y[l+a.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer},qm}(),kl=oi(gv);const Dl={};function Ht(l,n,a={}){Object.defineProperty(l,"_classRegistryKey",{value:n,writable:!1}),Dl[n]={klass:l,omit:a.omit||[]}}Ht(Object,"Object"),kl.serialize=function(l,n){const a=l.toArrayBuffer();return n&&n.add(a),{buffer:a}},kl.deserialize=function(l){return new kl(l.buffer)},Object.defineProperty(kl,"name",{value:"Grid"}),Ht(kl,"Grid"),typeof DOMMatrix<"u"&&Ht(DOMMatrix,"DOMMatrix"),Ht(dn,"Color"),Ht(Error,"Error"),Ht(Yo,"Formatted"),Ht(Tm,"FormattedSection"),Ht(tn,"AJAXError"),Ht(hs,"ResolvedImage"),Ht(Ch,"StylePropertyFunction"),Ht(Ph,"StyleExpression",{omit:["_evaluator"]}),Ht(bs,"ImageId"),Ht(Ol,"ImageVariant"),Ht(Lf,"ZoomDependentExpression"),Ht(Df,"ZoomConstantExpression"),Ht(mo,"CompoundExpression",{omit:["_evaluate"]});for(const l in xu)Dl[xu[l]._classRegistryKey]||Ht(xu[l],`Expression${l}`);function Ob(l){return l&&typeof ArrayBuffer<"u"&&(l instanceof ArrayBuffer||l.constructor&&l.constructor.name==="ArrayBuffer")}function Mb(l){return self.ImageBitmap&&l instanceof ImageBitmap}function Ec(l,n){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp)return l;if(Ob(l)||Mb(l))return n&&n.add(l),l;if(ArrayBuffer.isView(l))return n&&n.add(l.buffer),l;if(l instanceof ImageData)return n&&n.add(l.data.buffer),l;if(Array.isArray(l)){const a=[];for(const h of l)a.push(Ec(h,n));return a}if(l instanceof Map){const a={$name:"Map",entries:[]};for(const[h,f]of l.entries())a.entries.push(Ec(h),Ec(f,n));return a}if(l instanceof Set){const a={$name:"Set"};let h=0;for(const f of l.values())a[++h]=Ec(f);return a}if(l instanceof DOMMatrix){const a={$name:"DOMMatrix"},h=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const f of h)a[f]=l[f];return a}if(typeof l=="bigint")return{$name:"BigInt",value:l.toString()};if(typeof l=="object"){const a=l.constructor,h=a._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const f=a.serialize?a.serialize(l,n):{};if(!a.serialize){for(const _ in l)l.hasOwnProperty(_)&&(Dl[h].omit.indexOf(_)>=0||(f[_]=Ec(l[_],n)));l instanceof Error&&(f.message=l.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(f.$name=h),f}throw new Error("can't serialize object of type "+typeof l)}function Ac(l){if(l==null||typeof l=="boolean"||typeof l=="number"||typeof l=="string"||l instanceof Boolean||l instanceof Number||l instanceof String||l instanceof Date||l instanceof RegExp||Ob(l)||Mb(l)||ArrayBuffer.isView(l)||l instanceof ImageData)return l;if(Array.isArray(l))return l.map(Ac);if(typeof l=="object"){const n=l.$name||"Object";if(n==="Map"){const f=l.entries||[],_=new Map;for(let y=0;y<f.length;y+=2)_.set(Ac(f[y]),Ac(f[y+1]));return _}if(n==="Set"){const f=new Set;for(const _ of Object.keys(l))_!=="$name"&&f.add(Ac(l[_]));return f}if(n==="DOMMatrix"){let f;return f=l.is2D?[l.a,l.b,l.c,l.d,l.e,l.f]:[l.m11,l.m12,l.m13,l.m14,l.m21,l.m22,l.m23,l.m24,l.m31,l.m32,l.m33,l.m34,l.m41,l.m42,l.m43,l.m44],new DOMMatrix(f)}if(n==="BigInt")return BigInt(l.value);const{klass:a}=Dl[n];if(!a)throw new Error(`Can't deserialize unregistered class "${n}".`);if(a.deserialize)return a.deserialize(l);const h=Object.create(a.prototype);for(const f of Object.keys(l))f!=="$name"&&(h[f]=Ac(l[f]));return h}throw new Error("can't deserialize object of type "+typeof l)}const cr={"Latin-1 Supplement":l=>l>=128&&l<=255,Arabic:l=>l>=1536&&l<=1791,"Arabic Supplement":l=>l>=1872&&l<=1919,"Arabic Extended-A":l=>l>=2208&&l<=2303,"Hangul Jamo":l=>l>=4352&&l<=4607,"Unified Canadian Aboriginal Syllabics":l=>l>=5120&&l<=5759,Khmer:l=>l>=6016&&l<=6143,"Unified Canadian Aboriginal Syllabics Extended":l=>l>=6320&&l<=6399,"General Punctuation":l=>l>=8192&&l<=8303,"Letterlike Symbols":l=>l>=8448&&l<=8527,"Number Forms":l=>l>=8528&&l<=8591,"Miscellaneous Technical":l=>l>=8960&&l<=9215,"Control Pictures":l=>l>=9216&&l<=9279,"Optical Character Recognition":l=>l>=9280&&l<=9311,"Enclosed Alphanumerics":l=>l>=9312&&l<=9471,"Geometric Shapes":l=>l>=9632&&l<=9727,"Miscellaneous Symbols":l=>l>=9728&&l<=9983,"Miscellaneous Symbols and Arrows":l=>l>=11008&&l<=11263,"CJK Radicals Supplement":l=>l>=11904&&l<=12031,"Kangxi Radicals":l=>l>=12032&&l<=12255,"Ideographic Description Characters":l=>l>=12272&&l<=12287,"CJK Symbols and Punctuation":l=>l>=12288&&l<=12351,Hiragana:l=>l>=12352&&l<=12447,Katakana:l=>l>=12448&&l<=12543,Bopomofo:l=>l>=12544&&l<=12591,"Hangul Compatibility Jamo":l=>l>=12592&&l<=12687,Kanbun:l=>l>=12688&&l<=12703,"Bopomofo Extended":l=>l>=12704&&l<=12735,"CJK Strokes":l=>l>=12736&&l<=12783,"Katakana Phonetic Extensions":l=>l>=12784&&l<=12799,"Enclosed CJK Letters and Months":l=>l>=12800&&l<=13055,"CJK Compatibility":l=>l>=13056&&l<=13311,"CJK Unified Ideographs Extension A":l=>l>=13312&&l<=19903,"Yijing Hexagram Symbols":l=>l>=19904&&l<=19967,"CJK Unified Ideographs":l=>l>=19968&&l<=40959,"Yi Syllables":l=>l>=40960&&l<=42127,"Yi Radicals":l=>l>=42128&&l<=42191,"Hangul Jamo Extended-A":l=>l>=43360&&l<=43391,"Hangul Syllables":l=>l>=44032&&l<=55215,"Hangul Jamo Extended-B":l=>l>=55216&&l<=55295,"Private Use Area":l=>l>=57344&&l<=63743,"CJK Compatibility Ideographs":l=>l>=63744&&l<=64255,"Arabic Presentation Forms-A":l=>l>=64336&&l<=65023,"Vertical Forms":l=>l>=65040&&l<=65055,"CJK Compatibility Forms":l=>l>=65072&&l<=65103,"Small Form Variants":l=>l>=65104&&l<=65135,"Arabic Presentation Forms-B":l=>l>=65136&&l<=65279,"Halfwidth and Fullwidth Forms":l=>l>=65280&&l<=65519,Osage:l=>l>=66736&&l<=66815,"CJK Unified Ideographs Extension B":l=>l>=131072&&l<=173791};function zf(l){for(const n of l)if(_v(n.charCodeAt(0)))return!0;return!1}function nP(l){for(const n of l)if(!iP(n.charCodeAt(0)))return!1;return!0}function iP(l){return!(cr.Arabic(l)||cr["Arabic Supplement"](l)||cr["Arabic Extended-A"](l)||cr["Arabic Presentation Forms-A"](l)||cr["Arabic Presentation Forms-B"](l))}function _v(l){return!(l!==746&&l!==747&&(l<4352||!(cr["Bopomofo Extended"](l)||cr.Bopomofo(l)||cr["CJK Compatibility Forms"](l)&&!(l>=65097&&l<=65103)||cr["CJK Compatibility Ideographs"](l)||cr["CJK Compatibility"](l)||cr["CJK Radicals Supplement"](l)||cr["CJK Strokes"](l)||!(!cr["CJK Symbols and Punctuation"](l)||l>=12296&&l<=12305||l>=12308&&l<=12319||l===12336)||cr["CJK Unified Ideographs Extension A"](l)||cr["CJK Unified Ideographs"](l)||cr["Enclosed CJK Letters and Months"](l)||cr["Hangul Compatibility Jamo"](l)||cr["Hangul Jamo Extended-A"](l)||cr["Hangul Jamo Extended-B"](l)||cr["Hangul Jamo"](l)||cr["Hangul Syllables"](l)||cr.Hiragana(l)||cr["Ideographic Description Characters"](l)||cr.Kanbun(l)||cr["Kangxi Radicals"](l)||cr["Katakana Phonetic Extensions"](l)||cr.Katakana(l)&&l!==12540||!(!cr["Halfwidth and Fullwidth Forms"](l)||l===65288||l===65289||l===65293||l>=65306&&l<=65310||l===65339||l===65341||l===65343||l>=65371&&l<=65503||l===65507||l>=65512&&l<=65519)||!(!cr["Small Form Variants"](l)||l>=65112&&l<=65118||l>=65123&&l<=65126)||cr["Unified Canadian Aboriginal Syllabics"](l)||cr["Unified Canadian Aboriginal Syllabics Extended"](l)||cr["Vertical Forms"](l)||cr["Yijing Hexagram Symbols"](l)||cr["Yi Syllables"](l)||cr["Yi Radicals"](l))))}function Rb(l){return!(_v(l)||function(n){return!!(cr["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||cr["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||cr["Letterlike Symbols"](n)||cr["Number Forms"](n)||cr["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||cr["Control Pictures"](n)&&n!==9251||cr["Optical Character Recognition"](n)||cr["Enclosed Alphanumerics"](n)||cr["Geometric Shapes"](n)||cr["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||cr["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||cr["CJK Symbols and Punctuation"](n)||cr.Katakana(n)||cr["Private Use Area"](n)||cr["CJK Compatibility Forms"](n)||cr["Small Form Variants"](n)||cr["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(l))}function oP(l){return cr.Arabic(l)||cr["Arabic Supplement"](l)||cr["Arabic Extended-A"](l)||cr["Arabic Presentation Forms-A"](l)||cr["Arabic Presentation Forms-B"](l)}function kb(l){return l>=1424&&l<=2303||cr["Arabic Presentation Forms-A"](l)||cr["Arabic Presentation Forms-B"](l)}function sP(l,n){return!(!n&&kb(l)||l>=2304&&l<=3583||l>=3840&&l<=4255||cr.Khmer(l))}function aP(l){for(const n of l)if(kb(n.charCodeAt(0)))return!0;return!1}const Ss={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let yv=null,Qo=Ss.unavailable,Ll=null;const wu=function(l){l&&typeof l=="string"&&l.indexOf("NetworkError")>-1&&(Qo=Ss.error),yv&&yv(l)};function Zm(){Xm.fire(new cu("pluginStateChange",{pluginStatus:Qo,pluginURL:Ll}))}const Xm=new uu,Oh=function(){return Qo},Db=function(){if(Qo!==Ss.deferred||!Ll)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Qo=Ss.loading,Zm(),Ll&&ff({url:Ll},l=>{l?wu(l):(Qo=Ss.loaded,Zm())})},zl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Qo===Ss.loaded||zl.applyArabicShaping!=null,isLoading:()=>Qo===Ss.loading,setState(l){Qo=l.pluginStatus,Ll=l.pluginURL},isParsing:()=>Qo===Ss.parsing,isParsed:()=>Qo===Ss.parsed,getPluginURL:()=>Ll};class Tn{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(a,h){for(const f of a)if(!sP(f.charCodeAt(0),h))return!1;return!0}(n,zl.isLoaded())}}class Nf{constructor(n,a,h,f){this.property=n,this.value=a,this.expression=function(_,y,b,E){if(kf(_))return new Ch(_,y);if(Wm(_)||Array.isArray(_)&&_.length>0){const A=Ib(_,y,b,E);if(A.result==="error")throw new Error(A.value.map(M=>`${M.key}: ${M.message}`).join(", "));return A.value}{let A=_;return typeof _=="string"&&y.type==="color"&&(A=dn.parse(_)),{kind:"constant",configDependencies:new Set,evaluate:()=>A}}}(a===void 0?n.specification.default:a,n.specification,h,f)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,h){return this.property.possiblyEvaluate(this,n,a,h)}}class Pc{constructor(n,a,h){this.property=n,this.value=new Nf(n,void 0,a,h)}transitioned(n,a){return new zb(this.property,this.value,a,Xe({},n.transition,this.transition),n.now)}untransitioned(){return new zb(this.property,this.value,null,{},0)}}class Lb{constructor(n,a,h){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=a,this._options=h,this.configDependencies=new Set}getValue(n){return Sr(this._values[n].value.value)}setValue(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new Pc(this._values[n].property,this._scope,this._options)),this._values[n].value=new Nf(this._values[n].property,a===null?void 0:Sr(a),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,a){a&&(this._options=a);const h=this._properties.properties;if(n)for(const f in n){const _=n[f];if(f.endsWith("-transition")){const y=f.slice(0,-11);h[y]&&this.setTransition(y,_)}else h.hasOwnProperty(f)&&this.setValue(f,_)}}getTransition(n){return Sr(this._values[n].transition)}setTransition(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new Pc(this._values[n].property)),this._values[n].transition=Sr(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(n[a]=h);const f=this.getTransition(a);f!==void 0&&(n[`${a}-transition`]=f)}return n}transitioned(n,a){const h=new Nb(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].transitioned(n,a._values[f]);return h}untransitioned(){const n=new Nb(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class zb{constructor(n,a,h,f,_){const y=f.delay||0,b=f.duration||0;_=_||0,this.property=n,this.value=a,this.begin=_+y,this.end=this.begin+b,n.specification.transition&&(f.delay||f.duration)&&(this.prior=h)}possiblyEvaluate(n,a,h){const f=n.now||0,_=this.value.possiblyEvaluate(n,a,h),y=this.prior;if(y){if(f>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(f<this.begin)return y.possiblyEvaluate(n,a,h);{const b=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(n,a,h),_,ue(b))}}return _}}class Nb{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,h){const f=new Su(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(n,a,h);return f}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class lP{constructor(n,a,h){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=a,this._options=h,this.configDependencies=new Set}getValue(n){return Sr(this._values[n].value)}setValue(n,a){this._values[n]=new Nf(this._values[n].property,a===null?void 0:Sr(a),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(n[a]=h)}return n}possiblyEvaluate(n,a,h){const f=new Su(this._properties);for(const _ of Object.keys(this._values))f._values[_]=this._values[_].possiblyEvaluate(n,a,h);return f}}class Mh{constructor(n,a,h){this.property=n,this.value=a,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,h,f){return this.property.evaluate(this.value,this.parameters,n,a,h,f)}}class Su{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Tt{constructor(n){this.specification=n}possiblyEvaluate(n,a){return n.expression.evaluate(a)}interpolate(n,a,h){const f=gf[this.specification.type];return f?f(n,a,h):n}}class $t{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,h,f){return new Mh(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},h,f)}:n.expression,a)}interpolate(n,a,h){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new Mh(this,{kind:"constant",value:void 0},n.parameters);const f=gf[this.specification.type];return f?new Mh(this,{kind:"constant",value:f(n.value.value,a.value.value,h)},n.parameters):n}evaluate(n,a,h,f,_,y){return n.kind==="constant"?n.value:n.evaluate(a,h,f,_,y)}}class Tu{constructor(n){this.specification=n}possiblyEvaluate(n,a,h,f){return!!n.expression.evaluate(a,null,{},h,f)}interpolate(){return!1}}class di{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Tn(0,{});for(const h in n){const f=n[h];f.specification.overridable&&this.overridableProperties.push(h);const _=this.defaultPropertyValues[h]=new Nf(f,void 0),y=this.defaultTransitionablePropertyValues[h]=new Pc(f);this.defaultTransitioningPropertyValues[h]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=_.possiblyEvaluate(a)}}}Ht($t,"DataDrivenProperty"),Ht(Tt,"DataConstantProperty"),Ht(Tu,"ColorRampProperty");var Be=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Pa(l){return l instanceof Number||l instanceof String||l instanceof Boolean?l.valueOf():l}function Km(l){if(Array.isArray(l))return l.map(Km);if(l instanceof Object&&!(l instanceof Number||l instanceof String||l instanceof Boolean)){const n={};for(const a in l)n[a]=Km(l[a]);return n}return Pa(l)}function Ym(l){if(l===!0||l===!1)return!0;if(!Array.isArray(l)||l.length===0)return!1;switch(l[0]){case"has":return l.length>=2&&l[1]!=="$id"&&l[1]!=="$type";case"in":return l.length>=3&&(typeof l[1]!="string"||Array.isArray(l[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return l.length!==3||Array.isArray(l[1])||Array.isArray(l[2]);case"any":case"all":for(const n of l.slice(1))if(!Ym(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function vv(l,n="",a=null,h="fill"){if(l==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ym(l)||(l=Jm(l));const f=l;let _=!0;try{_=function(M){if(!Rh(M))return M;let k=Km(M);return Fb(k),k=jb(k),k}(f)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(f,null,2)}
        `)}let y=null,b=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){b=Be[`filter_${h}`];const M=Rl(_,b,n,a);if(M.result==="error")throw new Error(M.value.map(k=>`${k.key}: ${k.message}`).join(", "));y=(k,D,B)=>M.value.evaluate(k,D,{},B)}let E=null,A=null;if(_!==f){const M=Rl(f,b,n,a);if(M.result==="error")throw new Error(M.value.map(k=>`${k.key}: ${k.message}`).join(", "));E=(k,D,B,U,K)=>M.value.evaluate(k,D,{},B,void 0,void 0,U,K),A=!Sh(M.value.expression)}return{filter:y,dynamicFilter:E||void 0,needGeometry:Bb(_),needFeature:!!A}}function jb(l){if(!Array.isArray(l))return l;const n=function(a){if(cP.has(a[0])){for(let h=1;h<a.length;h++)if(Rh(a[h]))return!0}return a}(l);return n===!0?n:n.map(a=>jb(a))}function Fb(l){let n=!1;const a=[];if(l[0]==="case"){for(let h=1;h<l.length-1;h+=2)n=n||Rh(l[h]),a.push(l[h+1]);a.push(l[l.length-1])}else if(l[0]==="match"){n=n||Rh(l[1]);for(let h=2;h<l.length-1;h+=2)a.push(l[h+1]);a.push(l[l.length-1])}else if(l[0]==="step"){n=n||Rh(l[1]);for(let h=1;h<l.length-1;h+=2)a.push(l[h+1])}n&&(l.length=0,l.push("any",...a));for(let h=1;h<l.length;h++)Fb(l[h])}function Rh(l){if(!Array.isArray(l))return!1;if((n=l[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let a=1;a<l.length;a++)if(Rh(l[a]))return!0;return!1}const cP=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function uP(l,n){return l<n?-1:l>n?1:0}function Bb(l){if(!Array.isArray(l))return!1;if(l[0]==="within"||l[0]==="distance")return!0;for(let n=1;n<l.length;n++)if(Bb(l[n]))return!0;return!1}function Jm(l){if(!l)return!0;const n=l[0];return l.length<=1?n!=="any":n==="=="?xv(l[1],l[2],"=="):n==="!="?Qm(xv(l[1],l[2],"==")):n==="<"||n===">"||n==="<="||n===">="?xv(l[1],l[2],n):n==="any"?(a=l.slice(1),["any"].concat(a.map(Jm))):n==="all"?["all"].concat(l.slice(1).map(Jm)):n==="none"?["all"].concat(l.slice(1).map(Jm).map(Qm)):n==="in"?bv(l[1],l.slice(2)):n==="!in"?Qm(bv(l[1],l.slice(2))):n==="has"?$b(l[1]):n!=="!has"||Qm($b(l[1]));var a}function xv(l,n,a){switch(l){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,l,n]}}function bv(l,n){if(n.length===0)return!1;switch(l){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",l,["literal",n.sort(uP)]]:["filter-in-small",l,["literal",n]]}}function $b(l){switch(l){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",l]}}function Qm(l){return["!",l]}const jf="";function Eu(l,n){return n?`${l}${jf}${n}`:l}const wv="-transition",Cc=new Set(["fill","line","background","hillshade","raster"]);class Bo extends uu{constructor(n,a,h,f,_){if(super(),this.id=n.id,this.fqid=Eu(this.id,h),this.type=n.type,this.scope=h,this.lut=f,this.options=_,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const y=Rl(this.filter,Be[`filter_${n.type}`]);y.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...y.value.configDependencies]))}if(n.slot&&(this.slot=n.slot),a.layout&&(this._unevaluatedLayout=new lP(a.layout,this.scope,_),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new Lb(a.paint,this.scope,_);for(const y in n.paint)this.setPaintProperty(y,n.paint[y]);for(const y in n.layout)this.setLayoutProperty(y,n.layout[y]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Su(a.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D(!0)&&Cc.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a){if(this.type==="custom"&&n==="visibility")return void(this.visibility=a);const h=this._unevaluatedLayout;h._properties.properties[n]&&(h.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return n.endsWith(wv)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a){const h=this._transitionablePaint,f=h._properties.properties;if(n.endsWith(wv)){const k=n.slice(0,-11);return f[k]&&h.setTransition(k,a||void 0),!1}if(!f[n])return!1;const _=h._values[n],y=_.value.isDataDriven(),b=_.value;h.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const E=h._values[n].value,A=E.isDataDriven(),M=n.endsWith("pattern")||n==="line-dasharray";return A||y||M||this._handleOverridablePaintPropertyUpdate(n,b,E)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,a,h){return null}_handleOverridablePaintPropertyUpdate(n,a,h){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){return xr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}is3D(n){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof Mh&&Mf(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=vv(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,a,h,f,_,y,b,E,A){}}const hP={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ff{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Qn{constructor(){this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&a.add(n.arrayBuffer),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function rn(l,n=1){let a=0,h=0;return{members:l.map(f=>{const _=hP[f.type].BYTES_PER_ELEMENT,y=a=Sv(a,Math.max(n,_)),b=f.components||1;return h=Math.max(h,_),a+=_*b,{name:f.name,type:f.type,components:b,offset:y}}),size:Sv(a,Math.max(h,n)),alignment:n}}function Sv(l,n){return Math.ceil(l/n)*n}class Nl extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const h=this.length;return this.resize(h+1),this.emplace(h,n,a)}emplace(n,a,h){const f=2*n;return this.int16[f+0]=a,this.int16[f+1]=h,n}}Nl.prototype.bytesPerElement=4,Ht(Nl,"StructArrayLayout2i4");class Bf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h)}emplace(n,a,h,f){const _=3*n;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=f,n}}Bf.prototype.bytesPerElement=6,Ht(Bf,"StructArrayLayout3i6");class kh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,h,f)}emplace(n,a,h,f,_){const y=4*n;return this.int16[y+0]=a,this.int16[y+1]=h,this.int16[y+2]=f,this.int16[y+3]=_,n}}kh.prototype.bytesPerElement=8,Ht(kh,"StructArrayLayout4i8");class Ic extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}Ic.prototype.bytesPerElement=4,Ht(Ic,"StructArrayLayout1f4");class Tv extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h)}emplace(n,a,h,f){const _=4*n,y=2*n;return this.int16[_+0]=a,this.int16[_+1]=h,this.float32[y+1]=f,n}}Tv.prototype.bytesPerElement=8,Ht(Tv,"StructArrayLayout2i1f8");class eg extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h)}emplace(n,a,h,f){const _=4*n;return this.int16[_+0]=a,this.int16[_+1]=h,this.int16[_+2]=f,n}}eg.prototype.bytesPerElement=8,Ht(eg,"StructArrayLayout3i8");class Dh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,h,f,_)}emplace(n,a,h,f,_,y){const b=5*n;return this.int16[b+0]=a,this.int16[b+1]=h,this.int16[b+2]=f,this.int16[b+3]=_,this.int16[b+4]=y,n}}Dh.prototype.bytesPerElement=10,Ht(Dh,"StructArrayLayout5i10");class Ev extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,h,f,_,y,b)}emplace(n,a,h,f,_,y,b,E){const A=6*n,M=12*n,k=3*n;return this.int16[A+0]=a,this.int16[A+1]=h,this.uint8[M+4]=f,this.uint8[M+5]=_,this.uint8[M+6]=y,this.uint8[M+7]=b,this.float32[k+2]=E,n}}Ev.prototype.bytesPerElement=12,Ht(Ev,"StructArrayLayout2i4ub1f12");class Qa extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h)}emplace(n,a,h,f){const _=3*n;return this.float32[_+0]=a,this.float32[_+1]=h,this.float32[_+2]=f,n}}Qa.prototype.bytesPerElement=12,Ht(Qa,"StructArrayLayout3f12");class Oc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,h,f,_)}emplace(n,a,h,f,_,y){const b=6*n,E=3*n;return this.uint16[b+0]=a,this.uint16[b+1]=h,this.uint16[b+2]=f,this.uint16[b+3]=_,this.float32[E+2]=y,n}}Oc.prototype.bytesPerElement=12,Ht(Oc,"StructArrayLayout4ui1f12");class $f extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,h,f)}emplace(n,a,h,f,_){const y=4*n;return this.uint16[y+0]=a,this.uint16[y+1]=h,this.uint16[y+2]=f,this.uint16[y+3]=_,n}}$f.prototype.bytesPerElement=8,Ht($f,"StructArrayLayout4ui8");class tg extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,n,a,h,f,_,y)}emplace(n,a,h,f,_,y,b){const E=6*n;return this.int16[E+0]=a,this.int16[E+1]=h,this.int16[E+2]=f,this.int16[E+3]=_,this.int16[E+4]=y,this.int16[E+5]=b,n}}tg.prototype.bytesPerElement=12,Ht(tg,"StructArrayLayout6i12");class Lh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A,M,k,D){const B=this.length;return this.resize(B+1),this.emplace(B,n,a,h,f,_,y,b,E,A,M,k,D)}emplace(n,a,h,f,_,y,b,E,A,M,k,D,B){const U=12*n;return this.int16[U+0]=a,this.int16[U+1]=h,this.int16[U+2]=f,this.int16[U+3]=_,this.uint16[U+4]=y,this.uint16[U+5]=b,this.uint16[U+6]=E,this.uint16[U+7]=A,this.int16[U+8]=M,this.int16[U+9]=k,this.int16[U+10]=D,this.int16[U+11]=B,n}}Lh.prototype.bytesPerElement=24,Ht(Lh,"StructArrayLayout4i4ui4i24");class zh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,n,a,h,f,_,y)}emplace(n,a,h,f,_,y,b){const E=10*n,A=5*n;return this.int16[E+0]=a,this.int16[E+1]=h,this.int16[E+2]=f,this.float32[A+2]=_,this.float32[A+3]=y,this.float32[A+4]=b,n}}zh.prototype.bytesPerElement=20,Ht(zh,"StructArrayLayout3i3f20");class So extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,h,f)}emplace(n,a,h,f,_){const y=4*n;return this.float32[y+0]=a,this.float32[y+1]=h,this.float32[y+2]=f,this.float32[y+3]=_,n}}So.prototype.bytesPerElement=16,Ht(So,"StructArrayLayout4f16");class Nh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}Nh.prototype.bytesPerElement=4,Ht(Nh,"StructArrayLayout1ul4");class Mc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const h=this.length;return this.resize(h+1),this.emplace(h,n,a)}emplace(n,a,h){const f=2*n;return this.uint16[f+0]=a,this.uint16[f+1]=h,n}}Mc.prototype.bytesPerElement=4,Ht(Mc,"StructArrayLayout2ui4");class Av extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A,M,k,D,B){const U=this.length;return this.resize(U+1),this.emplace(U,n,a,h,f,_,y,b,E,A,M,k,D,B)}emplace(n,a,h,f,_,y,b,E,A,M,k,D,B,U){const K=20*n,te=10*n;return this.int16[K+0]=a,this.int16[K+1]=h,this.int16[K+2]=f,this.int16[K+3]=_,this.int16[K+4]=y,this.float32[te+3]=b,this.float32[te+4]=E,this.float32[te+5]=A,this.float32[te+6]=M,this.int16[K+14]=k,this.uint32[te+8]=D,this.uint16[K+18]=B,this.uint16[K+19]=U,n}}Av.prototype.bytesPerElement=40,Ht(Av,"StructArrayLayout5i4f1i1ul2ui40");class rg extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,h,f,_,y,b)}emplace(n,a,h,f,_,y,b,E){const A=8*n;return this.int16[A+0]=a,this.int16[A+1]=h,this.int16[A+2]=f,this.int16[A+4]=_,this.int16[A+5]=y,this.int16[A+6]=b,this.int16[A+7]=E,n}}rg.prototype.bytesPerElement=16,Ht(rg,"StructArrayLayout3i2i2i16");class Pv extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,h,f,_)}emplace(n,a,h,f,_,y){const b=4*n,E=8*n;return this.float32[b+0]=a,this.float32[b+1]=h,this.float32[b+2]=f,this.int16[E+6]=_,this.int16[E+7]=y,n}}Pv.prototype.bytesPerElement=16,Ht(Pv,"StructArrayLayout2f1f2i16");class Uf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,n,a,h,f,_,y)}emplace(n,a,h,f,_,y,b){const E=20*n,A=5*n;return this.uint8[E+0]=a,this.uint8[E+1]=h,this.float32[A+1]=f,this.float32[A+2]=_,this.float32[A+3]=y,this.float32[A+4]=b,n}}Uf.prototype.bytesPerElement=20,Ht(Uf,"StructArrayLayout2ub4f20");class To extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h)}emplace(n,a,h,f){const _=3*n;return this.uint16[_+0]=a,this.uint16[_+1]=h,this.uint16[_+2]=f,n}}To.prototype.bytesPerElement=6,Ht(To,"StructArrayLayout3ui6");class Vf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe,Y,le){const pe=this.length;return this.resize(pe+1),this.emplace(pe,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe,Y,le)}emplace(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe,Y,le,pe){const ye=30*n,Re=15*n,Ie=60*n;return this.int16[ye+0]=a,this.int16[ye+1]=h,this.int16[ye+2]=f,this.float32[Re+2]=_,this.float32[Re+3]=y,this.uint16[ye+8]=b,this.uint16[ye+9]=E,this.uint32[Re+5]=A,this.uint32[Re+6]=M,this.uint32[Re+7]=k,this.uint16[ye+16]=D,this.uint16[ye+17]=B,this.uint16[ye+18]=U,this.float32[Re+10]=K,this.float32[Re+11]=te,this.uint8[Ie+48]=oe,this.uint8[Ie+49]=de,this.uint8[Ie+50]=fe,this.uint32[Re+13]=Y,this.int16[ye+28]=le,this.uint8[Ie+58]=pe,n}}Vf.prototype.bytesPerElement=60,Ht(Vf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Cv extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe,Y,le,pe,ye,Re,Ie,ke,je,rt,xt,ft,vt,wt,it){const _t=this.length;return this.resize(_t+1),this.emplace(_t,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe,Y,le,pe,ye,Re,Ie,ke,je,rt,xt,ft,vt,wt,it)}emplace(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe,Y,le,pe,ye,Re,Ie,ke,je,rt,xt,ft,vt,wt,it,_t){const et=20*n,nt=40*n,Pt=80*n;return this.float32[et+0]=a,this.float32[et+1]=h,this.int16[nt+4]=f,this.int16[nt+5]=_,this.int16[nt+6]=y,this.int16[nt+7]=b,this.int16[nt+8]=E,this.int16[nt+9]=A,this.int16[nt+10]=M,this.int16[nt+11]=k,this.int16[nt+12]=D,this.uint16[nt+13]=B,this.uint16[nt+14]=U,this.uint16[nt+15]=K,this.uint16[nt+16]=te,this.uint16[nt+17]=oe,this.uint16[nt+18]=de,this.uint16[nt+19]=fe,this.uint16[nt+20]=Y,this.uint16[nt+21]=le,this.uint16[nt+22]=pe,this.uint16[nt+23]=ye,this.uint16[nt+24]=Re,this.uint16[nt+25]=Ie,this.uint16[nt+26]=ke,this.uint16[nt+27]=je,this.uint32[et+14]=rt,this.float32[et+15]=xt,this.float32[et+16]=ft,this.float32[et+17]=vt,this.float32[et+18]=wt,this.uint8[Pt+76]=it,this.uint16[nt+39]=_t,n}}Cv.prototype.bytesPerElement=80,Ht(Cv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Iv extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y){const b=this.length;return this.resize(b+1),this.emplace(b,n,a,h,f,_,y)}emplace(n,a,h,f,_,y,b){const E=6*n;return this.float32[E+0]=a,this.float32[E+1]=h,this.float32[E+2]=f,this.float32[E+3]=_,this.float32[E+4]=y,this.float32[E+5]=b,n}}Iv.prototype.bytesPerElement=24,Ht(Iv,"StructArrayLayout6f24");class Rc extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_){const y=this.length;return this.resize(y+1),this.emplace(y,n,a,h,f,_)}emplace(n,a,h,f,_,y){const b=5*n;return this.float32[b+0]=a,this.float32[b+1]=h,this.float32[b+2]=f,this.float32[b+3]=_,this.float32[b+4]=y,n}}Rc.prototype.bytesPerElement=20,Ht(Rc,"StructArrayLayout5f20");class Gf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,h,f,_,y,b)}emplace(n,a,h,f,_,y,b,E){const A=7*n;return this.float32[A+0]=a,this.float32[A+1]=h,this.float32[A+2]=f,this.float32[A+3]=_,this.float32[A+4]=y,this.float32[A+5]=b,this.float32[A+6]=E,n}}Gf.prototype.bytesPerElement=28,Ht(Gf,"StructArrayLayout7f28");class Ov extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A,M,k){const D=this.length;return this.resize(D+1),this.emplace(D,n,a,h,f,_,y,b,E,A,M,k)}emplace(n,a,h,f,_,y,b,E,A,M,k,D){const B=11*n;return this.float32[B+0]=a,this.float32[B+1]=h,this.float32[B+2]=f,this.float32[B+3]=_,this.float32[B+4]=y,this.float32[B+5]=b,this.float32[B+6]=E,this.float32[B+7]=A,this.float32[B+8]=M,this.float32[B+9]=k,this.float32[B+10]=D,n}}Ov.prototype.bytesPerElement=44,Ht(Ov,"StructArrayLayout11f44");class ng extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A){const M=this.length;return this.resize(M+1),this.emplace(M,n,a,h,f,_,y,b,E,A)}emplace(n,a,h,f,_,y,b,E,A,M){const k=9*n;return this.float32[k+0]=a,this.float32[k+1]=h,this.float32[k+2]=f,this.float32[k+3]=_,this.float32[k+4]=y,this.float32[k+5]=b,this.float32[k+6]=E,this.float32[k+7]=A,this.float32[k+8]=M,n}}ng.prototype.bytesPerElement=36,Ht(ng,"StructArrayLayout9f36");class Au extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const h=this.length;return this.resize(h+1),this.emplace(h,n,a)}emplace(n,a,h){const f=2*n;return this.float32[f+0]=a,this.float32[f+1]=h,n}}Au.prototype.bytesPerElement=8,Ht(Au,"StructArrayLayout2f8");class Mv extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,a,h,f)}emplace(n,a,h,f,_){const y=6*n;return this.uint32[3*n+0]=a,this.uint16[y+2]=h,this.uint16[y+3]=f,this.uint16[y+4]=_,n}}Mv.prototype.bytesPerElement=12,Ht(Mv,"StructArrayLayout1ul3ui12");class Hf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}Hf.prototype.bytesPerElement=2,Ht(Hf,"StructArrayLayout1ui2");class jh extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te){const oe=this.length;return this.resize(oe+1),this.emplace(oe,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te)}emplace(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe){const de=16*n;return this.float32[de+0]=a,this.float32[de+1]=h,this.float32[de+2]=f,this.float32[de+3]=_,this.float32[de+4]=y,this.float32[de+5]=b,this.float32[de+6]=E,this.float32[de+7]=A,this.float32[de+8]=M,this.float32[de+9]=k,this.float32[de+10]=D,this.float32[de+11]=B,this.float32[de+12]=U,this.float32[de+13]=K,this.float32[de+14]=te,this.float32[de+15]=oe,n}}jh.prototype.bytesPerElement=64,Ht(jh,"StructArrayLayout16f64");class Wf extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,f,_,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,n,a,h,f,_,y,b)}emplace(n,a,h,f,_,y,b,E){const A=10*n,M=5*n;return this.uint16[A+0]=a,this.uint16[A+1]=h,this.uint16[A+2]=f,this.uint16[A+3]=_,this.float32[M+2]=y,this.float32[M+3]=b,this.float32[M+4]=E,n}}Wf.prototype.bytesPerElement=20,Ht(Wf,"StructArrayLayout4ui3f20");class Rv extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.int16[1*n+0]=a,n}}Rv.prototype.bytesPerElement=2,Ht(Rv,"StructArrayLayout1i2");class ig extends Qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint8[1*n+0]=a,n}}ig.prototype.bytesPerElement=1,Ht(ig,"StructArrayLayout1ub1");class Ub extends Ff{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ub.prototype.size=40;class og extends Av{get(n){return new Ub(this,n)}}Ht(og,"CollisionBoxArray");class Vb extends Ff{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}Vb.prototype.size=60;class Gb extends Vf{get(n){return new Vb(this,n)}}Ht(Gb,"PlacedSymbolArray");class Hb extends Ff{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Hb.prototype.size=80;class Wb extends Cv{get(n){return new Hb(this,n)}}Ht(Wb,"SymbolInstanceArray");class kv extends Ic{getoffsetX(n){return this.float32[1*n+0]}}Ht(kv,"GlyphOffsetArray");class qb extends Nl{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Ht(qb,"SymbolLineVertexArray");class Zb extends Ff{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zb.prototype.size=12;class Xb extends Mv{get(n){return new Zb(this,n)}}Ht(Xb,"FeatureIndexArray");class Kb extends Mc{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Ht(Kb,"FillExtrusionCentroidArray");class Yb extends Ff{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Yb.prototype.size=6;class Jb extends Bf{get(n){return new Yb(this,n)}}Ht(Jb,"FillExtrusionWallArray");const dP=rn([{name:"a_pos",components:2,type:"Int16"}],4),fP=rn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),sg=rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mi{constructor(n=[]){this.segments=n}_prepareSegment(n,a,h,f){let _=this.segments[this.segments.length-1];return n>mi.MAX_VERTEX_ARRAY_LENGTH&&Rr(`Max vertices per segment is ${mi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!_||_.vertexLength+n>mi.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==f)&&(_={vertexOffset:a,primitiveOffset:h,vertexLength:0,primitiveLength:0},f!==void 0&&(_.sortKey=f),this.segments.push(_)),_}prepareSegment(n,a,h,f){return this._prepareSegment(n,a.length,h.length,f)}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,h,f){return new mi([{vertexOffset:n,primitiveOffset:a,vertexLength:h,primitiveLength:f,vaos:{},sortKey:0}])}}function Qb(l,n){return 256*(l=Ee(Math.floor(l),0,255))+Ee(Math.floor(n),0,255)}mi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht(mi,"SegmentVector");const ag=rn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Dv=rn([{name:"a_pattern_b",components:4,type:"Uint16"}]),ew=rn([{name:"a_dash",components:4,type:"Uint16"}]);class qf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,a,h,f){this.ids.push(Lv(n)),this.positions.push(a,h,f)}eachPosition(n,a){const h=Lv(n);let f=0,_=this.ids.length-1;for(;f<_;){const y=f+_>>1;this.ids[y]>=h?_=y:f=y+1}for(;this.ids[f]===h;)a(this.positions[3*f],this.positions[3*f+1],this.positions[3*f+2]),f++}static serialize(n,a){const h=new Float64Array(n.ids),f=new Uint32Array(n.positions);return lg(h,f,0,h.length-1),a&&(a.add(h.buffer),a.add(f.buffer)),{ids:h,positions:f}}static deserialize(n){const a=new qf;let h;a.ids=n.ids,a.positions=n.positions;for(const f of a.ids)f!==h&&a.uniqueIds.push(f),h=f;return a.indexed=!0,a}}function Lv(l){const n=+l;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:mf(String(l))}function lg(l,n,a,h){for(;a<h;){const f=l[a+h>>1];let _=a-1,y=h+1;for(;;){do _++;while(l[_]<f);do y--;while(l[y]>f);if(_>=y)break;Zf(l,_,y),Zf(n,3*_,3*y),Zf(n,3*_+1,3*y+1),Zf(n,3*_+2,3*y+2)}y-a<h-y?(lg(l,n,a,y),a=y+1):(lg(l,n,y+1,h),h=y)}}function Zf(l,n,a){const h=l[n];l[n]=l[a],l[a]=h}Ht(qf,"FeaturePositionMap");class jl{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,a),this.initialized=!0),!!this.location}set(n,a,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class cg extends jl{constructor(n){super(n),this.current=0}set(n,a,h){this.fetchUniformLocation(n,a)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class ki extends jl{constructor(n){super(n),this.current=0}set(n,a,h){this.fetchUniformLocation(n,a)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class el extends jl{constructor(n){super(n),this.current=[0,0]}set(n,a,h){this.fetchUniformLocation(n,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class Xf extends jl{constructor(n){super(n),this.current=[0,0,0]}set(n,a,h){this.fetchUniformLocation(n,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class ug extends jl{constructor(n){super(n),this.current=[0,0,0,0]}set(n,a,h){this.fetchUniformLocation(n,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class tw extends jl{constructor(n){super(n),this.current=dn.transparent.toPremultipliedRenderColor(null)}set(n,a,h){this.fetchUniformLocation(n,a)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const pP=new Float32Array(16);class Fh extends jl{constructor(n){super(n),this.current=pP}set(n,a,h){if(this.fetchUniformLocation(n,a)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let f=1;f<16;f++)if(h[f]!==this.current[f]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const zv=new Float32Array(9),tl=new Float32Array(4);class Kf extends jl{constructor(n){super(n),this.current=tl}set(n,a,h){if(this.fetchUniformLocation(n,a)){for(let f=0;f<4;f++)if(h[f]!==this.current[f]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Nv(l){return[Qb(255*l.r,255*l.g),Qb(255*l.b,255*l.a)]}class Yf{constructor(n,a,h,f){this.value=n,this.uniformNames=a.map(_=>`u_${_}`),this.type=h,this.context=f}setUniform(n,a,h,f,_){const y=f.constantOr(this.value);a.set(n,_,y instanceof dn?y.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):y)}getBinding(n,a){return this.type==="color"?new tw(n):new ki(n)}}class Bh{constructor(n,a){this.uniformNames=a.map(h=>`u_${h}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(n,a){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(n,a,h,f,_){let y=null;_!=="u_pattern"&&_!=="u_dash"||(y=this.pattern),_==="u_pattern_b"&&(y=this.patternTransition),_==="u_pixel_ratio"&&(y=this.pixelRatio),y&&a.set(n,_,y)}getBinding(n,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new ug(n):new ki(n)}}class Fl{constructor(n,a,h,f){this.expression=n,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(_=>({name:`a_${_}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(n,a,h,f,_,y,b,E){const A=this.paintVertexArray.length,M=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Tn(0,{brightness:y,worldview:E}),a,{},_,f,b):this.expression.kind==="constant"&&this.expression.value,k=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Tn(0,{brightness:y,worldview:E}),a,{},_,f,b):this.lutExpression.value)==="none";this.paintVertexArray.resize(n),this._setPaintValue(A,n,M,k?null:this.context.lut)}updatePaintArray(n,a,h,f,_,y,b,E){const A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:E},h,f,void 0,_):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Tn(0,{brightness:b,worldview:E}),h,f,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(n,a,A,M?null:this.context.lut)}_setPaintValue(n,a,h,f){if(this.type==="color"){const _=Nv(h.toPremultipliedRenderColor(f));for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,_[0],_[1])}else{for(let _=n;_<a;_++)this.paintVertexArray.emplace(_,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ca{constructor(n,a,h,f,_,y){this.expression=n,this.uniformNames=a.map(b=>`u_${b}_t`),this.type=h,this.useIntegerZoom=f,this.context=_,this.maxValue=0,this.paintVertexAttributes=a.map(b=>({name:`a_${b}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(n,a,h,f,_,y,b,E){const A=this.expression.evaluate(new Tn(this.context.zoom,{brightness:y,worldview:E}),a,{},_,f,b),M=this.expression.evaluate(new Tn(this.context.zoom+1,{brightness:y,worldview:E}),a,{},_,f,b),k=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Tn(0,{brightness:y,worldview:E}),a,{},_,f,b):this.lutExpression.value)==="none",D=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(D,n,A,M,k?null:this.context.lut)}updatePaintArray(n,a,h,f,_,y,b,E){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:E},h,f,void 0,_),M=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:E},h,f,void 0,_),k=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Tn(0,{brightness:b,worldview:E}),h,f,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(n,a,A,M,k?null:this.context.lut)}_setPaintValue(n,a,h,f,_){if(this.type==="color"){const y=Nv(h.toPremultipliedRenderColor(_)),b=Nv(h.toPremultipliedRenderColor(_));for(let E=n;E<a;E++)this.paintVertexArray.emplace(E,y[0],y[1],b[0],b[1])}else{for(let y=n;y<a;y++)this.paintVertexArray.emplace(y,h,f);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a,h,f,_){const y=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,b=Ee(this.expression.interpolationFactor(y,this.context.zoom,this.context.zoom+1),0,1);a.set(n,_,b)}getBinding(n,a){return new ki(n)}}class ca{constructor(n,a,h,f,_){this.expression=n,this.layerId=_,this.paintVertexAttributes=(h==="array"?ew:ag).members;for(let y=0;y<a.length;++y);this.paintVertexArray=new f,this.paintTransitionVertexArray=new $f}populatePaintArray(n,a,h,f){const _=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(_,n,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(n,a,h,f,_,y,b){this._setPaintValues(n,a,h.patterns&&h.patterns[this.layerId],y)}_setPaintValues(n,a,h,f){if(!f||!h)return;const _=f[h[0]],y=f[h[1]];if(_){if(_){const{tl:b,br:E,pixelRatio:A}=_;for(let M=n;M<a;M++)this.paintVertexArray.emplace(M,b[0],b[1],E[0],E[1],A)}if(y){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:E}=y;for(let A=n;A<a;A++)this.paintTransitionVertexArray.emplace(A,b[0],b[1],E[0],E[1])}}}upload(n){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=n.createVertexBuffer(this.paintTransitionVertexArray,Dv.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class $h{constructor(n,a,h=()=>!0){this.binders={},this._buffers=[],this.context=a;const f=[];for(const _ in n.paint._values){const y=n.paint.get(_);if(_.endsWith("-use-theme")||!h(_)||!(y instanceof Mh&&Mf(y.property.specification)))continue;const b=u(_,n.type),E=y.value,A=y.property.specification.type,M=!!y.property.useIntegerZoom,k=_==="line-dasharray"||_.endsWith("pattern"),D=n.paint.get(`${_}-use-theme`),B=_==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant"||D&&D.value.kind!=="constant";if(E.kind!=="constant"||B)if(E.kind==="source"||B||k){const U=x(_,A,"source");this.binders[_]=k?new ca(E,b,A,U,n.id):new Fl(E,b,A,U),f.push(`/a_${_}`)}else{const U=x(_,A,"composite");this.binders[_]=new Ca(E,b,A,M,a,U),f.push(`/z_${_}`)}else this.binders[_]=k?new Bh(E.value,b):new Yf(E.value,b,A,a),f.push(`/u_${_}`);D&&(this.binders[_].lutExpression=D.value)}this.cacheKey=f.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof Fl||a instanceof Ca?a.maxValue:0}populatePaintArrays(n,a,h,f,_,y,b,E){for(const A in this.binders){const M=this.binders[A];M.context=this.context,(M instanceof Fl||M instanceof Ca||M instanceof ca)&&M.populatePaintArray(n,a,h,f,_,y,b,E)}}setConstantPatternPositions(n,a){for(const h in this.binders){const f=this.binders[h];f instanceof Bh&&f.setConstantPatternPositions(n,a)}}getPatternTransitionVertexBuffer(n){const a=this.binders[n];return a instanceof ca?a.paintTransitionVertexBuffer:null}updatePaintArrays(n,a,h,f,_,y,b,E,A,M){let k=!1;const D=Object.keys(n),B=D.length!==0&&!E,U=B?D:a.uniqueIds;this.context.lut=_.lut;for(const K in this.binders){const te=this.binders[K];if(te.context=this.context,(te instanceof Fl||te instanceof Ca||te instanceof ca)&&te.expression&&te.expression.kind&&te.expression.kind!=="constant"&&(te.expression.isStateDependent===!0||te.expression.isLightConstant===!1)){const oe=_.paint.get(K);te.expression=oe.value;for(const de of U){const fe=n[de.toString()];a.eachPosition(de,(Y,le,pe)=>{const ye=f.feature(Y);te.updatePaintArray(le,pe,ye,fe,y,b,A,M)})}if(!B)for(const de of h.uniqueIds){const fe=n[de.toString()];h.eachPosition(de,(Y,le,pe)=>{const ye=f.feature(Y);te.updatePaintArray(le,pe,ye,fe,y,b,A,M)})}k=!0}}return k}defines(){const n=[];for(const a in this.binders){const h=this.binders[a];(h instanceof Yf||h instanceof Bh)&&n.push(...h.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Fl||h instanceof Ca||h instanceof ca)for(let f=0;f<h.paintVertexAttributes.length;f++)n.push(h.paintVertexAttributes[f].name);if(h instanceof ca)for(let f=0;f<Dv.members.length;f++)n.push(Dv.members[f].name)}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Yf||h instanceof Bh||h instanceof Ca)for(const f of h.uniformNames)n.push(f)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const a=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Yf||f instanceof Bh||f instanceof Ca)for(const _ of f.uniformNames)a.push({name:_,property:h,binding:f.getBinding(n,_)})}return a}setUniforms(n,a,h,f,_){for(const{name:y,property:b,binding:E}of h)this.binders[b].setUniform(n,E,_,f.get(b),y)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Fl||a instanceof Ca||a instanceof ca)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof ca&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(n){for(const a in this.binders){const h=this.binders[a];(h instanceof Fl||h instanceof Ca||h instanceof ca)&&h.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof Fl||a instanceof Ca||a instanceof ca)&&a.destroy()}}}class p{constructor(n,a,h=()=>!0){this.programConfigurations={};for(const f of n)this.programConfigurations[f.id]=new $h(f,a,h);this.needsUpload=!1,this._featureMap=new qf,this._featureMapWithoutIds=new qf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,a,h,f,_,y,b,E,A){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(n,a,f,_,y,b,E,A);a.id!==void 0?this._featureMap.add(a.id,h,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,h,f,_,y,b,E){for(const A of h)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,a,A,f,_,y,b||0,E)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const s={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function u(l,n){return s[l]||[l.replace(`${n}-`,"").replace(/-/g,"_")]}const m={"line-pattern":{source:Oc,composite:Oc},"fill-pattern":{source:Oc,composite:Oc},"fill-extrusion-pattern":{source:Oc,composite:Oc},"line-dasharray":{source:$f,composite:$f}},v={color:{source:Au,composite:So},number:{source:Ic,composite:Au}};function x(l,n,a){const h=m[l];return h&&h[a]||v[n][a]}Ht(Yf,"ConstantBinder"),Ht(Bh,"PatternConstantBinder"),Ht(Fl,"SourceExpressionBinder"),Ht(ca,"PatternCompositeBinder"),Ht(Ca,"CompositeExpressionBinder"),Ht($h,"ProgramConfiguration",{omit:["_buffers"]}),Ht(p,"ProgramConfigurationSet");const S=Nt/Math.PI/2,P=5,O=6,L=16383,N=64,V=[N,32,16],$=-S,W=S;function re(l,n,a,h=S){return a=nn(a),[l*Math.sin(a)*h,-n*h,l*Math.cos(a)*h]}function ee(l,n,a){return re(Math.cos(nn(l)),Math.sin(nn(l)),n,a)}const ie=63710088e-1,ae=2*Math.PI*ie;class ce{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ce(We(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,h=this.lat*a,f=n.lat*a,_=Math.sin(h)*Math.sin(f)+Math.cos(h)*Math.cos(f)*Math.cos((n.lng-this.lng)*a);return ie*Math.acos(Math.min(_,1))}toBounds(n=0){const a=360*n/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new _e({lng:this.lng-h,lat:this.lat-a},{lng:this.lng+h,lat:this.lat+a})}toEcef(n){return ee(this.lat,this.lng,S+n*S/ie)}static convert(n){if(n instanceof ce)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new ce(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new ce(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class _e{constructor(n,a){if(n)if(a)this.setSouthWest(n).setNorthEast(a);else if(n.length===4){const h=n;this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]])}else{const h=n;this.setSouthWest(h[0]).setNorthEast(h[1])}}setNorthEast(n){return this._ne=n instanceof ce?new ce(n.lng,n.lat):ce.convert(n),this}setSouthWest(n){return this._sw=n instanceof ce?new ce(n.lng,n.lat):ce.convert(n),this}extend(n){const a=this._sw,h=this._ne;let f,_;if(n instanceof ce)f=n,_=n;else{if(!(n instanceof _e))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(_e.convert(n)):this.extend(ce.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(ce.convert(n)):this;if(f=n._sw,_=n._ne,!f||!_)return this}return a||h?(a.lng=Math.min(f.lng,a.lng),a.lat=Math.min(f.lat,a.lat),h.lng=Math.max(_.lng,h.lng),h.lat=Math.max(_.lat,h.lat)):(this._sw=new ce(f.lng,f.lat),this._ne=new ce(_.lng,_.lat)),this}getCenter(){return new ce((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ce(this.getWest(),this.getNorth())}getSouthEast(){return new ce(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:a,lat:h}=ce.convert(n);let f=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(f=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&f}static convert(n){if(n)return n instanceof _e?n:new _e(n)}}const be=0,Pe=25.5;function Ae(l){return ae*Math.cos(l*Math.PI/180)}function Te(l){return(180+l)/360}function we(l){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+l*Math.PI/360)))/360}function Ce(l,n){return l/Ae(n)}function Oe(l){return 360*l-180}function Ve(l){return 360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90}function Ge(l,n){return l*Ae(Ve(n))}const at=85.051129;function lt(l){return Math.cos(nn(Ee(l,-85.051129,at)))}function yt(l,n){const a=Ee(n,be,Pe),h=Math.pow(2,a);return lt(l)*ae/(512*h)}function Fe(l){return 1/Math.cos(l*Math.PI/180)}function tt(l,n=0){const a=Math.exp(Math.PI*(1-(l.y+n/Nt)/(1<<l.z)*2));return 80150034*a/(a*a+1)/Nt/(1<<l.z)}class Le{constructor(n,a,h=0){this.x=+n,this.y=+a,this.z=+h}static fromLngLat(n,a=0){const h=ce.convert(n);return new Le(Te(h.lng),we(h.lat),Ce(a,h.lat))}toLngLat(){return new ce(Oe(this.x),Ve(this.y))}toAltitude(){return Ge(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ae*Fe(Ve(this.y))}}function ht(l,n,a,h,f,_,y,b,E){const A=(n+h)/2,M=(a+f)/2,k=new Dt(A,M);b(k),function(D,B,U,K,te,oe){const de=U-te,fe=K-oe;return Math.abs((K-B)*de-(U-D)*fe)/Math.hypot(de,fe)}(k.x,k.y,_.x,_.y,y.x,y.y)>=E?(ht(l,n,a,A,M,_,k,b,E),ht(l,A,M,h,f,k,y,b,E)):l.push(y)}function Ye(l,n,a){let h=l[0],f=h.x,_=h.y;n(h);const y=[h];for(let b=1;b<l.length;b++){const E=l[b],{x:A,y:M}=E;n(E),ht(y,f,_,A,M,h,E,n,a),f=A,_=M,h=E}return y}function gt(l,n,a,h){if(h(n,a)){const f=n.add(a)._mult(.5);gt(l,n,f,h),gt(l,f,a,h)}else l.push(a)}function Ot(l,n){let a=l[0];const h=[a];for(let f=1;f<l.length;f++){const _=l[f];gt(h,a,_,n),a=_}return h}const ut=Math.pow(2,14)-1,Ct=-ut-1;function Wt(l,n){const a=Math.round(l.x*n),h=Math.round(l.y*n);return l.x=Ee(a,Ct,ut),l.y=Ee(h,Ct,ut),(a<l.x||a>l.x+1||h<l.y||h>l.y+1)&&Rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),l}function qt(l,n,a){const h=l.loadGeometry(),f=l.extent,_=Nt/f;if(n&&a&&a.projection.isReprojectedInTileSpace){const y=1<<n.z,{scale:b,x:E,y:A,projection:M}=a,k=D=>{const B=Oe((n.x+D.x/f)/y),U=Ve((n.y+D.y/f)/y),K=M.project(B,U);D.x=(K.x*b-E)*f,D.y=(K.y*b-A)*f};for(let D=0;D<h.length;D++)if(l.type!==1)h[D]=Ye(h[D],k,1);else{const B=[];for(const U of h[D])U.x<0||U.x>=f||U.y<0||U.y>=f||(k(U),B.push(U));h[D]=B}}for(const y of h)for(const b of y)Wt(b,_);return h}function Vt(l,n){return{type:l.type,id:l.id,properties:l.properties,geometry:n?qt(l):[]}}var tr,ir,ar,yr,kr,pn,jn,yn={};function bn(){if(ir)return tr;ir=1;var l=Tl();function n(f,_,y,b,E){this.properties={},this.extent=y,this.type=0,this._pbf=f,this._geometry=-1,this._keys=b,this._values=E,f.readFields(a,this,_)}function a(f,_,y){f==1?_.id=y.readVarint():f==2?function(b,E){for(var A=b.readVarint()+b.pos;b.pos<A;){var M=E._keys[b.readVarint()],k=E._values[b.readVarint()];E.properties[M]=k}}(y,_):f==3?_.type=y.readVarint():f==4&&(_._geometry=y.pos)}function h(f){for(var _,y,b=0,E=0,A=f.length,M=A-1;E<A;M=E++)b+=((y=f[M]).x-(_=f[E]).x)*(_.y+y.y);return b}return tr=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var _,y=f.readVarint()+f.pos,b=1,E=0,A=0,M=0,k=[];f.pos<y;){if(E<=0){var D=f.readVarint();b=7&D,E=D>>3}if(E--,b===1||b===2)A+=f.readSVarint(),M+=f.readSVarint(),b===1&&(_&&k.push(_),_=[]),_.push(new l(A,M));else{if(b!==7)throw new Error("unknown command "+b);_&&_.push(_[0].clone())}}return _&&k.push(_),k},n.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var _=f.readVarint()+f.pos,y=1,b=0,E=0,A=0,M=1/0,k=-1/0,D=1/0,B=-1/0;f.pos<_;){if(b<=0){var U=f.readVarint();y=7&U,b=U>>3}if(b--,y===1||y===2)(E+=f.readSVarint())<M&&(M=E),E>k&&(k=E),(A+=f.readSVarint())<D&&(D=A),A>B&&(B=A);else if(y!==7)throw new Error("unknown command "+y)}return[M,D,k,B]},n.prototype.toGeoJSON=function(f,_,y){var b,E,A=this.extent*Math.pow(2,y),M=this.extent*f,k=this.extent*_,D=this.loadGeometry(),B=n.types[this.type];function U(oe){for(var de=0;de<oe.length;de++){var fe=oe[de];oe[de]=[360*(fe.x+M)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(fe.y+k)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(b=0;b<D.length;b++)K[b]=D[b][0];U(D=K);break;case 2:for(b=0;b<D.length;b++)U(D[b]);break;case 3:for(D=function(oe){var de=oe.length;if(de<=1)return[oe];for(var fe,Y,le=[],pe=0;pe<de;pe++){var ye=h(oe[pe]);ye!==0&&(Y===void 0&&(Y=ye<0),Y===ye<0?(fe&&le.push(fe),fe=[oe[pe]]):fe.push(oe[pe]))}return fe&&le.push(fe),le}(D),b=0;b<D.length;b++)for(E=0;E<D[b].length;E++)U(D[b][E])}D.length===1?D=D[0]:B="Multi"+B;var te={type:"Feature",geometry:{type:B,coordinates:D},properties:this.properties};return"id"in this&&(te.id=this.id),te},tr}function xi(){if(yr)return ar;yr=1;var l=bn();function n(h,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(a,this,f),this.length=this._features.length}function a(h,f,_){h===15?f.version=_.readVarint():h===1?f.name=_.readString():h===5?f.extent=_.readVarint():h===2?f._features.push(_.pos):h===3?f._keys.push(_.readString()):h===4&&f._values.push(function(y){for(var b=null,E=y.readVarint()+y.pos;y.pos<E;){var A=y.readVarint()>>3;b=A===1?y.readString():A===2?y.readFloat():A===3?y.readDouble():A===4?y.readVarint64():A===5?y.readVarint():A===6?y.readSVarint():A===7?y.readBoolean():null}return b}(_))}return ar=n,n.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var f=this._pbf.readVarint()+this._pbf.pos;return new l(this._pbf,f,this.extent,this._keys,this._values)},ar}function Cr(){return jn||(jn=1,yn.VectorTile=function(){if(pn)return kr;pn=1;var l=xi();function n(a,h,f){if(a===3){var _=new l(f,f.readVarint()+f.pos);_.length&&(h[_.name]=_)}}return kr=function(a,h){this.layers=a.readFields(n,{},h)},kr}(),yn.VectorTileFeature=bn(),yn.VectorTileLayer=xi()),yn}var zr=Cr();const Hr="3d_elevation_id",Wn="level";class $i{constructor(){this._valid=!1}reset(n){return this.feature=n,this._valid=!0,this._geometry=n.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(n,a){return this._valid&&n(a(this._geometry)),this}require(n,a,h){return this.get(n,!0,a,h)}optional(n,a,h){return this.get(n,!1,a,h)}success(){return this._valid}get(n,a,h,f){const _=this.feature.properties.hasOwnProperty(n)?+this.feature.properties[n]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?h(f?f(_):_):a&&(this._valid=!1),this}}class Fn{constructor(n,a){this.featureFunc=n,this.vertexFunc=a}parseFeature(n,a,h){return this.featureFunc(n,a,h)}parseVertex(n,a,h){return this.vertexFunc(n,a,h)}}const an=new Fn((l,n,a)=>l.reset(n).require(Hr,h=>{a.id=h}).optional("fixed_height_relative",h=>{a.constantHeight=h},Jr.decodeRelativeHeight).geometry(h=>{a.bounds=h},Gy).success(),(l,n,a)=>l.reset(n).require(Hr,h=>{a.id=h}).require("elevation_idx",h=>{a.idx=h}).require("extent",h=>{a.extent=h}).require("height_relative",h=>{a.height=h},Jr.decodeRelativeHeight).geometry(h=>{a.position=h},Jr.getPoint).success()),fi=new Fn((l,n,a)=>l.reset(n).require(Hr,h=>{a.id=h}).optional("fixed_height",h=>{a.constantHeight=h},Jr.decodeMetricHeight).geometry(h=>{a.bounds=h},Gy).success(),(l,n,a)=>l.reset(n).require(Hr,h=>{a.id=h}).require("elevation_idx",h=>{a.idx=h}).require("extent",h=>{a.extent=h}).require("height",h=>{a.height=h},Jr.decodeMetricHeight).geometry(h=>{a.position=h},Jr.getPoint).success());class Jr{static getPoint(n){return ls(n[0][0].x,n[0][0].y)}static decodeRelativeHeight(n){return 1e-4*n*5}static decodeMetricHeight(n){return 1e-4*n}static parse(n){const a=[],h=[],f=n.length,_=new $i;for(let b=0;b<f;b++){const E=n.feature(b),A=E.properties.hasOwnProperty("version")?String(E.properties.version):void 0,M=(y=A)?y==="1.0.1"?fi:void 0:an;if(M===void 0){Rr(`Unknown elevation feature version number ${A||"(unknown)"}`);continue}const k=E.properties.hasOwnProperty("type")?E.properties.type:void 0;if(k){if(zr.VectorTileFeature.types[E.type]==="Point"&&k==="curve_point"){const D={};M.parseVertex(_,E,D)&&a.push(D)}else if(zr.VectorTileFeature.types[E.type]==="Polygon"&&k==="curve_meta"){const D={};M.parseFeature(_,E,D)&&h.push(D)}}}var y;return{vertices:a,features:h}}}class Di{constructor(n,a){this.pos=n,this.dir=a}intersectsPlane(n,a,h){const f=wr(a,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((n[0]-this.pos[0])*a[0]+(n[1]-this.pos[1])*a[1])/f;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,!0}}class qn{constructor(n,a){this.pos=n,this.dir=a}intersectsPlane(n,a,h){const f=vr(a,this.dir);if(Math.abs(f)<1e-6)return!1;const _=((n[0]-this.pos[0])*a[0]+(n[1]-this.pos[1])*a[1]+(n[2]-this.pos[2])*a[2])/f;return h[0]=this.pos[0]+this.dir[0]*_,h[1]=this.pos[1]+this.dir[1]*_,h[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(n,a,h){if(function(B,U){var K=B[0],te=B[1],oe=B[2],de=U[0],fe=U[1],Y=U[2];return Math.abs(K-de)<=w*Math.max(1,Math.abs(K),Math.abs(de))&&Math.abs(te-fe)<=w*Math.max(1,Math.abs(te),Math.abs(fe))&&Math.abs(oe-Y)<=w*Math.max(1,Math.abs(oe),Math.abs(Y))}(this.pos,n)||a===0)return h[0]=h[1]=h[2]=0,!1;const[f,_,y]=this.dir,b=this.pos[0]-n[0],E=this.pos[1]-n[1],A=this.pos[2]-n[2],M=f*f+_*_+y*y,k=2*(b*f+E*_+A*y),D=k*k-4*M*(b*b+E*E+A*A-a*a);if(D<0){const B=Math.max(-k/2,0),U=b+f*B,K=E+_*B,te=A+y*B,oe=Math.hypot(U,K,te);return h[0]=U*a/oe,h[1]=K*a/oe,h[2]=te*a/oe,!1}{const B=(-k-Math.sqrt(D))/(2*M);if(B<0){const U=Math.hypot(b,E,A);return h[0]=b*a/U,h[1]=E*a/U,h[2]=A*a/U,!1}return h[0]=b+f*B,h[1]=E+_*B,h[2]=A+y*B,!0}}}class Mn{constructor(n,a,h,f,_){this.TL=n,this.TR=a,this.BR=h,this.BL=f,this.horizon=_}static fromInvProjectionMatrix(n,a,h){const f=[-1,1,1],_=[1,1,1],y=[1,-1,1],b=[-1,-1,1],E=Lt(f,f,n),A=Lt(_,_,n),M=Lt(y,y,n),k=Lt(b,b,n);return new Mn(E,A,M,k,a/h)}}function Zn(l,n,a){let h=1/0,f=-1/0;const _=[];for(const y of l){Nr(_,y,n);const b=vr(_,a);h=Math.min(h,b),f=Math.max(f,b)}return[h,f]}function cn(l,n){let a=!0;for(let h=0;h<l.planes.length;h++){const f=l.planes[h];let _=0;for(let y=0;y<n.length;y++)_+=vr(f,n[y])+f[3]>=0;if(_===0)return 0;_!==n.length&&(a=!1)}return a?2:1}function gi(l,n){for(const a of l.projections){const h=Zn(n,l.points[0],a.axis);if(a.projection[1]<h[0]||a.projection[0]>h[1])return 0}return 1}function Eo(l,n){let a=0;const h=[0,0,0,0];for(let y=0;y<l.length;y++)h[0]=l[y][0],h[1]=l[y][1],h[2]=l[y][2],h[3]=1,(f=h)[0]*(_=n)[0]+f[1]*_[1]+f[2]*_[2]+f[3]*_[3]>=0&&a++;var f,_;return a}class ei{constructor(n,a){this.points=n||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=on.fromPoints(this.points),this.projections=[],this.frustumEdges=[Nr([],this.points[2],this.points[3]),Nr([],this.points[0],this.points[3]),Nr([],this.points[4],this.points[0]),Nr([],this.points[5],this.points[1]),Nr([],this.points[6],this.points[2]),Nr([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const f=[0,-h[2],h[1]],_=[h[2],0,-h[0]];this.projections.push({axis:f,projection:Zn(this.points,this.points[0],f)}),this.projections.push({axis:_,projection:Zn(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(n,a,h,f){const _=Math.pow(2,h),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const M=On([],A,n),k=1/M[3]/a*_;return(D=M)[0]=(B=M)[0]*(U=[k,k,f?1/M[3]:k,k])[0],D[1]=B[1]*U[1],D[2]=B[2]*U[2],D[3]=B[3]*U[3],D;var D,B,U}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const M=Ar([],nr([],Nr([],y[A[0]],y[A[1]]),Nr([],y[A[2]],y[A[1]]))),k=-vr(M,y[A[1]]);return M.concat(k)}),E=[];for(let A=0;A<y.length;A++)E.push([y[A][0],y[A][1],y[A][2]]);return new ei(E,b)}intersectsPrecise(n,a,h){for(let f=0;f<a.length;f++)if(!Eo(n,a[f]))return 0;for(let f=0;f<this.planes.length;f++)if(!Eo(n,this.planes[f]))return 0;for(const f of h)for(const _ of this.frustumEdges){const y=nr([],f,_),b=dt(y);if(b===0)continue;bt(y,y,1/b);const E=Zn(this.points,this.points[0],y),A=Zn(n,this.points[0],y);if(E[0]>A[1]||A[0]>E[1])return 0}return 1}containsPoint(n){for(const a of this.planes){const h=a[3];if(vr([a[0],a[1],a[2]],n)+h<0)return!1}return!0}}class on{static fromPoints(n){const a=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const f of n)Ue(a,a,f),st(h,h,f);return new on(a,h)}static fromTileIdAndHeight(n,a,h){const f=1<<n.canonical.z,_=n.canonical.x,y=n.canonical.y;return new on([_/f,y/f,a],[(_+1)/f,(y+1)/f,h])}static applyTransform(n,a){const h=n.getCorners();for(let f=0;f<h.length;++f)Lt(h[f],h[f],a);return on.fromPoints(h)}static applyTransformFast(n,a){const h=[a[12],a[13],a[14]],f=[...h];for(let _=0;_<3;_++)for(let y=0;y<3;y++){const b=a[4*y+_],E=b*n.min[y],A=b*n.max[y];h[_]+=Math.min(E,A),f[_]+=Math.max(E,A)}return new on(h,f)}static projectAabbCorners(n,a){const h=n.getCorners();for(let f=0;f<h.length;++f)Lt(h[f],h[f],a);return h}constructor(n,a){this.min=n,this.max=a,this.center=bt([],mt([],this.min,this.max),.5)}quadrant(n){const a=[n%2==0,n<2],h=Ke(this.min),f=Ke(this.max);for(let _=0;_<a.length;_++)h[_]=a[_]?this.min[_]:this.center[_],f[_]=a[_]?this.center[_]:this.max[_];return f[2]=this.max[2],new on(h,f)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,a=this.max;return[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]],[n[0],n[1],a[2]],[a[0],n[1],a[2]],[a[0],a[1],a[2]],[n[0],a[1],a[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?cn(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?cn(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,a){return a||this.intersects(n)?gi(n,this.getCorners()):0}intersectsPreciseFlat(n,a){return a||this.intersectsFlat(n)?gi(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let a=0;a<3;++a)if(this.min[a]>n.max[a]||n.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n.min[a]),this.max[a]=Math.max(this.max[a],n.max[a])}encapsulatePoint(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n[a]),this.max[a]=Math.max(this.max[a],n[a])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}Ht(on,"Aabb");class Ts{constructor(n,a){this.feature=n,this.metersToTile=a,this.index=0}get(){const n=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,h=a[1],f=-a[0],_=(n.extent+1)*this.metersToTile;return[new Dt(Math.trunc(n.position[0]+h*_),Math.trunc(n.position[1]+f*_)),new Dt(Math.trunc(n.position[0]-h*_),Math.trunc(n.position[1]-f*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ds{constructor(n,a,h,f,_,y){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=n,this.heightRange={min:h,max:h},this.safeArea=a,this.constantHeight=h,this.constantHeight==null&&(this.constantHeight!=null||f.length!==0)){this.vertices=f,this.edges=_,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((E=this.vertices[b.a].position)[0]===(A=this.vertices[b.b].position)[0]&&E[1]===A[1]);var E,A}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:ls(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const E=this.vertices[b.a].position,A=this.vertices[b.b].position,M=Xa(bo(),A,E),k=zo(M),D=wa(bo(),M,1/k);this.edgeProps.push({vec:M,dir:D,len:k});const B=this.vertexProps[b.a].dir,U=this.vertexProps[b.b].dir;Za(B,B,D),Za(U,U,D)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||mc(b.dir,b.dir);this.tessellate(y)}}pointElevation(n){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(n);if(a==null)return 0;const[h,f]=a;return pr(this.vertices[this.edges[h].a].height,this.vertices[this.edges[h].b].height,f)}computeSlopeNormal(n,a){const h=this.getClosestEdge(n);if(!h)return $e(0,0,1);const f=h[0],_=this.edges[f],y=this.edgeProps[f].vec,b=$e(y[0],y[1],(this.vertices[_.b].height-this.vertices[_.a].height)*a),E=$e(b[1],-b[0],0);nr(E,E,b);const A=dt(E);return A>0?bt(E,E,1/A):$e(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(n){if(this.edges.length===0)return;let a=0,h=Number.POSITIVE_INFINITY,f=0;const _=ls(n.x,n.y);for(let y=0;y<this.edges.length;y++){const b=this.edges[y],E=this.edgeProps[y].dir,A=new Di(_,this.edgeProps[y].dir),M=this.vertices[b.a].position,k=this.vertices[b.b].position,D=bo(),B=bo(),U=A.intersectsPlane(M,this.vertexProps[b.a].dir,D),K=A.intersectsPlane(k,this.vertexProps[b.b].dir,B);if(!U||!K)continue;const te=Xa(bo(),B,D),oe=Xa(bo(),_,D),de=wr(te,te),fe=de>0?wr(oe,te)/de:0,Y=Ee(fe,0,1),le=Math.abs((fe-Y)*this.edgeProps[y].len),pe=Xa(bo(),_,M),ye=le+Math.abs(wr(pe,ls(E[1],-E[0])));ye<h&&(a=y,h=ye,f=Y)}return[a,f]}tessellate(n){for(let a=this.edges.length-1;a>=0;--a){const h=this.edges[a].a,f=this.edges[a].b,{position:_,height:y,extent:b}=this.vertices[h],{position:E,height:A,extent:M}=this.vertices[f],k=this.vertexProps[h].dir,D=this.vertexProps[f].dir,B=$e(_[0]/n,_[1]/n,y),U=$e(E[0]/n,E[1]/n,A),K=$e(k[1],-k[0],0);bt(K,K,b);const te=$e(D[1],-D[0],0);if(bt(te,te,M),this.distSqLines($e(B[0]+.5*K[0],B[1]+.5*K[1],B[2]+.5*K[2]),$e(U[0]-.5*te[0],U[1]-.5*te[1],U[2]-.5*te[2]),$e(B[0]-.5*K[0],B[1]-.5*K[1],B[2]-.5*K[2]),$e(U[0]+.5*te[0],U[1]+.5*te[1],U[2]+.5*te[2]))<=.0025000000000000005)continue;const oe=this.vertices.length,de=Za(bo(),_,E);this.vertices.push({position:wa(de,de,.5),height:.5*(y+A),extent:.5*(b+M)});const fe=Za(bo(),k,D);this.vertexProps.push({dir:mc(fe,fe)}),this.edges.splice(a,1),this.edgeProps.splice(a,1),this.edges.push({a:h,b:oe}),this.edges.push({a:oe,b:f});const Y=Xa(bo(),this.vertices[oe].position,_),le=zo(Y),pe={vec:Y,dir:wa(bo(),Y,1/le),len:le};this.edgeProps.push(pe),this.edgeProps.push(pe)}}distSqLines(n,a,h,f){const _=ct(He(),a,n),y=ct(He(),f,h),b=ct(He(),n,h),E=vr(_,_),A=vr(_,y),M=vr(_,b),k=vr(y,y),D=vr(y,b),B=E*k-A*A;if(B===0){const te=vr(b,y)/vr(y,y);return zt(Xr(He(),h,f,te),n)}const U=(A*D-M*k)/B,K=(E*D-A*M)/B;return zt(Xr(He(),n,a,U),Xr(He(),h,f,K))}}class Gs{static parseFrom(n,a){const h=Jr.parse(n);if(!h)return[];let{vertices:f,features:_}=h;const y=1/tt(a);_.sort((M,k)=>M.id-k.id),f.sort((M,k)=>M.id-k.id||M.idx-k.idx),f=f.filter((M,k,D)=>k===D.findIndex(B=>B.id===M.id&&B.idx===M.idx));const b=new Array;let E=0;const A=f.length;for(const M of _){if(M.constantHeight){b.push(new ds(M.id,M.bounds,M.constantHeight));continue}for(;E!==A&&f[E].id<M.id;)E++;if(E===A||f[E].id!==M.id)continue;const k=new Array,D=new Array,B=E;for(;E!==A&&f[E].id===M.id;){const U=f[E];if(k.push({position:U.position,height:U.height,extent:U.extent}),E!==B&&f[E-1].idx===U.idx-1){const K=E-B;D.push({a:K-1,b:K})}E++}b.push(new ds(M.id,M.bounds,void 0,k,D,y))}return b}static getElevationFeature(n,a){if(!a)return;const h=+n.properties[Hr];return Number.isNaN(h)?void 0:a.find(f=>f.id===h)}}class Ia{constructor(n,a){this.zScale=1,this.xOffset=0,this.yOffset=0,n.equals(a)||(this.zScale=Math.pow(2,a.z-n.z),this.xOffset=(n.x*this.zScale-a.x)*Nt,this.yOffset=(n.y*this.zScale-a.y)*Nt)}constantElevation(n,a){if(n.constantHeight!=null)return this.computeBiasedHeight(n.constantHeight,a)}pointElevation(n,a,h){const f=this.constantElevation(a,h);return f??(n.x=n.x*this.zScale+this.xOffset,n.y=n.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(n),h))}computeBiasedHeight(n,a){return a<=0?n:n+a*ze(0,a,n>=0?n:Math.abs(.5*n))}}Ht(ds,"ElevationFeature");class ua{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Nl,this.indexArray=new To,this.segments=new mi,this.programConfigurations=new p(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ic),this.worldview=n.worldview}updateFootprints(n,a){}populate(n,a,h,f){const _=this.layers[0],y=[];let b=null;_.type==="circle"&&(b=_.layout.get("circle-sort-key"));for(const{feature:A,id:M,index:k,sourceLayerIndex:D}of n){const B=this.layers[0]._featureFilter.needGeometry,U=Vt(A,B);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),U,h))continue;const K=b?b.evaluate(U,{},h):void 0,te={id:M,properties:A.properties,type:A.type,sourceLayerIndex:D,index:k,geometry:B?U.geometry:qt(A,h,f),patterns:{},sortKey:K};y.push(te)}b&&y.sort((A,M)=>A.sortKey-M.sortKey);let E=null;f.projection.name==="globe"&&(this.globeExtVertexArray=new tg,E=f.projection);for(const A of y){const{geometry:M,index:k,sourceLayerIndex:D}=A,B=n[k].feature;this.addFeature(A,M,k,a.availableImages,h,E,a.brightness,a.elevationFeatures),a.featureIndex.insert(B,M,k,D,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(n,a,h,f,_,y,b){this.programConfigurations.updatePaintArrays(n,a,_,h,f,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dP.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,sg.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,fP.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(n,a,h,f,_,y,b,E){let A;this.elevationMode!=="none"&&(A=Gs.getElevationFeature(n,E));for(const M of a)for(const k of M){const D=k.x,B=k.y;if(D<0||D>=Nt||B<0||B>=Nt)continue;if(y){const te=y.projectTilePoint(D,B,_),oe=y.upVector(_,D,B);this.addGlobeExtVertex(te,oe),this.addGlobeExtVertex(te,oe),this.addGlobeExtVertex(te,oe),this.addGlobeExtVertex(te,oe)}const U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),K=U.vertexLength;if(this.addCircleVertex(D,B,-1,-1),this.addCircleVertex(D,B,1,-1),this.addCircleVertex(D,B,1,1),this.addCircleVertex(D,B,-1,1),this.elevationMode!=="none"){const te=A?A.pointElevation(new Dt(D,B)):0;this.hasElevation=this.hasElevation||te!==0;for(let oe=0;oe<4;oe++)this.elevatedLayoutVertexArray.emplaceBack(te)}this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+2,K+3),U.vertexLength+=4,U.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,{},f,_,b,void 0,this.worldview)}addCircleVertex(n,a,h,f){this.layoutVertexArray.emplaceBack(2*n+(h+1)/2,2*a+(f+1)/2)}addGlobeExtVertex(n,a){this.globeExtVertexArray.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function fs(l,n){for(let a=0;a<l.length;a++)if(rl(n,l[a]))return!0;for(let a=0;a<n.length;a++)if(rl(l,n[a]))return!0;return!!Jf(l,n)}function kc(l,n,a){return!!rl(l,n)||!!Qf(n,l,a)}function Oa(l,n){if(l.length===1)return dg(n,l[0]);for(let a=0;a<n.length;a++){const h=n[a];for(let f=0;f<h.length;f++)if(rl(l,h[f]))return!0}for(let a=0;a<l.length;a++)if(dg(n,l[a]))return!0;for(let a=0;a<n.length;a++)if(Jf(l,n[a]))return!0;return!1}function Dc(l,n,a){if(l.length>1){if(Jf(l,n))return!0;for(let h=0;h<n.length;h++)if(Qf(n[h],l,a))return!0}for(let h=0;h<l.length;h++)if(Qf(l[h],n,a))return!0;return!1}function Jf(l,n){if(l.length===0||n.length===0)return!1;for(let a=0;a<l.length-1;a++){const h=l[a],f=l[a+1];for(let _=0;_<n.length-1;_++)if(jv(h,f,n[_],n[_+1]))return!0}return!1}function jv(l,n,a,h){return Cn(l,a,h)!==Cn(n,a,h)&&Cn(l,n,a)!==Cn(l,n,h)}function Uh(l,n,a){return(l.x-a.x)*(n.y-a.y)-(l.y-a.y)*(n.x-a.x)}function Fv(l,n,a,h){const f=Uh(l,n,h),_=Uh(l,n,a);if(Math.sign(f)===Math.sign(_))return;const y=Uh(a,h,l),b=y+_-f;return Math.sign(y)!==Math.sign(b)?[y/(y-b),_/(_-f)]:void 0}function Qf(l,n,a){const h=a*a;if(n.length===1)return l.distSqr(n[0])<h;for(let f=1;f<n.length;f++)if(hg(l,n[f-1],n[f])<h)return!0;return!1}function hg(l,n,a){const h=n.distSqr(a);if(h===0)return l.distSqr(n);const f=((l.x-n.x)*(a.x-n.x)+(l.y-n.y)*(a.y-n.y))/h;return l.distSqr(f<0?n:f>1?a:a.sub(n)._mult(f)._add(n))}function dg(l,n){let a,h,f,_=!1;for(let y=0;y<l.length;y++){a=l[y];for(let b=0,E=a.length-1;b<a.length;E=b++)h=a[b],f=a[E],h.y>n.y!=f.y>n.y&&n.x<(f.x-h.x)*(n.y-h.y)/(f.y-h.y)+h.x&&(_=!_)}return _}function rl(l,n){let a=!1;for(let h=0,f=l.length-1;h<l.length;f=h++){const _=l[h],y=l[f];_.y>n.y!=y.y>n.y&&n.x<(y.x-_.x)*(n.y-_.y)/(y.y-_.y)+_.x&&(a=!a)}return a}function Vh(l,n,a,h,f){for(const y of l)if(n<=y.x&&a<=y.y&&h>=y.x&&f>=y.y)return!0;const _=[new Dt(n,a),new Dt(n,f),new Dt(h,f),new Dt(h,a)];if(l.length>2){for(const y of _)if(rl(l,y))return!0}for(let y=0;y<l.length-1;y++)if(Pu(l[y],l[y+1],_))return!0;return!1}function Pu(l,n,a){const h=a[0],f=a[2];if(l.x<h.x&&n.x<h.x||l.x>f.x&&n.x>f.x||l.y<h.y&&n.y<h.y||l.y>f.y&&n.y>f.y)return!1;const _=Cn(l,n,a[0]);return _!==Cn(l,n,a[1])||_!==Cn(l,n,a[2])||_!==Cn(l,n,a[3])}function Lc(l,n,a,h,f,_){let y=n.y-l.y,b=l.x-n.x;if(_=_||0){const E=y*y+b*b;if(E===0)return!0;const A=Math.sqrt(E);y/=A,b/=A}return!((a.x-l.x)*y+(a.y-l.y)*b-_<0||(h.x-l.x)*y+(h.y-l.y)*b-_<0||(f.x-l.x)*y+(f.y-l.y)*b-_<0)}function mP(l,n,a,h,f,_,y){return!(Lc(l,n,h,f,_,y)||Lc(n,a,h,f,_,y)||Lc(a,l,h,f,_,y)||Lc(h,f,l,n,a,y)||Lc(f,_,l,n,a,y)||Lc(_,h,l,n,a,y))}function fg(l,n,a){const h=n.paint.get(l).value;return h.kind==="constant"?h.value:a.programConfigurations.get(n.id).getMaxValue(l)}function rw(l){return Math.sqrt(l[0]*l[0]+l[1]*l[1])}function XL(l,n,a,h,f){if(!n[0]&&!n[1])return l;const _=Dt.convert(n)._mult(f);a==="viewport"&&_._rotate(-h);const y=[];for(let b=0;b<l.length;b++)y.push(l[b].sub(_));return y}function KL(l,n,a,h){const f=Dt.convert(l)._mult(h);return n==="viewport"&&f._rotate(-a),f}let YL,JL;function QL(l,n,a){var h=2*Math.PI*6378137/256/Math.pow(2,a);return[l*h-2*Math.PI*6378137/2,n*h-2*Math.PI*6378137/2]}Ht(ua,"CircleBucket",{omit:["layers"]});class ep{constructor(n,a,h){this.z=n,this.x=a,this.y=h,this.key=pg(0,n,n,a,h)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a){const h=function(_,y,b){var E=QL(256*_,256*(y=Math.pow(2,b)-y-1),b),A=QL(256*(_+1),256*(y+1),b);return E[0]+","+E[1]+","+A[0]+","+A[1]}(this.x,this.y,this.z),f=function(_,y,b){let E,A="";for(let M=_;M>0;M--)E=1<<M-1,A+=(y&E?1:0)+(b&E?2:0);return A}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",f).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ez{constructor(n,a){this.wrap=n,this.canonical=a,this.key=pg(n,a.z,a.z,a.x,a.y)}}class es{constructor(n,a,h,f,_){this.overscaledZ=n,this.wrap=a,this.canonical=new ep(h,+f,+_),this.key=a===0&&n===h?this.canonical.key:pg(a,n,h,f,_)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const a=this.canonical.z-n;return n>this.canonical.z?new es(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new es(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a=!0){if(this.overscaledZ===n&&a)return this.key;if(n>this.canonical.z)return pg(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-n;return pg(this.wrap*+a,n,n,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,f=2*this.canonical.y;return[new es(a,this.wrap,a,h,f),new es(a,this.wrap,a,h+1,f),new es(a,this.wrap,a,h,f+1),new es(a,this.wrap,a,h+1,f+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new es(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ez(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function pg(l,n,a,h,f){const _=1<<Math.min(a,22);let y=_*(f%_)+h%_;return l&&a<22&&(y+=_*_*((l<0?-2*l-1:2*l)%(1<<2*(22-a)))),16*(32*y+a)+(n-a)}const lK=[l=>{let n=l.canonical.x-1,a=l.wrap;return n<0&&(n=(1<<l.canonical.z)-1,a--),new es(l.overscaledZ,a,l.canonical.z,n,l.canonical.y)},l=>{let n=l.canonical.x+1,a=l.wrap;return n===1<<l.canonical.z&&(n=0,a++),new es(l.overscaledZ,a,l.canonical.z,n,l.canonical.y)},l=>new es(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,(l.canonical.y===0?1<<l.canonical.z:l.canonical.y)-1),l=>new es(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y===(1<<l.canonical.z)-1?0:l.canonical.y+1)];Ht(ep,"CanonicalTileID"),Ht(es,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const cK=rn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:nw}=cK,uK=rn([{name:"a_pos_3",components:3,type:"Int16"}]);var tz=rn([{name:"a_pos",type:"Int16",components:2}]);function iw(l){return l*S/ie}const hK=[new on([$,$,$],[W,W,W]),new on([$,$,$],[0,0,W]),new on([0,$,$],[W,0,W]),new on([$,0,$],[0,W,W]),new on([0,0,$],[W,W,W])];function rz(l,n,a,h=!0){const f=bt([],l._camera.position,l.worldSize),_=[n,a,1,1];On(_,_,l.pixelMatrixInverse),Ei(_,_,1/_[3]);const y=Ar([],Nr([],_,f)),b=l.globeMatrix,E=[b[12],b[13],b[14]],A=Nr([],E,f),M=dt(A),k=Ar([],A),D=l.worldSize/(2*Math.PI),B=vr(k,y),U=Math.asin(D/M);if(U<Math.acos(B)){if(!h)return null;const ke=[],je=[];bt(ke,y,M/B),Ar(je,Nr(je,ke,A)),Ar(y,mt(y,A,bt(y,je,Math.tan(U)*M)))}const K=[];new qn(f,y).closestPointOnSphere(E,D,K);const te=Ar([],hi(b,0)),oe=Ar([],hi(b,1)),de=Ar([],hi(b,2)),fe=vr(te,K),Y=vr(oe,K),le=vr(de,K),pe=Je(Math.asin(-Y/D));let ye=Je(Math.atan2(fe,le));ye=l.center.lng+function(ke,je){const rt=(je-ke+180)%360-180;return rt<-180?rt+360:rt}(l.center.lng,ye);const Re=Te(ye),Ie=Ee(we(pe),0,1);return new Le(Re,Ie)}class dK{constructor(n,a,h){this.a=Nr([],n,h),this.b=Nr([],a,h),this.center=h;const f=Ar([],this.a),_=Ar([],this.b);this.angle=Math.acos(vr(f,_))}}function gP(l,n){if(l.angle===0)return null;let a;return a=l.a[n]===0?1/l.angle*.5*Math.PI:1/l.angle*Math.atan(l.b[n]/l.a[n]/Math.sin(l.angle)-1/Math.tan(l.angle)),a<0||a>1?null:function(h,f,_,y){const b=Math.sin(_);return h*(Math.sin((1-y)*_)/b)+f*(Math.sin(y*_)/b)}(l.a[n],l.b[n],l.angle,Ee(a,0,1))+l.center[n]}function zc(l){if(l.z<=1)return hK[l.z+2*l.y+l.x];const n=_P(ow(l));return on.fromPoints(n)}function Cu(l,n,a){return bt(l,l,1-a),At(l,l,n,a)}function nz(l,n,a){for(const h of l)Lt(h,h,n),bt(h,h,a)}function iz(l,n,a,h){const f=n/l.worldSize,_=l.globeMatrix;if(a.z<=1){const Ie=zc(a).getCorners();return nz(Ie,_,f),on.fromPoints(Ie)}const y=ow(a,h),b=_P(y,S+iw(l._tileCoverLift));nz(b,_,f);const E=Number.MAX_VALUE,A=[-E,-E,-E],M=[E,E,E];if(y.contains(l.center)){for(const je of b)Ue(M,M,je),st(A,A,je);A[2]=0;const Ie=l.point,ke=[Ie.x*f,Ie.y*f,0];return Ue(M,M,ke),st(A,A,ke),new on(M,A)}if(l._tileCoverLift>0){for(const Ie of b)Ue(M,M,Ie),st(A,A,Ie);return new on(M,A)}const k=[_[12]*f,_[13]*f,_[14]*f],D=y.getCenter(),B=Ee(l.center.lat,-85.051129,at),U=Ee(D.lat,-85.051129,at),K=Te(l.center.lng),te=we(B);let oe=K-Te(D.lng);const de=te-we(U);oe>.5?oe-=1:oe<-.5&&(oe+=1);let fe=0;Math.abs(oe)>Math.abs(de)?fe=oe>=0?1:3:(fe=de>=0?0:2,At(k,k,[_[4]*f,_[5]*f,_[6]*f],-Math.sin(nn(de>=0?y.getSouth():y.getNorth()))*S));const Y=b[fe],le=b[(fe+1)%4],pe=new dK(Y,le,k),ye=[gP(pe,0)||Y[0],gP(pe,1)||Y[1],gP(pe,2)||Y[2]],Re=Gh(l.zoom);if(Re>0){const Ie=function({x:je,y:rt,z:xt},ft,vt,wt,it){const _t=1/(1<<xt);let et=je*_t,nt=et+_t,Pt=rt*_t,It=Pt+_t,sr=0;const Kt=(et+nt)/2-wt;return Kt>.5?sr=-1:Kt<-.5&&(sr=1),et=((et+sr)*ft-(wt*=ft))*vt+wt,nt=((nt+sr)*ft-wt)*vt+wt,Pt=(Pt*ft-(it*=ft))*vt+it,It=(It*ft-it)*vt+it,[[et,It,0],[nt,It,0],[nt,Pt,0],[et,Pt,0]]}(a,n,l._pixelsPerMercatorPixel,K,te);for(let je=0;je<b.length;je++)Cu(b[je],Ie[je],Re);const ke=mt([],Ie[fe],Ie[(fe+1)%4]);bt(ke,ke,.5),Cu(ye,ke,Re)}for(const Ie of b)Ue(M,M,Ie),st(A,A,Ie);return M[2]=Math.min(Y[2],le[2]),Ue(M,M,ye),st(A,A,ye),new on(M,A)}function ow({x:l,y:n,z:a},h=!1){const f=1/(1<<a),_=new ce(Oe(l*f),n===(1<<a)-1&&h?-90:Ve((n+1)*f)),y=new ce(Oe((l+1)*f),n===0&&h?90:Ve(n*f));return new _e(_,y)}function _P(l,n=S){const a=nn(l.getNorth()),h=nn(l.getSouth()),f=Math.cos(a),_=Math.cos(h),y=Math.sin(a),b=Math.sin(h),E=l.getWest(),A=l.getEast();return[re(_,b,E,n),re(_,b,A,n),re(f,y,A,n),re(f,y,E,n)]}function Bv(l,n,a,h){const f=1<<a.z,_=(l/Nt+a.x)/f;return ee(Ve((n/Nt+a.y)/f),Oe(_),h)}function sw({min:l,max:n}){return L/Math.max(n[0]-l[0],n[1]-l[1],n[2]-l[2])}const oz=new Float64Array(16);function aw(l){const n=sw(l),a=me(oz,[n,n,n]);return q(a,a,Mr([],l.min))}function yP(l){const n=(h=l.min,(a=oz)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=h[0],a[13]=h[1],a[14]=h[2],a[15]=1,a);var a,h;const f=1/sw(l);return Z(n,n,[f,f,f])}function vP(l){const n=Nt/(2*Math.PI);return l/(2*Math.PI)/n}function sz(l,n){return Nt/(512*Math.pow(2,l))*sw(zc(n))}function az(l,n,a,h,f){const _=vP(a),y=[l,n,-a/(2*Math.PI)],b=j(new Float64Array(16));return q(b,b,y),Z(b,b,[_,_,_]),J(b,b,nn(-f)),ne(b,b,nn(-h)),b}function Gh(l){return ze(P,O,l)}function lz(l,n){const a=ee(n.lat,n.lng),h=function(U){const K=ee(U._center.lat,U._center.lng);let te=nr([],$e(0,1,0),K);const oe=Se([],-U.angle,K);te=Lt(te,te,oe),Se(oe,-U._pitch,te);const de=Ar([],K);return bt(de,de,iw(U.cameraToCenterDistance/U.pixelsPerMeter)),Lt(de,de,oe),mt([],K,de)}(l);return y=(f=ct([],h,a))[0],b=f[1],E=f[2],A=(_=a)[0],M=_[1],k=_[2],B=(D=Math.sqrt(y*y+b*b+E*E)*Math.sqrt(A*A+M*M+k*k))&&vr(f,_)/D,Math.acos(Math.min(Math.max(B,-1),1));var f,_,y,b,E,A,M,k,D,B}function xP(l,n){return lz(l,n)>Math.PI/2*1.01}const cz=nn(85),fK=Math.cos(cz),pK=Math.sin(cz),mK=G(),uz=l=>{const n=[];return l.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),l.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function hz(l,n,a,h,f,_,y,b,E){if(_&&l.queryGeometry.isAboveHorizon)return!1;_&&(E*=l.pixelToTileUnitsFactor);const A=l.tileID.canonical,M=a.projection.upVectorScale(A,a.center.lat,a.worldSize).metersToTile;for(const k of n)for(const D of k){const B=D.add(b),U=f&&a.elevation?a.elevation.exaggeration()*f.getElevationAt(B.x,B.y,!0):0,K=a.projection.projectTilePoint(B.x,B.y,A);if(U>0){const fe=a.projection.upVector(A,B.x,B.y);K.x+=fe[0]*M*U,K.y+=fe[1]*M*U,K.z+=fe[2]*M*U}const te=_?B:gK(K.x,K.y,K.z,h),oe=_?l.tilespaceRays.map(fe=>yK(fe,U)):l.queryGeometry.screenGeometry,de=On([],[K.x,K.y,K.z,1],h);if(!y&&_?E*=de[3]/a.cameraToCenterDistance:y&&!_&&(E*=a.cameraToCenterDistance/de[3]),_){const fe=Ve((D.y/Nt+A.y)/(1<<A.z));E/=a.projection.pixelsPerMeter(fe,1)/Ce(1,fe)}if(kc(oe,te,E))return!0}return!1}function gK(l,n,a,h){const f=On([],[l,n,a,1],h);return new Dt(f[0]/f[3],f[1]/f[3])}const dz=$e(0,0,0),_K=$e(0,0,1);function yK(l,n){const a=He();return dz[2]=n,l.intersectsPlane(dz,_K,a),new Dt(a[0],a[1])}class fz extends ua{}let pz,mz,gz,_z;function yz(l,{width:n,height:a},h,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==n*a*h)throw new RangeError("mismatched image size")}else f=new Uint8Array(n*a*h);return l.width=n,l.height=a,l.data=f,l}function vz(l,n,a){const{width:h,height:f}=n;h===l.width&&f===l.height||(bP(l,n,{x:0,y:0},{x:0,y:0},{width:Math.min(l.width,h),height:Math.min(l.height,f)},a,null),l.width=h,l.height=f,l.data=n.data)}function bP(l,n,a,h,f,_,y,b){if(f.width===0||f.height===0)return n;if(f.width>l.width||f.height>l.height||a.x>l.width-f.width||a.y>l.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>n.width||f.height>n.height||h.x>n.width-f.width||h.y>n.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const E=l.data,A=n.data,M=_===4&&b;for(let k=0;k<f.height;k++){const D=((a.y+k)*l.width+a.x)*_,B=((h.y+k)*n.width+h.x)*_;if(M)for(let U=0;U<f.width;U++){const K=D+U*_+3,te=B+U*_;A[te+0]=255,A[te+1]=255,A[te+2]=255,A[te+3]=E[K]}else if(y)for(let U=0;U<f.width;U++){const K=D+U*_,te=B+U*_,oe=new dn(E[K+0]/255,E[K+1]/255,E[K+2]/255,E[K+3]).toNonPremultipliedRenderColor(y).toArray();A[te+0]=oe[0],A[te+1]=oe[1],A[te+2]=oe[2],A[te+3]=oe[3]}else for(let U=0;U<f.width*_;U++)A[B+U]=E[D+U]}return n}Ht(fz,"HeatmapBucket",{omit:["layers"]});class Hh{constructor(n,a){yz(this,n,1,a)}resize(n){vz(this,new Hh(n),1)}clone(){return new Hh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,h,f,_){bP(n,a,h,f,_,1,null)}}class Oo{constructor(n,a){yz(this,n,4,a)}resize(n){vz(this,new Oo(n),4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Oo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,h,f,_,y,b){bP(n,a,h,f,_,4,y,b)}}class xz{constructor(n,a){this.width=n.width,this.height=n.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function $v(l){const n={},a=l.resolution||256,h=l.clips?l.clips.length:1,f=l.image||new Oo({width:a,height:h}),_=(y,b,E)=>{n[l.evaluationKey]=E;const A=l.expression.evaluate(n),M=A?A.toNonPremultipliedRenderColor(null):null;M&&(f.data[y+b+0]=Math.floor(255*M.r),f.data[y+b+1]=Math.floor(255*M.g),f.data[y+b+2]=Math.floor(255*M.b),f.data[y+b+3]=Math.floor(255*M.a))};if(l.clips)for(let y=0,b=0;y<h;++y,b+=4*a)for(let E=0,A=0;E<a;E++,A+=4){const M=E/(a-1),{start:k,end:D}=l.clips[y];_(b,A,k*(1-M)+D*M)}else for(let y=0,b=0;y<a;y++,b+=4)_(0,b,y/(a-1));return f}Ht(Hh,"AlphaImage"),Ht(Oo,"RGBAImage");const vK=rn([{name:"a_pos",components:2,type:"Int16"}],4),xK=rn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),bK=rn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),wK=rn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Uv(l,n,a=2){const h=n&&n.length,f=h?n[0]*a:l.length;let _=bz(l,0,f,a,!0);const y=[];if(!_||_.next===_.prev)return y;let b,E,A;if(h&&(_=function(M,k,D,B){const U=[];for(let K=0,te=k.length;K<te;K++){const oe=bz(M,k[K]*B,K<te-1?k[K+1]*B:M.length,B,!1);oe===oe.next&&(oe.steiner=!0),U.push(OK(oe))}U.sort(PK);for(let K=0;K<U.length;K++)D=CK(U[K],D);return D}(l,n,_,a)),l.length>80*a){b=1/0,E=1/0;let M=-1/0,k=-1/0;for(let D=a;D<f;D+=a){const B=l[D],U=l[D+1];B<b&&(b=B),U<E&&(E=U),B>M&&(M=B),U>k&&(k=U)}A=Math.max(M-b,k-E),A=A!==0?32767/A:0}return Vv(_,y,a,b,E,A,0),y}function bz(l,n,a,h,f){let _;if(f===function(y,b,E,A){let M=0;for(let k=b,D=E-A;k<E;k+=A)M+=(y[D]-y[k])*(y[k+1]+y[D+1]),D=k;return M}(l,n,a,h)>0)for(let y=n;y<a;y+=h)_=Ez(y/h|0,l[y],l[y+1],_);else for(let y=a-h;y>=n;y-=h)_=Ez(y/h|0,l[y],l[y+1],_);return _&&mg(_,_.next)&&(Wv(_),_=_.next),_}function tp(l,n){if(!l)return l;n||(n=l);let a,h=l;do if(a=!1,h.steiner||!mg(h,h.next)&&co(h.prev,h,h.next)!==0)h=h.next;else{if(Wv(h),h=n=h.prev,h===h.next)break;a=!0}while(a||h!==n);return n}function Vv(l,n,a,h,f,_,y){if(!l)return;!y&&_&&function(E,A,M,k){let D=E;do D.z===0&&(D.z=wP(D.x,D.y,A,M,k)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==E);D.prevZ.nextZ=null,D.prevZ=null,function(B){let U,K=1;do{let te,oe=B;B=null;let de=null;for(U=0;oe;){U++;let fe=oe,Y=0;for(let pe=0;pe<K&&(Y++,fe=fe.nextZ,fe);pe++);let le=K;for(;Y>0||le>0&&fe;)Y!==0&&(le===0||!fe||oe.z<=fe.z)?(te=oe,oe=oe.nextZ,Y--):(te=fe,fe=fe.nextZ,le--),de?de.nextZ=te:B=te,te.prevZ=de,de=te;oe=fe}de.nextZ=null,K*=2}while(U>1)}(D)}(l,h,f,_);let b=l;for(;l.prev!==l.next;){const E=l.prev,A=l.next;if(_?TK(l,h,f,_):SK(l))n.push(E.i,l.i,A.i),Wv(l),l=A.next,b=A.next;else if((l=A)===b){y?y===1?Vv(l=EK(tp(l),n),n,a,h,f,_,2):y===2&&AK(l,n,a,h,f,_):Vv(tp(l),n,a,h,f,_,1);break}}}function SK(l){const n=l.prev,a=l,h=l.next;if(co(n,a,h)>=0)return!1;const f=n.x,_=a.x,y=h.x,b=n.y,E=a.y,A=h.y,M=Math.min(f,_,y),k=Math.min(b,E,A),D=Math.max(f,_,y),B=Math.max(b,E,A);let U=h.next;for(;U!==n;){if(U.x>=M&&U.x<=D&&U.y>=k&&U.y<=B&&Gv(f,b,_,E,y,A,U.x,U.y)&&co(U.prev,U,U.next)>=0)return!1;U=U.next}return!0}function TK(l,n,a,h){const f=l.prev,_=l,y=l.next;if(co(f,_,y)>=0)return!1;const b=f.x,E=_.x,A=y.x,M=f.y,k=_.y,D=y.y,B=Math.min(b,E,A),U=Math.min(M,k,D),K=Math.max(b,E,A),te=Math.max(M,k,D),oe=wP(B,U,n,a,h),de=wP(K,te,n,a,h);let fe=l.prevZ,Y=l.nextZ;for(;fe&&fe.z>=oe&&Y&&Y.z<=de;){if(fe.x>=B&&fe.x<=K&&fe.y>=U&&fe.y<=te&&fe!==f&&fe!==y&&Gv(b,M,E,k,A,D,fe.x,fe.y)&&co(fe.prev,fe,fe.next)>=0||(fe=fe.prevZ,Y.x>=B&&Y.x<=K&&Y.y>=U&&Y.y<=te&&Y!==f&&Y!==y&&Gv(b,M,E,k,A,D,Y.x,Y.y)&&co(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;fe&&fe.z>=oe;){if(fe.x>=B&&fe.x<=K&&fe.y>=U&&fe.y<=te&&fe!==f&&fe!==y&&Gv(b,M,E,k,A,D,fe.x,fe.y)&&co(fe.prev,fe,fe.next)>=0)return!1;fe=fe.prevZ}for(;Y&&Y.z<=de;){if(Y.x>=B&&Y.x<=K&&Y.y>=U&&Y.y<=te&&Y!==f&&Y!==y&&Gv(b,M,E,k,A,D,Y.x,Y.y)&&co(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function EK(l,n){let a=l;do{const h=a.prev,f=a.next.next;!mg(h,f)&&Sz(h,a,a.next,f)&&Hv(h,f)&&Hv(f,h)&&(n.push(h.i,a.i,f.i),Wv(a),Wv(a.next),a=l=f),a=a.next}while(a!==l);return tp(a)}function AK(l,n,a,h,f,_){let y=l;do{let b=y.next.next;for(;b!==y.prev;){if(y.i!==b.i&&MK(y,b)){let E=Tz(y,b);return y=tp(y,y.next),E=tp(E,E.next),Vv(y,n,a,h,f,_,0),void Vv(E,n,a,h,f,_,0)}b=b.next}y=y.next}while(y!==l)}function PK(l,n){let a=l.x-n.x;return a===0&&(a=l.y-n.y,a===0)&&(a=(l.next.y-l.y)/(l.next.x-l.x)-(n.next.y-n.y)/(n.next.x-n.x)),a}function CK(l,n){const a=function(f,_){let y=_;const b=f.x,E=f.y;let A,M=-1/0;if(mg(f,y))return y;do{if(mg(f,y.next))return y.next;if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){const K=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(K<=b&&K>M&&(M=K,A=y.x<y.next.x?y:y.next,K===b))return A}y=y.next}while(y!==_);if(!A)return null;const k=A,D=A.x,B=A.y;let U=1/0;y=A;do{if(b>=y.x&&y.x>=D&&b!==y.x&&wz(E<B?b:M,E,D,B,E<B?M:b,E,y.x,y.y)){const K=Math.abs(E-y.y)/(b-y.x);Hv(y,f)&&(K<U||K===U&&(y.x>A.x||y.x===A.x&&IK(A,y)))&&(A=y,U=K)}y=y.next}while(y!==k);return A}(l,n);if(!a)return n;const h=Tz(a,l);return tp(h,h.next),tp(a,a.next)}function IK(l,n){return co(l.prev,l,n.prev)<0&&co(n.next,l,l.next)<0}function wP(l,n,a,h,f){return(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-a)*f|0)|l<<8))|l<<4))|l<<2))|l<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-h)*f|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function OK(l){let n=l,a=l;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==l);return a}function wz(l,n,a,h,f,_,y,b){return(f-y)*(n-b)>=(l-y)*(_-b)&&(l-y)*(h-b)>=(a-y)*(n-b)&&(a-y)*(_-b)>=(f-y)*(h-b)}function Gv(l,n,a,h,f,_,y,b){return!(l===y&&n===b)&&wz(l,n,a,h,f,_,y,b)}function MK(l,n){return l.next.i!==n.i&&l.prev.i!==n.i&&!function(a,h){let f=a;do{if(f.i!==a.i&&f.next.i!==a.i&&f.i!==h.i&&f.next.i!==h.i&&Sz(f,f.next,a,h))return!0;f=f.next}while(f!==a);return!1}(l,n)&&(Hv(l,n)&&Hv(n,l)&&function(a,h){let f=a,_=!1;const y=(a.x+h.x)/2,b=(a.y+h.y)/2;do f.y>b!=f.next.y>b&&f.next.y!==f.y&&y<(f.next.x-f.x)*(b-f.y)/(f.next.y-f.y)+f.x&&(_=!_),f=f.next;while(f!==a);return _}(l,n)&&(co(l.prev,l,n.prev)||co(l,n.prev,n))||mg(l,n)&&co(l.prev,l,l.next)>0&&co(n.prev,n,n.next)>0)}function co(l,n,a){return(n.y-l.y)*(a.x-n.x)-(n.x-l.x)*(a.y-n.y)}function mg(l,n){return l.x===n.x&&l.y===n.y}function Sz(l,n,a,h){const f=cw(co(l,n,a)),_=cw(co(l,n,h)),y=cw(co(a,h,l)),b=cw(co(a,h,n));return f!==_&&y!==b||!(f!==0||!lw(l,a,n))||!(_!==0||!lw(l,h,n))||!(y!==0||!lw(a,l,h))||!(b!==0||!lw(a,n,h))}function lw(l,n,a){return n.x<=Math.max(l.x,a.x)&&n.x>=Math.min(l.x,a.x)&&n.y<=Math.max(l.y,a.y)&&n.y>=Math.min(l.y,a.y)}function cw(l){return l>0?1:l<0?-1:0}function Hv(l,n){return co(l.prev,l,l.next)<0?co(l,n,l.next)>=0&&co(l,l.prev,n)>=0:co(l,n,l.prev)<0||co(l,l.next,n)<0}function Tz(l,n){const a=SP(l.i,l.x,l.y),h=SP(n.i,n.x,n.y),f=l.next,_=n.prev;return l.next=n,n.prev=l,a.next=f,f.prev=a,h.next=a,a.prev=h,_.next=h,h.prev=_,h}function Ez(l,n,a,h){const f=SP(l,n,a);return h?(f.next=h.next,f.prev=h,h.next.prev=f,h.next=f):(f.prev=f,f.next=f),f}function Wv(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function SP(l,n,a){return{i:l,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function uw(l,n){const a=l.length;if(a<=1)return[l];const h=[];let f,_;for(let y=0;y<a;y++){const b=Yn(l[y]);b!==0&&(l[y].area=Math.abs(b),_===void 0&&(_=b<0),_===b<0?(f&&h.push(f),f=[l[y]]):f.push(l[y]))}if(f&&h.push(f),n>1)for(let y=0;y<h.length;y++)h[y].length<=n||(jo(h[y],n,1,h[y].length-1,RK),h[y]=h[y].slice(0,n));return h}function RK(l,n){return n.area-l.area}function Az(l,n,a=1){if(!l)return null;const h=typeof l=="string"?hs.from(l).getPrimary():l.getPrimary(),f=typeof l=="string"?null:l.getSecondary();for(const _ of[h,f]){if(!_)continue;const y=_.id.toString();n.has(y)||n.set(y,[]),_.scaleSelf(a),n.get(y).push(_)}return{primary:h.toString(),secondary:f?f.toString():null}}function TP(l,n,a,h){const f=h.patternDependencies;let _=!1;for(const y of n){const b=y.paint.get(`${l}-pattern`);b.isConstant()||(_=!0),Az(b.constantOr(null),f,a)&&(_=!0)}return _}function EP(l,n,a,h,f,_){const y=_.patternDependencies;for(const b of n){const E=b.paint.get(`${l}-pattern`).value;if(E.kind!=="constant"){let A=E.evaluate({zoom:h},a,{},_.availableImages);A=A&&A.name?A.name:A;const M=Az(A,y,f);if(!M)continue;const{primary:k,secondary:D}=M;k&&(a.patterns[b.id]=[k,D].filter(Boolean))}}return a}class Pz{constructor(){this.polygons=new Map}add(n,...a){this.polygons.has(n)?this.polygons.get(n).push(...a):this.polygons.set(n,a)}merge(n){for(const[a,h]of n.polygons)this.add(a,...h)}}class rp{constructor(){this.portals=[]}static evaluate(n){if(n.length===0)return new rp;let a=[];for(const A of n)a.push(...A.portals);if(a.length===0)return new rp;const h=(A,M)=>A<=0&&M<=0||A>=Nt&&M>=Nt;for(const A of a){const M=A.va,k=A.vb;(h(M.x,k.x)||h(M.y,k.y))&&(A.type="border")}const f=a.filter(A=>A.type!=="unevaluated"),_=a.filter(A=>A.type==="unevaluated");if(_.length===0)return new rp;_.sort((A,M)=>A.hash===M.hash?A.isTunnel===M.isTunnel?0:A.isTunnel?-1:1:A.hash<M.hash?1:-1),a=f.concat(_);let y=f.length,b=y,E=y;do if(b++,b===a.length||a[y].hash!==a[b].hash){if(b-y==2){E<y&&(a[E]=a[y],a[y]=null);const A=a[E],M=a[b-1];A.type=A.isTunnel!==M.isTunnel?"tunnel":"polygon",A.connection={a:A.connection.a,b:M.connection.a},E++}y=b}while(y!==a.length);return a.splice(E),a.sort((A,M)=>A.hash<M.hash?1:-1),{portals:a}}}Ht(rp,"ElevationPortalGraph"),Ht(Pz,"ElevationPolygons");class kK{constructor(n,a,h){this.outPositions=n,this.outNormals=a,this.outIndices=h,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(n,a,h){let f=n[2];h!=null&&(f*=h);const _=this.getVec3Bits(n)<<96n|this.getVec3Bits(a),y=this.vertexLookup.get(_);if(y!=null)return y;const b=this.outPositions.length;this.vertexLookup.set(_,b);const E=Math.trunc(16384*a[0]),A=Math.trunc(16384*a[1]),M=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(n[0],n[1],f),this.outNormals.emplaceBack(E,A,M),b}addVertices(n,a,...h){const f=[];for(const _ of h){const y=this.addVertex(_,n,a);f.push(y)}return f}addTriangles(n,a,h){if(a&&h){const f=h.length===1,_=$e(0,0,0);for(let y=0;y<n.length;y+=3){const b=a[n[y+0]],E=a[n[y+1]],A=a[n[y+2]],M=f?h[0]:h[n[y+1]],k=f?h[0]:h[n[y+2]],D=this.addVertex($e(b.x,b.y,f?h[0]:h[n[y+0]]),_),B=this.addVertex($e(E.x,E.y,M),_),U=this.addVertex($e(A.x,A.y,k),_);this.outIndices.emplaceBack(D,B,U)}}else for(let f=0;f<n.length;f+=3)this.outIndices.emplaceBack(n[f+0],n[f+1],n[f+2])}addQuad(n,a){const h=this.addVertices(a,void 0,...n.map(E=>$e(E.coord.x,E.coord.y,E.height))),[f,_,y,b]=h;this.addTriangles([f,_,y,y,b,f])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(n){return this.view.setFloat32(0,n),BigInt(this.view.getUint32(0))}getVec3Bits(n){return this.getBits(n[0])<<64n|this.getBits(n[1])<<32n|this.getBits(n[2])}}class ha{constructor(n,a,h,f){this.unevaluatedPortals=new rp,this.portalPolygons=new Pz,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Tv,this.vertexNormals=new eg,this.indexArray=new To,this.tileToMeters=tt(n),this.bridgeProgramConfigurations=new p(a,{zoom:h,lut:f},_=>_!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new p(a,{zoom:h,lut:f},_=>_!=="fill-bridge-guard-rail-color")}addVertices(n,a){const h=this.unevalVertices.length;for(let f=0;f<n.length;f++)this.unevalVertices.push(n[f]),this.unevalHeights.push(a[f]);return h}addTriangles(n,a,h){const f=h?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of n)f.push(_+a)}addRenderableRing(n,a,h,f,_,y){const b=[new Dt(_.min.x,_.min.y),new Dt(_.max.x,_.min.y),new Dt(_.max.x,_.max.y),new Dt(_.min.x,_.max.y)];for(let E=0;E<h-1;E++){const A=a+E,M=A+1,k=this.unevalVertices[A],D=this.unevalVertices[M];if(!(k.x>=_.min.x&&k.x<=_.max.x&&k.y>=_.min.y&&k.y<=_.max.y||D.x>=_.min.x&&D.x<=_.max.x&&D.y>=_.min.y&&D.y<=_.max.y||Pu(k,D,b))||this.isOnBorder(k.x,D.x)||this.isOnBorder(k.y,D.y))continue;const B=ha.computeEdgeHash(this.unevalVertices[A],this.unevalVertices[M]);let U,K=this.vertexHashLookup.get(ha.computePosHash(k));K!=null?U=K.next:(K=this.vertexHashLookup.get(ha.computePosHash(D)),U=K!=null?K.prev:B),this.unevalEdges.push({polygonIdx:n,a:A,b:M,hash:B,portalHash:U,isTunnel:f,type:"unevaluated",featureInfo:y})}}addPortalCandidates(n,a,h,f,_){if(a.length===0)return;this.portalPolygons.add(n,{geometry:a,zLevel:_});const y=a[0];this.vertexHashLookup.clear();let b=ha.computeEdgeHash(y[y.length-2],y[y.length-1]);for(let E=0;E<y.length-1;E++){const A=y[E+0],M=y[E+1],k=ls(M.x-A.x,M.y-A.y),D=zo(k);if(D===0)continue;let B="unevaluated";const U=f.pointElevation(A),K=f.pointElevation(M);Math.abs(U)<.01&&Math.abs(K)<.01?B="entrance":(this.isOnBorder(A.x,M.x)||this.isOnBorder(A.y,M.y))&&(B="border");const te=ha.computeEdgeHash(A,M);this.unevaluatedPortals.portals.push({connection:{a:n,b:void 0},va:A,vb:M,vab:k,length:D,hash:te,isTunnel:h,type:B});const oe=ha.computePosHash(A);this.vertexHashLookup.set(oe,{prev:b,next:te}),b=te}}construct(n){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),h=D=>{D.primitiveLength=this.indexArray.length-D.primitiveOffset},f=new kK(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(n.portals,this.unevalEdges);const _=a(),y=a(),b=a(),E=(D,B)=>{D.sort((K,te)=>K.type===B&&te.type!==B?-1:K.type!==B&&te.type===B?1:0);const U=D.findIndex(K=>K.type!==B);return U>=0?U:D.length};let A=0;this.unevalEdges.length>0&&(A=E(this.unevalEdges,"none"),this.constructBridgeStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},this.tileToMeters)),h(b);const M=a(),k=a();if(this.unevalEdges.length>0){const D=this.unevalEdges.splice(A),B=E(D,"tunnel")+A;this.unevalEdges.push(...D),this.constructTunnelStructures(f,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:A},{min:A,max:B})}h(M),f.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),h(k),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),h(y),f.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),h(_),this.maskSegments=mi.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.depthSegments=mi.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.renderableBridgeSegments=mi.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=mi.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.shadowCasterSegments=mi.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(n,a,h,f,_,y,b,E){this.bridgeProgramConfigurations.updatePaintArrays(n,a,_,h,f,y,b,E),this.tunnelProgramConfigurations.updatePaintArrays(n,a,_,h,f,y,b,E)}upload(n){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=n.createVertexBuffer(this.vertexPositions,bK.members),this.vertexBufferNormal=n.createVertexBuffer(this.vertexNormals,wK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(n),this.tunnelProgramConfigurations.upload(n))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(n,a,h,f,_){const y=(b,E)=>{for(let A=0;A<E.length-1;A++){const M=E[A].featureIndex,k=E[A+1].vertexStart,D=n.feature(M);b.populatePaintArrays(k,D,M,{},h,a,f,void 0,_)}};y(this.bridgeProgramConfigurations,this.bridgeFeatureSections),y(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(n,a,h,f,_){const y=new Map;for(let b=f;b<_;b++){const E=h[b],A=E.a,M=E.b,k=ha.computePosHash(n[A]),D=ha.computePosHash(n[M]);y.has(k)||y.set(k,{}),y.has(D)||y.set(D,{});const B=y.get(k),U=y.get(D);a[A]<=0&&a[M]<=0||(B.to=M,U.from=A)}return y}constructBridgeStructures(n,a,h,f,_,y){n.clearVertexLookup();const b=this.computeVertexConnections(a,h,f,_.min,_.max),E=1/y,A=.5*E,M=B=>$e(a[B].x,a[B].y,h[B]*E),k=B=>{const U=b.get(ha.computePosHash(a[B])),K=U.from,te=U.to;if(!K||!te)return;const oe=M(K),de=M(B),fe=M(te),Y=$e(0,0,0);if(!Mt(oe,de)){const pe=Nr(He(),de,oe);mt(Y,Y,Ar(pe,pe))}if(!Mt(fe,de)){const pe=Nr(He(),fe,de);mt(Y,Y,Ar(pe,pe))}const le=Hn(Y);return le>0?bt(Y,Y,1/le):void 0};let D=Number.POSITIVE_INFINITY;this.sortSubarray(f,_.min,_.max,(B,U)=>B.featureInfo.featureIndex-U.featureInfo.featureIndex);for(let B=_.min;B<_.max;B++){const U=f[B];if(!U.featureInfo.guardRailEnabled)continue;const K=this.prepareEdgePoints(a,h,U,(Tr,Xt)=>Tr>Xt);if(K==null)continue;const te=K[0],oe=K[1],de=$e(te.coord.x,te.coord.y,E*te.height),fe=$e(oe.coord.x,oe.coord.y,E*oe.height);if(Mt(de,fe))continue;const Y=Nr(He(),fe,de);Ar(Y,Y);const le=Tr=>Ar(Tr,Tr),pe=k(U.a)||Y,ye=k(U.b)||Y,Re=le($e(pe[1],-pe[0],0)),Ie=le($e(ye[1],-ye[0],0)),ke=le(nr(He(),Re,pe)),je=le(nr(He(),Ie,ye)),rt=He(),xt=[mt(He(),de,bt(rt,Nr(rt,Re,ke),A)),mt(He(),de,bt(rt,mt(rt,Re,ke),A)),mt(He(),de,bt(rt,ke,A)),de],ft=[mt(He(),fe,bt(rt,Nr(rt,Ie,je),A)),mt(He(),fe,bt(rt,mt(rt,Ie,je),A)),mt(He(),fe,bt(rt,je,A)),fe];D=this.addFeatureSection(U.featureInfo.featureIndex,D,this.bridgeFeatureSections,n);const[vt,wt]=n.addVertices(Re,y,xt[0],xt[1]),[it,_t]=n.addVertices(Ie,y,ft[0],ft[1]);n.addTriangles([vt,wt,it,wt,_t,it]);const[et,nt]=n.addVertices(ke,y,xt[1],xt[2]),[Pt,It]=n.addVertices(je,y,ft[1],ft[2]);n.addTriangles([et,nt,Pt,nt,It,Pt]);const[sr,Kt]=n.addVertices(Mr(Re,Re),y,xt[2],xt[3]),[Ft,Et]=n.addVertices(Mr(Ie,Ie),y,ft[2],ft[3]);n.addTriangles([sr,Kt,Ft,Kt,Et,Ft])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}constructTunnelStructures(n,a,h,f,_,y){n.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const E=(M,k)=>M.featureInfo.featureIndex-k.featureInfo.featureIndex;this.sortSubarray(f,_.min,_.max,E),this.sortSubarray(f,y.min,y.max,E);const A=M=>Ar(M,M);for(let M=_.min;M<_.max;M++){const k=this.prepareEdgePoints(a,h,f[M],(K,te)=>K<te);if(k==null)continue;const[D,B]=k,U=A($e(-(B.coord.y-D.coord.y),B.coord.x-D.coord.x,0));b=this.addFeatureSection(f[M].featureInfo.featureIndex,b,this.tunnelFeatureSections,n),n.addQuad([D,B,{coord:B.coord,height:f[M].isTunnel?-.1:0},{coord:D.coord,height:f[M].isTunnel?-.1:0}],U)}for(let M=y.min;M<y.max;M++){const k=f[M];k.isTunnel&&([k.a,k.b]=[k.b,k.a]);const D=a[k.a],B=a[k.b],U=A($e(-(B.y-D.y),B.x-D.x,0));b=this.addFeatureSection(k.featureInfo.featureIndex,b,this.tunnelFeatureSections,n),n.addQuad([{coord:B,height:0},{coord:D,height:0},{coord:D,height:h[k.a]+4},{coord:B,height:h[k.b]+4}],U),n.addQuad([{coord:D,height:0},{coord:B,height:0},{coord:B,height:h[k.b]+4},{coord:D,height:h[k.a]+4}],U)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:n.getVertexCount()})}prepareEdgePoints(n,a,h,f){let _=a[h.a],y=a[h.b];const b=f(_,0),E=f(y,0);if(b&&E)return[{coord:n[h.a],height:_},{coord:n[h.b],height:y}];if(!b&&!E)return;const A=n[h.a].clone(),M=n[h.b].clone();if(b){if(!E){const k=y/(y-_);M.x=pr(M.x,A.x,k),M.y=pr(M.y,A.y,k),y=pr(y,_,k)}}else{const k=_/(_-y);A.x=pr(A.x,M.x,k),A.y=pr(A.y,M.y,k),_=pr(_,y,k)}return[{coord:A,height:_},{coord:M,height:y}]}prepareEdges(n,a){if(a.length===0)return;a.sort((b,E)=>b.hash===E.hash?E.polygonIdx-b.polygonIdx:E.hash>b.hash?1:-1);let h=0,f=0,_=0,y=a[h].polygonIdx;do f++,(f===a.length||a[h].hash!==a[f].hash)&&((f-h==1||a[f-1].polygonIdx!==y)&&(_<h&&(a[_]=a[h],a[h]=null),a[_].type="none",_++),h=f,h!==a.length&&(y=a[h].polygonIdx));while(h!==a.length);if(a.splice(_),a.length!==0&&n.length!==0){a.sort((A,M)=>A.portalHash<M.portalHash?1:-1);let b=0,E=0;for(;b!==a.length&&E!==n.length;){const A=a[b],M=n[E];A.portalHash>M.hash?b++:M.hash>A.portalHash?E++:(A.type=M.type,b++)}}}isOnBorder(n,a){return n<=0&&a<=0||n>=Nt&&a>=Nt}addFeatureSection(n,a,h,f){return n!==a&&(a=n,h.push({featureIndex:n,vertexStart:f.getVertexCount()}),f.clearVertexLookup()),a}sortSubarray(n,a,h,f){const _=n.slice(a,h);_.sort(f),n.splice(a,_.length,..._)}static computeEdgeHash(n,a){return(n.y===a.y&&n.x>a.x||n.y>a.y)&&([n,a]=[a,n]),BigInt(ha.computePosHash(n))<<32n|BigInt(ha.computePosHash(a))}static computePosHash(n){return((65535&n.x)<<16|65535&n.y)>>>0}}var Cz,Iz={exports:{}},Oz=(Cz||(Cz=1,function(l,n){(function(a){function h(ge,ve){return ge>ve?1:ge<ve?-1:0}var f=function(ge,ve){ge===void 0&&(ge=h),ve===void 0&&(ve=!1),this._compare=ge,this._root=null,this._size=0,this._noDuplicates=!!ve},_={size:{configurable:!0}};function y(ge,ve,ot,Rt,Bt){var jt=Bt-Rt;if(jt>0){var Zt=Rt+Math.floor(jt/2),fr={key:ve[Zt],data:ot[Zt],parent:ge};return fr.left=y(fr,ve,ot,Rt,Zt),fr.right=y(fr,ve,ot,Zt+1,Bt),fr}return null}function b(ge,ve,ot,Rt,Bt){if(!(ot>=Rt)){for(var jt=ge[ot+Rt>>1],Zt=ot-1,fr=Rt+1;;){do Zt++;while(Bt(ge[Zt],jt)<0);do fr--;while(Bt(ge[fr],jt)>0);if(Zt>=fr)break;var Wr=ge[Zt];ge[Zt]=ge[fr],ge[fr]=Wr,Wr=ve[Zt],ve[Zt]=ve[fr],ve[fr]=Wr}b(ge,ve,ot,fr,Bt),b(ge,ve,fr+1,Rt,Bt)}}f.prototype.rotateLeft=function(ge){var ve=ge.right;ve&&(ge.right=ve.left,ve.left&&(ve.left.parent=ge),ve.parent=ge.parent),ge.parent?ge===ge.parent.left?ge.parent.left=ve:ge.parent.right=ve:this._root=ve,ve&&(ve.left=ge),ge.parent=ve},f.prototype.rotateRight=function(ge){var ve=ge.left;ve&&(ge.left=ve.right,ve.right&&(ve.right.parent=ge),ve.parent=ge.parent),ge.parent?ge===ge.parent.left?ge.parent.left=ve:ge.parent.right=ve:this._root=ve,ve&&(ve.right=ge),ge.parent=ve},f.prototype._splay=function(ge){for(;ge.parent;){var ve=ge.parent;ve.parent?ve.left===ge&&ve.parent.left===ve?(this.rotateRight(ve.parent),this.rotateRight(ve)):ve.right===ge&&ve.parent.right===ve?(this.rotateLeft(ve.parent),this.rotateLeft(ve)):ve.left===ge&&ve.parent.right===ve?(this.rotateRight(ve),this.rotateLeft(ve)):(this.rotateLeft(ve),this.rotateRight(ve)):ve.left===ge?this.rotateRight(ve):this.rotateLeft(ve)}},f.prototype.splay=function(ge){for(var ve,ot,Rt,Bt,jt;ge.parent;)(ot=(ve=ge.parent).parent)&&ot.parent?((Rt=ot.parent).left===ot?Rt.left=ge:Rt.right=ge,ge.parent=Rt):(ge.parent=null,this._root=ge),Bt=ge.left,jt=ge.right,ge===ve.left?(ot&&(ot.left===ve?(ve.right?(ot.left=ve.right,ot.left.parent=ot):ot.left=null,ve.right=ot,ot.parent=ve):(Bt?(ot.right=Bt,Bt.parent=ot):ot.right=null,ge.left=ot,ot.parent=ge)),jt?(ve.left=jt,jt.parent=ve):ve.left=null,ge.right=ve,ve.parent=ge):(ot&&(ot.right===ve?(ve.left?(ot.right=ve.left,ot.right.parent=ot):ot.right=null,ve.left=ot,ot.parent=ve):(jt?(ot.left=jt,jt.parent=ot):ot.left=null,ge.right=ot,ot.parent=ge)),Bt?(ve.right=Bt,Bt.parent=ve):ve.right=null,ge.left=ve,ve.parent=ge)},f.prototype.replace=function(ge,ve){ge.parent?ge===ge.parent.left?ge.parent.left=ve:ge.parent.right=ve:this._root=ve,ve&&(ve.parent=ge.parent)},f.prototype.minNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.left;)ge=ge.left;return ge},f.prototype.maxNode=function(ge){if(ge===void 0&&(ge=this._root),ge)for(;ge.right;)ge=ge.right;return ge},f.prototype.insert=function(ge,ve){var ot=this._root,Rt=null,Bt=this._compare;if(this._noDuplicates)for(;ot;){if(Rt=ot,Bt(ot.key,ge)===0)return;ot=Bt(ot.key,ge)<0?ot.right:ot.left}else for(;ot;)Rt=ot,ot=Bt(ot.key,ge)<0?ot.right:ot.left;return ot={key:ge,data:ve,left:null,right:null,parent:Rt},Rt?Bt(Rt.key,ot.key)<0?Rt.right=ot:Rt.left=ot:this._root=ot,this.splay(ot),this._size++,ot},f.prototype.find=function(ge){for(var ve=this._root,ot=this._compare;ve;){var Rt=ot(ve.key,ge);if(Rt<0)ve=ve.right;else{if(!(Rt>0))return ve;ve=ve.left}}return null},f.prototype.contains=function(ge){for(var ve=this._root,ot=this._compare;ve;){var Rt=ot(ge,ve.key);if(Rt===0)return!0;ve=Rt<0?ve.left:ve.right}return!1},f.prototype.remove=function(ge){var ve=this.find(ge);if(!ve)return!1;if(this.splay(ve),ve.left)if(ve.right){var ot=this.minNode(ve.right);ot.parent!==ve&&(this.replace(ot,ot.right),ot.right=ve.right,ot.right.parent=ot),this.replace(ve,ot),ot.left=ve.left,ot.left.parent=ot}else this.replace(ve,ve.left);else this.replace(ve,ve.right);return this._size--,!0},f.prototype.removeNode=function(ge){if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var ve=this.minNode(ge.right);ve.parent!==ge&&(this.replace(ve,ve.right),ve.right=ge.right,ve.right.parent=ve),this.replace(ge,ve),ve.left=ge.left,ve.left.parent=ve}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},f.prototype.erase=function(ge){var ve=this.find(ge);if(ve){this.splay(ve);var ot=ve.left,Rt=ve.right,Bt=null;ot&&(ot.parent=null,Bt=this.maxNode(ot),this.splay(Bt),this._root=Bt),Rt&&(ot?Bt.right=Rt:this._root=Rt,Rt.parent=Bt),this._size--}},f.prototype.pop=function(){var ge=this._root,ve=null;if(ge){for(;ge.left;)ge=ge.left;ve={key:ge.key,data:ge.data},this.remove(ge.key)}return ve},f.prototype.next=function(ge){var ve=ge;if(ve)if(ve.right)for(ve=ve.right;ve&&ve.left;)ve=ve.left;else for(ve=ge.parent;ve&&ve.right===ge;)ge=ve,ve=ve.parent;return ve},f.prototype.prev=function(ge){var ve=ge;if(ve)if(ve.left)for(ve=ve.left;ve&&ve.right;)ve=ve.right;else for(ve=ge.parent;ve&&ve.left===ge;)ge=ve,ve=ve.parent;return ve},f.prototype.forEach=function(ge){for(var ve=this._root,ot=[],Rt=!1,Bt=0;!Rt;)ve?(ot.push(ve),ve=ve.left):ot.length>0?(ge(ve=ot.pop(),Bt++),ve=ve.right):Rt=!0;return this},f.prototype.range=function(ge,ve,ot,Rt){for(var Bt=[],jt=this._compare,Zt=this._root;Bt.length!==0||Zt;)if(Zt)Bt.push(Zt),Zt=Zt.left;else{if(jt((Zt=Bt.pop()).key,ve)>0)break;if(jt(Zt.key,ge)>=0&&ot.call(Rt,Zt))return this;Zt=Zt.right}return this},f.prototype.keys=function(){for(var ge=this._root,ve=[],ot=[],Rt=!1;!Rt;)ge?(ve.push(ge),ge=ge.left):ve.length>0?(ge=ve.pop(),ot.push(ge.key),ge=ge.right):Rt=!0;return ot},f.prototype.values=function(){for(var ge=this._root,ve=[],ot=[],Rt=!1;!Rt;)ge?(ve.push(ge),ge=ge.left):ve.length>0?(ge=ve.pop(),ot.push(ge.data),ge=ge.right):Rt=!0;return ot},f.prototype.at=function(ge){for(var ve=this._root,ot=[],Rt=!1,Bt=0;!Rt;)if(ve)ot.push(ve),ve=ve.left;else if(ot.length>0){if(ve=ot.pop(),Bt===ge)return ve;Bt++,ve=ve.right}else Rt=!0;return null},f.prototype.load=function(ge,ve,ot){if(ge===void 0&&(ge=[]),ve===void 0&&(ve=[]),ot===void 0&&(ot=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Rt=ge.length;return ot&&b(ge,ve,0,Rt-1,this._compare),this._root=y(null,ge,ve,0,Rt),this._size=Rt,this},f.prototype.min=function(){var ge=this.minNode(this._root);return ge?ge.key:null},f.prototype.max=function(){var ge=this.maxNode(this._root);return ge?ge.key:null},f.prototype.isEmpty=function(){return this._root===null},_.size.get=function(){return this._size},f.createTree=function(ge,ve,ot,Rt,Bt){return new f(ot,Bt).load(ge,ve,Rt)},Object.defineProperties(f.prototype,_);var E=0,A=1,M=2,k=3,D=0,B=1,U=2,K=3;function te(ge,ve,ot){ve===null?(ge.inOut=!1,ge.otherInOut=!0):(ge.isSubject===ve.isSubject?(ge.inOut=!ve.inOut,ge.otherInOut=ve.otherInOut):(ge.inOut=!ve.otherInOut,ge.otherInOut=ve.isVertical()?!ve.inOut:ve.inOut),ve&&(ge.prevInResult=!oe(ve,ot)||ve.isVertical()?ve.prevInResult:ve));var Rt=oe(ge,ot);ge.resultTransition=Rt?function(Bt,jt){var Zt,fr=!Bt.inOut,Wr=!Bt.otherInOut;switch(jt){case D:Zt=fr&&Wr;break;case B:Zt=fr||Wr;break;case K:Zt=fr^Wr;break;case U:Zt=Bt.isSubject?fr&&!Wr:Wr&&!fr}return Zt?1:-1}(ge,ot):0}function oe(ge,ve){switch(ge.type){case E:switch(ve){case D:return!ge.otherInOut;case B:return ge.otherInOut;case U:return ge.isSubject&&ge.otherInOut||!ge.isSubject&&!ge.otherInOut;case K:return!0}break;case M:return ve===D||ve===B;case k:return ve===U;case A:return!1}return!1}var de=function(ge,ve,ot,Rt,Bt){this.left=ve,this.point=ge,this.otherEvent=ot,this.isSubject=Rt,this.type=Bt||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},fe={inResult:{configurable:!0}};function Y(ge,ve){return ge[0]===ve[0]&&ge[1]===ve[1]}de.prototype.isBelow=function(ge){var ve=this.point,ot=this.otherEvent.point;return this.left?(ve[0]-ge[0])*(ot[1]-ge[1])-(ot[0]-ge[0])*(ve[1]-ge[1])>0:(ot[0]-ge[0])*(ve[1]-ge[1])-(ve[0]-ge[0])*(ot[1]-ge[1])>0},de.prototype.isAbove=function(ge){return!this.isBelow(ge)},de.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},fe.inResult.get=function(){return this.resultTransition!==0},de.prototype.clone=function(){var ge=new de(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ge.contourId=this.contourId,ge.resultTransition=this.resultTransition,ge.prevInResult=this.prevInResult,ge.isExteriorRing=this.isExteriorRing,ge.inOut=this.inOut,ge.otherInOut=this.otherInOut,ge},Object.defineProperties(de.prototype,fe);var le=11102230246251565e-32,pe=134217729,ye=(3+8*le)*le;function Re(ge,ve,ot,Rt,Bt){var jt,Zt,fr,Wr,qr=ve[0],Lr=Rt[0],vn=0,Rn=0;Lr>qr==Lr>-qr?(jt=qr,qr=ve[++vn]):(jt=Lr,Lr=Rt[++Rn]);var Zr=0;if(vn<ge&&Rn<ot)for(Lr>qr==Lr>-qr?(fr=jt-((Zt=qr+jt)-qr),qr=ve[++vn]):(fr=jt-((Zt=Lr+jt)-Lr),Lr=Rt[++Rn]),jt=Zt,fr!==0&&(Bt[Zr++]=fr);vn<ge&&Rn<ot;)Lr>qr==Lr>-qr?(fr=jt-((Zt=jt+qr)-(Wr=Zt-jt))+(qr-Wr),qr=ve[++vn]):(fr=jt-((Zt=jt+Lr)-(Wr=Zt-jt))+(Lr-Wr),Lr=Rt[++Rn]),jt=Zt,fr!==0&&(Bt[Zr++]=fr);for(;vn<ge;)fr=jt-((Zt=jt+qr)-(Wr=Zt-jt))+(qr-Wr),qr=ve[++vn],jt=Zt,fr!==0&&(Bt[Zr++]=fr);for(;Rn<ot;)fr=jt-((Zt=jt+Lr)-(Wr=Zt-jt))+(Lr-Wr),Lr=Rt[++Rn],jt=Zt,fr!==0&&(Bt[Zr++]=fr);return jt===0&&Zr!==0||(Bt[Zr++]=jt),Zr}function Ie(ge){return new Float64Array(ge)}var ke=33306690738754716e-32,je=22204460492503146e-32,rt=11093356479670487e-47,xt=Ie(4),ft=Ie(8),vt=Ie(12),wt=Ie(16),it=Ie(4);function _t(ge,ve,ot){var Rt=function(Bt,jt,Zt,fr,Wr,qr){var Lr=(jt-qr)*(Zt-Wr),vn=(Bt-Wr)*(fr-qr),Rn=Lr-vn;if(Lr===0||vn===0||Lr>0!=vn>0)return Rn;var Zr=Math.abs(Lr+vn);return Math.abs(Rn)>=ke*Zr?Rn:-function(ci,$n,gn,bi,Xn,kn,Un){var wn,jr,En,ui,hr,Qr,Kn,_i,ti,Hi,Pn,Ui,Es,Mo,Ao,As,Fc,Wi,io=ci-Xn,Ro=gn-Xn,ts=$n-kn,$o=bi-kn;xt[0]=(Ao=(_i=io-(Kn=(Qr=pe*io)-(Qr-io)))*(Hi=$o-(ti=(Qr=pe*$o)-(Qr-$o)))-((Mo=io*$o)-Kn*ti-_i*ti-Kn*Hi))-((Pn=Ao-(Fc=(_i=ts-(Kn=(Qr=pe*ts)-(Qr-ts)))*(Hi=Ro-(ti=(Qr=pe*Ro)-(Qr-Ro)))-((As=ts*Ro)-Kn*ti-_i*ti-Kn*Hi)))+(hr=Ao-Pn))+(hr-Fc),xt[1]=(Es=Mo-((Ui=Mo+Pn)-(hr=Ui-Mo))+(Pn-hr))-((Pn=Es-As)+(hr=Es-Pn))+(hr-As),xt[2]=Ui-((Wi=Ui+Pn)-(hr=Wi-Ui))+(Pn-hr),xt[3]=Wi;var Yh=function(Eje,F3){for(var B3=F3[0],OC=1;OC<4;OC++)B3+=F3[OC];return B3}(0,xt),x0=je*Un;if(Yh>=x0||-Yh>=x0||(wn=ci-(io+(hr=ci-io))+(hr-Xn),En=gn-(Ro+(hr=gn-Ro))+(hr-Xn),jr=$n-(ts+(hr=$n-ts))+(hr-kn),ui=bi-($o+(hr=bi-$o))+(hr-kn),wn===0&&jr===0&&En===0&&ui===0)||(x0=rt*Un+ye*Math.abs(Yh),(Yh+=io*ui+$o*wn-(ts*En+Ro*jr))>=x0||-Yh>=x0))return Yh;it[0]=(Ao=(_i=wn-(Kn=(Qr=pe*wn)-(Qr-wn)))*(Hi=$o-(ti=(Qr=pe*$o)-(Qr-$o)))-((Mo=wn*$o)-Kn*ti-_i*ti-Kn*Hi))-((Pn=Ao-(Fc=(_i=jr-(Kn=(Qr=pe*jr)-(Qr-jr)))*(Hi=Ro-(ti=(Qr=pe*Ro)-(Qr-Ro)))-((As=jr*Ro)-Kn*ti-_i*ti-Kn*Hi)))+(hr=Ao-Pn))+(hr-Fc),it[1]=(Es=Mo-((Ui=Mo+Pn)-(hr=Ui-Mo))+(Pn-hr))-((Pn=Es-As)+(hr=Es-Pn))+(hr-As),it[2]=Ui-((Wi=Ui+Pn)-(hr=Wi-Ui))+(Pn-hr),it[3]=Wi;var bQ=Re(4,xt,4,it,ft);it[0]=(Ao=(_i=io-(Kn=(Qr=pe*io)-(Qr-io)))*(Hi=ui-(ti=(Qr=pe*ui)-(Qr-ui)))-((Mo=io*ui)-Kn*ti-_i*ti-Kn*Hi))-((Pn=Ao-(Fc=(_i=ts-(Kn=(Qr=pe*ts)-(Qr-ts)))*(Hi=En-(ti=(Qr=pe*En)-(Qr-En)))-((As=ts*En)-Kn*ti-_i*ti-Kn*Hi)))+(hr=Ao-Pn))+(hr-Fc),it[1]=(Es=Mo-((Ui=Mo+Pn)-(hr=Ui-Mo))+(Pn-hr))-((Pn=Es-As)+(hr=Es-Pn))+(hr-As),it[2]=Ui-((Wi=Ui+Pn)-(hr=Wi-Ui))+(Pn-hr),it[3]=Wi;var wQ=Re(bQ,ft,4,it,vt);it[0]=(Ao=(_i=wn-(Kn=(Qr=pe*wn)-(Qr-wn)))*(Hi=ui-(ti=(Qr=pe*ui)-(Qr-ui)))-((Mo=wn*ui)-Kn*ti-_i*ti-Kn*Hi))-((Pn=Ao-(Fc=(_i=jr-(Kn=(Qr=pe*jr)-(Qr-jr)))*(Hi=En-(ti=(Qr=pe*En)-(Qr-En)))-((As=jr*En)-Kn*ti-_i*ti-Kn*Hi)))+(hr=Ao-Pn))+(hr-Fc),it[1]=(Es=Mo-((Ui=Mo+Pn)-(hr=Ui-Mo))+(Pn-hr))-((Pn=Es-As)+(hr=Es-Pn))+(hr-As),it[2]=Ui-((Wi=Ui+Pn)-(hr=Wi-Ui))+(Pn-hr),it[3]=Wi;var SQ=Re(wQ,vt,4,it,wt);return wt[SQ-1]}(Bt,jt,Zt,fr,Wr,qr,Zr)}(ge[0],ge[1],ve[0],ve[1],ot[0],ot[1]);return Rt>0?-1:Rt<0?1:0}function et(ge,ve){var ot=ge.point,Rt=ve.point;return ot[0]>Rt[0]?1:ot[0]<Rt[0]?-1:ot[1]!==Rt[1]?ot[1]>Rt[1]?1:-1:function(Bt,jt,Zt,fr){return Bt.left!==jt.left?Bt.left?1:-1:_t(Zt,Bt.otherEvent.point,jt.otherEvent.point)!==0?Bt.isBelow(jt.otherEvent.point)?-1:1:!Bt.isSubject&&jt.isSubject?1:-1}(ge,ve,ot)}function nt(ge,ve,ot){var Rt=new de(ve,!1,ge,ge.isSubject),Bt=new de(ve,!0,ge.otherEvent,ge.isSubject);return Y(ge.point,ge.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ge),Rt.contourId=Bt.contourId=ge.contourId,et(Bt,ge.otherEvent)>0&&(ge.otherEvent.left=!0,Bt.left=!1),ge.otherEvent.otherEvent=Bt,ge.otherEvent=Rt,ot.push(Bt),ot.push(Rt),ot}function Pt(ge,ve){return ge[0]*ve[1]-ge[1]*ve[0]}function It(ge,ve){return ge[0]*ve[0]+ge[1]*ve[1]}function sr(ge,ve,ot){var Rt=function(Wr,qr,Lr,vn,Rn){var Zr=[qr[0]-Wr[0],qr[1]-Wr[1]],ci=[vn[0]-Lr[0],vn[1]-Lr[1]];function $n(Qr,Kn,_i){return[Qr[0]+Kn*_i[0],Qr[1]+Kn*_i[1]]}var gn=[Lr[0]-Wr[0],Lr[1]-Wr[1]],bi=Pt(Zr,ci),Xn=bi*bi,kn=It(Zr,Zr);if(Xn>0){var Un=Pt(gn,ci)/bi;if(Un<0||Un>1)return null;var wn=Pt(gn,Zr)/bi;return wn<0||wn>1?null:Un===0||Un===1?[$n(Wr,Un,Zr)]:wn===0||wn===1?[$n(Lr,wn,ci)]:[$n(Wr,Un,Zr)]}if((Xn=(bi=Pt(gn,Zr))*bi)>0)return null;var jr=It(Zr,gn)/kn,En=jr+It(Zr,ci)/kn,ui=Math.min(jr,En),hr=Math.max(jr,En);return ui<=1&&hr>=0?ui===1?[$n(Wr,ui>0?ui:0,Zr)]:hr===0?[$n(Wr,hr<1?hr:1,Zr)]:[$n(Wr,ui>0?ui:0,Zr),$n(Wr,hr<1?hr:1,Zr)]:null}(ge.point,ge.otherEvent.point,ve.point,ve.otherEvent.point),Bt=Rt?Rt.length:0;if(Bt===0||Bt===1&&(Y(ge.point,ve.point)||Y(ge.otherEvent.point,ve.otherEvent.point))||Bt===2&&ge.isSubject===ve.isSubject)return 0;if(Bt===1)return Y(ge.point,Rt[0])||Y(ge.otherEvent.point,Rt[0])||nt(ge,Rt[0],ot),Y(ve.point,Rt[0])||Y(ve.otherEvent.point,Rt[0])||nt(ve,Rt[0],ot),1;var jt=[],Zt=!1,fr=!1;return Y(ge.point,ve.point)?Zt=!0:et(ge,ve)===1?jt.push(ve,ge):jt.push(ge,ve),Y(ge.otherEvent.point,ve.otherEvent.point)?fr=!0:et(ge.otherEvent,ve.otherEvent)===1?jt.push(ve.otherEvent,ge.otherEvent):jt.push(ge.otherEvent,ve.otherEvent),Zt&&fr||Zt?(ve.type=A,ge.type=ve.inOut===ge.inOut?M:k,Zt&&!fr&&nt(jt[1].otherEvent,jt[0].point,ot),2):fr?(nt(jt[0],jt[1].point,ot),3):jt[0]!==jt[3].otherEvent?(nt(jt[0],jt[1].point,ot),nt(jt[1],jt[2].point,ot),3):(nt(jt[0],jt[1].point,ot),nt(jt[3].otherEvent,jt[2].point,ot),3)}function Kt(ge,ve){if(ge===ve)return 0;if(_t(ge.point,ge.otherEvent.point,ve.point)!==0||_t(ge.point,ge.otherEvent.point,ve.otherEvent.point)!==0)return Y(ge.point,ve.point)?ge.isBelow(ve.otherEvent.point)?-1:1:ge.point[0]===ve.point[0]?ge.point[1]<ve.point[1]?-1:1:et(ge,ve)===1?ve.isAbove(ge.point)?-1:1:ge.isBelow(ve.point)?-1:1;if(ge.isSubject!==ve.isSubject)return ge.isSubject?-1:1;var ot=ge.point,Rt=ve.point;return ot[0]===Rt[0]&&ot[1]===Rt[1]?(ot=ge.otherEvent.point)[0]===(Rt=ve.otherEvent.point)[0]&&ot[1]===Rt[1]?0:ge.contourId>ve.contourId?1:-1:et(ge,ve)===1?1:-1}var Ft=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Et(ge,ve,ot,Rt){var Bt,jt=ge+1,Zt=ve[ge].point,fr=ve.length;for(jt<fr&&(Bt=ve[jt].point);jt<fr&&Bt[0]===Zt[0]&&Bt[1]===Zt[1];){if(!ot[jt])return jt;++jt<fr&&(Bt=ve[jt].point)}for(jt=ge-1;ot[jt]&&jt>Rt;)jt--;return jt}Ft.prototype.isExterior=function(){return this.holeOf==null};var Tr=Jt,Xt=Jt;function Jt(ge,ve){if(!(this instanceof Jt))return new Jt(ge,ve);if(this.data=ge||[],this.length=this.data.length,this.compare=ve||mr,this.length>0)for(var ot=(this.length>>1)-1;ot>=0;ot--)this._down(ot)}function mr(ge,ve){return ge<ve?-1:ge>ve?1:0}Jt.prototype={push:function(ge){this.data.push(ge),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ge=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ge}},peek:function(){return this.data[0]},_up:function(ge){for(var ve=this.data,ot=this.compare,Rt=ve[ge];ge>0;){var Bt=ge-1>>1,jt=ve[Bt];if(ot(Rt,jt)>=0)break;ve[ge]=jt,ge=Bt}ve[ge]=Rt},_down:function(ge){for(var ve=this.data,ot=this.compare,Rt=this.length>>1,Bt=ve[ge];ge<Rt;){var jt=1+(ge<<1),Zt=jt+1,fr=ve[jt];if(Zt<this.length&&ot(ve[Zt],fr)<0&&(jt=Zt,fr=ve[Zt]),ot(fr,Bt)>=0)break;ve[ge]=fr,ge=jt}ve[ge]=Bt}},Tr.default=Xt;var Or=Math.max,Ir=Math.min,Ur=0;function Dr(ge,ve,ot,Rt,Bt,jt){var Zt,fr,Wr,qr,Lr,vn;for(Zt=0,fr=ge.length-1;Zt<fr;Zt++)if(qr=ge[Zt+1],Lr=new de(Wr=ge[Zt],!1,void 0,ve),vn=new de(qr,!1,Lr,ve),Lr.otherEvent=vn,Wr[0]!==qr[0]||Wr[1]!==qr[1]){Lr.contourId=vn.contourId=ot,jt||(Lr.isExteriorRing=!1,vn.isExteriorRing=!1),et(Lr,vn)>0?vn.left=!0:Lr.left=!0;var Rn=Wr[0],Zr=Wr[1];Bt[0]=Ir(Bt[0],Rn),Bt[1]=Ir(Bt[1],Zr),Bt[2]=Or(Bt[2],Rn),Bt[3]=Or(Bt[3],Zr),Rt.push(Lr),Rt.push(vn)}}var Vr=[];function mn(ge,ve,ot){typeof ge[0][0][0]=="number"&&(ge=[ge]),typeof ve[0][0][0]=="number"&&(ve=[ve]);var Rt=function(Zr,ci,$n){var gn=null;return Zr.length*ci.length==0&&($n===D?gn=Vr:$n===U?gn=Zr:$n!==B&&$n!==K||(gn=Zr.length===0?ci:Zr)),gn}(ge,ve,ot);if(Rt)return Rt===Vr?null:Rt;var Bt=[1/0,1/0,-1/0,-1/0],jt=[1/0,1/0,-1/0,-1/0],Zt=function(Zr,ci,$n,gn,bi){var Xn,kn,Un,wn,jr,En,ui=new Tr(null,et);for(Un=0,wn=Zr.length;Un<wn;Un++)for(jr=0,En=(Xn=Zr[Un]).length;jr<En;jr++)(kn=jr===0)&&Ur++,Dr(Xn[jr],!0,Ur,ui,$n,kn);for(Un=0,wn=ci.length;Un<wn;Un++)for(jr=0,En=(Xn=ci[Un]).length;jr<En;jr++)kn=jr===0,bi===U&&(kn=!1),kn&&Ur++,Dr(Xn[jr],!1,Ur,ui,gn,kn);return ui}(ge,ve,Bt,jt,ot);if(Rt=function(Zr,ci,$n,gn,bi){var Xn=null;return($n[0]>gn[2]||gn[0]>$n[2]||$n[1]>gn[3]||gn[1]>$n[3])&&(bi===D?Xn=Vr:bi===U?Xn=Zr:bi!==B&&bi!==K||(Xn=Zr.concat(ci))),Xn}(ge,ve,Bt,jt,ot))return Rt===Vr?null:Rt;for(var fr=function(Zr){var ci,$n,gn=function(Un){var wn,jr,En,ui,hr=[];for(jr=0,En=Un.length;jr<En;jr++)((wn=Un[jr]).left&&wn.inResult||!wn.left&&wn.otherEvent.inResult)&&hr.push(wn);for(var Qr=!1;!Qr;)for(Qr=!0,jr=0,En=hr.length;jr<En;jr++)jr+1<En&&et(hr[jr],hr[jr+1])===1&&(ui=hr[jr],hr[jr]=hr[jr+1],hr[jr+1]=ui,Qr=!1);for(jr=0,En=hr.length;jr<En;jr++)(wn=hr[jr]).otherPos=jr;for(jr=0,En=hr.length;jr<En;jr++)(wn=hr[jr]).left||(ui=wn.otherPos,wn.otherPos=wn.otherEvent.otherPos,wn.otherEvent.otherPos=ui);return hr}(Zr),bi={},Xn=[],kn=function(){if(!bi[ci]){var Un=Xn.length,wn=function(hr,Qr,Kn){var _i=new Ft;if(hr.prevInResult!=null){var ti=hr.prevInResult,Hi=ti.outputContourId;if(ti.resultTransition>0){var Pn=Qr[Hi];if(Pn.holeOf!=null){var Ui=Pn.holeOf;Qr[Ui].holeIds.push(Kn),_i.holeOf=Ui,_i.depth=Qr[Hi].depth}else Qr[Hi].holeIds.push(Kn),_i.holeOf=Hi,_i.depth=Qr[Hi].depth+1}else _i.holeOf=null,_i.depth=Qr[Hi].depth}else _i.holeOf=null,_i.depth=0;return _i}(gn[ci],Xn,Un),jr=function(hr){bi[hr]=!0,hr<gn.length&&gn[hr]&&(gn[hr].outputContourId=Un)},En=ci,ui=ci;for(wn.points.push(gn[ci].point);jr(En),jr(En=gn[En].otherPos),wn.points.push(gn[En].point),!((En=Et(En,gn,bi,ui))==ui||En>=gn.length)&&gn[En];);Xn.push(wn)}};for(ci=0,$n=gn.length;ci<$n;ci++)kn();return Xn}(function(Zr,ci,$n,gn,bi,Xn){for(var kn,Un,wn,jr=new f(Kt),En=[],ui=Math.min(gn[2],bi[2]);Zr.length!==0;){var hr=Zr.pop();if(En.push(hr),Xn===D&&hr.point[0]>ui||Xn===U&&hr.point[0]>gn[2])break;if(hr.left){Un=kn=jr.insert(hr),kn=kn!==(wn=jr.minNode())?jr.prev(kn):null,Un=jr.next(Un);var Qr=kn?kn.key:null;if(te(hr,Qr,Xn),Un&&sr(hr,Un.key,Zr)===2&&(te(hr,Qr,Xn),te(Un.key,hr,Xn)),kn&&sr(kn.key,hr,Zr)===2){var Kn=kn;te(Qr,(Kn=Kn!==wn?jr.prev(Kn):null)?Kn.key:null,Xn),te(hr,Qr,Xn)}}else Un=kn=jr.find(hr=hr.otherEvent),kn&&Un&&(kn=kn!==wn?jr.prev(kn):null,Un=jr.next(Un),jr.remove(hr),Un&&kn&&sr(kn.key,Un.key,Zr))}return En}(Zt,0,0,Bt,jt,ot)),Wr=[],qr=0;qr<fr.length;qr++){var Lr=fr[qr];if(Lr.isExterior()){for(var vn=[Lr.points],Rn=0;Rn<Lr.holeIds.length;Rn++)vn.push(fr[Lr.holeIds[Rn]].points);Wr.push(vn)}}return Wr}var Bn={UNION:B,DIFFERENCE:U,INTERSECTION:D,XOR:K};a.diff=function(ge,ve){return mn(ge,ve,U)},a.intersection=function(ge,ve){return mn(ge,ve,D)},a.operations=Bn,a.union=function(ge,ve){return mn(ge,ve,B)},a.xor=function(ge,ve){return mn(ge,ve,K)},Object.defineProperty(a,"__esModule",{value:!0})})(n)}(0,Iz.exports)),Iz.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function hw(l,n,a,h){const f=[],_=h===0?(y,b,E,A,M,k)=>{y.push(new Dt(k,E+(k-b)/(A-b)*(M-E)))}:(y,b,E,A,M,k)=>{y.push(new Dt(b+(k-E)/(M-E)*(A-b),k))};for(const y of l){const b=[];for(const E of y){if(E.length<=2)continue;const A=[];for(let D=0;D<E.length-1;D++){const B=E[D].x,U=E[D].y,K=E[D+1].x,te=E[D+1].y,oe=h===0?B:U,de=h===0?K:te;oe<n?de>n&&_(A,B,U,K,te,n):oe>a?de<a&&_(A,B,U,K,te,a):A.push(E[D]),de<n&&oe>=n&&_(A,B,U,K,te,n),de>a&&oe<=a&&_(A,B,U,K,te,a)}let M=E[E.length-1];const k=h===0?M.x:M.y;k>=n&&k<=a&&A.push(M),A.length&&(M=A[A.length-1],A[0].x===M.x&&A[0].y===M.y||A.push(A[0]),b.push(A))}b.length&&f.push(b)}return f}function DK(l,n){const a=AP(l),h=AP([n]),f=Oz.intersection(a,h);return f==null?[]:Mz(f)}function LK(l,n){let h=AP(l,65536);for(;n.valid();n.next()){const[f,_]=n.get(),y=f.x*65536,b=f.y*65536,E=_.x*65536,A=_.y*65536,M=E-y,k=A-b,D=Math.hypot(M,k),B=Math.trunc(k/D*3),U=-Math.trunc(M/D*3);h=Oz.diff(h,[[[y,b],[E,A],[E+B,A+U],[y+B,b+U],[y,b]]])}return Mz(h,1/65536)}function AP(l,n=1){return[l.map(a=>a.map(h=>[h.x*n,h.y*n]))]}function Mz(l,n=1){return l.map(a=>a.map((h,f)=>{const _=h.map(y=>new Dt(y[0]*n,y[1]*n).round());return f>0&&_.reverse(),_}))}class PP{constructor(n,a){this.layoutVertexArray=new Nl,this.indexArray=new To,this.lineIndexArray=new Mc,this.triangleSegments=new mi,this.lineSegments=new mi,this.programConfigurations=new p(n.layers,{zoom:n.zoom,lut:n.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Ic)}update(n,a,h,f,_,y,b,E){this.programConfigurations.updatePaintArrays(n,a,_,h,f,y,b,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,vK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.lineIndexBuffer=n.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=n.createVertexBuffer(this.elevatedLayoutVertexArray,xK.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(n,a,h,f,_,y,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,a,h,f,_,y,void 0,b)}}class CP{constructor(n){this.zoom=n.zoom,this.pixelRatio=n.pixelRatio,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=n.lut,this.bufferData=new PP(n,!1),this.elevationBufferData=new PP(n,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=n.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=n.sourceLayerIndex,this.worldview=n.worldview}updateFootprints(n,a){}populate(n,a,h,f){this.hasPattern=TP("fill",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:b,id:E,index:A,sourceLayerIndex:M}of n){const k=this.layers[0]._featureFilter.needGeometry,D=Vt(b,k);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),D,h))continue;const B=_?_.evaluate(D,{},h,a.availableImages):void 0,U={id:E,properties:b.properties,type:b.type,sourceLayerIndex:M,index:A,geometry:k?D.geometry:qt(b,h,f),patterns:{},sortKey:B};y.push(U)}_&&y.sort((b,E)=>b.sortKey-E.sortKey);for(const b of y){const{geometry:E,index:A,sourceLayerIndex:M}=b;if(this.hasPattern){const k=EP("fill",this.layers,b,this.zoom,this.pixelRatio,a);this.patternFeatures.push(k)}else this.addFeature(b,E,A,h,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(n[A].feature,E,A,M,this.index)}}update(n,a,h,f,_,y,b){this.bufferData.update(n,a,h,f,_,y,b,this.worldview),this.elevationBufferData.update(n,a,h,f,_,y,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(n,a,h,f,_,y,b,this.worldview)}addFeatures(n,a,h,f,_,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,h,f,y,n.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(n){this.bufferData.upload(n),this.elevationBufferData.upload(n),this.elevatedStructures&&this.elevatedStructures.upload(n)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(n,a,h,f,_,y=[],b,E){const A=uw(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(n,A,f,h,E):this.addGeometry(A,this.bufferData),this.bufferData.populatePaintArrays(n,h,_,y,f,b,this.worldview),this.elevationBufferData.populatePaintArrays(n,h,_,y,f,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(n,a,h,f,_){this.elevatedStructures&&(this.elevatedStructures.construct(n),this.elevatedStructures.populatePaintArrays(a,h,f,_,this.worldview))}addElevatedRoadFeature(n,a,h,f,_){const y=new Array,b=Gs.getElevationFeature(n,_);if(!b)return void this.addGeometry(a,this.bufferData);{const A=this.clipPolygonsToTile(a,1);A.length>0&&y.push({polygons:A,elevationFeature:b,elevationTileID:h})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(n,{},h),featureIndex:f};for(const A of y)if(A.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ha(A.elevationTileID,this.layers,this.zoom,this.lut));const k=A.elevationFeature.isTunnel();let D=0;n.properties.hasOwnProperty(Wn)&&(D=+n.properties[Wn]);for(const B of A.polygons)this.elevatedStructures.addPortalCandidates(A.elevationFeature.id,B,k,A.elevationFeature,D)}A.elevationFeature.constantHeight==null&&(A.polygons=this.prepareElevatedPolygons(A.polygons,A.elevationFeature,A.elevationTileID));const M=new Ia(h,A.elevationTileID);this.addElevatedGeometry(A.polygons,M,A.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,f,E)}}addElevatedGeometry(n,a,h,f,_,y){const b={elevation:h,elevationSampler:a,bias:f,index:_,featureInfo:y},[E,A]=this.addGeometry(n,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:A}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,A))}addGeometry(n,a,h){let f=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,y=null;h&&(y=h.elevationSampler.constantElevation(h.elevation,h.bias),y!=null&&(f=y,_=y));const b=(E,A,M)=>{if(h!=null)if(A.push(E),y!=null)a.elevatedLayoutVertexArray.emplaceBack(y),M.push(y);else{const k=h.elevationSampler.pointElevation(E,h.elevation,h.bias);a.elevatedLayoutVertexArray.emplaceBack(k),M.push(k),f=Math.min(f,k),_=Math.max(_,k)}};for(const E of n){let A=0;for(const fe of E)A+=fe.length;const M=a.triangleSegments.prepareSegment(A,a.layoutVertexArray,a.indexArray),k=M.vertexLength,D=[],B=[],U=[],K=[],te=[],oe=a.layoutVertexArray.length;for(const fe of E){if(fe.length===0)continue;fe!==E[0]&&B.push(D.length/2);const Y=a.lineSegments.prepareSegment(fe.length,a.layoutVertexArray,a.lineIndexArray),le=Y.vertexLength;h&&te.push(a.layoutVertexArray.length-oe),b(fe[0],U,K),a.layoutVertexArray.emplaceBack(fe[0].x,fe[0].y),a.lineIndexArray.emplaceBack(le+fe.length-1,le),D.push(fe[0].x),D.push(fe[0].y);for(let pe=1;pe<fe.length;pe++)b(fe[pe],U,K),a.layoutVertexArray.emplaceBack(fe[pe].x,fe[pe].y),a.lineIndexArray.emplaceBack(le+pe-1,le+pe),D.push(fe[pe].x),D.push(fe[pe].y);Y.vertexLength+=fe.length,Y.primitiveLength+=fe.length}const de=Uv(D,B);for(let fe=0;fe<de.length;fe+=3)a.indexArray.emplaceBack(k+de[fe],k+de[fe+1],k+de[fe+2]);if(de.length>0&&h&&this.elevationMode==="hd-road-base"){const fe=h.elevation.isTunnel(),Y=h.elevation.safeArea,le=this.elevatedStructures.addVertices(U,K);this.elevatedStructures.addTriangles(de,le,fe);const pe=te.length;if(pe>0){for(let ye=0;ye<pe-1;ye++)this.elevatedStructures.addRenderableRing(h.index,te[ye]+le,te[ye+1]-te[ye],fe,Y,h.featureInfo);this.elevatedStructures.addRenderableRing(h.index,te[pe-1]+le,U.length-te[pe-1],fe,Y,h.featureInfo)}}M.vertexLength+=A,M.primitiveLength+=de.length/3}return[f,_]}prepareElevatedPolygons(n,a,h){const f=1/tt(h),_=[];for(const y of n){const b=LK(y,new Ts(a,f));_.push(...b)}return _}clipPolygonsToTile(n,a){const h=-a,f=-a,_=Nt+a,y=Nt+a;let b=0;const E=[],A=[];for(;b<n.length;b++){const D=n[b],B=Gy(D);(B.min.x>=h&&B.max.x<=_&&B.min.y>=f&&B.max.y<=y?E:A).push(D)}if(E.length===n.length)return n;const M=[new Dt(h,f),new Dt(_,f),new Dt(_,y),new Dt(h,y),new Dt(h,f)],k=E;for(const D of A)k.push(...DK(D,M));return k}}let Rz,kz,Dz,Lz;Ht(CP,"FillBucket",{omit:["layers","patternFeatures"]}),Ht(PP,"FillBufferData"),Ht(ha,"ElevatedStructures");class IP{constructor(n,a,h,f){if(this.triangleCount=a.length/3,this.min=new Dt(0,0),this.max=new Dt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[_,y]=[n[0].clone(),n[0].clone()];for(let k=1;k<n.length;++k){const D=n[k];_.x=Math.min(_.x,D.x),_.y=Math.min(_.y,D.y),y.x=Math.max(y.x,D.x),y.y=Math.max(y.y,D.y)}if(f){const k=Math.ceil(Math.max(y.x-_.x,y.y-_.y)/f);h=Math.max(h,k)}if(h===0)return;this.min=_,this.max=y;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const E=Math.max(b.x,b.y)/h;this.cellsX=Math.max(1,Math.ceil(b.x/E)),this.cellsY=Math.max(1,Math.ceil(b.y/E)),this.xScale=1/E,this.yScale=1/E;const A=[];for(let k=0;k<this.triangleCount;k++){const D=n[a[3*k+0]].sub(this.min),B=n[a[3*k+1]].sub(this.min),U=n[a[3*k+2]].sub(this.min),K=Nc(Math.floor(Math.min(D.x,B.x,U.x)),this.xScale,this.cellsX),te=Nc(Math.floor(Math.max(D.x,B.x,U.x)),this.xScale,this.cellsX),oe=Nc(Math.floor(Math.min(D.y,B.y,U.y)),this.yScale,this.cellsY),de=Nc(Math.floor(Math.max(D.y,B.y,U.y)),this.yScale,this.cellsY),fe=new Dt(0,0),Y=new Dt(0,0),le=new Dt(0,0),pe=new Dt(0,0);for(let ye=oe;ye<=de;++ye){fe.y=Y.y=ye*E,le.y=pe.y=(ye+1)*E;for(let Re=K;Re<=te;++Re)fe.x=le.x=Re*E,Y.x=pe.x=(Re+1)*E,(mP(D,B,U,fe,Y,pe)||mP(D,B,U,fe,pe,le))&&A.push({cellIdx:ye*this.cellsX+Re,triIdx:k})}}if(A.length===0)return;A.sort((k,D)=>k.cellIdx-D.cellIdx||k.triIdx-D.triIdx);let M=0;for(;M<A.length;){const k=A[M].cellIdx,D={start:this.payload.length,len:0};for(;M<A.length&&A[M].cellIdx===k;)++D.len,this.payload.push(A[M++].triIdx);this.cells[k]=D}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,a){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const h=Nc(n.x-this.min.x,this.xScale,this.cellsX),f=Nc(n.y-this.min.y,this.yScale,this.cellsY),_=this.cells[f*this.cellsX+h];if(_){this._lazyInitLookup();for(let y=0;y<_.len;y++){const b=this.payload[_.start+y],E=Math.floor(b/8),A=1<<b%8;if(!(this.lookup[E]&A)&&(this.lookup[E]|=A,a.push(b),a.length===this.triangleCount))return}}}query(n,a,h){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>a.x||n.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const f=Nc(n.x-this.min.x,this.xScale,this.cellsX),_=Nc(a.x-this.min.x,this.xScale,this.cellsX),y=Nc(n.y-this.min.y,this.yScale,this.cellsY),b=Nc(a.y-this.min.y,this.yScale,this.cellsY);for(let E=y;E<=b;E++)for(let A=f;A<=_;A++){const M=this.cells[E*this.cellsX+A];if(M)for(let k=0;k<M.len;k++){const D=this.payload[M.start+k],B=Math.floor(D/8),U=1<<D%8;if(!(this.lookup[B]&U)&&(this.lookup[B]|=U,h.push(D),h.length===this.triangleCount))return}}}}function Nc(l,n,a){return Math.max(0,Math.min(a-1,Math.floor(l*n)))}Ht(IP,"TriangleGridIndex");class zz{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=n.worldview}updateFootprints(n,a){for(const h of this.footprints)a.push({footprint:h,id:n})}populate(n,a,h,f){const _=[];for(const{feature:y,id:b,index:E,sourceLayerIndex:A}of n){const M=this.layers[0]._featureFilter.needGeometry,k=Vt(y,M);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),k,h))continue;const D={id:b,properties:y.properties,type:y.type,sourceLayerIndex:A,index:E,geometry:M?k.geometry:qt(y,h,f),patterns:{}};_.push(D)}for(const y of _){const{geometry:b,index:E,sourceLayerIndex:A}=y;this.addFeature(y,b,E,h,{},a.availableImages,a.brightness),a.featureIndex.insert(n[E].feature,b,E,A,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,a,h,f,_,y,b){}destroy(){}addFeature(n,a,h,f,_,y=[],b){for(const E of uw(a,2)){const A=[],M=[],k=[],D=new Dt(1/0,1/0),B=new Dt(-1/0,-1/0);for(const te of E)if(te.length!==0){te!==E[0]&&k.push(M.length/2);for(let oe=0;oe<te.length;oe++)M.push(te[oe].x),M.push(te[oe].y),A.push(te[oe]),D.x=Math.min(D.x,te[oe].x),D.y=Math.min(D.y,te[oe].y),B.x=Math.max(B.x,te[oe].x),B.y=Math.max(B.y,te[oe].y)}const U=Uv(M,k),K=new IP(A,U,8,256);this.footprints.push({vertices:A,indices:U,grid:K,min:D,max:B})}}}Ht(zz,"ClipBucket",{omit:["layers"]});const zK=rn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),NK=rn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),jK=rn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),FK=rn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),BK=rn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),$K=rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:UK}=zK,dw=Number.MAX_SAFE_INTEGER;function Nz(l,n,a,h){return l.order<n||l.order===dw||!(l.clipMask&a)||function(f,_){return _.length!==0&&_.find(y=>y===f)===void 0}(h,l.clipScope)}function fw(l,n){return l.x-n.x||l.y-n.y}function jz(l,n){return fw(l.min,n.min)===0&&fw(l.max,n.max)===0}function OP(l,n){return!(l.min.x>n.max.x||l.max.x<n.min.x||l.min.y>n.max.y||l.max.y<n.min.y)}function MP(l,n){if(l.length!==n.length)return!1;for(let a=0;a<l.length;a++)if(l[a].sourceId!==n[a].sourceId||!jz(l[a],n[a])||l[a].order!==n[a].order||l[a].clipMask!==n[a].clipMask||!El(l[a].clipScope,n[a].clipScope))return!1;return!0}function Fz(l,n,a){const h=1/Nt,f=1/(1<<a.canonical.z),_=(n.x*h+a.canonical.x)*f+a.wrap,y=(n.y*h+a.canonical.y)*f;return{min:new Dt((l.x*h+a.canonical.x)*f+a.wrap,(l.y*h+a.canonical.y)*f),max:new Dt(_,y)}}function VK(l,n,a){const h=1<<a.canonical.z,f=((n.x-a.wrap)*h-a.canonical.x)*Nt,_=(n.y*h-a.canonical.y)*Nt;return{min:new Dt(((l.x-a.wrap)*h-a.canonical.x)*Nt,(l.y*h-a.canonical.y)*Nt),max:new Dt(f,_)}}function Bz(l,n,a,h,f,_,y){const b=l.indices,E=l.vertices,A=[];for(let M=h;M<h+f;M+=3){const k=n[a[M+0]+_],D=n[a[M+1]+_],B=n[a[M+2]+_],U=Math.min(k.x,D.x,B.x),K=Math.max(k.x,D.x,B.x),te=Math.min(k.y,D.y,B.y),oe=Math.max(k.y,D.y,B.y);A.length=0,l.grid.query(new Dt(U,te),new Dt(K,oe),A);for(let de=0;de<A.length;de++){const fe=A[de];if(mP(E[b[3*fe+0]],E[b[3*fe+1]],E[b[3*fe+2]],k,D,B,y))return!0}}return!1}function $z(l,n,a,h){if(!l||!a)return!1;let f=l.vertices;if(!n.canonical.equals(h.canonical)||n.wrap!==h.wrap){if(a.vertices.length<l.vertices.length)return $z(a,h,l,n);const _=n.canonical,y=h.canonical,b=Math.pow(2,y.z-_.z);f=l.vertices.map(E=>new Dt((E.x+_.x*Nt)*b-y.x*Nt,(E.y+_.y*Nt)*b-y.y*Nt))}return Bz(a,f,l.indices,0,l.indices.length,0,0)}function Uz(l,n,a,h){const f=Math.pow(2,h.z-a.z);return new Dt((l+a.x*Nt)*f-h.x*Nt,(n+a.y*Nt)*f-h.y*Nt)}function Vz(l,n){const a=[];n.grid.queryPoint(l,a);const h=n.indices,f=n.vertices;for(let _=0;_<a.length;_++){const y=a[_];if(rl([f[h[3*y+0]],f[h[3*y+1]],f[h[3*y+2]]],l))return!0}return!1}const RP=[new Dt(0,0),new Dt(Nt,0),new Dt(Nt,Nt),new Dt(0,Nt)];function Gz(l,n){const a=[];let h=[];if(!n||l.length<2)return[l];if(l.length===2)return Pu(l[0],l[1],RP)?[l]:[];for(let f=0;f<l.length+2;f++){const _=l[f%l.length],y=l[(f+1)%l.length],b=Pu(f===0?l[l.length-1]:l[(f-1)%l.length],_,RP),E=Pu(_,y,RP),A=b||E;A&&h.push(_),A&&E||h.length>0&&(h.length>1&&a.push(h),h=[])}return h.length>1&&a.push(h),a}const kP=zr.VectorTileFeature.types,GK=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],HK=["fill-extrusion-flood-light-ground-radius"],WK=Math.pow(2,13),qK=Math.pow(2,15)-1,Hz=new Dt(0,1),Wh=2147483648;function qv(l,n,a,h,f,_,y,b){l.emplaceBack((n<<1)+y,(a<<1)+_,(Math.floor(h*WK)<<1)+f,Math.round(b))}function Zv(l,n,a){l.emplaceBack(n.x*Nt,n.y*Nt,a?1:0)}function pw(l,n,a,h,f,_){l.emplaceBack(n.x,n.y,(a.x<<1)+h,(a.y<<1)+f,_)}function Xv(l,n,a){l.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Wz{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class qz{constructor(){this.centroidXY=new Dt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Dt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Dt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Dt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Zz{constructor(){this.acc=new Dt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,a){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=a.x,n.min.y=n.max.y=a.y)}appendEdge(n,a,h){this.accCount++,this.acc._add(a);let f=!!this.borders;a.x<n.min.x?(n.min.x=a.x,f=!0):a.x>n.max.x&&(n.max.x=a.x,f=!0),a.y<n.min.y?(n.min.y=a.y,f=!0):a.y>n.max.y&&(n.max.y=a.y,f=!0),((a.x===0||a.x===Nt)&&a.x===h.x)!=((a.y===0||a.y===Nt)&&a.y===h.y)&&this.processBorderOverlap(a,h),f&&this.checkBorderIntersection(a,h)}checkBorderIntersection(n,a){a.x<0!=n.x<0&&this.addBorderIntersection(0,pr(a.y,n.y,(0-a.x)/(n.x-a.x))),a.x>Nt!=n.x>Nt&&this.addBorderIntersection(1,pr(a.y,n.y,(Nt-a.x)/(n.x-a.x))),a.y<0!=n.y<0&&this.addBorderIntersection(2,pr(a.x,n.x,(0-a.y)/(n.y-a.y))),a.y>Nt!=n.y>Nt&&this.addBorderIntersection(3,pr(a.x,n.x,(Nt-a.y)/(n.y-a.y)))}addBorderIntersection(n,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[n];a<h[0]&&(h[0]=a),a>h[1]&&(h[1]=a)}processBorderOverlap(n,a){if(n.x===a.x){if(n.y===a.y)return;const h=n.x===0?0:1;this.addBorderIntersection(h,a.y),this.addBorderIntersection(h,n.y)}else{const h=n.y===0?2:3;this.addBorderIntersection(h,a.x),this.addBorderIntersection(h,n.x)}}centroid(){return this.accCount===0?new Dt(0,0):new Dt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,a)=>n+ +(a[0]!==Number.MAX_VALUE),0):0}}function Xz(l,n){const a=l.add(n)._unit(),h=Ee(l.x*a.x+l.y*a.y,-1,1);var f,_,y;return f=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(f)))/4*qK*((_=l).x*(y=n).y-_.y*y.x<0?-1:1)}const ZK=[l=>l.x<0,l=>l.x>Nt,l=>l.y<0,l=>l.y>Nt];function XK(l,n,a,h){const f=[4];if(h===0)return f;a._mult(h);const _=l.sub(a),y=n.sub(a),b=[l,n,_,y];for(let E=0;E<4;E++)for(const A of b)if(ZK[E](A)){f.push(E);break}return f}class Kz{constructor(n){this.vertexArray=new Dh,this.indexArray=new To,this.programConfigurations=new p(n.layers,{zoom:n.zoom,lut:n.lut},a=>HK.includes(a)),this._segments=new mi,this.hiddenByLandmarkVertexArray=new ig,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new mi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,a,h,f=!1){const _=n.length;if(_>2){let y=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[y].length);let E;y!==this._segments.get().length-1&&(y++,this._segmentToGroundQuads[y]=[],this._segmentToRegionTriCounts[y]=[0,0,0,0,0]);{const A=n[0],M=n[1];E=Xz(A.sub(n[_-1])._perp()._unit(),M.sub(A)._perp()._unit())}for(let A=0;A<_;A++){const M=A===_-1?0:A+1,k=n[A],D=n[M],B=n[M===_-1?0:M+1],U=D.sub(k)._perp()._unit(),K=Xz(U,B.sub(D)._perp()._unit()),te=E,oe=K;if(DP(k,D,a)||f&&Qz(k,a)&&Qz(D,a)){E=K;continue}const de=b.vertexLength;pw(this.vertexArray,k,D,1,1,te),pw(this.vertexArray,k,D,1,0,te),pw(this.vertexArray,k,D,0,1,oe),pw(this.vertexArray,k,D,0,0,oe),b.vertexLength+=4;const fe=XK(k,D,U,h);for(const Y of fe)this._segmentToGroundQuads[y].push({id:de,region:Y}),this._segmentToRegionTriCounts[y][Y]+=2,b.primitiveLength+=2;E=K}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),a=n.length;for(let h=0;h<a;h++)this._segmentToGroundQuads[h].sort((f,_)=>f.region-_.region);for(let h=0;h<a;h++){const f=this._segmentToGroundQuads[h],_=n[h],y=this._segmentToRegionTriCounts[h];y.reduce((E,A)=>E+A,0);let b=0;for(let E=0;E<=4;E++){const A=y[E];if(A!==0){let M=this.regionSegments[E];M||(M=this.regionSegments[E]=new mi);const k={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+b,vertexLength:_.vertexLength,primitiveLength:A};M.get().push(k)}b+=A}for(let E=0;E<f.length;E++){const A=f[E].id;this.indexArray.emplaceBack(A,A+1,A+3),this.indexArray.emplaceBack(A,A+3,A+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,a,h,f,_,y,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,a,h,f,_,y,void 0,b)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,NK.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,a,h,f,_,y,b,E){this.hasData()&&this.programConfigurations.updatePaintArrays(n,a,h,f,_,y,b,E)}updateHiddenByLandmark(n){if(!this.hasData())return;const a=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const h=n.flags&Wh?1:0;for(let f=n.groundVertexArrayOffset;f<a;++f)this.hiddenByLandmarkVertexArray.emplace(f,h);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,BK.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const a=this.regionSegments[n];a&&a.destroy()}}}}class mw{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.pixelRatio=n.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new To,this.footprintVertices=new Nl,this.footprintSegments=[],this.layoutVertexArray=new kh,this.centroidVertexArray=new Kb,this.wallVertexArray=new Jb,this.indexArray=new To,this.programConfigurations=new p(n.layers,{zoom:n.zoom,lut:n.lut},a=>GK.includes(a)),this.segments=new mi,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new Kz(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=n.worldview}updateFootprints(n,a){}populate(n,a,h,f){this.features=[],this.hasPattern=TP("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=tt(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:y,index:b,sourceLayerIndex:E}of n){const A=this.layers[0]._featureFilter.needGeometry,M=Vt(_,A);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),M,h))continue;const k={id:y,sourceLayerIndex:E,index:b,geometry:A?M.geometry:qt(_,h,f),properties:_.properties,type:_.type,patterns:{}},D=this.layoutVertexArray.length,B=kP[k.type]==="Polygon";if(this.hasPattern)this.features.push(EP("fill-extrusion",this.layers,k,this.zoom,this.pixelRatio,a));else if(this.wallMode)for(const U of k.geometry)for(const K of Gz(U,B))this.addFeature(k,[K],b,h,{},a.availableImages,f,a.brightness);else this.addFeature(k,k.geometry,b,h,{},a.availableImages,f,a.brightness);a.featureIndex.insert(_,k.geometry,b,E,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,a,h,f,_,y){for(const b of this.features){const E=kP[b.type]==="Polygon",{geometry:A}=b;if(this.wallMode)for(const M of A)for(const k of Gz(M,E))this.addFeature(b,[k],b.index,a,h,f,_,y);else this.addFeature(b,A,b.index,a,h,f,_,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,a,h,f,_,y,b){this.programConfigurations.updatePaintArrays(n,a,_,h,f,y,b,this.worldview),this.groundEffect.update(n,a,_,h,f,y,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,UK),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,FK.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,$K.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,jK.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,h,f,_,y,b,E){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,M=[new Dt(0,0),new Dt(Nt,Nt)],k=b.projection,D=k.name==="globe",B=this.wallMode||kP[n.type]==="Polygon",U=new Zz;U.centroidDataIndex=this.centroidData.length;const K=new qz,te=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},f)<=0,oe=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},f);let de;if(K.height=oe,K.vertexArrayOffset=this.layoutVertexArray.length,K.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new tg),this.wallMode){if(D)return void Rr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;de=function(ke){const je=ke[0].x===ke[ke.length-1].x&&ke[0].y===ke[ke.length-1].y;(function(Ft){let Et=0;const Tr=Ft.length;for(let Xt=0;Xt<Tr;Xt++)Et+=(Ft[(Xt+1)%Tr].x-Ft[Xt].x)*(Ft[(Xt+1)%Tr].y+Ft[Xt].y);return Et>=0})(ke)||(ke=ke.reverse());const xt={geometry:[],joinNormals:[],indices:[]},ft=[],vt=[],wt=[];let it=ke.length;for(;it>=2&&ke[it-1].equals(ke[it-2]);)it--;if(it<(je?3:2))return xt;let _t,et,nt,Pt,It,sr=0;for(;sr<it-1&&ke[sr].equals(ke[sr+1]);)sr++;je&&(_t=ke[it-2],It=ke[sr].sub(_t)._unit()._perp());for(let Ft=sr;Ft<it;Ft++){if(nt=Ft===it-1?je?ke[sr+1]:void 0:ke[Ft+1],nt&&ke[Ft].equals(nt))continue;It&&(Pt=It),_t&&(et=_t),_t=ke[Ft],It=nt?nt.sub(_t)._unit()._perp():Pt,Pt=Pt||It;let Et=Pt.add(It);Et.x===0&&Et.y===0||Et._unit();const Tr=Et.x*It.x+Et.y*It.y,Xt=Tr!==0?1/Tr:1/0,Jt=Pt.x*It.y-Pt.y*It.x>0;let mr="miter";const Or=2;mr==="miter"&&Xt>Or&&(mr="bevel"),mr==="bevel"&&(Xt>100&&(mr="flipbevel"),Xt<Or&&(mr="miter"));const Ir=(Ur,Dr,Vr,mn)=>{const Bn=new Dt(Ur.x,Ur.y),ge=new Dt(Ur.x,Ur.y);Bn.x+=Dr.x*mn,Bn.y+=Dr.y*mn,ge.x-=Dr.x*Math.max(Vr,1),ge.y-=Dr.y*Math.max(Vr,1),wt.push(Dr),ft.push(Bn),vt.push(ge)};if(mr==="miter")Et._mult(Xt),Ir(_t,Et,0,0);else if(mr==="flipbevel")Et=It.mult(-1),Ir(_t,Et,0,0),Ir(_t,Et.mult(-1),0,0);else{const Ur=-Math.sqrt(Xt*Xt-1),Dr=Jt?Ur:0,Vr=Jt?0:Ur;et&&Ir(_t,Pt,Dr,Vr),nt&&Ir(_t,It,Dr,Vr)}}xt.geometry=[...ft,...vt.reverse(),ft[0]],xt.joinNormals=[...wt,...wt.reverse(),wt[wt.length-1]];const Kt=xt.geometry.length-1;for(let Ft=0;Ft<Kt/2;Ft++)if(Ft+1<Kt/2){let Et=Ft,Tr=Ft+1,Xt=Kt-1-Ft,Jt=Kt-2-Ft;Et=Et===0?Kt-1:Et-1,Tr=Tr===0?Kt-1:Tr-1,Xt=Xt===0?Kt-1:Xt-1,Jt=Jt===0?Kt-1:Jt-1,xt.indices.push(Xt),xt.indices.push(Tr),xt.indices.push(Et),xt.indices.push(Xt),xt.indices.push(Jt),xt.indices.push(Tr)}return xt}(a[0]),a=[de.geometry]}const fe=(ke,je)=>ke<(je.length-1)/2||ke===je.length-1,Y=this.wallMode?[a]:uw(a,500);for(let ke=Y.length-1;ke>=0;ke--){const je=Y[ke];(je.length===0||(le=je[0]).every(rt=>rt.x<=0)||le.every(rt=>rt.x>=Nt)||le.every(rt=>rt.y<=0)||le.every(rt=>rt.y>=Nt))&&Y.splice(ke,1)}var le;let pe;if(D)pe=nN(Y,M,f);else{pe=[];for(const ke of Y)pe.push({polygon:ke,bounds:M})}const ye=B?this.edgeRadius:0,Re=ye>0&&this.zoom<17,Ie=(ke,je)=>{if(ke.length===0)return!1;const rt=ke[ke.length-1];return je.x===rt.x&&je.y===rt.y};for(const{polygon:ke,bounds:je}of pe){let rt=0,xt=0;for(const it of ke)B&&!it[0].equals(it[it.length-1])&&it.push(it[0]),xt+=B?it.length-1:it.length;const ft=this.segments.prepareSegment((B?5:4)*xt,this.layoutVertexArray,this.indexArray);K.footprintSegIdx<0&&(K.footprintSegIdx=this.footprintSegments.length),K.polygonSegIdx<0&&(K.polygonSegIdx=this.polygonSegments.length);const vt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},wt=new Wz;if(wt.vertexOffset=this.footprintVertices.length,wt.indexOffset=3*this.footprintIndices.length,wt.ringIndices=[],B){const it=[],_t=[];rt=ft.vertexLength;for(let nt=0;nt<ke.length;nt++){const Pt=ke[nt];Pt.length&&nt!==0&&_t.push(it.length/2);const It=[];let sr,Kt;sr=Pt[1].sub(Pt[0])._perp()._unit(),wt.ringIndices.push(Pt.length-1);for(let Ft=1;Ft<Pt.length;Ft++){const Et=Pt[Ft],Tr=Pt[Ft===Pt.length-1?1:Ft+1],Xt=Et.clone();if(ye){Kt=Tr.sub(Et)._perp()._unit();const Jt=sr.add(Kt)._unit(),mr=ye*Math.min(4,1/(sr.x*Jt.x+sr.y*Jt.y));Xt.x+=mr*Jt.x,Xt.y+=mr*Jt.y,Xt.x=Math.round(Xt.x),Xt.y=Math.round(Xt.y),sr=Kt}if(!te||ye!==0&&!Re||Ie(It,Xt)||It.push(Xt),qv(this.layoutVertexArray,Xt.x,Xt.y,0,0,1,1,0),this.wallMode){const Jt=fe(Ft,Pt);Zv(this.wallVertexArray,de.joinNormals[Ft],!Jt)}ft.vertexLength++,this.footprintVertices.emplaceBack(Et.x,Et.y),it.push(Et.x,Et.y),D&&Xv(this.layoutVertexExtArray,k.projectTilePoint(Xt.x,Xt.y,f),k.upVector(f,Xt.x,Xt.y))}te&&(ye===0||Re)&&(It.length!==0&&Ie(It,It[0])&&It.pop(),this.groundEffect.addData(It,je,A))}const et=this.wallMode?de.indices:Uv(it,_t);for(let nt=0;nt<et.length;nt+=3)this.footprintIndices.emplaceBack(wt.vertexOffset+et[nt+0],wt.vertexOffset+et[nt+1],wt.vertexOffset+et[nt+2]),this.indexArray.emplaceBack(rt+et[nt],rt+et[nt+2],rt+et[nt+1]),ft.primitiveLength++;wt.indexCount+=et.length,wt.vertexCount+=this.footprintVertices.length-wt.vertexOffset}for(let it=0;it<ke.length;it++){const _t=ke[it];U.startRing(K,_t[0]);let et=_t.length>4&&eN(_t[_t.length-2],_t[0],_t[1]),nt=ye?KK(_t[_t.length-2],_t[0],_t[1],ye):0;const Pt=[];let It,sr,Kt;sr=_t[1].sub(_t[0])._perp()._unit();let Ft=!0;for(let Et=1,Tr=0;Et<_t.length;Et++){let Xt=_t[Et-1],Jt=_t[Et];const mr=_t[Et===_t.length-1?1:Et+1];if(U.appendEdge(K,Jt,Xt),DP(Jt,Xt,je)){ye&&(sr=mr.sub(Jt)._perp()._unit(),Ft=!Ft);continue}const Or=Jt.sub(Xt)._perp(),Ir=Or.x/(Math.abs(Or.x)+Math.abs(Or.y)),Ur=Or.y>0?1:0,Dr=Xt.dist(Jt);if(Tr+Dr>32768&&(Tr=0),ye){Kt=mr.sub(Jt)._perp()._unit();let ge=Jz(Xt,Jt,mr,Yz(sr,Kt),ye);isNaN(ge)&&(ge=0);const ve=Jt.sub(Xt)._unit();Xt=Xt.add(ve.mult(nt))._round(),Jt=Jt.add(ve.mult(-ge))._round(),nt=ge,sr=Kt,te&&this.zoom>=17&&(Ie(Pt,Xt)||Pt.push(Xt),Ie(Pt,Jt)||Pt.push(Jt))}const Vr=ft.vertexLength,mn=_t.length>4&&eN(Xt,Jt,mr);let Bn=tN(Tr,et,Ft);if(qv(this.layoutVertexArray,Xt.x,Xt.y,Ir,Ur,0,0,Bn),qv(this.layoutVertexArray,Xt.x,Xt.y,Ir,Ur,0,1,Bn),this.wallMode){const ge=fe(Et-1,_t),ve=de.joinNormals[Et-1];Zv(this.wallVertexArray,ve,ge),Zv(this.wallVertexArray,ve,ge)}if(Tr+=Dr,Bn=tN(Tr,mn,!Ft),et=mn,qv(this.layoutVertexArray,Jt.x,Jt.y,Ir,Ur,0,0,Bn),qv(this.layoutVertexArray,Jt.x,Jt.y,Ir,Ur,0,1,Bn),this.wallMode){const ge=fe(Et,_t),ve=de.joinNormals[Et];Zv(this.wallVertexArray,ve,ge),Zv(this.wallVertexArray,ve,ge)}if(ft.vertexLength+=4,this.indexArray.emplaceBack(Vr+0,Vr+1,Vr+2),this.indexArray.emplaceBack(Vr+1,Vr+3,Vr+2),ft.primitiveLength+=2,ye){const ge=rt+(Et===1?_t.length-2:Et-2),ve=Et===1?rt:ge+1;if(this.indexArray.emplaceBack(Vr+1,ge,Vr+3),this.indexArray.emplaceBack(ge,ve,Vr+3),ft.primitiveLength+=2,It===void 0&&(It=Vr),!DP(mr,_t[Et],je)){const ot=Et===_t.length-1?It:ft.vertexLength;this.indexArray.emplaceBack(Vr+2,Vr+3,ot),this.indexArray.emplaceBack(Vr+3,ot+1,ot),this.indexArray.emplaceBack(Vr+3,ve,ot+1),ft.primitiveLength+=3}Ft=!Ft}if(D){const ge=this.layoutVertexExtArray,ve=k.projectTilePoint(Xt.x,Xt.y,f),ot=k.projectTilePoint(Jt.x,Jt.y,f),Rt=k.upVector(f,Xt.x,Xt.y),Bt=k.upVector(f,Jt.x,Jt.y);Xv(ge,ve,Rt),Xv(ge,ve,Rt),Xv(ge,ot,Bt),Xv(ge,ot,Bt)}}B&&(rt+=_t.length-1),te&&ye&&this.zoom>=17&&(Pt.length!==0&&Ie(Pt,Pt[0])&&Pt.pop(),this.groundEffect.addData(Pt,je,A,ye>0))}this.footprintSegments.push(wt),vt.triangleCount=this.indexArray.length-vt.triangleArrayOffset,this.polygonSegments.push(vt),++K.footprintSegLen,++K.polygonSegLen}if(K.vertexCount=this.layoutVertexArray.length-K.vertexArrayOffset,K.groundVertexCount=this.groundEffect.vertexArray.length-K.groundVertexArrayOffset,K.vertexCount!==0){if(K.centroidXY=U.borders?Hz:this.encodeCentroid(U,K),this.centroidData.push(K),U.borders){this.featuresOnBorder.push(U);const ke=this.featuresOnBorder.length-1;for(let je=0;je<U.borders.length;je++)U.borders[je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[je].push(ke)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,_,y,f,E,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(n,h,_,y,f,E,this.worldview),this.maxHeight=Math.max(this.maxHeight,oe)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((a,h)=>this.featuresOnBorder[a].borders[n][0]-this.featuresOnBorder[h].borders[n][0])}splitToSubtiles(){const n=[];for(let b=0;b<this.centroidData.length;b++){const E=this.centroidData[b],A=+(E.min.y+E.max.y>Nt),M=2*A+(+(E.min.x+E.max.x>Nt)^A);for(let k=0;k<E.polygonSegLen;k++){const D=E.polygonSegIdx+k;n.push({centroidIdx:b,subtile:M,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}const a=new To;n.sort((b,E)=>b.triangleSegmentIdx===E.triangleSegmentIdx?b.subtile-E.subtile:b.triangleSegmentIdx-E.triangleSegmentIdx);let h=0,f=0,_=0;for(const b of n){if(b.triangleSegmentIdx!==h)break;_++}const y=n.length;for(;f!==n.length;){h=n[f].triangleSegmentIdx;let b=0,E=f,A=f;for(let M=E;M<_&&n[M].subtile===b;M++)A++;for(;E!==_;){const M=n[E];b=M.subtile;const k=this.centroidData[M.centroidIdx].min.clone(),D=this.centroidData[M.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let U=E;U<A;U++){const K=n[U],te=this.polygonSegments[K.polygonSegmentIdx],oe=this.centroidData[K.centroidIdx].min,de=this.centroidData[K.centroidIdx].max,fe=this.indexArray.uint16;for(let Y=te.triangleArrayOffset;Y<te.triangleArrayOffset+te.triangleCount;Y++)a.emplaceBack(fe[3*Y],fe[3*Y+1],fe[3*Y+2]);B.primitiveLength+=te.triangleCount,k.x=Math.min(k.x,oe.x),k.y=Math.min(k.y,oe.y),D.x=Math.max(D.x,de.x),D.y=Math.max(D.y,de.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:k,max:D}),E=A;for(let U=E;U<_&&n[U].subtile===n[E].subtile;U++)A++}f=_;for(let M=f;M<y&&n[M].triangleSegmentIdx===n[f].triangleSegmentIdx;M++)_++}a._trim(),this.indexArray=a}getVisibleSegments(n,a,h){const f=new mi;if(this.wallMode){for(const K of this.triangleSubSegments)f.segments.push(K.segment);return f}let _=0,y=0;const b=1<<n.canonical.z;if(a){const K=a.getMinMaxForTile(n);K&&(_=K.min,y=K.max)}y+=this.maxHeight;const E=n.toUnwrapped();let A;const M=[E.canonical.x/b+E.wrap,E.canonical.y/b],k=[(E.canonical.x+1)/b+E.wrap,(E.canonical.y+1)/b],D=(K,te,oe)=>[K[0]*(1-oe[0])+te[0]*oe[0],K[1]*(1-oe[1])+te[1]*oe[1]],B=[],U=[];for(const K of this.triangleSubSegments){B[0]=K.min.x/Nt,B[1]=K.min.y/Nt,U[0]=K.max.x/Nt,U[1]=K.max.y/Nt;const te=D(M,k,B),oe=D(M,k,U);if(new on([te[0],te[1],_],[oe[0],oe[1],y]).intersectsPrecise(h)===0){A&&(f.segments.push(A),A=void 0);continue}const de=K.segment;A&&A.vertexOffset!==de.vertexOffset&&(f.segments.push(A),A=void 0),A?(A.vertexLength+=de.vertexLength,A.primitiveLength+=de.primitiveLength):A={vertexOffset:de.vertexOffset,primitiveLength:de.primitiveLength,vertexLength:de.vertexLength,primitiveOffset:de.primitiveOffset,sortKey:void 0,vaos:{}}}return A&&f.segments.push(A),f}encodeCentroid(n,a){const h=n.centroid(),f=a.span(),_=Math.min(7,Math.round(f.x*this.tileToMeter/10)),y=Math.min(7,Math.round(f.y*this.tileToMeter/10));return new Dt(Ee(h.x,1,Nt-1)<<3|_,Ee(h.y,1,Nt-1)<<3|y)}encodeBorderCentroid(n){if(!n.borders)return new Dt(0,0);const a=n.borders,h=Number.MAX_VALUE;if(a[0][0]!==h||a[1][0]!==h){const f=a[0][0]!==h?0:1;return new Dt(6|(a[0][0]!==h?0:65528),(a[f][0]+a[f][1])/2<<3|6)}{const f=a[2][0]!==h?2:3;return new Dt((a[f][0]+a[f][1])/2<<3|6,6|(a[2][0]!==h?0:65528))}}showCentroid(n){const a=this.centroidData[n.centroidDataIndex];a.flags&=Wh,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const a=n.vertexArrayOffset,h=n.vertexCount+n.vertexArrayOffset,f=n.flags&Wh?Hz:n.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==f.y||_!==f.x){for(let y=a;y<h;++y)this.centroidVertexArray.emplace(y,f.x,f.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(n.toUnwrapped());if(MP(this.activeReplacements,f))return;if(this.activeReplacements=f,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const y of this.centroidData)y.flags&=2147483647;const _=[];for(const y of this.activeReplacements){if(y.order<h)continue;const b=Math.max(1,Math.pow(2,y.footprintTileId.canonical.z-n.canonical.z));for(const E of this.centroidData)if(!(E.flags&Wh||y.min.x>E.max.x||E.min.x>y.max.x||y.min.y>E.max.y||E.min.y>y.max.y))for(let A=0;A<E.footprintSegLen;A++){const M=this.footprintSegments[E.footprintSegIdx+A];if(_.length=0,YK(this.footprintVertices,M.vertexOffset,M.vertexCount,y.footprintTileId.canonical,n.canonical,_),Bz(y.footprint,_,this.footprintIndices.uint16,M.indexOffset,M.indexCount,-M.vertexOffset,-b)){E.flags|=Wh;break}}}for(const y of this.centroidData)this.writeCentroidToBuffer(y);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,a,h){let f=!1;for(let _=0;_<h.footprintSegLen;_++){const y=this.footprintSegments[h.footprintSegIdx+_];let b=0;for(const E of y.ringIndices){for(let A=b,M=E+b-1;A<E+b;M=A++){const k=this.footprintVertices.int16[2*(A+y.vertexOffset)+0],D=this.footprintVertices.int16[2*(A+y.vertexOffset)+1],B=this.footprintVertices.int16[2*(M+y.vertexOffset)+1];D>a!=B>a&&n<(this.footprintVertices.int16[2*(M+y.vertexOffset)+0]-k)*(a-D)/(B-D)+k&&(f=!f)}b=E}}return f}getHeightAtTileCoord(n,a){let h=Number.NEGATIVE_INFINITY,f=!0;const _=4*(n+Nt)*Nt+(a+Nt);if(this.partLookup.hasOwnProperty(_)){const y=this.partLookup[_];return y?{height:y.height,hidden:!!(y.flags&Wh)}:void 0}for(const y of this.centroidData)n>y.max.x||y.min.x>n||a>y.max.y||y.min.y>a||this.footprintContainsPoint(n,a,y)&&y&&y.height>h&&(h=y.height,this.partLookup[_]=y,f=!!(y.flags&Wh));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:f};this.partLookup[_]=void 0}}function Yz(l,n){const a=l.add(n)._unit();return l.x*a.x+l.y*a.y}function KK(l,n,a,h){const f=n.sub(l)._perp()._unit(),_=a.sub(n)._perp()._unit();return Jz(l,n,a,Yz(f,_),h)}function Jz(l,n,a,h,f){const _=Math.sqrt(1-h*h);return Math.min(l.dist(n)/3,n.dist(a)/3,f*_/h)}function DP(l,n,a){return l.x<a[0].x&&n.x<a[0].x||l.x>a[1].x&&n.x>a[1].x||l.y<a[0].y&&n.y<a[0].y||l.y>a[1].y&&n.y>a[1].y}function Qz(l,n){return l.x<n[0].x||l.x>n[1].x||l.y<n[0].y||l.y>n[1].y}function eN(l,n,a){if(l.x<0||l.x>=Nt||n.x<0||n.x>=Nt||a.x<0||a.x>=Nt)return!1;const h=a.sub(n),f=h.perp(),_=l.sub(n);return(h.x*_.x+h.y*_.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(_.x*_.x+_.y*_.y))>-.866&&f.x*_.x+f.y*_.y<0}function tN(l,n,a){const h=n?2|l:-3&l;return a?1|h:-2&h}function rN(){const l=Math.PI/32,n=Math.tan(l),a=ie;return a*Math.sqrt(1+2*n*n)-a}function nN(l,n,a){const h=1<<a.z,f=Oe(a.x/h),_=Oe((a.x+1)/h),y=Ve(a.y/h),b=Ve((a.y+1)/h);return function(E,A,M,k,D=0,B){const U=[];if(!E.length||!M||!k)return U;const K=(pe,ye)=>{for(const Re of pe)U.push({polygon:Re,bounds:ye})},te=Math.ceil(Math.log2(M)),oe=Math.ceil(Math.log2(k)),de=te-oe,fe=[];for(let pe=0;pe<Math.abs(de);pe++)fe.push(de>0?0:1);for(let pe=0;pe<Math.min(te,oe);pe++)fe.push(0),fe.push(1);let Y=E;if(Y=hw(Y,A[0].y-D,A[1].y+D,1),Y=hw(Y,A[0].x-D,A[1].x+D,0),!Y.length)return U;const le=[];for(fe.length?le.push({polygons:Y,bounds:A,depth:0}):K(Y,A);le.length;){const pe=le.pop(),ye=pe.depth,Re=fe[ye],Ie=pe.bounds[0],ke=pe.bounds[1],je=Re===0?Ie.x:Ie.y,rt=Re===0?ke.x:ke.y,xt=B?B(Re,je,rt):.5*(je+rt),ft=hw(pe.polygons,je-D,xt+D,Re),vt=hw(pe.polygons,xt-D,rt+D,Re);if(ft.length){const wt=[Ie,new Dt(Re===0?xt:ke.x,Re===1?xt:ke.y)];fe.length>ye+1?le.push({polygons:ft,bounds:wt,depth:ye+1}):K(ft,wt)}if(vt.length){const wt=[new Dt(Re===0?xt:Ie.x,Re===1?xt:Ie.y),ke];fe.length>ye+1?le.push({polygons:vt,bounds:wt,depth:ye+1}):K(vt,wt)}}return U}(l,n,Math.ceil((_-f)/11.25),Math.ceil((y-b)/11.25),1,(E,A,M)=>{if(E===0)return .5*(A+M);{const k=Ve((a.y+A/Nt)/h);return(we(.5*(Ve((a.y+M/Nt)/h)+k))*h-a.y)*Nt}})}function YK(l,n,a,h,f,_){const y=Math.pow(2,h.z-f.z);for(let b=0;b<a;b++){let E=l.int16[2*(b+n)+0],A=l.int16[2*(b+n)+1];E=(E+f.x*Nt)*y-h.x*Nt,A=(A+f.y*Nt)*y-h.y*Nt,_.push(new Dt(E,A))}}let iN,oN;Ht(mw,"FillExtrusionBucket",{omit:["layers","features"]}),Ht(qz,"PartData"),Ht(Wz,"FootprintSegment"),Ht(Zz,"BorderCentroidData"),Ht(Kz,"GroundEffect");class np extends Dt{constructor(n,a,h){super(n,a),this.z=h}}class sN extends np{constructor(n,a,h,f){super(n,a,h),this.w=f}}function aN(l,n,a,h){const f=a==="x"?"y":"x",_=(h-l[a])/(n[a]-l[a]);l[f]=Math.round(l[f]+(n[f]-l[f])*_),l[a]=h,l.hasOwnProperty("z")&&(l.z=pr(l.z,n.z,_)),l.hasOwnProperty("w")&&(l.w=pr(l.w,n.w,_))}function lN(l,n,a,h){const f=a,_=h;for(const y of["x","y"]){let b=l,E=n;b[y]>=E[y]&&(b=n,E=l),b[y]<f&&E[y]>f&&aN(b,E,y,f),b[y]<_&&E[y]>_&&aN(E,b,y,_)}}function gw(l,n,a,h,f,_){const y=[];for(let b=0;b<l.length;b++){const E=l[b];let A;const M=y.length;let k=0;for(let D=0;D<E.length-1;D++){let B=E[D],U=E[D+1],K=0;const te=k;let oe,de;_&&(K=Math.hypot(U.x-B.x,U.y-B.y),k+=K,oe=B,de=U),B.x<n&&U.x<n||(B.x<n?B=new Dt(n,B.y+(n-B.x)/(U.x-B.x)*(U.y-B.y))._round():U.x<n&&(U=new Dt(n,B.y+(n-B.x)/(U.x-B.x)*(U.y-B.y))._round()),B.y<a&&U.y<a||(B.y<a?B=new Dt(B.x+(a-B.y)/(U.y-B.y)*(U.x-B.x),a)._round():U.y<a&&(U=new Dt(B.x+(a-B.y)/(U.y-B.y)*(U.x-B.x),a)._round()),B.x>=h&&U.x>=h||(B.x>=h?B=new Dt(h,B.y+(h-B.x)/(U.x-B.x)*(U.y-B.y))._round():U.x>=h&&(U=new Dt(h,B.y+(h-B.x)/(U.x-B.x)*(U.y-B.y))._round()),B.y>=f&&U.y>=f||(B.y>=f?B=new Dt(B.x+(f-B.y)/(U.y-B.y)*(U.x-B.x),f)._round():U.y>=f&&(U=new Dt(B.x+(f-B.y)/(U.y-B.y)*(U.x-B.x),f)._round()),A&&B.equals(A[A.length-1])||(A=[B],y.push(A),_&&_.push({progress:{min:te+cN(oe,de,B)*K,max:1},parentIndex:b,prevPoint:oe,nextPoint:de})),A.push(U),_&&(_[_.length-1].progress.max=te+cN(oe,de,U)*K,_[_.length-1].nextPoint=de)))))}if(_&&k>0)for(let D=M;D<y.length;D++)_[D].progress.min/=k,_[D].progress.max/=k}return y}function JK(l,n,a,h,f){if(l.length<2)return void h.push(l);const _=[];for(;n.valid();){const[A,M]=n.get();for(let k=0;k<l.length-1;k++){const D=l[k],B=l[k+1],U=Fv(D,B,A,M);if(U){const[K]=U,te=new Dt(pr(D.x,B.x,K),pr(D.y,B.y,K));_.push({t:k+K,distance:0,point:te})}}n.next()}if(_.length===0)return void h.push(l);_.sort((A,M)=>A.t-M.t);let y=0,b=0,E=[];for(h.push(E);y!==l.length;){if(b===_.length){for(;y!==l.length;)E.length!==0&&E[E.length-1].equals(l[y])||E.push(l[y]),y++;break}_[b].t<=y?(E.length!==0&&E[E.length-1].equals(_[b].point)||E.push(_[b].point),Math.trunc(_[b].t),b++):(E.length!==0&&E[E.length-1].equals(l[y])||E.push(l[y]),y++)}}function cN(l,n,a){return l.x!==n.x?(a.x-l.x)/(n.x-l.x):l.y!==n.y?(a.y-l.y)/(n.y-l.y):0}function Kv(l,n){return l.x*n.x+l.y*n.y}function uN(l,n){if(l.length===1){let a=0;const h=n[a++];let f;for(;!f||h.equals(f);)if(f=n[a++],!f)return 1/0;for(;a<n.length;a++){const _=n[a],y=l[0],b=f.sub(h),E=_.sub(h),A=y.sub(h),M=Kv(b,b),k=Kv(b,E),D=Kv(E,E),B=Kv(A,b),U=Kv(A,E),K=M*D-k*k,te=(D*B-k*U)/K,oe=(M*U-k*B)/K,de=h.z*(1-te-oe)+f.z*te+_.z*oe;if(isFinite(de))return de}return 1/0}{let a=1/0;for(const h of n)a=Math.min(a,h.z);return a}}function hN(l,n,a,h,f,_,y,b){const E=y*f.getElevationAt(l,n,!0,!0),A=_[0]!==0,M=A?_[1]===0?y*(_[0]/7-450):y*function(k,D,B){const U=Math.floor(D[0]/8),K=Math.floor(D[1]/8),te=10*(D[0]-8*U),oe=10*(D[1]-8*K),de=k.getElevationAt(U,K,!0,!0),fe=k.getMeterToDEM(B),Y=Math.floor(.5*(te*fe-1)),le=Math.floor(.5*(oe*fe-1)),pe=k.tileCoordToPixel(U,K),ye=2*Y+1,Re=2*le+1,Ie=function(vt,wt,it,_t,et){return[vt.getElevationAtPixel(wt,it,!0),vt.getElevationAtPixel(wt+et,it,!0),vt.getElevationAtPixel(wt,it+et,!0),vt.getElevationAtPixel(wt+_t,it+et,!0)]}(k,pe.x-Y,pe.y-le,ye,Re),ke=Math.abs(Ie[0]-Ie[1]),je=Math.abs(Ie[2]-Ie[3]),rt=Math.abs(Ie[0]-Ie[2])+Math.abs(Ie[1]-Ie[3]),xt=Math.min(.25,.5*fe*(ke+je)/ye),ft=Math.min(.25,.5*fe*rt/Re);return de+Math.max(xt*te,ft*oe)}(f,_,b):E;return{base:E+(a===0?-1:a),top:A?Math.max(M+h,E+a+2):E+h}}class QK{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class eY{constructor(){this.tasks={},this.taskQueue=[],Yt(["process"],this),this.invoker=new QK(this.process),this.nextId=0}add(n,a){const h=this.nextId++,f=function({type:_,isSymbolTile:y,zoom:b}){return b=b||0,_==="message"?0:_!=="maybePrepare"||y?_!=="parseTile"||y?_==="parseTile"&&y?300-b:_==="maybePrepare"&&y?400-b:500:200-b:100-b}(a);if(f===0){try{n()}finally{}return null}return this.tasks[h]={fn:n,metadata:a,priority:f,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const a=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let n=null,a=1/0;for(let f=0;f<this.taskQueue.length;f++){const _=this.tasks[this.taskQueue[f]];_.priority<a&&(a=_.priority,n=f)}if(n===null)return null;const h=this.taskQueue[n];return this.taskQueue.splice(n,1),h}remove(){this.invoker.remove()}}class dN{constructor(n,a,h){this.target=n,this.parent=a,this.mapId=h,this.callbacks={},this.cancelCallbacks={},Yt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new eY}send(n,a,h,f,_=!1,y){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=y,this.callbacks[b]=h);const E=new Set;return this.target.postMessage({id:b,type:n,hasCallback:!!h,targetMapId:f,mustQueue:_,sourceMapId:this.mapId,data:Ec(a,E)},E),{cancel:()=>{h&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(n){const a=n.data;if(!a)return;const h=a.id;if(h&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const f=this.cancelCallbacks[h];delete this.cancelCallbacks[h],f&&f.cancel()}else if(a.mustQueue||_n(self)){const f=this.callbacks[h],_=this.scheduler.add(()=>this.processTask(h,a),f&&f.metadata||{type:"message"});_&&(this.cancelCallbacks[h]=_)}else this.processTask(h,a)}processTask(n,a){if(delete this.cancelCallbacks[n],a.type==="<response>"){const h=this.callbacks[n];delete this.callbacks[n],h&&(a.error?h(Ac(a.error)):h(null,Ac(a.data)))}else{const h=new Set,f=a.hasCallback?(y,b)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:y?Ec(y):null,data:Ec(b,h)},h)}:()=>{},_=Ac(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,_,f);else if(this.parent.getWorkerSource){const y=a.type.split("."),{source:b,scope:E}=_;this.parent.getWorkerSource(a.sourceMapId,y[0],b,E)[y[1]](_,f)}else f(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Yv={workerUrl:"",workerClass:null,workerParams:void 0};const LP="mapboxgl_preloaded_worker_pool";class ip{constructor(){this.active={}}acquire(n,a=ip.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(Yv.workerClass!=null?new Yv.workerClass:new self.Worker(Yv.workerUrl,Yv.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[LP]}numActive(){return Object.keys(this.active).length}}ip.workerCount=2;class gg{constructor(n,a,h="Worker",f=ip.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Qe();const _=this.workerPool.acquire(this.id,f);for(let y=0;y<_.length;y++){const b=new gg.Actor(_[y],a,this.id);b.name=`${h} ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,h){Ne(this.actors,(f,_)=>{f.send(n,a,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Jv,zP;function _w(){return Jv||(Jv=new ip),Jv}gg.Actor=dN;class tY{constructor(n){this.module=n}createIntArray(n){const a=new Int32Array(n),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,h/a.BYTES_PER_ELEMENT),h}createFloatArray(n){const a=new Float32Array(n),h=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,h/a.BYTES_PER_ELEMENT),h}createStringBuffer(n){const a=this.module.malloc(n.length+1);for(let h=0;h<n.length;++h)this.module.heapU8[a+h]=n.charCodeAt(h);return this.module.heapU8[a+n.length]=0,a}readStringBuffer(n){let a="";for(;this.module.heapU8[n]!==0;)a+=String.fromCharCode(this.module.heapU8[n]),++n;return a}setStyle(n){const a=n.entranceColorRgb,h=n.facadeGlazingColorRgb,f=n.roofColorRgb,_=n.wallColorRgb,y=n.normalScale;this.module.setStyle(a[0],a[1],a[2],h[0],h[1],h[2],f[0],f[1],f[2],_[0],_[1],_[2],y[0],y[1],y[2],n.tileToMeters)}setAOOptions(n,a){this.module.setAOOptions(n?1:0,a)}setMetricOptions(n,a){this.module.setMetricOptions(n?1:0,a)}setFacadeOptions(n,a,h){this.module.setFacadeOptions(n,a,h)}generateMesh(n,a){for(const b of n){const E=this.createStringBuffer(b.roofType),A=[0],M=[];for(const B of b.coordinates)if(Array.isArray(B)){for(const U of B)M.push(U.x),M.push(U.y);A.push(M.length)}const k=this.createIntArray(A),D=this.createFloatArray(M);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,E,b.roofType.length,D,k,A.length-1),this.module.free(E),this.module.free(k),this.module.free(D)}for(const b of a){let E;E=b.entrances?JSON.parse(b.entrances):[];const A=this.createFloatArray(E),M=[];for(const D of b.coordinates)M.push(D.x),M.push(D.y);const k=this.createFloatArray(M);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,A,E.length,k,M.length),this.module.free(A),this.module.free(k)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const h=this.module.getMeshCount(),f=new Array(h);for(let b=0;b<h;b++){const E=this.module.getPositionsPtr(b),A=this.module.getPositionsLength(b),M=new Float32Array(this.module.heapF32.buffer,E,A),k=this.module.getNormalsPtr(b),D=this.module.getNormalsLength(b),B=new Float32Array(this.module.heapF32.buffer,k,D),U=this.module.getColorsPtr(b),K=this.module.getColorsLength(b),te=new Uint8Array(this.module.heapU8.buffer,U,K),oe=this.module.getAOPtr(b),de=this.module.getAOLength(b),fe=new Float32Array(this.module.heapF32.buffer,oe,de),Y=this.module.getIndicesPtr(b),le=this.module.getIndicesLength(b),pe=new Int32Array(this.module.heap32.buffer,Y,le),ye=this.module.getBuildingPart(b),Re=this.readStringBuffer(ye);f[b]={positions:M,normals:B,colors:te,ao:fe,indices:pe,buildingPart:Re}}const _=this.module.getRingCount(),y=[];for(let b=0;b<_;b++){const E=this.module.getRingPtr(b),A=this.module.getRingLength(b),M=new Float32Array(this.module.heapF32.buffer,E,A);y.push(M)}return{meshes:f,modifiedPolygonRings:y}}}let Qv,NP,Bl,_g,jP,yg=null,vg=null,fN=null,FP=null;function pN(){return _n(self)&&self.worker.dracoUrl?self.worker.dracoUrl:NP||wo.DRACO_URL}function mN(){if(_n(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(_g)return _g;const l=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return _g=WebAssembly.validate(l)?wo.MESHOPT_SIMD_URL:wo.MESHOPT_URL,_g}const yw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},rY={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},e0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function gN(l,n,a){const h=a.json.bufferViews.length,f=a.buffers.length;n.bufferView=h,a.json.bufferViews[h]={buffer:f,byteLength:l.byteLength},a.buffers[f]=l}const BP="KHR_draco_mesh_compression";function nY(l,n){const a=l.extensions&&l.extensions[BP];if(!a)return;const h=new Bl.Decoder,f=xN(n,a.bufferView),_=new Bl.Mesh;if(!h.DecodeArrayToMesh(f,f.byteLength,_))throw new Error("Failed to decode Draco mesh");const y=n.json.accessors[l.indices],b=yw[y.componentType],E=y.count*b.BYTES_PER_ELEMENT,A=Bl._malloc(E);b===Uint16Array?h.GetTrianglesUInt16Array(_,E,A):h.GetTrianglesUInt32Array(_,E,A),gN(Bl.memory.buffer.slice(A,A+E),y,n),Bl._free(A);for(const M of Object.keys(a.attributes)){const k=h.GetAttributeByUniqueId(_,a.attributes[M]),D=n.json.accessors[l.attributes[M]],B=rY[D.componentType],U=D.count*e0[D.type]*yw[D.componentType].BYTES_PER_ELEMENT,K=Bl._malloc(U);h.GetAttributeDataArrayForAllPoints(_,k,Bl[B],U,K),gN(Bl.memory.buffer.slice(K,K+U),D,n),Bl._free(K)}h.destroy(),_.destroy(),delete l.extensions[BP]}const vw="EXT_meshopt_compression";function iY(l,n){if(!l.extensions||!l.extensions[vw])return;const a=l.extensions[vw],h=new Uint8Array(n.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),f=new Uint8Array(a.count*a.byteStride);jP.decodeGltfBuffer(f,a.count,a.byteStride,h,a.mode,a.filter),l.buffer=n.buffers.length,l.byteOffset=0,n.buffers[l.buffer]=f.buffer,delete l.extensions[vw]}const _N=1179937895,yN=new TextDecoder("utf8");function vN(l,n){return new URL(l,n).href}function oY(l,n,a,h){return fetch(vN(l.uri,h)).then(f=>f.arrayBuffer()).then(f=>{n.buffers[a]=f})}function xN(l,n){const a=l.json.bufferViews[n];return new Uint8Array(l.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function sY(l,n,a,h){if(l.uri){const f=vN(l.uri,h);return fetch(f).then(_=>_.blob()).then(_=>createImageBitmap(_)).then(_=>{n.images[a]=_})}if(l.bufferView!==void 0){const f=xN(n,l.bufferView),_=new Blob([f],{type:l.mimeType});return createImageBitmap(_).then(y=>{n.images[a]=y})}}function bN(l,n=0,a){const h={json:null,images:[],buffers:[]};if(new Uint32Array(l,n,1)[0]===_N){const M=new Uint32Array(l,n);let k=2;const D=(M[k++]>>2)-3,B=M[k++]>>2;if(k++,h.json=JSON.parse(yN.decode(M.subarray(k,k+B))),k+=B,k<D){const U=M[k++];k++;const K=n+(k<<2);h.buffers[0]=l.slice(K,K+U)}}else h.json=JSON.parse(yN.decode(new Uint8Array(l,n)));const{buffers:f,images:_,meshes:y,extensionsUsed:b,bufferViews:E}=h.json;let A=Promise.resolve();if(f){const M=[];for(let k=0;k<f.length;k++){const D=f[k];D.uri?M.push(oY(D,h,k,a)):h.buffers[k]||(h.buffers[k]=null)}A=Promise.all(M)}return A.then(()=>{const M=[],k=b&&b.includes(BP),D=b&&b.includes(vw);if(k&&M.push(function(){if(!Bl)return Qv??(Qv=function(B){let U,K=null;function te(){U=new Uint8Array(K.buffer)}function oe(){throw new Error("Unexpected Draco error.")}const de={a:{a:oe,d:function(fe,Y,le){return U.copyWithin(fe,Y,Y+le)},c:function(fe){const Y=U.length,le=Math.max(fe>>>0,Math.ceil(1.2*Y)),pe=Math.ceil((le-Y)/65536);try{return K.grow(pe),te(),!0}catch{return!1}},b:oe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,de):B.then(fe=>fe.arrayBuffer()).then(fe=>WebAssembly.instantiate(fe,de))).then(fe=>{const{Rb:Y,Qb:le,P:pe,T:ye,X:Re,Ja:Ie,La:ke,Qa:je,Va:rt,Wa:xt,eb:ft,jb:vt,f:wt,e:it,yb:_t,zb:et,Ab:nt,Bb:Pt,Db:It,Gb:sr}=fe.instance.exports;K=it;const Kt=(()=>{let Ft=0,Et=0,Tr=0,Xt=0;return Jt=>{Tr&&(Y(Xt),Y(Ft),Et+=Tr,Tr=Ft=0),Ft||(Et+=128,Ft=le(Et));const mr=Jt.length+7&-8;let Or=Ft;mr>=Et&&(Tr=mr,Or=Xt=le(mr));for(let Ir=0;Ir<Jt.length;Ir++)U[Or+Ir]=Jt[Ir];return Or}})();return te(),wt(),{memory:it,_free:Y,_malloc:le,Mesh:class{constructor(){this.ptr=pe()}destroy(){ye(this.ptr)}},Decoder:class{constructor(){this.ptr=Ie()}destroy(){vt(this.ptr)}DecodeArrayToMesh(Ft,Et,Tr){const Xt=Kt(Ft),Jt=ke(this.ptr,Xt,Et,Tr.ptr);return!!Re(Jt)}GetAttributeByUniqueId(Ft,Et){return{ptr:je(this.ptr,Ft.ptr,Et)}}GetTrianglesUInt16Array(Ft,Et,Tr){rt(this.ptr,Ft.ptr,Et,Tr)}GetTrianglesUInt32Array(Ft,Et,Tr){xt(this.ptr,Ft.ptr,Et,Tr)}GetAttributeDataArrayForAllPoints(Ft,Et,Tr,Xt,Jt){ft(this.ptr,Ft.ptr,Et.ptr,Tr,Xt,Jt)}},DT_INT8:_t(),DT_UINT8:et(),DT_INT16:nt(),DT_UINT16:Pt(),DT_UINT32:It(),DT_FLOAT32:sr()}})}(fetch(pN())),Qv.then(B=>{Bl=B,Qv=void 0}))}()),D&&M.push(function(){if(jP)return;const B=function(U){let K;const te=WebAssembly.instantiateStreaming(U,{}).then(fe=>{K=fe.instance,K.exports.__wasm_call_ctors()}),oe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},de={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:te,supported:!0,decodeGltfBuffer(fe,Y,le,pe,ye,Re){(function(Ie,ke,je,rt,xt,ft,vt){const wt=Ie.exports.sbrk,it=rt+3&-4,_t=wt(it*xt),et=wt(ft.length),nt=new Uint8Array(Ie.exports.memory.buffer);nt.set(ft,et);const Pt=ke(_t,rt,xt,et,ft.length);if(Pt===0&&vt&&vt(_t,it,xt),je.set(nt.subarray(_t,_t+rt*xt)),wt(_t-wt(0)),Pt!==0)throw new Error(`Malformed buffer data: ${Pt}`)})(K,K.exports[de[ye]],fe,Y,le,pe,K.exports[oe[Re]])}}}(fetch(mN()));return B.ready.then(()=>{jP=B})}()),_)for(let B=0;B<_.length;B++)M.push(sY(_[B],h,B,a));return(M.length?Promise.all(M):Promise.resolve()).then(()=>{if(k&&y)for(const{primitives:B}of y)for(const U of B)nY(U,h);if(D&&y&&E)for(const B of E)iY(B,h);return h})})}class wN{constructor(n){this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.hasPattern=!1,this.worldview=n.worldview}updateFootprints(n,a){}prepare(){return function(){if(FP!=null||fN!=null)return null;if(vg!=null)return vg;const n=fetch(wo.BUILDING_GEN_URL);return vg=function(a){let h,f,_,y;function b(){h=new Uint8Array(y.buffer),f=new Int32Array(y.buffer),_=new Float32Array(y.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}const A=()=>{},M={a:{a:E,f:function(k){const D=h.length,B=Math.max(k>>>0,Math.ceil(1.2*D)),U=Math.ceil((B-D)/65536);try{return y.grow(U),b(),!0}catch{return!1}},g:E,b:A,c:A,d:A,e:A}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,M):a.then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,M))).then(k=>{const D=k.instance.exports;return(0,D.g)(),y=D.f,b(),new tY({setStyle:D.h,setAOOptions:D.i,setMetricOptions:D.j,setFacadeOptions:D.k,addFeature:D.l,addFacade:D.m,generateMesh:D.n,getLastError:D.o,getMeshCount:D.p,getPositionsPtr:D.q,getPositionsLength:D.r,getNormalsPtr:D.s,getNormalsLength:D.t,getColorsPtr:D.u,getColorsLength:D.v,getAOPtr:D.w,getAOLength:D.x,getIndicesPtr:D.y,getIndicesLength:D.z,getBuildingPart:D.A,getRingCount:D.B,getRingPtr:D.C,getRingLength:D.D,free:D.E,malloc:D.F,heapU8:h,heap32:f,heapF32:_})})}(n).then(a=>(vg=null,FP=a,FP)).catch(a=>{Rr("Could not load building-gen"),vg=null,fN=a}),vg}()}populate(n,a,h,f){}update(n,a,h,f,_,y,b){}isEmpty(){return!1}uploadPending(){return!1}upload(n){}destroy(){}getHeightAtTileCoord(n,a){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let SN,TN;Ht(wN,"BuildingBucket",{omit:["layers"]});const aY=rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),lY=rn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:cY}=aY,uY=rn([{name:"a_packed",components:3,type:"Float32"}]),{members:hY}=uY,dY=rn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:fY}=dY;class EN{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.image=new Hh({width:n,height:a}),this.positions={},this.uploaded=!1}getDash(n,a){const h=this.getKey(n,a);return this.positions[h]}trim(){const n=this.width,a=this.height=kt(this.nextRow);this.image.resize({width:n,height:a})}getKey(n,a){return n.join(",")+a}getDashRanges(n,a,h){const f=[];let _=n.length%2==1?-n[n.length-1]*h:0,y=n[0]*h,b=!0;f.push({left:_,right:y,isDash:b,zeroLength:n[0]===0});let E=n[0];for(let A=1;A<n.length;A++){b=!b;const M=n[A];_=E*h,E+=M,y=E*h,f.push({left:_,right:y,isDash:b,zeroLength:M===0})}return f}addRoundDash(n,a,h){const f=a/2;for(let _=-h;_<=h;_++){const y=this.width*(this.nextRow+h+_);let b=0,E=n[b];for(let A=0;A<this.width;A++){A/E.right>1&&(E=n[++b]);const M=Math.abs(A-E.left),k=Math.abs(A-E.right),D=Math.min(M,k);let B;const U=_/h*(f+1);if(E.isDash){const K=f-Math.abs(U);B=Math.sqrt(D*D+K*K)}else B=f-Math.sqrt(D*D+U*U);this.image.data[y+A]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(n,a){for(let E=n.length-1;E>=0;--E){const A=n[E],M=n[E+1];A.zeroLength?n.splice(E,1):M&&M.isDash===A.isDash&&(M.left=A.left,n.splice(E,1))}const h=n[0],f=n[n.length-1];h.isDash===f.isDash&&(h.left=f.left-this.width,f.right=h.right+this.width);const _=this.width*this.nextRow;let y=0,b=n[y];for(let E=0;E<this.width;E++){E/b.right>1&&(b=n[++y]);const A=Math.abs(E-b.left),M=Math.abs(E-b.right),k=Math.min(A,M);this.image.data[_+E]=Math.max(0,Math.min(255,(b.isDash?k:-k)+a+128))}}addDash(n,a){const h=this.getKey(n,a);if(this.positions[h])return this.positions[h];const f=a==="round",_=f?7:0,y=2*_+1;if(this.nextRow+y>this.height)return Rr("LineAtlas out of space"),null;n.length===0&&n.push(1);let b=0;for(let M=0;M<n.length;M++)n[M]<0&&(Rr("Negative value is found in line dasharray, replacing values with 0"),n[M]=0),b+=n[M];if(b!==0){const M=this.width/b,k=this.getDashRanges(n,this.width,M);f?this.addRoundDash(k,M,_):this.addRegularDash(k,a==="square"?.5*M:0)}const E=this.nextRow+_;this.nextRow+=y;const A={tl:[E,_],br:[b,0]};return this.positions[h]=A,A}}Ht(EN,"LineAtlas");const pY=zr.VectorTileFeature.types,mY=Math.cos(Math.PI/180*37.5),gY=Math.cos(Math.PI/180*5);class $P{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.pixelRatio=n.pixelRatio,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Ev,this.layoutVertexArray2=new Qa,this.patternVertexArray=new Qa,this.indexArray=new To,this.programConfigurations=new p(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new mi,this.maxLineLength=0,this.zOffsetVertexArray=new Qa,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:Nt/64,this.worldview=n.worldview}updateFootprints(n,a){}populate(n,a,h,f){this.hasPattern=TP("line",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=tt(h);const y=this.layers[0].layout.get("line-elevation-reference");if(y==="hd-road-markup")this.elevationType="road";else{const D=this.layers[0].layout.get("line-z-offset"),B=D.isConstant()&&!D.constantOr(0);this.elevationType=y!=="sea"&&y!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&y==="none"&&Rr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const E=[];for(const{feature:D,id:B,index:U,sourceLayerIndex:K}of n){const te=this.layers[0]._featureFilter.needGeometry,oe=Vt(D,te);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),oe,h))continue;const de=_?_.evaluate(oe,{},h):void 0,fe={id:B,properties:D.properties,type:D.type,sourceLayerIndex:K,index:U,geometry:te?oe.geometry:qt(D,h,f),patterns:{},sortKey:de};E.push(fe)}_&&E.sort((D,B)=>D.sortKey-B.sortKey);const{lineAtlas:A,featureIndex:M}=a,k=this.addConstantDashes(A);for(const D of E){const{geometry:B,index:U,sourceLayerIndex:K}=D;if(k&&this.addFeatureDashes(D,A),this.hasPattern){const te=EP("line",this.layers,D,this.zoom,this.pixelRatio,a);this.patternFeatures.push(te)}else this.addFeature(D,B,U,h,A.positions,a.availableImages,a.brightness,a.elevationFeatures);M.insert(n[U].feature,B,U,K,this.index)}}addConstantDashes(n){let a=!1;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(f.kind!=="constant"||_.kind!=="constant")a=!0;else{const y=_.value,b=f.value;if(!b)continue;n.addDash(b,y)}}return a}addFeatureDashes(n,a){const h=this.zoom;for(const f of this.layers){const _=f.paint.get("line-dasharray").value,y=f.layout.get("line-cap").value;if(_.kind==="constant"&&y.kind==="constant")continue;let b,E;if(_.kind==="constant"){if(b=_.value,!b)continue}else b=_.evaluate({zoom:h},n);E=y.kind==="constant"?y.value:y.evaluate({zoom:h},n),a.addDash(b,E),n.patterns[f.id]=[a.getKey(b,E)]}}update(n,a,h,f,_,y,b,E){this.programConfigurations.updatePaintArrays(n,a,_,h,f,y,b,E)}addFeatures(n,a,h,f,_,y){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,a,h,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,hY)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,fY)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,lY.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,cY),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,h,f,_,y,b,E){const A=this.layers[0].layout,M=A.get("line-join").evaluate(n,{}),k=A.get("line-cap").evaluate(n,{}),D=A.get("line-miter-limit"),B=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n,this.zOffsetValue=A.get("line-z-offset").value;const U=this.layers[0].paint.get("line-width").value;if(U.kind!=="constant"&&U.isLineProgressConstant===!1&&(this.variableWidthValue=U),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(n,a,f,E,M,k,D,B)){const[te,oe]=this.clipRuntimeLinesToTile(a,1);for(let de=0;de<te.length;de++){const fe=te[de],Y=oe[de],le={progress:{min:Y.progress.min,max:Y.progress.max},nextDir:this.computeSegNextDir(Y,fe),prevDir:this.computeSegPrevDir(Y,fe)};this.addLine(fe,n,f,M,k,D,B,le)}this.fillNonElevatedRoadSegment(K)}}else for(const K of a)this.addLine(K,n,f,M,k,D,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,_,y,f,b,void 0,this.worldview)}computeSegNextDir(n,a){return n.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(n,a){return a[1].sub(n.prevPoint).unit()}clipLinesToTile(n,a){return gw(n,-a,-a,Nt+a,Nt+a)}clipRuntimeLinesToTile(n,a){const h=[];return[gw(n,-a,-a,Nt+a,Nt+a,h),h]}addElevatedRoadFeature(n,a,h,f,_,y,b,E){const A=[],M=Gs.getElevationFeature(n,f);if(M){const k=this.clipLinesToTile(a,1),D=this.prepareElevatedLines(k,M,h);for(const B of D)A.push({geometry:B,elevation:M,elevationTileID:h,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(A.length===0)return!1;for(const k of A){const D=this.layoutVertexArray.length;this.addLine(k.geometry,n,h,_,y,b,E);const B=new Ia(h,k.elevationTileID);if(k.elevation)for(let U=D;U<this.layoutVertexArray.length;U++){const K=new Dt(this.layoutVertexArray.int16[6*U]>>1,this.layoutVertexArray.int16[6*U+1]>>1),te=B.pointElevation(K,k.elevation,.05);this.updateHeightRange(te),this.zOffsetVertexArray.emplaceBack(te,0,0)}else this.fillNonElevatedRoadSegment(D)}return!0}prepareElevatedLines(n,a,h){if(a.constantHeight!=null)return n;const f=[],_=1/tt(h);for(const y of n)JK(y,new Ts(a,_),0,f);return f}fillNonElevatedRoadSegment(n){for(let a=n;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(n){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,n),this.heightRange.max=Math.max(this.heightRange.max,n)):this.heightRange={min:n,max:n}}addLine(n,a,h,f,_,y,b,E){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const A=f==="none";this.patternJoinNone=this.hasPattern&&A,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const M=E&&E.progress.min>0,k=E&&E.progress.max<1;if(this.lineClips){let Re={min:this.lineClips.start,max:this.lineClips.end},Ie=1;if(E){const rt=this.lineClips.end-this.lineClips.start;Re=function(xt,ft,vt){return{min:of(xt.min,ft,vt),max:of(xt.max,ft,vt)}}(E.progress,{min:0,max:1},Re),rt>0&&(Ie=(Re.max-Re.min)/rt)}const ke=+a.properties.mapbox_clip_feature_len,je=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(ke)||Number.isNaN(je)){for(let xt=0;xt<n.length-1;xt++)this.totalDistance+=n[xt].dist(n[xt+1]);const rt=this.totalDistance/(Re.max-Re.min);this.totalFeatureLength=Number.isFinite(rt)?rt:0,this.lineClips.start=Re.min,this.lineClips.end=Re.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=ke,this.distance=je*Ie,this.lineClips.start=Re.min,this.lineClips.end=Re.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const D=pY[a.type]==="Polygon";let B=n.length;for(;B>=2&&n[B-1].equals(n[B-2]);)B--;let U=0;for(;U<B-1&&n[U].equals(n[U+1]);)U++;if(B<(D?3:2))return;f==="bevel"&&(y=1.05);const K=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let te,oe,de,fe,Y,le,pe,ye;E&&E.prevDir&&(le=E.prevDir.perp()),E&&E.nextDir&&(pe=E.nextDir.perp()),this.e1=this.e2=-1,D&&(te=n[B-2],Y=n[U].sub(te)._unit()._perp());for(let Re=U;Re<B;Re++){if(de=Re===B-1?D?n[U+1]:void 0:n[Re+1],de&&n[Re].equals(de))continue;Y&&(fe=Y),te&&(oe=te),te=n[Re],ye=this.evaluateLineProgressFeatures(oe?oe.dist(te):0),Y=de?de.sub(te)._unit()._perp():fe,fe=fe||Y;const Ie=oe&&de;let ke=Ie?f:D||A?"butt":_;const je=fe.x*Y.x+fe.y*Y.y;if(A){const et=function(nt){if(nt.patternJoinNone){const Pt=nt.segmentPoints.length/2,It=nt.lineSoFar-nt.segmentStart;for(let sr=0;sr<Pt;++sr){const Kt=nt.segmentPoints[2*sr+1],Ft=Math.round(nt.segmentPoints[2*sr])+.5+.25*Kt;nt.patternVertexArray.emplaceBack(Ft,It,nt.segmentStart),nt.patternVertexArray.emplaceBack(Ft,It,nt.segmentStart)}nt.segmentPoints.length=0}nt.e1=nt.e2=-1};if(Ie&&je<gY){this.updateDistance(oe,te),this.addCurrentVertex(te,fe,1,1,K,ye),et(this),this.addCurrentVertex(te,Y,-1,-1,K,ye);continue}if(oe){if(!de){this.updateDistance(oe,te),this.addCurrentVertex(te,fe,1,1,K,ye),et(this);continue}ke="miter"}}let rt=fe.add(Y);rt.x===0&&rt.y===0||rt._unit();const xt=rt.x*Y.x+rt.y*Y.y,ft=xt!==0?1/xt:1/0,vt=2*Math.sqrt(2-2*xt),wt=xt<mY&&oe&&de,it=fe.x*Y.y-fe.y*Y.x>0,_t=this.overscaling<=16?15*Nt/(512*this.overscaling):0;if(Ie&&ke==="round"){if(ft<b)ke="miter";else if(ft<=2){const et=UP(te,-10,Nt+10);ke=this.elevationType==="offset"&&(et||this.hasCrossSlope)?"miter":"fakeround"}}if(ke==="miter"&&ft>y&&(ke="bevel"),ke==="bevel"&&(ft>2&&(ke="flipbevel"),ft<y&&(ke="miter")),oe&&!(ke==="miter"&&wt)&&this.updateDistance(oe,te),ke==="miter")if(wt){const et=te.dist(oe);if(et>2*_t){const Pt=te.sub(te.sub(oe)._mult(_t/et)._round());this.updateDistance(oe,Pt),this.addCurrentVertex(Pt,fe,0,0,K,ye),oe=Pt}this.updateDistance(oe,te),rt._mult(ft),this.addCurrentVertex(te,rt,0,0,K,ye);const nt=te.dist(de);if(nt>2*_t){const Pt=te.add(de.sub(te)._mult(_t/nt)._round());this.updateDistance(te,Pt),this.addCurrentVertex(Pt,Y,0,0,K,ye),te=Pt}}else rt._mult(ft),this.addCurrentVertex(te,rt,0,0,K,ye);else if(ke==="flipbevel"){if(ft>100)rt=Y.mult(-1);else{const et=ft*fe.add(Y).mag()/fe.sub(Y).mag();rt._perp()._mult(et*(it?-1:1))}this.addCurrentVertex(te,rt,0,0,K,ye),this.addCurrentVertex(te,rt.mult(-1),0,0,K,ye)}else if(ke==="bevel"||ke==="fakeround"){ye!=null&&oe&&this.addCurrentVertex(te,pe||fe,-1,-1,K,ye);const et=te.dist(oe)<=2*_t&&ke!=="bevel",nt=rt.mult(it?1:-1);nt._mult(ft);const Pt=Y.mult(it?-1:1),It=fe.mult(it?-1:1),sr=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex(te,nt.x,nt.y,!1,!it,0,K,sr),et||this.addHalfVertex(te,nt.x+2*It.x,nt.y+2*It.y,!1,it,0,K,sr)),ke==="fakeround"){const Kt=Math.round(180*vt/Math.PI/20);this.addHalfVertex(te,It.x,It.y,!1,it,0,K,sr);for(let Ft=0;Ft<Kt;Ft++){let Et=Ft/Kt;if(Et!==.5){const Xt=Et-.5;Et+=Et*Xt*(Et-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*Xt*Xt+(.848013+je*(.215638*je-1.06021)))}const Tr=Pt.sub(It)._mult(Et)._add(It)._unit();this.addHalfVertex(te,Tr.x,Tr.y,!1,it,0,K,sr)}this.addHalfVertex(te,Pt.x,Pt.y,!1,it,0,K,sr)}et||ye!=null||this.addHalfVertex(te,nt.x+2*Pt.x,nt.y+2*Pt.y,!1,it,0,K,sr),ye!=null&&de&&this.addCurrentVertex(te,le||Y,1,1,K,ye)}else if(ke==="butt")this.addCurrentVertex(te,rt,0,0,K,ye);else if(ke==="square"){if(!oe){const et=M?0:-1;this.addCurrentVertex(te,rt,et,et,K,ye)}if(this.addCurrentVertex(te,rt,0,0,K,ye),oe){const et=k?0:1;this.addCurrentVertex(te,rt,et,et,K,ye)}}else if(ke==="round"){if(oe){const et=!Ie&&pe?pe:fe;this.addCurrentVertex(te,et,0,0,K,ye),!Ie&&k||this.addCurrentVertex(te,et,1,1,K,ye,!0)}if(de){const et=!Ie&&le?le:Y;!Ie&&M||this.addCurrentVertex(te,et,-1,-1,K,ye,!0),this.addCurrentVertex(te,et,0,0,K,ye)}}}}addVerticesTo(n,a,h,f,_,y,b,E,A,M){const k=(a.w-n.w)/this.tessellationStep|0;let D=0;const B=this.scaledDistance;if(k>1){this.lineSoFar=n.w;const K=(a.x-n.x)/k,te=(a.y-n.y)/k,oe=(a.z-n.z)/k,de=(a.w-n.w)/k;for(let fe=1;fe<k;++fe){n.x+=K,n.y+=te,n.z+=oe,this.lineSoFar+=de,D+=de;const Y=this.evaluateLineProgressFeatures(this.prevDistance+D);this.scaledDistance=(this.prevDistance+D)/this.totalDistance,this.addHalfVertex(n,h,f,M,!1,b,A,Y),this.addHalfVertex(n,_,y,M,!0,-E,A,Y)}}this.lineSoFar=a.w,this.scaledDistance=B;const U=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,h,f,M,!1,b,A,U),this.addHalfVertex(a,_,y,M,!0,-E,A,U)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):Rr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(n,a,h,f,_,y,b=!1){const E=a.x+a.y*h,A=a.y-a.x*h,M=a.y*f-a.x,k=-a.y-a.x*f;if(y!=null){const D=this.elevationType==="offset",B=-10,U=Nt+10,K=y.zOffset,te=new sN(n.x,n.y,K,this.lineSoFar),oe=!!D&&UP(n,B,U),de=this.lineSoFar,fe=this.distance;if(this.currentVertex)if(oe){const Y=this.currentVertexIsOutside,le=this.currentVertex,pe=new sN(n.x,n.y,K,this.lineSoFar);if(lN(le,pe,B,U),!UP(pe,B,U)){if(Y){this.e1=this.e2=-1,this.distance-=le.dist(te),this.lineSoFar=le.w;const ye=this.evaluateLineProgressFeatures(le.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(le,E,A,b,!1,h,_,ye),this.addHalfVertex(le,M,k,b,!0,-f,_,ye),this.prevDistance=this.distance}this.distance=this.prevDistance+le.dist(pe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(le,pe,E,A,M,k,h,f,_,b),this.distance=fe,this.scaledDistance=this.distance/this.totalDistance}}else{const Y=this.currentVertex;if(this.currentVertexIsOutside){lN(Y,te,B,U),this.e1=this.e2=-1,this.distance-=Y.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Y.w;const le=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,E,A,b,!1,h,_,le),this.addHalfVertex(Y,M,k,b,!0,-f,_,le),this.prevDistance=this.distance,this.distance=fe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Y,te,E,A,M,k,h,f,_,b)}else oe||(this.addHalfVertex(n,E,A,b,!1,h,_,y),this.addHalfVertex(n,M,k,b,!0,-f,_,y));this.currentVertex=te,this.currentVertexIsOutside=oe,this.lineSoFar=de}else this.addHalfVertex(n,E,A,b,!1,h,_,y),this.addHalfVertex(n,M,k,b,!0,-f,_,y)}addHalfVertex({x:n,y:a},h,f,_,y,b,E,A){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),y||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((n<<1)+(_?1:0),(a<<1)+(y?1:0),Math.round(63*h)+128,Math.round(63*f)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const k=pr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,k)}const M=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),E.primitiveLength++),y?this.e2=M:this.e1=M,A!=null&&this.zOffsetVertexArray.emplaceBack(A.zOffset,A.variableWidth,A.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,a){this.prevDistance=this.distance,this.distance+=n.dist(a),this.updateScaledDistance()}}function UP(l,n,a){return l.x<n||l.x>a||l.y<n||l.y>a}let AN,PN;function CN(l,n,a){return n*(Nt/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}Ht($P,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const IN=(l,n,a)=>(1-a)*l+a*n;function ON(l,n){return 1/CN(l,1,n.tileZoom)}function MN(l,n,a,h){return l.translatePosMatrix(h||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const RN=l=>{const n=[];kN(l)&&n.push("RENDER_LINE_DASH"),l.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const a=l.paint.get("line-trim-offset");a[0]===0&&a[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),l.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const h=l.layout.get("line-join").constantOr("miter")==="none",f=!!l.paint.get("line-pattern").constantOr(1);return h&&f&&n.push("LINE_JOIN_NONE"),n};function kN(l){const n=l.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let VP;const DN=()=>VP||(VP={layout:AN||(AN=new di({"line-cap":new $t(Be.layout_line["line-cap"]),"line-join":new $t(Be.layout_line["line-join"]),"line-miter-limit":new Tt(Be.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Be.layout_line["line-round-limit"]),"line-sort-key":new $t(Be.layout_line["line-sort-key"]),"line-z-offset":new $t(Be.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(Be.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(Be.layout_line["line-cross-slope"]),visibility:new Tt(Be.layout_line.visibility),"line-width-unit":new Tt(Be.layout_line["line-width-unit"])})),paint:PN||(PN=new di({"line-opacity":new $t(Be.paint_line["line-opacity"]),"line-color":new $t(Be.paint_line["line-color"]),"line-translate":new Tt(Be.paint_line["line-translate"]),"line-translate-anchor":new Tt(Be.paint_line["line-translate-anchor"]),"line-width":new $t(Be.paint_line["line-width"]),"line-gap-width":new $t(Be.paint_line["line-gap-width"]),"line-offset":new $t(Be.paint_line["line-offset"]),"line-blur":new $t(Be.paint_line["line-blur"]),"line-dasharray":new $t(Be.paint_line["line-dasharray"]),"line-pattern":new $t(Be.paint_line["line-pattern"]),"line-pattern-cross-fade":new Tt(Be.paint_line["line-pattern-cross-fade"]),"line-gradient":new Tu(Be.paint_line["line-gradient"]),"line-trim-offset":new Tt(Be.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(Be.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(Be.paint_line["line-trim-color"]),"line-emissive-strength":new Tt(Be.paint_line["line-emissive-strength"]),"line-border-width":new $t(Be.paint_line["line-border-width"]),"line-border-color":new $t(Be.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(Be.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},VP);class _Y extends $t{possiblyEvaluate(n,a){return a=new Tn(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(n,a)}evaluate(n,a,h,f){return a=Xe({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,h,f)}}let t0;function LN(l,n){return n>0?n+2*l:l}const yY=rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vY=rn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),xY=rn([{name:"a_projected_pos",components:4,type:"Float32"}],4);rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bY=rn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),wY=rn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),SY=rn([{name:"a_texb",components:2,type:"Uint16"}]),TY=rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),EY=rn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zN=rn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),AY=rn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);rn([{name:"triangle",components:3,type:"Uint16"}]),rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),rn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),rn([{type:"Float32",name:"offsetX"}]),rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var go=24;function PY(l,n,a){return l.sections.forEach(h=>{h.text=function(f,_,y){const b=_.layout.get("text-transform").evaluate(y,{});return b==="uppercase"?f=f.toLocaleUpperCase():b==="lowercase"&&(f=f.toLocaleLowerCase()),zl.applyArabicShaping&&(f=zl.applyArabicShaping(f)),f}(h.text,n,a)}),l}const r0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function CY(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}function IY(l){return l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""||l===""}var NN,GP,jN,HP={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function OY(){return NN||(NN=1,HP.read=function(l,n,a,h,f){var _,y,b=8*f-h-1,E=(1<<b)-1,A=E>>1,M=-7,k=a?f-1:0,D=a?-1:1,B=l[n+k];for(k+=D,_=B&(1<<-M)-1,B>>=-M,M+=b;M>0;_=256*_+l[n+k],k+=D,M-=8);for(y=_&(1<<-M)-1,_>>=-M,M+=h;M>0;y=256*y+l[n+k],k+=D,M-=8);if(_===0)_=1-A;else{if(_===E)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,h),_-=A}return(B?-1:1)*y*Math.pow(2,_-h)},HP.write=function(l,n,a,h,f,_){var y,b,E,A=8*_-f-1,M=(1<<A)-1,k=M>>1,D=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=h?0:_-1,U=h?1:-1,K=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(b=isNaN(n)?1:0,y=M):(y=Math.floor(Math.log(n)/Math.LN2),n*(E=Math.pow(2,-y))<1&&(y--,E*=2),(n+=y+k>=1?D/E:D*Math.pow(2,1-k))*E>=2&&(y++,E/=2),y+k>=M?(b=0,y=M):y+k>=1?(b=(n*E-1)*Math.pow(2,f),y+=k):(b=n*Math.pow(2,k-1)*Math.pow(2,f),y=0));f>=8;l[a+B]=255&b,B+=U,b/=256,f-=8);for(y=y<<f|b,A+=f;A>0;l[a+B]=255&y,B+=U,y/=256,A-=8);l[a+B-U]|=128*K}),HP}function FN(){if(jN)return GP;jN=1,GP=n;var l=OY();function n(Y){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Y)?Y:new Uint8Array(Y||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var a=4294967296,h=1/a,f=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function _(Y){return Y.type===n.Bytes?Y.readVarint()+Y.pos:Y.pos+1}function y(Y,le,pe){return pe?4294967296*le+(Y>>>0):4294967296*(le>>>0)+(Y>>>0)}function b(Y,le,pe){var ye=le<=16383?1:le<=2097151?2:le<=268435455?3:Math.floor(Math.log(le)/(7*Math.LN2));pe.realloc(ye);for(var Re=pe.pos-1;Re>=Y;Re--)pe.buf[Re+ye]=pe.buf[Re]}function E(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeVarint(Y[pe])}function A(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeSVarint(Y[pe])}function M(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeFloat(Y[pe])}function k(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeDouble(Y[pe])}function D(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeBoolean(Y[pe])}function B(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeFixed32(Y[pe])}function U(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeSFixed32(Y[pe])}function K(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeFixed64(Y[pe])}function te(Y,le){for(var pe=0;pe<Y.length;pe++)le.writeSFixed64(Y[pe])}function oe(Y,le){return(Y[le]|Y[le+1]<<8|Y[le+2]<<16)+16777216*Y[le+3]}function de(Y,le,pe){Y[pe]=le,Y[pe+1]=le>>>8,Y[pe+2]=le>>>16,Y[pe+3]=le>>>24}function fe(Y,le){return(Y[le]|Y[le+1]<<8|Y[le+2]<<16)+(Y[le+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(Y,le,pe){for(pe=pe||this.length;this.pos<pe;){var ye=this.readVarint(),Re=ye>>3,Ie=this.pos;this.type=7&ye,Y(Re,le,this),this.pos===Ie&&this.skip(ye)}return le},readMessage:function(Y,le){return this.readFields(Y,le,this.readVarint()+this.pos)},readFixed32:function(){var Y=oe(this.buf,this.pos);return this.pos+=4,Y},readSFixed32:function(){var Y=fe(this.buf,this.pos);return this.pos+=4,Y},readFixed64:function(){var Y=oe(this.buf,this.pos)+oe(this.buf,this.pos+4)*a;return this.pos+=8,Y},readSFixed64:function(){var Y=oe(this.buf,this.pos)+fe(this.buf,this.pos+4)*a;return this.pos+=8,Y},readFloat:function(){var Y=l.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Y},readDouble:function(){var Y=l.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Y},readVarint:function(Y){var le,pe,ye=this.buf;return le=127&(pe=ye[this.pos++]),pe<128?le:(le|=(127&(pe=ye[this.pos++]))<<7,pe<128?le:(le|=(127&(pe=ye[this.pos++]))<<14,pe<128?le:(le|=(127&(pe=ye[this.pos++]))<<21,pe<128?le:function(Re,Ie,ke){var je,rt,xt=ke.buf;if(je=(112&(rt=xt[ke.pos++]))>>4,rt<128||(je|=(127&(rt=xt[ke.pos++]))<<3,rt<128)||(je|=(127&(rt=xt[ke.pos++]))<<10,rt<128)||(je|=(127&(rt=xt[ke.pos++]))<<17,rt<128)||(je|=(127&(rt=xt[ke.pos++]))<<24,rt<128)||(je|=(1&(rt=xt[ke.pos++]))<<31,rt<128))return y(Re,je,Ie);throw new Error("Expected varint not more than 10 bytes")}(le|=(15&(pe=ye[this.pos]))<<28,Y,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Y=this.readVarint();return Y%2==1?(Y+1)/-2:Y/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Y=this.readVarint()+this.pos,le=this.pos;return this.pos=Y,Y-le>=12&&f?function(pe,ye,Re){return f.decode(pe.subarray(ye,Re))}(this.buf,le,Y):function(pe,ye,Re){for(var Ie="",ke=ye;ke<Re;){var je,rt,xt,ft=pe[ke],vt=null,wt=ft>239?4:ft>223?3:ft>191?2:1;if(ke+wt>Re)break;wt===1?ft<128&&(vt=ft):wt===2?(192&(je=pe[ke+1]))==128&&(vt=(31&ft)<<6|63&je)<=127&&(vt=null):wt===3?(rt=pe[ke+2],(192&(je=pe[ke+1]))==128&&(192&rt)==128&&((vt=(15&ft)<<12|(63&je)<<6|63&rt)<=2047||vt>=55296&&vt<=57343)&&(vt=null)):wt===4&&(rt=pe[ke+2],xt=pe[ke+3],(192&(je=pe[ke+1]))==128&&(192&rt)==128&&(192&xt)==128&&((vt=(15&ft)<<18|(63&je)<<12|(63&rt)<<6|63&xt)<=65535||vt>=1114112)&&(vt=null)),vt===null?(vt=65533,wt=1):vt>65535&&(vt-=65536,Ie+=String.fromCharCode(vt>>>10&1023|55296),vt=56320|1023&vt),Ie+=String.fromCharCode(vt),ke+=wt}return Ie}(this.buf,le,Y)},readBytes:function(){var Y=this.readVarint()+this.pos,le=this.buf.subarray(this.pos,Y);return this.pos=Y,le},readPackedVarint:function(Y,le){if(this.type!==n.Bytes)return Y.push(this.readVarint(le));var pe=_(this);for(Y=Y||[];this.pos<pe;)Y.push(this.readVarint(le));return Y},readPackedSVarint:function(Y){if(this.type!==n.Bytes)return Y.push(this.readSVarint());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readSVarint());return Y},readPackedBoolean:function(Y){if(this.type!==n.Bytes)return Y.push(this.readBoolean());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readBoolean());return Y},readPackedFloat:function(Y){if(this.type!==n.Bytes)return Y.push(this.readFloat());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readFloat());return Y},readPackedDouble:function(Y){if(this.type!==n.Bytes)return Y.push(this.readDouble());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readDouble());return Y},readPackedFixed32:function(Y){if(this.type!==n.Bytes)return Y.push(this.readFixed32());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readFixed32());return Y},readPackedSFixed32:function(Y){if(this.type!==n.Bytes)return Y.push(this.readSFixed32());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readSFixed32());return Y},readPackedFixed64:function(Y){if(this.type!==n.Bytes)return Y.push(this.readFixed64());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readFixed64());return Y},readPackedSFixed64:function(Y){if(this.type!==n.Bytes)return Y.push(this.readSFixed64());var le=_(this);for(Y=Y||[];this.pos<le;)Y.push(this.readSFixed64());return Y},skip:function(Y){var le=7&Y;if(le===n.Varint)for(;this.buf[this.pos++]>127;);else if(le===n.Bytes)this.pos=this.readVarint()+this.pos;else if(le===n.Fixed32)this.pos+=4;else{if(le!==n.Fixed64)throw new Error("Unimplemented type: "+le);this.pos+=8}},writeTag:function(Y,le){this.writeVarint(Y<<3|le)},realloc:function(Y){for(var le=this.length||16;le<this.pos+Y;)le*=2;if(le!==this.length){var pe=new Uint8Array(le);pe.set(this.buf),this.buf=pe,this.length=le}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Y){this.realloc(4),de(this.buf,Y,this.pos),this.pos+=4},writeSFixed32:function(Y){this.realloc(4),de(this.buf,Y,this.pos),this.pos+=4},writeFixed64:function(Y){this.realloc(8),de(this.buf,-1&Y,this.pos),de(this.buf,Math.floor(Y*h),this.pos+4),this.pos+=8},writeSFixed64:function(Y){this.realloc(8),de(this.buf,-1&Y,this.pos),de(this.buf,Math.floor(Y*h),this.pos+4),this.pos+=8},writeVarint:function(Y){(Y=+Y||0)>268435455||Y<0?function(le,pe){var ye,Re;if(le>=0?(ye=le%4294967296|0,Re=le/4294967296|0):(Re=~(-le/4294967296),4294967295^(ye=~(-le%4294967296))?ye=ye+1|0:(ye=0,Re=Re+1|0)),le>=18446744073709552e3||le<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");pe.realloc(10),function(Ie,ke,je){je.buf[je.pos++]=127&Ie|128,Ie>>>=7,je.buf[je.pos++]=127&Ie|128,Ie>>>=7,je.buf[je.pos++]=127&Ie|128,Ie>>>=7,je.buf[je.pos++]=127&Ie|128,je.buf[je.pos]=127&(Ie>>>=7)}(ye,0,pe),function(Ie,ke){var je=(7&Ie)<<4;ke.buf[ke.pos++]|=je|((Ie>>>=3)?128:0),Ie&&(ke.buf[ke.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(ke.buf[ke.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(ke.buf[ke.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(ke.buf[ke.pos++]=127&Ie|((Ie>>>=7)?128:0),Ie&&(ke.buf[ke.pos++]=127&Ie)))))}(Re,pe)}(Y,this):(this.realloc(4),this.buf[this.pos++]=127&Y|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=127&(Y>>>=7)|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=127&(Y>>>=7)|(Y>127?128:0),Y<=127||(this.buf[this.pos++]=Y>>>7&127))))},writeSVarint:function(Y){this.writeVarint(Y<0?2*-Y-1:2*Y)},writeBoolean:function(Y){this.writeVarint(!!Y)},writeString:function(Y){Y=String(Y),this.realloc(4*Y.length),this.pos++;var le=this.pos;this.pos=function(ye,Re,Ie){for(var ke,je,rt=0;rt<Re.length;rt++){if((ke=Re.charCodeAt(rt))>55295&&ke<57344){if(!je){ke>56319||rt+1===Re.length?(ye[Ie++]=239,ye[Ie++]=191,ye[Ie++]=189):je=ke;continue}if(ke<56320){ye[Ie++]=239,ye[Ie++]=191,ye[Ie++]=189,je=ke;continue}ke=je-55296<<10|ke-56320|65536,je=null}else je&&(ye[Ie++]=239,ye[Ie++]=191,ye[Ie++]=189,je=null);ke<128?ye[Ie++]=ke:(ke<2048?ye[Ie++]=ke>>6|192:(ke<65536?ye[Ie++]=ke>>12|224:(ye[Ie++]=ke>>18|240,ye[Ie++]=ke>>12&63|128),ye[Ie++]=ke>>6&63|128),ye[Ie++]=63&ke|128)}return Ie}(this.buf,Y,this.pos);var pe=this.pos-le;pe>=128&&b(le,pe,this),this.pos=le-1,this.writeVarint(pe),this.pos+=pe},writeFloat:function(Y){this.realloc(4),l.write(this.buf,Y,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Y){this.realloc(8),l.write(this.buf,Y,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Y){var le=Y.length;this.writeVarint(le),this.realloc(le);for(var pe=0;pe<le;pe++)this.buf[this.pos++]=Y[pe]},writeRawMessage:function(Y,le){this.pos++;var pe=this.pos;Y(le,this);var ye=this.pos-pe;ye>=128&&b(pe,ye,this),this.pos=pe-1,this.writeVarint(ye),this.pos+=ye},writeMessage:function(Y,le,pe){this.writeTag(Y,n.Bytes),this.writeRawMessage(le,pe)},writePackedVarint:function(Y,le){le.length&&this.writeMessage(Y,E,le)},writePackedSVarint:function(Y,le){le.length&&this.writeMessage(Y,A,le)},writePackedBoolean:function(Y,le){le.length&&this.writeMessage(Y,D,le)},writePackedFloat:function(Y,le){le.length&&this.writeMessage(Y,M,le)},writePackedDouble:function(Y,le){le.length&&this.writeMessage(Y,k,le)},writePackedFixed32:function(Y,le){le.length&&this.writeMessage(Y,B,le)},writePackedSFixed32:function(Y,le){le.length&&this.writeMessage(Y,U,le)},writePackedFixed64:function(Y,le){le.length&&this.writeMessage(Y,K,le)},writePackedSFixed64:function(Y,le){le.length&&this.writeMessage(Y,te,le)},writeBytesField:function(Y,le){this.writeTag(Y,n.Bytes),this.writeBytes(le)},writeFixed32Field:function(Y,le){this.writeTag(Y,n.Fixed32),this.writeFixed32(le)},writeSFixed32Field:function(Y,le){this.writeTag(Y,n.Fixed32),this.writeSFixed32(le)},writeFixed64Field:function(Y,le){this.writeTag(Y,n.Fixed64),this.writeFixed64(le)},writeSFixed64Field:function(Y,le){this.writeTag(Y,n.Fixed64),this.writeSFixed64(le)},writeVarintField:function(Y,le){this.writeTag(Y,n.Varint),this.writeVarint(le)},writeSVarintField:function(Y,le){this.writeTag(Y,n.Varint),this.writeSVarint(le)},writeStringField:function(Y,le){this.writeTag(Y,n.Bytes),this.writeString(le)},writeFloatField:function(Y,le){this.writeTag(Y,n.Fixed32),this.writeFloat(le)},writeDoubleField:function(Y,le){this.writeTag(Y,n.Fixed64),this.writeDouble(le)},writeBooleanField:function(Y,le){this.writeVarintField(Y,!!le)}},GP}var xw=oi(FN());const WP=3;function MY(l,n,a){n.glyphs=[],l===1&&a.readMessage(RY,n)}function RY(l,n,a){if(l===3){const{id:h,bitmap:f,width:_,height:y,left:b,top:E,advance:A}=a.readMessage(kY,{});n.glyphs.push({id:h,bitmap:new Hh({width:_+2*WP,height:y+2*WP},f),metrics:{width:_,height:y,left:b,top:E,advance:A}})}else l===4?n.ascender=a.readSVarint():l===5&&(n.descender=a.readSVarint())}function kY(l,n,a){l===1?n.id=a.readVarint():l===2?n.bitmap=a.readBytes():l===3?n.width=a.readVarint():l===4?n.height=a.readVarint():l===5?n.left=a.readSVarint():l===6?n.top=a.readSVarint():l===7&&(n.advance=a.readVarint())}const DY=WP,Hs={horizontal:1,vertical:2,horizontalOnly:3};class n0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,a){const h=new n0;return h.scale=n||1,h.fontStack=a,h}static forImage(n){const a=new n0;return a.image=n,a}}class xg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a,h){const f=new xg;for(let _=0;_<n.sections.length;_++){const y=n.sections[_];y.image?f.addImageSection(y,h):f.addTextSection(y,a)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(a,h){let f="";for(let _=0;_<a.length;_++){const y=a.charCodeAt(_+1)||null,b=a.charCodeAt(_-1)||null;f+=!h&&(y&&Rb(y)&&!r0[a[_+1]]||b&&Rb(b)&&!r0[a[_-1]])||!r0[a[_]]?a[_]:r0[a[_]]}return f}(this.text,n)}trim(){let n=0;for(let h=0;h<this.text.length&&bw[this.text.charCodeAt(h)];h++)n++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=n&&bw[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){const h=new xg;return h.text=this.text.substring(n,a),h.sectionIndex=this.sectionIndex.slice(n,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}addTextSection(n,a){this.text+=n.text,this.sections.push(n0.forText(n.scale,n.fontStack||a));const h=this.sections.length-1;for(let f=0;f<n.text.length;++f)this.sectionIndex.push(h)}addImageSection(n,a){const h=n.image?n.image.getPrimary():null;if(!h)return void Rr("Can't add FormattedSection with an empty image.");h.scaleSelf(a);const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCodePoint(f),this.sections.push(n0.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qP(l,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K=1){const te=xg.fromFeature(l,f,K);k===Hs.vertical&&te.verticalizePunctuation(D);let oe=[];const de=function(ye,Re,Ie,ke,je,rt){if(!ye)return[];const xt=[],ft=function(_t,et,nt,Pt,It,sr){let Kt=0;for(let Ft=0;Ft<_t.length();Ft++){const Et=_t.getSection(Ft);Kt+=BN(_t.getCodePoint(Ft),Et,Pt,It,et,sr)}return Kt/Math.max(1,Math.ceil(Kt/nt))}(ye,Re,Ie,ke,je,rt),vt=ye.text.indexOf("")>=0;let wt=0;for(let _t=0;_t<ye.length();_t++){const et=ye.getSection(_t),nt=ye.getCodePoint(_t);if(bw[nt]||(wt+=BN(nt,et,ke,je,Re,rt)),_t<ye.length()-1){const Pt=!((it=nt)<11904||!(cr["Bopomofo Extended"](it)||cr.Bopomofo(it)||cr["CJK Compatibility Forms"](it)||cr["CJK Compatibility Ideographs"](it)||cr["CJK Compatibility"](it)||cr["CJK Radicals Supplement"](it)||cr["CJK Strokes"](it)||cr["CJK Symbols and Punctuation"](it)||cr["CJK Unified Ideographs Extension A"](it)||cr["CJK Unified Ideographs"](it)||cr["Enclosed CJK Letters and Months"](it)||cr["Halfwidth and Fullwidth Forms"](it)||cr.Hiragana(it)||cr["Ideographic Description Characters"](it)||cr["Kangxi Radicals"](it)||cr["Katakana Phonetic Extensions"](it)||cr.Katakana(it)||cr["Vertical Forms"](it)||cr["Yi Radicals"](it)||cr["Yi Syllables"](it)));(LY[nt]||Pt||et.image)&&xt.push(UN(_t+1,wt,ft,xt,zY(nt,ye.getCodePoint(_t+1),Pt&&vt),!1))}}var it;return VN(UN(ye.length(),wt,ft,xt,0,!0))}(te,A,_,n,h,B),{processBidirectionalText:fe,processStyledBidirectionalText:Y}=zl;if(fe&&te.sections.length===1){const ye=fe(te.toString(),de);for(const Re of ye){const Ie=new xg;Ie.text=Re,Ie.sections=te.sections;for(let ke=0;ke<Re.length;ke++)Ie.sectionIndex.push(0);oe.push(Ie)}}else if(Y){const ye=Y(te.text,te.sectionIndex,de);for(const Re of ye){const Ie=new xg;Ie.text=Re[0],Ie.sectionIndex=Re[1],Ie.sections=te.sections,oe.push(Ie)}}else oe=function(ye,Re){const Ie=[],ke=ye.text;let je=0;for(const rt of Re)Ie.push(ye.substring(je,rt)),je=rt;return je<ke.length&&Ie.push(ye.substring(je,ke.length)),Ie}(te,de);const le=[],pe={positionedLines:le,text:te.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ye,Re,Ie,ke,je,rt,xt,ft,vt,wt,it,_t){let et=0,nt=0,Pt=0;const It=ft==="right"?1:ft==="left"?0:.5;let sr=!1;for(const Jt of je){const mr=Jt.getSections();for(const Or of mr){if(Or.image)continue;const Ir=Re[Or.fontStack];if(Ir&&(sr=Ir.ascender!==void 0&&Ir.descender!==void 0,!sr))break}if(!sr)break}let Kt=0;for(const Jt of je){Jt.trim();const mr=Jt.getMaxScale(),Or=(mr-1)*go,Ir={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Kt]=Ir;const Ur=Ir.positionedGlyphs;let Dr=0;if(!Jt.length()){nt+=rt,++Kt;continue}let Vr=0,mn=0;for(let ge=0;ge<Jt.length();ge++){const ve=Jt.getSection(ge),ot=Jt.getSectionIndex(ge),Rt=Jt.getCodePoint(ge);let Bt=ve.scale,jt=null,Zt=null,fr=null,Wr=go,qr=0;vt===Hs.vertical&&((Ft=Rt)===12312||Ft===12313||Ft===12316||Ft===12540||Ft===12448)&&(vt=Hs.horizontal);const Lr=!(vt===Hs.horizontal||!it&&!_v(Rt)||it&&(bw[Rt]||oP(Rt)));if(ve.image){const vn=ke.get(ve.image.toString());if(!vn)continue;fr=ve.image,ye.iconsInText=ye.iconsInText||!0,Zt=vn.paddedRect;const Rn=vn.displaySize;Bt=Bt*go/_t,jt={width:Rn[0],height:Rn[1],left:0,top:-3,advance:Lr?Rn[1]:Rn[0],localGlyph:!1},qr=sr?-jt.height*Bt:mr*go-17-Rn[1]*Bt,Wr=jt.advance;const Zr=(Lr?Rn[0]:Rn[1])*Bt-go*mr;Zr>0&&Zr>Dr&&(Dr=Zr)}else{const vn=Ie[ve.fontStack];if(!vn)continue;vn[Rt]&&(Zt=vn[Rt]);const Rn=Re[ve.fontStack];if(!Rn)continue;const Zr=Rn.glyphs[Rt];if(!Zr)continue;if(jt=Zr.metrics,Wr=Rt!==8203?go:0,sr){const ci=Rn.ascender!==void 0?Math.abs(Rn.ascender):0,$n=Rn.descender!==void 0?Math.abs(Rn.descender):0,gn=(ci+$n)*Bt;Vr<gn&&(Vr=gn,mn=(ci-$n)/2*Bt),qr=-ci*Bt}else qr=(mr-Bt)*go-17}Lr?(ye.verticalizable=!0,Ur.push({glyph:Rt,image:fr,x:et,y:nt+qr,vertical:Lr,scale:Bt,localGlyph:jt.localGlyph,fontStack:ve.fontStack,sectionIndex:ot,metrics:jt,rect:Zt}),et+=Wr*Bt+wt):(Ur.push({glyph:Rt,image:fr,x:et,y:nt+qr,vertical:Lr,scale:Bt,localGlyph:jt.localGlyph,fontStack:ve.fontStack,sectionIndex:ot,metrics:jt,rect:Zt}),et+=jt.advance*Bt+wt)}Ur.length!==0&&(Pt=Math.max(et-wt,Pt),sr?GN(Ur,It,Dr,mn,rt*mr/2):GN(Ur,It,Dr,0,rt/2)),et=0;const Bn=rt*mr+Dr;Ir.lineOffset=Math.max(Dr,Or),nt+=Bn,++Kt}var Ft;const Et=nt,{horizontalAlign:Tr,verticalAlign:Xt}=ZP(xt);(function(Jt,mr,Or,Ir,Ur,Dr){const Vr=(mr-Or)*Ur,mn=-Dr*Ir;for(const Bn of Jt)for(const ge of Bn.positionedGlyphs)ge.x+=Vr,ge.y+=mn})(ye.positionedLines,It,Tr,Xt,Pt,Et),ye.top+=-Xt*Et,ye.bottom=ye.top+Et,ye.left+=-Tr*Pt,ye.right=ye.left+Pt,ye.hasBaseline=sr}(pe,n,a,h,oe,y,b,E,k,A,D,U),!function(ye){for(const Re of ye)if(Re.positionedGlyphs.length!==0)return!1;return!0}(le))return pe}const bw={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},LY={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BN(l,n,a,h,f,_){if(n.image){const y=h.get(n.image.toString());return y?y.displaySize[0]*n.scale*go/_+f:0}{const y=a[n.fontStack],b=y&&y.glyphs[l];return b?b.metrics.advance*n.scale+f:0}}function $N(l,n,a,h){const f=Math.pow(l-n,2);return h?l<n?f/2:2*f:f+Math.abs(a)*a}function zY(l,n,a){let h=0;return l===10&&(h-=1e4),a&&(h+=150),l!==40&&l!==65288||(h+=50),n!==41&&n!==65289||(h+=50),h}function UN(l,n,a,h,f,_){let y=null,b=$N(n,a,f,_);for(const E of h){const A=$N(n-E.x,a,f,_)+E.badness;A<=b&&(y=E,b=A)}return{index:l,x:n,priorBreak:y,badness:b}}function VN(l){return l?VN(l.priorBreak).concat(l.index):[]}function ZP(l){let n=.5,a=.5;switch(l){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(l){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function GN(l,n,a,h,f){if(!(n||a||h||f))return;const _=l.length-1,y=l[_],b=(y.x+y.metrics.advance*y.scale)*n;for(let E=0;E<=_;E++)l[E].x-=b,l[E].y+=a+h+f}function HN(l){return l.imagePrimary!==void 0&&l.top!==void 0&&l.bottom!==void 0&&l.left!==void 0&&l.right!==void 0}function NY(l,n,a,h){const{horizontalAlign:f,verticalAlign:_}=ZP(h),y=a[0]-l.displaySize[0]*f,b=a[1]-l.displaySize[1]*_;return{imagePrimary:l,imageSecondary:n,top:b,bottom:b+l.displaySize[1],left:y,right:y+l.displaySize[0]}}function WN(l,n,a,h,f,_){const y=l.imagePrimary;let b;if(y.content){const te=y.content,oe=y.pixelRatio||1;b=[te[0]/oe,te[1]/oe,y.displaySize[0]-te[2]/oe,y.displaySize[1]-te[3]/oe]}const E=n.left*_,A=n.right*_;let M,k,D,B;a==="width"||a==="both"?(B=f[0]+E-h[3],k=f[0]+A+h[1]):(B=f[0]+(E+A-y.displaySize[0])/2,k=B+y.displaySize[0]);const U=n.top*_,K=n.bottom*_;return a==="height"||a==="both"?(M=f[1]+U-h[0],D=f[1]+K+h[2]):(M=f[1]+(U+K-y.displaySize[1])/2,D=M+y.displaySize[1]),{imagePrimary:y,imageSecondary:void 0,top:M,right:k,bottom:D,left:B,collisionPadding:b}}function qN(l){return!l.imagePrimary.stretchX}function ZN(l){return!l.imagePrimary.stretchY}function XN(l){return{width:l.right-l.left,height:l.bottom-l.top}}const jc=128;function KN(l,n,a){const{expression:h}=n;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Tn(l+1,{worldview:a}))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:_}=h;let y=0;for(;y<f.length&&f[y]<=l;)y++;y=Math.max(0,y-1);let b=y;for(;b<f.length&&f[b]<l+1;)b++;b=Math.min(f.length-1,b);const E=f[y],A=f[b];return h.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:A,interpolationType:_}:{kind:"camera",minZoom:E,maxZoom:A,minSize:h.evaluate(new Tn(E,{worldview:a})),maxSize:h.evaluate(new Tn(A,{worldview:a})),interpolationType:_}}}function XP(l,{uSize:n,uSizeT:a},{lowerSize:h,upperSize:f}){return l.kind==="source"?h/jc:l.kind==="composite"?pr(h/jc,f/jc,a):n}function i0(l,n,a=1){let h=0,f=0;if(l.kind==="constant")f=l.layoutSize*a;else if(l.kind!=="source"){const{interpolationType:_,minZoom:y,maxZoom:b}=l,E=_?Ee(Vs.interpolationFactor(_,n,y,b),0,1):0;l.kind==="camera"?f=pr(l.minSize,l.maxSize,E)*a:h=E*a}return{uSizeT:h,uSize:f}}class Iu extends Dt{constructor(n,a,h,f,_){super(n,a),this.angle=f,this.z=h,_!==void 0&&(this.segment=_)}clone(){return new Iu(this.x,this.y,this.z,this.angle,this.segment)}}function YN(l,n,a,h,f){if(n.segment===void 0)return!0;let _=n,y=n.segment+1,b=0;for(;b>-a/2;){if(y--,y<0)return!1;b-=l[y].dist(_),_=l[y]}b+=l[y].dist(l[y+1]),y++;const E=[];let A=0;for(;b<a/2;){const M=l[y],k=l[y+1];if(!k)return!1;let D=l[y-1].angleTo(M)-M.angleTo(k);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:b,angleDelta:D}),A+=D;b-E[0].distance>h;)A-=E.shift().angleDelta;if(A>f)return!1;y++,b+=M.dist(k)}return!0}function JN(l){let n=0;for(let a=0;a<l.length-1;a++)n+=l[a].dist(l[a+1]);return n}function QN(l,n,a){return l?.6*n*a:0}function ej(l,n){return Math.max(l?l.right-l.left:0,n?n.right-n.left:0)}function jY(l,n,a,h,f,_){const y=QN(a,f,_),b=ej(a,h)*_;let E=0;const A=JN(l)/2;for(let M=0;M<l.length-1;M++){const k=l[M],D=l[M+1],B=k.dist(D);if(E+B>A){const U=(A-E)/B,K=pr(k.x,D.x,U),te=pr(k.y,D.y,U),oe=new Iu(K,te,0,D.angleTo(k),M);return!y||YN(l,oe,b,y,n)?oe:void 0}E+=B}}function FY(l,n,a,h,f,_,y,b,E){const A=QN(h,_,y),M=ej(h,f),k=M*y,D=l[0].x===0||l[0].x===E||l[0].y===0||l[0].y===E;return n-k<n/4&&(n=k+n/4),tj(l,D?n/2*b%n:(M/2+2*_)*y*b%n,n,A,a,k,D,!1,E)}function tj(l,n,a,h,f,_,y,b,E){const A=_/2,M=JN(l);let k=0,D=n-a,B=[];for(let U=0;U<l.length-1;U++){const K=l[U],te=l[U+1],oe=K.dist(te),de=te.angleTo(K);for(;D+a<k+oe;){D+=a;const fe=(D-k)/oe,Y=pr(K.x,te.x,fe),le=pr(K.y,te.y,fe);if(Y>=0&&Y<E&&le>=0&&le<E&&D-A>=0&&D+A<=M){const pe=new Iu(Y,le,0,de,U);h&&!YN(l,pe,_,h,f)||B.push(pe)}}k+=oe}return b||B.length||y||(B=tj(l,k/2,a,h,f,_,y,!0,E)),B}function rj(l){let n=0,a=0;for(const y of l)n+=y.w*y.h,a=Math.max(a,y.w);l.sort((y,b)=>b.h-y.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let f=0,_=0;for(const y of l)for(let b=h.length-1;b>=0;b--){const E=h[b];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,_=Math.max(_,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const A=h.pop();b<h.length&&(h[b]=A)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(h.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:_,fill:n/(f*_)||0}}Ht(Iu,"Anchor");const op=1;class o0{static getImagePositionScale(n,a,h){if(a&&n&&n.options&&n.options.transform){const f=n.options.transform;return{x:f.a,y:f.d}}return{x:h,y:h}}constructor(n,a,h,f){this.paddedRect=n;const{pixelRatio:_,version:y,stretchX:b,stretchY:E,content:A,sdf:M,usvg:k}=a;this.pixelRatio=_,this.stretchX=b,this.stretchY=E,this.content=A,this.version=y,this.padding=h,this.sdf=M,this.usvg=k,this.scale=o0.getImagePositionScale(f,k,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function KP(l,n,a){const h=Ol.parse(l),f=function(_,y,b=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*b[0])+2*y,h:(_.data?_.data.height:_.height*b[1])+2*y}}(n,a,[h.options.transform.a,h.options.transform.d]);return{bin:f,imagePosition:new o0(f,n,a,h),imageVariant:h}}class nj{constructor(n,a,h){const f=new Map,_=new Map;this.haveRenderCallbacks=[];const y=[];this.addImages(n,f,op,y),this.addImages(a,_,2,y);const{w:b,h:E}=rj(y),A=new Oo({width:b||1,height:E||1});for(const[M,k]of n.entries()){const D=f.get(M).paddedRect;Oo.copy(k.data,A,{x:0,y:0},{x:D.x+op,y:D.y+op},k.data,h,k.sdf)}for(const[M,k]of a.entries()){const D=_.get(M),B=D.paddedRect;let U=D.padding;const K=B.x+U,te=B.y+U,oe=k.data.width,de=k.data.height;U=U>1?U-1:U,Oo.copy(k.data,A,{x:0,y:0},{x:K,y:te},k.data,h),Oo.copy(k.data,A,{x:0,y:de-U},{x:K,y:te-U},{width:oe,height:U},h),Oo.copy(k.data,A,{x:0,y:0},{x:K,y:te+de},{width:oe,height:U},h),Oo.copy(k.data,A,{x:oe-U,y:0},{x:K-U,y:te},{width:U,height:de},h),Oo.copy(k.data,A,{x:0,y:0},{x:K+oe,y:te},{width:U,height:de},h),Oo.copy(k.data,A,{x:oe-U,y:de-U},{x:K-U,y:te-U},{width:U,height:U},h),Oo.copy(k.data,A,{x:0,y:de-U},{x:K+oe,y:te-U},{width:U,height:U},h),Oo.copy(k.data,A,{x:0,y:0},{x:K+oe,y:te+de},{width:U,height:U},h),Oo.copy(k.data,A,{x:oe-U,y:0},{x:K-U,y:te+de},{width:U,height:U},h)}this.lut=h,this.image=A,this.iconPositions=f,this.patternPositions=_}addImages(n,a,h,f){for(const[_,y]of n.entries()){const{bin:b,imagePosition:E,imageVariant:A}=KP(_,y,h);a.set(_,E),f.push(b),y.hasRenderCallback&&this.haveRenderCallbacks.push(A.id)}}patchUpdatedImages(n,a,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>n.hasImage(f,h)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const f of n.getUpdatedImages(h)){for(const _ of this.iconPositions.keys()){const y=Ol.parse(_);if(bs.isEqual(y.id,f)){const b=n.getImage(f,h);this.patchUpdatedImage(this.iconPositions.get(_),b,a)}}for(const _ of this.patternPositions.keys()){const y=Ol.parse(_);if(bs.isEqual(y.id,f)){const b=n.getImage(f,h);this.patchUpdatedImage(this.patternPositions.get(_),b,a)}}}}patchUpdatedImage(n,a,h){if(!n||!a||n.version===a.version)return;n.version=a.version;const[f,_]=n.tl,y=n.sdf;if(this.lut||y){const b={width:a.data.width,height:a.data.height},E=new Oo(b);Oo.copy(a.data,E,{x:0,y:0},{x:0,y:0},b,this.lut,y),h.update(E,{position:{x:f,y:_}})}else h.update(a.data,{position:{x:f,y:_}})}}Ht(o0,"ImagePosition"),Ht(nj,"ImageAtlas");const ww=1e20;function ij(l,n,a,h,f,_,y,b,E){for(let A=n;A<n+h;A++)oj(l,a*_+A,_,f,y,b,E);for(let A=a;A<a+f;A++)oj(l,A*_+n,1,h,y,b,E)}function oj(l,n,a,h,f,_,y){_[0]=0,y[0]=-1e20,y[1]=ww,f[0]=l[n];for(let b=1,E=0,A=0;b<h;b++){f[b]=l[n+b*a];const M=b*b;do{const k=_[E];A=(f[b]-f[k]+M-k*k)/(b-k)/2}while(A<=y[E]&&--E>-1);E++,_[E]=b,y[E]=A,y[E+1]=ww}for(let b=0,E=0;b<h;b++){for(;y[E+1]<b;)E++;const A=_[E],M=b-A;l[n+b*a]=f[A]+M*M}}const $l=2,YP={none:0,ideographs:1,all:2};class bg{constructor(n,a,h){this.requestManager=n,this.localGlyphMode=a,this.localFontFamily=h,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,a){this.urls[a]=n}getGlyphs(n,a,h){const f=[],_=this.urls[a]||wo.GLYPHS_URL;for(const y in n)for(const b of n[y])f.push({stack:y,id:b});Ne(f,({stack:y,id:b},E)=>{let A=this.entries[y];A||(A=this.entries[y]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let M=A.glyphs[b];if(M!==void 0)return void E(null,{stack:y,id:b,glyph:M});if(M=this._tinySDF(A,y,b),M)return A.glyphs[b]=M,void E(null,{stack:y,id:b,glyph:M});const k=Math.floor(b/256);if(256*k>65535)return Rr("glyphs > 65535 not supported"),void E(null,{stack:y,id:b,glyph:M});if(A.ranges[k])return void E(null,{stack:y,id:b,glyph:M});let D=A.requests[k];D||(D=A.requests[k]=[],bg.loadGlyphRange(y,k,_,this.requestManager,(B,U)=>{if(U){A.ascender=U.ascender,A.descender=U.descender;for(const K in U.glyphs)this._doesCharSupportLocalGlyph(+K)||(A.glyphs[+K]=U.glyphs[+K]);A.ranges[k]=!0}for(const K of D)K(B,U);delete A.requests[k]})),D.push((B,U)=>{B?E(B):U&&E(null,{stack:y,id:b,glyph:U.glyphs[b]||null})})},(y,b)=>{if(y)h(y);else if(b){const E={};for(const{stack:A,id:M,glyph:k}of b)E[A]===void 0&&(E[A]={}),E[A].glyphs===void 0&&(E[A].glyphs={}),E[A].glyphs[M]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},E[A].ascender=this.entries[A].ascender,E[A].descender=this.entries[A].descender;h(null,E)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==YP.none&&(this.localGlyphMode===YP.all?!!this.localFontFamily:!!this.localFontFamily&&(cr["CJK Unified Ideographs"](n)||cr["Hangul Syllables"](n)||cr.Hiragana(n)||cr.Katakana(n)||cr["CJK Symbols and Punctuation"](n)||cr["CJK Unified Ideographs Extension A"](n)||cr["CJK Unified Ideographs Extension B"](n)||cr.Osage(n)))}_tinySDF(n,a,h){const f=this.localFontFamily;if(!f||!this._doesCharSupportLocalGlyph(h))return;let _=n.tinySDF;if(!_){let K="400";/bold/i.test(a)?K="900":/medium/i.test(a)?K="500":/light/i.test(a)&&(K="200"),_=n.tinySDF=new bg.TinySDF({fontFamily:f,fontWeight:K,fontSize:24*$l,buffer:3*$l,radius:8*$l}),_.fontWeight=K}if(this.localGlyphs[_.fontWeight][h])return this.localGlyphs[_.fontWeight][h];const y=String.fromCodePoint(h),{data:b,width:E,height:A,glyphWidth:M,glyphHeight:k,glyphLeft:D,glyphTop:B,glyphAdvance:U}=_.draw(y);return this.localGlyphs[_.fontWeight][h]={id:h,bitmap:new Hh({width:E,height:A},b),metrics:{width:M/$l,height:k/$l,left:D/$l,top:B/$l-27,advance:U/$l,localGlyph:!0}}}}bg.loadGlyphRange=function(l,n,a,h,f){const _=256*n,y=_+255,b=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",l).replace("{range}",`${_}-${y}`),df.Glyphs);ff(b,(E,A)=>{if(E)f(E);else if(A){const M={},k=function(D){return new xw(D).readFields(MY,{})}(A);for(const D of k.glyphs)M[D.id]=D;f(null,{glyphs:M,ascender:k.ascender,descender:k.descender})}})},bg.TinySDF=class{constructor({fontSize:l=24,buffer:n=3,radius:a=8,cutoff:h=.25,fontFamily:f="sans-serif",fontWeight:_="normal",fontStyle:y="normal"}={}){this.buffer=n,this.cutoff=h,this.radius=a;const b=this.size=l+4*n,E=this._createCanvas(b),A=this.ctx=E.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${_} ${l}px ${f}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(l){const n=document.createElement("canvas");return n.width=n.height=l,n}draw(l){const{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:f,actualBoundingBoxRight:_}=this.ctx.measureText(l),y=Math.ceil(a),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-f))),E=Math.min(this.size-this.buffer,y+Math.ceil(h)),A=b+2*this.buffer,M=E+2*this.buffer,k=Math.max(A*M,0),D=new Uint8ClampedArray(k),B={data:D,width:A,height:M,glyphWidth:b,glyphHeight:E,glyphTop:y,glyphLeft:0,glyphAdvance:n};if(b===0||E===0)return B;const{ctx:U,buffer:K,gridInner:te,gridOuter:oe}=this;U.clearRect(K,K,b,E),U.fillText(l,K,K+y);const de=U.getImageData(K,K,b,E);oe.fill(ww,0,k),te.fill(0,0,k);for(let fe=0;fe<E;fe++)for(let Y=0;Y<b;Y++){const le=de.data[4*(fe*b+Y)+3]/255;if(le===0)continue;const pe=(fe+K)*A+Y+K;if(le===1)oe[pe]=0,te[pe]=ww;else{const ye=.5-le;oe[pe]=ye>0?ye*ye:0,te[pe]=ye<0?ye*ye:0}}ij(oe,0,0,A,M,A,this.f,this.v,this.z),ij(te,K,K,b,E,A,this.f,this.v,this.z);for(let fe=0;fe<k;fe++){const Y=Math.sqrt(oe[fe])-Math.sqrt(te[fe]);D[fe]=Math.round(255-255*(Y/this.radius+this.cutoff))}return B}};const sp=op;function sj(l,n){return l+n[1]-n[0]}function aj(l,n,a,h,f=1){const _=[],y=l.imagePrimary,b=y.pixelRatio,E=y.paddedRect.w-2*sp,A=y.paddedRect.h-2*sp,M=(l.right-l.left)*f,k=(l.bottom-l.top)*f,D=y.stretchX||[[0,E]],B=y.stretchY||[[0,A]],U=D.reduce(sj,0),K=B.reduce(sj,0),te=E-U,oe=A-K;let de=0,fe=U,Y=0,le=K,pe=0,ye=te,Re=0,Ie=oe;if(y.content&&h){const je=y.content;de=Sw(D,0,je[0]),Y=Sw(B,0,je[1]),fe=Sw(D,je[0],je[2]),le=Sw(B,je[1],je[3]),pe=je[0]-de,Re=je[1]-Y,ye=je[2]-je[0]-fe,Ie=je[3]-je[1]-le}const ke=(je,rt,xt,ft)=>{const vt=Tw(je.stretch-de,fe,M,l.left*f),wt=Ew(je.fixed-pe,ye,je.stretch,U),it=Tw(rt.stretch-Y,le,k,l.top*f),_t=Ew(rt.fixed-Re,Ie,rt.stretch,K),et=Tw(xt.stretch-de,fe,M,l.left*f),nt=Ew(xt.fixed-pe,ye,xt.stretch,U),Pt=Tw(ft.stretch-Y,le,k,l.top*f),It=Ew(ft.fixed-Re,Ie,ft.stretch,K),sr=new Dt(vt,it),Kt=new Dt(et,it),Ft=new Dt(et,Pt),Et=new Dt(vt,Pt),Tr=new Dt(wt/b,_t/b),Xt=new Dt(nt/b,It/b),Jt=n*Math.PI/180;if(Jt){const Vr=Math.sin(Jt),mn=Math.cos(Jt),Bn=[mn,-Vr,Vr,mn];sr._matMult(Bn),Kt._matMult(Bn),Et._matMult(Bn),Ft._matMult(Bn)}const mr=je.stretch+je.fixed,Or=xt.stretch+xt.fixed,Ir=rt.stretch+rt.fixed,Ur=ft.stretch+ft.fixed,Dr=l.imageSecondary;return{tl:sr,tr:Kt,bl:Et,br:Ft,texPrimary:{x:y.paddedRect.x+sp+mr,y:y.paddedRect.y+sp+Ir,w:Or-mr,h:Ur-Ir},texSecondary:Dr?{x:Dr.paddedRect.x+sp+mr,y:Dr.paddedRect.y+sp+Ir,w:Or-mr,h:Ur-Ir}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Tr,pixelOffsetBR:Xt,minFontScaleX:ye/b/M,minFontScaleY:Ie/b/k,isSDF:a}};if(h&&(y.stretchX||y.stretchY)){const je=lj(D,te,U),rt=lj(B,oe,K);for(let xt=0;xt<je.length-1;xt++){const ft=je[xt],vt=je[xt+1];for(let wt=0;wt<rt.length-1;wt++)_.push(ke(ft,rt[wt],vt,rt[wt+1]))}}else _.push(ke({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:A+1}));return _}function Sw(l,n,a){let h=0;for(const f of l)h+=Math.max(n,Math.min(a,f[1]))-Math.max(n,Math.min(a,f[0]));return h}function lj(l,n,a){const h=[{fixed:-1,stretch:0}];for(const[f,_]of l){const y=h[h.length-1];h.push({fixed:f-y.stretch,stretch:y.stretch}),h.push({fixed:f-y.stretch,stretch:y.stretch+(_-f)})}return h.push({fixed:n+sp,stretch:a}),h}function Tw(l,n,a,h){return l/n*a+h}function Ew(l,n,a,h){return l-n*a/h}function BY(l,n,a,h){const f=n+l.positionedLines[h].lineOffset;return h===0?a+f/2:a+(f+(n+l.positionedLines[h-1].lineOffset))/2}function $Y(l,n=1,a=!1){let h=1/0,f=1/0,_=-1/0,y=-1/0;const b=l[0];for(let B=0;B<b.length;B++){const U=b[B];(!B||U.x<h)&&(h=U.x),(!B||U.y<f)&&(f=U.y),(!B||U.x>_)&&(_=U.x),(!B||U.y>y)&&(y=U.y)}const E=Math.min(_-h,y-f);let A=E/2;const M=new Cm([],UY);if(E===0)return new Dt(h,f);for(let B=h;B<_;B+=E)for(let U=f;U<y;U+=E)M.push(new wg(B+A,U+A,A,l));let k=function(B){let U=0,K=0,te=0;const oe=B[0];for(let de=0,fe=oe.length,Y=fe-1;de<fe;Y=de++){const le=oe[de],pe=oe[Y],ye=le.x*pe.y-pe.x*le.y;K+=(le.x+pe.x)*ye,te+=(le.y+pe.y)*ye,U+=3*ye}return new wg(K/U,te/U,0,B)}(l),D=M.length;for(;M.length;){const B=M.pop();(B.d>k.d||!k.d)&&(k=B,a&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,D)),B.max-k.d<=n||(A=B.h/2,M.push(new wg(B.p.x-A,B.p.y-A,A,l)),M.push(new wg(B.p.x+A,B.p.y-A,A,l)),M.push(new wg(B.p.x-A,B.p.y+A,A,l)),M.push(new wg(B.p.x+A,B.p.y+A,A,l)),D+=4)}return a&&(console.log(`num probes: ${D}`),console.log(`best distance: ${k.d}`)),k.p}function UY(l,n){return n.max-l.max}class wg{constructor(n,a,h,f){this.p=new Dt(n,a),this.h=h,this.d=function(_,y){let b=!1,E=1/0;for(let A=0;A<y.length;A++){const M=y[A];for(let k=0,D=M.length,B=D-1;k<D;B=k++){const U=M[k],K=M[B];U.y>_.y!=K.y>_.y&&_.x<(K.x-U.x)*(_.y-U.y)/(K.y-U.y)+U.x&&(b=!b),E=Math.min(E,hg(_,U,K))}}return(b?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}}const VY=Object.keys,JP=Number.POSITIVE_INFINITY,GY=Math.sqrt(2);function cj(l,[n,a]){let h=0,f=0;if(a===JP){n<0&&(n=0);const _=n/GY;switch(l){case"top-right":case"top-left":f=_-7;break;case"bottom-right":case"bottom-left":f=7-_;break;case"bottom":f=7-n;break;case"top":f=n-7}switch(l){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=n;break;case"right":h=-n}}else{switch(n=Math.abs(n),a=Math.abs(a),l){case"top-right":case"top-left":case"top":f=a-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-a}switch(l){case"top-right":case"bottom-right":case"right":h=-n;break;case"top-left":case"bottom-left":case"left":h=n}}return[h,f]}function Aw(l,n,a,h,f,_,y,b,E){if(!n||!n.usvg)return;const A=XN(h),M=XN(f),k=_!=="both"&&_!=="width"||!qN(h)?1:M.width/A.width,D=_!=="both"&&_!=="height"||!ZN(h)?1:M.height/A.height;a.scaleSelf(k,D);const B=a.toString();y.set(B,a),b.set(B,n);const{imagePosition:U}=KP(B,n,op);E.set(B,U)}function uj(l,n,a,h,f,_,y,b,E){if(!l)return;const A=function(M,k,D,B,U,K){if(M.kind==="camera")return M.maxSize;if(M.kind==="composite"){const te=k.possiblyEvaluate(new Tn(M.maxZoom,{worldview:K}),D).evaluate(U,{},D),oe=k.possiblyEvaluate(new Tn(M.minZoom,{worldview:K}),D).evaluate(U,{},D);return Math.max(te,oe)}return k.possiblyEvaluate(new Tn(B,{worldview:K})).evaluate(U,{},D)}(n,a,h,f,_,E);return l.scaleSelf(A*b*y)}function hj(l,n,a,h,f,_,y,b,E){return{iconPrimary:uj(l.getPrimary(),n,a,h,f,_,y,b,E),iconSecondary:uj(l.getSecondary(),n,a,h,f,_,y,b,E)}}function HY(l,n,a){if(!n)return;const h=a.get(l.toString()),f=a.get(n.toString());f&&(h.paddedRect.w===f.paddedRect.w&&h.paddedRect.h===f.paddedRect.h||Rr(`Mismatch in icon variant sizes: ${l.toString()} and ${n.toString()}`),h.usvg!==f.usvg&&Rr(`Mismatch in icon variant image types: ${l.id} and ${n.id}`))}function dj(l,n,a,h){if(!l)return;const f=n.get(a.toString());if(l.imagePrimary=f,h){const _=n.get(h.toString());l.imageSecondary=_}}function WY(l,n){for(const a in l.horizontal)fj(l.horizontal[a],n);fj(l.vertical,n)}function fj(l,n){if(l){for(const a of l.positionedLines)for(const h of a.positionedGlyphs)if(h.image!==null){const f=h.image.toString();h.rect=n.get(f).paddedRect}}}function QP(l){switch(l){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qY(l,n,a,h,f,_,y,b,E){const A=eC(_.horizontal)||_.vertical,M=a.get("icon-text-fit-padding").evaluate(h,{},f);let k,D=n;return n&&E!=="none"&&(l.allowVerticalPlacement&&_.vertical&&(k=WN(n,_.vertical,E,M,b,y)),A&&(D=WN(n,A,E,M,b,y))),{defaultShapedIcon:D,verticallyShapedIcon:k}}function ZY(l,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe,de,fe){let Y=y.textMaxSize.evaluate(n,{},D);Y===void 0?Y=b*y.textScaleFactor:Y*=y.textScaleFactor;const le=l.layers[0].layout,pe=eC(a.horizontal)||a.vertical,ye=B.name==="globe",Re=go,Ie=l.tilePixelRatio*Y/Re,ke=(wt=l.overscaling,l.zoom>18&&wt>2&&(wt>>=1),Math.max(Nt/(512*wt),1)*le.get("symbol-spacing")),je=le.get("text-padding")*l.tilePixelRatio,rt=le.get("icon-padding")*l.tilePixelRatio,xt=nn(le.get("text-max-angle")),ft=le.get("icon-rotation-alignment")==="map"&&fe!=="point",vt=ke/2;var wt;l.hasAnyIconTextFit===!1&&te!=="none"&&(l.hasAnyIconTextFit=!0);const it=n.properties?+n.properties[Hr]:null,_t=it&&l.elevationFeatureIdToIndex?l.elevationFeatureIdToIndex.get(it):65535,et=(nt,Pt,It)=>{if(Pt.x<0||Pt.x>=Nt||Pt.y<0||Pt.y>=Nt)return;let sr=null;if(ye){const{x:Kt,y:Ft,z:Et}=B.projectTilePoint(Pt.x,Pt.y,It);sr={anchor:new Iu(Kt,Ft,Et,0,void 0),up:B.upVector(It,Pt.x,Pt.y)}}(function(Kt,Ft,Et,Tr,Xt,Jt,mr,Or,Ir,Ur,Dr,Vr,mn,Bn,ge,ve,ot,Rt,Bt,jt,Zt,fr,Wr,qr,Lr,vn,Rn,Zr,ci){const $n=Kt.addToLineVertexArray(Ft,Tr);let gn,bi,Xn,kn,Un,wn,jr,En=0,ui=0,hr=0,Qr=0,Kn=-1,_i=-1;const ti={};let Hi=mf("");const Pn=Et?Et.anchor:Ft,Ui=Zr!=="none";let Es=0,Mo=0;if(Ir._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Wi=Ir.layout.get("text-offset").evaluate(Zt,{},Lr);Es=Wi[0]*go,Mo=Wi[1]*go}else Es=Ir.layout.get("text-radial-offset").evaluate(Zt,{},Lr)*go,Mo=JP;if(Kt.allowVerticalPlacement&&Xt.vertical){const Wi=Xt.vertical;if(ge)wn=tC(Wi),Or&&(jr=tC(Or));else{const io=Ir.layout.get("text-rotate").evaluate(Zt,{},Lr)+90;Xn=Pw(Ur,Pn,Ft,Dr,Vr,mn,Wi,Bn,io,ve),Or&&(kn=Pw(Ur,Pn,Ft,Dr,Vr,mn,Or,Rt,io))}}if(Jt){const Wi=Kt.iconSizeData,io=Ir.layout.get("icon-rotate").evaluate(Zt,{},Lr),Ro=aj(Jt,io,Wr,Ui,fr.iconScaleFactor),ts=Or?aj(Or,io,Wr,Ui,fr.iconScaleFactor):void 0;bi=Pw(Ur,Pn,Ft,Dr,Vr,mn,Jt,Rt,io,null),En=4*Ro.length;let $o=null;Wi.kind==="source"?($o=[jc*Ir.layout.get("icon-size").evaluate(Zt,{},Lr)*fr.iconScaleFactor],$o[0]>qh&&Rr(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${s0}. Reduce your "icon-size".`)):Wi.kind==="composite"&&($o=[jc*fr.compositeIconSizes[0].evaluate(Zt,{},Lr)*fr.iconScaleFactor,jc*fr.compositeIconSizes[1].evaluate(Zt,{},Lr)*fr.iconScaleFactor],($o[0]>qh||$o[1]>qh)&&Rr(`${Kt.layerIds[0]}: Value for "icon-size" is >= ${s0}. Reduce your "icon-size".`)),Kt.addSymbols(Kt.icon,Ro,$o,jt,Bt,Zt,void 0,Et,Ft,$n.lineStartIndex,$n.lineLength,-1,qr,Lr,vn,Rn),Kn=Kt.icon.placedSymbolArray.length-1,ts&&(ui=4*ts.length,Kt.addSymbols(Kt.icon,ts,$o,jt,Bt,Zt,Hs.vertical,Et,Ft,$n.lineStartIndex,$n.lineLength,-1,qr,Lr,vn,Rn),_i=Kt.icon.placedSymbolArray.length-1)}for(const Wi in Xt.horizontal){const io=Wi,Ro=Xt.horizontal[io];gn||(Hi=mf(Ro.text),ge?Un=tC(Ro):gn=Pw(Ur,Pn,Ft,Dr,Vr,mn,Ro,Bn,Ir.layout.get("text-rotate").evaluate(Zt,{},Lr),ve));const ts=Ro.positionedLines.length===1;if(hr+=pj(Kt,Et,Ft,Ro,mr,Ir,ge,Zt,ve,$n,Xt.vertical?Hs.horizontal:Hs.horizontalOnly,ts?VY(Xt.horizontal):[io],ti,Kn,fr,qr,Lr,vn),ts)break}Xt.vertical&&(Qr+=pj(Kt,Et,Ft,Xt.vertical,mr,Ir,ge,Zt,ve,$n,Hs.vertical,["vertical"],ti,_i,fr,qr,Lr,vn));let Ao=-1;const As=(Wi,io)=>Wi?Math.max(Wi,io):io;Ao=As(Un,Ao),Ao=As(wn,Ao),Ao=As(jr,Ao);const Fc=Ao>-1?1:0;Kt.glyphOffsetArray.length>=65535&&Rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&Kt.addToSortKeyRanges(Kt.symbolInstances.length,Zt.sortKey),Kt.symbolInstances.emplaceBack(Ft.x,Ft.y,Pn.x,Pn.y,Pn.z,ti.right>=0?ti.right:-1,ti.center>=0?ti.center:-1,ti.left>=0?ti.left:-1,ti.vertical>=0?ti.vertical:-1,Kn,_i,Hi,gn!==void 0?gn:Kt.collisionBoxArray.length,gn!==void 0?gn+1:Kt.collisionBoxArray.length,Xn!==void 0?Xn:Kt.collisionBoxArray.length,Xn!==void 0?Xn+1:Kt.collisionBoxArray.length,bi!==void 0?bi:Kt.collisionBoxArray.length,bi!==void 0?bi+1:Kt.collisionBoxArray.length,kn||Kt.collisionBoxArray.length,kn?kn+1:Kt.collisionBoxArray.length,Dr,hr,Qr,En,ui,Fc,0,Es,Mo,Ao,0,Ui?1:0,ci)})(l,Pt,sr,nt,a,h,_,f,l.layers[0],l.collisionBoxArray,n.index,n.sourceLayerIndex,l.index,je,de,A,0,rt,ft,oe,n,y,M,k,D,U,K,te,_t)};if(fe==="line")for(const nt of gw(n.geometry,0,0,Nt,Nt)){const Pt=FY(nt,ke,xt,a.vertical||pe,h,Re,Ie,l.overscaling,Nt);for(const It of Pt)pe&&XY(l,pe.text,vt,It)||et(nt,It,D)}else if(fe==="line-center"){for(const nt of n.geometry)if(nt.length>1){const Pt=jY(nt,xt,a.vertical||pe,h,Re,Ie);Pt&&et(nt,Pt,D)}}else if(n.type==="Polygon")for(const nt of uw(n.geometry,0)){const Pt=$Y(nt,16);et(nt[0],new Iu(Pt.x,Pt.y,0,0,void 0),D)}else if(n.type==="LineString")for(const nt of n.geometry)et(nt,new Iu(nt[0].x,nt[0].y,0,0,void 0),D);else if(n.type==="Point")for(const nt of n.geometry)for(const Pt of nt)et([Pt],new Iu(Pt.x,Pt.y,0,0,void 0),D)}const s0=255,qh=s0*jc;function pj(l,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te,oe){const de=function(le,pe,ye,Re,Ie,ke,je,rt){const xt=[];if(pe.positionedLines.length===0)return xt;const ft=Re.layout.get("text-rotate").evaluate(ke,{})*Math.PI/180,vt=function(nt){const Pt=nt[0],It=nt[1],sr=Pt*It;return sr>0?[Pt,-It]:sr<0?[-Pt,It]:Pt===0?[It,Pt]:[It,-Pt]}(ye);let wt=Math.abs(pe.top-pe.bottom);for(const nt of pe.positionedLines)wt-=nt.lineOffset;const it=pe.positionedLines.length,_t=wt/it;let et=pe.top-ye[1];for(let nt=0;nt<it;++nt){const Pt=pe.positionedLines[nt];et=BY(pe,_t,et,nt);for(const It of Pt.positionedGlyphs){if(!It.rect)continue;const sr=It.rect||{};let Kt=DY+1,Ft=!0,Et=1,Tr=0;if(It.image){const Zt=je.get(It.image.toString());if(!Zt)continue;if(Zt.sdf){Rr("SDF images are not supported in formatted text and will be ignored.");continue}Ft=!1,Et=Zt.pixelRatio,Kt=op/Et}const Xt=(Ie||rt)&&It.vertical,Jt=It.metrics.advance*It.scale/2,mr=It.metrics,Or=It.rect;if(Or===null)continue;rt&&pe.verticalizable&&(Tr=It.image?Jt-It.metrics.width*It.scale/2:0);const Ir=Ie?[It.x+Jt,It.y]:[0,0];let Ur=[0,0],Dr=[0,0],Vr=!1;Ie||(Xt?(Dr=[It.x+Jt+vt[0],It.y+vt[1]-Tr],Vr=!0):Ur=[It.x+Jt+ye[0],It.y+ye[1]-Tr]);const mn=Or.w*It.scale/(Et*(It.localGlyph?$l:1)),Bn=Or.h*It.scale/(Et*(It.localGlyph?$l:1));let ge,ve,ot,Rt;if(Xt){const Zt=It.y-et,fr=new Dt(-Jt,Jt-Zt),Wr=-Math.PI/2,qr=new Dt(...Dr);ge=new Dt(-Jt+Ur[0],Ur[1]),ge._rotateAround(Wr,fr)._add(qr),ge.x+=-Zt+Jt,ge.y-=(mr.left-Kt)*It.scale;const Lr=It.image?mr.advance*It.scale:go*It.scale,vn=String.fromCodePoint(It.glyph);CY(vn)?ge.x+=(1-Kt)*It.scale:IY(vn)?ge.x+=Lr-mr.height*It.scale+(-Kt-1)*It.scale:ge.x+=It.image||mr.width+2*Kt===Or.w&&mr.height+2*Kt===Or.h?(Lr-Bn)/2:(Lr-(mr.height+2*Kt)*It.scale)/2,ve=new Dt(ge.x,ge.y-mn),ot=new Dt(ge.x+Bn,ge.y),Rt=new Dt(ge.x+Bn,ge.y-mn)}else{const Zt=(mr.left-Kt)*It.scale-Jt+Ur[0],fr=(-mr.top-Kt)*It.scale+Ur[1],Wr=Zt+mn,qr=fr+Bn;ge=new Dt(Zt,fr),ve=new Dt(Wr,fr),ot=new Dt(Zt,qr),Rt=new Dt(Wr,qr)}if(ft){let Zt;Zt=Ie?new Dt(0,0):Vr?new Dt(vt[0],vt[1]):new Dt(ye[0],ye[1]),ge._rotateAround(ft,Zt),ve._rotateAround(ft,Zt),ot._rotateAround(ft,Zt),Rt._rotateAround(ft,Zt)}const Bt=new Dt(0,0),jt=new Dt(0,0);xt.push({tl:ge,tr:ve,bl:ot,br:Rt,texPrimary:sr,texSecondary:void 0,writingMode:pe.writingMode,glyphOffset:Ir,sectionIndex:It.sectionIndex,isSDF:Ft,pixelOffsetTL:Bt,pixelOffsetBR:jt,minFontScaleX:0,minFontScaleY:0})}}return xt}(0,h,E,_,y,b,f,l.allowVerticalPlacement),fe=l.textSizeData;let Y=null;fe.kind==="source"?(Y=[jc*_.layout.get("text-size").evaluate(b,{},te)*U.textScaleFactor],Y[0]>qh&&Rr(`${l.layerIds[0]}: Value for "text-size" is >= ${s0}. Reduce your "text-size".`)):fe.kind==="composite"&&(Y=[jc*U.compositeTextSizes[0].evaluate(b,{},te)*U.textScaleFactor,jc*U.compositeTextSizes[1].evaluate(b,{},te)*U.textScaleFactor],(Y[0]>qh||Y[1]>qh)&&Rr(`${l.layerIds[0]}: Value for "text-size" is >= ${s0}. Reduce your "text-size".`)),l.addSymbols(l.text,de,Y,E,y,b,M,n,a,A.lineStartIndex,A.lineLength,B,K,te,oe,!1);for(const le of k)D[le]=l.text.placedSymbolArray.length-1;return 4*de.length}function eC(l){for(const n in l)return l[n];return null}function Pw(l,n,a,h,f,_,y,b,E,A){let M=y.top,k=y.bottom,D=y.left,B=y.right;if(HN(y)&&y.collisionPadding){const U=y.collisionPadding;D-=U[0],M-=U[1],B+=U[2],k+=U[3]}if(E){const U=new Dt(D,M),K=new Dt(B,M),te=new Dt(D,k),oe=new Dt(B,k),de=nn(E);let fe=new Dt(0,0);A&&(fe=new Dt(A[0],A[1])),U._rotateAround(de,fe),K._rotateAround(de,fe),te._rotateAround(de,fe),oe._rotateAround(de,fe),D=Math.min(U.x,K.x,te.x,oe.x),B=Math.max(U.x,K.x,te.x,oe.x),M=Math.min(U.y,K.y,te.y,oe.y),k=Math.max(U.y,K.y,te.y,oe.y)}return l.emplaceBack(n.x,n.y,n.z,a.x,a.y,D,M,B,k,b,h,f,_),l.length-1}function tC(l){HN(l)&&l.collisionPadding&&(l.top-=l.collisionPadding[1],l.bottom+=l.collisionPadding[3]);const n=l.bottom-l.top;return n>0?Math.max(10,n):null}function XY(l,n,a,h){const f=l.compareText;if(n in f){const _=f[n];for(let y=_.length-1;y>=0;y--)if(h.dist(_[y])<a)return!0}else f[n]=[];return f[n].push(h),!1}function mj(l,n){const a=l.fovAboveCenter,h=l.elevation?l.elevation.getMinElevationBelowMSL()*n:0,f=(l._camera.position[2]*l.worldSize-h)/Math.cos(l._pitch),_=Math.sin(a)*f/Math.sin(Math.max(Math.PI/2-l._pitch-a,.01));let y=Math.sin(l._pitch)*_+f;const b=f*(1/l._horizonShift);if(!l.elevation||l.elevation.exaggeration()===0){let E=Math.max(l.zoom-17,0);l.isOrthographic&&(E/=10),y*=1+E}return Math.min(1.01*y,b)}function a0(l,n){if(!n.isReprojectedInTileSpace)return{scale:1<<l.z,x:l.x,y:l.y,x2:l.x+1,y2:l.y+1,projection:n};const a=Math.pow(2,-l.z),h=l.x*a,f=(l.x+1)*a,_=l.y*a,y=(l.y+1)*a,b=Oe(h),E=Oe(f),A=Ve(_),M=Ve(y),k=n.project(b,A),D=n.project(E,A),B=n.project(E,M),U=n.project(b,M);let K=Math.min(k.x,D.x,B.x,U.x),te=Math.min(k.y,D.y,B.y,U.y),oe=Math.max(k.x,D.x,B.x,U.x),de=Math.max(k.y,D.y,B.y,U.y);const fe=a/16;function Y(pe,ye,Re,Ie,ke,je){const rt=(Re+ke)/2,xt=(Ie+je)/2,ft=n.project(Oe(rt),Ve(xt)),vt=Math.max(0,K-ft.x,te-ft.y,ft.x-oe,ft.y-de);K=Math.min(K,ft.x),oe=Math.max(oe,ft.x),te=Math.min(te,ft.y),de=Math.max(de,ft.y),vt>fe&&(Y(pe,ft,Re,Ie,rt,xt),Y(ft,ye,rt,xt,ke,je))}Y(k,D,h,_,f,_),Y(D,B,f,_,f,y),Y(B,U,f,y,h,y),Y(U,k,h,y,h,_),K-=fe,te-=fe,oe+=fe,de+=fe;const le=1/Math.max(oe-K,de-te);return{scale:le,x:K*le,y:te*le,x2:oe*le,y2:de*le,projection:n}}function gj(l,{x:n,y:a},h=0){return new Dt(((n-h)*l.scale-l.x)*Nt,(a*l.scale-l.y)*Nt)}const KY=j(new Float32Array(16));class Zh{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,a){return{x:0,y:0,z:0}}unproject(n,a){return new ce(0,0)}projectTilePoint(n,a,h){return{x:n,y:a,z:0}}locationPoint(n,a,h,f=!0){return n._coordinatePoint(n.locationCoordinate(a,h),f)}pixelsPerMeter(n,a){return Ce(1,n)*a}pixelSpaceConversion(n,a,h){return 1}farthestPixelDistance(n){return mj(n,n.pixelsPerMeter)}pointCoordinate(n,a,h,f){const _=n.horizonLineFromTop(!1),y=new Dt(a,Math.max(_,h));return n.rayIntersectionCoordinate(n.pointRayIntersection(y,f))}pointCoordinate3D(n,a,h){const f=new Dt(a,h);if(n.elevation)return n.elevation.pointCoordinate(f);{const _=this.pointCoordinate(n,f.x,f.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(n,a){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,a.x,a.y);const h=n.horizonLineFromTop();return a.y<h}createInversionMatrix(n,a){return KY}createTileMatrix(n,a,h){let f,_,y;const b=h.canonical,E=j(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=a0(b,this);f=1,_=A.x+h.wrap*A.scale,y=A.y,Z(E,E,[f/A.scale,f/A.scale,n.pixelsPerMeter/a])}else f=a/n.zoomScale(b.z),_=(b.x+Math.pow(2,b.z)*h.wrap)*f,y=b.y*f;return q(E,E,[_,y,0]),Z(E,E,[f/Nt,f/Nt,1]),E}upVector(n,a,h){return[0,0,1]}upVectorScale(n,a,h){return{metersToTile:1}}}class YY extends Zh{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[a,h]=this.parallels=n.parallels||[29.5,45.5],f=Math.sin(nn(a));this.n=(f+Math.sin(nn(h)))/2,this.c=1+f*(2*this.n-f),this.r0=Math.sqrt(this.c)/this.n}project(n,a){const{n:h,c:f,r0:_}=this,y=nn(n-this.center[0]),b=nn(a),E=Math.sqrt(f-2*h*Math.sin(b))/h;return{x:E*Math.sin(y*h),y:E*Math.cos(y*h)-_,z:0}}unproject(n,a){const{n:h,c:f,r0:_}=this,y=_+a;let b=Math.atan2(n,Math.abs(y))*Math.sign(y);y*h<0&&(b-=Math.PI*Math.sign(n)*Math.sign(y));const E=nn(this.center[0])*h;b=We(b,-Math.PI-E,Math.PI-E);const A=Ee(Je(b/h)+this.center[0],-180,180),M=Math.asin(Ee((f-(n*n+y*y)*h*h)/(2*h),-1,1)),k=Ee(Je(M),-85.051129,at);return new ce(A,k)}}const l0=1.340264,c0=-.081106,u0=893e-6,h0=.003796,Cw=Math.sqrt(3)/2;class JY extends Zh{project(n,a){a=a/180*Math.PI,n=n/180*Math.PI;const h=Math.asin(Cw*Math.sin(a)),f=h*h,_=f*f*f;return{x:.5*(n*Math.cos(h)/(Cw*(l0+3*c0*f+_*(7*u0+9*h0*f)))/Math.PI+.5),y:1-.5*(h*(l0+c0*f+_*(u0+h0*f))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,f=h*h,_=f*f*f;for(let M,k,D,B=0;B<12&&(k=h*(l0+c0*f+_*(u0+h0*f))-a,D=l0+3*c0*f+_*(7*u0+9*h0*f),M=k/D,h=Ee(h-M,-Math.PI/3,Math.PI/3),f=h*h,_=f*f*f,!(Math.abs(M)<1e-12));++B);const y=Cw*n*(l0+3*c0*f+_*(7*u0+9*h0*f))/Math.cos(h),b=Math.asin(Math.sin(h)/Cw),E=Ee(180*y/Math.PI,-180,180),A=Ee(180*b/Math.PI,-85.051129,at);return new ce(E,A)}}class QY extends Zh{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){return{x:.5+n/360,y:.5-a/360,z:0}}unproject(n,a){const h=360*(n-.5),f=Ee(360*(.5-a),-85.051129,at);return new ce(h,f)}}const Sg=Math.PI/2;function Iw(l){return Math.tan((Sg+l)/2)}class eJ extends Zh{constructor(n){super(n),this.center=n.center||[0,30];const[a,h]=this.parallels=n.parallels||[30,30];let f=nn(a),_=nn(h);this.southernCenter=f+_<0,this.southernCenter&&(f=-f,_=-_);const y=Math.cos(f),b=Iw(f);this.n=f===_?Math.sin(f):Math.log(y/Math.cos(_))/Math.log(Iw(_)/b),this.f=y*Math.pow(Iw(f),this.n)/this.n}project(n,a){a=nn(a),this.southernCenter&&(a=-a),n=nn(n-this.center[0]);const h=1e-6,{n:f,f:_}=this;_>0?a<-Sg+h&&(a=-Sg+h):a>Sg-h&&(a=Sg-h);const y=_/Math.pow(Iw(a),f);let b=y*Math.sin(f*n),E=_-y*Math.cos(f*n);return b=.5*(b/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:b,y:this.southernCenter?E:1-E,z:0}}unproject(n,a){n=(2*n-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:h,f}=this,_=f-a,y=Math.sign(_),b=Math.sign(h)*Math.sqrt(n*n+_*_);let E=Math.atan2(n,Math.abs(_))*y;_*h<0&&(E-=Math.PI*Math.sign(n)*y);const A=Ee(Je(E/h)+this.center[0],-180,180),M=Ee(Je(2*Math.atan(Math.pow(f/b,1/h))-Sg),-85.051129,at);return new ce(A,this.southernCenter?-M:M)}}class _j extends Zh{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,a){return{x:Te(n),y:we(a),z:0}}unproject(n,a){const h=Oe(n),f=Ve(a);return new ce(h,f)}}const yj=nn(at);class tJ extends Zh{project(n,a){const h=(a=nn(a))*a,f=h*h;return{x:.5*((n=nn(n))*(.8707-.131979*h+f*(f*(.003971*h-.001529*f)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+h*(.015085+f*(.028874*h-.044475-.005916*f)))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,f=25,_=0,y=h*h;do{y=h*h;const A=y*y;_=(h*(1.007226+y*(.015085+A*(.028874*y-.044475-.005916*A)))-a)/(1.007226+y*(.045255+A*(.259866*y-.311325-.005916*11*A))),h=Ee(h-_,-yj,yj)}while(Math.abs(_)>1e-6&&--f>0);y=h*h;const b=Ee(Je(n/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),E=Je(h);return new ce(b,E)}}const vj=nn(at);class rJ extends Zh{project(n,a){a=nn(a),n=nn(n);const h=Math.cos(a),f=2/Math.PI,_=Math.acos(h*Math.cos(n/2)),y=Math.sin(_)/_,b=.5*(n*f+2*h*Math.sin(n/2)/y)||0,E=.5*(a+Math.sin(a)/y)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(n,a){let h=n=(2*n-.5)*Math.PI,f=a=(2*(1-a)-1)*Math.PI,_=25;const y=1e-6;let b=0,E=0;do{const A=Math.cos(f),M=Math.sin(f),k=2*M*A,D=M*M,B=A*A,U=Math.cos(h/2),K=Math.sin(h/2),te=2*U*K,oe=K*K,de=1-B*U*U,fe=de?1/de:0,Y=de?Math.acos(A*U)*Math.sqrt(1/de):0,le=.5*(2*Y*A*K+2*h/Math.PI)-n,pe=.5*(Y*M+f)-a,ye=.5*fe*(B*oe+Y*A*U*D)+1/Math.PI,Re=fe*(te*k/4-Y*M*K),Ie=.125*fe*(k*K-Y*M*B*te),ke=.5*fe*(D*U+Y*oe*A)+.5,je=Re*Ie-ke*ye;b=(pe*Re-le*ke)/je,E=(le*Ie-pe*ye)/je,h=Ee(h-b,-Math.PI,Math.PI),f=Ee(f-E,-vj,vj)}while((Math.abs(b)>y||Math.abs(E)>y)&&--_>0);return new ce(Je(h),Je(f))}}class xj extends Zh{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(nn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){const{scale:h,cosPhi:f}=this;return{x:nn(n)*f*h+.5,y:-Math.sin(nn(a))/f*h+.5,z:0}}unproject(n,a){const{scale:h,cosPhi:f}=this,_=-(a-.5)/h,y=Ee(Je((n-.5)/h)/f,-180,180),b=Math.asin(Ee(_*f,-1,1)),E=Ee(Je(b),-85.051129,at);return new ce(y,E)}}class nJ extends _j{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,a,h){const f=Bv(n,a,h);return Lt(f,f,aw(zc(h))),{x:f[0],y:f[1],z:f[2]}}locationPoint(n,a,h){const f=ee(a.lat,a.lng),_=Ar([],f),y=h?n._centerAltitude+h:n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(a),n._centerAltitude):n._centerAltitude;At(f,f,_,Ce(1,0)*Nt*y);const b=j(new Float64Array(16));return X(b,n.pixelMatrix,n.globeMatrix),Lt(f,f,b),new Dt(f[0],f[1])}pixelsPerMeter(n,a){return Ce(1,0)*a}pixelSpaceConversion(n,a,h){const f=Ce(1,n)*a,_=pr(Ce(1,45)*a,f,h);return this.pixelsPerMeter(n,a)/_}createTileMatrix(n,a,h){const f=yP(zc(h.canonical));return X(new Float64Array(16),n.globeMatrix,f)}createInversionMatrix(n,a){const{center:h}=n,f=aw(zc(a));return ne(f,f,nn(h.lng)),J(f,f,nn(h.lat)),Z(f,f,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(f)}pointCoordinate(n,a,h,f){return rz(n,a,h,!0)||new Le(0,0)}pointCoordinate3D(n,a,h){const f=this.pointCoordinate(n,a,h,0);return[f.x,f.y,f.z]}isPointAboveHorizon(n,a){return!rz(n,a.x,a.y,!1)}farthestPixelDistance(n){const a=function(f,_){const y=f.cameraToCenterDistance,b=f._centerAltitude*_,E=f._camera,A=f._camera.forward(),M=mt([],bt([],A,-y),[0,0,b]),k=f.worldSize/(2*Math.PI),D=[0,0,-k],B=f.width/f.height,U=Math.tan(f.fovAboveCenter),K=bt([],E.up(),U),te=bt([],E.right(),U*B),oe=Ar([],mt([],mt([],A,K),te)),de=[];let fe;if(new qn(M,oe).closestPointOnSphere(D,k,de)){const Y=mt([],de,D),le=Nr([],Y,M);fe=Math.cos(f.fovAboveCenter)*dt(le)}else{const Y=Nr([],M,D),le=Nr([],D,M);Ar(le,le);const pe=dt(Y)-k;fe=Math.sqrt(pe*(pe+2*k));const ye=Math.acos(fe/(k+pe))-Math.acos(vr(A,le));fe*=Math.cos(ye)}return 1.01*fe}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),h=Gh(n.zoom);if(h>0){const f=mj(n,Ce(1,n.center.lat)*n.worldSize),_=n.worldSize/(2*Math.PI),y=Math.max(n.width,n.height)/n.worldSize*Math.PI;return pr(a,f+_*(1-Math.cos(y)),Math.pow(h,10))}return a}upVector(n,a,h){return Bv(a,h,n,1)}upVectorScale(n){return{metersToTile:iw(sw(zc(n)))}}}function bj(l){const n=l.parallels,a=!!n&&Math.abs(n[0]+n[1])<.01;switch(l.name){case"mercator":return new _j(l);case"equirectangular":return new QY(l);case"naturalEarth":return new tJ(l);case"equalEarth":return new JY(l);case"winkelTripel":return new rJ(l);case"albers":return a?new xj(l):new YY(l);case"lambertConformalConic":return a?new xj(l):new eJ(l);case"globe":return new nJ(l)}throw new Error(`Invalid projection name: ${l.name}`)}const iJ=zr.VectorTileFeature.types,oJ=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ow(l,n,a,h,f,_,y,b,E,A,M,k,D){const B=b?Math.min(qh,Math.round(b[0])):0,U=b?Math.min(qh,Math.round(b[1])):0;l.emplaceBack(n,a,Math.round(32*h),Math.round(32*f),_,y,(B<<1)+(E?1:0),U,16*A,16*M,256*k,256*D)}function Mw(l,n,a){l.emplaceBack(n,a)}function Rw(l,n,a,h,f,_,y){l.emplaceBack(n,a,h,f,_,y)}const kw=(l,n,a,h)=>{for(let f=0;f<n;f++)l.emplaceBack(a[0],a[1],a[2],h[0],h[1],h[2])};function Dw(l,n,a,h,f){l.emplaceBack(n,a,h,f),l.emplaceBack(n,a,h,f),l.emplaceBack(n,a,h,f),l.emplaceBack(n,a,h,f)}function sJ(l){for(const n of l.sections)if(aP(n.text))return!0;return!1}class rC{constructor(n){this.layoutVertexArray=new Lh,this.indexArray=new To,this.programConfigurations=n,this.segments=new mi,this.dynamicLayoutVertexArray=new So,this.opacityVertexArray=new Nh,this.placedSymbolArray=new Gb,this.iconTransitioningVertexArray=new Mc,this.globeExtVertexArray=new zh,this.zOffsetVertexArray=new Ic,this.orientationVertexArray=new Iv}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,a,h,f,_){this.isEmpty()||(h&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,yY.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,xY.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,oJ,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,SY.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,vY.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,bY.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=n.createVertexBuffer(this.orientationVertexArray,wY.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||f)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ht(rC,"SymbolBuffers");class nC{constructor(n,a,h){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new h,this.segments=new mi,this.collisionVertexArray=new Uf,this.collisionVertexArrayExt=new So}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,TY.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,EY.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ht(nC,"CollisionBuffers");class Lw{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(y=>y.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=j([]),this.placementViewportMatrix=j([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=n.worldview,this.textSizeData=KN(this.zoom,a["text-size"],this.worldview),this.iconSizeData=KN(this.zoom,a["icon-size"],this.worldview);const h=this.layers[0].layout,f=h.get("symbol-sort-key"),_=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(y=>Hs[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new rC(new p(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new rC(new p(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new kv,this.lineVertexArray=new qb,this.symbolInstances=new Wb}calculateGlyphDependencies(n,a,h,f,_){for(const y of n){const b=y.codePointAt(0);if(b===void 0)break;if(a[b]=!0,f&&_&&b<=65535){const E=r0[y];E&&(a[E.charCodeAt(0)]=!0)}}}updateFootprints(n,a){}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!MP(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(n,a,h,f){const _=this.layers[0],y=_.layout,b=this.projection.name==="globe",E=y.get("text-font"),A=y.get("text-field"),M=y.get("icon-image"),[k,D]=y.get("icon-size-scale-range"),B=Ee(a.scaleFactor||1,k,D),U=(A.value.kind!=="constant"||A.value.value instanceof Yo&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),K=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,te=y.get("symbol-sort-key");if(this.features=[],!U&&!K)return;const oe=a.iconDependencies,de=a.glyphDependencies,fe=a.availableImages,Y=new Tn(this.zoom,{worldview:this.worldview});for(const{feature:le,id:pe,index:ye,sourceLayerIndex:Re}of n){const Ie=_._featureFilter.needGeometry,ke=Vt(le,Ie);if(!_._featureFilter.filter(Y,ke,h))continue;if(Ie||(ke.geometry=qt(le,h,f)),b&&le.type!==1&&h.z<=5){const vt=ke.geometry,wt=.98078528056,it=(_t,et)=>vr(Bv(_t.x,_t.y,h,1),Bv(et.x,et.y,h,1))<wt;for(let _t=0;_t<vt.length;_t++)vt[_t]=Ot(vt[_t],it)}let je,rt;if(U){const vt=_.getValueAndResolveTokens("text-field",ke,h,fe),wt=Yo.factory(vt);sJ(wt)&&(this.hasRTLText=!0),(!this.hasRTLText||Oh()==="unavailable"||this.hasRTLText&&zl.isParsed())&&(je=PY(wt,_,ke))}if(K){const vt=_.getValueAndResolveTokens("icon-image",ke,h,fe);rt=typeof vt=="string"?hs.build(vt):vt}if(!je&&!rt)continue;const xt=this.sortFeaturesByKey?te.evaluate(ke,{},h):void 0,ft={id:pe,text:je,icon:rt,index:ye,sourceLayerIndex:Re,geometry:ke.geometry,properties:le.properties,type:iJ[le.type],sortKey:xt};if(this.features.push(ft),rt){const vt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:wt,iconSecondary:it}=hj(rt,this.iconSizeData,vt["icon-size"],h,this.zoom,ft,this.pixelRatio,B,this.worldview),_t=wt.id.toString();if(oe.has(_t)?oe.get(_t).push(wt):oe.set(_t,[wt]),it){const et=it.id.toString();oe.has(et)?oe.get(et).push(it):oe.set(et,[it])}}if(je){const vt=E.evaluate(ke,{},h).join(","),wt=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Hs.vertical)>=0;for(const it of je.sections)if(it.image){const _t=it.image.getPrimary().scaleSelf(this.pixelRatio),et=_t.id.toString(),nt=oe.get(et)||[];nt.push(_t),oe.set(et,nt)}else{const _t=zf(je.toString()),et=it.fontStack||vt,nt=de[et]=de[et]||{};this.calculateGlyphDependencies(it.text,nt,wt,this.allowVerticalPlacement,_t)}}}if(y.get("symbol-placement")==="line"&&(this.features=function(le){const pe={},ye={},Re=[];let Ie=0;function ke(ft){Re.push(le[ft]),Ie++}function je(ft,vt,wt){const it=ye[ft];return delete ye[ft],ye[vt]=it,Re[it].geometry[0].pop(),Re[it].geometry[0]=Re[it].geometry[0].concat(wt[0]),it}function rt(ft,vt,wt){const it=pe[vt];return delete pe[vt],pe[ft]=it,Re[it].geometry[0].shift(),Re[it].geometry[0]=wt[0].concat(Re[it].geometry[0]),it}function xt(ft,vt,wt){const it=wt?vt[0][vt[0].length-1]:vt[0][0];return`${ft}:${it.x}:${it.y}`}for(let ft=0;ft<le.length;ft++){const vt=le[ft],wt=vt.geometry,it=vt.text?vt.text.toString():null;if(!it){ke(ft);continue}const _t=xt(it,wt),et=xt(it,wt,!0);if(_t in ye&&et in pe&&ye[_t]!==pe[et]){const nt=rt(_t,et,wt),Pt=je(_t,et,Re[nt].geometry);delete pe[_t],delete ye[et],ye[xt(it,Re[Pt].geometry,!0)]=Pt,Re[nt].geometry=null}else _t in ye?je(_t,et,wt):et in pe?rt(_t,et,wt):(ke(ft),pe[_t]=Ie-1,ye[et]=Ie-1)}return Re.filter(ft=>ft.geometry)}(this.features)),y.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const le of a.elevationFeatures)this.elevationFeatureIdToIndex.set(le.id,this.elevationFeatures.length),this.elevationFeatures.push(le)}}else y.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((le,pe)=>le.sortKey-pe.sortKey)}update(n,a,h,f,_,y,b){this.text.programConfigurations.updatePaintArrays(n,a,_,h,f,y,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(n,a,_,h,f,y,b,this.worldview)}updateRoadElevation(n){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const h=tt(n),f=1/h;let _=!1,y=!1;for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b),A=$e(1,0,0),M=$e(0,1,0),{numHorizontalGlyphVertices:k,numVerticalGlyphVertices:D,numIconVertices:B,numVerticalIconVertices:U}=E,K=k>0||D>0,te=B>0,oe=this.elevationFeatures[E.elevationFeatureIndex];if(oe){const de=new Dt(E.tileAnchorX,E.tileAnchorY),fe=.075+oe.pointElevation(de);E.zOffset!==fe&&(a=!0,E.zOffset=fe);const Y=oe.computeSlopeNormal(de,f),le=wl(Ai(),$e(0,0,1),Y);_r(A,A,le),_r(M,M,le),A[2]*=h,M[2]*=h,A[0]===1&&A[1]===0&&A[2]===0&&M[0]===0&&M[1]===1&&M[2]===0||(_=_||K,y=y||te)}if(K&&(kw(this.text.orientationVertexArray,k,A,M),kw(this.text.orientationVertexArray,D,A,M)),te){const{placedIconSymbolIndex:de,verticalPlacedIconSymbolIndex:fe}=E;de>=0&&kw(this.icon.orientationVertexArray,B,A,M),fe>=0&&kw(this.icon.orientationVertexArray,U,A,M)}}_||(this.text.orientationVertexArray=void 0),y||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const n=(_,y,b)=>{h+=y,h>_.length&&_.resize(h);for(let E=-y;E<0;E++)_.emplace(E+h,b)},a=(_,y,b)=>{f+=y,f>_.length&&_.resize(f);for(let E=-y;E<0;E++)_.emplace(E+f,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,f=0;for(let _=0;_<this.symbolInstances.length;_++){const y=this.symbolInstances.get(_),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:E,numIconVertices:A}=y,M=y.zOffset,k=A>0;if((b>0||E>0)&&(n(this.text.zOffsetVertexArray,b,M),n(this.text.zOffsetVertexArray,E,M)),k){const{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:B}=y;D>=0&&a(this.icon.zOffsetVertexArray,A,M),B>=0&&a(this.icon.zOffsetVertexArray,y.numVerticalIconVertices,M)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=bj(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const h=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:f,y:_}of a)this.lineVertexArray.emplaceBack(f,_);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(n,a,h,f,_,y,b,E,A,M,k,D,B,U,K,te){const oe=n.indexArray,de=n.layoutVertexArray,fe=n.globeExtVertexArray,Y=n.segments.prepareSegment(4*a.length,de,oe,this.canOverlap?y.sortKey:void 0),le=this.glyphOffsetArray.length,pe=Y.vertexLength,ye=this.allowVerticalPlacement&&b===Hs.vertical?Math.PI/2:0,Re=y.text&&y.text.sections;for(let ke=0;ke<a.length;ke++){const{tl:je,tr:rt,bl:xt,br:ft,texPrimary:vt,texSecondary:wt,pixelOffsetTL:it,pixelOffsetBR:_t,minFontScaleX:et,minFontScaleY:nt,glyphOffset:Pt,isSDF:It,sectionIndex:sr}=a[ke],Kt=Y.vertexLength,Ft=Pt[1];if(Ow(de,A.x,A.y,je.x,Ft+je.y,vt.x,vt.y,h,It,it.x,it.y,et,nt),Ow(de,A.x,A.y,rt.x,Ft+rt.y,vt.x+vt.w,vt.y,h,It,_t.x,it.y,et,nt),Ow(de,A.x,A.y,xt.x,Ft+xt.y,vt.x,vt.y+vt.h,h,It,it.x,_t.y,et,nt),Ow(de,A.x,A.y,ft.x,Ft+ft.y,vt.x+vt.w,vt.y+vt.h,h,It,_t.x,_t.y,et,nt),E){const{x:Et,y:Tr,z:Xt}=E.anchor,[Jt,mr,Or]=E.up;Rw(fe,Et,Tr,Xt,Jt,mr,Or),Rw(fe,Et,Tr,Xt,Jt,mr,Or),Rw(fe,Et,Tr,Xt,Jt,mr,Or),Rw(fe,Et,Tr,Xt,Jt,mr,Or),Dw(n.dynamicLayoutVertexArray,Et,Tr,Xt,ye)}else Dw(n.dynamicLayoutVertexArray,A.x,A.y,A.z,ye);if(te){const Et=wt||vt;Mw(n.iconTransitioningVertexArray,Et.x,Et.y),Mw(n.iconTransitioningVertexArray,Et.x+Et.w,Et.y),Mw(n.iconTransitioningVertexArray,Et.x,Et.y+Et.h),Mw(n.iconTransitioningVertexArray,Et.x+Et.w,Et.y+Et.h)}oe.emplaceBack(Kt,Kt+1,Kt+2),oe.emplaceBack(Kt+1,Kt+2,Kt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pt[0]),ke!==a.length-1&&sr===a[ke+1].sectionIndex||n.programConfigurations.populatePaintArrays(de.length,y,y.index,{},B,U,K,Re&&Re[sr],this.worldview)}const Ie=E?E.anchor:A;n.placedSymbolArray.emplaceBack(Ie.x,Ie.y,Ie.z,A.x,A.y,le,this.glyphOffsetArray.length-le,pe,M,k,A.segment,h?h[0]:0,h?h[1]:0,f[0],f[1],b,0,0,0,D,0)}_commitLayoutVertex(n,a,h,f,_,y,b){n.emplaceBack(a,h,f,_,y,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(n,a,h,f,_,y,b){const E=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),A=E.vertexLength,M=b.tileAnchorX,k=b.tileAnchorY;for(let B=0;B<4;B++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,a,n.padding,b.zOffset),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,M,k,new Dt(n.x1,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,M,k,new Dt(n.x2,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,M,k,new Dt(n.x2,n.y2)),this._commitLayoutVertex(h.layoutVertexArray,f,_,y,M,k,new Dt(n.x1,n.y2)),E.vertexLength+=4;const D=h.indexArray;D.emplaceBack(A,A+1),D.emplaceBack(A+1,A+2),D.emplaceBack(A+2,A+3),D.emplaceBack(A+3,A),E.primitiveLength+=4}_addTextDebugCollisionBoxes(n,a,h,f,_,y){for(let b=f;b<_;b++){const E=h.get(b),A=this.getSymbolInstanceTextSize(n,y,a,b);this._addCollisionDebugVertices(E,A,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(n,a,h,f,_,y){for(let b=f;b<_;b++){const E=h.get(b),A=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._addCollisionDebugVertices(E,A,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,y)}}generateCollisionDebugBuffers(n,a,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new nC(rg,zN.members,Mc),this.iconCollisionBox=new nC(rg,zN.members,Mc);const f=i0(this.iconSizeData,n),_=i0(this.textSizeData,n,h);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(_,n,a,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(_,n,a,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(f,n,a,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(f,n,a,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(n,a,h,f){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:f),y=XP(this.textSizeData,n,_)/go;return this.tilePixelRatio*y}getSymbolInstanceIconSize(n,a,h){const f=this.icon.placedSymbolArray.get(h),_=XP(this.iconSizeData,n,f);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(n,a,h,f){n.emplaceBack(a,-h,-h,f),n.emplaceBack(a,h,-h,f),n.emplaceBack(a,h,h,f),n.emplaceBack(a,-h,h,f)}_updateTextDebugCollisionBoxes(n,a,h,f,_,y,b){for(let E=f;E<_;E++){const A=h.get(E),M=this.getSymbolInstanceTextSize(n,y,a,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,A.padding,y.zOffset)}}_updateIconDebugCollisionBoxes(n,a,h,f,_,y,b){for(let E=f;E<_;E++){const A=h.get(E),M=this.getSymbolInstanceIconSize(n,a,y.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,A.padding,y.zOffset)}}updateCollisionDebugBuffers(n,a,h,f){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=i0(this.iconSizeData,n,f),y=i0(this.textSizeData,n,h);for(let b=0;b<this.symbolInstances.length;b++){const E=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(y,n,a,E.textBoxStartIndex,E.textBoxEndIndex,E,h),this._updateTextDebugCollisionBoxes(y,n,a,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,h),this._updateIconDebugCollisionBoxes(_,n,a,E.iconBoxStartIndex,E.iconBoxEndIndex,E,f),this._updateIconDebugCollisionBoxes(_,n,a,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,f)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,a,h,f,_,y,b,E,A){const M={};if(a<h){const{x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y,featureIndex:le}=n.get(a);M.textBox={x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y},M.textFeatureIndex=le}if(f<_){const{x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y,featureIndex:le}=n.get(f);M.verticalTextBox={x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y},M.verticalTextFeatureIndex=le}if(y<b){const{x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y,featureIndex:le}=n.get(y);M.iconBox={x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y},M.iconFeatureIndex=le}if(E<A){const{x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y,featureIndex:le}=n.get(E);M.verticalIconBox={x1:k,y1:D,x2:B,y2:U,padding:K,projectedAnchorX:te,projectedAnchorY:oe,projectedAnchorZ:de,tileAnchorX:fe,tileAnchorY:Y},M.verticalIconFeatureIndex=le}return M}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,a){const h=n.placedSymbolArray.get(a),f=h.vertexStartIndex+4*h.numGlyphs;for(let _=h.vertexStartIndex;_<f;_+=4)n.indexArray.emplaceBack(_,_+1,_+2),n.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),h=Math.cos(n),f=[],_=[],y=[];for(let b=0;b<this.symbolInstances.length;++b){y.push(b);const E=this.symbolInstances.get(b);f.push(0|Math.round(a*E.tileAnchorX+h*E.tileAnchorY)),_.push(E.featureIndex)}return y.sort((b,E)=>f[b]-f[E]||_[E]-_[b]),y}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:A}=h;f>=0&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&_!==f&&this.addIndicesForPlacedSymbol(this.text,_),y>=0&&y!==_&&y!==f&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wj,Sj,iC;Ht(Lw,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Lw.addDynamicAttributes=Dw;class Tj{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:dh,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht(Tj,"FormatSectionOverride",{omit:["defaultValue"]});const oC=()=>iC||(iC={layout:wj||(wj=new di({"symbol-placement":new Tt(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $t(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Be.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(Be.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(Be.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new $t(Be.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(Be.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new $t(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new $t(Be.layout_symbol["icon-image"]),"icon-rotate":new $t(Be.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new $t(Be.layout_symbol["icon-offset"]),"icon-anchor":new $t(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Be.layout_symbol["text-rotation-alignment"]),"text-field":new $t(Be.layout_symbol["text-field"]),"text-font":new $t(Be.layout_symbol["text-font"]),"text-size":new $t(Be.layout_symbol["text-size"]),"text-size-scale-range":new Tt(Be.layout_symbol["text-size-scale-range"]),"text-max-width":new $t(Be.layout_symbol["text-max-width"]),"text-line-height":new $t(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new $t(Be.layout_symbol["text-letter-spacing"]),"text-justify":new $t(Be.layout_symbol["text-justify"]),"text-radial-offset":new $t(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new $t(Be.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Be.layout_symbol["text-writing-mode"]),"text-rotate":new $t(Be.layout_symbol["text-rotate"]),"text-padding":new Tt(Be.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Be.layout_symbol["text-keep-upright"]),"text-transform":new $t(Be.layout_symbol["text-transform"]),"text-offset":new $t(Be.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(Be.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Be.layout_symbol["text-optional"]),visibility:new Tt(Be.layout_symbol.visibility)})),paint:Sj||(Sj=new di({"icon-opacity":new $t(Be.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new $t(Be.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new $t(Be.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $t(Be.paint_symbol["text-emissive-strength"]),"icon-color":new $t(Be.paint_symbol["icon-color"]),"icon-halo-color":new $t(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new $t(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $t(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Be.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Tt(Be.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $t(Be.paint_symbol["text-opacity"]),"text-occlusion-opacity":new $t(Be.paint_symbol["text-occlusion-opacity"]),"text-color":new $t(Be.paint_symbol["text-color"],{runtimeType:ws,getOverride:l=>l.textColor,hasOverride:l=>!!l.textColor}),"text-halo-color":new $t(Be.paint_symbol["text-halo-color"]),"text-halo-width":new $t(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new $t(Be.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Be.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Be.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(Be.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(Be.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(Be.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(Be.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new $t(Be.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},iC);class zw extends Bo{constructor(n,a,h,f){super(n,oC(),a,h,f),this._colorAdjustmentMatrix=j([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,a){super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const f=[];for(const _ of h)f.indexOf(_)<0&&f.push(_);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,a,h,f){return this._saturation===n&&this._contrast===a&&this._brightnessMin===h&&this._brightnessMax===f||(this._colorAdjustmentMatrix=function(_,y,b,E){_=No(_),y=cs(y);const A=G(),M=_/3,k=1-2*M,D=[k,M,M,0,M,k,M,0,M,M,k,0,0,0,0,1],B=.5-.5*y,U=E-b;return X(A,[U,0,0,0,0,U,0,0,0,0,U,0,b,b,b,1],[y,0,0,0,0,y,0,0,0,0,y,0,B,B,B,1]),X(A,A,D),A}(n,a,h,f),this._saturation=n,this._contrast=a,this._brightnessMin=h,this._brightnessMax=f),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,a,h,f){const _=this.layout.get(n).evaluate(a,{},h,f),y=this._unevaluatedLayout._values[n];return y.isDataDriven()||Wm(y.value)||!_?_:function(b,E){return E.replace(/{([^{}]+)}/g,(A,M)=>M in b?String(b[M]):"")}(a.properties,_)}createBucket(n){return new Lw(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of oC().paint.overridableProperties){if(!zw.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),h=new Tj(a),f=new Ph(h,a.property.specification,this.scope,this.options);let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new Df("source",f):new Lf("composite",f,a.value.zoomStops,a.value.interpolationType),this.paint._values[n]=new Mh(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&zw.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const h=n.get("text-field"),f=oC().paint.properties[a];let _=!1;const y=b=>{for(const E of b)if(f.overrides&&f.overrides.hasOverride(E))return void(_=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Yo)y(h.value.value.sections);else if(h.value.kind==="source"){const b=A=>{_||(A instanceof br&&Gt(A.value)===_f?y(A.value.sections):A instanceof ph?y(A.sections):A.eachChild(b))},E=h.value;E._styleExpression&&b(E._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,a,h){return{config:new $h(this,{zoom:a,lut:h}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Ej,Aj,Pj,Cj;var sC=rn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function aC(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function lC(l){switch(l){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class cC{constructor(n,a,h,f){this.context=n,this.format=h,this.useMipmap=f&&f.useMipmap,this.texture=n.gl.createTexture(),this.update(a,{premultiply:f&&f.premultiply})}update(n,a){const h=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,f=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:_}=this,{gl:y}=_,{x:b,y:E}=a&&a.position?a.position:{x:0,y:0},A=b+h,M=E+f;!this.size||this.size[0]===A&&this.size[1]===M||(y.bindTexture(y.TEXTURE_2D,null),y.deleteTexture(this.texture),this.texture=y.createTexture(),this.size=null),y.bindTexture(y.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA8&&(!a||a.premultiply!==!1));const k=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&A>0&&M>0){const D=this.useMipmap?Math.floor(Math.log2(Math.max(A,M)))+1:1;y.texStorage2D(y.TEXTURE_2D,D,this.format,A,M),this.size=[A,M]}if(this.size)if(k)y.texSubImage2D(y.TEXTURE_2D,0,b,E,aC(this.format),lC(this.format),n);else{const D=n.data;D&&y.texSubImage2D(y.TEXTURE_2D,0,b,E,h,f,aC(this.format),lC(this.format),D)}this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(n,a,h=!1){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),n!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,n),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!h?n===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(n,a,h,f,_){const{context:y}=this,{gl:b}=y;b.bindTexture(b.TEXTURE_2D,this.texture),a!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a),this.magFilter=a),n!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?n===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),h!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),this.wrapS=h),f!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,f),this.wrapT=f),_!==this.compareMode&&(_?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,_)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=_)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Nw{constructor(n,a){this.context=n,this.texture=a}bind(n,a){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,n),this.minFilter=n),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}}function jw(l,n,a,h,f,_,y,b){const E=[l,n,1,a,h,1,f,_,1],A=[y,b,1],M=R([],E),[k,D,B]=ur(A,A,M);return F(E,E,[k,0,0,0,D,0,0,0,B])}function Ij(l,n,a,h,f,_,y,b){const E=function(A,M,k,D,B,U,K,te){const oe=jw(0,0,1,0,1,1,0,1),de=jw(A,M,k,D,B,U,K,te);return F(de,de,R([],oe))}(l,n,a,h,f,_,y,b);return[E[2]/E[8]/Nt,E[5]/E[8]/Nt]}function Fw(l){return[l[0],Math.min(Math.max(l[1],-85.051129),at)]}class Oj extends uu{constructor(n,a,h,f){super(),this.id=n,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(f),this.options=a,this._dirty=!1}load(n,a){if(this._loaded=a||!1,this.fire(new cu("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Ny(this.map._requestManager.transformRequest(this.url,df.Image),(h,f)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new vm(h)):f&&(this.image=f instanceof HTMLImageElement?Sa.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Nw(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new cu("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Nw||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=n[0][1],h=n[0][1];for(const _ of n)_[1]>h&&(h=_[1]),_[1]<a&&(a=_[1]);const f=(h+a)/2;if(f>at?this.onNorthPole=!0:f<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=n.map(Le.fromLngLat);this.tileID=function(y){let b=1/0,E=1/0,A=-1/0,M=-1/0;for(const K of y)b=Math.min(b,K.x),E=Math.min(E,K.y),A=Math.max(A,K.x),M=Math.max(M,K.y);const k=Math.max(A-b,M-E),D=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),B=Math.pow(2,D);let U=Math.floor((b+A)/2*B);return U>1&&(U-=1),new ep(D,U,Math.floor((E+M)/2*B))}(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new cu("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const oe in this.tiles){const de=this.tiles[oe];de.state!=="loaded"&&(de.state="loaded",de.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=a0(new ep(0,0,0),this.map.transform.projection),h=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(oe){const de=oe[1].x-oe[0].x,fe=oe[1].y-oe[0].y,Y=oe[2].x-oe[1].x,le=oe[2].y-oe[1].y,pe=oe[3].x-oe[2].x,ye=oe[3].y-oe[2].y,Re=oe[0].x-oe[3].x,Ie=oe[0].y-oe[3].y,ke=de*le-Y*fe,je=Y*ye-pe*le,rt=pe*Ie-Re*ye,xt=Re*fe-de*Ie;return ke>0&&je>0&&rt>0&&xt>0||ke<0&&je<0&&rt<0&&xt<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const f=a0(this.tileID,this.map.transform.projection),[_,y,b,E]=this.coordinates.map(oe=>{const de=f.projection.project(oe[0],oe[1]);return gj(f,de)._round()});this.perspectiveTransform=Ij(_.x,_.y,y.x,y.y,b.x,b.y,E.x,E.y);const A=this._boundsArray=new kh;A.emplaceBack(_.x,_.y,0,0),A.emplaceBack(y.x,y.y,Nt,0),A.emplaceBack(E.x,E.y,0,Nt),A.emplaceBack(b.x,b.y,Nt,Nt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(A,sC.members),this.boundsSegments=mi.simpleSegment(0,0,4,2);const M=[],k=[Fw((D=this.coordinates)[0]),Fw(D[1]),Fw(D[2]),Fw(D[3])];var D;const[B,U,K,te]=function(oe){let de=oe[0][0],fe=de,Y=oe[0][1],le=Y;for(let pe=1;pe<oe.length;pe++)oe[pe][0]<de?de=oe[pe][0]:oe[pe][0]>fe&&(fe=oe[pe][0]),oe[pe][1]<Y?Y=oe[pe][1]:oe[pe][1]>le&&(le=oe[pe][1]);return[de,Y,fe-de,le-Y]}(k);{const oe=new kh,[de,fe,Y,le]=function(it){let _t=it[0].x,et=_t,nt=it[0].y,Pt=nt;for(let It=1;It<it.length;It++)it[It].x<_t?_t=it[It].x:it[It].x>et&&(et=it[It].x),it[It].y<nt?nt=it[It].y:it[It].y>Pt&&(Pt=it[It].y);return[_t,nt,et-_t,Pt-nt]}(h),pe=it=>[(it.x-de)/Y,(it.y-fe)/le],[ye,Re,Ie,ke]=h.map(pe),je=function(it,_t,et,nt,Pt,It,sr,Kt){const Ft=jw(0,0,1,0,1,1,0,1);return F(Ft,Ft,R([],jw(it,_t,et,nt,Pt,It,sr,Kt)))}(ye[0],ye[1],Re[0],Re[1],Ie[0],Ie[1],ke[0],ke[1]);this.elevatedGlobePerspectiveTransform=Ij(ye[0],ye[1],Re[0],Re[1],Ie[0],Ie[1],ke[0],ke[1]);const rt=(it,_t)=>{M.push(it.lng);const et=Math.round((it.lng-B)/K*Nt),nt=Math.round((it.lat-U)/te*Nt),Pt=pe(_t),It=ur([],[Pt[0],Pt[1],1],je),sr=Math.round(It[0]/It[2]*Nt),Kt=Math.round(It[1]/It[2]*Nt);oe.emplaceBack(et,nt,sr,Kt)},xt=h[3].x-h[0].x,ft=h[3].y-h[0].y,vt=h[2].x-h[1].x,wt=h[2].y-h[1].y;for(let it=0;it<65;it++){const _t=it/64,et=[h[0].x+_t*xt,h[0].y+_t*ft],nt=[h[1].x+_t*vt,h[1].y+_t*wt],Pt=nt[0]-et[0],It=nt[1]-et[1];for(let sr=0;sr<65;sr++){const Kt=sr/64,Ft={x:et[0]+Pt*Kt,y:et[1]+It*Kt};rt(a.projection.unproject(Ft.x,Ft.y),Ft)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(oe,sC.members)}{this.maxLongitudeTriangleSize=0;let oe=[],de=new To;const fe=(Y,le,pe)=>{de.emplaceBack(Y,le,pe);const ye=M[Y],Re=M[le],Ie=M[pe],ke=Math.min(Math.min(ye,Re),Ie),je=Math.max(Math.max(ye,Re),Ie)-ke;je>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=je),oe.push(ke+je/2)};for(let Y=0;Y<64;Y++)for(let le=0;le<64;le++){const pe=65*Y+le,ye=pe+1,Re=pe+65,Ie=Re+1;fe(pe,Re,ye),fe(ye,Re,Ie)}[oe,de]=function(Y,le){const pe=Array.from({length:Y.length},(Ie,ke)=>ke);pe.sort((Ie,ke)=>Y[Ie]-Y[ke]);const ye=[],Re=new To;for(let Ie=0;Ie<pe.length;Ie++){const ke=pe[Ie];ye.push(Y[ke]);const je=3*ke,rt=je+1;Re.emplaceBack(le.uint16[je],le.uint16[rt],le.uint16[rt+1])}return[ye,Re]}(oe,de),this.elevatedGlobeTrianglesCenterLongitudes=oe,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(de)}this.elevatedGlobeSegments=mi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,K/Nt,0,te/Nt,0,0,U,B,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const a=this.map.painter.context,h=a.gl;!this._dirty||this.texture instanceof Nw||(this.texture?this.texture.update(this.image):(this.texture=new cC(a,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(a)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let f=(_=n+180)+360*Math.round((h[0]-_)/360);var _;const y=new mi,b=(k,D)=>{y.segments.push({vertexOffset:0,primitiveOffset:k,vertexLength:a.segments[0].vertexLength,primitiveLength:D,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-f)<=E){const k=po(h,0,h.length,f+E);return k===h.length||b(k,ai(h,k+1,h.length,f+360-E)-k),y}f<h[0]&&(f+=360);const A=ai(h,0,h.length,f-E);if(A===h.length)return b(0,h.length),y;b(0,A-0);const M=po(h,A+1,h.length,f+E);return M!==h.length&&b(M,h.length-M),y}}const aJ=(Math.pow(256,2)-1)/16907520;class Mj extends Bo{constructor(n,a,h,f){super(n,{layout:Pj||(Pj=new di({visibility:new Tt(Be.layout_raster.visibility)})),paint:Cj||(Cj=new di({"raster-opacity":new Tt(Be.paint_raster["raster-opacity"]),"raster-color":new Tu(Be.paint_raster["raster-color"]),"raster-color-mix":new Tt(Be.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(Be.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Be.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Be.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Be.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(Be.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(Be.paint_raster["raster-array-band"]),"raster-elevation":new Tt(Be.paint_raster["raster-elevation"]),"raster-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},a,h,f),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof Oj&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[h,f]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(f)||h===this._curRampRange[0]&&f===this._curRampRange[1]||(this.colorRamp=$v({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:f}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,f])}}let Rj,kj,Dj,Lj,zj;class Nj extends Bo{constructor(n,a,h,f){super(n,{layout:Rj||(Rj=new di({visibility:new Tt(Be["layout_raster-particle"].visibility)})),paint:kj||(kj=new di({"raster-particle-array-band":new Tt(Be["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(Be["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Tu(Be["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(Be["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(Be["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(Be["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(Be["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(Be["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},a,h,f),this._updateColorRamp(),this.lastInvalidatedAt=Sa.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=$v({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Sa.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class lJ extends Bo{constructor(n,a){super(n,{},a,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(n){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function uC(l,n,a){const h=[0,0,1],f=Io([]);return Zo(f,f,a?-nn(l)+Math.PI:nn(l)),vs(f,f,-nn(n)),_r(h,h,f),Ar(h,h)}function jj(l,n){const a=Bw(l.projection,l.zoom,l.width,l.height),h=function(_,y,b,E,A){const M=new ce(b.lng-180*Xh,b.lat),k=new ce(b.lng+180*Xh,b.lat),D=_.project(M.lng,M.lat),B=_.project(k.lng,k.lat),U=-Math.atan2(B.y-D.y,B.x-D.x),K=Le.fromLngLat(b);K.y=Ee(K.y,-1+Xh,1-Xh);const te=K.toLngLat(),oe=_.project(te.lng,te.lat),de=Le.fromLngLat(te);de.x+=Xh;const fe=de.toLngLat(),Y=_.project(fe.lng,fe.lat),le=Bj(Y.x-oe.x,Y.y-oe.y,U),pe=Le.fromLngLat(te);pe.y+=Xh;const ye=pe.toLngLat(),Re=_.project(ye.lng,ye.lat),Ie=Bj(Re.x-oe.x,Re.y-oe.y,U),ke=Math.abs(le.x)/Math.abs(Ie.y),je=j([]);he(je,je,-U*(1-(A?0:E)));const rt=j([]);return Z(rt,rt,[1,1-(1-ke)*E,1]),rt[4]=-Ie.x/Ie.y*E,he(rt,rt,U),X(rt,je,rt),rt}(l.projection,0,l.center,a,n),f=Fj(l);return Z(h,h,[f,f,1]),h}function Fj(l){const n=l.projection,a=Bw(l.projection,l.zoom,l.width,l.height),h=hC(n,l.center),f=hC(n,ce.convert(n.center));return Math.pow(2,h*a+(1-a)*f)}function Bw(l,n,a,h,f=1/0){const _=l.range;if(!_)return 0;const y=Math.min(f,Math.max(a,h)),b=Math.log(y/1024)/Math.LN2;return ze(_[0]+b,_[1]+b,n)}const Xh=1/4e4;function hC(l,n){const a=Ee(n.lat,-85.051129,at),h=new ce(n.lng-180*Xh,a),f=new ce(n.lng+180*Xh,a),_=l.project(h.lng,a),y=l.project(f.lng,a),b=Le.fromLngLat(h),E=Le.fromLngLat(f),A=y.x-_.x,M=y.y-_.y,k=E.x-b.x,D=E.y-b.y,B=Math.sqrt((k*k+D*D)/(A*A+M*M));return Math.log(B)/Math.LN2}function Bj(l,n,a){const h=Math.cos(a),f=Math.sin(a);return{x:l*h-n*f,y:l*f+n*h}}function $j(l,n,a){j(l),he(l,l,nn(n[2])),J(l,l,nn(n[0])),ne(l,l,nn(n[1])),Z(l,l,a),X(l,l,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function $w(l,n,a,h,f,_,y,b){const E=[a[0]-n[0],a[1]-n[1],0],A=[h[0]-n[0],h[1]-n[1],0];if(dt(E)<1e-12||dt(A)<1e-12)return Io(l);const M=nr([],E,A);Ar(M,M),ct(A,h,n),E[2]=(_-f)*b,A[2]=(y-f)*b;const k=E;return nr(k,E,A),Ar(k,k),wl(l,M,k)}function dC(l,n,a=!1){const h=Gh(n.zoom),f=function(_,y,b){const E=y.worldSize,A=[_[12],_[13],_[14]],M=Ve(A[1]/E),k=Oe(A[0]/E),D=j([]),B=Ce(1,M)*E,U=Ce(1,0)*E*yt(M,y.zoom),K=1/vP(E);let te=U*K;if(b){const Y=Bw(y.projection,y.zoom,y.width,y.height,1024);te=K*y.projection.pixelSpaceConversion(y.center.lat,E,Y)}const oe=ee(M,k);mt(oe,oe,bt([],Ar([],oe),B*te*A[2]));const de=function(Y){const le=[Y[0],Y[1],Y[2]];let pe=[0,1,0];const ye=nr([],pe,le);return nr(pe,le,ye),or(pe)===0&&(pe=[0,1,0],nr(ye,le,pe)),Ar(ye,ye),Ar(pe,pe),Ar(le,le),[ye[0],ye[1],ye[2],0,pe[0],pe[1],pe[2],0,le[0],le[1],le[2],0,Y[0],Y[1],Y[2],1]}(oe);Z(D,D,[te,te,te*B]),q(D,D,[-A[0],-A[1],-A[2]]);const fe=X([],y.globeMatrix,de);return X(fe,fe,D),X(fe,fe,_),fe}(l,n,a);if(h>0){const _=function(y,b){const E=b.worldSize,A=Ce(1,0)*E*yt(b.center.lat,b.zoom)/vP(E),M=Ce(1,b.center.lat)*E,k=j([]);return ne(k,k,nn(b.center.lng)),J(k,k,nn(b.center.lat)),q(k,k,[0,0,S]),Z(k,k,[A,A,A*M]),q(k,k,[b.point.x-.5*E,b.point.y-.5*E,0]),X(k,k,y),X(k,b.globeMatrix,k)}(l,n);return function(y,b,E){const A=(U,K,te)=>{const oe=dt(U),de=dt(K),fe=Cu(U,K,te);return bt(fe,fe,1/dt(fe)*pr(oe,de,te))},M=A([y[0],y[1],y[2]],[b[0],b[1],b[2]],E),k=A([y[4],y[5],y[6]],[b[4],b[5],b[6]],E),D=A([y[8],y[9],y[10]],[b[8],b[9],b[10]],E),B=Cu([y[12],y[13],y[14]],[b[12],b[13],b[14]],E);return[M[0],M[1],M[2],0,k[0],k[1],k[2],0,D[0],D[1],D[2],0,B[0],B[1],B[2],1]}(f,_,h)}return f}function Uj(l,n,a,h){const f=on.projectAabbCorners(h,a);let _=Number.MAX_VALUE,y=-1;for(let A=0;A<f.length;++A){const M=f[A];M[0]=(.5*M[0]+.5)*n.width,M[1]=(.5-.5*M[1])*n.height,M[2]<_&&(y=A,_=M[2])}const b=A=>new Dt(f[A][0],f[A][1]);let E;switch(y){case 0:case 6:E=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:E=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:E=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:E=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(fs(l,E))return _}const cJ=rn([{name:"a_pos_3f",components:3,type:"Float32"}]),uJ=rn([{name:"a_color_3f",components:3,type:"Float32"}]),hJ=rn([{name:"a_color_4f",components:4,type:"Float32"}]),dJ=rn([{name:"a_uv_2f",components:2,type:"Float32"}]),fJ=rn([{name:"a_normal_3f",components:3,type:"Float32"}]),pJ=rn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),mJ=rn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),Vj={None:0,Model:1,Symbol:2,FillExtrusion:4};class Uw{constructor(n,a,h,f){this.message=(n?`${n}: `:"")+h,f&&(this.identifier=f),a!=null&&a.__line__&&(this.line=a.__line__)}}function fC(l,n){const a=l.indexOf("://")===-1;try{return new URL(l,a&&n?"http://example.com":void 0),!0}catch{return!1}}class Gj{constructor(n,a){this.feature=n,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Hj{constructor(){this.instancedDataArray=new jh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class pC{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=n.projection,this.index=n.index,this.worldview=n.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=n.styleDefinedModelURLs}updateFootprints(n,a){}populate(n,a,h,f){this.tileToMeter=tt(h);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:y,id:b,index:E,sourceLayerIndex:A}of n){const M=b??(y.properties&&y.properties.hasOwnProperty("id")?y.properties.id:void 0),k=Vt(y,_);if(!this.layers[0]._featureFilter.filter(new Tn(this.zoom,{worldview:this.worldview}),k,h))continue;const D={id:M,sourceLayerIndex:A,index:E,geometry:_?k.geometry:qt(y,h,f),properties:y.properties,type:y.type,patterns:{}},B=this.addFeature(D,D.geometry,k);B&&a.featureIndex.insert(y,D.geometry,E,A,this.index,this.instancesPerModel[B].instancedDataArray.length,Nt/32)}this.lookup=null}update(n,a,h,f){for(const _ in this.instancesPerModel){const y=this.instancesPerModel[_];for(const b in n)y.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(y.features[y.idToFeaturesIndex[b]],n[b],y,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const f of h.features){const _=this.layers[0],y=f.feature,b=this.canonical,E=_.paint.get("model-rotation").evaluate(y,{},b),A=_.paint.get("model-scale").evaluate(y,{},b),M=_.paint.get("model-translation").evaluate(y,{},b);Mt(f.rotation,E)&&Mt(f.scale,A)&&Mt(f.translation,M)||(this.evaluate(f,f.featureStates,h,!0),n=!0)}}return n}updateReplacement(n,a,h,f){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(MP(this.activeReplacements,_))return!1;this.activeReplacements=_;let y=!1;for(const b in this.instancesPerModel){const E=this.instancesPerModel[b],A=E.instancedDataArray;for(const M of E.features){const k=M.instancedDataOffset,D=M.instancedDataCount;for(let B=0;B<D;B++){const U=16*(B+k);let K=A.float32[U+0];const te=K>Nt;K=te?K-Nt:K;const oe=Math.floor(K),de=A.float32[U+1];let fe=!1;for(const Y of this.activeReplacements)if(!Nz(Y,h,Vj.Model,f)&&!(Y.min.x>oe||oe>Y.max.x||Y.min.y>de||de>Y.max.y)&&(fe=Vz(Uz(oe,de,n.canonical,Y.footprintTileId.canonical),Y.footprint),fe))break;A.float32[U]=fe?K+Nt:K,y=y||fe!==te}}}return y}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=n.createVertexBuffer(h.instancedDataArray,pJ.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)n.removeModel(a,"",!0)}addFeature(n,a,h){const f=this.layers[0],_=f.layout.get("model-id").evaluate(h,{},this.canonical);if(!_)return Rr(`modelId is not evaluated for layer ${f.id} and it is not going to get rendered.`),_;(fC(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new Hj);const y=this.instancesPerModel[_],b=y.instancedDataArray,E=new Gj(h,b.length);for(const A of a)for(const M of A){if(M.x<0||M.x>=Nt||M.y<0||M.y>=Nt)continue;const k=(this.lookupDim-1)/Nt,D=this.lookupDim*(M.y*k|0)+M.x*k|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;const B=b.length;b.resize(B+1),y.instancesEvaluatedElevation.push(0),b.float32[16*B]=M.x,b.float32[16*B+1]=M.y}return E.instancedDataCount=y.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(n.id&&(y.idToFeaturesIndex[n.id]=y.features.length),y.features.push(E),this.evaluate(E,{},y,!1)),_}getModelUris(){return this.modelUris}evaluate(n,a,h,f){const _=this.layers[0],y=n.feature,b=this.canonical,E=n.rotation=_.paint.get("model-rotation").evaluate(y,a,b),A=n.scale=_.paint.get("model-scale").evaluate(y,a,b),M=n.translation=_.paint.get("model-translation").evaluate(y,a,b),k=_.paint.get("model-color").evaluate(y,a,b);k.a=_.paint.get("model-color-mix-intensity").evaluate(y,a,b);const D=[];this.maxVerticalOffset<M[2]&&(this.maxVerticalOffset=M[2]),this.maxScale=Math.max(Math.max(this.maxScale,A[0]),Math.max(A[1],A[2])),$j(D,E,A);const B=Math.round(100*k.a)+k.b/1.05;for(let U=0;U<n.instancedDataCount;++U){const K=n.instancedDataOffset+U,te=16*K,oe=h.instancedDataArray.float32;let de=0;f&&(de=oe[te+6]-h.instancesEvaluatedElevation[K]);const fe=0|oe[te+1];oe[te]=(0|oe[te])+k.r/1.05,oe[te+1]=fe+k.g/1.05,oe[te+2]=B,oe[te+3]=1/(b.z>10?this.tileToMeter:tt(b,fe)),oe[te+4]=M[0],oe[te+5]=M[1],oe[te+6]=M[2]+de,oe[te+7]=D[0],oe[te+8]=D[1],oe[te+9]=D[2],oe[te+10]=D[4],oe[te+11]=D[5],oe[te+12]=D[6],oe[te+13]=D[8],oe[te+14]=D[9],oe[te+15]=D[10],h.instancesEvaluatedElevation[K]=M[2]}}}let Wj,qj;Ht(pC,"ModelBucket",{omit:["layers"]}),Ht(Hj,"PerModelAttributes"),Ht(Gj,"ModelFeature");const ap=64,Tg={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Zj(l,n,a,h,f,_,y,b,E,A=!1){const M=a.zoom,k=a.project(h),D=yt(h.lat,M),B=1/D;j(l),q(l,l,[k.x+y[0]*B,k.y+y[1]*B,y[2]]);let U=1,K=1;const te=a.worldSize;if(A){if(a.projection.name==="mercator"){let Y=0;a.elevation&&(Y=a.elevation.getAtPointOrZero(new Le(k.x/te,k.y/te),0));const le=On([],[k.x,k.y,Y,1],a.projMatrix)[3]/a.cameraToCenterDistance;U=le,K=le*yt(a.center.lat,M)}else if(a.projection.name==="globe"){const Y=dC(l,a),le=[0,0,0,1];On(le,le,X([],a.projMatrix,Y));const pe=le[3]/a.cameraToCenterDistance,ye=Gh(M),Re=a.projection.pixelsPerMeter(h.lat,te)*yt(h.lat,M),Ie=a.projection.pixelsPerMeter(a.center.lat,te)*yt(a.center.lat,M);U=pe/pr(Re,lt(a.center.lat),ye),K=pe*D/Re,U*=Ie,K*=Ie}}else U=B;Z(l,l,[U,U,K]);const oe=[...l],de=n.orientation,fe=[];if($j(fe,[de[0]+f[0],de[1]+f[1],de[2]+f[2]],_),X(l,oe,fe),b&&a.elevation){let Y=0;const le=[];if(E&&a.elevation){Y=function(ye,Re,Ie,ke,je){const rt=Re.elevation;if(!rt)return 0;const xt=on.projectAabbCorners(Ie,ke),ft=Ce(1,je.lat)*Re.worldSize,vt=function(Et,Tr){const Xt=[0,0,1],Jt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const mr of Jt){const Or=Et[mr.corners[0]],Ir=Et[mr.corners[1]],Ur=Et[mr.corners[2]],Dr=[Ir[0]-Or[0],Ir[1]-Or[1],Tr*(Ir[2]-Or[2])],Vr=nr(Dr,Dr,[Ur[0]-Or[0],Ur[1]-Or[1],Tr*(Ur[2]-Or[2])]);Ar(Vr,Vr),mr.dotProductWithUp=vr(Vr,Xt)}return Jt.sort((mr,Or)=>mr.dotProductWithUp-Or.dotProductWithUp),Jt[0].corners}(xt,ft),wt=xt[vt[0]],it=xt[vt[1]],_t=xt[vt[2]],et=xt[vt[3]],nt=rt.getAtPointOrZero(new Le(wt[0]/Re.worldSize,wt[1]/Re.worldSize),0),Pt=rt.getAtPointOrZero(new Le(it[0]/Re.worldSize,it[1]/Re.worldSize),0),It=rt.getAtPointOrZero(new Le(_t[0]/Re.worldSize,_t[1]/Re.worldSize),0),sr=rt.getAtPointOrZero(new Le(et[0]/Re.worldSize,et[1]/Re.worldSize),0),Kt=(nt+sr)/2,Ft=(Pt+It)/2;return Kt>Ft?Pt<It?$w(ye,it,et,wt,Pt,sr,nt,ft):$w(ye,_t,wt,et,It,nt,sr,ft):nt<sr?$w(ye,wt,it,_t,nt,Pt,It,ft):$w(ye,et,_t,it,sr,It,Pt,ft),Math.max(Kt,Ft)}(le,a,n.aabb,l,h);const pe=X([],qe([],le),fe);X(l,oe,pe)}else Y=a.elevation.getAtPointOrZero(new Le(k.x/te,k.y/te),0);Y!==0&&(l[14]+=Y)}}function d0(l,n,a=!1){l.uploaded||(l.gfxTexture=new cC(n,l.image,a?n.gl.R8:n.gl.RGBA8,{useMipmap:l.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),l.uploaded=!0,l.image=null)}function gJ(l,n,a){l.indexBuffer=n.createIndexBuffer(l.indexArray,!1,!0),l.vertexBuffer=n.createVertexBuffer(l.vertexArray,cJ.members,!1,!0),l.normalArray&&(l.normalBuffer=n.createVertexBuffer(l.normalArray,fJ.members,!1,!0)),l.texcoordArray&&(l.texcoordBuffer=n.createVertexBuffer(l.texcoordArray,dJ.members,!1,!0)),l.colorArray&&(l.colorBuffer=n.createVertexBuffer(l.colorArray,(l.colorArray.bytesPerElement===12?uJ:hJ).members,!1,!0)),l.featureArray&&(l.pbrBuffer=n.createVertexBuffer(l.featureArray,mJ.members,!0)),l.segments=mi.simpleSegment(0,0,l.vertexArray.length,l.indexArray.length);const h=l.material;h.pbrMetallicRoughness.baseColorTexture&&d0(h.pbrMetallicRoughness.baseColorTexture,n),h.pbrMetallicRoughness.metallicRoughnessTexture&&d0(h.pbrMetallicRoughness.metallicRoughnessTexture,n),h.normalTexture&&d0(h.normalTexture,n),h.occlusionTexture&&d0(h.occlusionTexture,n,a),h.emissionTexture&&d0(h.emissionTexture,n)}function mC(l,n,a){if(l.meshes)for(const h of l.meshes)gJ(h,n,a);if(l.children)for(const h of l.children)mC(h,n,a)}function Vw(l){if(l.meshes)for(const n of l.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(l.children)for(const n of l.children)Vw(n)}function gC(l){if(l.meshes)for(const a of l.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((n=a.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(l.children)for(const a of l.children)gC(a)}class Eg{constructor(n,a,h){this._demTile=n,this._dem=this._demTile.dem,this._scale=a,this._offset=h}static create(n,a,h){const f=h||n.findDEMTileFor(a);if(!f||!f.dem)return;const _=f.dem,y=f.tileID,b=1<<a.canonical.z-y.canonical.z;return new Eg(f,_.dim/Nt/b,[(a.canonical.x/b-y.canonical.x)*_.dim,(a.canonical.y/b-y.canonical.y)*_.dim])}tileCoordToPixel(n,a){const h=a*this._scale+this._offset[1],f=Math.floor(n*this._scale+this._offset[0]),_=Math.floor(h);return new Dt(f,_)}getElevationAt(n,a,h,f){const _=n*this._scale+this._offset[0],y=a*this._scale+this._offset[1],b=Math.floor(_),E=Math.floor(y),A=this._dem;return f=!!f,h?pr(pr(A.get(b,E,f),A.get(b,E+1,f),y-E),pr(A.get(b+1,E,f),A.get(b+1,E+1,f),y-E),_-b):A.get(b,E,f)}getElevationAtPixel(n,a,h){return this._dem.get(n,a,!!h)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Ce(1,n)*this._dem.stride}}const _C=new Float32Array(262144),lp=new Uint8Array(262144);function Xj(l){let n=0;if(l.meshes)for(const a of l.meshes)n=Math.max(n,a.aabb.max[2]);if(l.children)for(const a of l.children)n=Math.max(n,Xj(a));return n}function Kj(l,n,a){if(l.meshes)for(const h of l.meshes){if(h.aabb.min[0]===1/0)continue;const f=on.applyTransform(h.aabb,l.matrix);a.insert(n,f.min[0],f.min[1],f.max[0],f.max[1])}if(l.children)for(const h of l.children)Kj(h,n,a)}const Yj=["","wall","door","roof","window","lamp","logo"];class Jj{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:Xj(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new on([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const a=new on([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==n&&(h.transformedAabb=on.applyTransformFast(h.aabb,this.node.matrix),a.encapsulate(h.transformedAabb)),n++;this.aabb=a}return this.aabb}}class Gw{constructor(n,a,h,f,_,y,b,E){this.id=h,this.layers=n,this.layerIds=this.layers.map(A=>A.fqid),this.stateDependentLayerIds=this.layers.filter(A=>A.isStateDependent()).map(A=>A.id),this.modelTraits|=Tg.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,f&&(this.modelTraits|=Tg.HasMapboxMeshFeatures),_&&(this.modelTraits|=Tg.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=y,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const A of a)this.nodesInfo.push(new Jj(A)),Kj(A,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(n,a){for(const h of this.getNodesInfo()){const f=h.node;f.footprint&&a.push({footprint:f.footprint,id:n})}}update(n){const a=Object.keys(n).length!==0;if(a&&!this.stateDependentLayers.length)return;const h=a?this.stateDependentLayers:this.layers;if(!El(n,this.states))for(const f of h)this.evaluate(f,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const h of a){const f=h.node;this.uploaded?this.updatePbrBuffer(f):mC(f,n,!0)}for(const h of a)Vw(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let a=!1;if(!n.meshes)return a;for(const h of n.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),a=!0);return a}needsReEvaluation(n,a,h){const f=n.transform.projectionOptions,_=n.style.getBrightness(),y=this.brightness!==_;if(!this.uploaded||this.dirty||f.name!==this.projection.name||f0(h.paint.get("model-color").value,y)||f0(h.paint.get("model-color-mix-intensity").value,y)||f0(h.paint.get("model-roughness").value,y)||f0(h.paint.get("model-emissive-strength").value,y)||f0(h.paint.get("model-height-based-emissive-strength-multiplier").value,y)){this.projection=f,this.brightness=_;const b=this.getNodesInfo();for(const E of b)E.state=null;return!0}return!1}evaluateTransform(n,a){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const h=this.getNodesInfo(),f=this.id.canonical;for(const _ of h){const y=_.feature;_.evaluatedTranslation=a.paint.get("model-translation").evaluate(y,{},f),_.evaluatedScale=a.paint.get("model-scale").evaluate(y,{},f)}}evaluate(n,a){const h=this.getNodesInfo();for(const f of h){if(!f.node.meshes)continue;const _=f.feature,y=a&&a[_.id];if(El(y,f.state))continue;f.state=structuredClone(y);const b=f.node.meshes&&f.node.meshes[0].featureData,E=f.evaluatedColor[2],A=f.evaluatedRMEA[2],M=this.id.canonical;if(f.hasTranslucentParts=!1,b){for(let k=0;k<Yj.length;k++){const D=Yj[k];D.length&&(_.properties.part=D);const B=n.paint.get("model-color").evaluate(_,y,M).toPremultipliedRenderColor(null),U=n.paint.get("model-color-mix-intensity").evaluate(_,y,M);f.evaluatedColor[k]=[B.r,B.g,B.b,U],f.evaluatedRMEA[k][0]=n.paint.get("model-roughness").evaluate(_,y,M),f.evaluatedRMEA[k][2]=n.paint.get("model-emissive-strength").evaluate(_,y,M),f.evaluatedRMEA[k][3]=B.a,f.emissionHeightBasedParams[k]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,y,M),!f.hasTranslucentParts&&B.a<1&&(f.hasTranslucentParts=!0)}delete _.properties.part,yJ(f,E!==f.evaluatedColor[2]||A!==f.evaluatedRMEA[2],this.modelTraits)}else f.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(_,y,M);f.evaluatedTranslation=n.paint.get("model-translation").evaluate(_,y,M),f.evaluatedScale=n.paint.get("model-scale").evaluate(_,y,M),this.updatePbrBuffer(f.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,a,h,f){const _=n.findDEMTileFor(h);if(_&&(_.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const y=Eg.create(n,h,_);if(!y)return;this.modelTraits&Tg.HasMapboxMeshFeatures&&this.updateDEM(n,y,h,f);for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const A=E.footprint.vertices;let M=y.getElevationAt(A[0].x,A[0].y,!0,!0);for(let k=1;k<A.length;k++)M=Math.min(M,y.getElevationAt(A[k].x,A[k].y,!0,!0));E.elevation=M}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=a}}updateDEM(n,a,h,f){let _=a._dem._modifiedForSources[f];if(_===void 0&&(a._dem._modifiedForSources[f]=[],_=a._dem._modifiedForSources[f]),_.includes(h.canonical))return;const y=a._dem.dim;_.push(h.canonical);let b=!1;for(const E of this.getNodesInfo()){const A=E.node;if(!A.footprint||!A.footprint.grid)continue;const M=A.footprint.grid,k=a.tileCoordToPixel(M.min.x,M.min.y),D=a.tileCoordToPixel(M.max.x,M.max.y),B=Math.min(Math.min(y-D.y,k.x),Math.min(k.y,y-D.x));if(B<0)continue;const U=Ee(B,2,5);let K=Math.max(0,k.x-U),te=Math.max(0,k.y-U),oe=Math.min(D.x+U,y-1),de=Math.min(D.y+U,y-1);for(let pe=te;pe<=de;++pe)for(let ye=K;ye<=oe;++ye)lp[pe*y+ye]=255;let fe=0,Y=0;for(let pe=0;pe<M.cellsY;++pe)for(let ye=0;ye<M.cellsX;++ye){if(!M.cells[pe*M.cellsX+ye])continue;const Re=a.tileCoordToPixel(M.min.x+ye/M.xScale,M.min.y+pe/M.yScale),Ie=a.tileCoordToPixel(M.min.x+(ye+1)/M.xScale,M.min.y+(pe+1)/M.yScale);for(let ke=Re.y;ke<=Math.min(Ie.y+1,y-1);++ke)for(let je=Re.x;je<=Math.min(Ie.x+1,y-1);++je)lp[ke*y+je]===255&&(lp[ke*y+je]=0,fe+=a.getElevationAtPixel(je,ke),Y++)}const le=fe/Y;K=Math.max(1,k.x-U),te=Math.max(1,k.y-U),oe=Math.min(D.x+U,y-2),de=Math.min(D.y+U,y-2),b=!0;for(let pe=te;pe<=de;++pe)for(let ye=K;ye<=oe;++ye)lp[pe*y+ye]===0&&(_C[pe*y+ye]=a._dem.set(ye,pe,le));for(let pe=1;pe<U;++pe){K=Math.max(1,k.x-pe),te=Math.max(1,k.y-pe),oe=Math.min(D.x+pe,y-2),de=Math.min(D.y+pe,y-2);for(let ye=te;ye<=de;++ye)for(let Re=K;Re<=oe;++Re){const Ie=ye*y+Re;if(lp[Ie]===255){let ke=0,je=0,rt=-1,xt=-1;for(let ft=-1;ft<=1;++ft)for(let vt=-1;vt<=1;++vt){const wt=(ye+ft)*y+Re+vt;if(lp[wt]>=pe)continue;const it=_C[wt],_t=Math.abs(it);_t>je&&(ke=it,je=_t,rt=vt,xt=ft)}if(je>.1){const ft=1-(pe+.5*Math.abs(rt*xt))/U;let vt=a._dem.get(Re,ye)+ke*ft;const wt=a._dem.get(Re+rt,ye+xt),it=a._dem.get(Re-rt,ye-xt,!0);(vt-wt)*(vt-it)>0&&(vt=(wt+it)/2),_C[Ie]=a._dem.set(Re,ye,vt),lp[Ie]=pe}}}}}b&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Sa.now())}setFilter(n){this.filter=n?vv(n):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(n=>this.filter.filter(new Tn(this.id.overscaledZ,{worldview:this.worldview}),n.feature,this.id.canonical)):this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const a of n)Vw(a.node),gC(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(n.toUnwrapped());for(const f of this.getNodesInfo()){const _=f.node.footprint;f.hiddenByReplacement=!!_&&!h.find(y=>y.footprint===_)}}getHeightAtTileCoord(n,a){const h=[],f=[0,0,0],_=j([]);for(const y of this.getNodesInfo()){const b=y.node.meshes[0],E=b.transformedAabb;if(n<E.min[0]||a<E.min[1]||n>E.max[0]||a>E.max[1])continue;if(y.node.hidden===!0)return{height:1/0,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};H(_,y.node.matrix),f[0]=n,f[1]=a,Lt(f,f,_);const A=(f[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*ap|0,M=Math.min(63,(f[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*ap|0)*ap+Math.min(63,A),k=b.heightmap[M];if(!(k<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:k,maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new Dt(n,a),new Dt(n,a),h),h.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function f0(l,n){return l instanceof Df&&!l.isLightConstant&&n}function _J(l,n,a,h,f,_,y,b){let E=(61440&n|(61440&n)>>4)>>8,A=(3840&n|(3840&n)>>4)>>4,M=240&n|(240&n)>>4;a[3]>0&&(E=pr(E,255*a[0],a[3]),A=pr(A,255*a[1],a[3]),M=pr(M,255*a[2],a[3]));const k=E<<8|A,D=M<<8|Math.floor(255*h[3]),B=function(pe){const ye=Ee(pe,0,2);return Math.min(Math.round(.5*ye*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],U=Ee(f[0],0,1),K=Ee(f[1],0,1),te=Ee(f[2],0,1),oe=Ee(f[3],0,1);let de,fe,Y,le;if(U!==K&&y!==_&&K!==U){const pe=y-_;fe=1/(pe*(K-U)),Y=-(_+pe*U)/(pe*(K-U));const ye=Ee(f[4],-1,1);le=Math.pow(10,ye),de=255*te<<8|255*oe}else de=65535,fe=0,Y=1,le=1;if(l.emplaceBack(k,D,B,de,fe,Y,le),b){const pe=b.length;b.clear();for(let ye=0;ye<pe;ye++)b.emplaceBack(k,D,B,de,fe,Y,le)}}function yJ(l,n,a){const h=l.node;let f=0;const _=a&Tg.HasMeshoptCompression;for(const y of h.meshes){if(h.lights&&h.lightMeshIndex===f||!y.featureData)continue;y.featureArray=new Wf,y.featureArray.reserve(y.featureData.length);let b=n;for(const E of y.featureData){const A=_?65535&E:E>>16&65535,M=_?E>>16&65535:65535&E,k=(15&M)<8?15&M:0,D=l.evaluatedRMEA[k],B=l.evaluatedColor[k],U=l.emissionHeightBasedParams[k];let K;if(b&&k===2&&h.lights&&(K=new Wf,K.resize(10*h.lights.length)),_J(y.featureArray,A,B,D,U,y.aabb.min[2],y.aabb.max[2],K),K&&b){b=!1;const te=h.meshes[h.lightMeshIndex];te.featureArray=K,te.featureArray._trim()}}y.featureArray._trim(),f++}}function Qj(l,n,a,h){const f=1<<l.z;n.lat=Ve((h/Nt+l.y)/f),n.lng=Oe((a/Nt+l.x)/f)}function vJ(l,n,a,h){const f=l.getNodesInfo()[n];if(!f||f.hiddenByReplacement||!f.node.meshes)return;let _=Number.MAX_VALUE;const y=f.node,b=a.tile,E=h.calculatePosMatrix(b.tileID.toUnwrapped(),h.worldSize),A=f.evaluatedScale;let M=0;h.elevation&&y.elevation&&(M=y.elevation*h.elevation.exaggeration()),q(E,E,[(y.anchor?y.anchor[0]:0)*(A[0]-1),(y.anchor?y.anchor[1]:0)*(A[1]-1),M]),Z(E,E,A);const k=a.queryGeometry,D=k.isPointQuery()?k.screenBounds:k.screenGeometry,B=function(K){const te=X([],E,K.matrix);X(te,h.expandedFarZProjMatrix,te);for(let oe=0;oe<K.meshes.length;++oe){const de=K.meshes[oe];if(oe===K.lightMeshIndex)continue;const fe=Uj(D,h,te,de.aabb);fe!=null&&(_=Math.min(fe,_))}if(K.children)for(const oe of K.children)B(oe)};if(B(y),_===Number.MAX_VALUE)return;const U=new ce(0,0);return Qj(b.tileID.canonical,U,f.node.anchor[0],f.node.anchor[1]),{intersectionZ:_,position:U,feature:f.feature}}Ht(Gw,"Tiled3dModelBucket",{omit:["layers"]}),Ht(Jj,"Tiled3dModelFeature");const xJ={circle:class extends Bo{constructor(l,n,a,h){super(l,{layout:YL||(YL=new di({"circle-sort-key":new $t(Be.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(Be.layout_circle["circle-elevation-reference"]),visibility:new Tt(Be.layout_circle.visibility)})),paint:JL||(JL=new di({"circle-radius":new $t(Be.paint_circle["circle-radius"]),"circle-color":new $t(Be.paint_circle["circle-color"]),"circle-blur":new $t(Be.paint_circle["circle-blur"]),"circle-opacity":new $t(Be.paint_circle["circle-opacity"]),"circle-translate":new Tt(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $t(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $t(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $t(Be.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(Be.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}createBucket(l){return new ua(l)}queryRadius(l){const n=l;return fg("circle-radius",this,n)+fg("circle-stroke-width",this,n)+rw(this.paint.get("circle-translate"))}queryIntersectsFeature(l,n,a,h,f,_,y,b){const E=KL(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a);return hz(l,h,_,y,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,A)}getProgramIds(){return["circle"]}getDefaultProgramParams(l,n,a){const h=uz(this);return{config:new $h(this,{zoom:n,lut:a}),defines:h,overrideFog:!1}}is3D(l){return!l&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Bo{createBucket(l){return new fz(l)}constructor(l,n,a,h){super(l,{layout:pz||(pz=new di({visibility:new Tt(Be.layout_heatmap.visibility)})),paint:mz||(mz=new di({"heatmap-radius":new $t(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $t(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Tu(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Be.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$v({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(l){return fg("heatmap-radius",this,l)}queryIntersectsFeature(l,n,a,h,f,_,y,b){const E=this.paint.get("heatmap-radius").evaluate(n,a);return hz(l,h,_,y,b,!0,!0,new Dt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(l,n,a){return l==="heatmap"?{config:new $h(this,{zoom:n,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Bo{constructor(l,n,a,h){super(l,{layout:gz||(gz=new di({visibility:new Tt(Be.layout_hillshade.visibility)})),paint:_z||(_z=new di({"hillshade-illumination-direction":new Tt(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Be.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(Be.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(l,n,a){return{overrideFog:!1}}},fill:class extends Bo{constructor(l,n,a,h){super(l,{layout:Rz||(Rz=new di({"fill-sort-key":new $t(Be.layout_fill["fill-sort-key"]),visibility:new Tt(Be.layout_fill.visibility),"fill-elevation-reference":new Tt(Be.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new $t(Be.layout_fill["fill-construct-bridge-guard-rail"])})),paint:kz||(kz=new di({"fill-antialias":new Tt(Be.paint_fill["fill-antialias"]),"fill-opacity":new $t(Be.paint_fill["fill-opacity"]),"fill-color":new $t(Be.paint_fill["fill-color"]),"fill-outline-color":new $t(Be.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new $t(Be.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Tt(Be.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Tt(Be.paint_fill["fill-emissive-strength"]),"fill-z-offset":new $t(Be.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new $t(Be.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new $t(Be.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}getProgramIds(){const l=this.paint.get("fill-pattern"),n=l&&l.constantOr(1),a=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(l,n,a){return{config:new $h(this,{zoom:n,lut:a}),overrideFog:!1}}recalculate(l,n){super.recalculate(l,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new CP(l)}queryRadius(){return rw(this.paint.get("fill-translate"))}queryIntersectsFeature(l,n,a,h,f,_){return!l.queryGeometry.isAboveHorizon&&Oa(XL(l.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),h)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(l){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const n=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return l!=null?n&&!l:n}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Bo{constructor(l,n,a,h){super(l,{layout:iN||(iN=new di({visibility:new Tt(Be["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oN||(oN=new di({"fill-extrusion-opacity":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $t(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $t(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new $t(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $t(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $t(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $t(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new $t(Be["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new $t(Be["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(Be["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new mw(l)}queryRadius(){return rw(this.paint.get("fill-extrusion-translate"))}is3D(l){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(l,n,a,h,f,_,y,b,E){const A=KL(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(n,a),k=this.paint.get("fill-extrusion-base").evaluate(n,a),D=[0,0],B=b&&_.elevation,U=_.elevation?_.elevation.exaggeration():1,K=l.tile.getBucket(this);if(B&&K instanceof mw){const Y=K.centroidVertexArray,le=E+1;le<Y.length&&(D[0]=Y.geta_centroid_pos0(le),D[1]=Y.geta_centroid_pos1(le))}if(D[0]===0&&D[1]===1)return!1;_.projection.name==="globe"&&(h=nN([h],[new Dt(0,0),new Dt(Nt,Nt)],l.tileID.canonical).map(Y=>Y.polygon).flat());const te=B?b:null,[oe,de]=function(Y,le,pe,ye,Re,Ie,ke,je,rt,xt,ft){return Y.projection.name==="globe"?function(vt,wt,it,_t,et,nt,Pt,It,sr,Kt,Ft){const Et=[],Tr=[],Xt=vt.projection.upVectorScale(Ft,vt.center.lat,vt.worldSize).metersToTile,Jt=[0,0,0,1],mr=[0,0,0,1],Or=(Ur,Dr,Vr,mn)=>{Ur[0]=Dr,Ur[1]=Vr,Ur[2]=mn,Ur[3]=1},Ir=rN();it>0&&(it+=Ir),_t+=Ir;for(const Ur of wt){const Dr=[],Vr=[];for(const mn of Ur){const Bn=mn.x+et.x,ge=mn.y+et.y,ve=vt.projection.projectTilePoint(Bn,ge,Ft),ot=vt.projection.upVector(Ft,mn.x,mn.y);let Rt=it,Bt=_t;if(Pt){const jt=hN(Bn,ge,it,_t,Pt,It,sr,Kt);Rt+=jt.base,Bt+=jt.top}it!==0?Or(Jt,ve.x+ot[0]*Xt*Rt,ve.y+ot[1]*Xt*Rt,ve.z+ot[2]*Xt*Rt):Or(Jt,ve.x,ve.y,ve.z),Or(mr,ve.x+ot[0]*Xt*Bt,ve.y+ot[1]*Xt*Bt,ve.z+ot[2]*Xt*Bt),Lt(Jt,Jt,nt),Lt(mr,mr,nt),Dr.push(new np(Jt[0],Jt[1],Jt[2])),Vr.push(new np(mr[0],mr[1],mr[2]))}Et.push(Dr),Tr.push(Vr)}return[Et,Tr]}(Y,le,pe,ye,Re,Ie,ke,je,rt,xt,ft):ke?function(vt,wt,it,_t,et,nt,Pt,It,sr){const Kt=[],Ft=[],Et=[0,0,0,1];for(const Tr of vt){const Xt=[],Jt=[];for(const mr of Tr){const Or=mr.x+_t.x,Ir=mr.y+_t.y,Ur=hN(Or,Ir,wt,it,nt,Pt,It,sr);Et[0]=Or,Et[1]=Ir,Et[2]=Ur.base,Et[3]=1,On(Et,Et,et),Et[3]=Math.max(Et[3],1e-5);const Dr=new np(Et[0]/Et[3],Et[1]/Et[3],Et[2]/Et[3]);Et[0]=Or,Et[1]=Ir,Et[2]=Ur.top,Et[3]=1,On(Et,Et,et),Et[3]=Math.max(Et[3],1e-5);const Vr=new np(Et[0]/Et[3],Et[1]/Et[3],Et[2]/Et[3]);Xt.push(Dr),Jt.push(Vr)}Kt.push(Xt),Ft.push(Jt)}return[Kt,Ft]}(le,pe,ye,Re,Ie,ke,je,rt,xt):function(vt,wt,it,_t,et){const nt=[],Pt=[],It=et[8]*wt,sr=et[9]*wt,Kt=et[10]*wt,Ft=et[11]*wt,Et=et[8]*it,Tr=et[9]*it,Xt=et[10]*it,Jt=et[11]*it;for(const mr of vt){const Or=[],Ir=[];for(const Ur of mr){const Dr=Ur.x+_t.x,Vr=Ur.y+_t.y,mn=et[0]*Dr+et[4]*Vr+et[12],Bn=et[1]*Dr+et[5]*Vr+et[13],ge=et[2]*Dr+et[6]*Vr+et[14],ve=et[3]*Dr+et[7]*Vr+et[15],ot=mn+It,Rt=Bn+sr,Bt=ge+Kt,jt=Math.max(ve+Ft,1e-5),Zt=mn+Et,fr=Bn+Tr,Wr=ge+Xt,qr=Math.max(ve+Jt,1e-5);Or.push(new np(ot/jt,Rt/jt,Bt/jt)),Ir.push(new np(Zt/qr,fr/qr,Wr/qr))}nt.push(Or),Pt.push(Ir)}return[nt,Pt]}(le,pe,ye,Re,Ie)}(_,h,k,M,A,y,te,D,U,_.center.lat,l.tileID.canonical),fe=l.queryGeometry;return function(Y,le,pe){let ye=1/0;Oa(pe,le)&&(ye=uN(pe,le[0]));for(let Re=0;Re<le.length;Re++){const Ie=le[Re],ke=Y[Re];for(let je=0;je<Ie.length-1;je++){const rt=Ie[je],xt=[rt,Ie[je+1],ke[je+1],ke[je],rt];fs(pe,xt)&&(ye=Math.min(ye,uN(pe,xt)))}}return ye!==1/0&&ye}(oe,de,fe.isPointQuery()?fe.screenBounds:fe.screenGeometry)}},building:class extends Bo{constructor(l,n,a,h){super(l,{layout:SN||(SN=new di({visibility:new Tt(Be.layout_building.visibility),"building-roof-shape":new $t(Be.layout_building["building-roof-shape"]),"building-height":new $t(Be.layout_building["building-height"]),"building-base":new $t(Be.layout_building["building-base"])})),paint:TN||(TN=new di({"building-opacity":new Tt(Be.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new Tt(Be.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new Tt(Be.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Tt(Be.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Tt(Be.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Tt(Be.paint_building["building-vertical-scale"]),"building-cast-shadows":new Tt(Be.paint_building["building-cast-shadows"]),"building-color":new $t(Be.paint_building["building-color"]),"building-emissive-strength":new $t(Be.paint_building["building-emissive-strength"]),"building-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new wN(l)}},line:class extends Bo{constructor(l,n,a,h){const f=DN();super(l,f,n,a,h),f.layout&&(this.layout=new Su(f.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Pf,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(l,n){super.recalculate(l,n),this.paint._values["line-floorwidth"]=(()=>{if(t0)return t0;const a=DN();return t0=new _Y(a.paint.properties["line-width"].specification),t0.useIntegerZoom=!0,t0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new $P(l)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(l,n,a){const h=RN(this);return{config:new $h(this,{zoom:n,lut:a}),defines:h,overrideFog:!1}}queryRadius(l){const n=l,a=LN(fg("line-width",this,n),fg("line-gap-width",this,n)),h=fg("line-offset",this,n);return a/2+Math.abs(h)+rw(this.paint.get("line-translate"))}queryIntersectsFeature(l,n,a,h,f,_){if(l.queryGeometry.isAboveHorizon)return!1;const y=XL(l.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,l.pixelToTileUnitsFactor),b=l.pixelToTileUnitsFactor/2*LN(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),E=this.paint.get("line-offset").evaluate(n,a);return E&&(h=function(A,M){const k=[],D=new Dt(0,0);for(let B=0;B<A.length;B++){const U=A[B],K=[];for(let te=0;te<U.length;te++){const oe=U[te],de=U[te+1],fe=te===0?D:oe.sub(U[te-1])._unit()._perp(),Y=te===U.length-1?D:de.sub(oe)._unit()._perp(),le=fe._add(Y)._unit();le._mult(1/(le.x*Y.x+le.y*Y.y)),K.push(le._mult(M)._add(oe))}k.push(K)}return k}(h,E*l.pixelToTileUnitsFactor)),function(A,M,k){for(let D=0;D<M.length;D++){const B=M[D];if(A.length>=3){for(let U=0;U<B.length;U++)if(rl(A,B[U]))return!0}if(Dc(A,B,k))return!0}return!1}(y,h,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(l){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:zw,background:class extends Bo{constructor(l,n,a,h){super(l,{layout:Ej||(Ej=new di({visibility:new Tt(Be.layout_background.visibility)})),paint:Aj||(Aj=new di({"background-pitch-alignment":new Tt(Be.paint_background["background-pitch-alignment"]),"background-color":new Tt(Be.paint_background["background-color"]),"background-pattern":new Tt(Be.paint_background["background-pattern"]),"background-opacity":new Tt(Be.paint_background["background-opacity"]),"background-emissive-strength":new Tt(Be.paint_background["background-emissive-strength"]),"background-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(l,n,a){return{overrideFog:!1}}is3D(l){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Mj,"raster-particle":Nj,sky:class extends Bo{constructor(l,n,a,h){super(l,{layout:Dj||(Dj=new di({visibility:new Tt(Be.layout_sky.visibility)})),paint:Lj||(Lj=new di({"sky-type":new Tt(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new Tu(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(Be.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="sky-gradient"?this._updateColorRamp():l!=="sky-atmosphere-sun"&&l!=="sky-atmosphere-halo-color"&&l!=="sky-atmosphere-color"&&l!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$v({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(l){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=l.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(l,n){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),f=!h,_=l.style.light,y=_.properties.get("position");return f&&_.properties.get("anchor")==="viewport"&&Rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),f?uC(y.azimuthal,90-y.polar,n):uC(h[0],90-h[1],n)}const a=this.paint.get("sky-gradient-center");return uC(a[0],90-a[1],n)}isSky(){return!0}markSkyboxValid(l){this._skyboxInvalidated=!1,this._lightPosition=l.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const l=this.paint.get("sky-type");return l==="atmosphere"?["skyboxCapture","skybox"]:l==="gradient"?["skyboxGradient"]:null}},slot:class extends Bo{constructor(l,n,a,h){super(l,{paint:zj||(zj=new di({}))},n,null)}},model:class extends Bo{constructor(l,n,a,h){super(l,{layout:Wj||(Wj=new di({visibility:new Tt(Be.layout_model.visibility),"model-id":new $t(Be.layout_model["model-id"])})),paint:qj||(qj=new di({"model-opacity":new $t(Be.paint_model["model-opacity"]),"model-rotation":new $t(Be.paint_model["model-rotation"]),"model-scale":new $t(Be.paint_model["model-scale"]),"model-translation":new $t(Be.paint_model["model-translation"]),"model-color":new $t(Be.paint_model["model-color"]),"model-color-mix-intensity":new $t(Be.paint_model["model-color-mix-intensity"]),"model-type":new Tt(Be.paint_model["model-type"]),"model-cast-shadows":new Tt(Be.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(Be.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(Be.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $t(Be.paint_model["model-emissive-strength"]),"model-roughness":new $t(Be.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $t(Be.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(Be.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(Be.paint_model["model-front-cutoff"]),"model-color-use-theme":new $t({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(l){return new pC(l)}getProgramIds(){return["model"]}is3D(l){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(l){return l instanceof Gw?Nt-1:0}queryIntersectsFeature(l,n,a,h,f,_){if(!this.modelManager)return!1;const y=this.modelManager,b=l.tile.getBucket(this);if(!(b&&b instanceof pC))return!1;for(const E in b.instancesPerModel){const A=b.instancesPerModel[E],M=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(A.idToFeaturesIndex.hasOwnProperty(M)){const k=A.features[A.idToFeaturesIndex[M]],D=y.getModel(E,this.scope);if(!D)return!1;let B=G();const U=new ce(0,0),K=b.canonical;let te=Number.MAX_VALUE;for(let oe=0;oe<k.instancedDataCount;++oe){const de=16*(k.instancedDataOffset+oe),fe=A.instancedDataArray.float32,Y=[fe[de+4],fe[de+5],fe[de+6]];Qj(K,U,fe[de],0|fe[de+1]),Zj(B,D,_,U,k.rotation,k.scale,Y,!1,!1,!1),_.projection.name==="globe"&&(B=dC(B,_));const le=X([],_.projMatrix,B),pe=l.queryGeometry,ye=Uj(pe.isPointQuery()?pe.screenBounds:pe.screenGeometry,_,le,D.aabb);ye!=null&&(te=Math.min(ye,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(l,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven()||l!=="model-color"&&l!=="model-color-mix-intensity"&&l!=="model-rotation"&&l!=="model-scale"&&l!=="model-translation"&&l!=="model-emissive-strength")}_isPropertyZoomDependent(l){const n=this._transitionablePaint._values[l];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof Lf}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Bo{constructor(l,n,a,h){super(l,{layout:Dz||(Dz=new di({"clip-layer-types":new Tt(Be.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(Be.layout_clip["clip-layer-scope"])})),paint:Lz||(Lz=new di({}))},n,a,h)}recalculate(l,n){super.recalculate(l,n)}createBucket(l){return new zz(l)}is3D(l){return!0}}},yC=new dn(0,0,0),vC={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},xC={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Hw={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},bJ={PAINT_ORDER_FILL_AND_STROKE:1},p0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},e3={MASK_TYPE_LUMINANCE:1};function wJ(l,n,a){l===1&&n.icons.push(function(h,f){return function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:y}=_;if(y.content_area){const{content_area:b}=y;b.top==null&&(b.top=b.left),b.width==null&&(b.width=_.usvg_tree.width),b.height==null&&(b.height=b.width)}return y.stretch_x&&y.stretch_x.length&&t3(y,"x"),y.stretch_y&&y.stretch_y.length&&t3(y,"y"),_}(h.readFields(SJ,{name:void 0},f))}(a,a.readVarint()+a.pos))}function t3(l,n){const a=[],h=l[`stretch_${n}`];let f=null;for(let _=0;_<h.length;_++)f===null?f=a.length===0?h[0]:a[a.length-1][1]+h[_]:(a.push([f,f+h[_]]),f=null);l[`stretch_${n}_areas`]=a}function SJ(l,n,a){l===1?n.name=a.readString():l===2?n.metadata=function(h,f){return h.readFields(TJ,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},f)}(a,a.readVarint()+a.pos):l===3&&(n.usvg_tree=function(h,f){return h.readFields(PJ,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},f)}(a,a.readVarint()+a.pos),n.data="usvg_tree")}function TJ(l,n,a){l===1?n.stretch_x=a.readPackedVarint():l===2?n.stretch_y=a.readPackedVarint():l===3?n.content_area=function(h,f){return h.readFields(EJ,{left:0},f)}(a,a.readVarint()+a.pos):l===4&&n.variables.push(function(h,f){return h.readFields(AJ,{name:void 0},f)}(a,a.readVarint()+a.pos))}function EJ(l,n,a){l===1?n.left=a.readVarint():l===2?n.width=a.readVarint():l===3?n.top=a.readVarint():l===4&&(n.height=a.readVarint())}function AJ(l,n,a){l===1?n.name=a.readString():l===2&&(n.rgb_color=Zw(a.readVarint()),n.value="rgb_color")}function PJ(l,n,a){l===1?n.width=n.height=a.readVarint():l===2?n.height=a.readVarint():l===3?n.children.push(Ww(a,a.readVarint()+a.pos)):l===4?n.linear_gradients.push(function(h,f){return h.readFields(DJ,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},f)}(a,a.readVarint()+a.pos)):l===5?n.radial_gradients.push(function(h,f){return h.readFields(zJ,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},f)}(a,a.readVarint()+a.pos)):l===7?n.clip_paths.push(function(h,f){return h.readFields(NJ,{children:[]},f)}(a,a.readVarint()+a.pos)):l===8&&n.masks.push(function(h,f){const _=h.readFields(jJ,{left:0,width:20,mask_type:e3.MASK_TYPE_LUMINANCE,children:[]},f);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_}(a,a.readVarint()+a.pos))}function Ww(l,n){return l.readFields(CJ,{},n)}function CJ(l,n,a){l===1?(n.group=function(h,f){return h.readFields(IJ,{opacity:255,children:[]},f)}(a,a.readVarint()+a.pos),n.node="group"):l===2&&(n.path=function(h,f){return h.readFields(MJ,{paint_order:1,commands:[],step:1,diffs:[],rule:vC.PATH_RULE_NON_ZERO},f)}(a,a.readVarint()+a.pos),n.node="path")}function IJ(l,n,a){l===1?n.transform=qw(a,a.readVarint()+a.pos):l===2?n.opacity=a.readVarint():l===5?n.clip_path_idx=a.readVarint():l===6?n.mask_idx=a.readVarint():l===7&&n.children.push(Ww(a,a.readVarint()+a.pos))}function qw(l,n){return l.readFields(OJ,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function OJ(l,n,a){l===1?n.sx=a.readFloat():l===2?n.ky=a.readFloat():l===3?n.kx=a.readFloat():l===4?n.sy=a.readFloat():l===5?n.tx=a.readFloat():l===6&&(n.ty=a.readFloat())}function MJ(l,n,a){l===1?n.fill=function(h,f){return h.readFields(RJ,{rgb_color:yC,paint:"rgb_color",opacity:255},f)}(a,a.readVarint()+a.pos):l===2?n.stroke=function(h,f){return h.readFields(kJ,{rgb_color:yC,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},f)}(a,a.readVarint()+a.pos):l===3?n.paint_order=a.readVarint():l===5?a.readPackedVarint(n.commands):l===6?n.step=a.readFloat():l===7?a.readPackedSVarint(n.diffs):l===8&&(n.rule=a.readVarint())}function RJ(l,n,a){l===1?(n.rgb_color=Zw(a.readVarint()),n.paint="rgb_color"):l===2?(n.linear_gradient_idx=a.readVarint(),n.paint="linear_gradient_idx"):l===3?(n.radial_gradient_idx=a.readVarint(),n.paint="radial_gradient_idx"):l===5&&(n.opacity=a.readVarint())}function Zw(l){return new dn((l>>16&255)/255,(l>>8&255)/255,(255&l)/255,1)}function kJ(l,n,a){l===1?(n.rgb_color=Zw(a.readVarint()),n.paint="rgb_color"):l===2?(n.linear_gradient_idx=a.readVarint(),n.paint="linear_gradient_idx"):l===3?(n.radial_gradient_idx=a.readVarint(),n.paint="radial_gradient_idx"):l===5?a.readPackedFloat(n.dasharray):l===6?n.dashoffset=a.readFloat():l===7?n.miterlimit=a.readFloat():l===8?n.opacity=a.readVarint():l===9?n.width=a.readFloat():l===10?n.linecap=a.readVarint():l===11&&(n.linejoin=a.readVarint())}function DJ(l,n,a){l===1?n.transform=qw(a,a.readVarint()+a.pos):l===2?n.spread_method=a.readVarint():l===3?n.stops.push(r3(a,a.readVarint()+a.pos)):l===4?n.x1=a.readFloat():l===5?n.y1=a.readFloat():l===6?n.x2=a.readFloat():l===7&&(n.y2=a.readFloat())}function r3(l,n){return l.readFields(LJ,{offset:0,opacity:255,rgb_color:yC},n)}function LJ(l,n,a){l===1?n.offset=a.readFloat():l===2?n.opacity=a.readVarint():l===3&&(n.rgb_color=Zw(a.readVarint()))}function zJ(l,n,a){l===1?n.transform=qw(a,a.readVarint()+a.pos):l===2?n.spread_method=a.readVarint():l===3?n.stops.push(r3(a,a.readVarint()+a.pos)):l===4?n.cx=a.readFloat():l===5?n.cy=a.readFloat():l===6?n.r=a.readFloat():l===7?n.fx=a.readFloat():l===8?n.fy=a.readFloat():l===9&&(n.fr=a.readFloat())}function NJ(l,n,a){l===1?n.transform=qw(a,a.readVarint()+a.pos):l===2?n.clip_path_idx=a.readVarint():l===3&&n.children.push(Ww(a,a.readVarint()+a.pos))}function jJ(l,n,a){l===1?n.left=n.top=a.readFloat():l===2?n.width=n.height=a.readFloat():l===3?n.top=a.readFloat():l===4?n.height=a.readFloat():l===5?n.mask_type=a.readVarint():l===6?n.mask_idx=a.readVarint():l===7&&n.children.push(Ww(a,a.readVarint()+a.pos))}class FJ{static calculate(n={},a=[]){const h=new Map,f=new Map;if(Object.keys(n).length===0)return h;a.forEach(_=>{f.set(_.name,_.rgb_color||new dn(0,0,0))});for(const[_,y]of Object.entries(n))f.has(_)?h.set(f.get(_).toString(),y):console.warn(`Ignoring unknown image variable "${_}"`);return h}}function Ag(l,n=255,a){const h=n/255,f=l.toString(),_=a.has(f)?a.get(f).clone():l.clone();return _.a*=h,_.toString()}function m0(l,n){if(!mm()){const a=document.createElement("canvas");return a.width=l,a.height=n,a}return new OffscreenCanvas(l,n)}function BJ(l,n){const a=FJ.calculate(n.params,l.metadata?l.metadata.variables:[]),h=l.usvg_tree,f=h.width,_=h.height,y=n.transform?n.transform:new DOMMatrix,b=Math.max(1,Math.round(f*y.a)),E=Math.max(1,Math.round(_*y.d)),A=new DOMMatrix([b/f,0,0,E/_,0,0]),M=m0(b,E).getContext("2d");return bC(M,A,h,h,a),M.getImageData(0,0,b,E)}function bC(l,n,a,h,f){for(const _ of h.children)n3(l,n,a,_,f)}function n3(l,n,a,h,f){h.group?(l.save(),function(_,y,b,E,A){const M=E.mask_idx!=null?b.masks[E.mask_idx]:null,k=E.clip_path_idx!=null?b.clip_paths[E.clip_path_idx]:null;if(E.transform&&(y=Pg(E.transform).preMultiplySelf(y)),!function(U,K,te){return U.opacity!==255||K||te}(E,k!=null,M!=null))return void bC(_,y,b,E,A);const D=m0(_.canvas.width,_.canvas.height),B=D.getContext("2d");bC(B,y,b,E,A),k&&u3(B,y,b,k),M&&h3(B,y,b,M,A),_.globalAlpha=E.opacity/255,_.drawImage(D,0,0)}(l,n,a,h.group,f),l.restore()):h.path&&(l.save(),function(_,y,b,E,A){_.setTransform(y),E.paint_order===bJ.PAINT_ORDER_FILL_AND_STROKE?(i3(_,b,E,A),s3(_,b,E,A)):(s3(_,b,E,A),i3(_,b,E,A))}(l,n,a,h.path,f),l.restore())}function i3(l,n,a,h){const f=a.fill;if(!f)return;const _=f.opacity/255;switch(l.save(),l.beginPath(),d3(a,l),f.paint){case"rgb_color":l.fillStyle=Ag(f.rgb_color,f.opacity,h);break;case"linear_gradient_idx":{const y=n.linear_gradients[f.linear_gradient_idx];y.transform&&l.setTransform(Pg(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=a3(l,y,_,h);break}case"radial_gradient_idx":{const y=n.radial_gradients[f.radial_gradient_idx];y.transform&&l.setTransform(Pg(y.transform).preMultiplySelf(l.getTransform())),l.fillStyle=l3(l,y,_,h)}}l.fill(o3(a)),l.restore()}function o3(l){return l.rule===vC.PATH_RULE_NON_ZERO?"nonzero":l.rule===vC.PATH_RULE_EVEN_ODD?"evenodd":void 0}function s3(l,n,a,h){const f=a.stroke;if(!f)return;const _=f3(a);l.lineWidth=f.width,l.miterLimit=f.miterlimit,l.setLineDash(f.dasharray),l.lineDashOffset=f.dashoffset;const y=f.opacity/255;switch(f.paint){case"rgb_color":l.strokeStyle=Ag(f.rgb_color,f.opacity,h);break;case"linear_gradient_idx":l.strokeStyle=a3(l,n.linear_gradients[f.linear_gradient_idx],y,h,!0);break;case"radial_gradient_idx":l.strokeStyle=l3(l,n.radial_gradients[f.radial_gradient_idx],y,h,!0)}switch(f.linejoin){case Hw.LINE_JOIN_MITER_CLIP:case Hw.LINE_JOIN_MITER:l.lineJoin="miter";break;case Hw.LINE_JOIN_ROUND:l.lineJoin="round";break;case Hw.LINE_JOIN_BEVEL:l.lineJoin="bevel"}switch(f.linecap){case xC.LINE_CAP_BUTT:l.lineCap="butt";break;case xC.LINE_CAP_ROUND:l.lineCap="round";break;case xC.LINE_CAP_SQUARE:l.lineCap="square"}l.stroke(_)}function a3(l,n,a,h,f=!1){if(n.stops.length===1){const D=n.stops[0];return Ag(D.rgb_color,D.opacity*a,h)}const{x1:_,y1:y,x2:b,y2:E}=n;let A=new DOMPoint(_,y),M=new DOMPoint(b,E);if(f){const D=Pg(n.transform);A=D.transformPoint(A),M=D.transformPoint(M)}const k=l.createLinearGradient(A.x,A.y,M.x,M.y);for(const D of n.stops)k.addColorStop(D.offset,Ag(D.rgb_color,D.opacity*a,h));return k}function l3(l,n,a,h,f=!1){if(n.stops.length===1){const oe=n.stops[0];return Ag(oe.rgb_color,oe.opacity*a,h)}const _=Pg(n.transform),{fx:y,fy:b,fr:E,cx:A,cy:M,r:k}=n;let D=new DOMPoint(y,b),B=new DOMPoint(A,M),U=E,K=k;if(f){D=_.transformPoint(D),B=_.transformPoint(B);const oe=(_.a+_.d)/2;U=E*oe,K=n.r*oe}const te=l.createRadialGradient(D.x,D.y,U,B.x,B.y,K);for(const oe of n.stops)te.addColorStop(oe.offset,Ag(oe.rgb_color,oe.opacity*a,h));return te}function c3(l,n,a,h){const f=h.transform?Pg(h.transform).preMultiplySelf(n):n,_=m0(l.canvas.width,l.canvas.height),y=_.getContext("2d");for(const E of h.children)if(E.group)c3(y,f,a,E.group);else if(E.path){const A=E.path,M=new Path2D;M.addPath(f3(A),f),y.fill(M,o3(A))}const b=h.clip_path_idx!=null?a.clip_paths[h.clip_path_idx]:null;b&&u3(y,f,a,b),l.globalCompositeOperation="source-over",l.drawImage(_,0,0)}function u3(l,n,a,h){const f=m0(l.canvas.width,l.canvas.height);c3(f.getContext("2d"),n,a,h),l.globalCompositeOperation="destination-in",l.drawImage(f,0,0)}function h3(l,n,a,h,f){if(h.children.length===0)return;const _=h.mask_idx!=null?a.masks[h.mask_idx]:null;_&&h3(l,n,a,_,f);const y=l.canvas.width,b=l.canvas.height,E=m0(y,b),A=E.getContext("2d"),M=h.width,k=h.height,D=h.left,B=h.top,U=new Path2D,K=new Path2D;K.rect(D,B,M,k),U.addPath(K,n),A.clip(U);for(const de of h.children)n3(A,n,a,de,f);const te=A.getImageData(0,0,y,b),oe=te.data;if(h.mask_type===e3.MASK_TYPE_LUMINANCE)for(let de=0;de<oe.length;de+=4)oe[de+3]=oe[de+3]/255*(.2126*oe[de]+.7152*oe[de+1]+.0722*oe[de+2]);A.putImageData(te,0,0),l.globalCompositeOperation="destination-in",l.drawImage(E,0,0)}function Pg(l){return l?new DOMMatrix([l.sx,l.ky,l.kx,l.sy,l.tx,l.ty]):new DOMMatrix}function d3(l,n){const a=l.step;let h=l.diffs[0]*a,f=l.diffs[1]*a;n.moveTo(h,f);for(let _=0,y=2;_<l.commands.length;_++)switch(l.commands[_]){case p0.PATH_COMMAND_MOVE:h+=l.diffs[y++]*a,f+=l.diffs[y++]*a,n.moveTo(h,f);break;case p0.PATH_COMMAND_LINE:h+=l.diffs[y++]*a,f+=l.diffs[y++]*a,n.lineTo(h,f);break;case p0.PATH_COMMAND_QUAD:{const b=h+l.diffs[y++]*a,E=f+l.diffs[y++]*a;h=b+l.diffs[y++]*a,f=E+l.diffs[y++]*a,n.quadraticCurveTo(b,E,h,f);break}case p0.PATH_COMMAND_CUBIC:{const b=h+l.diffs[y++]*a,E=f+l.diffs[y++]*a,A=b+l.diffs[y++]*a,M=E+l.diffs[y++]*a;h=A+l.diffs[y++]*a,f=M+l.diffs[y++]*a,n.bezierCurveTo(b,E,A,M,h,f);break}case p0.PATH_COMMAND_CLOSE:n.closePath()}return n}function f3(l){return d3(l,new Path2D)}class Xw{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const a=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,a),a}put(n,a){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,a)}delete(n){this.cache.delete(n)}}Ht(Xw,"LRUCache");class wC{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new Oo(n,n.data)}getFromCache(n,a,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new Xw(150)),this.cacheMap.get(h).get(Eu(n.toString(),a))}setInCache(n,a,h,f){this.cacheDependenciesMap.has(f)||this.cacheDependenciesMap.set(f,new Map),this.cacheMap.has(f)||this.cacheMap.set(f,new Xw(150));const _=this.cacheDependenciesMap.get(f),y=Eu(n.id.toString(),h);_.get(y)||_.set(y,new Set);const b=this.cacheMap.get(f),E=n.toString();_.get(y).add(E),b.put(Eu(n.toString(),h),a)}removeImagesFromCacheByIds(n,a,h=0){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const f=this.cacheMap.get(h),_=this.cacheDependenciesMap.get(h);for(const y of n){const b=Eu(y.toString(),a);if(_.has(b)){for(const E of _.get(b))f.delete(E);_.delete(b)}}}rasterize(n,a,h,f,_=BJ){const y=this.getFromCache(n,h,f);if(y)return y.clone();const b=_(a.icon,n.options),E=wC._getImage(b);return this.setInCache(n,E,h,f),E.clone()}}class p3{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,a){const h=this.toIdx(n,a);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(n,a){return this.leaves[this.toIdx(n,a)]}toIdx(n,a){return a*this.size+n}}function m3(l,n,a,h){let f=0,_=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(h[y])<1e-15){if(a[y]<l[y]||a[y]>n[y])return null}else{const b=1/h[y];let E=(l[y]-a[y])*b,A=(n[y]-a[y])*b;if(E>A){const M=E;E=A,A=M}if(E>f&&(f=E),A<_&&(_=A),f>_)return null}return f}function g3(l,n,a,h,f,_,y,b,E,A,M){const k=h-l,D=f-n,B=_-a,U=y-l,K=b-n,te=E-a,oe=M[1]*te-M[2]*K,de=M[2]*U-M[0]*te,fe=M[0]*K-M[1]*U,Y=k*oe+D*de+B*fe;if(Math.abs(Y)<1e-15)return null;const le=1/Y,pe=A[0]-l,ye=A[1]-n,Re=A[2]-a,Ie=(pe*oe+ye*de+Re*fe)*le;if(Ie<0||Ie>1)return null;const ke=ye*B-Re*D,je=Re*k-pe*B,rt=pe*D-ye*k,xt=(M[0]*ke+M[1]*je+M[2]*rt)*le;return xt<0||Ie+xt>1?null:(U*ke+K*je+te*rt)*le}function _3(l,n,a){return(l-n)/(a-n)}function y3(l,n,a,h,f,_,y,b,E){const A=1<<a,M=_-h,k=y-f,D=(l+1)/A*M+h,B=(n+0)/A*k+f,U=(n+1)/A*k+f;b[0]=(l+0)/A*M+h,b[1]=B,E[0]=D,E[1]=U}class v3{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(_){const y=Math.ceil(Math.log2(_.dim/8)),b=[];let E=Math.ceil(Math.pow(2,y));const A=1/E,M=(B,U,K,te,oe)=>{const de=te?1:0,fe=(B+1)*K-de,Y=U*K,le=(U+1)*K-de;oe[0]=B*K,oe[1]=Y,oe[2]=fe,oe[3]=le};let k=new p3(E);const D=[];for(let B=0;B<E*E;B++){M(B%E,Math.floor(B/E),A,!1,D);const U=Kh(D[0],D[1],_),K=Kh(D[2],D[1],_),te=Kh(D[2],D[3],_),oe=Kh(D[0],D[3],_);k.minimums.push(Math.min(U,K,te,oe)),k.maximums.push(Math.max(U,K,te,oe)),k.leaves.push(1)}for(b.push(k),E/=2;E>=1;E/=2){const B=b[b.length-1];k=new p3(E);for(let U=0;U<E*E;U++){M(U%E,Math.floor(U/E),2,!0,D);const K=B.getElevation(D[0],D[1]),te=B.getElevation(D[2],D[1]),oe=B.getElevation(D[2],D[3]),de=B.getElevation(D[0],D[3]),fe=B.isLeaf(D[0],D[1]),Y=B.isLeaf(D[2],D[1]),le=B.isLeaf(D[2],D[3]),pe=B.isLeaf(D[0],D[3]),ye=Math.min(K.min,te.min,oe.min,de.min),Re=Math.max(K.max,te.max,oe.max,de.max),Ie=fe&&Y&&le&&pe;k.maximums.push(Re),k.minimums.push(ye),k.leaves.push(Re-ye<=5&&Ie?1:0)}b.push(k)}return b}(this.dem),h=a.length-1,f=a[h];this._addNode(f.minimums[0],f.maximums[0],f.leaves[0]),this._construct(a,0,0,h,0)}raycastRoot(n,a,h,f,_,y,b=1){return m3([n,a,-100],[h,f,this.maximums[0]*b],_,y)}raycast(n,a,h,f,_,y,b=1){if(!this.nodeCount)return null;const E=this.raycastRoot(n,a,h,f,_,y,b);if(E==null)return null;const A=[],M=[],k=[],D=[],B=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:U,t:K,nodex:te,nodey:oe,depth:de}=B.pop();if(this.leaves[U]){y3(te,oe,de,n,a,h,f,k,D);const Y=1<<de,le=(te+0)/Y,pe=(te+1)/Y,ye=(oe+0)/Y,Re=(oe+1)/Y,Ie=Kh(le,ye,this.dem)*b,ke=Kh(pe,ye,this.dem)*b,je=Kh(pe,Re,this.dem)*b,rt=Kh(le,Re,this.dem)*b,xt=g3(k[0],k[1],Ie,D[0],k[1],ke,D[0],D[1],je,_,y),ft=g3(D[0],D[1],je,k[0],D[1],rt,k[0],k[1],Ie,_,y),vt=Math.min(xt!==null?xt:Number.MAX_VALUE,ft!==null?ft:Number.MAX_VALUE);if(vt!==Number.MAX_VALUE)return vt;{const wt=At([],_,y,K);if(x3(Ie,ke,rt,je,_3(wt[0],k[0],D[0]),_3(wt[1],k[1],D[1]))>=wt[2])return K}continue}let fe=0;for(let Y=0;Y<this._siblingOffset.length;Y++){y3((te<<1)+this._siblingOffset[Y][0],(oe<<1)+this._siblingOffset[Y][1],de+1,n,a,h,f,k,D),k[2]=-100,D[2]=this.maximums[this.childOffsets[U]+Y]*b;const le=m3(k,D,_,y);if(le!=null){const pe=le;A[Y]=pe;let ye=!1;for(let Re=0;Re<fe&&!ye;Re++)pe>=A[M[Re]]&&(M.splice(Re,0,Y),ye=!0);ye||(M[fe]=Y),fe++}}for(let Y=0;Y<fe;Y++){const le=M[Y];B.push({idx:this.childOffsets[U]+le,t:A[le],nodex:(te<<1)+this._siblingOffset[le][0],nodey:(oe<<1)+this._siblingOffset[le][1],depth:de+1})}}return null}_addNode(n,a,h){return this.minimums.push(n),this.maximums.push(a),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(n,a,h,f,_){if(n[f].isLeaf(a,h)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const y=f-1,b=n[y];let E=0,A=0;for(let M=0;M<this._siblingOffset.length;M++){const k=2*a+this._siblingOffset[M][0],D=2*h+this._siblingOffset[M][1],B=b.getElevation(k,D),U=b.isLeaf(k,D),K=this._addNode(B.min,B.max,U);U&&(E|=1<<M),A||(A=K)}for(let M=0;M<this._siblingOffset.length;M++)E&1<<M||this._construct(n,2*a+this._siblingOffset[M][0],2*h+this._siblingOffset[M][1],y,A+M)}}function x3(l,n,a,h,f,_){return pr(pr(l,a,_),pr(n,h,_),f)}function Kh(l,n,a){const h=a.dim,f=Ee(l*h-.5,0,h-1),_=Ee(n*h-.5,0,h-1),y=Math.floor(f),b=Math.floor(_),E=Math.min(y+1,h-1),A=Math.min(b+1,h-1);return x3(a.get(y,b),a.get(E,b),a.get(y,A),a.get(E,A),f-y,_-b)}const $J={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function UJ(l,n,a){return(256*l*256+256*n+a)/10-1e4}function VJ(l,n,a){return 256*l+n+a/256-32768}class Kw{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,a,h,f=!1){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void Rr(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,y=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=f,this._modifiedForSources={},!f){for(let E=0;E<_;E++)y[this._idx(-1,E)]=y[this._idx(0,E)],y[this._idx(_,E)]=y[this._idx(_-1,E)],y[this._idx(E,-1)]=y[this._idx(E,0)],y[this._idx(E,_)]=y[this._idx(E,_-1)];y[this._idx(-1,-1)]=y[this._idx(0,0)],y[this._idx(_,-1)]=y[this._idx(_-1,0)],y[this._idx(-1,_)]=y[this._idx(0,_-1)],y[this._idx(_,_)]=y[this._idx(_-1,_-1)]}const b=h==="terrarium"?VJ:UJ;for(let E=0;E<y.length;++E){const A=4*E;this.floatView[E]=b(this.pixels[A],this.pixels[A+1],this.pixels[A+2])}this._timestamp=Sa.now()}_buildQuadTree(){this._tree=new v3(this)}get(n,a,h=!1){h&&(n=Ee(n,-1,this.dim),a=Ee(a,-1,this.dim));const f=this._idx(n,a);return this.floatView[f]}set(n,a,h){const f=this._idx(n,a),_=this.floatView[f];return this.floatView[f]=h,h-_}static getUnpackVector(n){return $J[n]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}static pack(n,a){const h=[0,0,0,0],f=Kw.getUnpackVector(a);let _=Math.floor((n+f[3])/f[2]);return h[2]=_%256,_=Math.floor(_/256),h[1]=_%256,_=Math.floor(_/256),h[0]=_,h}getPixels(){return new xz({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,a,h){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let f=a*this.dim,_=a*this.dim+this.dim,y=h*this.dim,b=h*this.dim+this.dim;switch(a){case-1:f=_-1;break;case 1:_=f+1}switch(h){case-1:y=b-1;break;case 1:b=y+1}const E=-a*this.dim,A=-h*this.dim;for(let M=y;M<b;M++)for(let k=f;k<_;k++){const D=4*this._idx(k,M),B=4*this._idx(k+E,M+A);this.pixels[D+0]=n.pixels[B+0],this.pixels[D+1]=n.pixels[B+1],this.pixels[D+2]=n.pixels[B+2],this.pixels[D+3]=n.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function GJ(l,n,a){l===1?n.headerLength=a.readFixed32():l===2?n.x=a.readVarint():l===3?n.y=a.readVarint():l===4?n.z=a.readVarint():l===5&&n.layers.push(function(h,f){return h.readFields(XJ,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},f)}(a,a.readVarint()+a.pos))}function HJ(l,n,a){l===1?(n.delta_filter=function(h,f){return h.readFields(WJ,{blockSize:0},f)}(a,a.readVarint()+a.pos),n.filter="delta_filter"):l===2?(a.readVarint(),n.filter="zigzag_filter"):l===3?(a.readVarint(),n.filter="bitshuffle_filter"):l===4&&(a.readVarint(),n.filter="byteshuffle_filter")}function WJ(l,n,a){l===1&&(n.blockSize=a.readVarint())}function qJ(l,n,a){l===1?(a.readVarint(),n.codec="gzip_data"):l===2?(a.readVarint(),n.codec="jpeg_image"):l===3?(a.readVarint(),n.codec="webp_image"):l===4&&(a.readVarint(),n.codec="png_image")}function ZJ(l,n,a){let h=0,f=0;l===1?n.firstByte=a.readFixed64():l===2?n.lastByte=a.readFixed64():l===3?n.filters.push(function(_,y){return _.readFields(HJ,{},y)}(a,a.readVarint()+a.pos)):l===4?n.codec=function(_,y){return _.readFields(qJ,{},y)}(a,a.readVarint()+a.pos):l===5?f=a.readFloat():l===6?h=a.readFloat():l===7?n.bands.push(a.readString()):l===8?n.offset=a.readDouble():l===9&&(n.scale=a.readDouble()),n.offset===0&&(n.offset=f),n.scale===0&&(n.scale=h)}function XJ(l,n,a){l===1?n.version=a.readVarint():l===2?n.name=a.readString():l===3?n.units=a.readString():l===4?n.tileSize=a.readVarint():l===5?n.buffer=a.readVarint():l===6?n.pixelFormat=a.readVarint():l===7&&n.dataIndex.push(function(h,f){return h.readFields(ZJ,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},f)}(a,a.readVarint()+a.pos))}function KJ(l,n,a){if(l===2)(function(h,f,_){h.readFields(YJ,_,f)})(a,a.readVarint()+a.pos,n);else if(l===3)throw new Error("Not implemented")}function YJ(l,n,a){if(l===1){let h=0;const f=a.readVarint()+a.pos;for(;a.pos<f;)n[h++]=a.readVarint()}}function JJ(l,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let a=n[3];for(let h=2;h>=1;h--){const f=h===1?1:0,_=h===2?1:0;for(let y=0;y<n[0];y++){const b=n[1]*y;for(let E=f;E<n[1];E++){const A=n[2]*(E+b);for(let M=_;M<n[2];M++){const k=n[3]*(M+A);for(let D=0;D<n[3];D++){const B=k+D;l[B]+=l[B-a]}}}}a*=n[h]}return l}function QJ(l){for(let n=0,a=l.length;n<a;n++)l[n]=l[n]>>>1^-(1&l[n]);return l}function eQ(l,n){switch(n){case"uint32":return l;case"uint16":for(let a=0;a<l.length;a+=2){const h=l[a],f=l[a+1];l[a]=(240&h)>>4|(61440&h)>>8|(240&f)<<4|61440&f,l[a+1]=15&h|(3840&h)>>4|(15&f)<<8|(3840&f)<<4}return l;case"uint8":for(let a=0;a<l.length;a+=4){const h=l[a],f=l[a+1],_=l[a+2],y=l[a+3];l[a+0]=(192&h)>>6|(192&f)>>4|(192&_)>>2|192&y,l[a+1]=(48&h)>>4|(48&f)>>2|48&_|(48&y)<<2,l[a+2]=(12&h)>>2|12&f|(12&_)<<2|(12&y)<<4,l[a+3]=3&h|(3&f)<<2|(3&_)<<4|(3&y)<<6}return l;default:throw new Error(`Invalid pixel format, "${n}"`)}}Ht(Kw,"DEMData"),Ht(v3,"DemMinMaxQuadTree",{omit:["dem"]});var Ma=Uint8Array,g0=Uint16Array,tQ=Int32Array,b3=new Ma([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),w3=new Ma([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),rQ=new Ma([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),S3=function(l,n){for(var a=new g0(31),h=0;h<31;++h)a[h]=n+=1<<l[h-1];var f=new tQ(a[30]);for(h=1;h<30;++h)for(var _=a[h];_<a[h+1];++_)f[_]=_-a[h]<<5|h;return{b:a,r:f}},T3=S3(b3,2),E3=T3.b,nQ=T3.r;E3[28]=258,nQ[258]=28;for(var iQ=S3(w3,0).b,A3=new g0(32768),Ji=0;Ji<32768;++Ji){var Cg=(43690&Ji)>>1|(21845&Ji)<<1;A3[Ji]=((65280&(Cg=(61680&(Cg=(52428&Cg)>>2|(13107&Cg)<<2))>>4|(3855&Cg)<<4))>>8|(255&Cg)<<8)>>1}var _0=function(l,n,a){for(var h=l.length,f=0,_=new g0(n);f<h;++f)l[f]&&++_[l[f]-1];var y,b=new g0(n);for(f=1;f<n;++f)b[f]=b[f-1]+_[f-1]<<1;y=new g0(1<<n);var E=15-n;for(f=0;f<h;++f)if(l[f])for(var A=f<<4|l[f],M=n-l[f],k=b[l[f]-1]++<<M,D=k|(1<<M)-1;k<=D;++k)y[A3[k]>>E]=A;return y},y0=new Ma(288);for(Ji=0;Ji<144;++Ji)y0[Ji]=8;for(Ji=144;Ji<256;++Ji)y0[Ji]=9;for(Ji=256;Ji<280;++Ji)y0[Ji]=7;for(Ji=280;Ji<288;++Ji)y0[Ji]=8;var P3=new Ma(32);for(Ji=0;Ji<32;++Ji)P3[Ji]=5;var oQ=_0(y0,9),sQ=_0(P3,5),SC=function(l){for(var n=l[0],a=1;a<l.length;++a)l[a]>n&&(n=l[a]);return n},Ul=function(l,n,a){var h=n/8|0;return(l[h]|l[h+1]<<8)>>(7&n)&a},TC=function(l,n){var a=n/8|0;return(l[a]|l[a+1]<<8|l[a+2]<<16)>>(7&n)},aQ=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Vl=function(l,n,a){var h=new Error(n||aQ[l]);if(h.code=l,Error.captureStackTrace&&Error.captureStackTrace(h,Vl),!a)throw h;return h},lQ=new Ma(0),cQ=typeof TextDecoder<"u"&&new TextDecoder;try{cQ.decode(lQ,{stream:!0})}catch{}const uQ={gzip_data:"gzip"};class nl extends Error{constructor(n){super(n),this.name="MRTError"}}const hQ={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},C3={uint32:1,uint16:2,uint8:4},dQ={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let EC;class Yw{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const a=this.layers[n];if(!a)throw new nl(`Layer '${n}' not found`);return a}getHeaderLength(n){const a=new Uint8Array(n),h=new DataView(n);if(a[0]!==13)throw new nl("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(n){const a=new Uint8Array(n),h=this.getHeaderLength(n);if(a.length<h)throw new nl(`Expected header with length >= ${h} but got buffer of length ${a.length}`);const f=function(_,y){return _.readFields(GJ,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new EC(a.subarray(0,h)));if(!isNaN(this.x)&&(this.x!==f.x||this.y!==f.y||this.z!==f.z))throw new nl(`Invalid attempt to parse header ${f.z}/${f.x}/${f.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=f.x,this.y=f.y,this.z=f.z;for(const _ of f.layers)this.layers[_.name]=new I3(_,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const a=[],h=this.getLayer(n.layerName);for(let f of n.blockIndices){const _=h.dataIndex[f],y=_.firstByte-n.firstByte,b=_.lastByte-n.firstByte;if(h._blocksInProgress.has(f))continue;const E={layerName:h.name,firstByte:y,lastByte:b,pixelFormat:h.pixelFormat,blockIndex:f,blockShape:[_.bands.length].concat(h.bandShape),buffer:h.buffer,codec:_.codec.codec,filters:_.filters.map(A=>A.filter)};h._blocksInProgress.add(f),a.push(E)}return new O3(a,()=>{a.forEach(f=>h._blocksInProgress.delete(f.blockIndex))},(f,_)=>{if(a.forEach(y=>h._blocksInProgress.delete(y.blockIndex)),f)throw f;_.forEach(y=>{this.getLayer(y.layerName).processDecodedData(y)})})}}class I3{constructor({version:n,name:a,units:h,tileSize:f,pixelFormat:_,buffer:y,dataIndex:b},E){if(this.version=n,this.version!==1)throw new nl(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=a,this.units=h,this.tileSize=f,this.buffer=y,this.pixelFormat=hQ[_],this.dataIndex=b,this.bandShape=[f+2*y,f+2*y,C3[this.pixelFormat]],this._decodedBlocks=new Xw(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return C3[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const a=n.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,n.data)}getBlockForBand(n){let a=0;switch(typeof n){case"string":for(const[h,f]of this.dataIndex.entries()){for(const[_,y]of f.bands.entries())if(y===n)return{bandIndex:a+_,blockIndex:h,blockBandIndex:_};a+=f.bands.length}break;case"number":for(const[h,f]of this.dataIndex.entries()){if(n>=a&&n<a+f.bands.length)return{bandIndex:n,blockIndex:h,blockBandIndex:n-a};a+=f.bands.length}break;default:throw new nl(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(n){let a=1/0,h=-1/0;const f=[],_=new Set;for(const y of n){const{blockIndex:b}=this.getBlockForBand(y);if(b<0)throw new nl(`Invalid band: ${JSON.stringify(y)}`);const E=this.dataIndex[b];f.includes(b)||f.push(b),_.add(b),a=Math.min(a,E.firstByte),h=Math.max(h,E.lastByte)}if(_.size>this.cacheSize)throw new nl(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:h,blockIndices:f}}hasBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0}hasDataForBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(n){const{blockIndex:a,blockBandIndex:h}=this.getBlockForBand(n);if(a<0)throw new nl(`Band not found: ${JSON.stringify(n)}`);const f=this._decodedBlocks.get(a.toString());if(!f)throw new nl(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[a],y=this.bandShape.reduce((A,M)=>A*M,1),b=h*y,E=f.subarray(b,b+y);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}Yw.setPbf=function(l){EC=l};class O3{constructor(n,a,h){this.tasks=n,this._onCancel=a,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,a){this._finalized||(this._onComplete(n,a),this._finalized=!0)}}function cp(l,n){const a=l.json.bufferViews[n.bufferView],h=yw[n.componentType];return new h(l.buffers[a.buffer],(n.byteOffset||0)+(a.byteOffset||0),n.count*(a.byteStride&&a.byteStride!==e0[n.type]*h.BYTES_PER_ELEMENT?a.byteStride/h.BYTES_PER_ELEMENT:e0[n.type]))}function AC(l,n,a,h){const f=yw[n.componentType],_=function(M){switch(M){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(f),y=l.json.bufferViews[n.bufferView],b=y.byteStride?y.byteStride/f.BYTES_PER_ELEMENT:e0[n.type],E=a.float32,A=E.length/a.capacity;for(let M=0,k=0;M<n.count*b;M+=b,k+=A)for(let D=0;D<A;D++)E[k+D]=h[M+D]*_;a._trim()}function fQ(l,n,a){const h=l.indices,f=l.attributes,_={};_.indexArray=new To;const y=n.json.accessors[h],b=y.count/3;_.indexArray.reserve(b);const E=cp(n,y);for(let D=0;D<b;D++)_.indexArray.emplaceBack(E[3*D],E[3*D+1],E[3*D+2]);_.indexArray._trim(),_.vertexArray=new Qa;const A=n.json.accessors[f.POSITION];_.vertexArray.reserve(A.count);const M=cp(n,A);for(let D=0;D<A.count;D++)_.vertexArray.emplaceBack(M[3*D],M[3*D+1],M[3*D+2]);if(_.vertexArray._trim(),_.aabb=new on(A.min,A.max),_.centroid=function(D,B){const U=[0,0,0],K=D.length;if(K>0){for(let te=0;te<K;te++){const oe=3*D[te];U[0]+=B[oe],U[1]+=B[oe+1],U[2]+=B[oe+2]}U[0]/=K,U[1]/=K,U[2]/=K}return U}(E,M),f.COLOR_0!==void 0){const D=n.json.accessors[f.COLOR_0],B=e0[D.type],U=cp(n,D);_.colorArray=B===3?new Qa:new So,_.colorArray.resize(D.count),AC(n,D,_.colorArray,U)}if(f.NORMAL!==void 0){_.normalArray=new Qa;const D=n.json.accessors[f.NORMAL];_.normalArray.resize(D.count);const B=cp(n,D);AC(n,D,_.normalArray,B)}if(f.TEXCOORD_0!==void 0&&a.length>0){_.texcoordArray=new Au;const D=n.json.accessors[f.TEXCOORD_0];_.texcoordArray.resize(D.count);const B=cp(n,D);AC(n,D,_.texcoordArray,B)}if(f._FEATURE_ID_RGBA4444!==void 0){const D=n.json.accessors[f._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=cp(n,D))}f._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(cp(n,n.json.accessors[f._FEATURE_RGBA4444]).buffer));const k=l.material;return _.material=function(D,B){const{emissiveFactor:U=[0,0,0],alphaMode:K="OPAQUE",alphaCutoff:te=.5,normalTexture:oe,occlusionTexture:de,emissiveTexture:fe,doubleSided:Y}=D,{baseColorFactor:le=[1,1,1,1],metallicFactor:pe=1,roughnessFactor:ye=1,baseColorTexture:Re,metallicRoughnessTexture:Ie}=D.pbrMetallicRoughness||{},ke=de?B[de.index]:void 0;if(de&&de.extensions&&de.extensions.KHR_texture_transform&&ke){const je=de.extensions.KHR_texture_transform;ke.offsetScale=[je.offset[0],je.offset[1],je.scale[0],je.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new dn(...le),metallicFactor:pe,roughnessFactor:ye,baseColorTexture:Re?B[Re.index]:void 0,metallicRoughnessTexture:Ie?B[Ie.index]:void 0},doubleSided:Y,emissiveFactor:new dn(...U),alphaMode:K,alphaCutoff:te,normalTexture:oe?B[oe.index]:void 0,occlusionTexture:ke,emissionTexture:fe?B[fe.index]:void 0,defined:D.defined===void 0}}(k!==void 0?n.json.materials[k]:{defined:!1},a),_}function M3(l,n,a){const{matrix:h,rotation:f,translation:_,scale:y,mesh:b,extras:E,children:A}=l,M={};if(M.matrix=h||function(k,D,B,U){var K=D[0],te=D[1],oe=D[2],de=D[3],fe=K+K,Y=te+te,le=oe+oe,pe=K*fe,ye=K*Y,Re=K*le,Ie=te*Y,ke=te*le,je=oe*le,rt=de*fe,xt=de*Y,ft=de*le,vt=U[0],wt=U[1],it=U[2];return k[0]=(1-(Ie+je))*vt,k[1]=(ye+ft)*vt,k[2]=(Re-xt)*vt,k[3]=0,k[4]=(ye-ft)*wt,k[5]=(1-(pe+je))*wt,k[6]=(ke+rt)*wt,k[7]=0,k[8]=(Re+xt)*it,k[9]=(ke-rt)*it,k[10]=(1-(pe+Ie))*it,k[11]=0,k[12]=B[0],k[13]=B[1],k[14]=B[2],k[15]=1,k}([],f||[0,0,0,1],_||[0,0,0],y||[1,1,1]),b!==void 0){M.meshes=a[b];const k=M.anchor=[0,0];for(const D of M.meshes){const{min:B,max:U}=D.aabb;k[0]+=B[0]+U[0],k[1]+=B[1]+U[1]}k[0]=Math.floor(k[0]/M.meshes.length/2),k[1]=Math.floor(k[1]/M.meshes.length/2)}if(E&&(E.id&&(M.id=E.id),E.lights&&(M.lights=function(k){if(!k.length)return[];const D=function(oe){const de=atob(oe),fe=new Uint8Array(de.length);for(let Y=0;Y<de.length;Y++)fe[Y]=de.codePointAt(Y);return fe}(k),B=[],U=D.length/24,K=new Uint16Array(D.buffer),te=new Float32Array(D.buffer);for(let oe=0;oe<U;oe++){const de=K[2*oe*6]/30,fe=K[2*oe*6+1]/30,Y=K[2*oe*6+10]/100,le=te[6*oe+1],pe=te[6*oe+2],ye=te[6*oe+3],Re=te[6*oe+4],Ie=ye-le,ke=Re-pe,je=Math.hypot(Ie,ke);B.push({pos:[le+.5*Ie,pe+.5*ke,fe],normal:[ke/je,-Ie/je,0],width:je,height:de,depth:Y,points:[le,pe,ye,Re]})}return B}(E.lights))),A){const k=[];for(const D of A)k.push(M3(n.json.nodes[D],n,a));M.children=k}return M}function pQ(l){if(l.vertices.length===0||l.indices.length===0)return null;const n=new IP(l.vertices,l.indices,8,256),[a,h]=[n.min.clone(),n.max.clone()];return{vertices:l.vertices,indices:l.indices,grid:n,min:a,max:h}}function mQ(l){if(!l.extras||!l.extras.ground)return null;const n=l.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const a=n[0];if(!a||!Array.isArray(a)||a.length===0)return null;const h=[];for(const y of a){if(!Array.isArray(y)||y.length!==2)continue;const b=y[0],E=y[1];typeof b=="number"&&typeof E=="number"&&h.push(new Dt(b,E))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let f=0;for(let y=0;y<h.length;y++){const b=h[y],E=h[(y+1)%h.length],A=h[(y+2)%h.length];f+=(b.x-E.x)*(A.y-E.y)-(A.x-E.x)*(b.y-E.y)}f>0&&h.reverse();const _=Uv(h.flatMap(y=>[y.x,y.y]),[]);return _.length===0?null:{vertices:h,indices:_}}function gQ(l,n){const a=[],h=[];let f=0;const _=[];for(const y of l){f=a.length;const b=y.vertexArray.float32,E=y.indexArray.uint16;for(let A=0;A<y.vertexArray.length;A++)_[0]=b[3*A+0],_[1]=b[3*A+1],_[2]=b[3*A+2],Lt(_,_,n),a.push(new Dt(_[0],_[1]));for(let A=0;A<3*y.indexArray.length;A++)h.push(E[A]+f)}if(h.length%3!=0)return null;for(let y=0;y<h.length;y+=3){const b=a[h[y+0]],E=a[h[y+1]],A=a[h[y+2]];(b.x-E.x)*(A.y-E.y)-(A.x-E.x)*(b.y-E.y)>0&&([h[y+1],h[y+2]]=[h[y+2],h[y+1]])}return{vertices:a,indices:h}}function R3(l){const n=function(E,A){const M=[],k=WebGL2RenderingContext;if(E.json.textures)for(const D of E.json.textures){const B={magFilter:k.LINEAR,minFilter:k.NEAREST,wrapS:k.REPEAT,wrapT:k.REPEAT};D.sampler!==void 0&&Object.assign(B,E.json.samplers[D.sampler]),M.push({image:A[D.source],sampler:B,uploaded:!1})}return M}(l,l.images),a=function(E,A){const M=[];for(const k of E.json.meshes){const D=[];for(const B of k.primitives)D.push(fQ(B,E,A));M.push(D)}return M}(l,n),{scenes:h,scene:f,nodes:_}=l.json,y=h?h[f||0].nodes:_,b=[];for(const E of y)b.push(M3(_[E],l,a));return function(E,A,M){const k={},D=new Set;for(let B=0;B<E.length;B++){const U=M[A[B]];if(!U.extras)continue;const K=U.extras["mapbox:footprint:version"],te=U.extras["mapbox:footprint:id"];(K||te)&&D.add(B),K==="1.0.0"&&te&&(k[te]=B)}for(let B=0;B<E.length;B++){if(D.has(B))continue;const U=E[B],K=M[A[B]];if(!K.extras)continue;let te=null;U.id in k&&(te=gQ(E[k[U.id]].meshes,U.matrix)),te||(te=mQ(K)),te&&(U.footprint=pQ(te))}if(D.size>0){const B=Array.from(D.values()).sort((U,K)=>U-K);for(let U=B.length-1;U>=0;U--)E.splice(B[U],1)}}(b,y,l.json.nodes),b}function _Q(l){l.heightmap=new Float32Array(4096),l.heightmap.fill(-1);const n=l.vertexArray.float32,a=l.aabb.min[0]-1,h=l.aabb.min[1]-1,f=ap/(l.aabb.max[0]-a+2),_=ap/(l.aabb.max[1]-h+2);for(let y=0;y<n.length;y+=3){const b=n[y+2],E=(n[y+0]-a)*f|0,A=(n[y+1]-h)*_|0;b>l.heightmap[A*ap+E]&&(l.heightmap[A*ap+E]=b)}}function yQ(l,n){const a={};a.indexArray=new To,a.indexArray.reserve(4*l.length),a.vertexArray=new Qa,a.vertexArray.reserve(10*l.length),a.colorArray=new So,a.vertexArray.reserve(10*l.length);let h=0;for(const y of l){const b=Math.min(10,Math.max(4,1.3*y.height))*n,E=[-y.normal[1],y.normal[0],0],A=Math.min(.29,.1*y.width/y.depth),M=y.width-2*y.depth*n*(A+.01),k=At([],y.pos,E,M/2),D=At([],y.pos,E,-M/2),B=[k[0],k[1],k[2]+y.height],U=[D[0],D[1],D[2]+y.height],K=At([],y.normal,E,A);bt(K,K,b);const te=At([],y.normal,E,-A);bt(te,te,b),mt(K,k,K),mt(te,D,te),k[2]+=.1,D[2]+=.1,a.vertexArray.emplaceBack(K[0],K[1],K[2]),a.vertexArray.emplaceBack(te[0],te[1],te[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(B[0],B[1],B[2]),a.vertexArray.emplaceBack(U[0],U[1],U[2]),a.vertexArray.emplaceBack(k[0],k[1],k[2]),a.vertexArray.emplaceBack(D[0],D[1],D[2]),a.vertexArray.emplaceBack(K[0],K[1],K[2]),a.vertexArray.emplaceBack(te[0],te[1],te[2]);const oe=M/b/2;a.colorArray.emplaceBack(-oe-A,-1,oe,.8),a.colorArray.emplaceBack(oe+A,-1,oe,.8),a.colorArray.emplaceBack(-oe,0,oe,1.3),a.colorArray.emplaceBack(oe,0,oe,1.3),a.colorArray.emplaceBack(oe+A,-.8,oe,.7),a.colorArray.emplaceBack(oe+A,-.8,oe,.7),a.colorArray.emplaceBack(0,0,oe,1.3),a.colorArray.emplaceBack(0,0,oe,1.3),a.colorArray.emplaceBack(oe+A,-1.2,oe,.8),a.colorArray.emplaceBack(oe+A,-1.2,oe,.8),a.indexArray.emplaceBack(6+h,4+h,8+h),a.indexArray.emplaceBack(7+h,9+h,5+h),a.indexArray.emplaceBack(0+h,1+h,2+h),a.indexArray.emplaceBack(1+h,3+h,2+h),h+=10}const f={defined:!0};f.emissiveFactor=dn.black;const _={};return _.baseColorFactor=dn.white,f.pbrMetallicRoughness=_,a.material=f,a.aabb=new on([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}Yw.performDecoding=function(l,n){const a=new Uint8Array(l);return Promise.all(n.tasks.map(h=>{const{layerName:f,firstByte:_,lastByte:y,pixelFormat:b,blockShape:E,blockIndex:A,filters:M,codec:k}=h,D=a.subarray(_,y+1),B=new Uint32Array(E[0]*E[1]*E[2]);let U;if(k!=="gzip_data")throw new nl(`Unhandled codec: ${k}`);return U=function(K,te){if(!globalThis.DecompressionStream&&te==="gzip_data")return Promise.resolve(((Y=function(ye){ye[0]==31&&ye[1]==139&&ye[2]==8||Vl(6,"invalid gzip data");var Re=ye[3],Ie=10;4&Re&&(Ie+=2+(ye[10]|ye[11]<<8));for(var ke=(Re>>3&1)+(Re>>4&1);ke>0;ke-=!ye[Ie++]);return Ie+(2&Re)}(fe=K))+8>fe.length&&Vl(6,"invalid gzip data"),function(ye,Re,Ie,ke){var je=ye.length;if(!je||Re.f&&!Re.l)return Ie||new Ma(0);var rt=!Ie,xt=rt||Re.i!=2,ft=Re.i;rt&&(Ie=new Ma(3*je));var vt,wt,it=function(bi){var Xn=Ie.length;if(bi>Xn){var kn=new Ma(Math.max(2*Xn,bi));kn.set(Ie),Ie=kn}},_t=Re.f||0,et=Re.p||0,nt=Re.b||0,Pt=Re.l,It=Re.d,sr=Re.m,Kt=Re.n,Ft=8*je;do{if(!Pt){_t=Ul(ye,et,1);var Et=Ul(ye,et+1,3);if(et+=3,!Et){var Tr=ye[(ge=4+((et+7)/8|0))-4]|ye[ge-3]<<8,Xt=ge+Tr;if(Xt>je){ft&&Vl(0);break}xt&&it(nt+Tr),Ie.set(ye.subarray(ge,Xt),nt),Re.b=nt+=Tr,Re.p=et=8*Xt,Re.f=_t;continue}if(Et==1)Pt=oQ,It=sQ,sr=9,Kt=5;else if(Et==2){var Jt=Ul(ye,et,31)+257,mr=Ul(ye,et+10,15)+4,Or=Jt+Ul(ye,et+5,31)+1;et+=14;for(var Ir=new Ma(Or),Ur=new Ma(19),Dr=0;Dr<mr;++Dr)Ur[rQ[Dr]]=Ul(ye,et+3*Dr,7);et+=3*mr;var Vr=SC(Ur),mn=(1<<Vr)-1,Bn=_0(Ur,Vr);for(Dr=0;Dr<Or;){var ge,ve=Bn[Ul(ye,et,mn)];if(et+=15&ve,(ge=ve>>4)<16)Ir[Dr++]=ge;else{var ot=0,Rt=0;for(ge==16?(Rt=3+Ul(ye,et,3),et+=2,ot=Ir[Dr-1]):ge==17?(Rt=3+Ul(ye,et,7),et+=3):ge==18&&(Rt=11+Ul(ye,et,127),et+=7);Rt--;)Ir[Dr++]=ot}}var Bt=Ir.subarray(0,Jt),jt=Ir.subarray(Jt);sr=SC(Bt),Kt=SC(jt),Pt=_0(Bt,sr),It=_0(jt,Kt)}else Vl(1);if(et>Ft){ft&&Vl(0);break}}xt&&it(nt+131072);for(var Zt=(1<<sr)-1,fr=(1<<Kt)-1,Wr=et;;Wr=et){var qr=(ot=Pt[TC(ye,et)&Zt])>>4;if((et+=15&ot)>Ft){ft&&Vl(0);break}if(ot||Vl(2),qr<256)Ie[nt++]=qr;else{if(qr==256){Wr=et,Pt=null;break}var Lr=qr-254;qr>264&&(Lr=Ul(ye,et,(1<<(Zr=b3[Dr=qr-257]))-1)+E3[Dr],et+=Zr);var vn=It[TC(ye,et)&fr],Rn=vn>>4;if(vn||Vl(3),et+=15&vn,jt=iQ[Rn],Rn>3){var Zr=w3[Rn];jt+=TC(ye,et)&(1<<Zr)-1,et+=Zr}if(et>Ft){ft&&Vl(0);break}xt&&it(nt+131072);var ci=nt+Lr;if(nt<jt){var $n=0-jt,gn=Math.min(jt,ci);for($n+nt<0&&Vl(3);nt<gn;++nt)Ie[nt]=(void 0)[$n+nt]}for(;nt<ci;++nt)Ie[nt]=Ie[nt-jt]}}Re.l=Pt,Re.p=Wr,Re.b=nt,Re.f=_t,Pt&&(_t=1,Re.m=sr,Re.d=It,Re.n=Kt)}while(!_t);return nt!=Ie.length&&rt?(vt=Ie,((wt=nt)==null||wt>vt.length)&&(wt=vt.length),new Ma(vt.subarray(0,wt))):Ie.subarray(0,nt)}(fe.subarray(Y,-8),{i:2},new Ma(((oe=fe)[(de=oe.length)-4]|oe[de-3]<<8|oe[de-2]<<16|oe[de-1]<<24)>>>0))));var oe,de,fe,Y;const le=uQ[te];if(!le)throw new Error(`Unhandled codec: ${te}`);const pe=new globalThis.DecompressionStream(le);return new Response(new Blob([K]).stream().pipeThrough(pe)).arrayBuffer().then(ye=>new Uint8Array(ye))}(D,k).then(K=>(function(te,oe){te.readFields(KJ,oe)}(new EC(K),B),new dQ[b](B.buffer))),U.then(K=>{for(let te=M.length-1;te>=0;te--)switch(M[te]){case"delta_filter":JJ(K,E);break;case"zigzag_filter":QJ(K);break;case"bitshuffle_filter":eQ(K,b);break;default:throw new nl(`Unhandled filter "${M[te]}"`)}return{layerName:f,blockIndex:A,data:K}}).catch(K=>{throw K})}))},Ht(O3,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ht(Yw,"MapboxRasterTile"),Ht(I3,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class k3{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const h=n[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const vQ=["id","tile","layer","source","sourceLayer","state"];class Ig{constructor(n,a,h,f,_){this.type="Feature",this._vectorTileFeature=n,this._z=a,this._x=h,this._y=f,this.properties=n.properties,this.id=_}clone(){const n=new Ig(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state=Object.assign({},this.state)),this.layer&&(n.layer=Object.assign({},this.layer)),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of vQ)this[a]!==void 0&&(n[a]=this[a]);return n}}class D3{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new kl(Nt,16,0),this.featureIndexArray=new Xb,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,a,h,f,_,y=0,b=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,f,_,y);const A=this.grid;for(let M=0;M<a.length;M++){const k=a[M],D=[1/0,1/0,-1/0,-1/0];for(let B=0;B<k.length;B++){const U=k[B];D[0]=Math.min(D[0],U.x),D[1]=Math.min(D[1],U.y),D[2]=Math.max(D[2],U.x),D[3]=Math.max(D[3],U.y)}b!==0&&(D[0]-=b,D[1]-=b,D[2]+=b,D[3]+=b),D[0]<Nt&&D[1]<Nt&&D[2]>=0&&D[3]>=0&&A.insert(E,D[0],D[1],D[2],D[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zr.VectorTile(new xw(this.rawTileData)).layers,this.sourceLayerCoder=new k3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,a){const{tilespaceGeometry:h,transform:f,tileTransform:_,pixelPosMatrix:y,availableImages:b,worldview:E}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const A=h.bufferedTilespaceBounds,M=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(U,K,te,oe)=>Vh(h.bufferedTilespaceGeometry,U,K,te,oe));M.sort(xQ);let k=null;f.elevation&&M.length>0&&(k=Eg.create(f.elevation,this.tileID));const D={};let B;for(let U=0;U<M.length;U++){const K=M[U];if(K===B)continue;B=K;const te=this.featureIndexArray.get(K);let oe=null;this.is3DTile?this.loadMatchingModelFeature(D,te,n,h,f,E):this.loadMatchingFeature(D,te,n,b,E,(de,fe,Y,le=0)=>(oe||(oe=qt(de,this.tileID.canonical,_)),fe.queryIntersectsFeature(h,de,Y,oe,this.z,f,y,k,le)))}return D}loadMatchingFeature(n,a,h,f,_,y){const{featureIndex:b,bucketIndex:E,sourceLayerIndex:A,layoutVertexArrayOffset:M}=a,k=this.bucketLayerIDs[E],D=h.layers,B=Object.keys(D);if(B.length&&!Pr(B,k))return;const U=h.sourceCache,K=this.sourceLayerCoder.decode(A),te=this.vtLayers[K].feature(b),oe=this.getId(te,K);for(let de=0;de<k.length;de++){const fe=k[de];if(!D[fe])continue;const{styleLayer:Y,targets:le}=D[fe];let pe={};oe!==void 0&&(pe=U.getFeatureState(Y.sourceLayer,oe));const ye=!y||y(te,Y,pe,M);if(!ye)continue;const Re=new Ig(te,this.z,this.x,this.y,oe);Re.tile=this.tileID.canonical,Re.state=pe;let Ie=this.serializedLayersCache.get(fe);Ie||(Ie=Y.serialize(),Ie.id=fe,this.serializedLayersCache.set(fe,Ie)),Re.source=Ie.source,Re.sourceLayer=Ie["source-layer"],Re.layer=Xe({},Ie),Re.layer.paint=L3(Ie.paint,Y.paint,te,pe,f),Re.layer.layout=L3(Ie.layout,Y.layout,te,pe,f);let ke=!1;for(const je of le){this.updateFeatureProperties(Re,je);const{filter:rt}=je;if(rt){if(te.properties=Re.properties,rt.needGeometry){const xt=Vt(te,!0);if(!rt.filter(new Tn(this.tileID.overscaledZ,{worldview:_}),xt,this.tileID.canonical))continue}else if(!rt.filter(new Tn(this.tileID.overscaledZ,{worldview:_}),te))continue}ke=!0,je.targetId&&this.addFeatureVariant(Re,je)}ke&&this.appendToResult(n,fe,b,Re,ye)}}loadMatchingModelFeature(n,a,h,f,_,y){const{featureIndex:b,bucketIndex:E}=a,A=this.bucketLayerIDs[E],M=h.layers,k=Object.keys(M);if(!k.length||Pr(k,A))for(let D=0;D<A.length;D++){const B=A[D],{styleLayer:U,targets:K}=M[B];if(U.type!=="model")continue;const te=f.tile,oe=te.getBucket(U);if(!(oe&&oe instanceof Gw))continue;const de=vJ(oe,b,f,_);if(!de)continue;const{z:fe,x:Y,y:le}=te.tileID.canonical,{feature:pe,intersectionZ:ye,position:Re}=de;let Ie={};pe.id!==void 0&&(Ie=h.sourceCache.getFeatureState(U.sourceLayer,pe.id));const ke=new Ig({},fe,Y,le,pe.id);ke.tile=this.tileID.canonical,ke.state=Ie,ke.properties=pe.properties,ke.geometry={type:"Point",coordinates:[Re.lng,Re.lat]};let je=this.serializedLayersCache.get(B);je||(je=U.serialize(),je.id=B,this.serializedLayersCache.set(B,je)),ke.source=je.source,ke.sourceLayer=je["source-layer"],ke.layer=Xe({},je);let rt=!1;for(const xt of K){this.updateFeatureProperties(ke,xt);const{filter:ft}=xt;if(ft){if(pe.properties=ke.properties,ft.needGeometry){if(!ft.filter(new Tn(this.tileID.overscaledZ,{worldview:y}),pe,this.tileID.canonical))continue}else if(!ft.filter(new Tn(this.tileID.overscaledZ,{worldview:y}),pe))continue}rt=!0,xt.targetId&&this.addFeatureVariant(ke,xt)}rt&&this.appendToResult(n,B,b,ke,ye)}}updateFeatureProperties(n,a,h){if(a.properties){const f={};for(const _ in a.properties){const y=a.properties[_].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,h);y!=null&&(f[_]=y)}n.properties=f}}addFeatureVariant(n,a,h){const f={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(f.properties=n.properties),n.variants=n.variants||{},n.variants[a.targetId]=n.variants[a.targetId]||[],n.variants[a.targetId].push(f)}appendToResult(n,a,h,f,_){let y=n[a];y===void 0&&(y=n[a]=[]),y.push({featureIndex:h,feature:f,intersectionZ:_})}lookupSymbolFeatures(n,a,h,f,_,y){const b={};this.loadVTLayers();for(const E of n)this.loadMatchingFeature(b,{bucketIndex:a,sourceLayerIndex:h,featureIndex:E,layoutVertexArrayOffset:0},f,_,y);return b}loadFeature(n){const{featureIndex:a,sourceLayerIndex:h}=n;this.loadVTLayers();const f=this.sourceLayerCoder.decode(h),_=this.vtFeatures[f];if(_[a])return _[a];const y=this.vtLayers[f].feature(a);return _[a]=y,y}hasLayer(n){for(const a of this.bucketLayerIDs)for(const h of a)if(n===h)return!0;return!1}getId(n,a){let h=n.id;if(this.promoteId){const f=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(f!=null)if(Array.isArray(f)){if(!this.promoteIdExpression){const _=Rl(f);if(_.result!=="success"){const y=_.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void Rr(`Failed to create expression for promoteId: ${y}`)}this.promoteIdExpression=_.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new wf),h=this.promoteIdExpression.evaluate({zoom:0},n)}else h=n.properties[f];typeof h=="boolean"&&(h=Number(h))}return h}}function L3(l,n,a,h,f){return er(l,(_,y)=>{const b=n instanceof Su?n.get(y):null;return b&&b.evaluate?b.evaluate(a,h,void 0,f):b})}function xQ(l,n){return n-l}Ht(D3,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const z3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class PC{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=h>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const _=z3[15&h];if(!_)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(n,2,1),[b]=new Uint32Array(n,4,1);return new PC(b,y,_,n)}constructor(n,a=64,h=Float64Array,f){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const _=z3.indexOf(this.ArrayType),y=2*n*this.ArrayType.BYTES_PER_ELEMENT,b=n*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-b%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${h}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+E,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+y+b+E),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+b+E,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=n,this.coords[this._pos++]=a,h}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return CC(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:y,nodeSize:b}=this,E=[0,_.length-1,0],A=[];for(;E.length;){const M=E.pop()||0,k=E.pop()||0,D=E.pop()||0;if(k-D<=b){for(let te=D;te<=k;te++){const oe=y[2*te],de=y[2*te+1];oe>=n&&oe<=h&&de>=a&&de<=f&&A.push(_[te])}continue}const B=D+k>>1,U=y[2*B],K=y[2*B+1];U>=n&&U<=h&&K>=a&&K<=f&&A.push(_[B]),(M===0?n<=U:a<=K)&&(E.push(D),E.push(B-1),E.push(1-M)),(M===0?h>=U:f>=K)&&(E.push(B+1),E.push(k),E.push(1-M))}return A}within(n,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:y}=this,b=[0,f.length-1,0],E=[],A=h*h;for(;b.length;){const M=b.pop()||0,k=b.pop()||0,D=b.pop()||0;if(k-D<=y){for(let te=D;te<=k;te++)j3(_[2*te],_[2*te+1],n,a)<=A&&E.push(f[te]);continue}const B=D+k>>1,U=_[2*B],K=_[2*B+1];j3(U,K,n,a)<=A&&E.push(f[B]),(M===0?n-h<=U:a-h<=K)&&(b.push(D),b.push(B-1),b.push(1-M)),(M===0?n+h>=U:a+h>=K)&&(b.push(B+1),b.push(k),b.push(1-M))}return E}}function CC(l,n,a,h,f,_){if(f-h<=a)return;const y=h+f>>1;N3(l,n,y,h,f,_),CC(l,n,a,h,y-1,1-_),CC(l,n,a,y+1,f,1-_)}function N3(l,n,a,h,f,_){for(;f>h;){if(f-h>600){const A=f-h+1,M=a-h+1,k=Math.log(A),D=.5*Math.exp(2*k/3),B=.5*Math.sqrt(k*D*(A-D)/A)*(M-A/2<0?-1:1);N3(l,n,a,Math.max(h,Math.floor(a-M*D/A+B)),Math.min(f,Math.floor(a+(A-M)*D/A+B)),_)}const y=n[2*a+_];let b=h,E=f;for(v0(l,n,h,a),n[2*f+_]>y&&v0(l,n,h,f);b<E;){for(v0(l,n,b,E),b++,E--;n[2*b+_]<y;)b++;for(;n[2*E+_]>y;)E--}n[2*h+_]===y?v0(l,n,h,E):(E++,v0(l,n,E,f)),E<=a&&(h=E+1),a<=E&&(f=E-1)}}function v0(l,n,a,h){IC(l,a,h),IC(n,2*a,2*h),IC(n,2*a+1,2*h+1)}function IC(l,n,a){const h=l[n];l[n]=l[a],l[a]=h}function j3(l,n,a,h){const f=l-a,_=n-h;return f*f+_*_}o.$=mo,o.A=cu,o.B=Ol,o.C=Eu,o.D=gg,o.E=uu,o.F=2,o.G=o0,o.H=rj,o.I=bs,o.J=vc,o.K=class extends Uw{},o.L=du,o.M=Pa,o.N=Rf,o.O=Mf,o.P=Dt,o.Q=fv,o.R=df,o.S=Wm,o.T=cC,o.U=Km,o.V=Uw,o.W=Ib,o.X=Rl,o.Y=km,o.Z=Th,o._=Sh,o.a=function(l){return wo.API_CDN_URL_REGEX.test(l)},o.a$=Qe,o.a0=hu,o.a1=Ym,o.a2=kf,o.a3=dv,o.a4=function(l){const n=l.value;let a=[];if(!n)return a;const h=vc(n);return h!=="string"?(a=a.concat([new Uw(l.key,n,`string expected, "${h}" found`)]),a):(fC(n,!0)||(a=a.concat([new Uw(l.key,n,`invalid url "${n}"`)])),a)},o.a5=Be,o.a6=Lb,o.a7=di,o.a8=Tt,o.a9=class{constructor(l){this.specification=l}possiblyEvaluate(l,n){return Jn(l.expression.evaluate(n))}interpolate(l,n,a){return{x:pr(l.x,n.x,a),y:pr(l.y,n.y,a),z:pr(l.z,n.z,a),azimuthal:pr(l.azimuthal,n.azimuthal,a),polar:pr(l.polar,n.polar,a)}}},o.aA=On,o.aB=S,o.aC=rl,o.aD=Te,o.aE=Ye,o.aF=function(l,n){const a={};for(let h=0;h<n.length;h++){const f=n[h];f in l&&(a[f]=l[f])}return a},o.aG=_e,o.aH=we,o.aI=class{constructor(l){this.entries={},this.scheduler=l}request(l,n,a,h){const f=this.entries[l]=this.entries[l]||{callbacks:[]};if(f.result){const[_,y]=f.result;return this.scheduler?this.scheduler.add(()=>{h(_,y)},n):h(_,y),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=a((_,y)=>{f.result=[_,y];for(const b of f.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,y)},n):b(_,y);setTimeout(()=>delete this.entries[l],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(_=>_!==h),f.callbacks.length||(f.cancel(),delete this.entries[l]))}}},o.aJ=function(l,n,a){const h=JSON.stringify(l.request);return l.data&&(this.deduped.entries[h]={result:[null,l.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:l.isSymbolTile,zoom:l.tileZoom},f=>{const _=ff(l.request,(y,b,E,A)=>{y?f(y):b&&f(null,{vectorTile:a?void 0:new zr.VectorTile(new xw(b)),rawData:b,cacheControl:E,expires:A})});return()=>{_.cancel(),f()}},n)},o.aK=function(l){Ly++,Ly>Pl&&(l.getActor().send("enforceCacheSizeLimit",Ta),Ly=0)},o.aL=function(l){return l<=1?1:Math.pow(2,Math.floor(Math.log(l)/Math.LN2))},o.aM=es,o.aN=Mj,o.aO=Nj,o.aP=Oj,o.aQ=function(l,n){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){n(null,a)};for(let h=0;h<l.length;h++){const f=document.createElement("source");MA(l[h])||(a.crossOrigin="Anonymous"),f.src=l[h],a.appendChild(f)}return{cancel:()=>{}}},o.aR=Nw,o.aS=function(l){return fetch(l).then(n=>n.arrayBuffer()).then(n=>bN(n,0,l))},o.aT=R3,o.aU=class{constructor(l,n,a,h){this.id=l,this.position=n!=null?new ce(n[0],n[1]):new ce(0,0),this.orientation=a??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new on([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(l,n){if(X(l.matrix,n,l.matrix),l.meshes)for(const a of l.meshes){const h=on.applyTransformFast(a.aabb,l.matrix);this.aabb.encapsulate(h)}if(l.children)for(const a of l.children)this._applyTransformations(a,l.matrix)}computeBoundsAndApplyParent(){const l=j([]);for(const n of this.nodes)this._applyTransformations(n,l)}computeModelMatrix(l,n,a,h,f,_,y=!1){Zj(this.matrix,this,l.transform,this.position,n,a,h,f,_,y)}upload(l){if(!this.uploaded){for(const n of this.nodes)mC(n,l);for(const n of this.nodes)Vw(n);this.uploaded=!0}}destroy(){for(const l of this.nodes)gC(l)}},o.aV=Yt,o.aW=a0,o.aX=Oe,o.aY=Ve,o.aZ=kh,o.a_=To,o.aa=Tn,o.ab=Lf,o.ac=Le,o.ad=Lt,o.ae=dt,o.af=ze,o.ag=Su,o.ah=Gh,o.ai=pr,o.aj=Nt,o.ak=bm,o.al=nn,o.am=dn,o.an=class{constructor(l){this.specification=l}possiblyEvaluate(l,n){return function([a,h]){const f=Jn([1,a,h]);return{x:f.x,y:f.y,z:f.z}}(l.expression.evaluate(n))}interpolate(l,n,a){return{x:pr(l.x,n.x,a),y:pr(l.y,n.y,a),z:pr(l.z,n.z,a)}}},o.ao=function(l,n,a=0,h=!0){const f=new Dt(a,a),_=l.sub(f),y=n.add(f),b=[_,new Dt(y.x,_.y),y,new Dt(_.x,y.y)];return h&&b.push(_.clone()),b},o.ap=function(l,n){const a=[];for(let h=0;h<l.length;h++){const f=We(h-1,-1,l.length-1),_=We(h+1,-1,l.length-1),y=l[h],b=l[_],E=l[f].sub(y).unit(),A=b.sub(y).unit(),M=A.angleWithSep(E.x,E.y),k=E.add(A).unit().mult(-1*n/Math.sin(M/2));a.push(y.add(k))}return a},o.aq=gj,o.ar=Vh,o.as=function(l,n,a=0){return $e(((n.x-a)*l.scale-l.x)*Nt,(n.y*l.scale-l.y)*Nt,Ge(n.z,n.y))},o.at=Nr,o.au=Ar,o.av=qn,o.aw=CN,o.ax=function(l){let n=1/0,a=1/0,h=-1/0,f=-1/0;for(const _ of l)n=Math.min(n,_.x),a=Math.min(a,_.y),h=Math.max(h,_.x),f=Math.max(f,_.y);return{min:new Dt(n,a),max:new Dt(h,f)}},o.ay=Ee,o.az=X,o.b=function(l){return wo.API_FONTS_REGEX.test(l)},o.b$=function(l,n,a){a*=.5;var h=n[0],f=n[1],_=n[2],y=n[3],b=Math.sin(a),E=Math.cos(a);return l[0]=h*E+f*b,l[1]=f*E-h*b,l[2]=_*E+y*b,l[3]=y*E-_*b,l},o.b0=og,o.b1=Lw,o.b2=function(){zl.isLoading()||zl.isLoaded()||Oh()!=="deferred"||Db()},o.b3=vv,o.b4=Vt,o.b5=Ig,o.b6=sn,o.b7=$P,o.b8=CP,o.b9=qt,o.bA=function(l,n){const{x:a,y:h}=l.point,f=az(a,h,l.worldSize/l._pixelsPerMercatorPixel,0,0);return X(f,f,yP(zc(n)))},o.bB=I,o.bC=function(l){return l[0]=0,l[1]=0,l[2]=0,l},o.bD=function(l,n){return Math.hypot(n[0]-l[0],n[1]-l[1],n[2]-l[2])},o.bE=At,o.bF=nr,o.bG=vr,o.bH=i0,o.bI=Hs,o.bJ=XP,o.bK=function(l,n,a,h,f){const _=5*n+2;l.float32[_+0]=a,l.float32[_+1]=h,l.float32[_+2]=f},o.bL=Dw,o.bM=gw,o.bN=fs,o.bO=go,o.bP=Nz,o.bQ=Vj,o.bR=Uz,o.bS=Vz,o.bT=ZP,o.bU=cj,o.bV=QP,o.bW=PC,o.bX=We,o.bY=bt,o.bZ=Hn,o.b_=Io,o.ba=Nl,o.bb=Hf,o.bc=tz,o.bd=mi,o.be=Uv,o.bf=sC,o.bg=function(l,n){const a=Gh(n.zoom);if(a===0)return zc(l);const h=ow(l),f=_P(h),_=Te(h.getWest())*n.worldSize,y=Te(h.getEast())*n.worldSize,b=we(h.getNorth())*n.worldSize,E=we(h.getSouth())*n.worldSize,A=[_,b,0],M=[y,b,0],k=[_,E,0],D=[y,E,0],B=H([],n.globeMatrix);return Lt(A,A,B),Lt(M,M,B),Lt(k,k,B),Lt(D,D,B),f[0]=Cu(f[0],k,a),f[1]=Cu(f[1],D,a),f[2]=Cu(f[2],M,a),f[3]=Cu(f[3],A,a),on.fromPoints(f)},o.bh=aw,o.bi=H,o.bj=Bv,o.bk=Cu,o.bl=Bf,o.bm=uK,o.bn=me,o.bo=q,o.bp=Yw,o.bq=xw,o.br=ff,o.bs=function(l,n){const a=[];for(const h in l)h in n||a.push(h);return a},o.bt=Ne,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=El,o.bw=function(l){var n=new T(16);return n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=l[3],n[4]=l[4],n[5]=l[5],n[6]=l[6],n[7]=l[7],n[8]=l[8],n[9]=l[9],n[10]=l[10],n[11]=l[11],n[12]=l[12],n[13]=l[13],n[14]=l[14],n[15]=l[15],n},o.bx=j,o.by=he,o.bz=G,o.c=dm,o.c$=_w,o.c0=vs,o.c1=hi,o.c2=function(l,n){return l[0]=-n[0],l[1]=-n[1],l[2]=-n[2],l[3]=n[3],l},o.c3=qe,o.c4=function(l,n,a,h,f){var _,y=1/Math.tan(n/2);return l[0]=y/a,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=y,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[11]=-1,l[12]=0,l[13]=0,l[15]=0,f!=null&&f!==1/0?(l[10]=(f+h)*(_=1/(h-f)),l[14]=2*f*h*_):(l[10]=-1,l[14]=-2*h),l},o.c5=function(l,n,a,h,f,_,y){var b=1/(n-a),E=1/(h-f),A=1/(_-y);return l[0]=-2*b,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=-2*E,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=2*A,l[11]=0,l[12]=(n+a)*b,l[13]=(f+h)*E,l[14]=(y+_)*A,l[15]=1,l},o.c6=Ce,o.c7=function(l,n,a){l[4*n+0]=a[0],l[4*n+1]=a[1],l[4*n+2]=a[2],l[4*n+3]=a[3]},o.c8=cg,o.c9=Xf,o.cA=Bw,o.cB=Ze,o.cC=jj,o.cD=function(l){const n=jj(l,!0);return I([],[n[0],n[1],n[4],n[5]])},o.cE=Z,o.cF=Mn,o.cG=J,o.cH=function(l){const{x:n,y:a}=l.point,{lng:h,lat:f}=l._center;return az(n,a,l.worldSize,h,f)},o.cI=St,o.cJ=Je,o.cK=pg,o.cL=P,o.cM=function(l,n,a){let h=0;for(let f=0;f<2;++f)l[f]>0&&(h+=(l[f]-0)*(l[f]-0)),n[f]<0&&(h+=(0-n[f])*(0-n[f]));return h},o.cN=function(l){return l*l*l*l*l},o.cO=Ae,o.cP=45,o.cQ=ug,o.cR=function(l,n,a){const h=Math.sqrt(l*l+n*n+a*a),f=h>0?Math.acos(a/h)*nf:0;let _=l!==0||n!==0?Math.atan2(-n,-l)*nf+90:0;return _<0&&(_+=360),[h,_,f]},o.cS=$e,o.cT=Jn,o.cU=tt,o.cV=mt,o.cW=on,o.cX=ct,o.cY=function(l){return[Math.pow(l[0],1/2.2),Math.pow(l[1],1/2.2),Math.pow(l[2],1/2.2)]},o.cZ=fC,o.c_=function(l,n){return l.readFields(wJ,{icons:[]},n)},o.ca=ki,o.cb=el,o.cc=Fh,o.cd=ce,o.ce=bj,o.cf=function(){var l=new T(4);return T!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},o.cg=function(l,n,a){var h=n[0],f=n[1],_=n[2],y=n[3],b=Math.sin(a),E=Math.cos(a);return l[0]=h*E+_*b,l[1]=f*E+y*b,l[2]=h*-b+_*E,l[3]=f*-b+y*E,l},o.ch=function(l,n){return l[0]===n[0]&&l[1]===n[1]&&l[2]===n[2]&&l[3]===n[3]},o.ci=Mt,o.cj=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},o.ck=Xo,o.cl=_r,o.cm=ez,o.cn=ei,o.co=Fj,o.cp=ep,o.cq=iz,o.cr=function(l,n,a,h,f,_,y,b,E){if(E.name==="globe")return iz(l,n,new ep(a,h,f),!1);const A=a0({z:a,x:h,y:f},E);return new on([(_+A.x/A.scale)*n,n*(A.y/A.scale),y],[(_+A.x2/A.scale)*n,n*(A.y2/A.scale),b])},o.cs=function(l,n,a){return l[0]=Math.min(n[0],a[0]),l[1]=Math.min(n[1],a[1]),l[2]=Math.min(n[2],a[2]),l[3]=Math.min(n[3],a[3]),l},o.ct=function(l,n,a){return l[0]=Math.max(n[0],a[0]),l[1]=Math.max(n[1],a[1]),l[2]=Math.max(n[2],a[2]),l[3]=Math.max(n[3],a[3]),l},o.cu=function(l){const n=Math.round((l+45+360)%360/90)%4;return se[n]},o.cv=at,o.cw=Ei,o.cx=O,o.cy=function(l){const n=j(new Float64Array(16));X(n,l.pixelMatrix,l.globeMatrix);const a=[0,$,0],h=[0,W,0];return Lt(a,a,n),Lt(h,h,n),[a[0]>0&&a[0]<=l.width&&a[1]>0&&a[1]<=l.height&&!xP(l,new ce(l.center.lat,90)),h[0]>0&&h[0]<=l.width&&h[1]>0&&h[1]<=l.height&&!xP(l,new ce(l.center.lat,-90))]},o.cz=function(l,n){const{scale:a}=l.tileTransform,h=a*Nt/(l.tileSize*Math.pow(2,n.zoom-l.tileID.overscaledZ+l.tileID.canonical.z));return function(f,_,y){var b=_[1],E=_[2],A=_[3],M=y[0],k=y[1];return f[0]=_[0]*M,f[1]=b*M,f[2]=E*k,f[3]=A*k,f}(new Float32Array(4),n.inverseAdjustmentMatrix,[h,h])},o.d=function(l){return wo.API_TILEJSON_REGEX.test(l)},o.d$=Rv,o.d0=bg,o.d1=YP,o.d2=gm,o.d3=wu,o.d4=ia,o.d5=mf,o.d6=Sr,o.d7=function(l){const n=l.indexOf(jf);return n>=0?l.slice(0,n):l},o.d8=function(l){return l.indexOf(jf)>=0},o.d9=function(l){const n=l.lastIndexOf(jf);return n>=0?l.slice(n+1):""},o.dA=sz,o.dB=cs,o.dC=No,o.dD=256,o.dE=function(l,n){const a=[0,0,0];return Lt(a,a,aw(zc(n.canonical))),Lt(a,a,l),a},o.dF=l=>({u_matrix:new Fh(l),u_texsize:new el(l),u_pixels_to_tile_units:new Kf(l),u_device_pixel_ratio:new ki(l),u_width_scale:new ki(l),u_floor_width_scale:new ki(l),u_image:new cg(l),u_units_to_pixels:new el(l),u_tile_units_to_pixels:new ki(l),u_alpha_discard_threshold:new ki(l),u_trim_offset:new el(l),u_trim_fade_range:new el(l),u_trim_color:new ug(l),u_emissive_strength:new ki(l),u_zbias_factor:new ki(l),u_tile_to_meter:new ki(l),u_ground_shadow_factor:new Xf(l),u_pattern_transition:new ki(l)}),o.dG=l=>({u_matrix:new Fh(l),u_pixels_to_tile_units:new Kf(l),u_device_pixel_ratio:new ki(l),u_width_scale:new ki(l),u_floor_width_scale:new ki(l),u_units_to_pixels:new el(l),u_dash_image:new cg(l),u_gradient_image:new cg(l),u_image_height:new ki(l),u_texsize:new el(l),u_tile_units_to_pixels:new ki(l),u_alpha_discard_threshold:new ki(l),u_trim_offset:new el(l),u_trim_fade_range:new el(l),u_trim_color:new ug(l),u_emissive_strength:new ki(l),u_zbias_factor:new ki(l),u_tile_to_meter:new ki(l),u_ground_shadow_factor:new Xf(l)}),o.dH=l=>({u_camera_to_center_distance:new ki(l),u_extrude_scale:new Kf(l),u_device_pixel_ratio:new ki(l),u_matrix:new Fh(l),u_inv_rot_matrix:new Fh(l),u_merc_center:new el(l),u_tile_id:new Xf(l),u_zoom_transition:new ki(l),u_up_dir:new Xf(l),u_emissive_strength:new ki(l)}),o.dI=Pv,o.dJ=AY,o.dK=uz,o.dL=(l,n,a,h,f,_)=>{const y=l.transform,b=y.projection.name==="globe";let E;if(_.paint.get("circle-pitch-alignment")==="map")if(b){const M=sz(y.zoom,n.canonical)*y._pixelsPerMercatorPixel;E=Float32Array.from([M,0,0,M])}else E=y.calculatePixelsToTileUnitsMatrix(a);else E=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:l.transform.getCameraToCenterDistance(y.projection),u_matrix:l.translatePosMatrix(n.projMatrix,a,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Sa.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:mK,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(b){A.u_inv_rot_matrix=h,A.u_merc_center=f,A.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],A.u_zoom_transition=Gh(y.zoom);const M=f[0]*Nt,k=f[1]*Nt;A.u_up_dir=y.projection.upVector(new ep(0,0,0),M,k)}return A},o.dM=RN,o.dN=hs,o.dO=(l,n,a,h,f,_,y,b,E,A)=>{const M=l.transform,k=M.pitch<15?IN(.07,.7,Ee((14-M.zoom)/5,0,1)):.07,D=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:MN(l,n,a,h),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:f,u_width_scale:_,u_floor_width_scale:y,u_image:0,u_tile_units_to_pixels:ON(n,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:k,u_tile_to_meter:tt(n.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:A}},o.dP=(l,n,a,h,f,_,y,b,E,A)=>{const M=l.transform,k=M.calculatePixelsToTileUnitsMatrix(n),D=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=M.pitch<15?IN(.07,.7,Ee((14-M.zoom)/5,0,1)):.07;return{u_matrix:MN(l,n,a,h),u_pixels_to_tile_units:k,u_device_pixel_ratio:_,u_width_scale:y,u_floor_width_scale:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:kN(a)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ON(n,l.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(D?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:tt(n.tileID.canonical,0),u_ground_shadow_factor:A}},o.dQ=kt,o.dR=$v,o.dS=Ge,o.dT=lK,o.dU=mw,o.dV=rN,o.dW=Wh,o.dX=450,o.dY=7,o.dZ=aJ,o.d_=rn,o.da=function(l){const n=[],a=l.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),l.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),l.renderingMode&&l.renderingMode!=="2d"&&l.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},o.db=function(l,n,a,h){return l.type==="custom"?new lJ(l,n):new xJ[l.type](l,n,a,h)},o.dc=xr,o.dd=function(l){const n=l.indexOf(jf);return n>=0?l.slice(n+1):""},o.de=class extends Ig{constructor(l,n){super(l._vectorTileFeature,l._z,l._x,l._y,l.id),l.state&&(this.state=Object.assign({},l.state)),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=l.source,this.sourceLayer=l.sourceLayer,this.layer=l.layer)}toJSON(){const l=super.toJSON();return l.target=this.target,l.namespace=this.namespace,l}},o.df=Xm,o.dg=uh,o.dh=function(l){return l({pluginStatus:Qo,pluginURL:Ll}),Xm.on("pluginStateChange",l),l},o.di=tw,o.dj=class extends jl{constructor(l){super(l),this.current=zv}set(l,n,a){if(this.fetchUniformLocation(l,n)){for(let h=0;h<9;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},o.dk=ue,o.dl=function(l,n,a){const h=Gh(a.zoom),f=l.style.map._antialias,_=l.terrain&&l.terrain.exaggeration()>0;return h===0&&!f&&!_},o.dm=function(l){const n=l.pixelsPerMeter,a=n/Ce(1,l.center.lat),h=j(new Float64Array(16));return q(h,h,[l.point.x,l.point.y,0]),Z(h,h,[a,a,n]),Float32Array.from(h)},o.dn=ow,o.dp=function(l){const n=at-5;l=Ee(l,-80.051129,n)/n*90;const a=Math.pow(Math.abs(Math.sin(nn(l))),3);return Math.round(a*(V.length-1))},o.dq=function(l,n,a,h){const f=n.getNorth(),_=n.getSouth(),y=n.getWest(),b=n.getEast(),E=1<<l.z,A=b-y,M=f-_,k=A/N,D=-M/V[a],B=[0,k,0,D,0,0,f,y,0];if(l.z>0){const U=180/h;F(B,B,[U/A+1,0,0,0,U/M+1,0,-.5*U/k,.5*U/D,1])}return B[2]=E,B[5]=l.x,B[8]=l.y,B},o.dr=zc,o.ds=function(l,n,a){const h=j(new Float64Array(16)),f=(n/(1<<l)-.5)*Math.PI*2;return ne(h,a.globeMatrix,f),Float32Array.from(h)},o.dt=class{isDataAvailableAtPoint(l){const n=this._source();if(this.isUsingMockSource()||!n||l.y<0||l.y>1)return!1;const a=n.getSource().maxzoom,h=1<<a,f=Math.floor(l.x),_=Math.floor((l.x-f)*h),y=Math.floor(l.y*h),b=this.findDEMTileFor(new es(a,f,a,_,y));return!(!b||!b.dem)}getAtPointOrZero(l,n=0){return this.getAtPoint(l,n)||0}getAtPoint(l,n,a=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const h=this._source();if(!h||l.y<0||l.y>1)return n;const f=h.getSource().maxzoom,_=1<<f,y=Math.floor(l.x),b=l.x-y,E=new es(f,y,f,Math.floor(b*_),Math.floor(l.y*_)),A=this.findDEMTileFor(E);if(!A||!A.dem)return n;const M=A.dem,k=1<<A.tileID.canonical.z,D=(b*k-A.tileID.canonical.x)*M.dim,B=(l.y*k-A.tileID.canonical.y)*M.dim,U=Math.floor(D),K=Math.floor(B);return(a?this.exaggeration():1)*pr(pr(M.get(U,K),M.get(U,K+1),B-K),pr(M.get(U+1,K),M.get(U+1,K+1),B-K),D-U)}getAtTileOffset(l,n,a){const h=1<<l.canonical.z;return this.getAtPointOrZero(new Le(l.wrap+(l.canonical.x+n/Nt)/h,(l.canonical.y+a/Nt)/h))}getAtTileOffsetFunc(l,n,a,h){return f=>{const _=this.getAtTileOffset(l,f.x,f.y),y=h.upVector(l.canonical,f.x,f.y);return bt(y,y,_*h.upVectorScale(l.canonical,n,a).metersToTile),y}}getForTilePoints(l,n,a,h){if(this.isUsingMockSource())return!1;const f=Eg.create(this,l,h);return!!f&&(n.forEach(_=>{_[2]=this.exaggeration()*f.getElevationAt(_[0],_[1],a)}),!0)}getMinMaxForTile(l){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(l);if(!n||!n.dem)return null;const a=n.dem.tree,h=n.tileID,f=1<<l.canonical.z-h.canonical.z;let _=l.canonical.x/f-h.canonical.x,y=l.canonical.y/f-h.canonical.y,b=0;for(let E=0;E<l.canonical.z-h.canonical.z&&!a.leaves[b];E++){_*=2,y*=2;const A=2*Math.floor(y)+Math.floor(_);b=a.childOffsets[b]+A,_%=1,y%=1}return{min:this.exaggeration()*a.minimums[b],max:this.exaggeration()*a.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(l,n,a){throw new Error("Pure virtual method called.")}pointCoordinate(l){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(l){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const l=this.visibleDemTiles;if(l.length===0)return null;let n=!1,a=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const f of l){const _=this.getMinMaxForTile(f.tileID);_&&(a=Math.min(a,_.min),h=Math.max(h,_.max),n=!0)}return n?{min:a,max:h}:null}},o.du=xz,o.dv=iw,o.dw=function(l,n){return[Math.pow(l[0],2.2)*n,Math.pow(l[1],2.2)*n,Math.pow(l[2],2.2)*n]},o.dx=C,o.dy=function(l,n){var a=Math.sin(n),h=Math.cos(n);return l[0]=h,l[1]=a,l[2]=0,l[3]=-a,l[4]=h,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},o.dz=ur,o.e=wo,o.e$=k3,o.e0=256,o.e1=yP,o.e2=Qa,o.e3=ne,o.e4=function(l,n){return l[0]=n[0],l[1]=n[1],l[2]=n[2],l[3]=n[4],l[4]=n[5],l[5]=n[6],l[6]=n[8],l[7]=n[9],l[8]=n[10],l},o.e5=Rc,o.e6=Gf,o.e7=Tb,o.e8=function(l,n,a,h,f){return Ee((l-n)/(a-n)*(f-h)+h,h,f)},o.e9=Zo,o.eA=function(l,n,a){return l[0]=n[0]/a[0],l[1]=n[1]/a[1],l[2]=n[2]/a[2],l},o.eB=Yr,o.eC=ee,o.eD=or,o.eE=function(l,n,a,h){return l[0]=n,l[1]=a,l[2]=h,l},o.eF=function([l,n,a]){const h=Math.hypot(l,n,a),f=Math.atan2(l,a),_=.5*Math.PI-Math.acos(-n/h);return new ce(Je(f),Je(_))},o.eG=xo,o.eH=hC,o.eI=function(l){const n=l.navigator?l.navigator.userAgent:null;return!!function(a){if(vi==null){const h=a.navigator?a.navigator.userAgent:null;vi=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return vi}(l)&&!(!n||!(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eJ=function(l,n){Ta=l,Pl=n},o.eK=xP,o.eL=lz,o.eM=function(l){const n=[0,0,0],a=j(new Float64Array(16));return X(a,l.pixelMatrix,l.globeMatrix),Lt(n,n,a),new Dt(n[0],n[1])},o.eN=function(){const l=Jv;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(LP),Jv=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.eO=function(){_w().acquire(LP)},o.eP=Oh,o.eQ=function(l,n,a=!1){if(Qo===Ss.deferred||Qo===Ss.loading||Qo===Ss.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ll=Sa.resolveURL(l),Qo=Ss.deferred,yv=n,Zm(),a||Db()},o.eR=function(l){_g=Sa.resolveURL(l),yg||(yg=new gg(_w(),new uu)),yg.broadcast("setMeshoptUrl",_g)},o.eS=mN,o.eT=function(l){NP=Sa.resolveURL(l),yg||(yg=new gg(_w(),new uu)),yg.broadcast("setDracoUrl",NP)},o.eU=pN,o.eV=Yv,o.eW=function(l){const n=ou();if(!n)return;const a=n.delete(Al);l&&a.then(()=>l()).catch(l)},o.eX=ip,o.eY=Ht,o.eZ=Hh,o.e_=$l,o.ea=function(l,n){var a=n[0],h=n[1],f=n[2],_=n[3],y=n[4],b=n[5],E=n[6],A=n[7],M=n[8],k=M*y-b*A,D=-M*_+b*E,B=A*_-y*E,U=a*k+h*D+f*B;return U?(l[0]=k*(U=1/U),l[1]=(-M*h+f*A)*U,l[2]=(b*h-f*y)*U,l[3]=D*U,l[4]=(M*a-f*E)*U,l[5]=(-b*a+f*_)*U,l[6]=B*U,l[7]=(-A*a+h*E)*U,l[8]=(y*a-h*_)*U,l):null},o.eb=Mr,o.ec=yt,o.ed=dC,o.ee=function(l,n){if(l===n){var a=n[1],h=n[2],f=n[3],_=n[6],y=n[7],b=n[11];l[1]=n[4],l[2]=n[8],l[3]=n[12],l[4]=a,l[6]=n[9],l[7]=n[13],l[8]=h,l[9]=_,l[11]=n[14],l[12]=f,l[13]=y,l[14]=b}else l[0]=n[0],l[1]=n[4],l[2]=n[8],l[3]=n[12],l[4]=n[1],l[5]=n[5],l[6]=n[9],l[7]=n[13],l[8]=n[2],l[9]=n[6],l[10]=n[10],l[11]=n[14],l[12]=n[3],l[13]=n[7],l[14]=n[11],l[15]=n[15];return l},o.ef=He,o.eg=[1,1,1],o.eh=class{constructor(l,n,a,h){this.context=l,this.format=h,this.size=a,this.texture=l.gl.createTexture();const[f,_,y]=this.size,{gl:b}=l;b.bindTexture(b.TEXTURE_3D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,f,_,y,0,aC(this.format),lC(this.format),n.data)}bind(l,n){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_3D,this.texture),l!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,l),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,l),this.minFilter=l),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}},o.ei=Eg,o.ej=function(l,n,a,h){var f=new T(4);return f[0]=l,f[1]=n,f[2]=a,f[3]=h,f},o.ek=en,o.el=function(l,n,a,h){var f=n[0],_=n[1],y=n[2],b=n[3];return l[0]=f+h*(a[0]-f),l[1]=_+h*(a[1]-_),l[2]=y+h*(a[2]-y),l[3]=b+h*(a[3]-b),l},o.em=Tg,o.en=Mc,o.eo=Au,o.ep=function(l,n,a,h,f,_,y,b,E,A,M,k,D,B,U,K){var te=new T(16);return te[0]=l,te[1]=n,te[2]=a,te[3]=h,te[4]=f,te[5]=_,te[6]=y,te[7]=b,te[8]=E,te[9]=A,te[10]=M,te[11]=k,te[12]=D,te[13]=B,te[14]=U,te[15]=K,te},o.eq=ie,o.er=ng,o.es=Ov,o.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Dt(1/0,1/0),max:new Dt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(l,n=!1){const a=Fz(new Dt(0,0),new Dt(Nt,Nt),l),h=[];if(n&&!OP(a,this._globalClipBounds))return h;for(const f of this._activeRegions){if(f.hiddenByOverlap||!OP(a,f))continue;const _=VK(f.min,f.max,l);h.push({min:_.min,max:_.max,sourceId:this._sourceIds[f.priority],footprint:f.footprint,footprintTileId:f.tileId,order:f.order,clipMask:f.clipMask,clipScope:f.clipScope})}return h}setSources(l){this._setSources(l.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const a=[];for(const h of n.cache.getVisibleCoordinates()){const f=n.cache.getTile(h).buckets[n.layer];f&&f.updateFootprints(h.toUnwrapped(),a)}return a},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(l){const n=l.getFootprints();if(n.length===0)return;const a=l.getOrder(),h=l.getClipMask(),f=l.getClipScope();for(const _ of n){if(!_.footprint)continue;const y=Fz(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:y.min,max:y.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:a,clipMask:h,clipScope:f})}this._sourceIds.push(l.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,a)=>n.priority-a.priority||fw(n.min,a.min)||fw(n.max,a.max)||n.order-a.order||n.clipMask-a.clipMask||function(h,f){const _=(y,b)=>y+b;return h.length-f.length||h.reduce(_,"").localeCompare(f.reduce(_,""))}(n.clipScope,a.clipScope));let l=this._activeRegions.length!==this._prevRegions.length;if(!l){let n=0;for(;!l&&n!==this._activeRegions.length;){const a=this._activeRegions[n],h=this._prevRegions[n];l=a.priority!==h.priority||!jz(a,h)||a.order!==h.order||a.clipMask!==h.clipMask||!El(a.clipScope,h.clipScope),++n}}if(l){++this._updateTime;for(const a of this._activeRegions)a.order!==dw&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const n=a=>{const h=this._activeRegions;if(a>=h.length)return a;const f=h[a].priority;for(;a<h.length&&h[a].priority===f;)++a;return a};if(this._sourceIds.length>1){let a=0,h=n(a);for(;a!==h;){let f=a;const _=a;for(;f!==h;){const y=this._activeRegions[f];y.hiddenByOverlap=!1;for(let b=0;b<_;b++){const E=this._activeRegions[b];if(!E.hiddenByOverlap&&y.order===dw&&OP(y,E)&&(y.hiddenByOverlap=$z(y.footprint,y.tileId,E.footprint,E.tileId),y.hiddenByOverlap))break}++f}a=h,h=n(a)}}}}_setSources(l){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=l.length-1;n>=0;n--)this._addSource(l[n]);this._computeReplacement()}},o.eu=dw,o.ev=class{constructor(l){this._createGrid(l),this._createPoles(l)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const l of this._poleSegments)l.destroy();for(const l of this._gridSegments)l.withSkirts.destroy(),l.withoutSkirts.destroy()}_fillGridMeshWithLods(l,n){const a=new Nl,h=new To,f=[],_=l+1+2,y=n[0]+1,b=n[0]+1+(1+n.length),E=(A,M,k)=>{let D=A===_-1?A-2:A===0?A:A-1;return D+=k?24575:0,[D,M]};for(let A=0;A<_;++A)a.emplaceBack(...E(A,0,!0));for(let A=0;A<y;++A)for(let M=0;M<_;++M)a.emplaceBack(...E(M,A,(M===0||M===_-1)&&!0));for(let A=0;A<n.length;++A){const M=n[A];for(let k=0;k<_;++k)a.emplaceBack(...E(k,M,!0))}for(let A=0;A<n.length;++A){const M=h.length,k=n[A]+1+2,D=new To;for(let K=0;K<k-1;K++){const te=K===k-2,oe=te?_*(b-n.length+A-K):_;for(let de=0;de<_-1;de++){const fe=K*_+de;K===0||te||de===0||de===_-2?(D.emplaceBack(fe+1,fe,fe+oe),D.emplaceBack(fe+oe,fe+oe+1,fe+1)):(h.emplaceBack(fe+1,fe,fe+oe),h.emplaceBack(fe+oe,fe+oe+1,fe+1))}}const B=mi.simpleSegment(0,M,a.length,h.length-M);for(let K=0;K<D.uint16.length;K+=3)h.emplaceBack(D.uint16[K],D.uint16[K+1],D.uint16[K+2]);const U=mi.simpleSegment(0,M,a.length,h.length-M);f.push({withoutSkirts:B,withSkirts:U})}return{vertices:a,indices:h,segments:f}}_createGrid(l){const n=this._fillGridMeshWithLods(N,V);this._gridSegments=n.segments,this._gridBuffer=l.createVertexBuffer(n.vertices,tz.members),this._gridIndexBuffer=l.createIndexBuffer(n.indices,!0)}_createPoles(l){const n=new To;for(let y=0;y<=N;y++)n.emplaceBack(0,y+1,y+2);this._poleIndexBuffer=l.createIndexBuffer(n,!0);const a=new Rc,h=new Rc,f=new Rc,_=new Rc;this._poleSegments=[];for(let y=0,b=0;y<P;y++){const E=360/(1<<y);a.emplaceBack(0,-S,0,.5,0),h.emplaceBack(0,-S,0,.5,1),f.emplaceBack(0,-S,0,.5,.5),_.emplaceBack(0,-S,0,.5,.5);for(let A=0;A<=N;A++){let M=A/N,k=0;const D=pr(0,E,M),[B,U,K]=re(fK,pK,D,S);a.emplaceBack(B,U,K,M,k),h.emplaceBack(B,U,K,M,1-k);const te=nn(D);M=.5+.5*Math.sin(te),k=.5+.5*Math.cos(te),f.emplaceBack(B,U,K,M,k),_.emplaceBack(B,U,K,M,1-k)}this._poleSegments.push(mi.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=l.createVertexBuffer(a,nw,!1),this._poleSouthVertexBuffer=l.createVertexBuffer(h,nw,!1),this._texturedPoleNorthVertexBuffer=l.createVertexBuffer(f,nw,!1),this._texturedPoleSouthVertexBuffer=l.createVertexBuffer(_,nw,!1)}getGridBuffers(l,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[l].withSkirts:this._gridSegments[l].withoutSkirts]}getPoleBuffers(l,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[l]]}},o.ew=xe,o.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.ey=Me,o.ez=Fe,o.f=function(l){return btoa(encodeURIComponent(l).replace(/%([0-9A-F]{2})/g,(n,a)=>String.fromCharCode(+("0x"+a))))},o.f0=D3,o.f1=EN,o.f2=Hr,o.f3="hd_road_elevation",o.f4=Gs,o.f5=er,o.f6=rp,o.f7=KP,o.f8=op,o.f9=function(l,n,a,h,f,_,y,b=1,E,A,M){l.createArrays(),l.tilePixelRatio=Nt/(512*l.overscaling),l.compareText={},l.iconsNeedLinear=!1;const k=l.layers[0].layout,D=l.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=b,B.textSizeScaleRange=k.get("text-size-scale-range"),B.iconSizeScaleRange=k.get("icon-size-scale-range");const[U,K]=B.textSizeScaleRange,[te,oe]=B.iconSizeScaleRange;B.textScaleFactor=Ee(B.scaleFactor,U,K),B.iconScaleFactor=Ee(B.scaleFactor,te,oe);const de=D["text-size"],fe=D["icon-size"];if(l.textSizeData.kind==="composite"){const{minZoom:Ie,maxZoom:ke}=l.textSizeData;B.compositeTextSizes=[de.possiblyEvaluate(new Tn(Ie,{worldview:M}),_),de.possiblyEvaluate(new Tn(ke,{worldview:M}),_)]}if(l.iconSizeData.kind==="composite"){const{minZoom:Ie,maxZoom:ke}=l.iconSizeData;B.compositeIconSizes=[fe.possiblyEvaluate(new Tn(Ie,{worldview:M}),_),fe.possiblyEvaluate(new Tn(ke,{worldview:M}),_)]}B.layoutTextSize=de.possiblyEvaluate(new Tn(y+1,{worldview:M}),_),B.layoutIconSize=fe.possiblyEvaluate(new Tn(y+1,{worldview:M}),_),B.textMaxSize=de.possiblyEvaluate(new Tn(18,{worldview:M}),_);const Y=k.get("symbol-placement"),le=k.get("text-rotation-alignment")==="map"&&Y!=="point",pe=k.get("text-size");let ye=!1;const Re=[];for(const Ie of l.features){const ke=k.get("text-font").evaluate(Ie,{},_).join(","),je=pe.evaluate(Ie,{},_)*B.textScaleFactor,rt=B.layoutTextSize.evaluate(Ie,{},_)*B.textScaleFactor,xt=B.layoutIconSize.evaluate(Ie,{},_)*B.iconScaleFactor,ft={horizontal:{},vertical:void 0},vt=Ie.text;let wt,it=[0,0];if(vt){const mr=vt.toString(),Or=k.get("text-letter-spacing").evaluate(Ie,{},_)*go,Ir=k.get("text-line-height").evaluate(Ie,{},_)*go,Ur=nP(mr)?Or:0,Dr=k.get("text-anchor").evaluate(Ie,{},_),Vr=k.get("text-variable-anchor");if(!Vr){const ot=k.get("text-radial-offset").evaluate(Ie,{},_);if(ot)it=cj(Dr,[ot*go,JP]);else{const Rt=k.get("text-offset").evaluate(Ie,{},_);it=[Rt[0]*go,Rt[1]*go]}}let mn=le?"center":k.get("text-justify").evaluate(Ie,{},_);const Bn=Y==="point",ge=Bn?k.get("text-max-width").evaluate(Ie,{},_)*go:1/0,ve=ot=>{l.allowVerticalPlacement&&zf(mr)&&(ft.vertical=qP(vt,n,a,f,ke,ge,Ir,Dr,ot,Ur,it,Hs.vertical,!0,rt,je,E))};if(!le&&Vr){const ot=mn==="auto"?Vr.map(Bt=>QP(Bt)):[mn];let Rt=!1;for(let Bt=0;Bt<ot.length;Bt++){const jt=ot[Bt];if(!ft.horizontal[jt])if(Rt)ft.horizontal[jt]=ft.horizontal[0];else{const Zt=qP(vt,n,a,f,ke,ge,Ir,"center",jt,Ur,it,Hs.horizontal,!1,rt,je,E);Zt&&(ft.horizontal[jt]=Zt,Rt=Zt.positionedLines.length===1)}}ve("left")}else{if(mn==="auto"&&(mn=QP(Dr)),Bn||k.get("text-writing-mode").indexOf("horizontal")>=0||!zf(mr)){const ot=qP(vt,n,a,f,ke,ge,Ir,Dr,mn,Ur,it,Hs.horizontal,!1,rt,je,E);ot&&(ft.horizontal[mn]=ot)}ve(Bn?"left":mn)}}let _t,et,nt,Pt,It,sr,Kt=!1;const Ft=k.get("icon-text-fit").evaluate(Ie,{},_);if(Ie.icon&&Ie.icon.hasPrimary()){const mr=hj(Ie.icon,l.iconSizeData,D["icon-size"],_,l.zoom,Ie,E,B.iconScaleFactor,M);_t=mr.iconPrimary,nt=mr.iconSecondary;const Or=_t.toString();if(et=h.get(Or),et&&(It=k.get("icon-offset").evaluate(Ie,{},_),sr=k.get("icon-anchor").evaluate(Ie,{},_),wt=NY(f.get(Or),nt?f.get(nt.toString()):void 0,It,sr),Kt=et.sdf,l.sdfIcons===void 0?l.sdfIcons=et.sdf:l.sdfIcons!==et.sdf&&Rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==l.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(l.iconsNeedLinear=!0)),nt){const Ir=nt.toString();Pt=h.get(Ir)}}ye=ye||!(!Ie.icon||!Ie.icon.hasSecondary());const Et=eC(ft.horizontal)||ft.vertical;l.iconsInText||(l.iconsInText=!!Et&&Et.iconsInText);const Tr=rt*B.textScaleFactor/go,{defaultShapedIcon:Xt,verticallyShapedIcon:Jt}=qY(l,wt,k,Ie,_,ft,Tr,It,Ft);Ft!=="none"&&wt&&(qN(wt)||ZN(wt))&&(Aw(0,et,_t,wt,Xt,Ft,A,h,f),Aw(0,Pt,nt,wt,Xt,Ft,A,h,f),Jt&&(Aw(0,et,_t,wt,Jt,Ft,A,h,f),Aw(0,Pt,nt,wt,Jt,Ft,A,h,f))),wt=Xt,Re.push({feature:Ie,shapedTextOrientations:ft,shapedText:Et,shapedIcon:wt,iconPrimary:_t,iconSecondary:nt,iconOffset:It,iconAnchor:sr,verticallyShapedIcon:Jt,layoutTextSize:rt,layoutIconSize:xt,textOffset:it,isSDFIcon:Kt,iconTextFit:Ft})}return{featureData:Re,sizes:B,hasAnySecondaryIcon:ye,textAlongLine:le,symbolPlacement:Y}},o.fa=nj,o.fb=function(l,n,a,h,f,_,y,b,E,A){const{featureData:M,hasAnySecondaryIcon:k,sizes:D,textAlongLine:B,symbolPlacement:U}=n;for(const K of M){const{shapedIcon:te,verticallyShapedIcon:oe,feature:de,shapedTextOrientations:fe,shapedText:Y,layoutTextSize:le,textOffset:pe,isSDFIcon:ye,iconPrimary:Re,iconSecondary:Ie,iconTextFit:ke,iconOffset:je}=K;dj(te,A.iconPositions,Re,Ie),dj(oe,A.iconPositions,Re,Ie),WY(fe,A.iconPositions),HY(Re,Ie,A.iconPositions),(Y||te)&&ZY(l,de,fe,te,oe,E,D,le,0,pe,ye,h,f,y,b,k,ke,je,B,U)}a&&l.generateCollisionDebugBuffers(_,l.collisionBoxArray,D.textScaleFactor)},o.fc=zr,o.fd=Kw,o.fe=Tl,o.ff=Cr,o.fg=FN,o.fh=oi,o.fi=function(l){let n=0;if(new Uint32Array(l,0,1)[0]!==_N){const a=new Uint32Array(l,0,7),[,,h,f,_,y]=a;n=a.byteLength+f+_+y+_,(h!==l.byteLength||n>=l.byteLength)&&Rr("Invalid b3dm header information.")}return bN(l,n)},o.fj=function(l,n){const a=R3(l);for(const h of a){for(const f of h.meshes)_Q(f);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(yQ(h.lights,n)))}return a},o.fk=Gw,o.fl=_n,o.fm=dN,o.fn=zl,o.fo=Ss,o.fp=function(l){lh(),Ka!=null&&Ka.then(n=>{n.keys().then(a=>{for(let h=0;h<a.length-l;h++)n.delete(a[h]).catch(f=>Rr(f.message))}).catch(a=>Rr(a.message))}).catch(n=>Rr(n.message))},o.g=function(l,n){return uh(Xe(l,{method:"GET"}),n)},o.h=Xe,o.i=function(l){return wo.API_STYLE_REGEX.test(l)&&!dm(l)},o.j=function(l){return l.indexOf("mapbox:")===0},o.k=gc,o.l=zy,o.m=function(l){return decodeURIComponent(atob(l).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(l,n){return uh(Xe(l,{type:"json"}),n)},o.o=Ny,o.p=function(l,n){return uh(Xe(l,{method:"POST"}),n)},o.q=Sa,o.r=Oo,o.s=function(l){try{const n=self[l];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=mm,o.u=function(){return function l(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,l)}()},o.v=function(l){return!!l&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(l)},o.w=Rr,o.x=function(){return zP||(zP=new ip),zP},o.y=wC,o.z=vm}),d(["./shared"],function(o){function w(Je){const se=Je?Je.url.toString():void 0;return se?performance.getEntriesByName(se):[]}function T(Je){if(typeof Je=="number"||typeof Je=="boolean"||typeof Je=="string"||Je==null)return JSON.stringify(Je);if(Array.isArray(Je)){let ue="[";for(const xe of Je)ue+=`${T(xe)},`;return`${ue}]`}let se="{";for(const ue of Object.keys(Je).sort())se+=`${ue}:${T(Je[ue])},`;return`${se}}`}function I(Je){let se="";for(const ue of o.bu)se+=`/${T(Je[ue])}`;return se}class C{constructor(se){this.keyCache={},this._layers={},this._layerConfigs={},se&&this.replace(se)}replace(se,ue){this._layerConfigs={},this._layers={},this.update(se,[],ue)}update(se,ue,xe){this._options=xe;for(const Ee of se)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=o.db(Ee,this.scope,null,this._options)).compileFilter(xe),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of ue)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Me=function(Ee,ze){const We={};for(let Xe=0;Xe<Ee.length;Xe++){const pt=Ee[Xe];let Qe=ze&&ze[pt.id];Qe||(pt.type==="symbol"?Qe=pt.id:(Qe=I(pt),pt.type==="line"&&pt.paint&&function Yt(er){return typeof er=="string"&&er==="line-progress"||(Array.isArray(er)?er.some(Yt):!(!er||typeof er!="object")&&Object.values(er).some(Yt))}(pt.paint["line-width"])&&(Qe+=`/${T(pt.paint["line-width"])}`))),ze&&(ze[pt.id]=Qe);let kt=We[Qe];kt||(kt=We[Qe]=[]),kt.push(pt)}const Ne=[];for(const Xe in We)Ne.push(We[Xe]);return Ne}(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Me){const ze=Ee.map(kt=>this._layers[kt.id]),We=ze[0];if(We.visibility==="none")continue;const Ne=We.source||"";let Xe=this.familiesBySource[Ne];Xe||(Xe=this.familiesBySource[Ne]={});const pt=We.sourceLayer||"_geojsonTileLayer";let Qe=Xe[pt];Qe||(Qe=Xe[pt]=[]),Qe.push(ze)}}}const R=1*o.e_;class F{constructor(se){const ue={},xe=[];for(const We in se){const Ne=se[We],Xe=ue[We]={};for(const pt in Ne.glyphs){const Qe=Ne.glyphs[+pt];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const kt=Qe.metrics.localGlyph?R:1,Yt={x:0,y:0,w:Qe.bitmap.width+2*kt,h:Qe.bitmap.height+2*kt};xe.push(Yt),Xe[pt]=Yt}}const{w:Me,h:Ee}=o.H(xe),ze=new o.eZ({width:Me||1,height:Ee||1});for(const We in se){const Ne=se[We];for(const Xe in Ne.glyphs){const pt=Ne.glyphs[+Xe];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const Qe=ue[We][Xe],kt=pt.metrics.localGlyph?R:1;o.eZ.copy(pt.bitmap,ze,{x:0,y:0},{x:Qe.x+kt,y:Qe.y+kt},pt.bitmap)}}this.image=ze,this.positions=ue}}o.eY(F,"GlyphAtlas");class G{constructor(se){this.tileID=new o.aM(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.lut=se.lut,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.scope=se.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=se.showCollisionBoxes,this.collectResourceTiming=!!se.request&&se.request.collectResourceTiming,this.promoteId=se.promoteId,this.isSymbolTile=se.isSymbolTile,this.tileTransform=o.aW(se.tileID.canonical,se.projection),this.projection=se.projection,this.worldview=se.worldview,this.localizableLayerIds=se.localizableLayerIds,this.brightness=se.brightness,this.extraShadowCaster=!!se.extraShadowCaster,this.tessellationStep=se.tessellationStep,this.scaleFactor=se.scaleFactor,this.worldview=se.worldview}parse(se,ue,xe,Me,Ee,ze){this.status="parsing",this.data=se,this.collisionBoxArray=new o.b0;const We=new o.e$(Object.keys(se.layers).sort()),Ne=new o.f0(this.tileID,this.promoteId);Ne.bucketLayerIDs=[];const Xe={},pt=new o.f1(256,256),Qe={featureIndex:Ne,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:pt,availableImages:xe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},kt=[],Yt=ue.familiesBySource[this.source];for(const xr in Yt){const Sr=se.layers[xr];if(!Sr)continue;let Pr=!1,Gr=!1,Rr=!1;for(const _n of Yt[xr])_n[0].type==="symbol"?Pr=!0:Gr=!0,_n[0].is3D()&&_n[0].type!=="model"&&(Rr=!0);if(this.extraShadowCaster&&!Rr||this.isSymbolTile===!0&&!Pr||this.isSymbolTile===!1&&!Gr)continue;Sr.version===1&&o.w(`Vector tile source "${this.source}" layer "${xr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Cn=We.encode(xr),Yn=[];let Jn=!1;for(let _n=0,sn=0;_n<Sr.length;_n++){const vi=Sr.feature(_n),hi=Ne.getId(vi,xr);if(this.localizableLayerIds&&this.localizableLayerIds.has(xr)){const ai=vi.properties?vi.properties.worldview:null;if(this.worldview&&typeof ai=="string")if(ai==="all")vi.properties.$localized=!0;else{if(!ai.split(",").includes(this.worldview))continue;vi.properties.$localized=!0,vi.properties.worldview=this.worldview}}!Jn&&vi.properties&&vi.properties.hasOwnProperty(o.f2)&&(Jn=!0),Yn.push({feature:vi,id:hi,index:sn,sourceLayerIndex:Cn}),sn++}Jn&&!Qe.elevationFeatures&&se.layers.hasOwnProperty(o.f3)&&(Qe.elevationFeatures=o.f4.parseFrom(se.layers[o.f3],this.canonical));for(const _n of Yt[xr]){const sn=_n[0];if(this.extraShadowCaster&&(!sn.is3D()||sn.type==="model")||this.isSymbolTile!==void 0&&sn.type==="symbol"!==this.isSymbolTile||sn.minzoom&&this.zoom<Math.floor(sn.minzoom)||sn.maxzoom&&this.zoom>=sn.maxzoom||sn.visibility==="none")continue;j(_n,this.zoom,Qe.brightness,xe,this.worldview);const vi=Xe[sn.id]=sn.createBucket({index:Ne.bucketLayerIDs.length,layers:_n,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Cn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview});Ne.bucketLayerIDs.push(_n.map(ai=>o.C(ai.id,ai.scope)));let hi=vi.prepare?vi.prepare():null;hi!=null?(hi=hi.then(()=>vi.populate(Yn,Qe,this.tileID.canonical,this.tileTransform)),kt.push(hi)):vi.populate(Yn,Qe,this.tileID.canonical,this.tileTransform)}}const er=()=>{let xr,Sr,Pr,Gr,Rr,Cn;pt.trim();const Yn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Jn=()=>{if(xr)return this.status="done",ze(xr);if(this.extraShadowCaster)this.status="done",ze(null,{buckets:Object.values(Xe).filter(sn=>!sn.isEmpty()),featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Qe.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Sr&&Pr&&Gr){const sn=new F(Sr),vi=new Map;for(const[po,cs]of Pr.entries()){const{imagePosition:No}=o.f7(po,cs,o.f8);vi.set(po,No)}const hi={};for(const po in Xe){const cs=Xe[po];cs instanceof o.b1&&(j(cs.layers,this.zoom,Qe.brightness,xe,this.worldview),hi[po]=o.f9(cs,Sr,sn.positions,Pr,vi,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Rr,this.worldview))}const ai={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ee,Pr,Rr,()=>{ai.iconsPending=!1,_n(hi,sn,ai)}),this.rasterizeIfNeeded(Ee,Gr,Cn,()=>{ai.patternsPending=!1,_n(hi,sn,ai)})}},_n=(sn,vi,hi,ai)=>{if(hi.iconsPending||hi.patternsPending)return;const po=new o.fa(Pr,Gr,this.lut);for(const cs in Xe){const No=Xe[cs];if(cs in sn)o.fb(No,sn[cs],this.showCollisionBoxes,xe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Pr,po);else if(No.hasPattern&&(No instanceof o.b7||No instanceof o.b8||No instanceof o.dU)){j(No.layers,this.zoom,Qe.brightness,xe,this.worldview);const of=Object.fromEntries(po.patternPositions);No.addFeatures(Qe,this.tileID.canonical,of,xe,this.tileTransform,this.brightness)}}this.status="done",ze(null,{buckets:Object.values(Xe).filter(cs=>!cs.isEmpty()),featureIndex:Ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vi.image,lineAtlas:pt,imageAtlas:po,brightness:Qe.brightness})};if(!this.extraShadowCaster){const sn=o.f5(Qe.glyphDependencies,ai=>Object.keys(ai).map(Number));Object.keys(sn).length?Ee.send("getGlyphs",{uid:this.uid,stacks:sn,scope:this.scope},(ai,po)=>{xr||(xr=ai,Sr=po,Jn())},void 0,!1,Yn):Sr={};const vi=Array.from(Qe.iconDependencies.keys()).map(ai=>o.I.parse(ai));vi.length?Ee.send("getImages",{images:vi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ai,po)=>{xr||(xr=ai,Pr=new Map,Rr=this.updateImageMapAndGetImageTaskQueue(Pr,po,Qe.iconDependencies),Jn())},void 0,!1,Yn):(Pr=new Map,Rr=new Map);const hi=Array.from(Qe.patternDependencies.keys()).map(ai=>o.I.parse(ai));hi.length?Ee.send("getImages",{images:hi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ai,po)=>{xr||(xr=ai,Gr=new Map,Cn=this.updateImageMapAndGetImageTaskQueue(Gr,po,Qe.patternDependencies),Jn())},void 0,!1,Yn):(Gr=new Map,Cn=new Map)}if(Qe.elevationFeatures&&Qe.elevationFeatures.length>0){const sn=[];for(const hi of Object.values(Xe))if(hi instanceof o.b8){const ai=hi.getUnevaluatedPortalGraph();ai&&sn.push(ai)}const vi=o.f6.evaluate(sn);for(const hi of Object.values(Xe))if(hi instanceof o.b8){const ai=se.layers[We.decode(hi.sourceLayerIndex)];hi.setEvaluatedPortalGraph(vi,ai,this.tileID.canonical,Qe.availableImages,Qe.brightness)}}Jn()};kt.length>0?Promise.allSettled(kt).then(er).catch(ze):er()}rasterizeIfNeeded(se,ue,xe,Me){Array.from(ue.values()).some(Ee=>Ee.usvg)?this.rasterize(se,ue,xe,Me):Me()}updateImageMapAndGetImageTaskQueue(se,ue,xe){const Me=new Map;for(const Ee of ue.keys()){const ze=xe.get(Ee)||[];for(const We of ze){const Ne=We.toString(),Xe=ue.get(We.id.toString());Xe.usvg?Me.has(Ne)||(Me.set(Ne,We),se.set(Ne,Object.assign({},Xe))):se.set(Ne,Xe)}}return Me}rasterize(se,ue,xe,Me){this.rasterizeTask=se.send("rasterizeImages",{scope:this.scope,tasks:xe},(Ee,ze)=>{if(!Ee)for(const[We,Ne]of ze.entries()){const Xe=Object.assign(ue.get(We),{data:Ne});ue.set(We,Xe)}Me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function j(Je,se,ue,xe,Me){const Ee=new o.aa(se,{brightness:ue,worldview:Me});for(const ze of Je)ze.recalculate(Ee,xe)}class H extends o.E{constructor(se,ue,xe,Me,Ee,ze,We){super(),this.actor=se,this.layerIndex=ue,this.availableImages=xe,this.availableModels=Me,this.loadVectorData=ze||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(se.scheduler),this.isSpriteLoaded=Ee,this.scheduler=se.scheduler,this.brightness=We}loadTile(se,ue){const xe=se.uid,Me=se&&se.request,Ee=Me&&Me.collectResourceTiming,ze=this.loading[xe]=new G(se);ze.abort=this.loadVectorData(se,(We,Ne)=>{const Xe=!this.loading[xe];if(delete this.loading[xe],ze.cancelRasterize(),Xe||We||!Ne)return ze.status="done",Xe||(this.loaded[xe]=ze),ue(We);const pt=Ne.rawData,Qe={};Ne.expires&&(Qe.expires=Ne.expires),Ne.cacheControl&&(Qe.cacheControl=Ne.cacheControl),ze.vectorTile=Ne.vectorTile||new o.fc.VectorTile(new o.bq(pt));const kt=()=>{ze.parse(ze.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Yt,er)=>{if(Yt||!er)return ue(Yt);const xr={};if(Ee){const Sr=w(Me);Sr.length>0&&(xr.resourceTiming=JSON.parse(JSON.stringify(Sr)))}ue(null,o.h({rawTileData:pt.slice(0)},er,Qe,xr))})};this.isSpriteLoaded?kt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(kt,{type:"parseTile",isSymbolTile:se.isSymbolTile,zoom:se.tileZoom}):kt()}),this.loaded=this.loaded||{},this.loaded[xe]=ze})}reloadTile(se,ue){const xe=this.loaded,Me=se.uid;if(xe&&xe[Me]){const Ee=xe[Me];Ee.scaleFactor=se.scaleFactor,Ee.showCollisionBoxes=se.showCollisionBoxes,Ee.projection=se.projection,Ee.brightness=se.brightness,Ee.tileTransform=o.aW(se.tileID.canonical,se.projection),Ee.extraShadowCaster=se.extraShadowCaster,Ee.lut=se.lut,Ee.worldview=se.worldview;const ze=(We,Ne)=>{const Xe=Ee.reloadCallback;Xe&&(delete Ee.reloadCallback,Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Xe)),ue(We,Ne)};Ee.status==="parsing"?Ee.reloadCallback=ze:Ee.status==="done"&&(Ee.vectorTile?Ee.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ze):ze())}else ue(null,void 0)}abortTile(se,ue){const xe=se.uid,Me=this.loading[xe];Me&&(Me.abort&&Me.abort(),delete this.loading[xe]),ue()}removeTile(se,ue){const xe=this.loaded,Me=se.uid;xe&&xe[Me]&&delete xe[Me],ue()}}class X{loadTile(se,ue){const{uid:xe,encoding:Me,rawImageData:Ee,padding:ze}=se,We=ImageBitmap&&Ee instanceof ImageBitmap?this.getImageData(Ee,ze):Ee;ue(null,new o.fd(xe,We,Me,ze<1))}reloadTile(se,ue){ue(null,null)}abortTile(se,ue){ue()}removeTile(se,ue){ue()}getImageData(se,ue){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(se.width,se.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=se.width,this.offscreenCanvas.height=se.height,this.offscreenCanvasContext.drawImage(se,0,0,se.width,se.height);const xe=this.offscreenCanvasContext.getImageData(-ue,-ue,se.width+2*ue,se.height+2*ue);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}o.bp.setPbf(o.bq);class q{constructor(se){this._mrt=new o.bp(se.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=se.uid,this.tileID=se.tileID,this.source=se.source}parse(se,ue){const xe=this._mrt;this.status="parsing",this._entireBuffer=se;try{xe.parseHeader(se),this._isHeaderLoaded=!0;const Me=[];for(const Ee in xe.layers){const ze=xe.getLayer(Ee),We=ze.getDataRange(ze.getBandList()),Ne=xe.createDecodingTask(We),Xe=se.slice(We.firstByte,We.lastByte+1),pt=o.bp.performDecoding(Xe,Ne).then(Qe=>Ne.complete(null,Qe)).catch(Qe=>Ne.complete(Qe,null));Me.push(pt)}Promise.allSettled(Me).then(()=>ue(null,xe)).catch(Ee=>ue(Ee))}catch(Me){ue(Me)}}}class Z{constructor(se){this.actor=se,this.loading={},this.loaded={}}loadTile(se,ue){const xe=se.uid,Me=se.request,Ee=this.loading[xe]=new q(se),{cancel:ze}=o.br(Me,(We,Ne,Xe,pt)=>{const Qe=!this.loading[xe];if(delete this.loading[xe],Qe||We||!Ne)return Ee.status="done",Qe||(this.loaded[xe]=Ee),ue(We);Ee.parse(Ne,(kt,Yt)=>{if(kt||!Yt)return ue(kt);ue(null,Yt,Xe,pt)}),this.loaded[xe]=Ee});Ee.abort=ze}reloadTile(se,ue){ue(null,void 0)}abortTile(se,ue){const xe=se.uid,Me=this.loading[xe];Me&&(Me.abort&&Me.abort(),delete this.loading[xe]),ue()}removeTile(se,ue){const xe=se.uid;this.loaded[xe]&&delete this.loaded[xe],ue()}decodeRasterArray(se,ue){o.bp.performDecoding(se.buffer,se.task).then(xe=>ue(null,xe)).catch(xe=>ue(xe))}}const J=o.fc.VectorTileFeature.prototype.toGeoJSON;class ne{constructor(se){this._feature=se,this.extent=o.aj,this.type=se.type,this.properties=se.tags,"id"in se&&!isNaN(se.id)&&(this.id=parseInt(se.id,10))}loadGeometry(){if(this._feature.type===1){const se=[];for(const ue of this._feature.geometry)se.push([new o.P(ue[0],ue[1])]);return se}{const se=[];for(const ue of this._feature.geometry){const xe=[];for(const Me of ue)xe.push(new o.P(Me[0],Me[1]));se.push(xe)}return se}}toGeoJSON(se,ue,xe){return J.call(this,se,ue,xe)}}class he{constructor(se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.aj,this.length=se.length,this._features=se}feature(se){return new ne(this._features[se])}}class me{constructor(se,ue){this.name=se,this.extent=o.aj,this.length=ue.length,this._features=ue}feature(se){return new ne(this._features[se])}}class Se extends he{constructor(se){super([]),this.layers={};for(const ue in se)this.layers[ue]=new me(ue,se[ue])}}const qe=64/4096,Ze=128;class He{constructor(){this.features=new Map}clear(){this.features.clear()}load(se=[],ue){for(const xe of se){const Me=xe.id;if(Me==null)continue;let Ee=this.features.get(Me);Ee&&this.updateCache(Ee,ue),xe.geometry?(Ee=dt(xe),this.updateCache(Ee,ue),this.features.set(Me,Ee)):this.features.delete(Me),this.updateCache(Ee,ue)}}updateCache(se,ue){for(const{canonical:xe,uid:Me}of Object.values(ue)){const{z:Ee,x:ze,y:We}=xe;Ke(se,Math.pow(2,Ee),ze,We)&&delete ue[Me]}}getTile(se,ue,xe){const Me=Math.pow(2,se),Ee=[];for(const ze of this.features.values())Ke(ze,Me,ue,xe)&&Ee.push(St(ze,Me,ue,xe));return{features:Ee}}getFeatures(){return[...this.features.values()]}}function Ke({minX:Je,minY:se,maxX:ue,maxY:xe},Me,Ee,ze){return Je<(Ee+1+qe)/Me&&se<(ze+1+qe)/Me&&ue>(Ee-qe)/Me&&xe>(ze-qe)/Me}function dt(Je){const{id:se,geometry:ue,properties:xe}=Je;if(!ue)return;if(ue.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:Ee}=ue,ze={id:se,type:1,geometry:[],tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},We=ze.geometry;if(Me==="Point")$e(Ee,We,ze);else if(Me==="MultiPoint")for(const Ne of Ee)$e(Ne,We,ze);else if(Me==="LineString")ze.type=2,mt(Ee,We,ze);else if(Me==="MultiLineString")ze.type=2,ct(Ee,We,ze);else if(Me==="Polygon")ze.type=3,ct(Ee,We,ze,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ze.type=3;for(const Ne of Ee)ct(Ne,We,ze,!0)}return ze}function $e([Je,se],ue,xe){const Me=o.aD(Je);let Ee=o.aH(se);Ee=Ee<0?0:Ee>1?1:Ee,ue.push(Me,Ee),xe.minX=Math.min(xe.minX,Me),xe.minY=Math.min(xe.minY,Ee),xe.maxX=Math.max(xe.maxX,Me),xe.maxY=Math.max(xe.maxY,Ee)}function mt(Je,se,ue,xe=!1,Me=!1){const Ee=[];for(const ze of Je)$e(ze,Ee,ue);se.push(Ee),xe&&function(ze,We){let Ne=0;for(let Xe=0,pt=ze.length,Qe=pt-2;Xe<pt;Qe=Xe,Xe+=2)Ne+=(ze[Xe]-ze[Qe])*(ze[Xe+1]+ze[Qe+1]);if(Ne>0===We)for(let Xe=0,pt=ze.length;Xe<pt/2;Xe+=2){const Qe=ze[Xe],kt=ze[Xe+1];ze[Xe]=ze[pt-2-Xe],ze[Xe+1]=ze[pt-1-Xe],ze[pt-2-Xe]=Qe,ze[pt-1-Xe]=kt}}(Ee,Me)}function ct(Je,se,ue,xe=!1){for(let Me=0;Me<Je.length;Me++)mt(Je[Me],se,ue,xe,Me===0)}function St(Je,se,ue,xe){const{id:Me,type:Ee,geometry:ze,tags:We}=Je,Ne=[];if(Ee===1)(function(Xe,pt,Qe,kt,Yt){for(let er=0;er<Xe.length;er+=2){const xr=Math.round(o.aj*(Xe[er+0]*pt-Qe)),Sr=Math.round(o.aj*(Xe[er+1]*pt-kt));Yt.push([xr,Sr])}})(ze,se,ue,xe,Ne);else for(const Xe of ze)Ue(Xe,se,ue,xe,Ne);return{id:Me,type:Ee,geometry:Ne,tags:We}}function Ue(Je,se,ue,xe,Me){const ze=o.aj+Ze;let We;for(let Ne=0;Ne<Je.length-2;Ne+=2){let Xe=Math.round(o.aj*(Je[Ne+0]*se-ue)),pt=Math.round(o.aj*(Je[Ne+1]*se-xe)),Qe=Math.round(o.aj*(Je[Ne+2]*se-ue)),kt=Math.round(o.aj*(Je[Ne+3]*se-xe));const Yt=Qe-Xe,er=kt-pt;Xe<-128&&Qe<-128||(Xe<-128?(pt+=Math.round(er*((-128-Xe)/Yt)),Xe=-128):Qe<-128&&(kt=pt+Math.round(er*((-128-Xe)/Yt)),Qe=-128),pt<-128&&kt<-128||(pt<-128?(Xe+=Math.round(Yt*((-128-pt)/er)),pt=-128):kt<-128&&(Qe=Xe+Math.round(Yt*((-128-pt)/er)),kt=-128),Xe>=ze&&Qe>=ze||(Xe>=ze?(pt+=Math.round(er*((ze-Xe)/Yt)),Xe=ze):Qe>=ze&&(kt=pt+Math.round(er*((ze-Xe)/Yt)),Qe=ze),pt>=ze&&kt>=ze||(pt>=ze?(Xe+=Math.round(Yt*((ze-pt)/er)),pt=ze):kt>=ze&&(Qe=Xe+Math.round(Yt*((ze-pt)/er)),kt=ze),We&&Xe===We[We.length-1][0]&&pt===We[We.length-1][1]||(We=[[Xe,pt]],Me.push(We)),We.push([Qe,kt])))))}}var st,bt,At,zt={exports:{}},or=function(){if(At)return zt.exports;At=1;var Je=o.fg(),se=function(){if(bt)return st;bt=1;var pt=o.fe(),Qe=o.ff().VectorTileFeature;function kt(er,xr){this.options=xr||{},this.features=er,this.length=er.length}function Yt(er,xr){this.id=typeof er.id=="number"?er.id:void 0,this.type=er.type,this.rawGeometry=er.type===1?[er.geometry]:er.geometry,this.properties=er.tags,this.extent=xr||4096}return st=kt,kt.prototype.feature=function(er){return new Yt(this.features[er],this.options.extent)},Yt.prototype.loadGeometry=function(){var er=this.rawGeometry;this.geometry=[];for(var xr=0;xr<er.length;xr++){for(var Sr=er[xr],Pr=[],Gr=0;Gr<Sr.length;Gr++)Pr.push(new pt(Sr[Gr][0],Sr[Gr][1]));this.geometry.push(Pr)}return this.geometry},Yt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var er=this.geometry,xr=1/0,Sr=-1/0,Pr=1/0,Gr=-1/0,Rr=0;Rr<er.length;Rr++)for(var Cn=er[Rr],Yn=0;Yn<Cn.length;Yn++){var Jn=Cn[Yn];xr=Math.min(xr,Jn.x),Sr=Math.max(Sr,Jn.x),Pr=Math.min(Pr,Jn.y),Gr=Math.max(Gr,Jn.y)}return[xr,Pr,Sr,Gr]},Yt.prototype.toGeoJSON=Qe.prototype.toGeoJSON,st}();function ue(pt){var Qe=new Je;return function(kt,Yt){for(var er in kt.layers)Yt.writeMessage(3,xe,kt.layers[er])}(pt,Qe),Qe.finish()}function xe(pt,Qe){var kt;Qe.writeVarintField(15,pt.version||1),Qe.writeStringField(1,pt.name||""),Qe.writeVarintField(5,pt.extent||4096);var Yt={keys:[],values:[],keycache:{},valuecache:{}};for(kt=0;kt<pt.length;kt++)Yt.feature=pt.feature(kt),Qe.writeMessage(2,Me,Yt);var er=Yt.keys;for(kt=0;kt<er.length;kt++)Qe.writeStringField(3,er[kt]);var xr=Yt.values;for(kt=0;kt<xr.length;kt++)Qe.writeMessage(4,Xe,xr[kt])}function Me(pt,Qe){var kt=pt.feature;kt.id!==void 0&&Qe.writeVarintField(1,kt.id),Qe.writeMessage(2,Ee,pt),Qe.writeVarintField(3,kt.type),Qe.writeMessage(4,Ne,kt)}function Ee(pt,Qe){var kt=pt.feature,Yt=pt.keys,er=pt.values,xr=pt.keycache,Sr=pt.valuecache;for(var Pr in kt.properties){var Gr=kt.properties[Pr],Rr=xr[Pr];if(Gr!==null){Rr===void 0&&(Yt.push(Pr),xr[Pr]=Rr=Yt.length-1),Qe.writeVarint(Rr);var Cn=typeof Gr;Cn!=="string"&&Cn!=="boolean"&&Cn!=="number"&&(Gr=JSON.stringify(Gr));var Yn=Cn+":"+Gr,Jn=Sr[Yn];Jn===void 0&&(er.push(Gr),Sr[Yn]=Jn=er.length-1),Qe.writeVarint(Jn)}}}function ze(pt,Qe){return(Qe<<3)+(7&pt)}function We(pt){return pt<<1^pt>>31}function Ne(pt,Qe){for(var kt=pt.loadGeometry(),Yt=pt.type,er=0,xr=0,Sr=kt.length,Pr=0;Pr<Sr;Pr++){var Gr=kt[Pr],Rr=1;Yt===1&&(Rr=Gr.length),Qe.writeVarint(ze(1,Rr));for(var Cn=Yt===3?Gr.length-1:Gr.length,Yn=0;Yn<Cn;Yn++){Yn===1&&Yt!==1&&Qe.writeVarint(ze(2,Cn-1));var Jn=Gr[Yn].x-er,_n=Gr[Yn].y-xr;Qe.writeVarint(We(Jn)),Qe.writeVarint(We(_n)),er+=Jn,xr+=_n}Yt===3&&Qe.writeVarint(ze(7,1))}}function Xe(pt,Qe){var kt=typeof pt;kt==="string"?Qe.writeStringField(1,pt):kt==="boolean"?Qe.writeBooleanField(7,pt):kt==="number"&&(pt%1!=0?Qe.writeDoubleField(3,pt):pt<0?Qe.writeSVarintField(6,pt):Qe.writeVarintField(5,pt))}return zt.exports=ue,zt.exports.fromVectorTileJs=ue,zt.exports.fromGeojsonVt=function(pt,Qe){Qe=Qe||{};var kt={};for(var Yt in pt)kt[Yt]=new se(pt[Yt].features,Qe),kt[Yt].name=Yt,kt[Yt].version=Qe.version,kt[Yt].extent=Qe.extent;return ue({layers:kt})},zt.exports.GeoJSONWrapper=se,zt.exports}(),Mr=o.fh(or);const Ar={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Je=>Je},vr=Math.fround||(nr=new Float32Array(1),Je=>(nr[0]=+Je,nr[0]));var nr;const Xr=3,Lt=5,ur=6;class _r{constructor(se){this.options=Object.assign(Object.create(Ar),se),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(se){const{log:ue,minZoom:xe,maxZoom:Me}=this.options;ue&&console.time("total time");const Ee=`prepare ${se.length} points`;ue&&console.time(Ee),this.points=se;const ze=[];for(let Ne=0;Ne<se.length;Ne++){const Xe=se[Ne];if(!Xe.geometry)continue;const[pt,Qe]=Xe.geometry.coordinates,kt=vr(Yr(pt)),Yt=vr(Hn(Qe));ze.push(kt,Yt,1/0,Ne,-1,1),this.options.reduce&&ze.push(0)}let We=this.trees[Me+1]=this._createTree(ze);ue&&console.timeEnd(Ee);for(let Ne=Me;Ne>=xe;Ne--){const Xe=+Date.now();We=this.trees[Ne]=this._createTree(this._cluster(We,Ne)),ue&&console.log("z%d: %d clusters in %dms",Ne,We.numItems,+Date.now()-Xe)}return ue&&console.timeEnd("total time"),this}getClusters(se,ue){let xe=((se[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,se[1]));let Ee=se[2]===180?180:((se[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,se[3]));if(se[2]-se[0]>=360)xe=-180,Ee=180;else if(xe>Ee){const Qe=this.getClusters([xe,Me,180,ze],ue),kt=this.getClusters([-180,Me,Ee,ze],ue);return Qe.concat(kt)}const We=this.trees[this._limitZoom(ue)],Ne=We.range(Yr(xe),Hn(ze),Yr(Ee),Hn(Me)),Xe=We.data,pt=[];for(const Qe of Ne){const kt=this.stride*Qe;pt.push(Xe[kt+Lt]>1?Mt(Xe,kt,this.clusterProps):this.points[Xe[kt+Xr]])}return pt}getChildren(se){const ue=this._getOriginId(se),xe=this._getOriginZoom(se),Me="No cluster with the specified id.",Ee=this.trees[xe];if(!Ee)throw new Error(Me);const ze=Ee.data;if(ue*this.stride>=ze.length)throw new Error(Me);const We=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),Ne=Ee.within(ze[ue*this.stride],ze[ue*this.stride+1],We),Xe=[];for(const pt of Ne){const Qe=pt*this.stride;ze[Qe+4]===se&&Xe.push(ze[Qe+Lt]>1?Mt(ze,Qe,this.clusterProps):this.points[ze[Qe+Xr]])}if(Xe.length===0)throw new Error(Me);return Xe}getLeaves(se,ue,xe){const Me=[];return this._appendLeaves(Me,se,ue=ue||10,xe=xe||0,0),Me}getTile(se,ue,xe){const Me=this.trees[this._limitZoom(se)],Ee=Math.pow(2,se),{extent:ze,radius:We}=this.options,Ne=We/ze,Xe=(xe-Ne)/Ee,pt=(xe+1+Ne)/Ee,Qe={features:[]};return this._addTileFeatures(Me.range((ue-Ne)/Ee,Xe,(ue+1+Ne)/Ee,pt),Me.data,ue,xe,Ee,Qe),ue===0&&this._addTileFeatures(Me.range(1-Ne/Ee,Xe,1,pt),Me.data,Ee,xe,Ee,Qe),ue===Ee-1&&this._addTileFeatures(Me.range(0,Xe,Ne/Ee,pt),Me.data,-1,xe,Ee,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(se){let ue=this._getOriginZoom(se)-1;for(;ue<=this.options.maxZoom;){const xe=this.getChildren(se);if(ue++,xe.length!==1)break;se=xe[0].properties.cluster_id}return ue}_appendLeaves(se,ue,xe,Me,Ee){const ze=this.getChildren(ue);for(const We of ze){const Ne=We.properties;if(Ne&&Ne.cluster?Ee+Ne.point_count<=Me?Ee+=Ne.point_count:Ee=this._appendLeaves(se,Ne.cluster_id,xe,Me,Ee):Ee<Me?Ee++:se.push(We),se.length===xe)break}return Ee}_createTree(se){const ue=new o.bW(se.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<se.length;xe+=this.stride)ue.add(se[xe],se[xe+1]);return ue.finish(),ue.data=se,ue}_addTileFeatures(se,ue,xe,Me,Ee,ze){for(const We of se){const Ne=We*this.stride,Xe=ue[Ne+Lt]>1;let pt,Qe,kt;if(Xe)pt=Nr(ue,Ne,this.clusterProps),Qe=ue[Ne],kt=ue[Ne+1];else{const xr=this.points[ue[Ne+Xr]];pt=xr.properties;const[Sr,Pr]=xr.geometry.coordinates;Qe=Yr(Sr),kt=Hn(Pr)}const Yt={type:1,geometry:[[Math.round(this.options.extent*(Qe*Ee-xe)),Math.round(this.options.extent*(kt*Ee-Me))]],tags:pt};let er;er=Xe||this.options.generateId?ue[Ne+Xr]:this.points[ue[Ne+Xr]].id,er!==void 0&&(Yt.id=er),ze.features.push(Yt)}}_limitZoom(se){return Math.max(this.options.minZoom,Math.min(Math.floor(+se),this.options.maxZoom+1))}_cluster(se,ue){const{radius:xe,extent:Me,reduce:Ee,minPoints:ze}=this.options,We=xe/(Me*Math.pow(2,ue)),Ne=se.data,Xe=[],pt=this.stride;for(let Qe=0;Qe<Ne.length;Qe+=pt){if(Ne[Qe+2]<=ue)continue;Ne[Qe+2]=ue;const kt=Ne[Qe],Yt=Ne[Qe+1],er=se.within(Ne[Qe],Ne[Qe+1],We),xr=Ne[Qe+Lt];let Sr=xr;for(const Pr of er){const Gr=Pr*pt;Ne[Gr+2]>ue&&(Sr+=Ne[Gr+Lt])}if(Sr>xr&&Sr>=ze){let Pr,Gr=kt*xr,Rr=Yt*xr,Cn=-1;const Yn=(Qe/pt<<5)+(ue+1)+this.points.length;for(const Jn of er){const _n=Jn*pt;if(Ne[_n+2]<=ue)continue;Ne[_n+2]=ue;const sn=Ne[_n+Lt];Gr+=Ne[_n]*sn,Rr+=Ne[_n+1]*sn,Ne[_n+4]=Yn,Ee&&(Pr||(Pr=this._map(Ne,Qe,!0),Cn=this.clusterProps.length,this.clusterProps.push(Pr)),Ee(Pr,this._map(Ne,_n)))}Ne[Qe+4]=Yn,Xe.push(Gr/Sr,Rr/Sr,1/0,Yn,-1,Sr),Ee&&Xe.push(Cn)}else{for(let Pr=0;Pr<pt;Pr++)Xe.push(Ne[Qe+Pr]);if(Sr>1)for(const Pr of er){const Gr=Pr*pt;if(!(Ne[Gr+2]<=ue)){Ne[Gr+2]=ue;for(let Rr=0;Rr<pt;Rr++)Xe.push(Ne[Gr+Rr])}}}}return Xe}_getOriginId(se){return se-this.points.length>>5}_getOriginZoom(se){return(se-this.points.length)%32}_map(se,ue,xe){if(se[ue+Lt]>1){const ze=this.clusterProps[se[ue+ur]];return xe?Object.assign({},ze):ze}const Me=this.points[se[ue+Xr]].properties,Ee=this.options.map(Me);return xe&&Ee===Me?Object.assign({},Ee):Ee}}function Mt(Je,se,ue){return{type:"Feature",id:Je[se+Xr],properties:Nr(Je,se,ue),geometry:{type:"Point",coordinates:[(xe=Je[se],360*(xe-.5)),en(Je[se+1])]}};var xe}function Nr(Je,se,ue){const xe=Je[se+Lt],Me=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,Ee=Je[se+ur],ze=Ee===-1?{}:Object.assign({},ue[Ee]);return Object.assign(ze,{cluster:!0,cluster_id:Je[se+Xr],point_count:xe,point_count_abbreviated:Me})}function Yr(Je){return Je/360+.5}function Hn(Je){const se=Math.sin(Je*Math.PI/180),ue=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ue<0?0:ue>1?1:ue}function en(Je){const se=(180-360*Je)*Math.PI/180;return 360*Math.atan(Math.exp(se))/Math.PI-90}function Ei(Je,se,ue,xe){let Me=xe;const Ee=se+(ue-se>>1);let ze,We=ue-se;const Ne=Je[se],Xe=Je[se+1],pt=Je[ue],Qe=Je[ue+1];for(let kt=se+3;kt<ue;kt+=3){const Yt=xo(Je[kt],Je[kt+1],Ne,Xe,pt,Qe);if(Yt>Me)ze=kt,Me=Yt;else if(Yt===Me){const er=Math.abs(kt-Ee);er<We&&(ze=kt,We=er)}}Me>xe&&(ze-se>3&&Ei(Je,se,ze,xe),Je[ze+2]=Me,ue-ze>3&&Ei(Je,ze,ue,xe))}function xo(Je,se,ue,xe,Me,Ee){let ze=Me-ue,We=Ee-xe;if(ze!==0||We!==0){const Ne=((Je-ue)*ze+(se-xe)*We)/(ze*ze+We*We);Ne>1?(ue=Me,xe=Ee):Ne>0&&(ue+=ze*Ne,xe+=We*Ne)}return ze=Je-ue,We=se-xe,ze*ze+We*We}function On(Je,se,ue,xe){const Me={id:Je??null,type:se,geometry:ue,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(se==="Point"||se==="MultiPoint"||se==="LineString")Ai(Me,ue);else if(se==="Polygon")Ai(Me,ue[0]);else if(se==="MultiLineString")for(const Ee of ue)Ai(Me,Ee);else if(se==="MultiPolygon")for(const Ee of ue)Ai(Me,Ee[0]);return Me}function Ai(Je,se){for(let ue=0;ue<se.length;ue+=3)Je.minX=Math.min(Je.minX,se[ue]),Je.minY=Math.min(Je.minY,se[ue+1]),Je.maxX=Math.max(Je.maxX,se[ue]),Je.maxY=Math.max(Je.maxY,se[ue+1])}function Io(Je,se,ue,xe){if(!se.geometry)return;const Me=se.geometry.coordinates;if(Me&&Me.length===0)return;const Ee=se.geometry.type,ze=Math.pow(ue.tolerance/((1<<ue.maxZoom)*ue.extent),2);let We=[],Ne=se.id;if(ue.promoteId?Ne=se.properties[ue.promoteId]:ue.generateId&&(Ne=xe||0),Ee==="Point")vs(Me,We);else if(Ee==="MultiPoint")for(const Xe of Me)vs(Xe,We);else if(Ee==="LineString")Zo(Me,We,ze,!1);else if(Ee==="MultiLineString"){if(ue.lineMetrics){for(const Xe of Me)We=[],Zo(Xe,We,ze,!1),Je.push(On(Ne,"LineString",We,se.properties));return}ao(Me,We,ze,!1)}else if(Ee==="Polygon")ao(Me,We,ze,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Xe of se.geometry.geometries)Io(Je,{id:Ne,geometry:Xe,properties:se.properties},ue,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Xe of Me){const pt=[];ao(Xe,pt,ze,!0),We.push(pt)}}Je.push(On(Ne,Ee,We,se.properties))}function vs(Je,se){se.push(bl(Je[0]),qa(Je[1]),0)}function Zo(Je,se,ue,xe){let Me,Ee,ze=0;for(let Ne=0;Ne<Je.length;Ne++){const Xe=bl(Je[Ne][0]),pt=qa(Je[Ne][1]);se.push(Xe,pt,0),Ne>0&&(ze+=xe?(Me*pt-Xe*Ee)/2:Math.sqrt(Math.pow(Xe-Me,2)+Math.pow(pt-Ee,2))),Me=Xe,Ee=pt}const We=se.length-3;se[2]=1,Ei(se,0,We,ue),se[We+2]=1,se.size=Math.abs(ze),se.start=0,se.end=se.size}function ao(Je,se,ue,xe){for(let Me=0;Me<Je.length;Me++){const Ee=[];Zo(Je[Me],Ee,ue,xe),se.push(Ee)}}function bl(Je){return Je/360+.5}function qa(Je){const se=Math.sin(Je*Math.PI/180),ue=.5-.25*Math.log((1+se)/(1-se))/Math.PI;return ue<0?0:ue>1?1:ue}function lo(Je,se,ue,xe,Me,Ee,ze,We){if(xe/=se,Ee>=(ue/=se)&&ze<xe)return Je;if(ze<ue||Ee>=xe)return null;const Ne=[];for(const Xe of Je){const pt=Xe.geometry;let Qe=Xe.type;const kt=Me===0?Xe.minX:Xe.minY,Yt=Me===0?Xe.maxX:Xe.maxY;if(kt>=ue&&Yt<xe){Ne.push(Xe);continue}if(Yt<ue||kt>=xe)continue;let er=[];if(Qe==="Point"||Qe==="MultiPoint")pc(pt,er,ue,xe,Me);else if(Qe==="LineString")Xo(pt,er,ue,xe,Me,!1,We.lineMetrics);else if(Qe==="MultiLineString")bo(pt,er,ue,xe,Me,!1);else if(Qe==="Polygon")bo(pt,er,ue,xe,Me,!0);else if(Qe==="MultiPolygon")for(const xr of pt){const Sr=[];bo(xr,Sr,ue,xe,Me,!0),Sr.length&&er.push(Sr)}if(er.length){if(We.lineMetrics&&Qe==="LineString"){for(const xr of er)Ne.push(On(Xe.id,Qe,xr,Xe.tags));continue}Qe!=="LineString"&&Qe!=="MultiLineString"||(er.length===1?(Qe="LineString",er=er[0]):Qe="MultiLineString"),Qe!=="Point"&&Qe!=="MultiPoint"||(Qe=er.length===3?"Point":"MultiPoint"),Ne.push(On(Xe.id,Qe,er,Xe.tags))}}return Ne.length?Ne:null}function pc(Je,se,ue,xe,Me){for(let Ee=0;Ee<Je.length;Ee+=3){const ze=Je[Ee+Me];ze>=ue&&ze<=xe&&ls(se,Je[Ee],Je[Ee+1],Je[Ee+2])}}function Xo(Je,se,ue,xe,Me,Ee,ze){let We=wl(Je);const Ne=Me===0?Za:Xa;let Xe,pt,Qe=Je.start;for(let Sr=0;Sr<Je.length-3;Sr+=3){const Pr=Je[Sr],Gr=Je[Sr+1],Rr=Je[Sr+2],Cn=Je[Sr+3],Yn=Je[Sr+4],Jn=Me===0?Pr:Gr,_n=Me===0?Cn:Yn;let sn=!1;ze&&(Xe=Math.sqrt(Math.pow(Pr-Cn,2)+Math.pow(Gr-Yn,2))),Jn<ue?_n>ue&&(pt=Ne(We,Pr,Gr,Cn,Yn,ue),ze&&(We.start=Qe+Xe*pt)):Jn>xe?_n<xe&&(pt=Ne(We,Pr,Gr,Cn,Yn,xe),ze&&(We.start=Qe+Xe*pt)):ls(We,Pr,Gr,Rr),_n<ue&&Jn>=ue&&(pt=Ne(We,Pr,Gr,Cn,Yn,ue),sn=!0),_n>xe&&Jn<=xe&&(pt=Ne(We,Pr,Gr,Cn,Yn,xe),sn=!0),!Ee&&sn&&(ze&&(We.end=Qe+Xe*pt),se.push(We),We=wl(Je)),ze&&(Qe+=Xe)}let kt=Je.length-3;const Yt=Je[kt],er=Je[kt+1],xr=Me===0?Yt:er;xr>=ue&&xr<=xe&&ls(We,Yt,er,Je[kt+2]),kt=We.length-3,Ee&&kt>=3&&(We[kt]!==We[0]||We[kt+1]!==We[1])&&ls(We,We[0],We[1],We[2]),We.length&&se.push(We)}function wl(Je){const se=[];return se.size=Je.size,se.start=Je.start,se.end=Je.end,se}function bo(Je,se,ue,xe,Me,Ee){for(const ze of Je)Xo(ze,se,ue,xe,Me,Ee,!1)}function ls(Je,se,ue,xe){Je.push(se,ue,xe)}function Za(Je,se,ue,xe,Me,Ee){const ze=(Ee-se)/(xe-se);return ls(Je,Ee,ue+(Me-ue)*ze,1),ze}function Xa(Je,se,ue,xe,Me,Ee){const ze=(Ee-ue)/(Me-ue);return ls(Je,se+(xe-se)*ze,Ee,1),ze}function wa(Je,se){const ue=[];for(let xe=0;xe<Je.length;xe++){const Me=Je[xe],Ee=Me.type;let ze;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")ze=zo(Me.geometry,se);else if(Ee==="MultiLineString"||Ee==="Polygon"){ze=[];for(const We of Me.geometry)ze.push(zo(We,se))}else if(Ee==="MultiPolygon"){ze=[];for(const We of Me.geometry){const Ne=[];for(const Xe of We)Ne.push(zo(Xe,se));ze.push(Ne)}}ue.push(On(Me.id,Ee,ze,Me.tags))}return ue}function zo(Je,se){const ue=[];ue.size=Je.size,Je.start!==void 0&&(ue.start=Je.start,ue.end=Je.end);for(let xe=0;xe<Je.length;xe+=3)ue.push(Je[xe]+se,Je[xe+1],Je[xe+2]);return ue}function mc(Je,se){if(Je.transformed)return Je;const ue=1<<Je.z,xe=Je.x,Me=Je.y;for(const Ee of Je.features){const ze=Ee.geometry,We=Ee.type;if(Ee.geometry=[],We===1)for(let Ne=0;Ne<ze.length;Ne+=2)Ee.geometry.push(wr(ze[Ne],ze[Ne+1],se,ue,xe,Me));else for(let Ne=0;Ne<ze.length;Ne++){const Xe=[];for(let pt=0;pt<ze[Ne].length;pt+=2)Xe.push(wr(ze[Ne][pt],ze[Ne][pt+1],se,ue,xe,Me));Ee.geometry.push(Xe)}}return Je.transformed=!0,Je}function wr(Je,se,ue,xe,Me,Ee){return[Math.round(ue*(Je*xe-Me)),Math.round(ue*(se*xe-Ee))]}function oi(Je,se,ue,xe,Me){const Ee=se===Me.maxZoom?0:Me.tolerance/((1<<se)*Me.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:Je.length,source:null,x:ue,y:xe,z:se,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const We of Je)si(ze,We,Ee,Me);return ze}function si(Je,se,ue,xe){const Me=se.geometry,Ee=se.type,ze=[];if(Je.minX=Math.min(Je.minX,se.minX),Je.minY=Math.min(Je.minY,se.minY),Je.maxX=Math.max(Je.maxX,se.maxX),Je.maxY=Math.max(Je.maxY,se.maxY),Ee==="Point"||Ee==="MultiPoint")for(let We=0;We<Me.length;We+=3)ze.push(Me[We],Me[We+1]),Je.numPoints++,Je.numSimplified++;else if(Ee==="LineString")Fi(ze,Me,Je,ue,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let We=0;We<Me.length;We++)Fi(ze,Me[We],Je,ue,Ee==="Polygon",We===0);else if(Ee==="MultiPolygon")for(let We=0;We<Me.length;We++){const Ne=Me[We];for(let Xe=0;Xe<Ne.length;Xe++)Fi(ze,Ne[Xe],Je,ue,!0,Xe===0)}if(ze.length){let We=se.tags||null;if(Ee==="LineString"&&xe.lineMetrics){We={};for(const Xe in se.tags)We[Xe]=se.tags[Xe];We.mapbox_clip_start=Me.start/Me.size,We.mapbox_clip_end=Me.end/Me.size}const Ne={geometry:ze,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:We};se.id!==null&&(Ne.id=se.id),Je.features.push(Ne)}}function Fi(Je,se,ue,xe,Me,Ee){const ze=xe*xe;if(xe>0&&se.size<(Me?ze:xe))return void(ue.numPoints+=se.length/3);const We=[];for(let Ne=0;Ne<se.length;Ne+=3)(xe===0||se[Ne+2]>ze)&&(ue.numSimplified++,We.push(se[Ne],se[Ne+1])),ue.numPoints++;Me&&function(Ne,Xe){let pt=0;for(let Qe=0,kt=Ne.length,Yt=kt-2;Qe<kt;Yt=Qe,Qe+=2)pt+=(Ne[Qe]-Ne[Yt])*(Ne[Qe+1]+Ne[Yt+1]);if(pt>0===Xe)for(let Qe=0,kt=Ne.length;Qe<kt/2;Qe+=2){const Yt=Ne[Qe],er=Ne[Qe+1];Ne[Qe]=Ne[kt-2-Qe],Ne[Qe+1]=Ne[kt-1-Qe],Ne[kt-2-Qe]=Yt,Ne[kt-1-Qe]=er}}(We,Ee),Je.push(We)}const xs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Sl{constructor(se,ue){const xe=(ue=this.options=function(Ee,ze){for(const We in ze)Ee[We]=ze[We];return Ee}(Object.create(xs),ue)).debug;if(xe&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=function(Ee,ze){const We=[];if(Ee.type==="FeatureCollection")for(let Ne=0;Ne<Ee.features.length;Ne++)Io(We,Ee.features[Ne],ze,Ne);else Io(We,Ee.type==="Feature"?Ee:{geometry:Ee},ze);return We}(se,ue);this.tiles={},this.tileCoords=[],xe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=function(Ee,ze){const We=ze.buffer/ze.extent;let Ne=Ee;const Xe=lo(Ee,1,-1-We,We,0,-1,2,ze),pt=lo(Ee,1,1-We,2+We,0,-1,2,ze);return(Xe||pt)&&(Ne=lo(Ee,1,-We,1+We,0,-1,2,ze)||[],Xe&&(Ne=wa(Xe,1).concat(Ne)),pt&&(Ne=Ne.concat(wa(pt,-1)))),Ne}(Me,ue),Me.length&&this.splitTile(Me,0,0,0),xe&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(se,ue,xe,Me,Ee,ze,We){const Ne=[se,ue,xe,Me],Xe=this.options,pt=Xe.debug;for(;Ne.length;){Me=Ne.pop(),xe=Ne.pop(),ue=Ne.pop(),se=Ne.pop();const Qe=1<<ue,kt=Tl(ue,xe,Me);let Yt=this.tiles[kt];if(!Yt&&(pt>1&&console.time("creation"),Yt=this.tiles[kt]=oi(se,ue,xe,Me,Xe),this.tileCoords.push({z:ue,x:xe,y:Me}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,xe,Me,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));const sn=`z${ue}`;this.stats[sn]=(this.stats[sn]||0)+1,this.total++}if(Yt.source=se,Ee==null){if(ue===Xe.indexMaxZoom||Yt.numPoints<=Xe.indexMaxPoints)continue}else{if(ue===Xe.maxZoom||ue===Ee)continue;if(Ee!=null){const sn=Ee-ue;if(xe!==ze>>sn||Me!==We>>sn)continue}}if(Yt.source=null,se.length===0)continue;pt>1&&console.time("clipping");const er=.5*Xe.buffer/Xe.extent,xr=.5-er,Sr=.5+er,Pr=1+er;let Gr=null,Rr=null,Cn=null,Yn=null,Jn=lo(se,Qe,xe-er,xe+Sr,0,Yt.minX,Yt.maxX,Xe),_n=lo(se,Qe,xe+xr,xe+Pr,0,Yt.minX,Yt.maxX,Xe);se=null,Jn&&(Gr=lo(Jn,Qe,Me-er,Me+Sr,1,Yt.minY,Yt.maxY,Xe),Rr=lo(Jn,Qe,Me+xr,Me+Pr,1,Yt.minY,Yt.maxY,Xe),Jn=null),_n&&(Cn=lo(_n,Qe,Me-er,Me+Sr,1,Yt.minY,Yt.maxY,Xe),Yn=lo(_n,Qe,Me+xr,Me+Pr,1,Yt.minY,Yt.maxY,Xe),_n=null),pt>1&&console.timeEnd("clipping"),Ne.push(Gr||[],ue+1,2*xe,2*Me),Ne.push(Rr||[],ue+1,2*xe,2*Me+1),Ne.push(Cn||[],ue+1,2*xe+1,2*Me),Ne.push(Yn||[],ue+1,2*xe+1,2*Me+1)}}getTile(se,ue,xe){se=+se,ue=+ue,xe=+xe;const Me=this.options,{extent:Ee,debug:ze}=Me;if(se<0||se>24)return null;const We=1<<se,Ne=Tl(se,ue=ue+We&We-1,xe);if(this.tiles[Ne])return mc(this.tiles[Ne],Ee);ze>1&&console.log("drilling down to z%d-%d-%d",se,ue,xe);let Xe,pt=se,Qe=ue,kt=xe;for(;!Xe&&pt>0;)pt--,Qe>>=1,kt>>=1,Xe=this.tiles[Tl(pt,Qe,kt)];return Xe&&Xe.source?(ze>1&&(console.log("found parent tile z%d-%d-%d",pt,Qe,kt),console.time("drilling down")),this.splitTile(Xe.source,pt,Qe,kt,se,ue,xe),ze>1&&console.timeEnd("drilling down"),this.tiles[Ne]?mc(this.tiles[Ne],Ee):null):null}}function Tl(Je,se,ue){return 32*((1<<Je)*ue+se)+Je}function Dt(Je,se){const ue=Je.tileID.canonical;if(!this._geoJSONIndex)return void se(null,null);const xe=this._geoJSONIndex.getTile(ue.z,ue.x,ue.y);if(!xe)return void se(null,null);const Me=Ne=>Ne.tags&&"3d_elevation_id"in Ne.tags&&"source"in Ne.tags&&Ne.tags.source==="elevation",Ee=xe.features.filter(Ne=>Me(Ne));let ze;if(Ee.length>0){const Ne=xe.features.filter(Xe=>!Me(Xe));ze=new Se({_geojsonTileLayer:Ne,hd_road_elevation:Ee})}else ze=new he(xe.features);let We=Mr(ze);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),se(null,{vectorTile:ze,rawData:We.buffer})}class El extends H{constructor(se,ue,xe,Me,Ee,ze,We){super(se,ue,xe,Me,Ee,Dt,We),ze&&(this.loadGeoJSON=ze),this._dynamicIndex=new He}loadData(se,ue){const xe=se&&se.request,Me=xe&&xe.collectResourceTiming;this.loadGeoJSON(se,(Ee,ze)=>{if(Ee||!ze)return ue(Ee);if(typeof ze!="object")return ue(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));{try{if(se.filter){const Ne=o.X(se.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));ze.features=ze.features.filter(Xe=>Ne.value.evaluate({zoom:0},Xe))}se.dynamic?(ze.type==="Feature"&&(ze={type:"FeatureCollection",features:[ze]}),se.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ze.features,this.loaded),se.cluster&&(ze.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=se.cluster?new _r(function({superclusterOptions:Ne,clusterProperties:Xe}){if(!Xe||!Ne)return Ne;const pt={},Qe={},kt={accumulated:null,zoom:0},Yt={properties:null},er=Object.keys(Xe);for(const xr of er){const[Sr,Pr]=Xe[xr],Gr=o.X(Pr),Rr=o.X(typeof Sr=="string"?[Sr,["accumulated"],["get",xr]]:Sr);pt[xr]=Gr.value,Qe[xr]=Rr.value}return Ne.map=xr=>{Yt.properties=xr;const Sr={};for(const Pr of er)Sr[Pr]=pt[Pr].evaluate(kt,Yt);return Sr},Ne.reduce=(xr,Sr)=>{Yt.properties=Sr;for(const Pr of er)kt.accumulated=xr[Pr],xr[Pr]=Qe[Pr].evaluate(kt,Yt)},Ne}(se)).load(ze.features):se.dynamic?this._dynamicIndex:function(Ne,Xe){return new Sl(Ne,Xe)}(ze,se.geojsonVtOptions)}catch(Ne){return ue(Ne)}const We={};if(Me){const Ne=w(xe);Ne&&(We.resourceTiming={},We.resourceTiming[se.source]=JSON.parse(JSON.stringify(Ne)))}ue(null,We)}})}reloadTile(se,ue){const xe=this.loaded;return xe&&xe[se.uid]?se.partial?ue(null,void 0):super.reloadTile(se,ue):this.loadTile(se,ue)}loadGeoJSON(se,ue){if(se.request)o.n(se.request,ue);else{if(typeof se.data!="string")return ue(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`));try{return ue(null,JSON.parse(se.data))}catch{return ue(new Error(`Input data given to '${se.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(se,ue){try{ue(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(xe){ue(xe)}}getClusterChildren(se,ue){try{ue(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(xe){ue(xe)}}getClusterLeaves(se,ue){try{ue(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(xe){ue(xe)}}}class Dy{constructor(se,ue,xe){this.tileID=new o.aM(se.tileID.overscaledZ,se.tileID.wrap,se.tileID.canonical.z,se.tileID.canonical.x,se.tileID.canonical.y),this.tileZoom=se.tileZoom,this.uid=se.uid,this.zoom=se.zoom,this.canonical=se.tileID.canonical,this.pixelRatio=se.pixelRatio,this.tileSize=se.tileSize,this.source=se.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=se.projection,this.brightness=ue,this.worldview=xe}parse(se,ue,xe,Me){this.status="parsing";const Ee=new o.aM(xe.tileID.overscaledZ,xe.tileID.wrap,xe.tileID.canonical.z,xe.tileID.canonical.x,xe.tileID.canonical.y),ze=[],We=ue.familiesBySource[xe.source],Ne=new o.f0(Ee,xe.promoteId);Ne.bucketLayerIDs=[],Ne.is3DTile=!0,o.fi(se).then(Xe=>{if(!Xe)return Me(new Error("Could not parse tile"));const pt=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Xe.json.asset.extras&&Xe.json.asset.extras.MAPBOX_mesh_features,Qe=Xe.json.extensionsUsed&&Xe.json.extensionsUsed.includes("EXT_meshopt_compression"),kt=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Yt in We)for(const er of We[Yt]){const xr=er[0];Ne.bucketLayerIDs.push(er.map(Gr=>o.C(Gr.id,Gr.scope))),xr.recalculate(kt,[]);const Sr=o.fj(Xe,1/o.cU(xe.tileID.canonical)),Pr=new o.fk(er,Sr,Ee,pt,Qe,this.brightness,Ne,this.worldview);pt||(Pr.needsUpload=!0),ze.push(Pr),Pr.evaluate(xr)}this.status="done",Me(null,{buckets:ze,featureIndex:Ne,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Xe=>Me(new Error(Xe.message)))}}class nf{constructor(se,ue,xe,Me,Ee,ze,We,Ne){this.actor=se,this.layerIndex=ue,this.availableImages=xe,this.availableModels=Me,this.brightness=We,this.loading={},this.loaded={},this.worldview=Ne}loadTile(se,ue){const xe=se.uid,Me=this.loading[xe]=new Dy(se,this.brightness,this.worldview);o.br(se.request,(Ee,ze)=>{const We=!this.loading[xe];return delete this.loading[xe],We||Ee?(Me.status="done",We||(this.loaded[xe]=Me),ue(Ee)):ze&&ze.byteLength!==0?void Me.parse(ze,this.layerIndex,se,(Ne,Xe)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[xe]=Me,Ne||!Xe?ue(Ne):ue(null,Xe)}):(Me.status="done",this.loaded[xe]=Me,ue())})}reloadTile(se,ue){const xe=this.loaded,Me=se.uid;if(xe&&xe[Me]){const Ee=xe[Me];Ee.projection=se.projection,Ee.brightness=se.brightness;const ze=(We,Ne)=>{Ee.reloadCallback&&(delete Ee.reloadCallback,this.loadTile(se,ue)),ue(We,Ne)};Ee.status==="parsing"?Ee.reloadCallback=ze:Ee.status==="done"&&this.loadTile(se,ue)}}abortTile(se,ue){const xe=se.uid;this.loading[xe]&&delete this.loading[xe],ue()}removeTile(se,ue){const xe=this.loaded,Me=se.uid;xe&&xe[Me]&&delete xe[Me],ue()}}class nn{constructor(se){this.self=se,this.actor=new o.fm(se,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.ce({name:"mercator"}),this.workerSourceTypes={vector:H,geojson:El,"raster-dem":X,"raster-array":Z,"batched-model":nf},this.workerSources={},this.self.registerWorkerSource=(ue,xe)=>{if(this.workerSourceTypes[ue])throw new Error(`Worker source with name "${ue}" already registered.`);this.workerSourceTypes[ue]=xe},this.self.registerRTLTextPlugin=ue=>{if(o.fn.isParsed())throw new Error("RTL text plugin already registered.");o.fn.setState({pluginStatus:o.fo.parsed,pluginURL:o.fn.getPluginURL()}),o.fn.applyArabicShaping=ue.applyArabicShaping,o.fn.processBidirectionalText=ue.processBidirectionalText,o.fn.processStyledBidirectionalText=ue.processStyledBidirectionalText;for(const xe of this.rtlPluginParsingListeners)xe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(se,ue,xe){delete this.layerIndexes[se],delete this.availableImages[se],delete this.availableModels[se],delete this.workerSources[se],xe()}checkIfReady(se,ue,xe){xe()}setReferrer(se,ue){this.referrer=ue}spriteLoaded(se,ue){this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={});const{scope:xe,isLoaded:Me}=ue;if(this.isSpriteLoaded[se][xe]=Me,this.workerSources[se]&&this.workerSources[se][xe])for(const Ee in this.workerSources[se][xe]){const ze=this.workerSources[se][xe][Ee];for(const We in ze){const Ne=ze[We];Ne instanceof H&&(Ne.isSpriteLoaded=Me,Ne.fire(new o.A("isSpriteLoaded")))}}}setImages(se,ue,xe){this.availableImages[se]||(this.availableImages[se]={});const{scope:Me,images:Ee}=ue;if(this.availableImages[se][Me]=Ee,this.workerSources[se]&&this.workerSources[se][Me]){for(const ze in this.workerSources[se][Me]){const We=this.workerSources[se][Me][ze];for(const Ne in We)We[Ne].availableImages=Ee}xe()}else xe()}setModels(se,{scope:ue,models:xe},Me){if(this.availableModels[se]||(this.availableModels[se]={}),this.availableModels[se][ue]=xe,this.workerSources[se]&&this.workerSources[se][ue]){for(const Ee in this.workerSources[se][ue]){const ze=this.workerSources[se][ue][Ee];for(const We in ze)ze[We].availableModels=xe}Me()}else Me()}setProjection(se,ue){this.projections[se]=o.ce(ue)}setBrightness(se,ue,xe){this.brightness=ue,xe()}setWorldview(se,ue,xe){this.worldview=ue,xe()}setLayers(se,ue,xe){this.getLayerIndex(se,ue.scope).replace(ue.layers,ue.options),xe()}updateLayers(se,ue,xe){this.getLayerIndex(se,ue.scope).update(ue.layers,ue.removedIds,ue.options),xe()}loadTile(se,ue,xe){ue.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ue.type,ue.source,ue.scope).loadTile(ue,xe)}decodeRasterArray(se,ue,xe){this.getWorkerSource(se,ue.type,ue.source,ue.scope).decodeRasterArray(ue,xe)}reloadTile(se,ue,xe){ue.projection=this.projections[se]||this.defaultProjection,this.getWorkerSource(se,ue.type,ue.source,ue.scope).reloadTile(ue,xe)}abortTile(se,ue,xe){this.getWorkerSource(se,ue.type,ue.source,ue.scope).abortTile(ue,xe)}removeTile(se,ue,xe){this.getWorkerSource(se,ue.type,ue.source,ue.scope).removeTile(ue,xe)}removeSource(se,ue,xe){if(!(this.workerSources[se]&&this.workerSources[se][ue.scope]&&this.workerSources[se][ue.scope][ue.type]&&this.workerSources[se][ue.scope][ue.type][ue.source]))return;const Me=this.workerSources[se][ue.scope][ue.type][ue.source];delete this.workerSources[se][ue.scope][ue.type][ue.source],Me.removeSource!==void 0?Me.removeSource(ue,xe):xe()}loadWorkerSource(se,ue,xe){try{this.self.importScripts(ue.url),xe()}catch(Me){xe(Me.toString())}}syncRTLPluginState(se,ue,xe){if(o.fn.isParsed())xe(null,!0);else if(o.fn.isParsing())this.rtlPluginParsingListeners.push(xe);else try{o.fn.setState(ue);const Me=o.fn.getPluginURL();!o.fn.isLoaded()||o.fn.isParsed()||o.fn.isParsing()||Me==null||(o.fn.setState({pluginStatus:o.fo.parsing,pluginURL:o.fn.getPluginURL()}),this.self.importScripts(Me),o.fn.isParsed()?xe(null,!0):this.rtlPluginParsingListeners.push(xe))}catch(Me){xe(Me.toString())}}setDracoUrl(se,ue){this.dracoUrl=ue}getAvailableImages(se,ue){this.availableImages[se]||(this.availableImages[se]={});let xe=this.availableImages[se][ue];return xe||(xe=[]),xe}getAvailableModels(se,ue){this.availableModels[se]||(this.availableModels[se]={});let xe=this.availableModels[se][ue];return xe||(xe={}),xe}getLayerIndex(se,ue){this.layerIndexes[se]||(this.layerIndexes[se]={});let xe=this.layerIndexes[se][ue];return xe||(xe=this.layerIndexes[se][ue]=new C,xe.scope=ue),xe}getWorkerSource(se,ue,xe,Me){const Ee=this.workerSources;return Ee[se]||(Ee[se]={}),Ee[se][Me]||(Ee[se][Me]={}),Ee[se][Me][ue]||(Ee[se][Me][ue]={}),this.isSpriteLoaded[se]||(this.isSpriteLoaded[se]={}),Ee[se][Me][ue][xe]||(Ee[se][Me][ue][xe]=new this.workerSourceTypes[ue]({send:(ze,We,Ne,Xe,pt,Qe)=>this.actor.send(ze,We,Ne,se,pt,Qe),scheduler:this.actor.scheduler},this.getLayerIndex(se,Me),this.getAvailableImages(se,Me),this.getAvailableModels(se,Me),this.isSpriteLoaded[se][Me],void 0,this.brightness,this.worldview)),Ee[se][Me][ue][xe]}rasterizeImagesWorker(se,ue,xe){const Me=new Map;for(const[Ee,{image:ze,imageVariant:We}]of ue.tasks.entries()){const Ne=this.imageRasterizer.rasterize(We,ze,ue.scope,se);Me.set(Ee,Ne)}xe(void 0,Me)}removeRasterizedImages(se,ue,xe){this.imageRasterizer.removeImagesFromCacheByIds(ue.imageIds,ue.scope,se),xe()}enforceCacheSizeLimit(se,ue){o.fp(ue)}getWorkerPerformanceMetrics(se,ue,xe){xe(void 0,void 0)}}return o.fl(self)&&(self.worker=new nn(self)),nn}),d(["./shared"],function(o){var w="3.13.0";const T={create:"create",load:"load",fullLoad:"fullLoad"},I={mark(p){performance.mark(p)},measure(p,s,u){performance.measure(p,s,u)}};function C(p){const s=p.name.split("?")[0];return o.a(s)&&s.includes("mapbox-gl.js")?"javascript":o.a(s)&&s.includes("mapbox-gl.css")?"css":o.b(s)?"fontRange":o.c(s)?"sprite":o.i(s)?"style":o.d(s)?"tilejson":"other"}var R,F={},G=function(){if(R)return F;function p(m){return!s(m)}function s(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var x,S,P=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(P);try{S=new Worker(O),x=!0}catch{x=!1}return S&&S.terminate(),URL.revokeObjectURL(O),x}()?function(){var x=document.createElement("canvas");x.width=x.height=1;var S=x.getContext("2d");if(!S)return!1;var P=S.getImageData(0,0,1,1);return P&&P.width===x.width}()?(u[v=m&&m.failIfMajorPerformanceCaveat]===void 0&&(u[v]=function(x){var S,P=function(O){var L=document.createElement("canvas"),N=Object.create(p.webGLContextAttributes);return N.failIfMajorPerformanceCaveat=O,L.getContext("webgl2",N)}(x);if(!P)return!1;try{S=P.createShader(P.VERTEX_SHADER)}catch{return!1}return!(!S||P.isContextLost())&&(P.shaderSource(S,"void main() {}"),P.compileShader(S),P.getShaderParameter(S,P.COMPILE_STATUS)===!0)}(v)),u[v]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var v}R=1,F.supported=p,F.notSupportedReason=s;var u={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},F}();function j(p,s,u){const m=document.createElement(p);return s!=null&&(m.className=s),u&&u.appendChild(m),m}function H(p,s,u){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(s))m.setAttributeNS(null,v,String(s[v]));return u&&u.appendChild(m),m}const X=typeof document<"u"?document.documentElement&&document.documentElement.style:null,q=X&&X.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Z;function J(){X&&q&&(Z=X[q],X[q]="none")}function ne(){X&&q&&(X[q]=Z)}function he(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",he,!0)}function me(){window.addEventListener("click",he,!0),window.setTimeout(()=>{window.removeEventListener("click",he,!0)},0)}function Se(p,s){const u=p.getBoundingClientRect();return He(p,u,s)}function qe(p,s){const u=p.getBoundingClientRect(),m=[];for(let v=0;v<s.length;v++)m.push(He(p,u,s[v]));return m}function Ze(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function He(p,s,u){const m=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new o.P((u.clientX-s.left)*m,(u.clientY-s.top)*m)}const Ke="01",dt="NO_ACCESS_TOKEN";class $e{constructor(s,u,m){this._transformRequestFn=s,this._customAccessToken=u,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const s=function(){let u="";for(let m=0;m<10;m++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ke,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}normalizeStyleURL(s,u){if(!o.j(s))return s;const m=ct(s);return m.params.push(`sdk=js-${w}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||u)}normalizeGlyphsURL(s,u){if(!o.j(s))return s;const m=ct(s);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||u)}normalizeModelURL(s,u){if(!o.j(s))return s;const m=ct(s);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||u)}normalizeSourceURL(s,u,m,v){if(!o.j(s))return s;const x=ct(s);return x.path=`/v4/${x.authority}.json`,x.params.push("secure"),m&&x.params.push(`language=${m}`),v&&x.params.push(`worldview=${v}`),this._makeAPIURL(x,this._customAccessToken||u)}normalizeIconsetURL(s,u){const m=ct(s);return o.j(s)?(m.path=`/styles/v1${m.path}/iconset.pbf`,this._makeAPIURL(m,this._customAccessToken||u)):St(m)}normalizeSpriteURL(s,u,m,v){const x=ct(s);return o.j(s)?(x.path=`/styles/v1${x.path}/sprite${u}${m}`,this._makeAPIURL(x,this._customAccessToken||v)):(x.path+=`${u}${m}`,St(x))}normalizeTileURL(s,u,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!o.j(s))return s;const v=ct(s);v.path=v.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${u||m&&v.authority!=="raster"&&m===512?"@2x":""}${o.l.supported?".webp":"$1"}`),v.authority==="raster"?v.path=`/${o.e.RASTER_URL_PREFIX}${v.path}`:v.authority==="rasterarrays"?v.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${v.path}`:v.authority==="3dtiles"?v.path=`/${o.e.TILES3D_URL_PREFIX}${v.path}`:(v.path=v.path.replace(/^.+\/v4\//,"/"),v.path=`/${o.e.TILE_URL_VERSION}${v.path}`);const x=this._customAccessToken||function(S){for(const P of S){const O=P.match(/^access_token=(.*)$/);if(O)return O[1]}return null}(v.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&x&&this._skuToken&&v.params.push(`sku=${this._skuToken}`),this._makeAPIURL(v,x)}canonicalizeTileURL(s,u){const m=ct(s);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return s;let v="mapbox://";m.path.match(/^\/raster\/v1\//)?v+=`raster/${m.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?v+=`rasterarrays/${m.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:v+=`tiles/${m.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let x=m.params;return u&&(x=x.filter(S=>!S.match(/^access_token=/))),x.length&&(v+=`?${x.join("&")}`),v}canonicalizeTileset(s,u){const m=!!u&&o.j(u),v=[];for(const x of s.tiles||[])o.k(x)?v.push(this.canonicalizeTileURL(x,m)):v.push(x);return v}_makeAPIURL(s,u){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",v=ct(o.e.API_URL);if(s.protocol=v.protocol,s.authority=v.authority,s.protocol==="http"){const x=s.params.indexOf("secure");x>=0&&s.params.splice(x,1)}if(v.path!=="/"&&(s.path=`${v.path}${s.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return St(s);if(u=u||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!u)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(u[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return s.params=s.params.filter(x=>x.indexOf("access_token")===-1),s.params.push(`access_token=${u||""}`),St(s)}}const mt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ct(p){const s=p.match(mt);if(!s)throw new Error("Unable to parse URL object");return{protocol:s[1],authority:s[2],path:s[3]||"/",params:s[4]?s[4].split("&"):[]}}function St(p){const s=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${s}`}const Ue="mapbox.eventData";function st(p){if(!p)return null;const s=p.split(".");if(!s||s.length!==3)return null;try{return JSON.parse(o.m(s[1]))}catch{return null}}class bt{constructor(s){this.type=s,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(s){const u=st(o.e.ACCESS_TOKEN);let m="";return m=u&&u.u?o.f(u.u):o.e.ACCESS_TOKEN||"",s?`${Ue}.${s}:${m}`:`${Ue}:${m}`}fetchEventData(){const s=o.s("localStorage"),u=this.getStorageKey(),m=this.getStorageKey("uuid");if(s)try{const v=localStorage.getItem(u);v&&(this.eventData=JSON.parse(v));const x=localStorage.getItem(m);x&&(this.anonId=x)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const s=o.s("localStorage"),u=this.getStorageKey(),m=this.getStorageKey("uuid"),v=this.anonId;if(s&&v)try{localStorage.setItem(m,v),Object.keys(this.eventData).length>=1&&localStorage.setItem(u,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(s){}postEvent(s,u,m,v){if(!o.e.EVENTS_URL)return;const x=ct(o.e.EVENTS_URL);x.params.push(`access_token=${v||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(s).toISOString()},P=u?o.h(S,u):S,O={url:St(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=o.p(O,L=>{this.pendingRequest=null,m(L),this.saveEventData(),this.processRequests(v)})}queueRequest(s,u){this.queue.push(s),this.processRequests(u)}}const At=new class extends bt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,s){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(u=>o.j(u)||o.k(u))&&this.queueRequest(Date.now(),s)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const s=st(o.e.ACCESS_TOKEN),u=s?s.u:o.e.ACCESS_TOKEN;let m=u!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),m=!0);const v=this.queue.shift();if(this.eventData.lastSuccess){const x=new Date(this.eventData.lastSuccess),S=new Date(v),P=(v-this.eventData.lastSuccess)/864e5;m=m||P>=1||P<-1||x.getDate()!==S.getDate()}else m=!0;m?this.postEvent(v,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:Ke,"enabled.telemetry":!1,userId:this.anonId},x=>{x||(this.eventData.lastSuccess=v,this.eventData.tokenU=u)},p):this.processRequests()}},zt=At.postTurnstileEvent.bind(At),or=new class extends bt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,s,u,m){this.skuToken=s,this.errorCb=m,o.e.EVENTS_URL&&(u||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},u):this.errorCb(new Error(dt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:u}=this.queue.shift();s&&this.success[s]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:w,skuId:Ke,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):s&&(this.success[s]=!0)},p))}remove(){this.errorCb=null}},Mr=or.postMapLoadEvent.bind(or),Ar=new class extends bt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let s=this.mapInstanceIdMap.get(p);return s||(s=o.u(),this.mapInstanceIdMap.set(p,s)),s}getEventId(p){const s=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,s+1),s}postStyleLoadEvent(p,s){const{map:u,style:m,importedStyles:v}=s;if(!o.e.EVENTS_URL||!p&&!o.e.ACCESS_TOKEN)return;const x=this.getMapInstanceId(u),S={mapInstanceId:x,eventId:this.getEventId(x),style:m};v.length&&(S.importedStyles=v),this.queueRequest({timestamp:Date.now(),payload:S},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,payload:u}=this.queue.shift();this.postEvent(s,u,()=>{},p)}},vr=Ar.postStyleLoadEvent.bind(Ar),nr=new class extends bt{constructor(){super("gljs.performance")}postPerformanceEvent(p,s){o.e.EVENTS_URL&&(p||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:s},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:s,performanceData:u}=this.queue.shift(),m=function(v){const x=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),P=function(W){const re={};if(W){for(const ee in W)if(ee!=="other")for(const ie of W[ee]){const ae=`${ee}ResolveRangeMin`,ce=`${ee}ResolveRangeMax`,_e=`${ee}RequestCount`,be=`${ee}RequestCachedCount`;re[ae]=Math.min(re[ae]||1/0,ie.startTime),re[ce]=Math.max(re[ce]||-1/0,ie.responseEnd);const Pe=Ae=>{re[Ae]===void 0&&(re[Ae]=0),++re[Ae]};ie.transferSize!==void 0&&ie.transferSize===0&&Pe(be),Pe(_e)}}return re}(function(W,re){const ee={};if(W)for(const ie of W){const ae=re(ie);ee[ae]===void 0&&(ee[ae]=[]),ee[ae].push(ie)}return ee}(x,C)),O=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,N=L?L.effectiveType:void 0,V={counters:[],metadata:[],attributes:[]},$=(W,re,ee)=>{ee!=null&&W.push({name:re,value:ee.toString()})};for(const W in P)$(V.counters,W,P[W]);if(v.interactionRange[0]!==1/0&&v.interactionRange[1]!==-1/0&&($(V.counters,"interactionRangeMin",v.interactionRange[0]),$(V.counters,"interactionRangeMax",v.interactionRange[1])),S)for(const W of Object.keys(T)){const re=T[W],ee=S.find(ie=>ie.name===re);ee&&$(V.counters,re,ee.startTime)}return $(V.counters,"visibilityHidden",v.visibilityHidden),$(V.attributes,"style",function(W){if(W)for(const re of W){const ee=re.name.split("?")[0];if(o.i(ee)){const ie=ee.split("/").slice(-2);if(ie.length===2)return`mapbox://styles/${ie[0]}/${ie[1]}`}}}(x)),$(V.attributes,"terrainEnabled",v.terrainEnabled?"true":"false"),$(V.attributes,"fogEnabled",v.fogEnabled?"true":"false"),$(V.attributes,"projection",v.projection),$(V.attributes,"zoom",v.zoom),$(V.metadata,"devicePixelRatio",O),$(V.metadata,"connectionEffectiveType",N),$(V.metadata,"navigatorUserAgent",navigator.userAgent),$(V.metadata,"screenWidth",window.screen.width),$(V.metadata,"screenHeight",window.screen.height),$(V.metadata,"windowWidth",window.innerWidth),$(V.metadata,"windowHeight",window.innerHeight),$(V.metadata,"mapWidth",v.width/O),$(V.metadata,"mapHeight",v.height/O),$(V.metadata,"webglRenderer",v.renderer),$(V.metadata,"webglVendor",v.vendor),$(V.metadata,"sdkVersion",w),$(V.metadata,"sdkIdentifier","mapbox-gl-js"),V}(u);for(const v of m.metadata);for(const v of m.counters);for(const v of m.attributes);this.postEvent(s,m,()=>{},p)}},Xr=nr.postPerformanceEvent.bind(nr),Lt=new class extends bt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,s,u,m){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const v=ct(o.e.API_URL+o.e.SESSION_PATH);v.params.push(`sku=${s||""}`),v.params.push(`access_token=${m||o.e.ACCESS_TOKEN||""}`);const x={url:St(v),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(x,S=>{this.pendingRequest=null,u(S),this.saveEventData(),this.processRequests(m)})}getSessionAPI(p,s,u,m){this.skuToken=s,this.errorCb=m,o.e.SESSION_PATH&&o.e.API_URL&&(u||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},u):this.errorCb(new Error(dt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:s,timestamp:u}=this.queue.shift();s&&this.success[s]||this.getSession(u,this.skuToken,m=>{m?this.errorCb(m):s&&(this.success[s]=!0)},p)}remove(){this.errorCb=null}},ur=Lt.getSessionAPI.bind(Lt),_r=new Set;function Mt(p,s){s?_r.add(p):_r.delete(p)}class Nr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(s,u){this._updatedSourceCaches[s]=u,this.setDirty()}discardSourceCacheUpdate(s){delete this._updatedSourceCaches[s]}updateLayer(s){const u=s.scope;this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._updatedLayers[u].add(s.id),this.setDirty()}removeLayer(s){const u=s.scope;this._removedLayers[u]=this._removedLayers[u]||{},this._updatedLayers[u]=this._updatedLayers[u]||new Set,this._removedLayers[u][s.id]=s,this._updatedLayers[u].delete(s.id),this._updatedPaintProps.delete(s.fqid),this.setDirty()}getRemovedLayer(s){return this._removedLayers[s.scope]?this._removedLayers[s.scope][s.id]:null}discardLayerRemoval(s){this._removedLayers[s.scope]&&delete this._removedLayers[s.scope][s.id]}getLayerUpdatesByScope(){const s={};for(const u in this._updatedLayers)s[u]=s[u]||{},s[u].updatedIds=Array.from(this._updatedLayers[u].values());for(const u in this._removedLayers)s[u]=s[u]||{},s[u].removedIds=Object.keys(this._removedLayers[u]);return s}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(s){this._updatedPaintProps.add(s.fqid),this.setDirty()}getUpdatedImages(s){return this._updatedImages[s]?Array.from(this._updatedImages[s].values()):[]}updateImage(s,u){this._updatedImages[u]=this._updatedImages[u]||new Set,this._updatedImages[u].add(o.I.toString(s)),this.setDirty()}resetUpdatedImages(s){this._updatedImages[s]&&this._updatedImages[s].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Yr(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class Hn extends o.E{constructor(s){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=s,s!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(s){this.loaded.set(s,!1),this.imageProviders.set(s,new Map),this.images.set(s,new Map),this.updatedImages.set(s,new Set),this.callbackDispatchedThisFrame.set(s,new Set),this.patterns.set(s,new Map),this.atlasImage.set(s,new o.r({width:1,height:1}))}removeScope(s){this.loaded.delete(s),this.imageProviders.delete(s),this.images.delete(s),this.updatedImages.delete(s),this.callbackDispatchedThisFrame.delete(s),this.patterns.delete(s),this.atlasImage.delete(s);const u=this.atlasTexture.get(s);u&&(u.destroy(),this.atlasTexture.delete(s))}addImageProvider(s,u){this.imageProviders.has(u)||this.imageProviders.set(u,new Map),this.imageProviders.get(u).set(s.id,s)}removeImageProvider(s,u){this.imageProviders.has(u)&&this.imageProviders.get(u).delete(s)}getPendingImageProviders(){const s=[];for(const u of this.imageProviders.values())for(const m of u.values())m.hasPendingRequests()&&s.push(m);return s}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const s of this.loaded.keys())if(!this.loaded.get(s))return!1;return!0}setLoaded(s,u){if(this.loaded.get(u)!==s&&(this.loaded.set(u,s),s)){for(const{ids:m,callback:v}of this.requestors)this._notify(m,u,v);this.requestors=[]}}hasImage(s,u){return!!this.getImage(s,u)}getImage(s,u){return this.images.get(u).get(s.toString())}addImage(s,u,m){this._validate(s,m)&&this.images.get(u).set(s.toString(),m)}_validate(s,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new o.z(new Error(`Image "${s.name}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new o.z(new Error(`Image "${s.name}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new o.z(new Error(`Image "${s.name}" has invalid "content" value`))),m=!1),m}_validateStretch(s,u){if(!s)return!0;let m=0;for(const v of s){if(v[0]<m||v[1]<v[0]||u<v[1])return!1;m=v[1]}return!0}_validateContent(s,u){return s?s.length!==4||!u.usvg&&(s[0]<0||u.data.width<s[0]||s[1]<0||u.data.height<s[1]||s[2]<0||u.data.width<s[2]||s[3]<0||u.data.height<s[3])?!1:!(s[2]<s[0]||s[3]<s[1]):!0}updateImage(s,u,m){const v=this.images.get(u).get(s.toString());m.version=v.version+1,this.images.get(u).set(s.toString(),m),this.updatedImages.get(u).add(s),this.removeFromImageRasterizerCache(s,u)}clearUpdatedImages(s){this.updatedImages.get(s).clear()}removeFromImageRasterizerCache(s,u){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[s],scope:u}):this.imageRasterizer.removeImagesFromCacheByIds([s],u))}removeImage(s,u){const m=this.images.get(u),v=m.get(s.toString());m.delete(s.toString()),this.patterns.get(u).delete(s.toString()),this.removeFromImageRasterizerCache(s,u),v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(s){return Array.from(this.images.get(s).keys()).map(u=>o.I.from(u))}getImages(s,u,m){const v=[],x=[],S=this.imageProviders.get(u);for(const N of s){if(!N.iconsetId){v.push(N);continue}const V=S.get(N.iconsetId);V&&(this.getImage(N,u)?x.push(N):V.addPendingRequest(N))}if(v.length===0)return void this._notify(x,u,m);let P=!0;const O=!!this.loaded.get(u),L=this.images.get(u);if(!O)for(const N of v)L.has(N.toString())||(P=!1);O||P?this._notify(v,u,m):this.requestors.push({ids:v,scope:u,callback:m})}rasterizeImages(s,u){const m=new Map,{tasks:v,scope:x}=s;for(const[S,P]of v.entries()){const O=this.getImage(P.id,x);O&&m.set(S,{image:O,imageVariant:P})}this._rasterizeImages(x,m,u)}_rasterizeImages(s,u,m){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:u,scope:s},m);else{const v=new Map;for(const[x,{image:S,imageVariant:P}]of u.entries())v.set(x,this.imageRasterizer.rasterize(P,S,s,0));m(void 0,v)}}getUpdatedImages(s){return this.updatedImages.get(s)||new Set}_notify(s,u,m){const v=this.images.get(u),x=new Map;for(const S of s){if(!v.get(S.toString())){if(S.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:S.name}))}const P=v.get(S.toString());if(!P){o.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:P.usvg?null:P.data.clone(),pixelRatio:P.pixelRatio,sdf:P.sdf,usvg:P.usvg,version:P.version,stretchX:P.stretchX,stretchY:P.stretchY,content:P.content,hasRenderCallback:!!(P.userImage&&P.userImage.render)};P.usvg&&Object.assign(O,{width:P.icon.usvg_tree.width,height:P.icon.usvg_tree.height}),x.set(o.I.toString(S),O)}m(null,x)}getPixelSize(s){const{width:u,height:m}=this.atlasImage.get(s);return{width:u,height:m}}getPattern(s,u,m){const v=s.toString(),x=this.patterns.get(u),S=x.get(v),P=this.getImage(s,u);if(!P)return null;if(S){if(S.position.version===P.version)return S.position;S.position.version=P.version}else{if(P.usvg&&!P.data){const O=this.getPatternInFlightId(v,u);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const L=new o.B(s).scaleSelf(o.q.devicePixelRatio),N=new Map([[L.toString(),{image:P,imageVariant:L}]]);return this._rasterizeImages(u,N,(V,$)=>this.storePatternImage(L,u,P,m,$)),null}this.storePattern(s,u,P)}return this._updatePatternAtlas(u,m),x.get(v).position}getPatternInFlightId(s,u){return o.C(s,u)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(s,u,m,v,x){const S=s.toString(),P=x?x.get(S):void 0;P&&(m.data=P,this.storePattern(s.id,u,m),this._updatePatternAtlas(u,v),this.patternsInFlight.delete(this.getPatternInFlightId(s.id.toString(),u)))}storePattern(s,u,m){const v={w:m.data.width+2*o.F,h:m.data.height+2*o.F,x:0,y:0},x=new o.G(v,m,o.F);this.patterns.get(u).set(s.toString(),{bin:v,position:x})}bind(s,u){const m=s.gl;let v=this.atlasTexture.get(u);v?this.dirty&&(v.update(this.atlasImage.get(u)),this.dirty=!1):(v=new o.T(s,this.atlasImage.get(u),m.RGBA8),this.atlasTexture.set(u,v)),v.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(s,u){const m=this.patterns.get(s),v=Array.from(m.values()).map(({bin:L})=>L),{w:x,h:S}=o.H(v),P=this.atlasImage.get(s);P.resize({width:x||1,height:S||1});const O=this.images.get(s);for(const[L,{bin:N,position:V}]of m.entries()){let $=V.padding;const W=N.x+$,re=N.y+$,ee=O.get(L).data,ie=ee.width,ae=ee.height;$=$>1?$-1:$,o.r.copy(ee,P,{x:0,y:0},{x:W,y:re},{width:ie,height:ae},u),o.r.copy(ee,P,{x:0,y:ae-$},{x:W,y:re-$},{width:ie,height:$},u),o.r.copy(ee,P,{x:0,y:0},{x:W,y:re+ae},{width:ie,height:$},u),o.r.copy(ee,P,{x:ie-$,y:0},{x:W-$,y:re},{width:$,height:ae},u),o.r.copy(ee,P,{x:0,y:0},{x:W+ie,y:re},{width:$,height:ae},u),o.r.copy(ee,P,{x:ie-$,y:ae-$},{x:W-$,y:re-$},{width:$,height:$},u),o.r.copy(ee,P,{x:0,y:ae-$},{x:W+ie,y:re-$},{width:$,height:$},u),o.r.copy(ee,P,{x:0,y:0},{x:W+ie,y:re+ae},{width:$,height:$},u),o.r.copy(ee,P,{x:ie-$,y:0},{x:W-$,y:re+ae},{width:$,height:$},u)}this.dirty=!0}beginFrame(){for(const s of this.images.keys())this.callbackDispatchedThisFrame.set(s,new Set)}dispatchRenderCallbacks(s,u){const m=this.images.get(u);for(const v of s){if(this.callbackDispatchedThisFrame.get(u).has(v.toString()))continue;this.callbackDispatchedThisFrame.get(u).add(v.toString());const x=m.get(v.toString());Yr(x)&&this.updateImage(v,u,x)}}}function en(p){const s=p.key,u=p.value,m=p.valueSpec||{},v=p.objectElementValidators||{},x=p.style,S=p.styleSpec;let P=[];const O=o.J(u);if(O!=="object")return[new o.V(s,u,`object expected, ${O} found`)];for(const L in u){const N=L.split(".")[0];let V;v[N]?V=v[N]:m[N]?V=wr:v["*"]?V=v["*"]:m["*"]&&(V=wr),V?P=P.concat(V({key:(s&&`${s}.`)+L,value:u[L],valueSpec:m[N]||m["*"],style:x,styleSpec:S,object:u,objectKey:L},u)):P.push(new o.K(s,u[L],`unknown property "${L}"`))}for(const L in m)v[L]||m[L].required&&m[L].default===void 0&&u[L]===void 0&&P.push(new o.V(s,u,`missing required property "${L}"`));return P}function Ei(p){const s=p.value,u=p.valueSpec,m=p.style,v=p.styleSpec,x=p.key,S=p.arrayElementValidator||wr;if(o.J(s)!=="array")return[new o.V(x,s,`array expected, ${o.J(s)} found`)];if(u.length&&s.length!==u.length)return[new o.V(x,s,`array length ${u.length} expected, length ${s.length} found`)];if(u["min-length"]&&s.length<u["min-length"])return[new o.V(x,s,`array length at least ${u["min-length"]} expected, length ${s.length} found`)];let P={type:u.value,values:u.values,minimum:u.minimum,maximum:u.maximum,function:void 0};v.$version<7&&(P.function=u.function),o.J(u.value)==="object"&&(P=u.value);let O=[];for(let L=0;L<s.length;L++)O=O.concat(S({array:s,arrayIndex:L,value:s[L],valueSpec:P,style:m,styleSpec:v,key:`${x}[${L}]`},!0));return O}function xo(p){const s=p.key,u=p.value,m=p.valueSpec;let v=o.J(u);if(v==="number"&&u!=u&&(v="NaN"),v!=="number")return[new o.V(s,u,`number expected, ${v} found`)];if("minimum"in m){let x=m.minimum;if(o.J(m.minimum)==="array"&&(x=m.minimum[p.arrayIndex]),u<x)return[new o.V(s,u,`${u} is less than the minimum value ${x}`)]}if("maximum"in m){let x=m.maximum;if(o.J(m.maximum)==="array"&&(x=m.maximum[p.arrayIndex]),u>x)return[new o.V(s,u,`${u} is greater than the maximum value ${x}`)]}return[]}function On(p){const s=p.valueSpec,u=o.M(p.value.type);let m,v,x,S={};const P=u!=="categorical"&&p.value.property===void 0,O=!P,L=o.J(p.value.stops)==="array"&&o.J(p.value.stops[0])==="array"&&o.J(p.value.stops[0][0])==="object",N=en({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(W){if(u==="identity")return[new o.V(W.key,W.value,'identity function may not have a "stops" property')];let re=[];const ee=W.value;return re=re.concat(Ei({key:W.key,value:ee,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:V})),o.J(ee)==="array"&&ee.length===0&&re.push(new o.V(W.key,ee,"array must have at least one stop")),re},default:function(W){return wr({key:W.key,value:W.value,valueSpec:s,style:W.style,styleSpec:W.styleSpec})}}});return u==="identity"&&P&&N.push(new o.V(p.key,p.value,'missing required property "property"')),u==="identity"||p.value.stops||N.push(new o.V(p.key,p.value,'missing required property "stops"')),u==="exponential"&&p.valueSpec.expression&&!o.N(p.valueSpec)&&N.push(new o.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(O&&!o.O(p.valueSpec)?N.push(new o.V(p.key,p.value,"property functions not supported")):P&&!o.Q(p.valueSpec)&&N.push(new o.V(p.key,p.value,"zoom functions not supported"))),u!=="categorical"&&!L||p.value.property!==void 0||N.push(new o.V(p.key,p.value,'"property" property is required')),N;function V(W){let re=[];const ee=W.value,ie=W.key;if(o.J(ee)!=="array")return[new o.V(ie,ee,`array expected, ${o.J(ee)} found`)];if(ee.length!==2)return[new o.V(ie,ee,`array length 2 expected, length ${ee.length} found`)];if(L){if(o.J(ee[0])!=="object")return[new o.V(ie,ee,`object expected, ${o.J(ee[0])} found`)];if(ee[0].zoom===void 0)return[new o.V(ie,ee,"object stop key must have zoom")];if(ee[0].value===void 0)return[new o.V(ie,ee,"object stop key must have value")];const ae=o.M(ee[0].zoom);if(typeof ae!="number")return[new o.V(ie,ee[0].zoom,"stop zoom values must be numbers")];if(x&&x>ae)return[new o.V(ie,ee[0].zoom,"stop zoom values must appear in ascending order")];ae!==x&&(x=ae,v=void 0,S={}),re=re.concat(en({key:`${ie}[0]`,value:ee[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:xo,value:$}}))}else re=re.concat($({key:`${ie}[0]`,value:ee[0],style:W.style,styleSpec:W.styleSpec},ee));return o.S(o.U(ee[1]))?re.concat([new o.V(`${ie}[1]`,ee[1],"expressions are not allowed in function stops.")]):re.concat(wr({key:`${ie}[1]`,value:ee[1],valueSpec:s,style:W.style,styleSpec:W.styleSpec}))}function $(W,re){const ee=o.J(W.value),ie=o.M(W.value),ae=W.value!==null?W.value:re;if(m){if(ee!==m)return[new o.V(W.key,ae,`${ee} stop domain type must match previous stop domain type ${m}`)]}else m=ee;if(ee!=="number"&&ee!=="string"&&ee!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new o.V(W.key,ae,"stop domain value must be a number, string, or boolean")];if(ee!=="number"&&u!=="categorical"){let ce=`number expected, ${ee} found`;return o.O(s)&&u===void 0&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(W.key,ae,ce)]}return u!=="categorical"||ee!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?u!=="categorical"&&ee==="number"&&typeof ie=="number"&&typeof v=="number"&&v!==void 0&&ie<v?[new o.V(W.key,ae,"stop domain values must appear in ascending order")]:(v=ie,u==="categorical"&&ie in S?[new o.V(W.key,ae,"stop domain values must be unique")]:(S[ie]=!0,[])):[new o.V(W.key,ae,`integer expected, found ${String(ie)}`)]}}function Ai(p){const s=(p.expressionContext==="property"?o.W:o.X)(o.U(p.value),p.valueSpec);if(s.result==="error")return s.value.map(m=>new o.V(`${p.key}${m.key}`,p.value,m.message));const u=s.value.expression||s.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!u.outputDefined())return[new o.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!o.Y(u))return[new o.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return Io(u,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!o.Z(u,["zoom","feature-state"]))return[new o.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!o._(u))return[new o.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Io(p,s){const u=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(s.valueSpec&&s.valueSpec.expression)for(const v of s.valueSpec.expression.parameters)u.delete(v);if(u.size===0)return[];const m=[];return p instanceof o.$&&u.has(p.name)?[new o.V(s.key,s.value,`["${p.name}"] expression is not supported in a filter for a ${s.object.type} layer with id: ${s.object.id}`)]:(p.eachChild(v=>{m.push(...Io(v,s))}),m)}function vs(p){const s=p.key,u=p.value,m=p.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(o.M(u))===-1&&v.push(new o.V(s,u,`expected one of [${m.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(m.values).indexOf(o.M(u))===-1&&v.push(new o.V(s,u,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Zo(p){return o.a1(o.U(p.value))?Ai(o.L({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):ao(p)}function ao(p){const s=p.value,u=p.key;if(o.J(s)!=="array")return[new o.V(u,s,`array expected, ${o.J(s)} found`)];const m=p.styleSpec;let v,x=[];if(s.length<1)return[new o.V(u,s,"filter array must have at least 1 element")];switch(x=x.concat(vs({key:`${u}[0]`,value:s[0],valueSpec:m.filter_operator,style:p.style,styleSpec:p.styleSpec})),o.M(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&o.M(s[1])==="$type"&&x.push(new o.V(u,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&x.push(new o.V(u,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=o.J(s[1]),v!=="string"&&x.push(new o.V(`${u}[1]`,s[1],`string expected, ${v} found`)));for(let S=2;S<s.length;S++)v=o.J(s[S]),o.M(s[1])==="$type"?x=x.concat(vs({key:`${u}[${S}]`,value:s[S],valueSpec:m.geometry_type,style:p.style,styleSpec:p.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&x.push(new o.V(`${u}[${S}]`,s[S],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let S=1;S<s.length;S++)x=x.concat(ao({key:`${u}[${S}]`,value:s[S],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":v=o.J(s[1]),s.length!==2?x.push(new o.V(u,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&x.push(new o.V(`${u}[1]`,s[1],`string expected, ${v} found`))}return x}function bl(p,s){const u=p.key,m=p.style,v=p.layer,x=p.styleSpec,S=p.value,P=p.objectKey,O=x[`${s}_${p.layerType}`];if(!O)return[];const L=P.match(/^(.*)-use-theme$/);if(s==="paint"&&L&&O[L[1]])return o.S(S)?[].concat(wr({key:p.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:m,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:P})):wr({key:u,value:S,valueSpec:{type:"string"},style:m,styleSpec:x});const N=P.match(/^(.*)-transition$/);if(s==="paint"&&N&&O[N[1]]&&O[N[1]].transition)return wr({key:u,value:S,valueSpec:x.transition,style:m,styleSpec:x});const V=p.valueSpec||O[P];if(!V)return[new o.K(u,S,`unknown property "${P}"`)];let $;if(o.J(S)==="string"&&o.O(V)&&!V.tokens&&($=/^{([^}]+)}$/.exec(S))){const re=`\`{ "type": "identity", "property": ${$?JSON.stringify($[1]):'"_"'} }\``;return[new o.V(u,S,`"${P}" does not support interpolation syntax
Use an identity property function instead: ${re}.`)]}const W=[];if(p.layerType==="symbol")P!=="text-field"||!m||m.glyphs||m.imports||W.push(new o.V(u,S,'use of "text-field" requires a style "glyphs" property')),P==="text-font"&&o.a2(o.U(S))&&o.M(S.type)==="identity"&&W.push(new o.V(u,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&s==="paint"&&v&&v.layout&&v.layout.hasOwnProperty("model-id")&&o.O(V)&&(o.a3(V)||o.Q(V))){const re=o.W(o.U(S),V),ee=re.value.expression||re.value._styleExpression.expression;ee&&!o.Z(ee,["measure-light"])&&(P==="model-emissive-strength"&&o._(ee)&&o.Y(ee)||W.push(new o.V(u,S,`${P} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return W.concat(wr({key:p.key,value:S,valueSpec:V,style:m,styleSpec:x,expressionContext:"property",propertyType:s,propertyKey:P}))}function qa(p){return bl(p,"paint")}function lo(p){return bl(p,"layout")}function pc(p){let s=[];const u=p.value,m=p.key,v=p.style,x=p.styleSpec;u.type||u.ref||s.push(new o.V(m,u,'either "type" or "ref" is required'));let S=o.M(u.type);const P=o.M(u.ref);if(u.id){const O=o.M(u.id);for(let L=0;L<p.arrayIndex;L++){const N=v.layers[L];o.M(N.id)===O&&s.push(new o.V(m,u.id,`duplicate layer id "${u.id}", previously used at line ${N.id.__line__}`))}}if("ref"in u){let O;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&s.push(new o.V(m,u[L],`"${L}" is prohibited for ref layers`))}),v.layers.forEach(L=>{o.M(L.id)===P&&(O=L)}),O?O.ref?s.push(new o.V(m,u.ref,"ref cannot reference another ref layer")):S=o.M(O.type):typeof P=="string"&&s.push(new o.V(m,u.ref,`ref layer "${P}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(u.source){const O=v.sources&&v.sources[u.source],L=O&&o.M(O.type);O?L==="vector"&&S==="raster"?s.push(new o.V(m,u.source,`layer "${u.id}" requires a raster source`)):L==="raster"&&S!=="raster"?s.push(new o.V(m,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&S!=="hillshade"?s.push(new o.V(m,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&u.paint&&(u.paint["line-gradient"]||u.paint["line-trim-offset"])&&L==="geojson"&&!O.lineMetrics?s.push(new o.V(m,u,`layer "${u.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&L!=="raster-array"&&s.push(new o.V(m,u.source,`layer "${u.id}" requires a 'raster-array' source.`)):s.push(new o.V(m,u.source,"raster-array source can only be used with layer type 'raster'.")):s.push(new o.V(m,u,`layer "${u.id}" must specify a "source-layer"`)):s.push(new o.V(m,u.source,`source "${u.source}" not found`))}else s.push(new o.V(m,u,'missing required property "source"'));return s=s.concat(en({key:m,value:u,valueSpec:x.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wr({key:`${m}.type`,value:u.type,valueSpec:x.layer.type,style:p.style,styleSpec:p.styleSpec,object:u,objectKey:"type"}),filter:O=>Zo(o.L({layerType:S},O)),layout:O=>en({layer:u,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":L=>lo(o.L({layerType:S},L))}}),paint:O=>en({layer:u,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":L=>qa(o.L({layerType:S,layer:u},L))}})}})),s}function Xo(p){const s=p.value,u=p.key,m=o.J(s);return m!=="string"?[new o.V(u,s,`string expected, ${m} found`)]:[]}const wl={promoteId:function p({key:s,value:u}){if(o.J(u)==="string")return Xo({key:s,value:u});if(Array.isArray(u)){const m=[],v=o.U(u),x=o.X(v);return x.result==="error"&&x.value.forEach(S=>{m.push(new o.V(`${s}${S.key}`,null,`${S.message}`))}),o.Z(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||m.push(new o.V(`${s}`,null,"promoteId expression should be only feature dependent")),m}{const m=[];for(const v in u)m.push(...p({key:`${s}.${v}`,value:u[v]}));return m}}};function bo(p){const s=p.value,u=p.key,m=p.styleSpec,v=p.style;if(!s.type)return[new o.V(u,s,'"type" is required')];const x=o.M(s.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(x)&&(s.url||s.tiles||S.push(new o.K(u,s,'Either "url" or "tiles" is required.'))),x){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(en({key:u,value:s,valueSpec:m[`source_${x.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:wl})),S;case"geojson":if(S=en({key:u,value:s,valueSpec:m.source_geojson,style:v,styleSpec:m,objectElementValidators:wl}),s.cluster)for(const P in s.clusterProperties){const[O,L]=s.clusterProperties[P],N=typeof O=="string"?[O,["accumulated"],["get",P]]:O;S.push(...Ai({key:`${u}.${P}.map`,value:L,expressionContext:"cluster-map"})),S.push(...Ai({key:`${u}.${P}.reduce`,value:N,expressionContext:"cluster-reduce"}))}return S;case"video":return en({key:u,value:s,valueSpec:m.source_video,style:v,styleSpec:m});case"image":return en({key:u,value:s,valueSpec:m.source_image,style:v,styleSpec:m});case"canvas":return[new o.V(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vs({key:`${u}.type`,value:s.type,valueSpec:{values:ls(m)}})}}function ls(p){return p.source.reduce((s,u)=>{const m=p[u];return m.type.type==="enum"&&(s=s.concat(Object.keys(m.type.values))),s},[])}function Za(p){const s=p.value,u=p.styleSpec,m=u.light,v=p.style;let x=[];const S=o.J(s);if(s===void 0)return x;if(S!=="object")return x=x.concat([new o.V("light",s,`object expected, ${S} found`)]),x;for(const P in s){const O=P.match(/^(.*)-transition$/),L=P.match(/^(.*)-use-theme$/);x=x.concat(L&&m[L[1]]?wr({key:P,value:s[P],valueSpec:{type:"string"},style:v,styleSpec:u}):O&&m[O[1]]&&m[O[1]].transition?wr({key:P,value:s[P],valueSpec:u.transition,style:v,styleSpec:u}):m[P]?wr({key:P,value:s[P],valueSpec:m[P],style:v,styleSpec:u}):[new o.V(P,s[P],`unknown property "${P}"`)])}return x}function Xa(p){const s=p.value;let u=[];if(!s)return u;const m=o.J(s);if(m!=="object")return u=u.concat([new o.V("light-3d",s,`object expected, ${m} found`)]),u;const v=p.styleSpec,x=v["light-3d"],S=p.key,P=p.style,O=p.style.lights;for(const V of["type","id"])if(!(V in s))return u=u.concat([new o.V("light-3d",s,`missing property ${V} on light`)]),u;if(s.type&&O)for(let V=0;V<p.arrayIndex;V++){const $=o.M(s.type),W=O[V];o.M(W.type)===$&&u.push(new o.V(S,s.id,`duplicate light type "${s.type}", previously defined at line ${W.id.__line__}`))}const L=`properties_light_${s.type}`;if(!(L in v))return u=u.concat([new o.V("light-3d",s,`Invalid light type ${s.type}`)]),u;const N=v[L];for(const V in s)if(V==="properties"){const $=s[V],W=o.J($);if(W!=="object")return u=u.concat([new o.V("properties",$,`object expected, ${W} found`)]),u;for(const re in $){const ee=re.match(/^(.*)-transition$/),ie=re.match(/^(.*)-use-theme$/);u=u.concat(ie&&N[ie[1]]?wr({key:V,value:$[re],valueSpec:{type:"string"},style:P,styleSpec:v}):ee&&N[ee[1]]&&N[ee[1]].transition?wr({key:V,value:s[V],valueSpec:v.transition,style:P,styleSpec:v}):N[re]?wr({key:re,value:$[re],valueSpec:N[re],style:P,styleSpec:v}):[new o.K(p.key,$[re],`unknown property "${re}"`)])}}else u=u.concat(x[V]?wr({key:V,value:s[V],valueSpec:x[V],style:P,styleSpec:v}):[new o.K(V,s[V],`unknown property "${V}"`)]);return u}function wa(p){const s=p.value,u=p.key,m=p.style,v=p.styleSpec,x=v.terrain;let S=[];const P=o.J(s);if(s===void 0||P==="null")return S;if(P!=="object")return S=S.concat([new o.V("terrain",s,`object expected, ${P} found`)]),S;for(const O in s){const L=O.match(/^(.*)-transition$/),N=O.match(/^(.*)-use-theme$/);S=S.concat(N&&x[N[1]]?wr({key:O,value:s[O],valueSpec:{type:"string"},style:m,styleSpec:v}):L&&x[L[1]]&&x[L[1]].transition?wr({key:O,value:s[O],valueSpec:v.transition,style:m,styleSpec:v}):x[O]?wr({key:O,value:s[O],valueSpec:x[O],style:m,styleSpec:v}):[new o.K(O,s[O],`unknown property "${O}"`)])}if(s.source){const O=m.sources&&m.sources[s.source],L=O&&o.M(O.type);O?L!=="raster-dem"&&S.push(new o.V(u,s.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(u,s.source,`source "${s.source}" not found`))}else S.push(new o.V(u,s,'terrain is missing required property "source"'));return S}function zo(p){const s=p.value,u=p.style,m=p.styleSpec,v=m.fog;let x=[];const S=o.J(s);if(s===void 0)return x;if(S!=="object")return x=x.concat([new o.V("fog",s,`object expected, ${S} found`)]),x;for(const P in s){const O=P.match(/^(.*)-transition$/),L=P.match(/^(.*)-use-theme$/);x=x.concat(L&&v[L[1]]?wr({key:P,value:s[P],valueSpec:{type:"string"},style:u,styleSpec:m}):O&&v[O[1]]&&v[O[1]].transition?wr({key:P,value:s[P],valueSpec:m.transition,style:u,styleSpec:m}):v[P]?wr({key:P,value:s[P],valueSpec:v[P],style:u,styleSpec:m}):[new o.K(P,s[P],`unknown property "${P}"`)])}return x}const mc={"*":()=>[],array:Ei,boolean:function(p){const s=p.value,u=p.key,m=o.J(s);return m!=="boolean"?[new o.V(u,s,`boolean expected, ${m} found`)]:[]},number:xo,color:function(p){const s=p.key,u=p.value,m=o.J(u);return m!=="string"?[new o.V(s,u,`color expected, ${m} found`)]:o.a0.parseCSSColor(u)===null?[new o.V(s,u,`color expected, "${u}" found`)]:[]},enum:vs,filter:Zo,function:On,layer:pc,object:en,source:bo,model:o.a4,light:Za,"light-3d":Xa,terrain:wa,fog:zo,string:Xo,formatted:function(p){return Xo(p).length===0?[]:Ai(p)},resolvedImage:function(p){return Xo(p).length===0?[]:Ai(p)},projection:function(p){const s=p.value,u=p.styleSpec,m=u.projection,v=p.style;let x=[];const S=o.J(s);if(S==="object")for(const P in s)x=x.concat(wr({key:P,value:s[P],valueSpec:m[P],style:v,styleSpec:u}));else S!=="string"&&(x=x.concat([new o.V("projection",s,`object or string expected, ${S} found`)]));return x},import:function(p){const{value:s,styleSpec:u}=p,{data:m,...v}=s;Object.defineProperty(v,"__line__",{value:s.__line__,enumerable:!1});let x=en(o.L({},p,{value:v,valueSpec:u.import}));return o.M(v.id)===""&&x.push(new o.V(`${p.key}.id`,v,"import id can't be an empty string")),m&&(x=x.concat(si(m,u,{key:`${p.key}.data`}))),x},iconset:function(p){const s=p.value,u=p.key,m=p.styleSpec,v=p.style;if(!s.type)return[new o.V(u,s,'"type" is required')];const x=o.M(s.type);let S=[];if(S=S.concat(en({key:u,value:s,valueSpec:m[`iconset_${x}`],style:v,styleSpec:m})),x==="source"&&s.source){const P=v.sources&&v.sources[s.source],O=P&&o.M(P.type);P?O!=="raster-array"&&S.push(new o.V(u,s.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):S.push(new o.V(u,s.source,`source "${s.source}" not found`))}return S}};function wr(p,s=!1){const u=p.value,m=p.valueSpec,v=p.styleSpec;if(m.expression&&o.a2(o.M(u)))return On(p);if(m.expression&&o.S(o.U(u)))return Ai(p);if(m.type&&mc[m.type]){const x=mc[m.type](p);return s===!0&&x.length>0&&o.J(p.value)==="array"?Ai(p):x}return en(o.L({},p,{valueSpec:m.type?v[m.type]:m}))}function oi(p){const s=p.value,u=p.key,m=Xo(p);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new o.V(u,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new o.V(u,s,'"glyphs" url must include a "{range}" token'))),m}function si(p,s=o.a5,u={}){return wr({key:u.key||"",value:p,valueSpec:s.$root,styleSpec:s,style:p,objectElementValidators:{glyphs:oi,"*":()=>[]}})}function Fi(p,s=o.a5){return Me(si(p,s))}const xs=p=>Me(bo(p)),Sl=p=>Me(Za(p)),Tl=p=>Me(Xa(p)),Dt=p=>Me(wa(p)),El=p=>Me(zo(p)),Dy=p=>Me(function(s){const u=s.value,m=s.style,v=s.styleSpec,x=v.snow;let S=[];const P=o.J(u);if(u===void 0)return S;if(P!=="object")return S=S.concat([new o.V("snow",u,`object expected, ${P} found`)]),S;for(const O in u){const L=O.match(/^(.*)-transition$/);S=S.concat(L&&x[L[1]]&&x[L[1]].transition?wr({key:O,value:u[O],valueSpec:v.transition,style:m,styleSpec:v}):x[O]?wr({key:O,value:u[O],valueSpec:x[O],style:m,styleSpec:v}):[new o.K(O,u[O],`unknown property "${O}"`)])}return S}(p)),nf=p=>Me(function(s){const u=s.value,m=s.style,v=s.styleSpec,x=v.rain;let S=[];const P=o.J(u);if(u===void 0)return S;if(P!=="object")return S=S.concat([new o.V("rain",u,`object expected, ${P} found`)]),S;for(const O in u){const L=O.match(/^(.*)-transition$/);S=S.concat(L&&x[L[1]]&&x[L[1]].transition?wr({key:O,value:u[O],valueSpec:v.transition,style:m,styleSpec:v}):x[O]?wr({key:O,value:u[O],valueSpec:x[O],style:m,styleSpec:v}):[new o.K(O,u[O],`unknown property "${O}"`)])}return S}(p)),nn=p=>Me(pc(p)),Je=p=>Me(Zo(p)),se=p=>Me(qa(p)),ue=p=>Me(lo(p)),xe=p=>Me(o.a4(p));function Me(p){return p.slice().sort((s,u)=>s.line&&u.line?s.line-u.line:0)}function Ee(p,s){let u=!1;if(s&&s.length)for(const m of s)m instanceof o.K?o.w(m.message):(p.fire(new o.z(new Error(m.message))),u=!0);return u}let ze;class We extends o.E{constructor(s,u="flat"){super(),this._transitionable=new o.a6(ze||(ze=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(s,u),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u,m={}){this._validate(Sl,s,m)||(this._transitionable.setTransitionOrValue(s),this.id=u)}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,m){return(!m||m.validate!==!1)&&Ee(this,s.call(Fi,o.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Ne=class extends o.E{constructor(p,s,u,m,v){super(),this.scope=u,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),u,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s,this.worldview=v}get(){return this._transitionable.serialize()}set(p,s){this._transitionable.setTransitionOrValue(p,s)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new o.aa(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const s=p.value.expression;if(!s)return null;let u=-1,m=-1,v=1;for(const x of s.zoomStops)v=s.evaluate(new o.aa(x,{worldview:this.worldview})),v>.01?(u=x,m=-1):m=x;return v<.01&&u>0&&m>u?[u,m]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof o.ab}};const Xe=45,pt=65,Qe=.05;function kt(p,s,u,m){const v=o.af(Xe,pt,u),[x,S]=Yt(p,m);let P=1-Math.min(1,Math.exp((s-x)/(S-x)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*v*p.alpha}function Yt(p,s){const u=.5/Math.tan(.5*s);return[p.range[0]+u,p.range[1]+u]}function er(p,s,u,m,v){const x=o.ad([],[s,u,m],v.mercatorFogMatrix);return kt(p,o.ae(x),v.pitch,v._fov)}function xr(p,s,u,m,v,x,S){const P=[[u,m,0],[v,m,0],[v,x,0],[u,x,0]];let O=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const N of P){const V=o.ad([],N,s),$=o.ae(V);O=Math.min(O,$),L=Math.max(L,$)}return[kt(p,O,S.pitch,S._fov),kt(p,L,S.pitch,S._fov)]}class Sr extends o.E{constructor(s,u,m,v){super();const x=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(x,m,new Map(v)),this.set(s,v),this._transitioning=this._transitionable.untransitioned(),this._transform=u,this.properties=new o.ag(x),this.scope=m}get state(){const s=this._transform,u=s.projection.name==="globe",m=o.ah(s.zoom),v=this.properties.get("range"),x=[.5,3];return{range:u?[o.ai(x[0],v[0],m),o.ai(x[1],v[1],m)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,u,m={}){if(this._validate(El,s,m))return;const v=o.h({},s);for(const x of Object.keys(o.a5.fog))v[x]===void 0&&(v[x]=o.a5.fog[x].default);this._options=v,this._transitionable.setTransitionOrValue(this._options,u)}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(Xe,pt,s))*u.a}getOpacityAtLatLng(s,u){return this._transform.projection.supportsFog?function(m,v,x){const S=o.ac.fromLngLat(v),P=x.elevation?x.elevation.getAtPointOrZero(S):0;return er(m,S.x,S.y,P,x)}(this.state,s,u):0}getOpacityForTile(s){if(!this._transform.projection.supportsFog)return[1,1];const u=this._transform.calculateFogTileMatrix(s.toUnwrapped());return xr(this.state,u,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(s,u,m,v,x){return this._transform.projection.supportsFog?xr(this.state,s,u,m,v,x,this._transform):[1,1]}getFovAdjustedRange(s){return this._transform.projection.supportsFog?Yt(this.state,s):[0,1]}isVisibleOnFrustum(s){if(!this._transform.projection.supportsFog)return!1;const u=[4,5,6,7];for(const m of u){const v=s.points[m];let x;if(v[2]>=0)x=v;else{const S=s.points[m-4];x=o.ak(S,v,S[2]/(S[2]-v[2]))}if(er(this.state,x[0],x[1],0,this._transform)>=Qe)return!0}return!1}updateConfig(s){this._transitionable.setTransitionOrValue(this._options,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,m){return(!m||m.validate!==!1)&&Ee(this,s.call(Fi,o.h({value:u,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Pr,Gr,Rr,Cn,Yn=class extends o.E{constructor(p,s,u,m){super();const v=Pr||(Pr=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(v,u,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(v),this.scope=u}get state(){const p=this.properties.get("opacity"),s=this.properties.get("color"),u=this.properties.get("direction"),m=o.al(u[0]),v=-Math.max(o.al(u[1]),.01),x=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],S=this.properties.get("vignette"),P=this.properties.get("vignette-color");return P.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(s.r,s.g,s.b,s.a*p),direction:x,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:P}}get(){return this._transitionable.serialize()}set(p,s,u={}){if(this._validate(Dy,p,u))return;const m=o.h({},p);for(const v of Object.keys(o.a5.snow))m[v]===void 0&&(m[v]=o.a5.snow[v].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,s,u){return(!u||u.validate!==!1)&&Ee(this,p.call(Fi,o.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},Jn=class extends o.E{constructor(p,s,u,m){super();const v=Gr||(Gr=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(v,u,new Map(m)),this.set(p,m),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(v),this.scope=u}get state(){const p=this.properties.get("opacity"),s=this.properties.get("color"),u=this.properties.get("direction"),m=o.al(u[0]),v=-Math.max(o.al(u[1]),.01),x=[Math.cos(m)*Math.cos(v),Math.sin(m)*Math.cos(v),Math.sin(v)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(s.r,s.g,s.b,s.a*p),direction:x,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(p,s,u={}){if(this._validate(nf,p,u))return;const m=o.h({},p);for(const v of Object.keys(o.a5.rain))m[v]===void 0&&(m[v]=o.a5.rain[v].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,s,u){return(!u||u.validate!==!1)&&Ee(this,p.call(Fi,o.h({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class _n extends o.E{constructor(s,u,m,v){super(),this.scope=m,this._options=s,this.properties=new o.ag(u),this._transitionable=new o.a6(u,m,new Map(v)),this._transitionable.setTransitionOrValue(s.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(s){this._transitionable.setTransitionOrValue(this._options.properties,new Map(s))}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(s,u){this._options=s,this._transitionable.setTransitionOrValue(s.properties,u)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class sn{constructor(s,u,m,v){this.screenBounds=s,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(s,u){let m,v;if(s instanceof o.P||typeof s[0]=="number"){const x=o.P.convert(s);m=[x],v=u.isPointAboveHorizon(x)}else{const x=o.P.convert(s[0]),S=o.P.convert(s[1]),P=x.add(S)._div(2);m=[x,S],v=o.ao(x,S).every(O=>u.isPointAboveHorizon(O))&&u.isPointAboveHorizon(P)}return new sn(m,u.getCameraPoint(),v,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.ao(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),o.ap(v,s)}bufferedCameraGeometryGlobe(s){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],v=o.ao(u,m,s),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>m.y))+((x.x>u.x)+(x.x>m.x))){case 0:v[0]=x,v[4]=x.clone();break;case 1:v.splice(1,0,x);break;case 2:v[1]=x;break;case 3:v.splice(4,0,x);break;case 5:v.splice(2,0,x);break;case 6:v[3]=x;break;case 7:v.splice(3,0,x);break;case 8:v[2]=x}return v}containsTile(s,u,m,v=0){const x=s.queryPadding/u._pixelsPerMercatorPixel+1,S=m?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u);let P=s.tileID.wrap+(S.unwrapped?v:0);const O=S.polygon.map(ie=>o.aq(s.tileTransform,ie,P));if(!o.ar(O,0,0,o.aj,o.aj))return;P=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const L=this.screenGeometryMercator.polygon.map(ie=>o.as(s.tileTransform,ie,P)),N=L.map(ie=>new o.P(ie[0],ie[1])),V=u.getFreeCameraOptions().position||new o.ac(0,0,0),$=o.as(s.tileTransform,V,P),W=L.map(ie=>{const ae=o.at(ie,ie,$);return o.au(ae,ae),new o.av($,ae)}),re=o.aw(s,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:N,tilespaceRays:W,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(ee=o.ax(O),ee.min.x=o.ay(ee.min.x,0,o.aj),ee.min.y=o.ay(ee.min.y,0,o.aj),ee.max.x=o.ay(ee.max.x,0,o.aj),ee.max.y=o.ay(ee.max.y,0,o.aj),ee),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:re};var ee}_bufferedScreenMercator(s,u){const m=ai(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),u):{polygon:this.bufferedScreenGeometry(s).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=v,v}}_bufferedCameraMercator(s,u){const m=ai(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let v;return v=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),u):{polygon:this.bufferedCameraGeometry(s).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=v,v}}_projectAndResample(s,u){const m=function(x,S){const P=o.az([],S.pixelMatrix,S.globeMatrix),O=[0,-o.aB,0,1],L=[0,o.aB,0,1],N=[0,0,0,1];o.aA(O,O,P),o.aA(L,L,P),o.aA(N,N,P);const V=new o.P(O[0]/O[3],O[1]/O[3]),$=new o.P(L[0]/L[3],L[1]/L[3]),W=o.aC(x,V)&&O[3]<N[3],re=o.aC(x,$)&&L[3]<N[3];if(!W&&!re)return null;const ee=function(Te,we,Ce){for(let Oe=1;Oe<Te.length;Oe++){const Ve=hi(we.pointCoordinate3D(Te[Oe-1]).x),Ge=hi(we.pointCoordinate3D(Te[Oe]).x);if(Ce<0){if(Ve<Ge)return{idx:Oe,t:-Ve/(Ge-1-Ve)}}else if(Ge<Ve)return{idx:Oe,t:(1-Ve)/(Ge+1-Ve)}}return null}(x,S,W?-1:1);if(!ee)return null;const{idx:ie,t:ae}=ee;let ce=ie>1?vi(x.slice(0,ie),S):[],_e=ie<x.length?vi(x.slice(ie),S):[];ce=ce.map(Te=>new o.P(hi(Te.x),Te.y)),_e=_e.map(Te=>new o.P(hi(Te.x),Te.y));const be=[...ce];be.length===0&&be.push(_e[_e.length-1]);const Pe=o.ai(be[be.length-1].y,(_e.length===0?ce[0]:_e[0]).y,ae);let Ae;return Ae=W?[new o.P(0,Pe),new o.P(0,0),new o.P(1,0),new o.P(1,Pe)]:[new o.P(1,Pe),new o.P(1,1),new o.P(0,1),new o.P(0,Pe)],be.push(...Ae),_e.length===0?be.push(ce[0]):be.push(..._e),{polygon:be.map(Te=>new o.ac(Te.x,Te.y)),unwrapped:!1}}(s,u);if(m)return m;const v=function(x,S){let P=!1,O=-1/0,L=0;for(let V=0;V<x.length-1;V++)x[V].x>O&&(O=x[V].x,L=V);for(let V=0;V<x.length-1;V++){const $=(L+V)%(x.length-1),W=x[$],re=x[$+1];Math.abs(W.x-re.x)>.5&&(W.x<re.x?(W.x+=1,$===0&&(x[x.length-1].x+=1)):(re.x+=1,$+1===x.length-1&&(x[0].x+=1)),P=!0)}const N=o.aD(S.center.lng);return P&&N<Math.abs(N-1)&&x.forEach(V=>{V.x-=1}),{polygon:x,unwrapped:P}}(vi(s,u).map(x=>new o.P(hi(x.x),x.y)),u);return{polygon:v.polygon.map(x=>new o.ac(x.x,x.y)),unwrapped:v.unwrapped}}}function vi(p,s){return o.aE(p,u=>{const m=s.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function hi(p){return p<0?1+p%1:p%1}function ai(p){return 100*p|0}function po(p,s,u,m,v){const x=function(P,O){if(P)return v(P);if(O){if(p.url&&O.tiles&&p.tiles&&delete p.tiles,O.variants){if(!Array.isArray(O.variants))return v(new Error("variants must be an array"));for(const N of O.variants){if(N==null||typeof N!="object"||N.constructor!==Object)return v(new Error("variant must be an object"));if(!Array.isArray(N.capabilities))return v(new Error("capabilities must be an array"));if(N.capabilities.length===1&&N.capabilities[0]==="meshopt"){O=o.h(O,N);break}}}const L=o.aF(o.h({},O,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=s.canonicalizeTileset(L,p.url),v(null,L)}},S=function(P,O,L){if(!P)return null;if(!O&&!L)return P;L=L||P.worldview_default;const N=Object.values(P.language||{});if(N.length===0)return null;const V=Object.values(P.worldview||{});if(V.length===0)return null;const $=N.every(re=>re===O),W=V.every(re=>re===L);return $&&W?P:O in(P.language_options||{})||L in(P.worldview_options||{})?null:P.language_options&&P.worldview_options?P:null}(p.data,u,m);return S?o.q.frame(()=>x(null,S)):p.url?o.n(s.transformRequest(s.normalizeSourceURL(p.url,null,u,m),o.R.Source),x):o.q.frame(()=>{const{data:P,...O}=p;x(null,O)})}function cs(p,s){const u=Math.pow(2,s.z),m=Math.floor(o.aD(p.getWest())*u),v=Math.floor(o.aH(p.getNorth())*u),x=Math.ceil(o.aD(p.getEast())*u),S=Math.ceil(o.aH(p.getSouth())*u);return s.x>=m&&s.x<x&&s.y>=v&&s.y<S}class No{constructor(s,u,m){this.bounds=s?o.aG.convert(this.validateBounds(s)):null,this.minzoom=u||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}addExtraBounds(s){if(s){this.extraBounds||(this.extraBounds=[]);for(const u of s)this.extraBounds.push(o.aG.convert(this.validateBounds(u)))}}contains(s){if(s.z>this.maxzoom||s.z<this.minzoom||this.bounds&&!cs(this.bounds,s))return!1;if(!this.extraBounds)return!0;for(const u of this.extraBounds)if(cs(u,s))return!0;return!1}static fromTileJSON(s){if(!s.bounds&&!s.extra_bounds)return null;const u=new No(s.bounds,s.minzoom,s.maxzoom);return u.addExtraBounds(s.extra_bounds),u}}class of extends o.E{constructor(s,u,m,v){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(u,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},u),this._collectResourceTiming=!!u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new o.aI}load(s){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map.getWorldview();this._tileJSONRequest=po(this._options,this.map._requestManager,u,m,(v,x)=>{if(this._tileJSONRequest=null,this._loaded=!0,v)u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),m&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new o.z(v));else if(x){if(o.h(this,x),this.hasWorldviews=!!x.worldview_options,x.worldview_default&&(this.worldviewDefault=x.worldview_default),x.vector_layers){this.vectorLayers=x.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of x.vector_layers)this.vectorLayerIds.push(S.id),x.worldview&&x.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=No.fromTileJSON(x),zt(x.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}s&&s(v)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(s,u){const m=s.tileID.canonical.url(this.tiles,this.scheme),v=this.map._requestManager.normalizeTileURL(m),x=this.map._requestManager.transformRequest(v,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,P=S?{image:S.image.clone()}:null,O={request:x,data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,lut:P,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:s.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(m)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=u:s.request=s.actor.send("reloadTile",O,L.bind(this));else if(s.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",O,L.bind(this),void 0,!0);else{const N=o.aJ.call({deduped:this._deduped},O,(V,$)=>{V||!$?L.call(this,V):(O.data={cacheControl:$.cacheControl,expires:$.expires,rawData:$.rawData.slice(0)},s.actor&&s.actor.send("loadTile",O,L.bind(this),void 0,!0))},!0);s.request={cancel:N}}function L(N,V){return delete s.request,s.aborted?u(null):N&&N.status!==404?u(N):(V&&V.resourceTiming&&(s.resourceTiming=V.resourceTiming),this.map._refreshExpiredTiles&&V&&s.setExpiryData(V),s.loadVectorData(V,this.map.painter),o.aK(this.dispatcher),u(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,u){s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope}),s.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class wo extends o.E{constructor(s,u,m,v){super(),this.id=s,this.dispatcher=m,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},u),o.h(this,o.aF(u,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const u=this.map.getWorldview();this._tileJSONRequest=po(this._options,this.map._requestManager,null,u,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new o.z(m)):v&&(o.h(this,v),v.raster_layers&&(this.rasterLayers=v.raster_layers,this.rasterLayerIds=this.rasterLayers.map(x=>x.id)),this.tileBounds=No.fromTileJSON(v),zt(v.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),s&&s(m)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest();const s=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(s))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(s){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,u){const m=o.q.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=o.o(this.map._requestManager.transformRequest(v,o.R.Tile),(x,S,P,O)=>(delete s.request,s.aborted?(s.state="unloaded",u(null)):x?(s.state="errored",u(x)):S?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:P,expires:O}),s.setTexture(S,this.map.painter),s.state="loaded",o.aK(this.dispatcher),void u(null)):u(null)))}abortTile(s,u){s.request&&(s.request.cancel(),delete s.request),u&&u()}unloadTile(s,u){s.texture&&s.texture instanceof o.T?(s.destroy(!0),s.texture&&s.texture instanceof o.T&&this.map.painter.saveTileTexture(s.texture)):s.destroy(),u&&u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class gc extends wo{constructor(s,u,m,v){super(s,u,m,v),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},u)}triggerRepaint(s){const u=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);u&&u.enabled&&m&&u._clearRenderCacheForTile(m.id,s.tileID),this.map.triggerRepaint()}loadTile(s,u){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),v=this.map._requestManager.transformRequest(m,o.R.Tile),x={request:v,uid:s.uid,tileID:s.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};s.source=this.id,s.scope=this.scope,s.requestParams=v,s.actor||(s.actor=this.dispatcher.getActor());const S=(P,O,L,N)=>{if(delete s.request,s.aborted)return s.state="unloaded",u(null);if(P)return P.name==="AbortError"?void 0:(s.state="errored",u(P));if(this.map._refreshExpiredTiles&&O&&s.setExpiryData({cacheControl:L,expires:N}),this.partial)s.state="empty";else{if(!O)return u(null);s.state="loaded",s._isHeaderLoaded=!0,s._mrt=O}u(null)};s.request=this.partial?s.fetchHeader(void 0,S.bind(this)):s.actor.send("loadTile",x,S.bind(this),void 0,!0)}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(s,u){const m=s.texture;m&&m instanceof o.T?(s.destroy(!0),this.map.painter.saveTileTexture(m)):(s.destroy(),s.flushQueues(),s._isHeaderLoaded=!1,delete s._mrt,delete s.textureDescriptor),s.fbo&&(s.fbo.destroy(),delete s.fbo),delete s.request,delete s.requestParams,delete s.neighboringTiles,s.state="unloaded"}prepareTile(s,u,m){s._isHeaderLoaded&&(s.state!=="empty"&&(s.state="reloading"),s.fetchBand(u,m,(v,x)=>{if(v)return s.state="errored",this.fire(new o.z(v)),void this.triggerRepaint(s);x&&(s._isHeaderLoaded=!0,s.setTexture(x,this.map.painter),s.state="loaded",this.triggerRepaint(s))}))}getInitialBand(s){if(!this.rasterLayers)return 0;const u=this.rasterLayers.find(({id:x})=>x===s),m=u&&u.fields,v=m&&m.bands&&m.bands;return v?v[0]:0}getTextureDescriptor(s,u,m){if(!s)return;const v=u.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!v)return;let x=null;u instanceof o.aN?x=u.paint.get("raster-array-band"):u instanceof o.aO&&(x=u.paint.get("raster-particle-array-band"));const S=x||this.getInitialBand(v);if(S!=null)if(s.textureDescriptor){if(!s.updateNeeded(v,S)||m)return Object.assign({},s.textureDescriptor,{texture:s.texture})}else this.prepareTile(s,v,S)}getImages(s,u){const m=new Map;for(const v of s)for(const x of u){const[S,P]=x.split("/"),O=v.getLayer(S);if(!O||!O.hasBand(P)||!O.hasDataForBand(P))continue;const{bytes:L,tileSize:N,buffer:V}=O.getBandView(P),$=N+2*V,W={data:new o.r({width:$,height:$},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};m.set(x,W)}return m}}const dm={vector:of,raster:wo,"raster-dem":class extends wo{constructor(p,s,u,m){super(p,s,u,m),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(v,x){v&&(p.state="errored",s(v)),x&&(p.dem=x,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=o.o(this.map._requestManager.transformRequest(u,o.R.Tile),(function(v,x,S,P){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(v)p.state="errored",s(v);else if(x){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:P});const O=ImageBitmap&&x instanceof ImageBitmap&&o.t(),L=1-(x.width-o.aL(x.width))/2;L<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const N=O?x:o.q.getImageData(x,L),V={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:N,encoding:this.encoding,padding:L};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",V,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const s=p.canonical,u=Math.pow(2,s.z),m=(s.x-1+u)%u,v=s.x===0?p.wrap-1:p.wrap,x=(s.x+1+u)%u,S=s.x+1===u?p.wrap+1:p.wrap,P={};return P[new o.aM(p.overscaledZ,v,s.z,m,s.y).key]={backfilled:!1},P[new o.aM(p.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(P[new o.aM(p.overscaledZ,v,s.z,m,s.y-1).key]={backfilled:!1},P[new o.aM(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},P[new o.aM(p.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<u&&(P[new o.aM(p.overscaledZ,v,s.z,m,s.y+1).key]={backfilled:!1},P[new o.aM(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},P[new o.aM(p.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1}),P}},"raster-array":gc,geojson:class extends o.E{constructor(p,s,u,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=s.data,this._options=o.h({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.minzoom!==void 0&&(this.minzoom=s.minzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const v=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*v,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*v,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:o.aj,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*v,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter,dynamic:s.dynamic},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const s=new Map;for(const u of this._data.features)s.set(u.id,u);for(const u of p.features)s.set(u.id,u);this._data.features=[...s.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},s),this}getClusterLeaves(p,s,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:s,offset:u},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const s=o.h({append:p},this.workerOptions);s.scope=this.scope;const u=this._data;typeof u=="string"?(s.request=this.map._requestManager.transformRequest(o.q.resolveURL(u),o.R.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(u),this._pendingLoad=this.actor.send(`${this.type}.loadData`,s,(m,v)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new o.z(m));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(x.resourceTiming=v.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new o.A("data",x)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=o.C(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,s){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,v=m?{image:m.image.clone()}:null,x=this._partialReload,S={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:v,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:x,worldview:this.map.getWorldview()};p.request=this.actor.send(u,S,(P,O)=>x&&!O?(p.state="loaded",s(null)):(delete p.request,p.destroy(),p.aborted?s(null):P?s(P):(p.loadVectorData(O,this.map.painter,u==="reloadTile"),s(null))),void 0,u==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,s){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(p,s,u,m){super(p,s,u,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,o.R.Source).url);o.aQ(this.urls,(s,u)=>{this._loaded=!0,s?this.fire(new o.z(s)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(p,this.video,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(p,s,u,m){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=s}load(){const p=[];for(const s in this._options.models){const u=this._options.models[s],m=o.aS(this.map._requestManager.transformRequest(u.uri,o.R.Model).url).then(v=>{if(!v)return;const x=o.aT(v),S=new o.aU(s,u.position,u.orientation,x);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(v=>{this.fire(new o.z(new Error(`Could not load model ${s} from ${u.uri}: ${v.message}`)))});p.push(m)}Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(s=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${s.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,s){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(p,s,u,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=s,this.tiles=this._options.tiles,this.maxzoom=s.maxzoom||19,this.minzoom=s.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=u,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=po(this._options,this.map._requestManager,s,u,(m,v)=>{this._tileJSONRequest=null,this._loaded=!0,m?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),u&&u.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.z(m))):v&&(o.h(this,v),v.bounds&&(this.tileBounds=new No(v.bounds,this.minzoom,this.maxzoom)),zt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,s){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(u,o.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=s;else{if(p.buckets){const x=Object.values(p.buckets);for(const S of x)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,v.bind(this),void 0,!0);function v(x,S){return p.aborted?s(null):x&&x.status!==404?s(x):(this.map._refreshExpiredTiles&&S&&p.setExpiryData(S),p.loadModelData(S,this.map.painter),p.state="loaded",void s(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(p,s,u,m){super(p,s,u,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(x=>typeof x!="number"))||this.fire(new o.z(new o.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(s,this.canvas,s.gl.RGBA8,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends o.E{constructor(p,s,u,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new No(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:u,z:m}=p.canonical;return this._implementation.hasTile({x:s,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:u,y:m,z:v}=p.tileID.canonical,x=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:u,y:m,z:v},{signal:x.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",s(null)):S===void 0?(p.state="errored",s(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(P){return P instanceof ImageData||P instanceof HTMLCanvasElement||P instanceof ImageBitmap||P instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(p.state="errored",s(S))}),p.request.cancel=()=>x.abort()}loadTileData(p,s){p.setTexture(s,this.map.painter)}unloadTile(p,s){if(p.texture&&p.texture instanceof o.T?(p.destroy(!0),p.texture&&p.texture instanceof o.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:u,y:m,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:v})}s&&s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s&&s()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=o.C(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},sf=function(p,s,u,m){const v=new dm[s.type](p,s,u,m);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return o.aV(["load","abort","unload","serialize","prepare"],v),v};function af(p,s,u=""){return`${u}:${s.id||""}:${s.layer.id}:${function(m){if("layerId"in m)return`layer:${m.layerId}`;{const{featuresetId:v,importId:x}=m;return`featureset:${v}${x?`:import:${x}`:""}`}}(p.target)}`}function fm(p,s,u,m=""){if(p.uniqueFeatureID){const v=af(p,s,m);if(u.has(v))return!0;u.add(v)}return!1}function pm(p,s,u,m,v=!1){const x=s.sourceCache.transform,S=s.sourceCache.tilesIn(p,s.has3DLayers,v);S.sort(mm);const P=[];for(const O of S){const L=O.tile.queryRenderedFeatures(s,O,u,m,x,v);Object.keys(L).length&&P.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:L})}return P.length===0?{}:function(O){const L={},N={};for(const V of O){const $=V.queryResults,W=V.wrappedTileID,re=N[W]=N[W]||{};for(const ee in $){const ie=$[ee],ae=re[ee]=re[ee]||{},ce=L[ee]=L[ee]||[];for(const _e of ie)ae[_e.featureIndex]||(ae[_e.featureIndex]=!0,ce.push(_e))}}return L}(P)}function iu(p,s,u,m,v,x){const S={},P=m.queryRenderedSymbols(p),O=[];for(const L of Object.keys(P).map(Number))O.push(v[L]);O.sort(mm);for(const L of O){const N=L.featureIndex.lookupSymbolFeatures(P[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,s,u,x);for(const V in N){const $=S[V]=S[V]||[],W=N[V];W.sort((re,ee)=>{const ie=L.featureSortOrder;if(ie){const ae=ie.indexOf(re.featureIndex);return ie.indexOf(ee.featureIndex)-ae}return ee.featureIndex-re.featureIndex});for(const re of W)$.push(re)}}return S}function lf(p,s){const u=p.getRenderableIds().map(x=>p.getTileByID(x)),m=[],v={};for(let x=0;x<u.length;x++){const S=u[x],P=S.tileID.canonical.key;v[P]||(v[P]=!0,S.querySourceFeatures(m,s))}return m}function mm(p,s){const u=p.tileID,m=s.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function Sa(p,s){const u={};if(!s)return u;for(const m of p){const v=m.layerIds.map(x=>s.getLayer(x)).filter(Boolean);if(v.length!==0){m.layers=v,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>v.filter(S=>S.id===x)[0]));for(const x of v)u[x.fqid]=m}}return u}const Bs=32,ia=33,Al=new Uint16Array(8184);for(let p=0;p<2046;p++){let s=p+2,u=0,m=0,v=0,x=0,S=0,P=0;for(1&s?v=x=S=Bs:u=m=P=Bs;(s>>=1)>1;){const L=u+v>>1,N=m+x>>1;1&s?(v=u,x=m,u=S,m=P):(u=v,m=x,v=S,x=P),S=L,P=N}const O=4*p;Al[O+0]=u,Al[O+1]=m,Al[O+2]=v,Al[O+3]=x}const Ta=new Uint16Array(2178),Pl=new Uint8Array(1089),cf=new Uint16Array(1089);function Ka(p){return p===0?-.03125:p===32?.03125:0}const uf={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class ou{constructor(s,u,m,v,x,S){this.tileID=s,this.uid=o.a$(),this.uses=0,this.tileSize=u,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=x,v&&v.style&&(this._lastUpdatedBrightness=v.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",v&&v.transform&&(this.projection=v.transform.projection),this.worldview=S}registerFadeDuration(s){const u=s+this.timeAdded;u<o.q.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(s,u,m){if(this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=Sa(s.buckets,u.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const x=this.buckets[v];if(x instanceof o.b1){if(this.hasSymbolBuckets=!0,!m)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const x=this.buckets[v];if(x instanceof o.b1&&x.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const v in this.buckets){const x=this.buckets[v],S=u.style.getOwnLayer(v);if(!S)continue;const P=S.queryRadius(x);this.queryPadding=Math.max(this.queryPadding,P)}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage),s.lineAtlas&&(this.lineAtlas=s.lineAtlas),this._lastUpdatedBrightness=s.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(s,u,m){s&&(s.resourceTiming&&(this.resourceTiming=s.resourceTiming),this.buckets=Object.assign({},this.buckets,Sa(s.buckets,u.style)),s.featureIndex&&(this.latestFeatureIndex=s.featureIndex))}getBucket(s){return this.buckets[s.fqid]}upload(s){for(const v in this.buckets){const x=this.buckets[v];x.uploadPending()&&x.upload(s)}const u=s.gl,m=this.imageAtlas;m&&!m.uploaded&&(this.imageAtlasTexture=new o.T(s,m.image,u.RGBA8,{useMipmap:!!m.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(s,this.glyphAtlasImage,u.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(s,this.lineAtlas.image,u.R8),this.lineAtlas.uploaded=!0)}prepare(s,u,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture,m),!u||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const v=u.style.getBrightness();(this._lastUpdatedBrightness||v)&&(this._lastUpdatedBrightness&&v&&Math.abs(this._lastUpdatedBrightness-v)<.001||(this.updateBuckets(u,this._lastUpdatedBrightness!==v),this._lastUpdatedBrightness=v))}queryRenderedFeatures(s,u,m,v,x,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const P=function(O,L){const N=o.bn([],[.5*O.width,.5*-O.height,1]);return o.bo(N,N,[1,-1,0]),o.az(N,N,O.calculateProjMatrix(L.toUnwrapped())),Float32Array.from(N)}(x,this.tileID);return this.latestFeatureIndex.query(s,{tilespaceGeometry:u,pixelPosMatrix:P,transform:v,availableImages:m,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(s,u){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const v=m.loadVTLayers(),x=u?u.sourceLayer:"",S=v._geojsonTileLayer||v[x];if(!S)return;const P=o.b3(u&&u.filter),{z:O,x:L,y:N}=this.tileID.canonical,V={z:O,x:L,y:N};for(let $=0;$<S.length;$++){const W=S.feature($);if(P.needGeometry){const ie=o.b4(W,!0);if(!P.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),ie,this.tileID.canonical))continue}else if(!P.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),W))continue;const re=m.getId(W,x),ee=new o.b5(W,O,L,N,re);ee.tile=V,s.push(ee)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(s){const u=this.expirationTime;if(s.cacheControl){const m=o.b6(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let v=!1;if(this.expirationTime>m)v=!1;else if(u)if(this.expirationTime<u)v=!0;else{const x=this.expirationTime-u;x?this.expirationTime=m+Math.max(x,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(s){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&s&&this.updateBuckets(s)}updateBuckets(s,u){if(!this.latestFeatureIndex||!s.style)return;const m=this.latestFeatureIndex.loadVTLayers(),v=s.style.listImages(),x=s.style.getBrightness();for(const S in this.buckets){if(!s.style.hasLayer(S))continue;const P=this.buckets[S],O=P.layers[0],L=O.sourceLayer||"_geojsonTileLayer",N=m[L],V=s.style.getLayerSourceCache(O);let $={};V&&($=V._state.getState(L,void 0));const W=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},re=Object.keys($).length>0&&!u;re&&!P.stateDependentLayers.length&&!u||P.update($,N,v,W,re?P.stateDependentLayers:P.layers,u,x),(P instanceof o.b7||P instanceof o.b8)&&s._terrain&&s._terrain.enabled&&V&&P.uploadPending()&&s._terrain._clearRenderCacheForTile(V.id,this.tileID);const ee=s&&s.style&&s.style.getOwnLayer(S);ee&&(this.queryPadding=Math.max(this.queryPadding,ee.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=o.q.now()+s}setTexture(s,u){const m=u.context,v=m.gl;this.texture=this.texture||u.getTileTexture(s.width),this.texture&&this.texture instanceof o.T?this.texture.update(s):(this.texture=new o.T(m,s,v.RGBA8,{useMipmap:!0}),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE))}setDependencies(s,u){const m={};for(const v of u)m[v]=!0;this.dependencies[s]=m}hasDependency(s,u){for(const m of s){const v=this.dependencies[m];if(v){for(const x of u)if(v[x])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(s,u){if(!u||u.name==="mercator"||this._tileDebugBuffer)return;const m=o.b9(uf,this.tileID.canonical,this.tileTransform)[0],v=new o.ba,x=new o.bb;for(let S=0;S<m.length;S++){const{x:P,y:O}=m[S];v.emplaceBack(P,O),x.emplaceBack(S)}x.emplaceBack(0),this._tileDebugIndexBuffer=s.createIndexBuffer(x),this._tileDebugBuffer=s.createVertexBuffer(v,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,v.length,x.length)}_makeTileBoundsBuffers(s,u){if(this._tileBoundsBuffer||!u||u.name==="mercator")return;const m=o.b9(uf,this.tileID.canonical,this.tileTransform)[0];let v,x;if(this.isRaster){const S=function(P,O){const L=o.aW(P,O),N=Math.pow(2,P.z);for(let ie=0;ie<ia;ie++)for(let ae=0;ae<ia;ae++){const ce=o.aX((P.x+(ae+Ka(ae))/Bs)/N),_e=o.aY((P.y+(ie+Ka(ie))/Bs)/N),be=O.project(ce,_e),Pe=ie*ia+ae;Ta[2*Pe+0]=Math.round((be.x*L.scale-L.x)*o.aj),Ta[2*Pe+1]=Math.round((be.y*L.scale-L.y)*o.aj)}Pl.fill(0),cf.fill(0);for(let ie=2045;ie>=0;ie--){const ae=4*ie,ce=Al[ae+0],_e=Al[ae+1],be=Al[ae+2],Pe=Al[ae+3],Ae=ce+be>>1,Te=_e+Pe>>1,we=Ae+Te-_e,Ce=Te+ce-Ae,Oe=_e*ia+ce,Ve=Pe*ia+be,Ge=Te*ia+Ae,at=Math.hypot((Ta[2*Oe+0]+Ta[2*Ve+0])/2-Ta[2*Ge+0],(Ta[2*Oe+1]+Ta[2*Ve+1])/2-Ta[2*Ge+1])>=16;Pl[Ge]=Pl[Ge]||(at?1:0),ie<1022&&(Pl[Ge]=Pl[Ge]||Pl[(_e+Ce>>1)*ia+(ce+we>>1)]||Pl[(Pe+Ce>>1)*ia+(be+we>>1)])}const V=new o.aZ,$=new o.a_;let W=0;function re(ie,ae){const ce=ae*ia+ie;return cf[ce]===0&&(V.emplaceBack(Ta[2*ce+0],Ta[2*ce+1],ie*o.aj/Bs,ae*o.aj/Bs),cf[ce]=++W),cf[ce]-1}function ee(ie,ae,ce,_e,be,Pe){const Ae=ie+ce>>1,Te=ae+_e>>1;if(Math.abs(ie-be)+Math.abs(ae-Pe)>1&&Pl[Te*ia+Ae])ee(be,Pe,ie,ae,Ae,Te),ee(ce,_e,be,Pe,Ae,Te);else{const we=re(ie,ae),Ce=re(ce,_e),Oe=re(be,Pe);$.emplaceBack(we,Ce,Oe)}}return ee(0,0,Bs,Bs,Bs,0),ee(Bs,Bs,0,0,0,Bs),{vertices:V,indices:$}}(this.tileID.canonical,u);v=S.vertices,x=S.indices}else{v=new o.aZ,x=new o.a_;for(const{x:P,y:O}of m)v.emplaceBack(P,O,0,0);const S=o.be(v.int16.subarray(0,4*v.length),void 0,4);for(let P=0;P<S.length;P+=3)x.emplaceBack(S[P],S[P+1],S[P+2])}this._tileBoundsBuffer=s.createVertexBuffer(v,o.bf.members),this._tileBoundsIndexBuffer=s.createIndexBuffer(x),this._tileBoundsSegments=o.bd.simpleSegment(0,0,v.length,x.length)}_makeGlobeTileDebugBuffers(s,u){const m=u.projection;if(!m||m.name!=="globe"||u.freezeTileCoverage)return;const v=this.tileID.canonical,x=o.bg(v,u),S=o.bh(x),P=o.ah(u.zoom);let O;P>0&&(O=o.bi(new Float64Array(16),u.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(s,v,u,S,O,P),this._makeGlobeTileDebugTextBuffer(s,v,u,S,O,P)}_globePoint(s,u,m,v,x,S,P){let O=o.bj(s,u,m);if(S){const L=1<<m.z,N=o.aD(v.center.lng),V=o.aH(v.center.lat),$=(m.x+.5)/L-N;let W=0;$>.5?W=-1:$<-.5&&(W=1);let re=(s/o.aj+m.x)/L+W,ee=(u/o.aj+m.y)/L;re=(re-N)*v._pixelsPerMercatorPixel+N,ee=(ee-V)*v._pixelsPerMercatorPixel+V;const ie=[re*v.worldSize,ee*v.worldSize,0];o.ad(ie,ie,S),O=o.bk(O,ie,P)}return o.ad(O,O,x)}_makeGlobeTileDebugBorderBuffer(s,u,m,v,x,S){const P=new o.ba,O=new o.bb,L=new o.bl,N=($,W,re,ee,ie)=>{const ae=(re-$)/(ie-1),ce=(ee-W)/(ie-1),_e=P.length;for(let be=0;be<ie;be++){const Pe=$+be*ae,Ae=W+be*ce;P.emplaceBack(Pe,Ae);const Te=this._globePoint(Pe,Ae,u,m,v,x,S);L.emplaceBack(Te[0],Te[1],Te[2]),O.emplaceBack(_e+be)}},V=o.aj;N(0,0,V,0,16),N(V,0,V,V,16),N(V,V,0,V,16),N(0,V,0,0,16),this._tileDebugIndexBuffer=s.createIndexBuffer(O),this._tileDebugBuffer=s.createVertexBuffer(P,o.bc.members),this._globeTileDebugBorderBuffer=s.createVertexBuffer(L,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,P.length,O.length)}_makeGlobeTileDebugTextBuffer(s,u,m,v,x,S){const P=o.aj/4,O=new o.ba,L=new o.a_,N=new o.bl,V=25;L.reserve(32),O.reserve(V),N.reserve(V);const $=(W,re)=>V*W+re;for(let W=0;W<V;W++){const re=W*P;for(let ee=0;ee<V;ee++){const ie=ee*P;O.emplaceBack(ie,re);const ae=this._globePoint(ie,re,u,m,v,x,S);N.emplaceBack(ae[0],ae[1],ae[2])}}for(let W=0;W<4;W++)for(let re=0;re<4;re++){const ee=$(W,re),ie=$(W,re+1),ae=$(W+1,re),ce=$(W+1,re+1);L.emplaceBack(ee,ie,ae),L.emplaceBack(ae,ie,ce)}this._tileDebugTextIndexBuffer=s.createIndexBuffer(L),this._tileDebugTextBuffer=s.createVertexBuffer(O,o.bc.members),this._globeTileDebugTextBuffer=s.createVertexBuffer(N,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,V,32)}destroy(s=!1){for(const u in this.buckets)this.buckets[u].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!s&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class lh extends ou{constructor(s,u,m,v,x){super(s,u,m,v,x),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(s){return this._mrt&&this._mrt.getLayer(s)}setTexture(s,u){const m=u.context,v=m.gl;this.texture=this.texture||u.getTileTexture(s.width),this.texture&&this.texture instanceof o.T?this.texture.update(s,{premultiply:!1}):this.texture=new o.T(m,s,v.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(s=16384,u){const m=this._mrt=new o.bp(30),v=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(s-1)}});return this.entireBuffer=null,this.request=o.br(v,(x,S,P,O)=>{if(x)u(x);else try{const L=m.getHeaderLength(S);if(L>s)return void(this.request=this.fetchHeader(L,u));m.parseHeader(S),this._isHeaderLoaded=!0;let N=0;for(const V of Object.values(m.layers))N=Math.max(N,V.dataIndex[V.dataIndex.length-1].lastByte);S.byteLength>=N&&(this.entireBuffer=S),u(null,this.entireBuffer||S,P,O)}catch(L){u(L)}}),this.request}fetchBand(s,u,m){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void m(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void m(new Error("Can't fetch tile band without an actor"));let S;const P=(V,$)=>{S.complete(V,$),V?m(V):(this.updateTextureDescriptor(s,u),m(null,this.textureDescriptor&&this.textureDescriptor.img))},O=(V,$)=>{if(V)return m(V);const W=x.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:$,task:S},P,void 0,!0);this._workQueue.push(()=>{W&&W.cancel(),S.cancel()})},L=v.getLayer(s);if(!L)return void m(new Error(`Unknown sourceLayer "${s}"`));if(L.hasDataForBand(u))return this.updateTextureDescriptor(s,u),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const N=L.getDataRange([u]);if(S=v.createDecodingTask(N),!S||S.tasks.length)if(this.flushQueues(),this.entireBuffer)O(null,this.entireBuffer.slice(N.firstByte,N.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${N.firstByte}-${N.lastByte}`}}),$=o.br(V,O);this._fetchQueue.push(()=>{$.cancel(),S.cancel()})}else m(null)}updateNeeded(s,u){return(!this.textureDescriptor||this.textureDescriptor.band!==u||this.textureDescriptor.layer!==s)&&this.state!=="errored"}updateTextureDescriptor(s,u){if(!this._mrt)return;const m=this._mrt.getLayer(s);if(!m||!m.hasBand(u)||!m.hasDataForBand(u))return;const{bytes:v,tileSize:x,buffer:S,offset:P,scale:O}=m.getBandView(u),L=x+2*S,N=new o.r({width:L,height:L},v),V=this.texture;V&&V instanceof o.T&&V.update(N,{premultiply:!1}),this.textureDescriptor={layer:s,band:u,img:N,buffer:S,offset:P,tileSize:x,format:m.pixelFormat,mix:[O,256*O,65536*O,16777216*O]}}}class Ly{constructor(s,u){this.max=s,this.onRemove=u,this.reset()}reset(){for(const s in this.data)for(const u of this.data[s])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(s,u,m){const v=s.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const x={value:u,timeout:void 0};if(m!==void 0&&(x.timeout=setTimeout(()=>{this.remove(s,x)},m)),this.data[v].push(x),this.order.push(v),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value}getByKey(s){const u=this.data[s];return u?u[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,u){if(!this.has(s))return this;const m=s.wrapped().key,v=u===void 0?0:this.data[m].indexOf(u),x=this.data[m][v];return this.data[m].splice(v,1),x.timeout&&clearTimeout(x.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(x.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(s){const u=[];for(const m in this.data)for(const v of this.data[m])s(v.value)||u.push(v);for(const m of u)this.remove(m.value.tileID,m)}}class zy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,m){const v=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][v]=this.stateChanges[s][v]||{},o.h(this.stateChanges[s][v],m),this.deletedStates[s]===null){this.deletedStates[s]={};for(const x in this.state[s])x!==v&&(this.deletedStates[s][x]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][v]===null){this.deletedStates[s][v]={};for(const x in this.state[s][v])m[x]||(this.deletedStates[s][v][x]=null)}else for(const x in m)this.deletedStates[s]&&this.deletedStates[s][v]&&this.deletedStates[s][v][x]===null&&delete this.deletedStates[s][v][x]}removeFeatureState(s,u,m){if(this.deletedStates[s]===null)return;const v=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&u!==void 0)this.deletedStates[s][v]!==null&&(this.deletedStates[s][v]=this.deletedStates[s][v]||{},this.deletedStates[s][v][m]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][v])for(m in this.deletedStates[s][v]={},this.stateChanges[s][v])this.deletedStates[s][v][m]=null;else this.deletedStates[s][v]=null;else this.deletedStates[s]=null}getState(s,u){const m=this.state[s]||{},v=this.stateChanges[s]||{},x=this.deletedStates[s];if(x===null)return{};if(u!==void 0){const P=String(u),O=o.h({},m[P],v[P]);if(x){const L=x[u];if(L===null)return{};for(const N in L)delete O[N]}return O}const S=o.h({},m,v);if(x)for(const P in x)delete S[P];return S}initializeTileState(s,u){s.refreshFeatureState(u)}coalesceChanges(s,u){const m={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const x={};for(const S in this.stateChanges[v])this.state[v][S]||(this.state[v][S]={}),o.h(this.state[v][S],this.stateChanges[v][S]),x[S]=this.state[v][S];m[v]=x}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const x={};if(this.deletedStates[v]===null)for(const S in this.state[v])x[S]={},this.state[v][S]={};else for(const S in this.deletedStates[v]){if(this.deletedStates[v][S]===null)this.state[v][S]={};else if(this.state[v][S])for(const P of Object.keys(this.deletedStates[v][S]))delete this.state[v][S][P];x[S]=this.state[v][S]}m[v]=m[v]||{},o.h(m[v],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const v in s)s[v].refreshFeatureState(u)}}class us extends o.E{constructor(s,u,m){super(),this.id=s,this._onlySymbols=m,u.on("data",v=>{v.dataType==="source"&&v.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&v.dataType==="source"&&v.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),u.on("error",()=>{this._sourceErrored=!0}),this._source=u,this._tiles={},this._cache=new Ly(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new zy,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(s){this.map=s,this._minTileCacheSize=this._minTileCacheSize===void 0&&s?s._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&s?s._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const s in this._tiles)if(!this._tiles[s].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(s,u){return s.isSymbolTile=this._onlySymbols,s.isExtraShadowCaster=this._shadowCasterTiles[s.tileID.key],this._source.loadTile(s,u)}_unloadTile(s){if(this._source.unloadTile)return this._source.unloadTile(s)}_abortTile(s){if(this._source.abortTile)return this._source.abortTile(s)}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const m=this._tiles[u];m.upload(s),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(su).map(s=>s.key)}getRenderableIds(s,u){const m=[];for(const v in this._tiles)this._isIdRenderable(+v,s,u)&&m.push(this._tiles[v]);return s?m.sort((v,x)=>{const S=v.tileID,P=x.tileID,O=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),L=new o.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-P.overscaledZ||L.y-O.y||L.x-O.x}).map(v=>v.tileID.key):m.map(v=>v.tileID).sort(su).map(v=>v.key)}hasRenderableParent(s){const u=this.findLoadedParent(s,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(s,u,m){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(u||!this._tiles[s].holdingForFade())&&(m||!this._shadowCasterTiles[s])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(+s,"reloading")}}_reloadTile(s,u){const m=this._tiles[s];m&&(m.state!=="loading"&&(m.state=u),this._loadTile(m,this._tileLoaded.bind(this,m,s,u)))}_tileLoaded(s,u,m,v){if(v)if(s.state="errored",v.status!==404)this._source.fire(new o.z(v,{tile:s}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:s})),!(s.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}else s.timeAdded=o.q.now(),m==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),this._source.type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:s,coord:s.tileID,sourceCacheId:this.id}))}_backfillDEM(s){const u=this.getRenderableIds();for(let v=0;v<u.length;v++){const x=u[v];if(s.neighboringTiles&&s.neighboringTiles[x]){const S=this.getTileByID(x);m(s,S),m(S,s)}}function m(v,x){if(!v.dem||v.dem.borderReady)return;v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0;let S=x.tileID.canonical.x-v.tileID.canonical.x;const P=x.tileID.canonical.y-v.tileID.canonical.y,O=Math.pow(2,v.tileID.canonical.z),L=x.tileID.key;S===0&&P===0||Math.abs(P)>1||(Math.abs(S)>1&&(Math.abs(S+O)===1?S+=O:Math.abs(S-O)===1&&(S-=O)),x.dem&&v.dem&&(v.dem.backfillBorder(x.dem,S,P),v.neighboringTiles&&v.neighboringTiles[L]&&(v.neighboringTiles[L].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u,m,v){for(const x in this._tiles){let S=this._tiles[x];if(v[x]||!S.hasData()||S.tileID.overscaledZ<=u||S.tileID.overscaledZ>m)continue;let P=S.tileID;for(;S&&S.tileID.overscaledZ>u+1;){const L=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[L.key],S&&S.hasData()&&(P=L)}let O=P;for(;O.overscaledZ>u;)if(O=O.scaledTo(O.overscaledZ-1),s[O.key]){v[P.key]=P;break}}}findLoadedParent(s,u){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=u?m:null}for(let m=s.overscaledZ-1;m>=u;m--){const v=s.scaledTo(m),x=this._getLoadedTile(v);if(x)return x}}_getLoadedTile(s){const u=this._tiles[s.key];return u&&u.hasData()?u:this._cache.getByKey(this._source.reparseOverscaled?s.wrapped().key:s.canonical.key)}updateCacheSize(s,u){u=u||this._source.tileSize;const m=Math.ceil(s.width/u)+1,v=Math.ceil(s.height/u)+1,x=Math.floor(m*v*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,x):x,P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(P)}handleWrapJump(s){const u=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,u){const m={};for(const v in this._tiles){const x=this._tiles[v];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+u),m[x.tileID.key]=x}this._tiles=m;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(+v,this._tiles[v])}}update(s,u,m,v,x){if(this.transform=s,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(s,u),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let P,O=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const $=L.attenuationRange()[0],W=Math.floor($)-Math.log2(L.getDemUpscale());O>W&&(O=W)}if(this.used||this.usedForTerrain){if(this._source.tileID)P=s.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new o.aM($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y));else if(this.tileCoverLift!==0){const $=s.clone();$.tileCoverLift=this.tileCoverLift,P=$.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&s.projection.name==="globe"&&(P.push(new o.aM(1,0,1,0,0)),P.push(new o.aM(1,0,1,1,0)),P.push(new o.aM(1,0,1,0,1)),P.push(new o.aM(1,0,1,1,1)))}else if(P=s.coveringTiles({tileSize:u||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const $=this._source.hasTile.bind(this._source);P=P.filter(W=>$(W))}}else P=[];if(P.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!hf(this._source.type)){const $=s.coveringZoomLevel({tileSize:u||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),W=Math.min($,this._source.maxzoom);if(S){const re=s.extendTileCover(P,W);for(const ee of re)P.push(ee)}else if(x){const re=s.extendTileCover(P,W,this.transform._camera.forward());for(const ee of re)P.push(ee)}else if(this.castsShadows&&v){const re=s.extendTileCover(P,W,v);for(const ee of re)this._shadowCasterTiles[ee.key]=!0,P.push(ee)}}const N=this._updateRetainedTiles(P);if(hf(this._source.type)&&P.length!==0){const $={},W={},re=Object.keys(N);for(const ie of re){const ae=N[ie],ce=this._tiles[ie];if(!ce||ce.fadeEndTime&&ce.fadeEndTime<=o.q.now())continue;const _e=this.findLoadedParent(ae,Math.max(ae.overscaledZ-us.maxOverzooming,this._source.minzoom));_e&&(this._addTile(_e.tileID),$[_e.tileID.key]=_e.tileID),W[ie]=ae}const ee=P[P.length-1].overscaledZ;for(const ie in this._tiles){const ae=this._tiles[ie];if(N[ie]||!ae.hasData())continue;let ce=ae.tileID;for(;ce.overscaledZ>ee;){ce=ce.scaledTo(ce.overscaledZ-1);const _e=this._tiles[ce.key];if(_e&&_e.hasData()&&W[ce.key]){N[ie]=ae.tileID;break}}}for(const ie in $)N[ie]||(this._coveredTiles[ie]=!0,N[ie]=$[ie])}for(const $ in N)this._tiles[$].clearFadeHold();const V=o.bs(this._tiles,N);for(const $ of V){const W=this._tiles[$];W.hasSymbolBuckets&&!W.holdingForFade()?W.setHoldDuration(this.map._fadeDuration):W.hasSymbolBuckets&&!W.symbolFadeFinished()||this._removeTile(+$)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(+s)}_updateRetainedTiles(s){const u={};if(s.length===0)return u;const m={},v=s.reduce((L,N)=>Math.min(L,N.overscaledZ),1/0),x=s[0].overscaledZ,S=Math.max(x-us.maxOverzooming,this._source.minzoom),P=Math.max(x+us.maxUnderzooming,this._source.minzoom),O={};for(const L of s){const N=this._addTile(L);u[L.key]=L,N.hasData()||v<this._source.maxzoom&&(O[L.key]=L)}this._retainLoadedChildren(O,v,P,u);for(const L of s){let N=this._tiles[L.key];if(N.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const $=L.children(this._source.maxzoom)[0],W=this.getTile($);if(W&&W.hasData()){u[$.key]=$;continue}}else{const $=L.children(this._source.maxzoom);if(u[$[0].key]&&u[$[1].key]&&u[$[2].key]&&u[$[3].key])continue}let V=N.wasRequested();for(let $=L.overscaledZ-1;$>=S;--$){const W=L.scaledTo($);if(m[W.key]||(m[W.key]=!0,N=this.getTile(W),!N&&V&&(N=this._addTile(W)),N&&(u[W.key]=W,V=N.wasRequested(),N.hasData())))break}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const u=[];let m,v=this._tiles[s].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){m=this._loadedParentTiles[v.key];break}u.push(v.key);const x=v.scaledTo(v.overscaledZ-1);if(m=this._getLoadedTile(x),m)break;v=x}for(const x of u)this._loadedParentTiles[x]=m}}_addTile(s){let u=this._tiles[s.key];if(u)return u.isExtraShadowCaster!==!0||this._shadowCasterTiles[s.key]||this._reloadTile(s.key,"reloading"),u;u=this._cache.getAndRemove(s),u&&(this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,u)));const m=!!u;if(!m){const v=this.map?this.map.painter:null,x=this._source.tileSize*s.overscaleFactor();u=this._source.type==="raster-array"?new lh(s,x,this.transform.tileZoom,v,this._isRaster):new ou(s,x,this.transform.tileZoom,v,this._isRaster,this._source.worldview),this._loadTile(u,this._tileLoaded.bind(this,u,s.key,u.state))}return u.uses++,this._tiles[s.key]=u,m||this._source.fire(new o.A("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=u.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),u.uses>0||(u.hasData()&&u.state!=="reloading"||u.state==="empty"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(+s);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(s,u,m){const v=[],x=this.transform;if(!x)return v;const S=x.projection.name==="globe",P=o.aD(x.center.lng);for(const O in this._tiles){const L=this._tiles[O];if(m&&L.clearQueryDebugViz(),L.holdingForFade())continue;let N;if(S){const V=L.tileID.canonical;if(V.z===0){const $=[Math.abs(o.ay(P,...ch(V,-1))-P),Math.abs(o.ay(P,...ch(V,1))-P)];N=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(o.ay(P,...ch(V,-1))-P),Math.abs(o.ay(P,...ch(V,0))-P),Math.abs(o.ay(P,...ch(V,1))-P)];N=[$.indexOf(Math.min(...$))-1]}}else N=[0];for(const V of N){const $=s.containsTile(L,x,u,V);$&&v.push($)}}return v}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(s){return this._getRenderableCoordinates(s)}_getRenderableCoordinates(s,u){const m=this.getRenderableIds(s,u).map(x=>this._tiles[x].tileID),v=this.transform.projection.name==="globe";for(const x of m)x.projMatrix=this.transform.calculateProjMatrix(x.toUnwrapped()),x.expandedProjMatrix=v?this.transform.calculateProjMatrix(x.toUnwrapped(),!1,!0):x.projMatrix;return m}sortCoordinatesByDistance(s){const u=s.slice(),m=this.transform._camera.position,v=this.transform._camera.forward(),x={};for(const S of u){const P=1/(1<<S.canonical.z);x[S.key]=((S.canonical.x+.5)*P+S.wrap-m[0])*v[0]+((S.canonical.y+.5)*P-m[1])*v[1]-m[2]*v[2]}return u.sort((S,P)=>x[S.key]-x[P.key]),u}hasTransition(){if(this._source.hasTransition())return!0;if(hf(this._source.type))for(const s in this._tiles){const u=this._tiles[s];if(u.fadeEndTime!==void 0&&u.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(s,u,m){this._state.updateState(s=s||"_geojsonTileLayer",u,m)}removeFeatureState(s,u,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,m)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,m){const v=this._tiles[s];v&&v.setDependencies(u,m)}reloadTilesForDependencies(s,u){for(const m in this._tiles)this._tiles[m].hasDependency(s,u)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(s,u))}_preloadTiles(s,u){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(s,u))};return void this._source.on("data",O)}const m=new Map,v=Array.isArray(s)?s:[s],x=this.map.painter.terrain,S=this.usedForTerrain&&x?x.getScaledDemTileSize():this._source.tileSize;for(const O of v){const L=O.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const N of L)m.set(N.key,N);this.usedForTerrain&&O.updateElevation(!1)}const P=Array.from(m.values());o.bt(P,(O,L)=>{const N=new ou(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(N,V=>{this._source.type==="raster-dem"&&N.dem&&this._backfillDEM(N),L(V,N)})},u)}}function su(p,s){const u=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return p.overscaledZ-s.overscaledZ||m-u||s.canonical.y-p.canonical.y||s.canonical.x-p.canonical.x}function hf(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function ch(p,s){const u=1<<p.z;return[p.x/u+s,(p.x+1)/u+s]}us.maxOverzooming=10,us.maxUnderzooming=3;class rb{constructor(s){this.style=s,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const s=!1,u=!1;for(const m in this.style._mergedLayers){const v=this.style._mergedLayers[m];if(v.type==="fill-extrusion"||v.type==="building")this.layers.push({layer:v,visible:s,visibilityChanged:u});else if(v.type==="model"){const x=this.style.getLayerSource(v);x&&x.type==="batched-model"&&this.layers.push({layer:v,visible:s,visibilityChanged:u})}}}onNewFrame(s){this.layersGotHidden=!1;for(const u of this.layers){const m=u.layer;let v=!1;m.type==="fill-extrusion"?v=!m.isHidden(s)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="building"?v=!m.isHidden(s)&&m.paint.get("building-opacity")>0:m.type==="model"&&(v=!m.isHidden(s)&&m.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!v&&u.visible,u.visible=v}}updateZOffset(s,u){this.currentBuildingBuckets=[];for(const v of this.layers){const x=v.layer,S=this.style.getLayerSourceCache(x);let P=1;x.type==="fill-extrusion"?P=v.visible?x.paint.get("fill-extrusion-vertical-scale"):0:x.type==="building"&&(P=v.visible?x.paint.get("building-vertical-scale"):0);let O=S?S.getTile(u):null;if(!O&&S&&u.canonical.z>S.getSource().minzoom){let L=u.scaledTo(Math.min(S.getSource().maxzoom,u.overscaledZ-1));for(;L.overscaledZ>=S.getSource().minzoom&&(O=S.getTile(L),!O&&L.overscaledZ!==0);)L=L.scaledTo(L.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:O?O.getBucket(x):null,tileID:O?O.tileID:u,verticalScale:P})}s.hasAnyZOffset=!1;let m=!1;for(let v=0;v<s.symbolInstances.length;v++){const x=s.symbolInstances.get(v),S=x.zOffset,P=this._getHeightAtTileOffset(u,x.tileAnchorX,x.tileAnchorY);x.zOffset=P!==Number.NEGATIVE_INFINITY?P:S,m||S===x.zOffset||(m=!0),s.hasAnyZOffset||x.zOffset===0||(s.hasAnyZOffset=!0)}m&&(s.zOffsetBuffersNeedUpload=!0,s.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(s,u,m,v){let x=u,S=m;if(s.canonical.z!==v.canonical.z){const P=v.canonical,O=1/(1<<s.canonical.z-P.z);x=(u+s.canonical.x*o.aj)*O-P.x*o.aj|0,S=(m+s.canonical.y*o.aj)*O-P.y*o.aj|0}return{tileX:x,tileY:S}}_getHeightAtTileOffset(s,u,m){let v,x;for(let S=0;S<this.layers.length;++S){const P=this.layers[S].layer;if(P.type!=="fill-extrusion"&&P.type!=="building")continue;const{bucket:O,tileID:L,verticalScale:N}=this.currentBuildingBuckets[S];if(!O)continue;const{tileX:V,tileY:$}=this._mapCoordToOverlappingTile(s,u,m,L),W=O.getHeightAtTileCoord(V,$);W&&W.height!==void 0&&(W.hidden?v=W.height:x=Math.max(W.height*N,x||0))}if(x!==void 0)return x;for(let S=0;S<this.layers.length;++S){const P=this.layers[S];if(P.layer.type!=="model"||!P.visible)continue;const{bucket:O,tileID:L}=this.currentBuildingBuckets[S];if(!O)continue;const{tileX:N,tileY:V}=this._mapCoordToOverlappingTile(s,u,m,L),$=O.getHeightAtTileCoord(N,V);if($&&!$.hidden)return $.height===void 0&&v!==void 0?Math.min($.maxHeight,v)*$.verticalScale:$.height?$.height*$.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function nb(p,s){const u={};for(const m in p)m!=="ref"&&(u[m]=p[m]);return o.bu.forEach(m=>{m in s&&(u[m]=s[m])}),u}function df(p){p=p.slice();const s=Object.create(null);for(let u=0;u<p.length;u++)s[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=nb(p[u],s[p[u].ref]));return p}const tn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function gm(p,s,u){u.push({command:tn.addSource,args:[p,s[p]]})}function uh(p,s,u){s.push({command:tn.removeSource,args:[p]}),u[p]=!0}function ff(p,s,u,m){uh(p,u,m),gm(p,s,u)}function MA(p,s,u){let m;for(m in p[u])if(p[u].hasOwnProperty(m)&&m!=="data"&&!o.bv(p[u][m],s[u][m]))return!1;for(m in s[u])if(s[u].hasOwnProperty(m)&&m!=="data"&&!o.bv(p[u][m],s[u][m]))return!1;return!0}function pf(p,s,u,m,v,x){let S;for(S in s=s||{},p=p||{})p.hasOwnProperty(S)&&(o.bv(p[S],s[S])||u.push({command:x,args:[m,S,s[S],v]}));for(S in s)s.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(o.bv(p[S],s[S])||u.push({command:x,args:[m,S,s[S],v]}))}function au(p){return p.id}function _c(p,s){return p[s.id]=s,p}class Ny{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.ay(s,0,1);let u=1,m=this._distances[u];const v=s*this.paddedLength+this.padding;for(;m<v&&u<this._distances.length;)m=this._distances[++u];const x=u-1,S=this._distances[x],P=m-S,O=P>0?(v-S)/P:0;return this.points[x].mult(1-O).add(this.points[u].mult(O))}}class jy{constructor(s,u,m){const v=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(u/m);for(let S=0;S<this.xCellCount*this.yCellCount;S++)v.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,m,v,x){this._forEachCell(u,m,v,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(x)}insertCircle(s,u,m,v){this._forEachCell(u-v,m-v,u+v,m+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(m),this.circles.push(v)}_insertBoxCell(s,u,m,v,x,S){this.boxCells[x].push(S)}_insertCircleCell(s,u,m,v,x,S){this.circleCells[x].push(S)}_query(s,u,m,v,x,S){if(m<0||s>this.width||v<0||u>this.height)return!x&&[];const P=[];if(s<=0&&u<=0&&this.width<=m&&this.height<=v){if(x)return!0;for(let O=0;O<this.boxKeys.length;O++)P.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const L=this.circles[3*O],N=this.circles[3*O+1],V=this.circles[3*O+2];P.push({key:this.circleKeys[O],x1:L-V,y1:N-V,x2:L+V,y2:N+V})}return S?P.filter(S):P}return this._forEachCell(s,u,m,v,this._queryCell,P,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?P.length>0:P}_queryCircle(s,u,m,v,x){const S=s-m,P=s+m,O=u-m,L=u+m;if(P<0||S>this.width||L<0||O>this.height)return!v&&[];const N=[];return this._forEachCell(S,O,P,L,this._queryCellCircle,N,{hitTest:v,circle:{x:s,y:u,radius:m},seenUids:{box:{},circle:{}}},x),v?N.length>0:N}query(s,u,m,v,x){return this._query(s,u,m,v,!1,x)}hitTest(s,u,m,v,x){return this._query(s,u,m,v,!0,x)}hitTestCircle(s,u,m,v){return this._queryCircle(s,u,m,!0,v)}_queryCell(s,u,m,v,x,S,P,O){const L=P.seenUids,N=this.boxCells[x];if(N!==null){const $=this.bboxes;for(const W of N)if(!L.box[W]){L.box[W]=!0;const re=4*W;if(s<=$[re+2]&&u<=$[re+3]&&m>=$[re+0]&&v>=$[re+1]&&(!O||O(this.boxKeys[W]))){if(P.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[W],x1:$[re],y1:$[re+1],x2:$[re+2],y2:$[re+3]})}}}const V=this.circleCells[x];if(V!==null){const $=this.circles;for(const W of V)if(!L.circle[W]){L.circle[W]=!0;const re=3*W;if(this._circleAndRectCollide($[re],$[re+1],$[re+2],s,u,m,v)&&(!O||O(this.circleKeys[W]))){if(P.hitTest)return S.push(!0),!0;{const ee=$[re],ie=$[re+1],ae=$[re+2];S.push({key:this.circleKeys[W],x1:ee-ae,y1:ie-ae,x2:ee+ae,y2:ie+ae})}}}}}_queryCellCircle(s,u,m,v,x,S,P,O){const L=P.circle,N=P.seenUids,V=this.boxCells[x];if(V!==null){const W=this.bboxes;for(const re of V)if(!N.box[re]){N.box[re]=!0;const ee=4*re;if(this._circleAndRectCollide(L.x,L.y,L.radius,W[ee+0],W[ee+1],W[ee+2],W[ee+3])&&(!O||O(this.boxKeys[re])))return S.push(!0),!0}}const $=this.circleCells[x];if($!==null){const W=this.circles;for(const re of $)if(!N.circle[re]){N.circle[re]=!0;const ee=3*re;if(this._circlesCollide(W[ee],W[ee+1],W[ee+2],L.x,L.y,L.radius)&&(!O||O(this.circleKeys[re])))return S.push(!0),!0}}}_forEachCell(s,u,m,v,x,S,P,O){const L=this._convertToXCellCoord(s),N=this._convertToYCellCoord(u),V=this._convertToXCellCoord(m),$=this._convertToYCellCoord(v);for(let W=L;W<=V;W++)for(let re=N;re<=$;re++)if(x.call(this,s,u,m,v,this.xCellCount*re+W,S,P,O))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,m,v,x,S){const P=v-s,O=x-u,L=m+S;return L*L>P*P+O*O}_circleAndRectCollide(s,u,m,v,x,S,P){const O=(S-v)/2,L=Math.abs(s-(v+O));if(L>O+m)return!1;const N=(P-x)/2,V=Math.abs(u-(x+N));if(V>N+m)return!1;if(L<=O||V<=N)return!0;const $=L-O,W=V-N;return $*$+W*W<=m*m}}const lu={unknown:0,flipRequired:1,flipNotRequired:2},ib=Math.tan(85*Math.PI/180);function Cl(p,s,u,m,v,x,S){const P=o.bz();if(u)if(x.name==="globe"){const O=o.bA(v,s);o.az(P,P,O)}else{const O=o.bB([],S);P[0]=O[0],P[1]=O[1],P[4]=O[2],P[5]=O[3],m||o.by(P,P,v.angle)}else o.az(P,v.labelPlaneMatrix,p);return P}function _m(p,s,u,m,v,x,S){const P=Cl(p,s,u,m,v,x,S);return x.name==="globe"&&u||(P[2]=P[6]=P[10]=P[14]=0),P}function ym(p,s,u,m,v,x,S){if(u){if(x.name==="globe"){const P=Cl(p,s,u,m,v,x,S);return o.bi(P,P),o.az(P,p,P),P}{const P=o.bw(p),O=o.bx([]);return O[0]=S[0],O[1]=S[1],O[4]=S[2],O[5]=S[3],o.az(P,P,O),m||o.by(P,P,-v.angle),P}}return v.glCoordMatrix}function Ea(p,s,u,m){const v=[p,s,u,1];u?o.aA(v,v,m):dn(v,v,m);const x=v[3];return v[0]/=x,v[1]/=x,v[2]/=x,v}function mf(p,s){return Math.min(.5+p/s*.5,1.5)}function cu(p,s){const u=p[0]/p[3],m=p[1]/p[3];return u>=-s[0]&&u<=s[0]&&m>=-s[1]&&m<=s[1]}function vm(p,s,u,m,v,x,S,P,O,L){const N=u.transform,V=m?p.textSizeData:p.iconSizeData,$=o.bH(V,u.transform.zoom),W=N.projection.name==="globe",re=[256/u.width*2+1,256/u.height*2+1],ee=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ee.clear();let ie=null;W&&(ie=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ae=p.lineVertexArray,ce=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,_e=u.transform.width/u.transform.height;let be,Pe=!1;for(let Ae=0;Ae<ce.length;Ae++){const Te=ce.get(Ae),{numGlyphs:we,writingMode:Ce}=Te;if(Ce!==o.bI.vertical||Pe||be===o.bI.horizontal||(Pe=!0),be=Ce,(Te.hidden||Ce===o.bI.vertical)&&!Pe){hu(we,ee);continue}Pe=!1;const Oe=new o.P(Te.tileAnchorX,Te.tileAnchorY);let{x:Ve,y:Ge,z:at}=N.projection.projectTilePoint(Oe.x,Oe.y,L.canonical);if(O){const[Wt,qt,Vt]=O(Oe);Ve+=Wt,Ge+=qt,at+=Vt}const lt=[Ve,Ge,at,1];if(o.aA(lt,lt,s),!cu(lt,re)){hu(we,ee);continue}const yt=lt[3],Fe=mf(u.transform.getCameraToCenterDistance(N.projection),yt),tt=o.bJ(V,$,Te),Le=S?tt/Fe:tt*Fe,ht=Ea(Ve,Ge,at,v);if(ht[3]<=0){hu(we,ee);continue}let Ye={};const gt=o.al(p.layers[0].layout.get("text-max-angle")),Ot=Math.cos(gt),ut=S?null:O,Ct=uu(Te,Le,!1,P,s,v,x,p.glyphOffsetArray,ae,ee,ie,ht,Oe,Ye,_e,ut,N.projection,L,S,Ot);Pe=Ct.useVertical,ut&&Ct.needsFlipping&&(Ye={}),(Ct.notEnoughRoom||Pe||Ct.needsFlipping&&uu(Te,Le,!0,P,s,v,x,p.glyphOffsetArray,ae,ee,ie,ht,Oe,Ye,_e,ut,N.projection,L,S,Ot).notEnoughRoom)&&hu(we,ee)}m?(p.text.dynamicLayoutVertexBuffer.updateData(ee),ie&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(ie)):(p.icon.dynamicLayoutVertexBuffer.updateData(ee),ie&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(ie))}function Fy(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie){const{lineStartIndex:ae,glyphStartIndex:ce,segment:_e}=P,be=ce+P.numGlyphs,Pe=ae+P.lineLength,Ae=s.getoffsetX(ce),Te=s.getoffsetX(be-1),we=hh(p*Ae,u,m,v,x,S,_e,ae,Pe,O,L,N,V,$,!0,W,re,ee,ie);if(!we)return null;const Ce=hh(p*Te,u,m,v,x,S,_e,ae,Pe,O,L,N,V,$,!0,W,re,ee,ie);return Ce?{first:we,last:Ce}:null}function xm(p,s,u,m){return p===o.bI.horizontal&&Math.abs(m)>Math.abs(u)?{useVertical:!0}:p===o.bI.vertical?m>0?{needsFlipping:!0}:null:s!==lu.unknown&&function(v,x){return v===0||Math.abs(x/v)>ib}(u,m)?s===lu.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function uu(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae,ce,_e){const be=s/24,Pe=p.lineOffsetX*be,Ae=p.lineOffsetY*be,{lineStartIndex:Te,glyphStartIndex:we,numGlyphs:Ce,segment:Oe,writingMode:Ve,flipState:Ge}=p,at=Te+p.lineLength,lt=yt=>{if(N){const[ht,Ye,gt]=yt.up,Ot=L.length;o.bK(N,Ot+0,ht,Ye,gt),o.bK(N,Ot+1,ht,Ye,gt),o.bK(N,Ot+2,ht,Ye,gt),o.bK(N,Ot+3,ht,Ye,gt)}const[Fe,tt,Le]=yt.point;o.bL(L,Fe,tt,Le,yt.angle)};if(Ce>1){const yt=Fy(be,P,Pe,Ae,u,V,$,p,O,x,W,ee,!1,ie,ae,ce,_e);if(!yt)return{notEnoughRoom:!0};if(m&&!u){let[Fe,tt,Le]=yt.first.point,[ht,Ye,gt]=yt.last.point;[Fe,tt]=Ea(Fe,tt,Le,S),[ht,Ye]=Ea(ht,Ye,gt,S);const Ot=xm(Ve,Ge,(ht-Fe)*re,Ye-tt);if(p.flipState=Ot&&Ot.needsFlipping?lu.flipRequired:lu.flipNotRequired,Ot)return Ot}lt(yt.first);for(let Fe=we+1;Fe<we+Ce-1;Fe++){const tt=hh(be*P.getoffsetX(Fe),Pe,Ae,u,V,$,Oe,Te,at,O,x,W,ee,!1,!1,ie,ae,ce,_e);if(!tt)return L.length-=4*(Fe-we),{notEnoughRoom:!0};lt(tt)}lt(yt.last)}else{if(m&&!u){const Fe=Ea($.x,$.y,0,v),tt=Te+Oe+1,Le=new o.P(O.getx(tt),O.gety(tt)),ht=Ea(Le.x,Le.y,0,v),Ye=ht[3]>0?ht:By($,Le,Fe,1,v,void 0,ie,ae.canonical),gt=xm(Ve,Ge,(Ye[0]-Fe[0])*re,Ye[1]-Fe[1]);if(p.flipState=gt&&gt.needsFlipping?lu.flipRequired:lu.flipNotRequired,gt)return gt}const yt=hh(be*P.getoffsetX(we),Pe,Ae,u,V,$,Oe,Te,at,O,x,W,ee,!1,!1,ie,ae,ce,_e);if(!yt)return{notEnoughRoom:!0};lt(yt)}return{}}function bs(p,s,u,m,v){const{x,y:S,z:P}=m.projectTilePoint(p.x,p.y,s);if(!v)return Ea(x,S,P,u);const[O,L,N]=v(p);return Ea(x+O,S+L,P+N,u)}function By(p,s,u,m,v,x,S,P){const O=bs(p.sub(s)._unit()._add(p),P,v,S,x);return o.at(O,u,O),o.au(O,O),o.bE(O,u,O,m)}function hh(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae,ce){const _e=m?p-s:p+s;let be=_e>0?1:-1,Pe=0;m&&(be*=-1,Pe=Math.PI),be<0&&(Pe+=Math.PI);let Ae=P+S+(be>0?0:1)|0,Te=v,we=v,Ce=0,Oe=0;const Ve=Math.abs(_e),Ge=[],at=[];let lt=x,yt=lt,Fe=o.bC([]);const tt=()=>By(yt,lt,we,Ve-Ce+1,N,$,ee,ie.canonical);for(;Ce+Oe<=Ve;){if(Ae+=be,Ae<P||Ae>=O)return null;if(we=Te,yt=lt,Ge.push(we),W&&at.push(yt),lt=new o.P(L.getx(Ae),L.gety(Ae)),Te=V[Ae],!Te){const Vt=bs(lt,ie.canonical,N,ee,$);Te=Vt[3]>0?V[Ae]=Vt:tt()}Ce+=Oe;const Wt=o.at([],Te,we),qt=o.bD(we,Te);if(u&&qt>0&&Oe>0&&o.bG(Fe,Wt)/(Oe*qt)<ce)return null;Oe=qt,Fe=Wt}re&&$&&(V[Ae]&&(Te=tt(),Oe=o.bD(we,Te),Fe=o.at([],Te,we)),V[Ae]=Te);const Le=(Ve-Ce)/Oe,ht=lt.sub(yt)._mult(Le)._add(yt),Ye=o.bE([],we,Fe,Le);let gt=[0,0,1],Ot=Fe[0],ut=Fe[1];if(ae&&(gt=ee.upVector(ie.canonical,ht.x,ht.y),gt[0]!==0||gt[1]!==0||gt[2]!==1)){const Wt=[gt[2],0,-gt[0]],qt=o.bF([],gt,Wt);o.au(Wt,Wt),o.au(qt,qt),Ot=o.bG(Fe,Wt),ut=o.bG(Fe,qt)}if(u){const Wt=o.bF([],gt,Fe);o.au(Wt,Wt),o.bE(Ye,Ye,Wt,u*be)}const Ct=Pe+Math.atan2(ut,Ot);return Ge.push(Ye),W&&at.push(ht),{point:Ye,angle:Ct,path:Ge,tilePath:at,up:gt}}function hu(p,s){const u=s.length,m=u+4*p;s.resize(m),s.float32.fill(-1/0,4*u,4*m)}function dn(p,s,u){const m=s[0],v=s[1];return p[0]=u[0]*m+u[4]*v+u[12],p[1]=u[1]*m+u[5]*v+u[13],p[3]=u[3]*m+u[7]*v+u[15],p}const Aa=100;class RA{constructor(s,u,m=new jy(s.width+200,s.height+200,25),v=new jy(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=v,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Aa,this.screenBottomBoundary=s.height+Aa,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=u}placeCollisionBox(s,u,m,v,x,S,P,O){let L=m.projectedAnchorX,N=m.projectedAnchorY,V=m.projectedAnchorZ;const $=m.elevation,W=m.tileID,re=s.getProjection();if($&&W){const[Ae,Te,we]=re.upVector(W.canonical,m.tileAnchorX,m.tileAnchorY),Ce=re.upVectorScale(W.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;L+=Ae*$*Ce,N+=Te*$*Ce,V+=we*$*Ce}const ee=this.projectAndGetPerspectiveRatio(P,L,N,V,m.tileID,re.name==="globe"||!!$||this.transform.pitch>0,re),ie=S*ee.perspectiveRatio,ae=(m.x1*u+v.x-m.padding)*ie+ee.point.x,ce=(m.y1*u+v.y-m.padding)*ie+ee.point.y,_e=(m.x2*u+v.x+m.padding)*ie+ee.point.x,be=(m.y2*u+v.y+m.padding)*ie+ee.point.y,Pe=ee.perspectiveRatio<=.55||ee.occluded;return!this.isInsideGrid(ae,ce,_e,be)||!x&&this.grid.hitTest(ae,ce,_e,be,O)||Pe?{box:[],offscreen:!1,occluded:ee.occluded}:{box:[ae,ce,_e,be],offscreen:this.isOffscreen(ae,ce,_e,be),occluded:!1}}placeCollisionCircles(s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee){const ie=[],ae=this.transform.elevation,ce=s.getProjection(),_e=ae?ae.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,ce):null,be=new o.P(m.tileAnchorX,m.tileAnchorY);let{x:Pe,y:Ae,z:Te}=ce.projectTilePoint(be.x,be.y,ee.canonical);if(_e){const[gt,Ot,ut]=_e(be);Pe+=gt,Ae+=Ot,Te+=ut}const we=ce.name==="globe",Ce=this.projectAndGetPerspectiveRatio(P,Pe,Ae,Te,ee,we||!!ae||this.transform.pitch>0,ce),{perspectiveRatio:Oe}=Ce,Ve=(V?S/Oe:S*Oe)/o.bO,Ge=Ea(Pe,Ae,Te,O),at=m.lineOffsetX*Ve,lt=m.lineOffsetY*Ve,yt=o.al(s.layers[0].layout.get("text-max-angle")),Fe=Math.cos(yt),tt=Ce.signedDistanceFromCamera>0?Fy(Ve,x,at,lt,!1,Ge,be,m,v,O,{},ae&&!V?_e:null,V&&!!ae,ce,ee,V,Fe):null;let Le=!1,ht=!1,Ye=!0;if(tt&&!Ce.occluded){const gt=.5*W*Oe+re,Ot=new o.P(-100,-100),ut=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ct=new Ny,{first:Wt,last:qt}=tt,Vt=Wt.path.length;let tr=[];for(let yr=Vt-1;yr>=1;yr--)tr.push(Wt.path[yr]);for(let yr=1;yr<qt.path.length;yr++)tr.push(qt.path[yr]);const ir=2.5*gt;L&&(tr=tr.map(([yr,kr,pn],jn)=>(_e&&!we&&(pn=_e(jn<Vt-1?Wt.tilePath[Vt-1-jn]:qt.tilePath[jn-Vt+2])[2]),Ea(yr,kr,pn,L))),tr.some(yr=>yr[3]<=0)&&(tr=[]));let ar=[];if(tr.length>0){let yr=1/0,kr=-1/0,pn=1/0,jn=-1/0;for(const yn of tr)yr=Math.min(yr,yn[0]),pn=Math.min(pn,yn[1]),kr=Math.max(kr,yn[0]),jn=Math.max(jn,yn[1]);kr>=Ot.x&&yr<=ut.x&&jn>=Ot.y&&pn<=ut.y&&(ar=[tr.map(yn=>new o.P(yn[0],yn[1]))],(yr<Ot.x||kr>ut.x||pn<Ot.y||jn>ut.y)&&(ar=o.bM(ar,Ot.x,Ot.y,ut.x,ut.y)))}for(const yr of ar){Ct.reset(yr,.25*gt);let kr=0;kr=Ct.length<=.5*gt?1:Math.ceil(Ct.paddedLength/ir)+1;for(let pn=0;pn<kr;pn++){const jn=pn/Math.max(kr-1,1),yn=Ct.lerp(jn),bn=yn.x+Aa,xi=yn.y+Aa;ie.push(bn,xi,gt,0);const Cr=bn-gt,zr=xi-gt,Hr=bn+gt,Wn=xi+gt;if(Ye=Ye&&this.isOffscreen(Cr,zr,Hr,Wn),ht=ht||this.isInsideGrid(Cr,zr,Hr,Wn),!u&&this.grid.hitTestCircle(bn,xi,gt,$)&&(Le=!0,!N))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!N&&Le||!ht?[]:ie,offscreen:Ye,collisionDetected:Le,occluded:Ce.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let m=1/0,v=1/0,x=-1/0,S=-1/0;for(const N of s){const V=new o.P(N.x+Aa,N.y+Aa);m=Math.min(m,V.x),v=Math.min(v,V.y),x=Math.max(x,V.x),S=Math.max(S,V.y),u.push(V)}const P=this.grid.query(m,v,x,S).concat(this.ignoredGrid.query(m,v,x,S)),O={},L={};for(const N of P){const V=N.key;if(O[V.bucketInstanceId]===void 0&&(O[V.bucketInstanceId]={}),O[V.bucketInstanceId][V.featureIndex])continue;const $=[new o.P(N.x1,N.y1),new o.P(N.x2,N.y1),new o.P(N.x2,N.y2),new o.P(N.x1,N.y2)];o.bN(u,$)&&(O[V.bucketInstanceId][V.featureIndex]=!0,L[V.bucketInstanceId]===void 0&&(L[V.bucketInstanceId]=[]),L[V.bucketInstanceId].push(V.featureIndex))}return L}insertCollisionBox(s,u,m,v,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,m,v,x){const S=u?this.ignoredGrid:this.grid,P={bucketInstanceId:m,featureIndex:v,collisionGroupID:x};for(let O=0;O<s.length;O+=4)S.insertCircle(P,s[O],s[O+1],s[O+2])}projectAndGetPerspectiveRatio(s,u,m,v,x,S,P){const O=[u,m,v,1];let L=!1;v||this.transform.pitch>0?(o.aA(O,O,s),this.fogState&&x&&P.name!=="globe"&&(L=function($,W,re,ee,ie,ae){const ce=ae.calculateFogTileMatrix(ie),_e=[W,re,ee];return o.ad(_e,_e,ce),kt($,o.ae(_e),ae.pitch,ae._fov)}(this.fogState,u,m,v,x.toUnwrapped(),this.transform)>.9)):dn(O,O,s);const N=O[3];return{point:new o.P((O[0]/N+1)/2*this.transform.width+Aa,(-O[1]/N+1)/2*this.transform.height+Aa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(P)/N*.5,1.5),signedDistanceFromCamera:N,occluded:S&&O[2]>N||L}}isOffscreen(s,u,m,v){return m<Aa||s>=this.screenRightBoundary||v<Aa||u>this.screenBottomBoundary}isInsideGrid(s,u,m,v){return m>=0&&s<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=o.bx([]);return o.bo(s,s,[-100,-100,0]),s}}function $y(p,s,u){const m=s.createTileMatrix(p,p.worldSize,u.toUnwrapped());return o.az(new Float32Array(16),p.projMatrix,m)}function pr(p,s,u){if(s.projection.name===u.projection.name)return p.projMatrix;const m=u.clone();return m.setProjection(s.projection),$y(m,s.getProjection(),p)}function bm(p,s,u){return s.name===u.projection.name?p.projMatrix:$y(u,s,p)}class gf{constructor(s,u,m,v){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):v&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class du{constructor(s,u,m,v,x,S=!1){this.text=new gf(s?s.text:null,u,m,x),this.icon=new gf(s?s.icon:null,u,v,x),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $s{constructor(s,u,m,v=!1){this.text=s,this.icon=u,this.skipFade=m,this.clipped=v}}class Uy{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class dh{constructor(s,u,m,v,x){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=v,this.tileID=x}}class rr{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[s]}}function xn(p,s,u,m,v){const{horizontalAlign:x,verticalAlign:S}=o.bT(p),P=-(x-.5)*s,O=-(S-.5)*u,L=o.bU(p,m);return new o.P(P+L[0]*v,O+L[1]*v)}function ln(p,s,u,m,v){const x=new o.P(p,s);return u&&x._rotate(m?v:-v),x}class ws{constructor(s,u,m,v,x,S){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new RA(this.transform,x),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new rr(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,u,m,v,x=1){const S=m.getBucket(u),P=m.latestFeatureIndex;if(!S||!P||u.fqid!==S.layerIds[0])return;const O=S.layers[0].layout,L=S.layers[0].paint,N=m.collisionBoxArray,V=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),$=m.tileSize/o.aj,W=m.tileID.toUnwrapped();this.transform.setProjection(S.projection);const re=(ee=m.tileID,ie=S.getProjection(),ae=this.transform,ie.name===this.projection?ae.calculateProjMatrix(ee.toUnwrapped()):$y(ae,ie,ee));var ee,ie,ae;const ce=O.get("text-pitch-alignment")==="map",_e=O.get("text-rotation-alignment")==="map";u.compileFilter(u.options);const be=u.dynamicFilter(),Pe=u.dynamicFilterNeedsFeature(),Ae=this.transform.calculatePixelsToTileUnitsMatrix(m),Te=_m(re,m.tileID.canonical,ce,_e,this.transform,S.getProjection(),Ae);let we=null;if(ce){const tt=ym(re,m.tileID.canonical,ce,_e,this.transform,S.getProjection(),Ae);we=o.az([],this.transform.labelPlaneMatrix,tt)}let Ce=null;be&&m.latestFeatureIndex&&(Ce={unwrappedTileID:W,dynamicFilter:be,dynamicFilterNeedsFeature:Pe}),this.retainedQueryData[S.bucketInstanceId]=new dh(S.bucketInstanceId,P,S.sourceLayerIndex,S.index,m.tileID);const[Oe,Ve]=S.layers[0].layout.get("text-size-scale-range"),Ge=o.ay(x,Oe,Ve),[at,lt]=O.get("icon-size-scale-range"),yt=o.ay(x,at,lt),Fe={bucket:S,layout:O,paint:L,posMatrix:re,textLabelPlaneMatrix:Te,labelToScreenMatrix:we,clippingData:Ce,scale:V,textPixelRatio:$,holdingForFade:m.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:o.bH(S.textSizeData,this.transform.zoom,Ge),partiallyEvaluatedIconSize:o.bH(S.iconSizeData,this.transform.zoom,yt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(v)for(const tt of S.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:ht,symbolInstanceEnd:Ye}=tt;s.push({sortKey:Le,symbolInstanceStart:ht,symbolInstanceEnd:Ye,parameters:Fe})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae,ce){const{textOffset0:_e,textOffset1:be,crossTileID:Pe}=$,Ae=[_e,be],Te=xn(s,m,v,Ae,x),we=this.collisionIndex.placeCollisionBox(re,x,u,ln(Te.x,Te.y,S,P,this.transform.angle),V,O,L,N.predicate);if(ie){const Ce=re.getSymbolInstanceIconSize(ce,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,Ce,ie,ln(Te.x,Te.y,S,P,this.transform.angle),V,O,L,N.predicate).box.length===0)return}if(we.box.length>0){let Ce;return this.prevPlacement&&this.prevPlacement.variableOffsets[Pe]&&this.prevPlacement.placements[Pe]&&this.prevPlacement.placements[Pe].text&&(Ce=this.prevPlacement.variableOffsets[Pe].anchor),this.variableOffsets[Pe]={textOffset:Ae,width:m,height:v,anchor:s,textScale:x,prevAnchor:Ce},this.markUsedJustification(re,s,$,ee),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ee,$),this.placedOrientations[Pe]=ee),{shift:Te,placedGlyphBoxes:we}}}placeLayerBucketPart(s,u,m,v,x=1){const{bucket:S,layout:P,paint:O,posMatrix:L,textLabelPlaneMatrix:N,labelToScreenMatrix:V,clippingData:$,textPixelRatio:W,holdingForFade:re,collisionBoxArray:ee,partiallyEvaluatedTextSize:ie,partiallyEvaluatedIconSize:ae,collisionGroup:ce,latestFeatureIndex:_e}=s.parameters,be=P.get("text-optional"),Pe=P.get("icon-optional"),Ae=P.get("text-allow-overlap"),Te=P.get("icon-allow-overlap"),we=P.get("text-rotation-alignment")==="map",Ce=P.get("text-pitch-alignment")==="map",Oe=O.get("symbol-z-offset"),Ve=P.get("symbol-elevation-reference")==="sea",[Ge,at]=P.get("text-size-scale-range"),[lt,yt]=P.get("icon-size-scale-range"),Fe=o.ay(x,Ge,at),tt=o.ay(x,lt,yt);this.transform.setProjection(S.projection);let Le=Ae&&(Te||!S.hasIconData()||Pe),ht=Te&&(Ae||!S.hasTextData()||be);const Ye=!Oe.isConstant();!S.collisionArrays&&ee&&S.deserializeCollisionBoxes(ee),m&&v&&S.updateCollisionDebugBuffers(this.transform.zoom,ee,Fe,tt);const gt=(ut,Ct,Wt)=>{const{crossTileID:qt,numVerticalGlyphVertices:Vt}=ut;let tr=null;if($&&$.dynamicFilterNeedsFeature||Ye){const Mn=this.retainedQueryData[S.bucketInstanceId];tr=_e.loadFeature({featureIndex:ut.featureIndex,bucketIndex:Mn.bucketIndex,sourceLayerIndex:Mn.sourceLayerIndex,layoutVertexArrayOffset:0})}if($&&!(0,$.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},tr,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(ut.tileAnchorX,ut.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[qt]=new $s(!1,!1,!1,!0),void u.add(qt);const ir=Oe.evaluate(tr,{});if(u.has(qt))return;if(re)return void(this.placements[qt]=new $s(!1,!1,!1));let ar=!1,yr=!1,kr=!0,pn=!1,jn=!1,yn=null,bn={box:null,offscreen:null,occluded:null},xi={box:null},Cr=null,zr=null,Hr=null,Wn=0,$i=0,Fn=0;Wt.textFeatureIndex?Wn=Wt.textFeatureIndex:ut.useRuntimeCollisionCircles&&(Wn=ut.featureIndex),Wt.verticalTextFeatureIndex&&($i=Wt.verticalTextFeatureIndex);const an=Mn=>{Mn.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Zn=this.transform.elevation;Mn.elevation=Ve?ir:ir+(Zn?Zn.getAtTileOffset(Mn.tileID,Mn.tileAnchorX,Mn.tileAnchorY):0),Mn.elevation+=ut.zOffset},fi=Wt.textBox;if(fi){an(fi);const Mn=cn=>{let gi=o.bI.horizontal;if(S.allowVerticalPlacement&&!cn&&this.prevPlacement){const Eo=this.prevPlacement.placedOrientations[qt];Eo&&(this.placedOrientations[qt]=Eo,gi=Eo,this.markUsedOrientation(S,gi,ut))}return gi},Zn=(cn,gi)=>{if(S.allowVerticalPlacement&&Vt>0&&Wt.verticalTextBox){for(const Eo of S.writingModes)if(Eo===o.bI.vertical?(bn=gi(),xi=bn):bn=cn(),bn&&bn.box&&bn.box.length)break}else bn=cn()};if(P.get("text-variable-anchor")){let cn=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qt]){const ei=this.prevPlacement.variableOffsets[qt];cn.indexOf(ei.anchor)>0&&(cn=cn.filter(on=>on!==ei.anchor),cn.unshift(ei.anchor))}const gi=(ei,on,Ts)=>{const ds=S.getSymbolInstanceTextSize(ie,ut,this.transform.zoom,Ct),Gs=(ei.x2-ei.x1)*ds+2*ei.padding,Ia=(ei.y2-ei.y1)*ds+2*ei.padding,ua=ut.hasIconTextFit&&!Te?on:null;ua&&an(ua);let fs={box:[],offscreen:!1,occluded:!1};const kc=Ae?2*cn.length:cn.length;for(let Oa=0;Oa<kc;++Oa){const Dc=this.attemptAnchorPlacement(cn[Oa%cn.length],ei,Gs,Ia,ds,we,Ce,W,L,ce,Oa>=cn.length,ut,Ct,S,Ts,ua,ie,ae);if(Dc&&(fs=Dc.placedGlyphBoxes,fs&&fs.box&&fs.box.length)){ar=!0,yn=Dc.shift;break}}return fs};Zn(()=>gi(fi,Wt.iconBox,o.bI.horizontal),()=>{const ei=Wt.verticalTextBox;return ei&&an(ei),S.allowVerticalPlacement&&!(bn&&bn.box&&bn.box.length)&&Vt>0&&ei?gi(ei,Wt.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),bn&&(ar=bn.box,kr=bn.offscreen,pn=bn.occluded);const Eo=Mn(!(!bn||!bn.box));if(!ar&&this.prevPlacement){const ei=this.prevPlacement.variableOffsets[qt];ei&&(this.variableOffsets[qt]=ei,this.markUsedJustification(S,ei.anchor,ut,Eo))}}else{const cn=(gi,Eo)=>{const ei=S.getSymbolInstanceTextSize(ie,ut,this.transform.zoom,Ct,x),on=this.collisionIndex.placeCollisionBox(S,ei,gi,new o.P(0,0),Ae,W,L,ce.predicate);return on&&on.box&&on.box.length&&(this.markUsedOrientation(S,Eo,ut),this.placedOrientations[qt]=Eo),on};Zn(()=>cn(fi,o.bI.horizontal),()=>{const gi=Wt.verticalTextBox;return S.allowVerticalPlacement&&Vt>0&&gi?(an(gi),cn(gi,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Mn(!!(bn&&bn.box&&bn.box.length))}}if(Cr=bn,ar=Cr&&Cr.box&&Cr.box.length>0,kr=Cr&&Cr.offscreen,pn=Cr&&Cr.occluded,ut.useRuntimeCollisionCircles){const Mn=S.text.placedSymbolArray.get(ut.centerJustifiedTextSymbolIndex>=0?ut.centerJustifiedTextSymbolIndex:ut.verticalPlacedTextSymbolIndex),Zn=o.bJ(S.textSizeData,ie,Mn),cn=P.get("text-padding");zr=this.collisionIndex.placeCollisionCircles(S,Ae,Mn,S.lineVertexArray,S.glyphOffsetArray,Zn,L,N,V,m,Ce,ce.predicate,ut.collisionCircleDiameter*Zn/o.bO,cn,this.retainedQueryData[S.bucketInstanceId].tileID),ar=Ae||zr.circles.length>0&&!zr.collisionDetected,kr=kr&&zr.offscreen,pn=zr.occluded}if(Wt.iconFeatureIndex&&(Fn=Wt.iconFeatureIndex),Wt.iconBox){const Mn=Zn=>{an(Zn);const cn=ut.hasIconTextFit&&yn?ln(yn.x,yn.y,we,Ce,this.transform.angle):new o.P(0,0),gi=S.getSymbolInstanceIconSize(ae,this.transform.zoom,ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,gi,Zn,cn,Te,W,L,ce.predicate)};xi&&xi.box&&xi.box.length&&Wt.verticalIconBox?(Hr=Mn(Wt.verticalIconBox),yr=Hr.box.length>0):(Hr=Mn(Wt.iconBox),yr=Hr.box.length>0),kr=kr&&Hr.offscreen,jn=Hr.occluded}const Jr=be||ut.numHorizontalGlyphVertices===0&&Vt===0,Di=Pe||ut.numIconVertices===0;if(Jr||Di?Di?Jr||(yr=yr&&ar):ar=yr&&ar:yr=ar=yr&&ar,ar&&Cr&&Cr.box&&this.collisionIndex.insertCollisionBox(Cr.box,P.get("text-ignore-placement"),S.bucketInstanceId,xi&&xi.box&&$i?$i:Wn,ce.ID),yr&&Hr&&this.collisionIndex.insertCollisionBox(Hr.box,P.get("icon-ignore-placement"),S.bucketInstanceId,Fn,ce.ID),zr&&(ar&&this.collisionIndex.insertCollisionCircles(zr.circles,P.get("text-ignore-placement"),S.bucketInstanceId,Wn,ce.ID),m)){const Mn=S.bucketInstanceId;let Zn=this.collisionCircleArrays[Mn];Zn===void 0&&(Zn=this.collisionCircleArrays[Mn]=new Uy);for(let cn=0;cn<zr.circles.length;cn+=4)Zn.circles.push(zr.circles[cn+0]),Zn.circles.push(zr.circles[cn+1]),Zn.circles.push(zr.circles[cn+2]),Zn.circles.push(zr.collisionDetected?1:0)}const qn=S.projection.name!=="globe";Le=Le&&(qn||!pn),ht=ht&&(qn||!jn),this.placements[qt]=new $s(ar||Le,yr||ht,kr||S.justReloaded),u.add(qt)},Ot=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,Ot),S.elevationType==="road"&&S.updateRoadElevation(Ot.canonical),S.updateZOffset(),S.sortFeaturesByY){const ut=S.getSortedSymbolIndexes(this.transform.angle);for(let Ct=ut.length-1;Ct>=0;--Ct){const Wt=ut[Ct];gt(S.symbolInstances.get(Wt),Wt,S.collisionArrays[Wt])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const ut=S.getSortedIndexesByZOffset();for(let Ct=0;Ct<ut.length;++Ct){const Wt=ut[Ct];gt(S.symbolInstances.get(Wt),Wt,S.collisionArrays[Wt])}}else for(let ut=s.symbolInstanceStart;ut<s.symbolInstanceEnd;ut++)gt(S.symbolInstances.get(ut),ut,S.collisionArrays[ut]);if(m&&S.bucketInstanceId in this.collisionCircleArrays){const ut=this.collisionCircleArrays[S.bucketInstanceId];o.bi(ut.invProjMatrix,L),ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(s,u,m,v){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:O,crossTileID:L}=m,N=o.bV(u),V=v===o.bI.vertical?O:N==="left"?x:N==="center"?S:N==="right"?P:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=V>=0&&x!==V?0:L),S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=V>=0&&S!==V?0:L),P>=0&&(s.text.placedSymbolArray.get(P).crossTileID=V>=0&&P!==V?0:L),O>=0&&(s.text.placedSymbolArray.get(O).crossTileID=V>=0&&O!==V?0:L)}markUsedOrientation(s,u,m){const v=u===o.bI.horizontal||u===o.bI.horizontalOnly?u:0,x=u===o.bI.vertical?u:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:L}=m,N=s.text.placedSymbolArray;S>=0&&(N.get(S).placedOrientation=v),P>=0&&(N.get(P).placedOrientation=v),O>=0&&(N.get(O).placedOrientation=v),L>=0&&(N.get(L).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(s):1,x=u?u.opacities:{},S=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(const O in this.placements){const L=this.placements[O],N=x[O];N?(this.opacities[O]=new du(N,v,L.text,L.icon,null,L.clipped),m=m||L.text!==N.text.placed||L.icon!==N.icon.placed):(this.opacities[O]=new du(null,v,L.text,L.icon,L.skipFade,L.clipped),m=m||L.text||L.icon)}for(const O in x){const L=x[O];if(!this.opacities[O]){const N=new du(L,v,!1,!1);N.isHidden()||(this.opacities[O]=N,m=m||L.text.placed||L.icon.placed)}}for(const O in S)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=S[O]);for(const O in P)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=P[O]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u,m,v){const x=new Set;for(const S of u){const P=S.getBucket(s);P&&S.latestFeatureIndex&&s.fqid===P.layerIds[0]&&(this.updateBucketOpacities(P,x,S,S.collisionBoxArray,m,v,S.tileID,s.scope),P.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(P,S.tileID),P.elevationType==="road"&&P.updateRoadElevation(S.tileID.canonical),P.updateZOffset())}}updateBucketOpacities(s,u,m,v,x,S,P,O){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const L=s.layers[0].layout,N=s.layers[0].paint,V=!!s.layers[0].dynamicFilter(),$=new du(null,0,!1,!1,!0),W=L.get("text-allow-overlap"),re=L.get("icon-allow-overlap"),ee=L.get("text-variable-anchor"),ie=L.get("text-rotation-alignment")==="map",ae=L.get("text-pitch-alignment")==="map",ce=N.get("symbol-z-offset"),_e=L.get("symbol-elevation-reference")==="sea",be=!ce.isConstant(),Pe=new du(null,0,W&&(re||!s.hasIconData()||L.get("icon-optional")),re&&(W||!s.hasTextData()||L.get("text-optional")),!0);!s.collisionArrays&&v&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(v);const Ae=(we,Ce,Oe)=>{for(let Ve=0;Ve<Ce/4;Ve++)we.opacityVertexArray.emplaceBack(Oe)};let Te=0;S&&s.updateReplacement(P,S);for(let we=0;we<s.symbolInstances.length;we++){const Ce=s.symbolInstances.get(we),{numHorizontalGlyphVertices:Oe,numVerticalGlyphVertices:Ve,crossTileID:Ge,numIconVertices:at,tileAnchorX:lt,tileAnchorY:yt}=Ce;let Fe=null;const tt=this.retainedQueryData[s.bucketInstanceId];be&&Ce&&tt&&(Fe=m.latestFeatureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:tt.bucketIndex,sourceLayerIndex:tt.sourceLayerIndex,layoutVertexArrayOffset:0}));const Le=ce.evaluate(Fe,{}),ht=u.has(Ge);let Ye=this.opacities[Ge];ht?Ye=$:Ye||(Ye=Pe,this.opacities[Ge]=Ye),u.add(Ge);const gt=Oe>0||Ve>0,Ot=at>0,ut=this.placedOrientations[Ge],Ct=ut===o.bI.vertical,Wt=ut===o.bI.horizontal||ut===o.bI.horizontalOnly;!gt&&!Ot||Ye.isHidden()||Te++;let qt=!1;if((gt||Ot)&&S)for(const Vt of s.activeReplacements){if(o.bP(Vt,x,o.bQ.Symbol,O)||Vt.min.x>lt||lt>Vt.max.x||Vt.min.y>yt||yt>Vt.max.y)continue;const tr=o.bR(lt,yt,P.canonical,Vt.footprintTileId.canonical);if(qt=o.bS(tr,Vt.footprint),qt)break}if(gt){const Vt=qt?yc:fh(Ye.text);Ae(s.text,Oe,Ct?yc:Vt),Ae(s.text,Ve,Wt?yc:Vt);const tr=Ye.text.isHidden(),{leftJustifiedTextSymbolIndex:ir,centerJustifiedTextSymbolIndex:ar,rightJustifiedTextSymbolIndex:yr,verticalPlacedTextSymbolIndex:kr}=Ce,pn=s.text.placedSymbolArray,jn=tr||Ct?1:0;ir>=0&&(pn.get(ir).hidden=jn),ar>=0&&(pn.get(ar).hidden=jn),yr>=0&&(pn.get(yr).hidden=jn),kr>=0&&(pn.get(kr).hidden=tr||Wt?1:0);const yn=this.variableOffsets[Ge];yn&&this.markUsedJustification(s,yn.anchor,Ce,ut);const bn=this.placedOrientations[Ge];bn&&(this.markUsedJustification(s,"left",Ce,bn),this.markUsedOrientation(s,bn,Ce))}if(Ot){const Vt=qt?yc:fh(Ye.icon),{placedIconSymbolIndex:tr,verticalPlacedIconSymbolIndex:ir}=Ce,ar=s.icon.placedSymbolArray,yr=Ye.icon.isHidden()?1:0;tr>=0&&(Ae(s.icon,at,Ct?yc:Vt),ar.get(tr).hidden=yr),ir>=0&&(Ae(s.icon,Ce.numVerticalIconVertices,Wt?yc:Vt),ar.get(ir).hidden=yr)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Vt=s.collisionArrays[we];if(Vt){let tr=new o.P(0,0),ir=!0;if(Vt.textBox||Vt.verticalTextBox){if(ee){const yr=this.variableOffsets[Ge];yr?(tr=xn(yr.anchor,yr.width,yr.height,yr.textOffset,yr.textScale),ie&&tr._rotate(ae?this.transform.angle:-this.transform.angle)):ir=!1}V&&(ir=!Ye.clipped),Vt.textBox&&Il(s.textCollisionBox.collisionVertexArray,Ye.text.placed,!ir||Ct,Le,_e,tr.x,tr.y),Vt.verticalTextBox&&Il(s.textCollisionBox.collisionVertexArray,Ye.text.placed,!ir||Wt,Le,_e,tr.x,tr.y)}const ar=ir&&!!(!Wt&&Vt.verticalIconBox);Vt.iconBox&&Il(s.iconCollisionBox.collisionVertexArray,Ye.icon.placed,ar,Le,_e,Ce.hasIconTextFit?tr.x:0,Ce.hasIconTextFit?tr.y:0),Vt.verticalIconBox&&Il(s.iconCollisionBox.collisionVertexArray,Ye.icon.placed,!ar,Le,_e,Ce.hasIconTextFit?tr.x:0,Ce.hasIconTextFit?tr.y:0)}}}if(s.fullyClipped=Te===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=we.invProjMatrix,s.placementViewportMatrix=we.viewportMatrix,s.collisionCircleArray=we.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function Il(p,s,u,m,v,x,S){p.emplaceBack(s?1:0,u?1:0,x||0,S||0,m,v?1:0),p.emplaceBack(s?1:0,u?1:0,x||0,S||0,m,v?1:0),p.emplaceBack(s?1:0,u?1:0,x||0,S||0,m,v?1:0),p.emplaceBack(s?1:0,u?1:0,x||0,S||0,m,v?1:0)}const fn=Math.pow(2,25),wm=Math.pow(2,24),_f=Math.pow(2,17),yf=Math.pow(2,16),Ko=Math.pow(2,9),Gi=Math.pow(2,8),kA=Math.pow(2,1);function fh(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,u=Math.floor(127*p.opacity);return u*fn+s*wm+u*_f+s*yf+u*Ko+s*Gi+u*kA+s}const yc=0;class vf{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,u,m,v,x,S){const P=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(P,v,s[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((O,L)=>O.sortKey-L.sortKey));this._currentPartIndex<P.length;){const O=P[this._currentPartIndex];if(u.placeLayerBucketPart(O,this._seenCrossTileIDs,m,O.symbolInstanceStart===0,S),this._currentPartIndex++,x())return!0}return!1}}class Sm{constructor(s,u,m,v,x,S,P,O,L){this.placement=new ws(s,x,S,P,O,L),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(s,u,m,v,x){const S=o.q.now(),P=()=>{const O=o.q.now()-S;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=u[s[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=L)&&(!O.maxzoom||O.maxzoom>L)){const N=O,V=N.layout.get("symbol-z-elevate"),$=N.layout.get("symbol-sort-key").constantOr(1)!==void 0,W=N.layout.get("symbol-z-order"),re=W==="viewport-y"||W==="auto"&&!(W!=="viewport-y"&&$),ee=N.layout.get("text-allow-overlap")||N.layout.get("icon-allow-overlap")||N.layout.get("text-ignore-placement")||N.layout.get("icon-ignore-placement"),ie=re&&ee,ae=this._inProgressLayer=this._inProgressLayer||new vf(N),ce=o.C(O.source,O.scope);if(ae.continuePlacement(V||ie?v[ce]:m[ce],this.placement,this._showCollisionBoxes,O,P,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const xf=512/o.aj/2;class Tm{constructor(s,u,m){this.tileID=s,this.bucketInstanceId=m,this.index=new o.bW(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const v=s.canonical.x*o.aj,x=s.canonical.y*o.aj;for(let S=0;S<u.length;S++){const{key:P,crossTileID:O,tileAnchorX:L,tileAnchorY:N}=u.get(S),V=Math.floor((v+L)*xf),$=Math.floor((x+N)*xf);this.index.add(V,$),this.keys.push(P),this.crossTileIDs.push(O)}this.index.finish()}findMatches(s,u,m){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),x=xf/Math.pow(2,u.canonical.z-this.tileID.canonical.z),S=u.canonical.x*o.aj,P=u.canonical.y*o.aj;for(let O=0;O<s.length;O++){const L=s.get(O);if(L.crossTileID)continue;const{key:N,tileAnchorX:V,tileAnchorY:$}=L,W=Math.floor((S+V)*x),re=Math.floor((P+$)*x),ee=this.index.range(W-v,re-v,W+v,re+v).sort((ie,ae)=>ie-ae);for(const ie of ee){const ae=this.crossTileIDs[ie];if(this.keys[ie]===N&&!m.has(ae)){m.add(ae),L.crossTileID=ae;break}}}}}class Yo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ol{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(u!==0)for(const m in this.indexes){const v=this.indexes[m],x={};for(const S in v){const P=v[S];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),x[P.tileID.key]=P}this.indexes[m]=x}this.lng=s}addBucket(s,u,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const v=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const S=this.indexes[x];if(Number(x)>s.overscaledZ)for(const P in S){const O=S[P];O.tileID.isChildOf(s)&&O.findMatches(u.symbolInstances,s,v)}else{const P=S[s.scaledTo(Number(x)).key];P&&P.findMatches(u.symbolInstances,s,v)}}for(let x=0;x<u.symbolInstances.length;x++){const S=u.symbolInstances.get(x);S.crossTileID||(S.crossTileID=m.generate(),v.add(S.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Tm(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const m of u.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let u=!1;for(const m in this.indexes){const v=this.indexes[m];for(const x in v)s[v[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,v[x]),delete v[x],u=!0)}return u}}class hs{constructor(){this.layerIndexes={},this.crossTileIDs=new Yo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,m,v){let x=this.layerIndexes[s.fqid];x===void 0&&(x=this.layerIndexes[s.fqid]=new Ol);let S=!1;const P={};v.name!=="globe"&&x.handleWrapJump(m);for(const O of u){const L=O.getBucket(s);L&&s.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(O.tileID,L,this.crossTileIDs)&&(S=!0),P[L.bucketInstanceId]=!0)}return x.removeStaleBuckets(P)&&(S=!0),S}pruneUnusedLayers(s){const u={};s.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const fu=771;class $r{constructor(s,u,m,v){this.blendFunction=s,this.blendColor=u.toNonPremultipliedRenderColor(null),this.mask=m,this.blendEquation=v}}$r.Replace=[1,0,1,0],$r.disabled=new $r($r.Replace,o.am.transparent,[!1,!1,!1,!1]),$r.unblended=new $r($r.Replace,o.am.transparent,[!0,!0,!0,!0]),$r.alphaBlended=new $r([1,fu,1,fu],o.am.transparent,[!0,!0,!0,!0]),$r.alphaBlendedNonPremultiplied=new $r([770,fu,770,fu],o.am.transparent,[!0,!0,!0,!0]),$r.multiply=new $r([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Gt{constructor(s,u,m){this.func=s,this.mask=u,this.range=m}}Gt.ReadOnly=!1,Gt.ReadWrite=!0,Gt.disabled=new Gt(519,Gt.ReadOnly,[0,1]);const oa=7680;class br{constructor(s,u,m,v,x,S){this.test=s,this.ref=u,this.mask=m,this.fail=v,this.depthFail=x,this.pass=S}}br.disabled=new br({func:519,mask:0},0,0,oa,oa,oa);const Bi=1029,bf=2305;class dr{constructor(s,u,m){this.enable=s,this.mode=u,this.frontFace=m}}function ph(p,s){const u=o.c1(p,3);o.c3(p,s),o.c7(p,3,u)}function mh(p,s){const u=o.b_([]);return o.b$(u,u,-s),o.c0(u,u,-p),u}function vc(p,s){const u=[p[0],p[1],0],m=[s[0],s[1],0];if(o.ae(u)>=1e-15){const S=o.au([],u);o.bY(m,S,o.bG(m,S)),s[0]=m[0],s[1]=m[1]}const v=o.bF([],s,p);if(o.bZ(v)<1e-15)return null;const x=Math.atan2(-v[1],v[0]);return mh(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),x)}dr.disabled=new dr(!1,Bi,bf),dr.backCCW=new dr(!0,Bi,bf),dr.backCW=new dr(!0,Bi,2304),dr.frontCW=new dr(!0,1028,2304),dr.frontCCW=new dr(!0,1028,bf);class ob{constructor(s,u){this.position=s,this.orientation=u}get position(){return this._position}set position(s){if(s){const u=s instanceof o.ac?s:new o.ac(s[0],s[1],s[2]);this._renderWorldCopies&&(u.x=o.bX(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(s,u){if(this.orientation=null,!this.position)return;const m=this.position,v=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(s)):0,x=o.ac.fromLngLat(s,v),S=[x.x-m.x,x.y-m.y,x.z-m.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=vc(S,u)}setPitchBearing(s,u){this.orientation=mh(o.al(s),o.al(-u))}}class sa{constructor(s,u){this._transform=o.bx([]),this.orientation=u,this.position=s}get mercatorPosition(){const s=this.position;return new o.ac(s[0],s[1],s[2])}get position(){const s=o.c1(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var u;s&&o.c7(this._transform,3,[(u=s)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||o.b_([]),s&&ph(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,u){this._orientation=mh(s,u),ph(this._transform,this._orientation)}forward(){const s=o.c1(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=o.c1(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=o.c1(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,u){const m=new Float64Array(16);return o.bi(m,this.getWorldToCamera(s,u)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(s,u,m){const v=this.position;o.bY(v,v,-s);const x=new Float64Array(16);return o.bn(x,[m,m,m]),o.bo(x,x,v),x[10]*=u,x}getWorldToCamera(s,u){const m=new Float64Array(16),v=new Float64Array(4),x=this.position;return o.c2(v,this._orientation),o.bY(x,x,-s),o.c3(m,v),o.bo(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(s,u,m,v){const x=new Float64Array(16);return o.c4(x,s,u,m,v),x}getCameraToClipOrthographic(s,u,m,v,x,S){const P=new Float64Array(16);return o.c5(P,s,u,m,v,x,S),P}getDistanceToElevation(s,u=!1){const m=s===0?0:o.c6(s,u?o.aY(this.position[1]):this.position[1]),v=this.forward();return(m-this.position[2])/v[2]}clone(){return new sa([...this.position],[...this.orientation])}}const Jo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class wf{constructor(s=0,u=0,m=0,v=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=m,this.right=v}interpolate(s,u,m){return u.top!=null&&s.top!=null&&(this.top=o.ai(s.top,u.top,m)),u.bottom!=null&&s.bottom!=null&&(this.bottom=o.ai(s.bottom,u.bottom,m)),u.left!=null&&s.left!=null&&(this.left=o.ai(s.left,u.left,m)),u.right!=null&&s.right!=null&&(this.right=o.ai(s.right,u.right,m)),this}getCenter(s,u){const m=o.ay((this.left+s-this.right)/2,0,s),v=o.ay((this.top+u-this.bottom)/2,0,u);return new o.P(m,v)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new wf(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const mo=15;class Vy{constructor(s,u,m,v,x,S,P){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=v??60,this.setProjection(S),this.setMaxBounds(P),this.width=0,this.height=0,this._center=new o.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new wf,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new sa,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const s=new Vy(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s._allowWorldUnderZoom=this._allowWorldUnderZoom,s}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<mo}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(s,u=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=o.ce(this.projectionOptions);const m=this.getProjection(),v=!o.bv(u,m);return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(s){return this._orthographicProjectionAtLowPitch!==s&&(this._orthographicProjectionAtLowPitch=s,this._calcMatrices(),!0)}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.ce({name:"mercator"});const u=s!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bX(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const u=-s*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=o.cf(),o.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const u=o.ay(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=o.al(s),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(s){this._tileCoverLift!==s&&(this._tileCoverLift=s)}_updateCameraOnTerrain(){const s=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,u=this.elevation&&s===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||s===Number.NEGATIVE_INFINITY&&(!u||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;u||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=s||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const s=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(s)}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let v=0,x=0;for(let S=0;S<u.length;S++){const P=new o.P(u[S][0]*this.width,m+u[S][1]*(this.height-m)),O=s.pointCoordinate(P);if(!O)continue;const L=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);v+=O[3]*L,x+=L}return x===0?NaN:v/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),S=Math.max(v-m,x);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[u.x,u.y,u.z]:[s.x,s.y,s.z];const v=o.ae(o.at([],this._camera.position,m));return o.ay(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let u=!1;if(s.orientation&&!o.ch(s.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];o.ci(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,u=new ob;return u.position=new o.ac(s[0],s[1],s[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(s){if(!o.cj(s))return!1;o.ck(s,s);const u=o.cl([],[0,0,-1],s),m=o.cl([],[0,-1,0],s);if(m[2]<0)return!1;const v=vc(u,m);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(s){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;s[2]=o.ay(s[2],v/m,v/u),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,m){this._unmodified=!1,this._edgeInsets.interpolate(s,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){const u=[new o.cm(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new o.P(0,0)),v=this.pointCoordinate(new o.P(this.width,0)),x=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),P=Math.floor(Math.min(m.x,v.x,x.x,S.x)),O=Math.floor(Math.max(m.x,v.x,x.x,S.x)),L=1;for(let N=P-L;N<=O+L;N++)N!==0&&u.push(new o.cm(N,s))}return u}isLODDisabled(s){return(!s||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(s,u,m){let v=[];const x=m!=null,S=!x;if(S&&this.zoom<u||x&&m[0]===0&&m[1]===0)return v;const P=new Set,O=(N,V,$,W,re)=>{const ee=o.cK(V,N,$,W,re);P.has(ee)||(v.push(new o.aM(N,V,$,W,re)),P.add(ee))};for(let N=0;N<s.length;N++){const V=s[N];if(S&&V.canonical.z!==u)continue;const $=V.canonical,W=V.overscaledZ,re=V.wrap,ee=1<<$.z,ie=$.x+1<ee,ae=$.x>0,ce=$.y+1<ee,_e=$.y>0,be=V.wrap-(ae?0:1),Pe=V.wrap+(ie?0:1),Ae=ae?$.x-1:ee-1,Te=ie?$.x+1:0;if(x)m[0]<0?(O(W,Pe,$.z,Te,$.y),m[1]<0&&ce&&(O(W,re,$.z,$.x,$.y+1),O(W,Pe,$.z,Te,$.y+1)),m[1]>0&&_e&&(O(W,re,$.z,$.x,$.y-1),O(W,Pe,$.z,Te,$.y-1))):m[0]>0?(O(W,be,$.z,Ae,$.y),m[1]<0&&ce&&(O(W,re,$.z,$.x,$.y+1),O(W,be,$.z,Ae,$.y+1)),m[1]>0&&_e&&(O(W,re,$.z,$.x,$.y-1),O(W,be,$.z,Ae,$.y-1))):m[1]<0&&ce?O(W,re,$.z,$.x,$.y+1):_e&&O(W,re,$.z,$.x,$.y-1);else{const we=V.visibleQuadrants;1&we&&(O(W,be,$.z,Ae,$.y),_e&&(O(W,re,$.z,$.x,$.y-1),O(W,be,$.z,Ae,$.y-1))),2&we&&(O(W,Pe,$.z,Te,$.y),_e&&(O(W,re,$.z,$.x,$.y-1),O(W,Pe,$.z,Te,$.y-1))),4&we&&(O(W,be,$.z,Ae,$.y),ce&&(O(W,re,$.z,$.x,$.y+1),O(W,be,$.z,Ae,$.y+1))),8&we&&(O(W,Pe,$.z,Te,$.y),ce&&(O(W,re,$.z,$.x,$.y+1),O(W,Pe,$.z,Te,$.y+1)))}}const L=[];for(const N of v)v.some(V=>N.isChildOf(V))||L.push(N);if(v=L.filter(N=>!s.some(V=>!!(N.overscaledZ<u&&V.isChildOf(N))||N.equals(V)||N.isChildOf(V))),S){const N=1<<u,V=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$=[N*V.x,N*V.y],W=4,re=W*W;v=v.filter(ee=>{const ie=ee.canonical.x+.5-$[0],ae=ee.canonical.y+.5-$[1];return ie*ie+ae*ae<re})}return v}coveringTiles(s){let u=this.coveringZoomLevel(s);const m=u,v=this.elevation&&this.elevation.exaggeration(),x=v&&!s.isTerrainDEM,S=this.projection.name==="mercator";if(s.minzoom!==void 0&&u<s.minzoom)return[];s.maxzoom!==void 0&&u>s.maxzoom&&(u=s.maxzoom);const P=this.locationCoordinate(this.center),O=this.center.lat,L=1<<u,N=[L*P.x,L*P.y,0],V=this.projection.name==="globe",$=!V,W=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,$),re=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ee=L*o.c6(1,this.center.lat),ie=this._camera.position[2]/o.c6(1,this.center.lat),ae=[L*re.x,L*re.y,ie*($?1:ee)],ce=V||v,_e=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),be=this.isLODDisabled(!0)?u:0;let Pe;if(this._elevation&&s.isTerrainDEM)Pe=1e4*this._elevation.exaggeration();else if(this._elevation){const Le=this._elevation.getMinMaxForVisibleTiles();Pe=Le?Le.max:this._centerAltitude}else Pe=this._centerAltitude;const Ae=s.isTerrainDEM?-Pe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?o.co(this):1,we=Le=>{const Ye=new o.ac(Le.x+25e-6,Le.y,Le.z),gt=new o.ac(Le.x,Le.y+25e-6,Le.z),Ot=Le.toLngLat(),ut=Ye.toLngLat(),Ct=gt.toLngLat(),Wt=this.locationCoordinate(Ot),qt=this.locationCoordinate(ut),Vt=this.locationCoordinate(Ct),tr=Math.hypot(qt.x-Wt.x,qt.y-Wt.y),ir=Math.hypot(Vt.x-Wt.x,Vt.y-Wt.y);return Math.sqrt(tr*ir)*Te/25e-6},Ce=Le=>{const ht=Pe,Ye=Ae;return{aabb:o.cr(this,L,0,0,0,Le,Ye,ht,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:ht,wrap:Le,fullyVisible:!1}},Oe=[];let Ve=[];const Ge=u,at=s.reparseOverscaled?m:u,lt=(ie-this._centerAltitude)*ee,yt=Le=>{if(!this._elevation||!Le.tileID||!S)return;const ht=this._elevation.getMinMaxForTile(Le.tileID),Ye=Le.aabb;ht?(Ye.min[2]=ht.min,Ye.max[2]=ht.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Le.shouldSplit=tt(Le),Le.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Fe=(Le,ht)=>{if(.707*ht<Le)return 1;const Ye=ht/Le;return Ye/(1.4144271570014144+(Math.pow(1.1,Ye-1.4144271570014144+1)-1)/(1.1-1)-1)},tt=Le=>{if(Le.zoom<be)return!0;if(Le.zoom===Ge)return!1;if(Le.shouldSplit!=null)return Le.shouldSplit;const ht=Le.aabb.distanceX(ae),Ye=Le.aabb.distanceY(ae);let gt=lt,Ot=1;if(V){gt=Le.aabb.distanceZ(ae);const ir=Math.pow(2,Le.zoom),ar=o.aY((Le.y+1)/ir),yr=o.aY(Le.y/ir),kr=Math.min(Math.max(O,ar),yr),pn=o.cO(kr)/o.cO(O);if(Ot=kr===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pn/this._mercatorScaleRatio),this.zoom<=o.cL&&Le.zoom===Ge-1&&pn>=.9)return!0}else if(x&&(gt=Le.aabb.distanceZ(ae)*ee),this.projection.isReprojectedInTileSpace&&m<=5){const ir=Math.pow(2,Le.zoom),ar=we(new o.ac((Le.x+.5)/ir,(Le.y+.5)/ir));Ot=ar>.85?1:ar}if(!S){const ir=Math.sqrt(ht*ht+Ye*Ye+gt*gt);let ar=(1<<Ge-Le.zoom)*_e*Ot;return ar*=Fe(Math.max(gt,lt),ir),ir<ar}let ut=Number.MAX_VALUE,Ct=0;const Wt=Le.aabb.getCorners(),qt=[];for(const ir of Wt){o.at(qt,ir,ae),V||(x?qt[2]*=ee:qt[2]=lt);const ar=o.bG(qt,this._camera.forward());ar<ut&&(ut=ar,Ct=Math.abs(qt[2]))}let Vt=(1<<Ge-Le.zoom)*_e*Ot;if(Vt*=Fe(Math.max(Ct,lt),ut),ut<Vt)return!0;const tr=Le.aabb.closestPoint(N);return tr[0]===N[0]&&tr[1]===N[1]};if(this.renderWorldCopies)for(let Le=1;Le<=3;Le++)Oe.push(Ce(-Le)),Oe.push(Ce(Le));for(Oe.push(Ce(0));Oe.length>0;){const Le=Oe.pop(),ht=Le.x,Ye=Le.y;let gt=Le.fullyVisible;const Ot=()=>this.projection.name==="globe"&&(Le.y===0||Le.y===(1<<Le.zoom)-1);if(!gt){let ut=ce?Le.aabb.intersects(W):Le.aabb.intersectsFlat(W);if(ut===0&&Ot()){const Ct=new o.cp(Le.zoom,ht,Ye);ut=o.cq(this,L,Ct,!0).intersects(W)}if(ut===0)continue;gt=ut===2}if(Le.zoom!==Ge&&tt(Le))for(let ut=0;ut<4;ut++){const Ct=(ht<<1)+ut%2,Wt=(Ye<<1)+(ut>>1),qt={aabb:S?Le.aabb.quadrant(ut):o.cr(this,L,Le.zoom+1,Ct,Wt,Le.wrap,Le.minZ,Le.maxZ,this.projection),zoom:Le.zoom+1,x:Ct,y:Wt,wrap:Le.wrap,fullyVisible:gt,tileID:void 0,shouldSplit:void 0,minZ:Le.minZ,maxZ:Le.maxZ};x&&!V&&(qt.tileID=new o.aM(Le.zoom+1===Ge?at:Le.zoom+1,Le.wrap,Le.zoom+1,Ct,Wt),yt(qt)),Oe.push(qt)}else{const ut=Le.zoom===Ge?at:Le.zoom;if(s.minzoom&&s.minzoom>ut)continue;let Ct=0;if(!gt){let tr=ce?Le.aabb.intersectsPrecise(W):Le.aabb.intersectsPreciseFlat(W);if(tr===0&&Ot()){const ir=new o.cp(Le.zoom,ht,Ye);tr=o.cq(this,L,ir,!0).intersectsPrecise(W)}if(tr===0)continue;if(s.calculateQuadrantVisibility)if(W.containsPoint(Le.aabb.center))Ct=15;else for(let ir=0;ir<4;ir++)Le.aabb.quadrant(ir).intersects(W)!==0&&(Ct|=1<<ir)}const Wt=N[0]-(.5+ht+(Le.wrap<<Le.zoom))*(1<<u-Le.zoom),qt=N[1]-.5-Ye,Vt=Le.tileID?Le.tileID:new o.aM(ut,Le.wrap,Le.zoom,ht,Ye);s.calculateQuadrantVisibility&&(Vt.visibleQuadrants=Ct),Ve.push({tileID:Vt,distanceSq:Wt*Wt+qt*qt})}}if(this.fogCullDistSq){const Le=this.fogCullDistSq,ht=this.horizonLineFromTop();Ve=Ve.filter(Ye=>{const gt=[0,0,0,1],Ot=[o.aj,o.aj,0,1],ut=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());o.aA(gt,gt,ut),o.aA(Ot,Ot,ut);const Ct=o.cs([],gt,Ot),Wt=o.ct([],gt,Ot),qt=o.cM(Ct,Wt);if(qt===0)return!0;let Vt=!1;const tr=this._elevation;if(tr&&qt>Le&&ht!==0){const ir=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let ar;s.isTerrainDEM||(ar=tr.getMinMaxForTile(Ye.tileID)),ar||(ar={min:Ae,max:Pe});const yr=o.cu(this.rotation),kr=[yr[0]*o.aj,yr[1]*o.aj,ar.max];o.ad(kr,kr,ir),Vt=(1-kr[1])*this.height*.5<ht}return qt<Le||Vt})}return Ve.sort((Le,ht)=>Le.distanceSq-ht.distanceSq).map(Le=>Le.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const u=o.ay(s.lat,-85.051129,o.cv),m=this.projection.project(s.lng,u);return new o.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,u){let m,v;const x=this.centerPoint;if(this.projection.name==="globe"){const P=this.worldSize;m=(u.x-x.x)/P,v=(u.y-x.y)/P}else{const P=this.pointCoordinate(u),O=this.pointCoordinate(x);m=P.x-O.x,v=P.y-O.y}const S=this.locationCoordinate(s);this.setLocation(new o.ac(S.x-m,S.y-v))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s,u){return this.projection.locationPoint(this,s,u)}locationPoint3D(s,u){return this.projection.locationPoint(this,s,u,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s,u){return this.coordinateLocation(this.pointCoordinate3D(s,u))}locationCoordinate(s,u){const m=u?o.c6(u,s.lat):void 0,v=this.projection.project(s.lng,s.lat);return new o.ac(v.x,v.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,u){const m=u??this._centerAltitude,v=[s.x,s.y,0,1],x=[s.x,s.y,1,1];o.aA(v,v,this.pixelMatrixInverse),o.aA(x,x,this.pixelMatrixInverse);const S=x[3];o.cw(v,v,1/v[3]),o.cw(x,x,1/S);const P=v[2],O=x[2];return{p0:v,p1:x,t:P===O?0:(m-P)/(O-P)}}screenPointToMercatorRay(s){const u=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return o.aA(u,u,this.pixelMatrixInverse),o.aA(m,m,this.pixelMatrixInverse),o.cw(u,u,1/u[3]),o.cw(m,m,1/m[3]),u[2]=o.c6(u[2],this._center.lat)*this.worldSize,m[2]=o.c6(m[2],this._center.lat)*this.worldSize,o.cw(u,u,1/this.worldSize),o.cw(m,m,1/this.worldSize),new o.av([u[0],u[1],u[2]],o.au([],o.at([],m,u)))}rayIntersectionCoordinate(s){const{p0:u,p1:m,t:v}=s,x=o.c6(u[2],this._center.lat),S=o.c6(m[2],this._center.lat);return new o.ac(o.ai(u[0],m[0],v)/this.worldSize,o.ai(u[1],m[1],v)/this.worldSize,o.ai(x,S,v))}pointCoordinate(s,u=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,u)}pointCoordinate3D(s,u){if(!this.elevation)return this.pointCoordinate(s,u);let m=this.projection.pointCoordinate3D(this,s.x,s.y);if(m)return new o.ac(m[0],m[1],m[2]);let v=0,x=this.horizonLineFromTop();if(s.y>x)return this.pointCoordinate(s,u);const S=.02*x,P=s.clone();for(let O=0;O<10&&x-v>S;O++){P.y=o.ai(v,x,.66);const L=this.projection.pointCoordinate3D(this,P.x,P.y);L?(x=P.y,m=L):v=P.y}return m?new o.ac(m[0],m[1],m[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=o.cx)return!this.isPointAboveHorizon(s);const u=this.pointCoordinate(s);return u.y>=0&&u.y<=1}_coordinatePoint(s,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,v=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return o.aA(v,v,this.pixelMatrix),v[3]>0?new o.P(v[0]/v[3],v[1]/v[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:u}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,x=this.pointLocation3D(new o.P(u,s)),S=this.pointLocation3D(new o.P(v,s)),P=this.pointLocation3D(new o.P(v,m)),O=this.pointLocation3D(new o.P(u,m));let L=Math.min(x.lng,S.lng,P.lng,O.lng),N=Math.max(x.lng,S.lng,P.lng,O.lng),V=Math.min(x.lat,S.lat,P.lat,O.lat),$=Math.max(x.lat,S.lat,P.lat,O.lat);const W=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,ee=(ie,ae,ce,_e,be)=>{const Pe=(ie+ce)/2,Ae=(ae+_e)/2,Te=new o.P(Pe,Ae),{lng:we,lat:Ce}=this.pointLocation3D(Te),Oe=Math.max(0,L-we,V-Ce,we-N,Ce-$);L=Math.min(L,we),N=Math.max(N,we),V=Math.min(V,Ce),$=Math.max($,Ce),(be<re||Oe>W)&&(ee(ie,ae,Pe,Ae,be+1),ee(Pe,Ae,ce,_e,be+1))};if(ee(u,s,v,s,1),ee(v,s,v,m,1),ee(v,m,u,m,1),ee(u,m,u,s,1),this.projection.name==="globe"){const[ie,ae]=o.cy(this);ie?($=90,N=180,L=-180):ae&&(V=-90,N=180,L=-180)}return new o.aG(new o.cd(L,V),new o.cd(N,$))}_getBoundsRectangular(s,u){const{top:m,left:v}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,P=new o.P(v,m),O=new o.P(S,m),L=new o.P(S,x),N=new o.P(v,x);let V=this.pointCoordinate(P,s),$=this.pointCoordinate(O,s);const W=this.pointCoordinate(L,u),re=this.pointCoordinate(N,u),ee=(ie,ae)=>(ae.y-ie.y)/(ae.x-ie.x);return V.y>1&&$.y>=0?V=new o.ac((1-re.y)/ee(re,V)+re.x,1):V.y<0&&$.y<=1&&(V=new o.ac(-re.y/ee(re,V)+re.x,0)),$.y>1&&V.y>=0?$=new o.ac((1-W.y)/ee(W,$)+W.x,1):$.y<0&&V.y<=1&&($=new o.ac(-W.y/ee(W,$)+W.x,0)),new o.aG().extend(this.coordinateLocation(V)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(W))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=s.visibleDemTiles.reduce((m,v)=>{if(v.dem){const x=v.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*s.exaggeration(),u.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-85.051129,this.maxLat=o.cv,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,u){return this.projection.createTileMatrix(this,u,s)}calculateDistanceTileData(s){const u=s.key,m=this._distanceTileDataCache;if(m[u])return m[u];const v=s.canonical,x=1/this.height,S=this.cameraWorldSize,P=S/this.zoomScale(v.z),O=(v.x+Math.pow(2,v.z)*s.wrap)*P,L=v.y*P,N=this.point;N.x*=S/this.worldSize,N.y*=S/this.worldSize;const V=this.angle,$=Math.sin(-V),W=-Math.cos(-V);return m[u]={bearing:[$,W],center:[(N.x-O)*x,(N.y-L)*x],scale:P/o.aj*x},m[u]}calculateFogTileMatrix(s){const u=s.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return o.az(v,this.worldToFogMatrix,v),m[u]=new Float32Array(v),m[u]}calculateProjMatrix(s,u=!1,m=!1){const v=s.key;let x;if(x=m?this._expandedProjMatrixCache:u?this._alignedProjMatrixCache:this._projMatrixCache,x[v])return x[v];const S=this.calculatePosMatrix(s,this.worldSize);let P;return P=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:u?this.alignedProjMatrix:this.projMatrix,o.az(S,P,S),x[v]=new Float32Array(S),x[v]}calculatePixelsToTileUnitsMatrix(s){const u=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const v=o.cz(s,this);return m[u]=v,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,u=o.bn([],[s,s,s]);return o.az(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const u=o.c6(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),v=this._camera.forward(),x=o.c6(1,this._center.lat);m[2]/=x,v[2]/=x,o.au(v,v);const S=s.raycast(m,v,s.exaggeration());if(S){const P=o.bE([],m,v,S),O=new o.ac(P[0],P[1],o.c6(P[2],o.aY(P[1]))),L=(O.z+o.ae([O.x-m[0],O.y-m[1],O.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const u=this._elevation,m=o.c6(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(m),x=u.getAtPointOrZero(new o.ac(...v)),S=this.pixelsPerMeter/this.worldSize*x,P=this._minimumHeightOverTerrain(),O=v[2]-S;if(O<=P)if(O<0||s){const L=this.locationCoordinate(this._center,this._centerAltitude),N=[v[0],v[1],L.z-v[2]],V=o.ae(N);N[2]-=(P-O)/this._pixelsPerMercatorPixel;const $=o.ae(N);if($===0)return;o.bY(N,N,V/$*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],L.z*this._pixelsPerMercatorPixel-N[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const $=this.center;return $.lat=o.ay($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&($.lng=o.ay($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const u=this._unmodified,{x:m,y:v}=this.point;let x=0,S=m,P=v;const O=this.width/2,L=this.height/2,N=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(v-L<N&&(P=N+L),v+L>V&&(P=V-L),V-N<this.height&&(x=Math.max(x,this.height/(V-N)),P=(V+N)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,W=this.worldMaxX*this.scale,re=this.worldSize/2-($+W)/2;S=(m+re+this.worldSize)%this.worldSize-re,S-O<$&&(S=$+O),S+O>W&&(S=W-O),W-$<this.width&&(x=Math.max(x,this.width/(W-$)),S=(W+$)/2)}S===m&&P===v||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(S,P))),x&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,u=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.c6(1,this.center.lat)/o.c6(1,o.cP));const v=o.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?m:1,S=this._camera.getWorldToCamera(this.worldSize,x);let P;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-s.x/this.width,O[9]=2*s.y/this.height,this.isOrthographic){let Ce=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Oe=Ce*this.aspect,Ve=-Oe,Ge=-Ce;Oe-=s.x,Ve-=s.x,Ce+=s.y,Ge+=s.y,P=this._camera.getCameraToClipOrthographic(Ve,Oe,Ge,Ce,this._nearZ,this._farZ),((at,lt,yt,Fe)=>{for(let tt=0;tt<16;tt++)at[tt]=o.ai(lt[tt],yt[tt],Fe)})(P,P,O,o.cN(this.pitch>=mo?1:this.pitch/mo))}else P=O;const L=o.cB([],O,S);let N=o.cB([],P,S);if(this.projection.isReprojectedInTileSpace){const Ce=this.locationCoordinate(this.center),Oe=o.bx([]);o.bo(Oe,Oe,[Ce.x*this.worldSize,Ce.y*this.worldSize,0]),o.az(Oe,Oe,o.cC(this)),o.bo(Oe,Oe,[-Ce.x*this.worldSize,-Ce.y*this.worldSize,0]),o.az(N,N,Oe),o.az(L,L,Oe),this.inverseAdjustmentMatrix=o.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cE([],N,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=N,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),u){const Ce=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ce[8]=2*-s.x/this.width,Ce[9]=2*s.y/this.height,this.expandedFarZProjMatrix=o.cB([],Ce,S)}else this.expandedFarZProjMatrix=this.projMatrix;const V=o.bi([],P);this.frustumCorners=o.cF.fromInvProjectionMatrix(V,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!u);const $=new Float32Array(16);o.bx($),o.cE($,$,[1,-1,1]),o.cG($,$,this._pitch),o.by($,$,this.angle);const W=o.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(W);const re=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;W[8]=2*-s.x/this.width,W[9]=2*(s.y+re)/this.height,this.skyboxMatrix=o.az($,W,$);const ee=this.point,ie=ee.x,ae=ee.y,ce=this.width%2/2,_e=this.height%2/2,be=Math.cos(this.angle),Pe=Math.sin(this.angle),Ae=ie-Math.round(ie)+be*ce+Pe*_e,Te=ae-Math.round(ae)+be*_e+Pe*ce,we=new Float64Array(N);if(o.bo(we,we,[Ae>.5?Ae-1:Ae,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=we,N=o.bz(),o.cE(N,N,[this.width/2,-this.height/2,1]),o.bo(N,N,[1,-1,0]),this.labelPlaneMatrix=N,N=o.bz(),o.cE(N,N,[1,-1,1]),o.bo(N,N,[-1,-1,0]),o.cE(N,N,[2/this.width,2/this.height,1]),this.glCoordMatrix=N,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},N=o.bi(new Float64Array(16),this.pixelMatrix),!N)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=N,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cH(this);const Ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(Ce,Ce,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=N;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,m=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,u];o.bY(x,x,v),o.bY(m,m,-1),o.cI(m,m,x);const S=o.bz();o.bo(S,S,m),o.cE(S,S,x),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,u,v)}_computeCameraPosition(s){const u=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),v=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-s/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-m[0]*x,v.y/this.worldSize-m[1]*x,s/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],v=s[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(x=Math.min((u-m)/v,1)),this._camera.position=o.bE([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:v}=this._camera.getPitchBearing(),x=o.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),P=Math.max((s[2]-x)/Math.cos(m),S),O=this._zoomFromMercatorZ(P);o.bE(s,s,u,P),this._pitch=o.ay(m,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bX(v,-Math.PI,Math.PI),this._setZoom(o.ay(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,s)*this.tileSize))}zoomFromMercatorZAdjusted(s){let u=0,m=o.cx,v=0,x=1/0;for(;m-u>1e-6&&m>u;){const S=u+.5*(m-u),P=this.tileSize*Math.pow(2,S),O=this.getCameraToCenterDistance(this.projection,S,P),L=this.scaleZoom(O/(Math.max(0,s)*this.tileSize)),N=Math.abs(S-L);N<x&&(x=N,v=S),S<L?u=S:m=S}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,u){const m=Math.min(s.x,u.x),v=Math.max(s.x,u.x),x=Math.min(s.y,u.y),S=Math.max(s.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const P=[new o.P(m,x),new o.P(v,S),new o.P(m,S),new o.P(v,x)],O=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const N of P){const V=this.pointRayIntersection(N);if(V.t<0)return!0;const $=this.rayIntersectionCoordinate(V);if($.x<O||$.y<0||$.x>L||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(s,u){const m=o.ae(o.at([],this._camera.position,s)),v=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([u,m,v],x){const S=[u,m,v,1];o.aA(S,S,x);const P=S[3]=Math.max(S[3],1e-6);return S[0]/=P,S[1]/=P,S[2]/=P,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,s))}}getCameraToCenterDistance(s,u=this.zoom,m=this.worldSize){const v=o.cA(s,u,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,m,v);let S=.5/Math.tan(.5*this._fov)*this.height*x;return this.isOrthographic&&(S=o.ai(1,S,o.cN(this.pitch>=mo?1:this.pitch/mo))),S}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(s,s,this.globeMatrix),s}getFrustum(s){return o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,this.projection.zAxisUnit==="meters")}}const Ya=(p,s)=>{if(s>0&&p.terrain&&o.w("Cutoff is currently disabled on terrain"),s<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const u=p.transform,m=Math.max(Math.abs(u._zoom-(p.minCutoffZoom-1)),1),v=u.isLODDisabled(!1)?o.af(60,45,u.pitch):o.af(30,15,u.pitch),x=u._farZ-u._nearZ,S=s*u.height,P=((1-(O=v))*u.cameraToCenterDistance+O*(u._farZ+S))*m;var O;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[u._nearZ,u._farZ,(P-u._nearZ)/x,(P-S-u._nearZ)/x]}}},jo={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Sf{constructor(s,u){this.aabb=s,this.lastCascade=u}}class DA{add(s,u){const m=this.receivers[s.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],u.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],u.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],u.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],u.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],u.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],u.max[2])):this.receivers[s.key]=new Sf(u,null)}clear(){this.receivers={}}get(s){return this.receivers[s.key]}computeRequiredCascades(s,u,m){const v=o.cW.fromPoints(s.points);let x=0;for(const S in this.receivers){const P=this.receivers[S];if(!P||!v.intersectsAabb(P.aabb))continue;P.aabb.min=v.closestPoint(P.aabb.min),P.aabb.max=v.closestPoint(P.aabb.max);const O=P.aabb.getCorners();for(let L=0;L<m.length;L++){let N=!0;for(const V of O){const $=[V[0]*u,V[1]*u,V[2]];if(o.ad($,$,m[L].matrix),$[0]<-1||$[0]>1||$[1]<-1||$[1]>1){N=!1;break}}if(P.lastCascade=L,x=Math.max(x,L),N)break}}return x+1}}class LA{constructor(s){this.painter=s,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new DA,this._depthMode=new Gt(s.context.gl.LEQUAL,Gt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,s.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),s.tp.registerParameter(jo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),s.tp.registerParameter(jo,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),s.tp.registerParameter(jo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),s.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const s of this._cascades)s.texture.destroy(),s.framebuffer.destroy();this._cascades=[]}updateShadowParameters(s,u){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!u||!u.properties)return;const v=u.properties.get("shadow-intensity");if(!u.shadowsEnabled()||v<=0||(this._shadowLayerCount=m.style.order.reduce((re,ee)=>{const ie=m.style._mergedLayers[ee];return re+(ie.hasShadowPass()&&!ie.isHidden(s.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const x=m.context,S=jo.shadowMapResolution,P=jo.shadowMapResolution;if(this._cascades.length===0||jo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let re=0;re<jo.cascadeCount;++re){const ee=m._shadowMapDebug,ie=x.gl,ae=x.createFramebuffer(S,P,ee,"texture"),ce=new o.T(x,{width:S,height:P,data:null},ie.DEPTH_COMPONENT16);if(ae.depthAttachment.set(ce.texture),ee){const _e=new o.T(x,{width:S,height:P,data:null},ie.RGBA8);ae.colorAttachment.set(_e.texture)}this._cascades.push({framebuffer:ae,texture:ce,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cn,scale:0})}}this.shadowDirection=gh(u);let O=0;if(s.elevation){const re=s.elevation,ee=[1e4,-1e4];re.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const ae=ie.dem.tree;ee[0]=Math.min(ee[0],ae.minimums[0]),ee[1]=Math.max(ee[1],ae.maximums[0])}),ee[0]!==1e4&&(O=(ee[1]-ee[0])*re.exaggeration())}const L=1.5*s.cameraToCenterDistance,N=3*L,V=new Float64Array(16);for(let re=0;re<this._cascades.length;++re){const ee=this._cascades[re];let ie=s.height/50,ae=1;jo.cascadeCount===1?ae=N:re===0?ae=L:(ie=L,ae=N);const[ce,_e]=_h(s,this.shadowDirection,ie,ae,jo.shadowMapResolution,O);ee.scale=s.scale,ee.matrix=ce,ee.boundingSphereRadius=_e,o.bi(V,ee.matrix),ee.frustum=o.cn.fromInvProjectionMatrix(V,1,0,!0),ee.far=ae}const $=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[$].far,this._cascades[$].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/jo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=jo.shadowMapResolution,this._uniformValues.u_shadowmap_0=Jo.ShadowMap0,this._uniformValues.u_shadowmap_1=Jo.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=m.transform.elevation;for(const re of this._groundShadowTiles){let ee={min:0,max:0};if(W){const ie=W.getMinMaxForTile(re);ie&&(ee=ie)}this.addShadowReceiver(re.toUnwrapped(),ee.min,ee.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(s){this._enabled=s}drawShadowPass(s,u){if(!this.enabled)return;const m=this.painter,v=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),v.viewport.set([0,0,jo.shadowMapResolution,jo.shadowMapResolution]);for(let x=0;x<this._numCascadesToRender;++x){m.currentShadowCascade=x,v.bindFramebuffer.set(this._cascades[x].framebuffer.framebuffer),v.clear({color:o.am.white,depth:1});for(const S of s.order){const P=s._mergedLayers[S];if(!P.hasShadowPass()||P.isHidden(m.transform.zoom))continue;const O=s.getLayerSourceCache(P),L=O?u[O.id]:void 0;(P.type==="model"||L&&L.length)&&m.renderLayer(m,O,P,L)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const s=this.painter,u=s.style,m=s.context,v=m.gl,x=u.directionalLight,S=u.ambientLight;if(!x||!S)return;const P=[],O=Ya(s,s.longestCutoffRange);O.shouldRenderCutoff&&P.push("RENDER_CUTOFF"),P.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&P.push("NORMAL_OFFSET");const L=pu(u,x,S),N=new Gt(v.LEQUAL,Gt.ReadOnly,s.depthRangeFor3D),V=new br({func:v.EQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.KEEP);for(const $ of this._groundShadowTiles){const W=$.toUnwrapped(),re=s.isTileAffectedByFog($),ee=s.getOrCreateProgram("groundShadow",{defines:P,overrideFog:re});this.setupShadows(W,ee),s.uploadCommonUniforms(m,ee,W,null,O);const ie={u_matrix:s.transform.calculateProjMatrix(W),u_ground_shadow_factor:L};ee.draw(s,v.TRIANGLES,N,V,$r.multiply,dr.disabled,ie,"ground_shadow",s.tileExtentBuffer,s.quadTriangleIndexBuffer,s.tileExtentSegments,null,s.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?$r.unblended:$r.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(s){const u=this.painter.transform,m=u.calculatePosMatrix(s,u.worldSize);return o.az(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(s){return o.az(s,this._cascades[this.painter.currentShadowCascade].matrix,s),Float32Array.from(s)}setupShadows(s,u,m,v=0){if(!this.enabled)return;const x=this.painter.transform,S=this.painter.context,P=S.gl,O=this._uniformValues,L=new Float64Array(16),N=x.calculatePosMatrix(s,x.worldSize);for(let V=0;V<this._cascades.length;V++)o.az(L,this._cascades[V].matrix,N),O[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(L),S.activeTexture.set(P.TEXTURE0+Jo.ShadowMap0+V),this._cascades[V].texture.bindExtraParam(P.LINEAR,P.LINEAR,P.CLAMP_TO_EDGE,P.CLAMP_TO_EDGE,P.GREATER);if(this.useNormalOffset=!!m,this.useNormalOffset){const V=o.cU(s.canonical),$=2/x.tileSize*o.aj/jo.shadowMapResolution,W=$*this._cascades[0].boundingSphereRadius,re=$*this._cascades[this._cascades.length-1].boundingSphereRadius,ee=(m==="vector-tile"?1:3)/Math.pow(2,v-s.canonical.z-(1-x.zoom+Math.floor(x.zoom)));O.u_shadow_normal_offset=[V,W*ee,re*ee],O.u_shadow_bias=[6e-5,.0012,.012]}else O.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(S,O)}setupShadowsFromMatrix(s,u,m=!1){if(!this.enabled)return;const v=this.painter.context,x=v.gl,S=this._uniformValues,P=new Float64Array(16);for(let O=0;O<jo.cascadeCount;O++)o.az(P,this._cascades[O].matrix,s),S[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),v.activeTexture.set(x.TEXTURE0+Jo.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=m,m){const O=jo.normalOffset;S.u_shadow_normal_offset=[1,O,O],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];u.setShadowUniformValues(v,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(s,u,m,v){if(v[2]>=0)return{};const x=function(O,L,N){const V=N/(1<<O.canonical.z);return new o.cW([O.canonical.x*V+O.wrap*N,O.canonical.y*V+O.wrap*N,0],[(O.canonical.x+1)*V+O.wrap*N,(O.canonical.y+1)*V+O.wrap*N,L])}(s,u,m).getCorners(),S=u/-v[2];v[0]<0?(o.cV(x[0],x[0],[v[0]*S,0,0]),o.cV(x[3],x[3],[v[0]*S,0,0])):v[0]>0&&(o.cV(x[1],x[1],[v[0]*S,0,0]),o.cV(x[2],x[2],[v[0]*S,0,0])),v[1]<0?(o.cV(x[0],x[0],[0,v[1]*S,0]),o.cV(x[1],x[1],[0,v[1]*S,0])):v[1]>0&&(o.cV(x[2],x[2],[0,v[1]*S,0]),o.cV(x[3],x[3],[0,v[1]*S,0]));const P={};return P.vertices=x,P.planes=[xc(x[1],x[0],x[4]),xc(x[2],x[1],x[5]),xc(x[3],x[2],x[6]),xc(x[0],x[3],x[7])],P}addShadowReceiver(s,u,m){this._receivers.add(s,o.cW.fromTileIdAndHeight(s,u,m))}getMaxCascadeForTile(s){const u=this._receivers.get(s);return u&&u.lastCascade?u.lastCascade:0}}function xc(p,s,u){const m=o.at([],u,s),v=o.at([],p,s),x=o.bF([],m,v),S=o.ae(x);return S===0?[0,0,1,0]:(o.bY(x,x,1/S),[x[0],x[1],x[2],-o.bG(x,s)])}function gh(p){const s=p.properties.get("direction"),u=o.cR(s.x,s.y,s.z);u[2]=o.ay(u[2],0,75);const m=o.cT([u[0],u[1],u[2]]);return o.cS(m.x,m.y,m.z)}function pu(p,s,u){const m=s.properties.get("color-use-theme")==="none",v=s.properties.get("color"),x=s.properties.get("intensity"),S=s.properties.get("direction"),P=[S.x,S.y,S.z],O=u.properties.get("color-use-theme")==="none",L=u.properties.get("color"),N=u.properties.get("intensity"),V=Math.max(o.bG([0,0,1],P),0),$=[0,0,0];o.bY($,L.toPremultipliedRenderColor(O?null:p.getLut(s.scope)).toArray01Linear().slice(0,3),N);const W=[0,0,0];return o.bY(W,v.toPremultipliedRenderColor(m?null:p.getLut(u.scope)).toArray01Linear().slice(0,3),V*x),o.cY([$[0]>0?$[0]/($[0]+W[0]):0,$[1]>0?$[1]/($[1]+W[1]):0,$[2]>0?$[2]/($[2]+W[2]):0])}function _h(p,s,u,m,v,x){const S=p.zoom,P=p.scale,O=p.worldSize,L=1/O,N=p.aspect,V=Math.sqrt(1+N*N)*Math.tan(.5*p.fovX),$=V*V,W=m-u,re=m+u;let ee,ie;$>W/re?(ee=m,ie=m*V):(ee=.5*re*(1+$),ie=.5*Math.sqrt(W*W+2*(m*m+u*u)*$+re*re*$*$));const ae=p.projection.pixelsPerMeter(p.center.lat,O),ce=p._camera.getCameraToWorldMercator(),_e=[0,0,-ee*L];o.ad(_e,_e,ce);let be=ie*L;const Pe=p._edgeInsets;if(!(Pe.left===0&&Pe.top===0&&Pe.right===0&&Pe.bottom===0||Pe.left===Pe.right&&Pe.top===Pe.bottom)){const gt=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?ae:1),Ot=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,u,m);Ot[8]=2*-p.centerOffset.x/p.width,Ot[9]=2*p.centerOffset.y/p.height;const ut=new Float64Array(16);o.cB(ut,Ot,gt);const Ct=new Float64Array(16);o.bi(Ct,ut);const Wt=o.cn.fromInvProjectionMatrix(Ct,O,S,!0);for(const qt of Wt.points){const Vt=((Ae=qt)[0]/=P,Ae[1]/=P,Ae[2]=o.c6(Ae[2],p._center.lat),Ae);be=Math.max(be,o.bZ(o.cX([],_e,Vt)))}}var Ae;be*=v/(v-1);const Te=Math.acos(s[2]),we=Math.atan2(-s[0],-s[1]),Ce=new sa;Ce.position=_e,Ce.setPitchBearing(Te,we);const Oe=Ce.getWorldToCamera(O,ae),Ve=be*O,Ge=Math.min(p._mercatorZfromZoom(17)*O*-2,-2*Ve),at=Ce.getCameraToClipOrthographic(-Ve,Ve,-Ve,Ve,Ge,(Ve+x*ae)/s[2]),lt=new Float64Array(16);o.az(lt,at,Oe);const yt=o.cS(Math.floor(1e6*_e[0])/1e6*O,Math.floor(1e6*_e[1])/1e6*O,0),Fe=.5*v,tt=[0,0,0];o.ad(tt,yt,lt),o.bY(tt,tt,Fe);const Le=[Math.floor(tt[0]),Math.floor(tt[1]),Math.floor(tt[2])],ht=[0,0,0];o.at(ht,tt,Le),o.bY(ht,ht,-1/Fe);const Ye=new Float64Array(16);return o.bx(Ye),o.bo(Ye,Ye,ht),o.az(lt,Ye,lt),[lt,Ve]}class sb extends o.E{constructor(s){super(),this.requestManager=s,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(s,u){return o.aS(this.requestManager.transformRequest(u,o.R.Model).url).then(m=>{if(!m)return;const v=o.aT(m),x=new o.aU(s,void 0,void 0,v);return x.computeBoundsAndApplyParent(),x}).catch(m=>{if(m&&m.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${s} from ${u}: ${m.message}`)))})}load(s,u,m={forceReload:!1}){this.models[u]||(this.models[u]={});const v=Object.keys(s),x=[],S=[];for(const P of v){const O=s[P];this.hasURLBeenRequested(O)&&!m.forceReload||(this.modelByURL[O]={modelId:P,scope:u},x.push(this.loadModel(P,O)),S.push(P)),this.models[u][P]||(this.models[u][P]={model:null,numReferences:1})}this.numModelsLoading[u]=(this.numModelsLoading[u]||0)+S.length,Promise.allSettled(x).then(P=>{for(let O=0;O<P.length;O++){const{status:L}=P[O];if(L==="rejected")continue;const{value:N}=P[O];this.models[u][S[O]]||(this.models[u][S[O]]={model:null,numReferences:1}),this.models[u][S[O]].model=N}this.numModelsLoading[u]-=S.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(P=>{this.fire(new o.z(new Error(`Could not load models: ${P.message}`)))})}isLoaded(){for(const s in this.numModelsLoading)if(this.numModelsLoading[s]>0)return!1;return!0}hasModel(s,u,m={exactIdMatch:!1}){return!!(m.exactIdMatch?this.getModel(s,u):this.getModelByURL(this.modelUris[u][s]))}getModel(s,u){return this.models[u]||(this.models[u]={}),this.models[u][s]?this.models[u][s].model:void 0}getModelByURL(s){if(!s)return null;const u=this.modelByURL[s];return u?this.models[u.scope][u.modelId].model:null}hasModelBeenAdded(s,u){return this.models[u]&&this.models[u][s]!==void 0}getModelURIs(s){return this.modelUris[s]||{}}addModel(s,u,m){this.models[m]||(this.models[m]={}),this.modelUris[m]||(this.modelUris[m]={});const v=this.requestManager.normalizeModelURL(u);if((this.hasModel(s,m,{exactIdMatch:!0})||this.hasModelBeenAdded(s,m))&&this.modelUris[m][s]===v)this.models[m][s].numReferences++;else if(this.hasURLBeenRequested(v)){const{scope:x,modelId:S}=this.modelByURL[v];this.models[x][S].numReferences++}else this.modelUris[m][s]=v,this.load({[s]:this.modelUris[m][s]},m)}addModelURLs(s,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const m=this.modelUris[u];for(const v in s)m[v]=this.requestManager.normalizeModelURL(s[v])}reloadModels(s){this.load(this.modelUris[s],s,{forceReload:!0})}addModelsFromBucket(s,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const m={};for(const v of s)this.hasModel(v,u,{exactIdMatch:!0})||this.hasURLBeenRequested(v)?this.models[u][v].numReferences++:this.modelUris[u][v]&&!this.hasURLBeenRequested(v)?m[v]=this.modelUris[u][v]:!this.hasURLBeenRequested(v)&&o.cZ(v,!1)&&(this.modelUris[u][v]=this.requestManager.normalizeModelURL(v),m[v]=this.modelUris[u][v]);this.load(m,u)}hasURLBeenRequested(s){return this.modelByURL[s]!==void 0}removeModel(s,u,m=!1){if(this.models[u]&&this.models[u][s]&&(this.models[u][s].numReferences--,this.models[u][s].numReferences===0)){const v=this.modelUris[u][s];m||delete this.modelUris[u][s],delete this.modelByURL[v];const x=this.models[u][s].model;if(!x)return;delete this.models[u][s],x.destroy()}}destroy(){for(const s of Object.keys(this.models))for(const u of Object.keys(this.models[s])){const m=this.models[s][u].model;delete this.models[s][u],m&&m.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(s){return this.models[s]||(this.models[s]={}),Object.keys(this.models[s])}upload(s,u){this.models[u]||(this.models[u]={});for(const m in this.models[u])this.models[u][m].model&&this.models[u][m].model.upload(s.context)}}const Em=new o.a7({data:new o.a8(o.a5.colorTheme.data)}),Gy={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Ml(p){return p=p||{},Object.assign(p,Gy)}class zA extends o.E{constructor(s){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},o.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=s,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(s=>{s.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=s.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=s.stylesheet.indoor.buildingFeaturesetId,this._scope=s.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:s=>(s.feature&&s.feature.properties.floorplan&&this.selectFloorplan(s.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const s=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new o.A("floorplangone"))};if(this._map.transform.zoom<13)return void s();const u={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},m=this._map.transform.width,v=this._map.transform.height,x=m*(2/3),S=v*(2/3),P=.5*(m-x),O=.5*(v-S),L=[new o.P(P,O),new o.P(P+x,O+S)],N=this._map.queryRenderedFeatures(L,u);N.length>0?this._selectedFloorplan&&N[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=N[0],this._floorplanSelected()):s()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const s=this._floorplanStates[this._indoorData.id].selectedBuilding,u=s?this._indoorData.buildings.find(P=>P.id===s):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,m=this._floorplanStates[this._indoorData.id].selectedLevel,v=this._indoorData.levels.find(P=>P.id===m),x=this._indoorData.levels.find(P=>!(!u||!u.levels)&&Number(P.levelOrder)===0&&u.levels.includes(P.id)),S=v?v.id:x?x.id:void 0;this.fire(new o.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:S})),u&&this._buildingSelected(u,!1),S&&this._levelSelected(S)}_buildingSelected(s,u){if(!s||!s.id)return void console.warn("IndoorManager: Building or building id is undefined");u&&s.extent&&this._map.fitBounds(s.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=s?s.id:void 0;const m=this._indoorData.levels.filter(v=>s.levels.includes(v.id));this.fire(new o.A("buildingselected",{buildingId:s.id,levels:m}))}_levelSelected(s){const u=this._indoorData.levels.find(m=>m.id===s);u?(this._updateLevels(u,!0),this.fire(new o.A("levelselected",{levelId:u.id}))):console.warn(`IndoorManager: Level with ID ${s} not found in the current floorplan.`)}_updateLevels(s,u){if(!s||!s.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function m(L){const N=L.indexOf("/floor/");if(N===-1)return L;const V=N+7,$=L.indexOf("/",V);return $===-1?L.slice(V):L.slice(V,$)}this._floorplanStates[this._indoorData.id].selectedLevel=s.id;const v=[],x={},S={},P={},O={};for(const L of this._indoorData.levels){if(v.push(L.id),x[L.id]=L.levelOrder>=0?3*Math.abs(L.levelOrder+1):3*Math.abs(L.levelOrder),S[L.id]=L.levelOrder>=0?3*L.levelOrder:0,this.mergeFloors){const N=m(s.id),V=m(L.id);P[L.id]=V===N?"true":"false"}else P[L.id]=L.id===s.id?"true":"false";O[L.id]=L.levelOrder<s.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",P]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",O]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",s.levelOrder<0)}selectFloorplan(s){const u={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},m=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],v=this._map.queryRenderedFeatures(m,u);if(v.length>0){for(const x of v)if(JSON.parse(x.properties["indoor-data"]).id===s){this._selectedFloorplan=x,this._floorplanSelected();break}}}selectBuilding(s){const u=this._indoorData.buildings.find(m=>m.id===s);this._buildingSelected(u,!0)}selectLevel(s){this._levelSelected(s)}}function NA(p){if(!p.metadata||!p.metadata.content_area)return;const s=o.q.devicePixelRatio,{left:u,top:m,width:v,height:x}=p.metadata.content_area,S=u*s,P=m*s;return[S,P,S+v*s,P+x*s]}function ab(p){if(p)return p.map(([s,u])=>[s*o.q.devicePixelRatio,u*o.q.devicePixelRatio])}class lb{constructor(s,u,m){this.id=s,this.scope=u,this.sourceCache=m,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(s){this.missingRequests.has(s.name)||this.pendingRequests.has(s.name)||this.pendingRequests.add(s.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const s=new Map;if(!this.sourceCache.loaded())return s;const u=this.sourceCache.getVisibleCoordinates();if(u.length===0)return s;const m=this.sourceCache.getSource();if(!(m instanceof gc))return s;const v=u.map(S=>this.sourceCache.getTile(S)),x=m.getImages(v,Array.from(this.pendingRequests));for(const[S,P]of x)s.set(o.I.from({name:S,iconsetId:this.id}),P),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),s}}const mu=(p,s)=>Ee(p,s&&s.filter(u=>u.identifier!=="source.canvas")),Hy=o.aF(tn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),cb=o.aF(tn,["setCenter","setZoom","setBearing","setPitch"]),Am=new Set(["background","sky","slot","custom"]),Wy={version:8,layers:[],sources:{}},qy={duration:300,delay:0};class Fo extends o.E{constructor(s,u={}){super(),this.map=s,this.scope=u.scope||"",this.globalId=null,this.fragments=[],this.importDepth=u.importDepth||0,this.importsCache=u.importsCache||new Map,this.resolvedImports=u.resolvedImports||new Set,this.transition=o.h({},qy),this._buildingIndex=new rb(this),this.crossTileSymbolIndex=new hs,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=u.styleChanges||new Nr,this.dispatcher=u.dispatcher?u.dispatcher:new o.D(o.c$(),this),u.imageManager?this.imageManager=u.imageManager:(this.imageManager=new Hn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=u.glyphManager?u.glyphManager:new o.d0(s._requestManager,u.localFontFamily?o.d1.all:u.localIdeographFontFamily?o.d1.ideographs:o.d1.none,u.localFontFamily||u.localIdeographFontFamily),u.modelManager?this.modelManager=u.modelManager:(this.modelManager=new sb(s._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=u.configOptions?u.configOptions:new Map,this._configDependentLayers=u.configDependentLayers?u.configDependentLayers:new Set,this._config=u.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:u.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=u.initialConfig,this.dispatcher.broadcast("setReferrer",o.d2());const m=this;this._rtlTextPluginCallback=Fo.registerForPluginStateChange(v=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(x,S)=>{if(o.d3(x),S&&S.every(P=>P))for(const P in m._sourceCaches){const O=m._sourceCaches[P],L=O.getSource().type;L!=="vector"&&L!=="geojson"||O.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;const x=this.getOwnSource(v.sourceId);if(x&&x.vectorLayerIds)for(const S in this._layers){const P=this._layers[S];P.source===x.id&&this._validateLayer(P)}})}load(s){return s?(typeof s=="string"?this.loadURL(s):this.loadJSON(s),this):this}_getGlobalId(s){if(!s)return null;if(typeof s=="string"){if(o.j(s))return s;const u=o.d4(s);if(!u.startsWith("http"))try{return new URL(u,location.href).toString()}catch{return u}return u}return`json://${o.d5(JSON.stringify(s))}`}_diffStyle(s,u,m){this.globalId=this._getGlobalId(s);const v=(x,S)=>{try{S(null,this.setState(x,m))}catch(P){S(P,!1)}};if(typeof s=="string"){const x=this.map._requestManager.normalizeStyleURL(s),S=this.map._requestManager.transformRequest(x,o.R.Style);o.n(S,(P,O)=>{P?this.fire(new o.z(P)):O&&v(O,u)})}else typeof s=="object"&&v(s,u)}loadURL(s,u={}){this.fire(new o.A("dataloading",{dataType:"style"}));const m=typeof u.validate=="boolean"?u.validate:!o.j(s);this.globalId=this._getGlobalId(s),s=this.map._requestManager.normalizeStyleURL(s,u.accessToken),this.resolvedImports.add(s);const v=this.importsCache.get(s);if(v)return this._load(v,m);const x=this.map._requestManager.transformRequest(s,o.R.Style);this._request=o.n(x,(S,P)=>{if(this._request=null,S)this.fire(new o.z(S));else if(P)return this.importsCache.set(s,P),this._load(P,m)})}loadJSON(s,u={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(s),this._request=o.q.frame(()=>{this._request=null,this._load(s,u.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(Wy,!1)}_loadImports(s,u,m){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const x of s){const S=this._createFragmentStyle(x),P=new Promise(N=>{S.once("style.import.load",N),S.once("error",N)}).then(()=>this.mergeAll());if(v.push(P),this.resolvedImports.has(x.url)){S.loadEmpty();continue}const O=x.data||this.importsCache.get(x.url);O?(S.loadJSON(O,{validate:u}),this._isInternalStyle(O)&&(S.globalId=null)):x.url?S.loadURL(x.url,{validate:u}):S.loadEmpty();const L={style:S,id:x.id,config:x.config};if(m){const N=this.fragments.findIndex(({id:V})=>V===m);this.fragments=this.fragments.slice(0,N).concat(L).concat(this.fragments.slice(N))}else this.fragments.push(L)}return Promise.allSettled(v)}getImportGlobalIds(s=this,u=new Set){for(const m of s.fragments)m.style.globalId&&u.add(m.style.globalId),this.getImportGlobalIds(m.style,u);return[...u.values()]}_createFragmentStyle(s){const u=this.scope?o.C(s.id,this.scope):s.id;let m;const v=this._initialConfig&&this._initialConfig[u];(s.config||v)&&(m=o.h({},s.config,v));const x=new Fo(this.map,{scope:u,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,colorThemeOverride:s["color-theme"],configDependentLayers:this._configDependentLayers});return x.setEventedParent(this.map,{style:x}),x}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(s){return this.isRootStyle()&&(s.fragment||!!s.schema&&s.fragment!==!1)}_load(s,u){const m=s.indoor?Ml(s.schema):s.schema;if(this._isInternalStyle(s)){const S=o.h({},Wy,{imports:[{id:"basemap",data:s,url:""}]});return void this._load(S,u)}if(this.updateConfig(this._config,m),u&&mu(this,Fi(s)))return;this._loaded=!0,this.stylesheet=o.d6(s);const v=()=>{for(const L in s.sources)this.addSource(L,s.sources[L],{validate:!1,isInitialLoad:!0});if(s.iconsets)for(const L in s.iconsets)this.addIconset(L,s.iconsets[L]);s.sprite?this._loadIconset(s.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(s.glyphs);const S=df(this.stylesheet.layers);if(this._order=S.map(L=>L.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const L=this.stylesheet.lights[0];this.light=new We(L.properties,L.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new We(this.stylesheet.light)),this._layers={};for(const L of S){const N=o.db(L,this.scope,this._styleColorTheme.lut,this.options);N.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N;const V=this.getOwnLayerSourceCache(N),$=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&N.canCastShadows()&&$&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const P=this.stylesheet.terrain;P&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(P,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const O=this.isRootStyle();s.imports?this._loadImports(s.imports,u).then(()=>{this._reloadImports(),this.fire(new o.A(O?"style.load":"style.import.load"))}).catch(L=>{this.fire(new o.z(new Error("Failed to load imports",L))),this.fire(new o.A(O?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(O?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const S=this._evaluateColorThemeData(x);this._loadColorTheme(S).then(()=>{v()}).catch(P=>{o.w(`Couldn't load color theme from the stylesheet: ${P}`),v()})}else this._styleColorTheme.lut=null,v()}isRootStyle(){return this.importDepth===0}mergeAll(){let s,u,m,v,x,S,P,O,L,N;const V={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle($=>{if($.stylesheet){if($.light!=null&&(s=$.light),$.stylesheet.lights)for(const W of $.stylesheet.lights)W.type==="ambient"&&$.ambientLight!=null&&(u=$.ambientLight),W.type==="directional"&&$.directionalLight!=null&&(m=$.directionalLight);v=this._prioritizeTerrain(v,$.terrain,$.stylesheet.terrain),$.stylesheet.fog&&$.fog!=null&&(x=$.fog),$.stylesheet.snow&&$.snow!=null&&(S=$.snow),$.stylesheet.rain&&$.rain!=null&&(P=$.rain),$.stylesheet.camera!=null&&(N=$.stylesheet.camera),$.stylesheet.projection!=null&&(O=$.stylesheet.projection),$.stylesheet.transition!=null&&(L=$.stylesheet.transition),V[$.scope]=$._styleColorTheme}}),this.light=s,this.ambientLight=u,this.directionalLight=m,this.fog=x,this.snow=S,this.rain=P,this._styleColorThemeForScope=V,v===null?delete this.terrain:this.terrain=v,this.camera=N||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=o.h({},qy,L),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(s){const u=m=>{for(const v of m.fragments)u(v.style);s(m)};u(this)}_prioritizeTerrain(s,u,m){const v=s&&s.drapeRenderMode===0;return m===null?u&&u.drapeRenderMode===0?u:v?s:null:u!=null&&(!s||v||u&&u.drapeRenderMode===1)?u:s}mergeTerrain(){let s;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(u=>{s=this._prioritizeTerrain(s,u.terrain,u.stylesheet.terrain)}),s===null?delete this.terrain:this.terrain=s}mergeProjection(){let s;this.forEachFragmentStyle(u=>{u.stylesheet.projection!=null&&(s=u.stylesheet.projection)}),this.projection=s||{name:"mercator"}}mergeSources(){const s={},u={},m={};this.forEachFragmentStyle(v=>{for(const x in v._sourceCaches){const S=o.C(x,v.scope);s[S]=v._sourceCaches[x]}for(const x in v._otherSourceCaches){const S=o.C(x,v.scope);u[S]=v._otherSourceCaches[x]}for(const x in v._symbolSourceCaches){const S=o.C(x,v.scope);m[S]=v._symbolSourceCaches[x]}}),this._mergedSourceCaches=s,this._mergedOtherSourceCaches=u,this._mergedSymbolSourceCaches=m}mergeLayers(){const s={},u=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const S of x._order){const P=x._layers[S];if(P.type==="slot"){const O=o.d7(S);if(s[O])continue;s[O]=[]}P.slot&&s[P.slot]?s[P.slot].push(P):u.push(P)}}),this._mergedOrder=[];const v=(x=[])=>{for(const S of x)if(S.type==="slot"){const P=o.d7(S.id);s[P]&&v(s[P]),this._mergedSlots.push(P)}else{const P=o.C(S.id,S.scope);this._mergedOrder.push(P),m[P]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};v(u),this._mergedOrder.sort((x,S)=>{const P=m[x],O=m[S];return P.hasInitialOcclusionOpacityProperties?O.is3D(!!this.terrain)?1:0:P.is3D(!!this.terrain)&&O.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(s){return this.stylesheet.camera=o.h({},this.stylesheet.camera,s),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(s){return s.data?function(u,m,v,x){const S=o.h({},m);for(const O of Object.keys(o.a5.colorTheme))S[O]===void 0&&(S[O]=o.a5.colorTheme[O].default);const P=new o.a6(Em,u,new Map(v));return P.setTransitionOrValue(S,v),P.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,s,this.options).get("data"):null}_loadColorTheme(s){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const u=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,v)=>{const x="data:image/png;base64,";if(!s||s.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let S=s;S.startsWith(x)||(S=x+S);const P=o.I.from("mapbox-reserved-lut"),O=new Image;O.src=S,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,v(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==u)return void m();this._styleColorTheme.lutLoading=!1;const{width:L,height:N,data:V}=o.q.getImageData(O);if(N>32)return void v(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==N*N)return void v(new Error("The width of the image must be equal to the height squared."));this.getImage(P)&&this.removeImage(P),this.addImage(P,{data:new o.r({width:L,height:N},V),pixelRatio:1,sdf:!1,usvg:!1,version:0});const $=this.imageManager.getImage(P,this.scope);$?(this._styleColorTheme.lut={image:$.data,data:s},m()):v(new Error("Missing LUT image."))}})}getLut(s){const u=this._styleColorThemeForScope[s];return u?u.lut:null}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(s){this._spriteRequest=function(u,m,v){let x,S,P;const O=o.q.devicePixelRatio>1?"@2x":"";let L=o.n(m.transformRequest(m.normalizeSpriteURL(u,O,".json"),o.R.SpriteJSON),($,W)=>{L=null,P||(P=$,x=W,V())}),N=o.o(m.transformRequest(m.normalizeSpriteURL(u,O,".png"),o.R.SpriteImage),($,W)=>{N=null,P||(P=$,S=W,V())});function V(){if(P)v(P);else if(x&&S){const $=o.q.getImageData(S),W={};for(const re in x){const{width:ee,height:ie,x:ae,y:ce,sdf:_e,pixelRatio:be,stretchX:Pe,stretchY:Ae,content:Te}=x[re],we=new o.r({width:ee,height:ie});o.r.copy($,we,{x:ae,y:ce},{x:0,y:0},{width:ee,height:ie},null),W[re]={data:we,pixelRatio:be,sdf:_e,stretchX:Pe,stretchY:Ae,content:Te,usvg:!1}}v(null,W)}}return{cancel(){L&&(L.cancel(),L=null),N&&(N.cancel(),N=null)}}}(s,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new o.z(u));else if(m){const v=new Map;for(const x in m)v.set(o.I.from(x),m[x]);this.addImages(v)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(s,u){if(u.type==="sprite")return void this._loadSprite(u.url);const m=this.getOwnSourceCache(u.source);if(!m)return void this.fire(new o.z(new Error(`Source "${u.source}" as specified by iconset "${s}" does not exist and cannot be used as an iconset source`)));const v=m.getSource();if(v.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${u.source}" as specified by iconset "${s}" is not a "raster-array" source and cannot be used as an iconset source`)));v.partial=!1;const x=new lb(s,this.scope,m);this.imageManager.addImageProvider(x,this.scope)}removeIconset(s){this.imageManager.removeImageProvider(s,this.scope)}_loadIconset(s){if(!o.j(s)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(s);const u=this.map._spriteFormat==="auto";var m,v;this._spriteRequest=(v=(x,S)=>{if(this._spriteRequest=null,x)u?this._loadSprite(s):this.fire(new o.z(x));else if(S){const P=new Map;for(const O in S)P.set(o.I.from(O),S[O]);this.addImages(P)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((m=this.map._requestManager).transformRequest(m.normalizeIconsetURL(s),o.R.Iconset),(x,S)=>{if(x)return void v(x);const P={},O=o.c_(new o.bq(S));for(const L of O.icons){const N={version:1,pixelRatio:o.q.devicePixelRatio,content:NA(L),stretchX:L.metadata?ab(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?ab(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};P[L.name]=N}v(null,P)}))}_validateLayer(s){const u=this.getOwnSource(s.source);if(!u)return;const m=s.sourceLayer;m&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.z(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:s}of this.fragments)if(!s.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((s,u)=>{const m=this.fragments[u];return m&&m.style&&(s.data=m.style.serialize()),s})}_serializeSources(){const s={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();s[m.id]||(s[m.id]=m.serialize())}return s}_serializeLayers(s){const u=[];for(const m of s){const v=this._layers[m];v&&v.type!=="custom"&&u.push(v.serialize())}return u}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(s){return s?this.order:this._mergedOrder}isLayerDraped(s){return!!this.terrain&&s.isDraped(this.getLayerSourceCache(s))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(s){const u=this.getOwnLayer(s);if(u)return u;this.fire(new o.z(new Error(`The layer '${s}' does not exist in the map's style.`)))}_checkSource(s){const u=this.getOwnSource(s);if(u)return u;this.fire(new o.z(new Error(`The source '${s}' does not exist in the map's style.`)))}precompilePrograms(s,u){const m=this.map.painter;if(m)for(let v=s.minzoom||0;v<(s.maxzoom||25.5);v++){const x=s.getProgramIds();if(x)for(const S of x){const P=s.getDefaultProgramParams(S,u.zoom,this._styleColorTheme.lut);P&&(m.style=this,this.fog&&(m._fogVisible=!0,P.overrideFog=!0,m.getOrCreateProgram(S,P)),m._fogVisible=!1,P.overrideFog=!1,m.getOrCreateProgram(S,P),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(P.overrideRtt=!0,m.getOrCreateProgram(S,P)))}}}update(s){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(s),this.directionalLight&&this.directionalLight.recalculate(s);const u=this.calculateLightsBrightness();s.brightness=u||0,u!==this._brightness&&(this._brightness=u,this.dispatcher.broadcast("setBrightness",u)),s.worldview!==this._worldview&&(this._worldview=s.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const m=this._changes.isDirty();let v=!1;if(this._changes.isDirty()){const P=this._changes.getLayerUpdatesByScope();for(const O in P){const{updatedIds:L,removedIds:N}=P[O];(L||N)&&(this._updateWorkerLayers(O,L,N),v=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(s),this.light&&this.light.updateTransitions(s),this.ambientLight&&this.ambientLight.updateTransitions(s),this.directionalLight&&this.directionalLight.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this.snow&&this.snow.updateTransitions(s),this.rain&&this.rain.updateTransitions(s),this._changes.reset()}const x={};for(const P in this._mergedSourceCaches){const O=this._mergedSourceCaches[P];x[P]=O.used,O.used=!1,O.tileCoverLift=0}for(const P of this._mergedOrder){const O=this._mergedLayers[P];if(O.recalculate(s,this._availableImages),!O.isHidden(s.zoom)){const L=this.getLayerSourceCache(O);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(O,s)}):this.precompilePrograms(O,s))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&v&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const P of S)P.sourceCache.used=!0;for(const P in x){const O=this._mergedSourceCaches[P];x[P]!==O.used&&O.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.snow&&this.snow.recalculate(s),this.rain&&this.rain.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),m&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const s=this.imageManager.getPendingImageProviders();for(const u of s){const m=u.resolvePendingRequests(),v=this.getFragmentStyle(u.scope);v&&v.addImages(m)}}_updateTilesForChangedImages(){const s={};for(const u in this._mergedSourceCaches){const m=this._mergedSourceCaches[u].getSource().scope;s[m]=s[m]||this._changes.getUpdatedImages(m),s[m].length!==0&&this._mergedSourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s[m])}for(const u in s)this._changes.resetUpdatedImages(u)}_updateWorkerLayers(s,u,m){const v=this.getFragmentStyle(s);v&&this.dispatcher.broadcast("updateLayers",{layers:u?v._serializeLayers(u):[],scope:s,removedIds:m||[],options:v.options})}setState(s,u){if(this._checkLoaded(),mu(this,Fi(s)))return!1;(s=o.d6(s)).layers=df(s.layers);const m=function(S,P){if(!S)return[{command:tn.setStyle,args:[P]}];let O=[];try{if(!o.bv(S.version,P.version))return[{command:tn.setStyle,args:[P]}];if(o.bv(S.center,P.center)||O.push({command:tn.setCenter,args:[P.center]}),o.bv(S.zoom,P.zoom)||O.push({command:tn.setZoom,args:[P.zoom]}),o.bv(S.bearing,P.bearing)||O.push({command:tn.setBearing,args:[P.bearing]}),o.bv(S.pitch,P.pitch)||O.push({command:tn.setPitch,args:[P.pitch]}),o.bv(S.sprite,P.sprite)||O.push({command:tn.setSprite,args:[P.sprite]}),o.bv(S.glyphs,P.glyphs)||O.push({command:tn.setGlyphs,args:[P.glyphs]}),o.bv(S.imports,P.imports)||function(W=[],re=[],ee){re=re||[];const ie=(W=W||[]).map(au),ae=re.map(au),ce=W.reduce(_c,{}),_e=re.reduce(_c,{}),be=ie.slice();let Pe,Ae,Te,we;for(Pe=0,Ae=0;Pe<ie.length;Pe++)Te=ie[Pe],_e.hasOwnProperty(Te)?Ae++:(ee.push({command:tn.removeImport,args:[Te]}),be.splice(be.indexOf(Te,Ae),1));for(Pe=0,Ae=0;Pe<ae.length;Pe++)Te=ae[ae.length-1-Pe],be[be.length-1-Pe]!==Te&&(ce.hasOwnProperty(Te)?(ee.push({command:tn.removeImport,args:[Te]}),be.splice(be.lastIndexOf(Te,be.length-Ae),1)):Ae++,we=be[be.length-Pe],ee.push({command:tn.addImport,args:[_e[Te],we]}),be.splice(be.length-Pe,0,Te));for(const Ce of re){const Oe=ce[Ce.id];Oe&&(delete Oe.data,o.bv(Oe,Ce)||ee.push({command:tn.updateImport,args:[Ce.id,Ce]}))}}(S.imports,P.imports,O),o.bv(S.transition,P.transition)||O.push({command:tn.setTransition,args:[P.transition]}),o.bv(S.light,P.light)||O.push({command:tn.setLight,args:[P.light]}),o.bv(S.fog,P.fog)||O.push({command:tn.setFog,args:[P.fog]}),o.bv(S.snow,P.snow)||O.push({command:tn.setSnow,args:[P.snow]}),o.bv(S.rain,P.rain)||O.push({command:tn.setRain,args:[P.rain]}),o.bv(S.projection,P.projection)||O.push({command:tn.setProjection,args:[P.projection]}),o.bv(S.lights,P.lights)||O.push({command:tn.setLights,args:[P.lights]}),o.bv(S.camera,P.camera)||O.push({command:tn.setCamera,args:[P.camera]}),o.bv(S.iconsets,P.iconsets)||function(W,re,ee){let ie;for(ie in re=re||{},W=W||{})W.hasOwnProperty(ie)&&(re.hasOwnProperty(ie)||ee.push({command:tn.removeIconset,args:[ie]}));for(ie in re){if(!re.hasOwnProperty(ie))continue;const ae=re[ie];W.hasOwnProperty(ie)?o.bv(W[ie],ae)||(ee.push({command:tn.removeIconset,args:[ie]}),ee.push({command:tn.addIconset,args:[ie,ae]})):ee.push({command:tn.addIconset,args:[ie,ae]})}}(S.iconsets,P.iconsets,O),!o.bv(S["color-theme"],P["color-theme"]))return[{command:tn.setStyle,args:[P]}];const L={},N=[];(function(W,re,ee,ie){let ae;for(ae in re=re||{},W=W||{})W.hasOwnProperty(ae)&&(re.hasOwnProperty(ae)||uh(ae,ee,ie));for(ae in re){if(!re.hasOwnProperty(ae))continue;const ce=re[ae];W.hasOwnProperty(ae)?o.bv(W[ae],ce)||(W[ae].type==="geojson"&&ce.type==="geojson"&&MA(W,re,ae)?ee.push({command:tn.setGeoJSONSourceData,args:[ae,ce.data]}):ff(ae,re,ee,ie)):gm(ae,re,ee)}})(S.sources,P.sources,N,L);const V=[];S.layers&&S.layers.forEach(W=>{W.source&&L[W.source]?O.push({command:tn.removeLayer,args:[W.id]}):V.push(W)});let $=S.terrain;$&&L[$.source]&&(O.push({command:tn.setTerrain,args:[void 0]}),$=void 0),O=O.concat(N),o.bv($,P.terrain)||O.push({command:tn.setTerrain,args:[P.terrain]}),function(W,re,ee){re=re||[];const ie=(W=W||[]).map(au),ae=re.map(au),ce=W.reduce(_c,{}),_e=re.reduce(_c,{}),be=ie.slice(),Pe=Object.create(null);let Ae,Te,we,Ce,Oe,Ve,Ge;for(Ae=0,Te=0;Ae<ie.length;Ae++)we=ie[Ae],_e.hasOwnProperty(we)?Te++:(ee.push({command:tn.removeLayer,args:[we]}),be.splice(be.indexOf(we,Te),1));for(Ae=0,Te=0;Ae<ae.length;Ae++)we=ae[ae.length-1-Ae],be[be.length-1-Ae]!==we&&(ce.hasOwnProperty(we)?(ee.push({command:tn.removeLayer,args:[we]}),be.splice(be.lastIndexOf(we,be.length-Te),1)):Te++,Ve=be[be.length-Ae],ee.push({command:tn.addLayer,args:[_e[we],Ve]}),be.splice(be.length-Ae,0,we),Pe[we]=!0);for(Ae=0;Ae<ae.length;Ae++)if(we=ae[Ae],Ce=ce[we],Oe=_e[we],!Pe[we]&&!o.bv(Ce,Oe))if(o.bv(Ce.source,Oe.source)&&o.bv(Ce["source-layer"],Oe["source-layer"])&&o.bv(Ce.type,Oe.type)){for(Ge in pf(Ce.layout,Oe.layout,ee,we,null,tn.setLayoutProperty),pf(Ce.paint,Oe.paint,ee,we,null,tn.setPaintProperty),o.bv(Ce.slot,Oe.slot)||ee.push({command:tn.setSlot,args:[we,Oe.slot]}),o.bv(Ce.filter,Oe.filter)||ee.push({command:tn.setFilter,args:[we,Oe.filter]}),o.bv(Ce.minzoom,Oe.minzoom)&&o.bv(Ce.maxzoom,Oe.maxzoom)||ee.push({command:tn.setLayerZoomRange,args:[we,Oe.minzoom,Oe.maxzoom]}),Ce)Ce.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?pf(Ce[Ge],Oe[Ge],ee,we,Ge.slice(6),tn.setPaintProperty):o.bv(Ce[Ge],Oe[Ge])||ee.push({command:tn.setLayerProperty,args:[we,Ge,Oe[Ge]]}));for(Ge in Oe)Oe.hasOwnProperty(Ge)&&!Ce.hasOwnProperty(Ge)&&Ge!=="layout"&&Ge!=="paint"&&Ge!=="filter"&&Ge!=="metadata"&&Ge!=="minzoom"&&Ge!=="maxzoom"&&Ge!=="slot"&&(Ge.indexOf("paint.")===0?pf(Ce[Ge],Oe[Ge],ee,we,Ge.slice(6),tn.setPaintProperty):o.bv(Ce[Ge],Oe[Ge])||ee.push({command:tn.setLayerProperty,args:[we,Ge,Oe[Ge]]}))}else ee.push({command:tn.removeLayer,args:[we]}),Ve=be[be.lastIndexOf(we)+1],ee.push({command:tn.addLayer,args:[Oe,Ve]})}(V,P.layers,O)}catch(L){console.warn("Unable to compute style diff:",L),O=[{command:tn.setStyle,args:[P]}]}return O}(this.serialize(),s).filter(S=>!(S.command in cb));if(m.length===0)return!1;const v=m.filter(S=>!(S.command in Hy));if(v.length>0)throw new Error(`Unimplemented: ${v.map(S=>S.command).join(", ")}.`);const x=[];return m.forEach(S=>{x.push(this[S.command](...S.args))}),u&&Promise.all(x).then(u).catch(u),this.stylesheet=s,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(s){for(const[u,m]of s.entries()){if(this.getImage(u))return this.fire(new o.z(new Error(`An image with the name "${u.name}" already exists.`)));this.imageManager.addImage(u,this.scope,m),this._changes.updateImage(u,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(s,u){return this.getImage(s)?this.fire(new o.z(new Error(`An image with the name "${s.name}" already exists.`))):(this.imageManager.addImage(s,this.scope,u),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(s,u,m=!1){this.imageManager.updateImage(s,this.scope,u),m&&(this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(s){return this.imageManager.getImage(s,this.scope)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s,this.scope),this._changes.updateImage(s,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(s){return this.modelManager.addModelURLs(s,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(s,u,m={}){return this._checkLoaded(),this._validate(xe,`models.${s}`,u,null,m)||(this.modelManager.addModel(s,u,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(s){return this.modelManager.hasModel(s,this.scope)}removeModel(s){return this.hasModel(s)?(this.modelManager.removeModel(s,this.scope),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(s,u,m={}){if(this._checkLoaded(),this.getOwnSource(s)!==void 0)throw new Error(`There is already a source with ID "${s}".`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(xs,`sources.${s}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=sf(s,u,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));const x=S=>{const P=(S?"symbol:":"other:")+v.id,O=o.C(P,this.scope),L=this._sourceCaches[P]=new us(O,v,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=L,L.onAdd(this.map)};x(!1),u.type!=="vector"&&u.type!=="geojson"||x(!0),v.onAdd&&v.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(s){this._checkLoaded();const u=this.getOwnSource(s);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===s)return this.fire(new o.z(new Error(`Source "${s}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===s)return this.fire(new o.z(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const v=Object.entries(this.stylesheet.iconsets).find(([x,S])=>S.type==="source"&&S.source===s);if(v)return this.fire(new o.z(new Error(`Source "${s}" cannot be removed while iconset "${v[0]}" is using it.`)))}const m=this.getOwnSourceCaches(s);for(const v of m){const x=o.d7(v.id);delete this._sourceCaches[x],this._changes.discardSourceCacheUpdate(v.id),v.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],this.mergeSources(),u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(s,u){this._checkLoaded(),this.getOwnSource(s).setData(u),this._changes.setDirty()}getOwnSource(s){const u=this.getOwnSourceCache(s);return u&&u.getSource()}getOwnSources(){const s=[];for(const u in this._otherSourceCaches){const m=this.getOwnSourceCache(u);m&&s.push(m.getSource())}return s}areTilesLoaded(){const s=this._mergedSourceCaches;for(const u in s){const m=s[u]._tiles;for(const v in m){const x=m[v];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}setLights(s){if(this._checkLoaded(),!s)return delete this.ambientLight,void delete this.directionalLight;const u=this._getTransitionParameters();for(const x of s){if(this._validate(Tl,"lights",x))return;switch(x.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(x),S.updateTransitions(u)}else this.ambientLight=new _n(x,Rr||(Rr=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(x),S.updateTransitions(u)}else this.directionalLight=new _n(x,Cn||(Cn=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=Object.assign(u,{worldview:this.map.getWorldview()}),v=new o.aa(this.z||0,m);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const s=this.directionalLight,u=this.ambientLight;if(!s||!u)return;const m=$=>.2126*($[0]<=.03928?$[0]/12.92:Math.pow(($[0]+.055)/1.055,2.4))+.7152*($[1]<=.03928?$[1]/12.92:Math.pow(($[1]+.055)/1.055,2.4))+.0722*($[2]<=.03928?$[2]/12.92:Math.pow(($[2]+.055)/1.055,2.4)),v=s.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),x=s.properties.get("intensity"),S=s.properties.get("direction"),P=1-o.cR(S.x,S.y,S.z)[2]/90,O=m(v)*x*P,L=u.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),N=u.properties.get("intensity"),V=m(L)*N;return Number(((O+V)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const s=[];return this.directionalLight&&s.push(this.directionalLight.get()),this.ambientLight&&s.push(this.ambientLight.get()),s}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(s){if(s==null||s===""&&this.isRootStyle())return this;if(o.d8(s)){const u=o.d9(s),m=this.fragments.find(({id:x})=>x===u);if(!m)return;const v=o.d7(s);return m.style.getFragmentStyle(v)}{const u=this.fragments.find(({id:m})=>m===s);return u?u.style:void 0}}setFeaturesetSelectors(s){if(!s)return;const u={},m=(v,x="")=>`${v}::${x}`;this._featuresetSelectors={};for(const v in s){const x=this._featuresetSelectors[v]=[];for(const S of s[v].selectors){if(S.featureNamespace){const O=this.getOwnLayer(S.layer);if(!O){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const L=m(O.source,O.sourceLayer);if(L in u&&u[L]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${v}'s selector is not associated to the same source, skip this selector`);continue}u[L]=S.featureNamespace}let P;if(S.properties)for(const O in S.properties){const L=o.X(S.properties[O]);L.result==="success"&&(P=P||{},P[O]=L.value)}x.push({layerId:S.layer,namespace:S.featureNamespace,properties:P,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(s){const u=this.getFragmentStyle(s);if(!u||!u.stylesheet.featuresets)return[];const m=[];for(const v in u.stylesheet.featuresets)m.push({featuresetId:v,importId:u.scope?u.scope:void 0});return m}getFeaturesetLayers(s,u){const m=this.getFragmentStyle(u),v=m.stylesheet.featuresets;if(!v||!v[s])return this.fire(new o.z(new Error(`The featureset '${s}' does not exist in the map's style and cannot be queried.`))),[];const x=[];for(const S of v[s].selectors){const P=m.getOwnLayer(S.layer);P&&x.push(P)}return x}getConfigProperty(s,u){const m=this.getFragmentStyle(s);if(!m)return null;const v=o.C(u,m.scope),x=m.options.get(v),S=x?x.value||x.default:null;return S?S.serialize():null}setConfigProperty(s,u,m){const v=this.getFragmentStyle(s);if(!v)return;const x=v.stylesheet.indoor?Ml(v.stylesheet.schema):v.stylesheet.schema;if(!x||!x[u])return;const S=o.X(m);if(S.result!=="success")return void mu(this,S.value);const P=S.value.expression,O=o.C(u,v.scope),L=v.options.get(O);if(!L)return;let N;const{minValue:V,maxValue:$,stepValue:W,type:re,values:ee}=x[u],ie=o.X(x[u].default);ie.result==="success"&&(N=ie.value.expression),N?(this.options.set(O,Object.assign({},L,{value:P,default:N,minValue:V,maxValue:$,stepValue:W,type:re,values:ee})),this.updateConfigDependencies(u)):this.fire(new o.z(new Error(`No schema defined for the config option "${u}" in the "${s}" fragment.`)))}getConfig(s){const u=this.getFragmentStyle(s);if(!u)return null;const m=u.stylesheet.schema;if(!m)return null;const v={};for(const x in m){const S=o.C(x,u.scope),P=u.options.get(S),O=P?P.value||P.default:null;v[x]=O?O.serialize():null}return v}setConfig(s,u){const m=this.getFragmentStyle(s);m&&(m.updateConfig(u,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(s){const u=this.getFragmentStyle(s);return u?u.stylesheet.schema:null}setSchema(s,u){const m=this.getFragmentStyle(s);m&&(m.stylesheet.schema=u,m.updateConfig(m._config,u),this.updateConfigDependencies())}updateConfig(s,u){if(this._config=s,s||u)if(u)for(const m in u){let v,x;const S=o.X(u[m].default);if(S.result==="success"&&(v=S.value.expression),s&&s[m]!==void 0){const $=o.X(s[m]);$.result==="success"&&(x=$.value.expression)}const{minValue:P,maxValue:O,stepValue:L,type:N,values:V}=u[m];if(v){const $=o.C(m,this.scope);this.options.set($,{default:v,value:x,minValue:P,maxValue:O,stepValue:L,type:N,values:V})}else this.fire(new o.z(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(s){for(const u of this._configDependentLayers){const m=this.getLayer(u);if(m){if(s&&!m.configDependencies.has(s))continue;m.possiblyEvaluateVisibility(),this._updateLayer(m)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(u=>{const m=u._styleColorTheme.colorThemeOverride?u._styleColorTheme.colorThemeOverride:u._styleColorTheme.colorTheme;if(m){const v=u._evaluateColorThemeData(m);(!u._styleColorTheme.lut&&v!==""||u._styleColorTheme.lut&&v!==u._styleColorTheme.lut.data)&&u.setColorTheme(m)}}),this._changes.setDirty()}addLayer(s,u,m={}){this._checkLoaded();const v=s.id;if(this._layers[v])return void this.fire(new o.z(new Error(`Layer with id "${v}" already exists on this map`)));let x;if(s.type==="custom"){if(mu(this,o.da(s)))return;x=o.db(s,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof s.source=="object"&&(this.addSource(v,s.source),s=o.d6(s),s=o.h(s,{source:v})),this._validate(nn,`layers.${v}`,s,{arrayIndex:-1},m))return;x=o.db(s,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(x),x.setEventedParent(this,{layer:{id:v}})}x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid);let S=this._order.length;if(u){const N=this._order.indexOf(u);if(N===-1)return void this.fire(new o.z(new Error(`Layer with id "${u}" does not exist on this map.`)));x.slot===this._layers[u].slot?S=N:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,v),this._layerOrderChanged=!0,this._layers[v]=x;const P=this.getOwnLayerSourceCache(x),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&x.canCastShadows()&&O&&(P.castsShadows=!0);const L=this._changes.getRemovedLayer(x);if(L&&x.source&&P&&x.type!=="custom"){this._changes.discardLayerRemoval(x);const N=o.C(x.source,x.scope);L.type!==x.type?this._changes.updateSourceCache(N,"clear"):(this._changes.updateSourceCache(N,"reload"),P.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),x.scope=this.scope,this.mergeLayers()}moveLayer(s,u){this._checkLoaded();const m=this._checkLayer(s);if(!m||s===u)return;const v=this._order.indexOf(s);this._order.splice(v,1);let x=this._order.length;if(u){const S=this._order.indexOf(u);if(S===-1)return void this.fire(new o.z(new Error(`Layer with id "${u}" does not exist on this map.`)));m.slot===this._layers[u].slot?x=S:o.w(`Layer with id "${u}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,s),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(s){this._checkLoaded();const u=this._checkLayer(s);if(!u)return;u.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),delete this._layers[s],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(u.fqid),this._changes.removeLayer(u);const v=this.getOwnLayerSourceCache(u);if(v&&v.castsShadows){let x=!1;for(const S in this._layers)if(this._layers[S].source===u.source&&this._layers[S].canCastShadows()){x=!0;break}v.castsShadows=x}u.onRemove&&u.onRemove(this.map),this.mergeLayers()}getOwnLayer(s){return this._layers[s]}hasLayer(s){return s in this._mergedLayers}hasLayerType(s){for(const u in this._layers)if(this._layers[u].type===s)return!0;return!1}setLayerZoomRange(s,u,m){this._checkLoaded();const v=this._checkLayer(s);v&&(v.minzoom===u&&v.maxzoom===m||(u!=null&&(v.minzoom=u),m!=null&&(v.maxzoom=m),this._updateLayer(v)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(s,u){this._checkLoaded();const m=this._checkLayer(s);m&&m.slot!==u&&(m.slot=u,this._updateLayer(m))}setFilter(s,u,m={}){this._checkLoaded();const v=this._checkLayer(s);if(v&&!o.bv(v.filter,u))return u==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(Je,`layers.${v.id}.filter`,u,{layerType:v.type},m)||(v.filter=o.d6(u),this._updateLayer(v)))}getFilter(s){const u=this._checkLayer(s);if(u)return o.d6(u.filter)}setLayoutProperty(s,u,m,v={}){this._checkLoaded();const x=this._checkLayer(s);if(x&&!o.bv(x.getLayoutProperty(u),m)){if(m!=null&&(!v||v.validate!==!1)&&mu(x,ue.call(Fi,{key:`layers.${s}.layout.${u}`,layerType:x.type,objectKey:u,value:m,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;x.setLayoutProperty(u,m),x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),this._updateLayer(x)}}getLayoutProperty(s,u){const m=this._checkLayer(s);if(m)return m.getLayoutProperty(u)}setPaintProperty(s,u,m,v={}){this._checkLoaded();const x=this._checkLayer(s);if(!x||o.bv(x.getPaintProperty(u),m)||m!=null&&(!v||v.validate!==!1)&&mu(x,se.call(Fi,{key:`layers.${s}.paint.${u}`,layerType:x.type,objectKey:u,value:m,styleSpec:o.a5})))return;const S=x.setPaintProperty(u,m);x.configDependencies.size!==0&&this._configDependentLayers.add(x.fqid),S&&this._updateLayer(x),this._changes.updatePaintProperties(x)}getPaintProperty(s,u){const m=this._checkLayer(s);if(m)return m.getPaintProperty(u)}setFeatureState(s,u){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:L}=s.target,N=this.getFragmentStyle(L),V=N.getFeaturesetLayers(O);for(const{source:$,sourceLayer:W}of V)N.setFeatureState({id:s.id,source:$,sourceLayer:W},u)}else if("layerId"in s.target){const{layerId:O}=s.target,L=this.getLayer(O);this.setFeatureState({id:s.id,source:L.source,sourceLayer:L.sourceLayer},u)}return}const m=s.source,v=s.sourceLayer,x=this._checkSource(m);if(!x)return;const S=x.type;if(S==="geojson"&&v)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!v)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const P=this.getOwnSourceCaches(m);for(const O of P)O.setFeatureState(v,s.id,u)}removeFeatureState(s,u){if(this._checkLoaded(),"target"in s){if("featuresetId"in s.target){const{featuresetId:O,importId:L}=s.target,N=this.getFragmentStyle(L),V=N.getFeaturesetLayers(O);for(const{source:$,sourceLayer:W}of V)N.removeFeatureState({id:s.id,source:$,sourceLayer:W},u)}else if("layerId"in s.target){const{layerId:O}=s.target,L=this.getLayer(O);this.removeFeatureState({id:s.id,source:L.source,sourceLayer:L.sourceLayer},u)}return}const m=s.source,v=this._checkSource(m);if(!v)return;const x=v.type,S=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!S)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const P=this.getOwnSourceCaches(m);for(const O of P)O.removeFeatureState(S,s.id,u)}getFeatureState(s){if(this._checkLoaded(),"target"in s){let x;if("featuresetId"in s.target){const{featuresetId:S,importId:P}=s.target,O=this.getFragmentStyle(P),L=O.getFeaturesetLayers(S);for(const{source:N,sourceLayer:V}of L){const $=O.getFeatureState({id:s.id,source:N,sourceLayer:V});if($&&!x)x=$;else if(!o.bv(x,$))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in s.target){const{layerId:S}=s.target,P=this.getLayer(S);x=this.getFeatureState({id:s.id,source:P.source,sourceLayer:P.sourceLayer})}return x}const u=s.source,m=s.sourceLayer,v=this._checkSource(u);if(v){if(v.type!=="vector"||m)return s.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(u)[0].getFeatureState(m,s.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(s){return this.stylesheet.transition=o.h({},this.stylesheet.transition,s),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const s=this.getTerrain(),u=s&&this.terrain&&this.terrain.scope===this.scope?s:this.stylesheet.terrain;return o.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:u,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateFilteredLayers(s){for(const u of Object.values(this._mergedLayers))s(u)&&this._updateLayer(u)}_updateLayer(s){this._changes.updateLayer(s);const u=this.getLayerSourceCache(s),m=o.C(s.source,s.scope),v=this._changes.getUpdatedSourceCaches();s.source&&!v[m]&&u&&u.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),u.pause()),s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const u=P=>this._mergedLayers[P].is3D(!!this.terrain),m=this.order,v={},x=[];for(let P=m.length-1;P>=0;P--){const O=m[P];if(u(O)){v[O]=P;for(const L of s){const N=L[O];if(N)for(const V of N)x.push(V)}}}x.sort((P,O)=>O.intersectionZ-P.intersectionZ);const S=[];for(let P=m.length-1;P>=0;P--){const O=m[P];if(u(O))for(let L=x.length-1;L>=0;L--){const N=x[L].feature;if(N.layer&&v[N.layer.id]<P)break;S.push(N),x.pop()}else for(const L of s){const N=L[O];if(N)for(const V of N)S.push(V.feature)}}return S}queryRenderedFeatures(s,u,m){let v;u&&!Array.isArray(u)&&u.filter&&(this._validate(Je,"queryRenderedFeatures.filter",u.filter,null,u),v=o.b3(u.filter));const x={},S=N=>{if(Am.has(N.type))return;const V=this.getOwnLayerSourceCache(N),$=x[V.id]=x[V.id]||{sourceCache:V,layers:{},has3DLayers:!1};N.is3D(!!this.terrain)&&($.has3DLayers=!0),$.layers[N.fqid]=$.layers[N.fqid]||{styleLayer:N,targets:[]},$.layers[N.fqid].targets.push({filter:v})};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const N of u.layers){const V=this._layers[N];if(!V)return this.fire(new o.z(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];S(V)}}else for(const N in this._layers)S(this._layers[N]);const P=this._queryRenderedFeatures(s,x,m),O=this._flattenAndSortRenderedFeatures(P),L=[];for(const N of O)o.dd(N.layer.id)===this.scope&&L.push(N);return L}queryRenderedFeatureset(s,u,m){let v;u&&!Array.isArray(u)&&u.filter&&(this._validate(Je,"queryRenderedFeatures.filter",u.filter,null,u),v=o.b3(u.filter));const x="mock",S=[];if(u&&u.target)S.push(Object.assign({},u,{targetId:x,filter:v}));else{const N=this.getFeaturesetDescriptors();for(const V of N)S.push({targetId:x,filter:v,target:V});for(const{style:V}of this.fragments){const $=V.getFeaturesetDescriptors();for(const W of $)S.push({targetId:x,filter:v,target:W})}}const P=this.queryRenderedTargets(s,S,m),O=[],L=new Set;for(const N of P)for(const V of N.variants[x])fm(V,N,L)||O.push(new o.de(N,V));return O}queryRenderedTargets(s,u,m){const v={},x=(P,O,L,N)=>{const V=v[O.id]=v[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(V.layers[P.fqid]=V.layers[P.fqid]||{styleLayer:P,targets:[]},P.is3D(!!this.terrain)&&(V.has3DLayers=!0),!N)return L.uniqueFeatureID=!1,void V.layers[P.fqid].targets.push(L);V.layers[P.fqid].targets.push(Object.assign({},L,{namespace:N.namespace,properties:N.properties,uniqueFeatureID:N.uniqueFeatureID}))};for(const P of u)if("featuresetId"in P.target){const{featuresetId:O,importId:L}=P.target,N=this.getFragmentStyle(L);if(!N||!N._featuresetSelectors)continue;const V=N._featuresetSelectors[O];if(!V){this.fire(new o.z(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const $ of V){const W=N.getOwnLayer($.layerId);W&&!Am.has(W.type)&&x(W,N.getOwnLayerSourceCache(W),P,$)}}else if("layerId"in P.target){const{layerId:O}=P.target,L=this.getLayer(O);if(!L||Am.has(L.type))continue;x(L,this.getLayerSourceCache(L),P)}const S=this._queryRenderedFeatures(s,v,m);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(s,u,m){const v=[],x=!!this.map._showQueryGeometry,S=sn.createFromScreenPoints(s,m);for(const P in u){const O=pm(S,u[P],this._availableImages,m,x);Object.keys(O).length&&v.push(O)}if(this.placement)for(const P in u){if(!u[P].sourceCache._onlySymbols)continue;const O=iu(S.screenGeometry,u[P],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&v.push(O)}return v}querySourceFeatures(s,u){const m=u&&u.filter;m&&this._validate(Je,"querySourceFeatures.filter",m,null,u);let v=[];const x=this.getOwnSourceCaches(s);for(const S of x)v=v.concat(lf(S,u));return v}addSourceType(s,u,m){return Fo.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(Fo.setSourceType(s,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:u.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(s,u,m={}){this._checkLoaded();const v=this.light.getLight();let x=!1;for(const P in s)if(!o.bv(s[P],v[P])){x=!0;break}if(!x)return;const S=this._getTransitionParameters();this.light.setLight(s,u,m),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(s,u=1){if(this._checkLoaded(),!s)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),u===0&&delete this.terrain,s===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=s;const v=s.source==null;if(u===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const P="terrain-dem-src";this.addSource(P,m.source),m=o.d6(m),m=o.h(m,{source:P})}const x=o.h({},m),S={};if(this.terrain&&v){x.source=this.terrain.get().source;const P=this.terrain?this.getFragmentStyle(this.terrain.scope):null;P&&(S.style=P.serialize())}if(this._validate(Dt,"terrain",x,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&u!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,u),this.fire(new o.A("data",{dataType:"style"}))}else{const x=this.terrain,S=x.get();for(const P of Object.keys(o.a5.terrain))!m.hasOwnProperty(P)&&o.a5.terrain[P].default&&(m[P]=o.a5.terrain[P].default);for(const P in s)if(!o.bv(s[P],S[P])){x.set(s,this.options),this.stylesheet.terrain=s;const O=this._getTransitionParameters({duration:0});x.updateTransitions(O),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const u=this.fog=new Sr(s,this.map.transform,this.scope,this.options);this.stylesheet.fog=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_createSnow(s){const u=this.snow=new Yn(s,this.map.transform,this.scope,this.options);this.stylesheet.snow=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_createRain(s){const u=this.rain=new Jn(s,this.map.transform,this.scope,this.options);this.stylesheet.rain=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog;if(!o.bv(u.get(),s)){u.set(s,this.options),this.stylesheet.fog=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createFog(s);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(s){if(this._checkLoaded(),!s)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const u=this.snow;if(!o.bv(u.get(),s)){u.set(s,this.options),this.stylesheet.snow=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createSnow(s);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(s){if(this._checkLoaded(),!s)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const u=this.rain;if(!o.bv(u.get(),s)){u.set(s,this.options),this.stylesheet.rain=u.get();const m=this._getTransitionParameters({duration:0});u.updateTransitions(m)}}else this._createRain(s);this._markersNeedUpdate=!0}_reloadColorTheme(){const s=()=>{for(const v in this._layers)this._layers[v].lut=this._styleColorTheme.lut;for(const v in this._sourceCaches)this._sourceCaches[v].clearTiles()},u=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!u)return this._styleColorTheme.lut=null,void s();const m=this._evaluateColorThemeData(u);this._loadColorTheme(m).then(()=>{this.fire(new o.A("colorthemeset")),s()}).catch(v=>{o.w(`Couldn't set color theme: ${v}`)})}setColorTheme(s){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=s,this._reloadColorTheme()}setImportColorTheme(s,u){const m=this.getFragmentStyle(s);m&&(m._styleColorTheme.colorThemeOverride=u,m._reloadColorTheme())}_getTransitionParameters(s){return{now:o.q.now(),transition:o.h(this.transition,s)}}updateDrapeFirstLayers(){if(!this.terrain)return;const s=[],u=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?s.push(m):u.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...u)}_createTerrain(s,u){const m=this.terrain=new Ne(s,u,this.scope,this.options,this.map.getWorldview());u===1&&(this.stylesheet.terrain=s),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const v=this._getTransitionParameters({duration:0});m.updateTransitions(v)}_force3DLayerUpdate(){for(const s in this._layers){const u=this._layers[s];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const u=this._layers[s];u.type==="symbol"&&this._updateLayer(u)}}_validate(s,u,m,v,x={}){if(x&&x.validate===!1)return!1;const S=o.h({},this.serialize());return mu(this,s.call(Fi,o.h({key:u,style:S,value:m,styleSpec:o.a5},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._mergedLayers)this._mergedLayers[s].setEventedParent(null);for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles(),this._mergedSourceCaches[s].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(s){const u=this.getSourceCaches(s);for(const m of u)m.clearTiles()}clearSources(){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].clearTiles()}reloadSource(s){const u=this.getSourceCaches(s);for(const m of u)m.resume(),m.reload()}reloadSources(){for(const s of this.getSources())s.reload&&s.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(s=>{s.modelManager.reloadModels(s.scope)})}updateSources(s){let u;this.directionalLight&&(u=gh(this.directionalLight));const m=new Set;for(const v in this._mergedLayers){const x=this._mergedLayers[v];x.hasElevation()&&!m.has(x.source)&&m.add(x.source)}for(const v in this._mergedSourceCaches){const x=this._mergedSourceCaches[v],S=m.has(x._source.id);x.update(s,void 0,void 0,u,S)}}_generateCollisionBoxes(){for(const s in this._sourceCaches){const u=this._sourceCaches[s];u.resume(),u.reload()}}_updatePlacement(s,u,m,v,x,S,P=!1){let O=!1,L=!1;const N={},V={};for(const $ of this._mergedOrder){const W=this._mergedLayers[$];if(W.type!=="symbol")continue;const re=o.C(W.source,W.scope);let ee=N[re];if(!ee){const ae=this.getLayerSourceCache(W);if(!ae)continue;const ce=ae.getRenderableIds(!0).map(_e=>ae.getTileByID(_e));V[re]=ce.slice(),ee=N[re]=ce.sort((_e,be)=>be.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(be.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(W,ee,u.center.lng,u.projection);O=O||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),P=P||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(P||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),u.zoom))&&(this.pauseablePlacement=new Sm(u,this._mergedOrder,P,m,v,x,this.placement,this.fog&&u.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,N,V,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),L=!0),O&&this.pauseablePlacement.placement.setStale()),L||O){this._buildingIndex.onNewFrame(u.zoom);for(let $=0;$<this._mergedOrder.length;$++){const W=this._mergedLayers[this._mergedOrder[$]];if(W.type!=="symbol")continue;const re=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,N[o.C(W.source,W.scope)],$,re?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}addImport(s,u){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:x})=>x===s.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${s.id}' already exists in the map's style.`)));if(!u)return m.push(s),this._loadImports([s],!0);const v=m.findIndex(({id:x})=>x===u);return v===-1&&this.fire(new o.z(new Error(`Import with id "${u}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,v).concat(s).concat(m.slice(v)),this._loadImports([s],!0,u)}updateImport(s,u){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(s);return v===-1?this:typeof u=="string"?(this.setImportUrl(s,u),this):(u.url&&u.url!==m[v].url&&this.setImportUrl(s,u.url),o.bv(u.config,m[v].config)||this.setImportConfig(s,u.config,u.data.schema),o.bv(u.data,m[v].data)||this.setImportData(s,u.data),this)}moveImport(s,u){this._checkLoaded();let m=this.stylesheet.imports||[];const v=this.getImportIndex(s);if(v===-1)return this;const x=this.getImportIndex(u);if(x===-1)return this;const S=m[v],P=this.fragments[v];return m=m.filter(({id:O})=>O!==s),this.fragments=this.fragments.filter(({id:O})=>O!==s),this.stylesheet.imports=m.slice(0,x).concat(S).concat(m.slice(x)),this.fragments=this.fragments.slice(0,x).concat(P).concat(this.fragments.slice(x)),this.mergeLayers(),this}setImportUrl(s,u){this._checkLoaded();const m=this.stylesheet.imports||[],v=this.getImportIndex(s);if(v===-1)return this;m[v].url=u;const x=this.fragments[v];return x.style=this._createFragmentStyle(m[v]),x.style.on("style.import.load",()=>this.mergeAll()),x.style.loadURL(u),this}setImportData(s,u){this._checkLoaded();const m=this.getImportIndex(s),v=this.stylesheet.imports||[];return m===-1?this:u?(this.fragments[m].style.setState(u),this._reloadImports(),this):(delete v[m].data,this.setImportUrl(s,v[m].url))}setImportConfig(s,u,m){this._checkLoaded();const v=this.getImportIndex(s),x=this.stylesheet.imports||[];if(v===-1)return this;u?x[v].config=u:delete x[v].config;const S=this.fragments[v];m&&S.style.stylesheet&&(S.style.stylesheet.schema=m);const P=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=u,S.style.updateConfig(u,P),this.updateConfigDependencies(),this}removeImport(s){this._checkLoaded();const u=this.stylesheet.imports||[],m=this.getImportIndex(s);m!==-1&&(u.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(s){const u=(this.stylesheet.imports||[]).findIndex(m=>m.id===s);return u===-1&&this.fire(new o.z(new Error(`Import '${s}' does not exist in the map's style and cannot be updated.`))),u}getLayer(s){return this._mergedLayers[s]}getSources(){const s=[];for(const u in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[u];m&&s.push(m.getSource())}return s}getSource(s,u){const m=this.getSourceCache(s,u);return m&&m.getSource()}getLayerSource(s){const u=this.getLayerSourceCache(s);return u&&u.getSource()}getSourceCache(s,u){const m=o.C(s,u);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(s){const u=o.C(s.source,s.scope);return s.type==="symbol"?this._mergedSymbolSourceCaches[u]:this._mergedOtherSourceCaches[u]}getSourceCaches(s){if(s==null)return Object.values(this._mergedSourceCaches);const u=[];return this._mergedOtherSourceCaches[s]&&u.push(this._mergedOtherSourceCaches[s]),this._mergedSymbolSourceCaches[s]&&u.push(this._mergedSymbolSourceCaches[s]),u}updateSourceCaches(){const s=this._changes.getUpdatedSourceCaches();for(const u in s){const m=s[u];m==="reload"?this.reloadSource(u):m==="clear"&&this.clearSource(u)}}updateLayers(s){const u=this._changes.getUpdatedPaintProperties();for(const m of u){const v=this.getLayer(m);v&&v.updateTransitions(s)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(s){this.stylesheet.glyphs=s,this.glyphManager.setURL(s,this.scope)}getImages(s,u,m){this.imageManager.getImages(u.images,u.scope,m),this._updateTilesForChangedImages();const v=S=>{if(S){const P=u.images.map(O=>o.I.toString(O));S.setDependencies(u.tileID.key,u.type,P)}},x=o.C(u.source,u.scope);v(this._mergedOtherSourceCaches[x]),v(this._mergedSymbolSourceCaches[x])}rasterizeImages(s,u,m){this.imageManager.rasterizeImages(u,m)}getGlyphs(s,u,m){this.glyphManager.getGlyphs(u.stacks,u.scope,m)}getResource(s,u,m){return o.dg(u,m)}getOwnSourceCache(s){return this._otherSourceCaches[s]}getOwnLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}getOwnSourceCaches(s){const u=[];return this._otherSourceCaches[s]&&u.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&u.push(this._symbolSourceCaches[s]),u}_isSourceCacheLoaded(s){const u=this.getOwnSourceCaches(s);return u.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${s}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(s,u){if(!this._clipLayerPresent&&s.type!=="fill-extrusion"&&s.type!=="building")return!1;const m=s.type==="fill-extrusion"&&s.sourceLayer==="building",v=s.type==="building";if(s.is3D(!!this.terrain)){if(m||v||u&&u.type==="batched-model"||s.type==="model")return!0}else if(s.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(s=>{s.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Fo.getSourceType=function(p){return dm[p]},Fo.setSourceType=function(p,s){dm[p]=s},Fo.registerForPluginStateChange=o.dh;var Tf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zy=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Xy=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,yh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",vh=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ky=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Pm=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Us=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Cm=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Nt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Yy=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const xh=[];aa(Tf,xh),aa(Xy,xh),aa(Zy,xh);const bh={"_prelude_fog.vertex.glsl":Ky,"_prelude_terrain.vertex.glsl":vh,"_prelude_shadow.vertex.glsl":Nt,"_prelude_fog.fragment.glsl":Pm,"_prelude_shadow.fragment.glsl":Yy,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Us,"_prelude_raster_particle.glsl":Cm},Ef={};Kr("",vh),Kr(Pm,Ky),Kr(Yy,Nt),Kr(Us,""),Kr(Cm,"");const Af=Kr(Zy,Xy),Ja=Tf;var Im={background:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Kr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Kr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Kr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Kr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Kr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Kr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Kr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Kr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Kr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Kr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Kr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Kr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Kr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Kr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Kr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Kr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Kr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,yh),skyboxGradient:Kr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,yh),skyboxCapture:Kr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Kr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Kr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Kr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Kr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Kr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Kr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Kr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Kr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function aa(p,s){const u=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of u)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const v=m.split(" ");for(const x of v)s.includes(x)||s.push(x)}}function Kr(p,s){const u=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let v=s.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(L=>{const N=L.split(" ");return N[N.length-1]}),v=[...new Set(v)]);const x={},S=[],P=[];if(p=p.replace(u,(L,N)=>(P.push(N),"")),(s=s.replace(u,(L,N)=>(S.push(N),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let O=[...xh];aa(p,O),aa(s,O);for(const L of[...S,...P])bh[L]||console.error(`Undefined include: ${L}`),Ef[L]||(Ef[L]=[],aa(bh[L],Ef[L])),O=[...O,...Ef[L]];return{fragmentSource:p=p.replace(m,(L,N,V,$,W)=>(x[W]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${W}
in ${V} ${$} ${W};
#else
uniform ${V} ${$} u_${W};
#endif
`:N==="initialize"?`
#ifdef HAS_UNIFORM_u_${W}
    ${V} ${$} ${W} = u_${W};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${V} ${$} ${W};
#endif
`:N==="initialize-attribute"?"":void 0)),vertexSource:s=s.replace(m,(L,N,V,$,W)=>{const re=$==="float"?"vec2":$,ee=W.match(/color/)?"color":re;return N==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${W}
in ${V} ${$} a_${W};
#endif
`:x[W]?N==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${V} ${re} a_${W};
out ${V} ${$} ${W};
#else
uniform ${V} ${$} u_${W};
#endif
`:N==="initialize"?ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = a_${W};
#else
    ${V} ${$} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${W} = unpack_mix_${ee}(a_${W}, u_${W}_t);
#else
    ${V} ${$} ${W} = u_${W};
#endif
`:N==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    in ${V} ${$} a_${W};
    out ${V} ${$} ${W};
#endif
`:N==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${W} = a_${W};
#endif
`:void 0:N==="define"?`
#ifndef HAS_UNIFORM_u_${W}
uniform lowp float u_${W}_t;
in ${V} ${re} a_${W};
#else
uniform ${V} ${$} u_${W};
#endif
`:N==="define-instanced"?ee==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${W}0;
in vec4 a_${W}1;
in vec4 a_${W}2;
in vec4 a_${W}3;
#else
uniform ${V} ${$} u_${W};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${V} ${re} a_${W};
#else
uniform ${V} ${$} u_${W};
#endif
`:N==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${W}
    ${V} ${$} ${W} = a_${W};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${W}
    ${V} ${$} ${W} = a_${W};
#else
    ${V} ${$} ${W} = u_${W};
#endif
`:`
#ifndef HAS_UNIFORM_u_${W}
    ${V} ${$} ${W} = unpack_mix_${ee}(a_${W}, u_${W}_t);
#else
    ${V} ${$} ${W} = u_${W};
#endif
`}),staticAttributes:v,usedDefines:O,vertexIncludes:S,fragmentIncludes:P}}class wh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,u,m,v,x,S,P,O){this.context=s;let L=this.boundPaintVertexBuffers.length!==v.length;for(let V=0;!L&&V<v.length;V++)this.boundPaintVertexBuffers[V]!==v[V]&&(L=!0);let N=this.boundDynamicVertexBuffers.length!==P.length;for(let V=0;!N&&V<P.length;V++)this.boundDynamicVertexBuffers[V]!==P[V]&&(N=!0);if(!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||L||N||this.boundIndexBuffer!==x||this.boundVertexOffset!==S)this.freshBind(u,m,v,x,S,P,O);else{s.bindVertexArrayOES.set(this.vao);for(const V of P)V&&(V.bind(),O&&V.instanceCount&&V.setVertexAttribDivisor(s.gl,u,O));x&&x.dynamicDraw&&x.bind()}}freshBind(s,u,m,v,x,S,P){const O=s.numAttributes,L=this.context,N=L.gl;this.vao&&this.destroy(),this.vao=L.gl.createVertexArray(),L.bindVertexArrayOES.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=v,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=S,u.enableAttributes(N,s),u.bind(),u.setVertexAttribPointers(N,s,x);for(const V of m)V.enableAttributes(N,s),V.bind(),V.setVertexAttribPointers(N,s,x);for(const V of S)V&&(V.enableAttributes(N,s),V.bind(),V.setVertexAttribPointers(N,s,x),P&&V.instanceCount&&V.setVertexAttribDivisor(N,s,P));v&&v.bind(),L.currentNumAttributes=O}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function jA(p,s){const u=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new o.ac(0,m/u).toLngLat().lat,new o.ac(0,(m+1)/u).toLngLat().lat]}function FA(p,s,u,m,v,x,S){const P=p.context,O=P.gl,L=u.hillshadeFBO;if(!L)return;p.prepareDrawTile();const N=p.isTileAffectedByFog(s),V=p.getOrCreateProgram("hillshade",{overrideFog:N});P.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,L.colorAttachment.get());const $=((ie,ae,ce,_e)=>{const be=ce.paint.get("hillshade-shadow-color"),Pe=ce.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ae=ce.paint.get("hillshade-highlight-color"),Te=ce.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",we=ce.paint.get("hillshade-accent-color"),Ce=ce.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Oe=ce.paint.get("hillshade-emissive-strength");let Ve=o.al(ce.paint.get("hillshade-illumination-direction"));if(ce.paint.get("hillshade-illumination-anchor")==="viewport")Ve-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const at=ie.style.directionalLight.properties.get("direction"),lt=o.cR(at.x,at.y,at.z);Ve=o.al(lt[1])}const Ge=!ie.options.moving;return{u_matrix:_e||ie.transform.calculateProjMatrix(ae.tileID.toUnwrapped(),Ge),u_image:0,u_latrange:jA(0,ae.tileID),u_light:[ce.paint.get("hillshade-exaggeration"),Ve],u_shadow:be.toPremultipliedRenderColor(Pe?null:ce.lut),u_highlight:Ae.toPremultipliedRenderColor(Te?null:ce.lut),u_emissive_strength:Oe,u_accent:we.toPremultipliedRenderColor(Ce?null:ce.lut)}})(p,u,m,p.terrain?s.projMatrix:null);p.uploadCommonUniforms(P,V,s.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:re,tileBoundsSegments:ee}=p.getTileBoundsBuffers(u);V.draw(p,O.TRIANGLES,v,x,S,dr.disabled,$,m.id,W,re,ee)}function Om(p,s,u){if(!s.needsDEMTextureUpload)return;const m=p.context,v=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(u.stride);const x=u.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new o.T(m,x,v.R32F,{premultiply:!1}),s.needsDEMTextureUpload=!1}function BA(p,s,u){const m=p.context,v=m.gl;if(!s.dem)return;const x=s.dem;if(m.activeTexture.set(v.TEXTURE1),Om(p,s,x),!s.demTexture)return;s.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const S=x.dim;m.activeTexture.set(v.TEXTURE0);let P=s.hillshadeFBO;if(!P){const $=new o.T(m,{width:S,height:S,data:null},v.RGBA8);$.bind(v.LINEAR,v.CLAMP_TO_EDGE),P=s.hillshadeFBO=m.createFramebuffer(S,S,!0,"renderbuffer"),P.colorAttachment.set($.texture)}m.bindFramebuffer.set(P.framebuffer),m.viewport.set([0,0,S,S]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:L,tileBoundsSegments:N}=p.getMercatorTileBoundsBuffers(),V=[];p.linearFloatFilteringSupported()&&V.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:V}).draw(p,v.TRIANGLES,Gt.disabled,br.disabled,$r.unblended,dr.disabled,(($,W)=>{const re=W.stride,ee=o.bz();return o.c5(ee,0,o.aj,-8192,0,0,1),o.bo(ee,ee,[0,-8192,0]),{u_matrix:ee,u_image:1,u_dimension:[re,re],u_zoom:$.overscaledZ}})(s.tileID,x),u.id,O,L,N),s.needsHillshadePrepare=!1}class li{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ub extends li{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Jy extends li{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class $A extends li{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class UA extends li{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class VA extends li{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class GA extends li{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class hb extends li{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class HA extends li{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Mm extends li{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class WA extends li{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class db extends li{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class Qy extends li{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Rm extends li{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class ev extends li{getDefault(){const s=this.gl;return[s.ONE,s.ZERO,s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.blendFuncSeparate(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class gu extends li{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Sh extends li{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(s,s),this.current=s,this.dirty=!1)}}class km extends li{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class Dm extends li{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Th extends li{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let fb=class extends li{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class tv extends li{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class pb extends li{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Eh extends li{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Lm extends li{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class zm extends li{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class rv extends li{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Nm extends li{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Pf extends li{getDefault(){return null}set(s){this.gl&&(s!==this.current||this.dirty)&&(this.gl.bindVertexArray(s),this.current=s,this.dirty=!1)}}class mb extends li{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class gb extends li{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class _b extends li{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class bc extends li{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class yb extends bc{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class vb extends bc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class qA extends bc{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,this.attachment(),u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class ZA extends vb{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const nv=(p,s,u)=>({u_matrix:p,u_image0:0,u_skirt_height:s,u_ground_shadow_factor:u}),jm=(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:x,u_image0:0,u_frustum_tl:S,u_frustum_tr:P,u_frustum_br:O,u_frustum_bl:L,u_globe_pos:N,u_globe_radius:V,u_viewport:$,u_grid_matrix:ee?Float32Array.from(ee):new Float32Array(9),u_skirt_height:W,u_far_z_cutoff:re});function Fm(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const wc=new class{constructor(){this.operations={}}newMorphing(p,s,u,m,v){if(p in this.operations){const x=this.operations[p];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[p]={startTime:m,phase:0,duration:v,from:s,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const u=this.operations[s];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},iv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ov(p,s,u){if(s===0)return 0;const m=s<1&&u===514?.25/s:1;return 6*Math.pow(1.5,22-p)*Math.max(s,1)*m}function XA(p,s){const u=1<<p.z;return!s&&(p.x===0||p.x===u-1)||p.y===0||p.y===u-1}const _u=p=>({u_matrix:p});function yu(p,s,u,m,v){if(v>0){const x=o.q.now(),S=(x-p.timeAdded)/v,P=s?(x-s.timeAdded)/v:-1,O=u.getSource(),L=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),N=!s||Math.abs(s.tileID.overscaledZ-L)>Math.abs(p.tileID.overscaledZ-L),V=N&&p.refreshedUponExpiration?1:o.ay(N?S:1-P,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-V}:{opacity:V,mix:0}}return{opacity:1,mix:0}}class xb extends us{constructor(s){const u={type:"raster-dem",maxzoom:s.transform.maxZoom},m=new o.D(o.c$(),null),v=sf("mock-dem",u,m,s.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,u){s.state="loaded",u(null)}}class Vs extends us{constructor(s){const u=sf("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new o.D(o.c$(),null),s.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,u,m){if(s.freezeTileCoverage)return;this.transform=s;const v=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,S)=>{if(x[S.key]="",!this._tiles[S.key]){const P=new ou(S,this._source.tileSize*S.overscaleFactor(),s.tileZoom,void 0,void 0,this._source.worldview);P.state="loaded",this._tiles[S.key]=P}return x},{});for(const x in this._tiles)x in v||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const u=this.proxyCachedFBO[s];if(u!==void 0){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Bm extends o.aM{constructor(s,u,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class Cf extends o.dt{constructor(s,u){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},s.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),s.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,v,x]=function(O){const L=new o.ba,N=new o.a_,V=131;L.reserve(17161),N.reserve(33800);const $=o.aj/128,W=o.aj+$/2,re=W+$;for(let ie=-64;ie<re;ie+=$)for(let ae=-64;ae<re;ae+=$){const ce=ae<0||ae>W||ie<0||ie>W?24575:0,_e=o.ay(Math.round(ae),0,o.aj),be=o.ay(Math.round(ie),0,o.aj);L.emplaceBack(_e+ce,be)}const ee=(ie,ae)=>{const ce=ae*V+ie;N.emplaceBack(ce+1,ce,ce+V),N.emplaceBack(ce+V,ce+V+1,ce+1)};for(let ie=1;ie<129;ie++)for(let ae=1;ae<129;ae++)ee(ae,ie);return[0,129].forEach(ie=>{for(let ae=0;ae<130;ae++)ee(ae,ie),ee(ie,ae)}),[L,N,32768]}(),S=s.context;this.gridBuffer=S.createVertexBuffer(m,o.bc.members),this.gridIndexBuffer=S.createIndexBuffer(v),this.gridSegments=o.bd.simpleSegment(0,0,m.length,v.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Vs(u.map),this.orthoMatrix=o.bz(),o.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const P=S.gl;this._overlapStencilMode=new br({func:P.GEQUAL,mask:255},0,255,P.KEEP,P.KEEP,P.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new xb(u.map),this._pendingGroundEffectLayers=[]}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),this._style=s,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,u,m){if(s&&s.terrain){this._style!==s&&(this.style=s,this._evaluationZoom=void 0);const v=s.terrain.properties,x=s.terrain.drapeRenderMode===0,S=s.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const P=s.terrain&&s.terrain.scope,O=v.get("source"),L=x?this._mockSourceCache:s.getSourceCache(O,P);if(!L)return void o.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=L,this._attenuationRange=s.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(u):v.get("exaggeration"),!u.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const N=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const V=this.getScaledDemTileSize();this.sourceCache.update(u,V,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,N(),this._initializing=!0),N(),u.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0,this._previousZoom=u.zoom}else this._disable()}calculateExaggeration(s){if(this._attenuationRange&&s.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(s.zoom);const u=this._previousCameraAltitude,m=s.getFreeCameraOptions().position.z/s.pixelsPerMeter*s.worldSize;this._previousCameraAltitude=m;const v=u!=null?m-u:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;const x=s.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(x);let P=x-this._previousZoom;const O=this._previousUpdateTimestamp;let L=x;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(x-L)>.5&&(P=.5*(x-L+P)),P*v<0&&(L+=P)),this._evaluationZoom=L;const N=S.getExaggeration(L),V=N===S.getExaggeration(Math.max(0,L-.1));if(V&&Math.abs(N-this._exaggeration)<.01)return N;let $=Math.min(.1,.00375*(this._updateTimestamp-O));return(V||N<.1||Math.abs(P)<1e-4)&&($=Math.min(.2,4*$)),o.ai(this._exaggeration,N,$)}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._mergedSourceCaches)this._style._mergedSourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(O=>{const L=u.getTileByID(O).tileID;return L.projMatrix=m.calculateProjMatrix(L.toUnwrapped()),L});(function(O,L){const N=L.transform.pointCoordinate(L.transform.getCameraPoint()),V=new o.P(N.x,N.y);O.sort(($,W)=>{if(W.overscaledZ-$.overscaledZ)return W.overscaledZ-$.overscaledZ;const re=new o.P($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),ee=new o.P(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),ie=V.mult(1<<$.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(re)-ie.distSqr(ee)})})(v,this.painter);const x=this.proxyToSource||{};this.proxyToSource={},v.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const O in S){const L=S[O];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,s[O],x),L.usedForTerrain))continue;const N=s[O];L.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[u.id]=v.map(O=>new Bm(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1;const P={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const L=this.terrainTileForTile[O.key];if(!L)continue;const N=L.tileID.key;N in P||(this._visibleDemTiles.push(L),P[N]=N)}}_assignTerrainTiles(s){this._initializing||s.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,u=s.gl;for(const m in this.terrainTileForTile){const v=this.terrainTileForTile[m],x=v.dem;!x||v.demTexture&&!v.needsDEMTextureUpload||(s.activeTexture.set(u.TEXTURE1),Om(this.painter,v,x))}}_prepareDemTileUniforms(s,u,m,v){if(!u||u.demTexture==null)return!1;const x=s.tileID.canonical,S=Math.pow(2,u.tileID.canonical.z-x.z),P=v||"";return m[`u_dem_tl${P}`]=[x.x*S%1,x.y*S%1],m[`u_dem_scale${P}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let s=0;const u=this._visibleDemTiles.reduce((m,v)=>{if(!v.dem)return m;const x=v.dem.tree.minimums[0];return x>0&&s++,m+x},0);return s?u/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,u=s.gl;s.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),v=new o.du({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(s,v,u.R32F,{premultiply:!1}),x}setupElevationDraw(s,u,m){const v=this.painter.context,x=v.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let P=null,O=null,L=1;if(m&&m.morphing&&this._useVertexMorphing){const W=m.morphing.srcDemTile,re=m.morphing.dstDemTile;L=m.morphing.phase,W&&re&&(this._prepareDemTileUniforms(s,W,S,"_prev")&&(O=W),this._prepareDemTileUniforms(s,re,S)&&(P=re))}const N=W=>W&&W.demTexture&&this.painter.linearFloatFilteringSupported()?x.LINEAR:x.NEAREST;let V=null;var $;if(this.enabled?O&&P?(V=P.demTexture,v.activeTexture.set(x.TEXTURE4),O.demTexture.bind(N(O),x.CLAMP_TO_EDGE),S.u_dem_lerp=L):(P=this.terrainTileForTile[s.tileID.key],V=this._prepareDemTileUniforms(s,P,S)?P.demTexture:this.emptyDEMTexture):V=this.emptyDEMTexture,v.activeTexture.set(x.TEXTURE2),V&&(S.u_dem_size=($=V).size[0]===1?1:$.size[0]-2,V.bind(N(P),x.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,u,S),m&&m.useMeterToDem&&P){const W=(1<<P.tileID.canonical.z)*o.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=W}if(m&&m.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(v,S),this.painter.transform.projection.name==="globe"){const W=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);u.setGlobeUniformValues(v,W)}}globeUniformValues(s,u,m){const v=s.projection;return{u_tile_tl_up:v.upVector(u,0,0),u_tile_tr_up:v.upVector(u,o.aj,0),u_tile_br_up:v.upVector(u,o.aj,o.aj),u_tile_bl_up:v.upVector(u,0,o.aj),u_tile_up_scale:m?o.dv(1):v.upVectorScale(u,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const u=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,x,S,P,O){if(v.transform.projection.name==="globe")(function(L,N,V,$,W){const re=L.context,ee=re.gl;let ie,ae;const ce=L.transform,_e=o.dl(L,re,ce),be=(at,lt)=>{if(ae===lt)return;const yt=[iv[lt],"PROJECTION_GLOBE_VIEW"];_e&&yt.push("CUSTOM_ANTIALIASING");const Fe=L.isTileAffectedByFog(at);ie=L.getOrCreateProgram("globeRaster",{defines:yt,overrideFog:Fe}),ae=lt},Pe=L.colorModeForRenderPass(),Ae=new Gt(ee.LEQUAL,Gt.ReadWrite,L.depthRangeFor3D);wc.update(W);const Te=o.dm(ce),we=[o.aD(ce.center.lng),o.aH(ce.center.lat)],Ce=L.globeSharedBuffers,Oe=[ce.width*o.q.devicePixelRatio,ce.height*o.q.devicePixelRatio],Ve=Float32Array.from(ce.globeMatrix),Ge={useDenormalizedUpVectorScale:!0};{const at=L.transform,lt=ov(at.zoom,N.exaggeration(),N.sourceCache._source.tileSize);ae=-1;const yt=ee.TRIANGLES;for(const Fe of $){const tt=V.getTile(Fe),Le=br.disabled,ht=N.prevTerrainTileForTile[Fe.key],Ye=N.terrainTileForTile[Fe.key];Fm(ht,Ye)&&wc.newMorphing(Fe.key,ht,Ye,W,250),re.activeTexture.set(ee.TEXTURE0),tt.texture&&tt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const gt=wc.getMorphValuesForProxy(Fe.key),Ot=gt?1:0;gt&&o.L(Ge,{morphing:{srcDemTile:gt.from,dstDemTile:gt.to,phase:o.dk(gt.phase)}});const ut=o.dn(Fe.canonical),Ct=o.dp(ut.getCenter().lat),Wt=o.dq(Fe.canonical,ut,Ct,at.worldSize/at._pixelsPerMercatorPixel),qt=o.bh(o.dr(Fe.canonical)),Vt=jm(at.expandedFarZProjMatrix,Ve,Te,qt,o.ah(at.zoom),we,at.frustumCorners.TL,at.frustumCorners.TR,at.frustumCorners.BR,at.frustumCorners.BL,at.globeCenterInViewSpace,at.globeRadius,Oe,lt,at._farZ,Wt);if(be(Fe,Ot),ie&&(N.setupElevationDraw(tt,ie,Ge),L.uploadCommonUniforms(re,ie,Fe.toUnwrapped()),Ce)){const[tr,ir,ar]=Ce.getGridBuffers(Ct,lt!==0);ie.draw(L,yt,Ae,Le,Pe,dr.backCCW,Vt,"globe_raster",tr,ir,ar)}}}if(Ce&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const at=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];_e&&at.push("CUSTOM_ANTIALIASING"),ie=L.getOrCreateProgram("globeRaster",{defines:at});for(const lt of $){const{x:yt,y:Fe,z:tt}=lt.canonical,Le=Fe===0,ht=Fe===(1<<tt)-1,[Ye,gt,Ot,ut]=Ce.getPoleBuffers(tt,!1);if(ut&&(Le||ht)){const Ct=V.getTile(lt);re.activeTexture.set(ee.TEXTURE0),Ct.texture&&Ct.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let Wt=o.ds(tt,yt,ce);const qt=o.bh(o.dr(lt.canonical)),Vt=(tr,ir)=>tr.draw(L,ee.TRIANGLES,Ae,br.disabled,Pe,dr.disabled,jm(ce.expandedFarZProjMatrix,Wt,Wt,qt,0,we,ce.frustumCorners.TL,ce.frustumCorners.TR,ce.frustumCorners.BR,ce.frustumCorners.BL,ce.globeCenterInViewSpace,ce.globeRadius,Oe,0,ce._farZ),"globe_pole_raster",ir,Ot,ut);N.setupElevationDraw(Ct,ie,Ge),L.uploadCommonUniforms(re,ie,lt.toUnwrapped()),Le&&L.renderDefaultNorthPole&&Vt(ie,Ye),ht&&L.renderDefaultSouthPole&&(Wt=o.cE(o.bz(),Wt,[1,-1,1]),Vt(ie,gt))}}}})(v,x,S,P,O);else{const L=v.context,N=L.gl;let V,$;const W=v.shadowRenderer,re=Ya(v,v.longestCutoffRange),ee=Pe=>{if($===Pe)return;const Ae=[];Ae.push(iv[Pe]),re.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),W&&(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&Ae.push("NORMAL_OFFSET")),V=v.getOrCreateProgram("terrainRaster",{defines:Ae}),$=Pe},ie=v.colorModeForRenderPass(),ae=new Gt(N.LEQUAL,Gt.ReadWrite,v.depthRangeFor3D);wc.update(O);const ce=v.transform,_e=ov(ce.zoom,x.exaggeration(),x.sourceCache._source.tileSize);let be=[0,0,0];if(W){const Pe=v.style.directionalLight,Ae=v.style.ambientLight;Pe&&Ae&&(be=pu(v.style,Pe,Ae))}{$=-1;const Pe=N.TRIANGLES,[Ae,Te]=[x.gridIndexBuffer,x.gridSegments];for(const we of P){const Ce=S.getTile(we),Oe=br.disabled,Ve=x.prevTerrainTileForTile[we.key],Ge=x.terrainTileForTile[we.key];Fm(Ve,Ge)&&wc.newMorphing(we.key,Ve,Ge,O,250),L.activeTexture.set(N.TEXTURE0),Ce.texture&&Ce.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const at=wc.getMorphValuesForProxy(we.key),lt=at?1:0;let yt;at&&(yt={morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:o.dk(at.phase)}});const Fe=nv(we.projMatrix,XA(we.canonical,ce.renderWorldCopies)?_e/10:_e,be);if(ee(lt),!V)continue;x.setupElevationDraw(Ce,V,yt);const tt=we.toUnwrapped();W&&W.setupShadows(tt,V),v.uploadCommonUniforms(L,V,tt,null,re),V.draw(v,Pe,ae,Oe,ie,dr.backCCW,Fe,"terrain_raster",x.gridBuffer,Ae,Te)}}}}(u,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,v=this.proxySourceCache,x=this.proxiedCoords[v.id],S=this._drapedRenderBatches.shift(),P=u.style.order,O=[];let L=0;for(const N of x){const V=v.getTileByID(N.proxyTileKey),$=v.proxyCachedFBO[N.key]?v.proxyCachedFBO[N.key][s]:void 0,W=$!==void 0?v.renderCache[$]:this.pool[L++],re=$!==void 0;if(V.texture=W.tex,re&&!W.dirty){O.push(V.tileID);continue}let ee;m.bindFramebuffer.set(W.fb.framebuffer),this.renderedToTile=!1,W.dirty&&(m.clear({color:o.am.transparent,stencil:0}),W.dirty=!1);for(let ie=S.start;ie<=S.end;++ie){const ae=u.style._mergedLayers[P[ie]];if(ae.isHidden(u.transform.zoom))continue;const ce=u.style.getLayerSourceCache(ae),_e=ce?this.proxyToSource[N.key][ce.id]:[N];if(!_e)continue;const be=_e;m.viewport.set([0,0,W.fb.width,W.fb.height]),ee!==(ce?ce.id:null)&&(this._setupStencil(W,_e,ae,ce),ee=ce?ce.id:null),u.renderLayer(u,ce,ae,be)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const ae=u.style._mergedLayers[P[ie]];if(ae.isHidden(u.transform.zoom))continue;const ce=u.style.getLayerSourceCache(ae),_e=ce?this.proxyToSource[N.key][ce.id]:[N];if(!_e)continue;const be=_e;m.viewport.set([0,0,W.fb.width,W.fb.height]),ee!==(ce?ce.id:null)&&(this._setupStencil(W,_e,ae,ce),ee=ce?ce.id:null),u.renderLayer(u,ce,ae,be)}this.renderedToTile?(W.dirty=!0,O.push(V.tileID)):re||--L,L===5&&(L=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),S.end+1}postRender(){}isLayerOrderingCorrect(s){const u=s.order.length;let m=-1,v=u;for(let x=0;x<u;++x)this._style.isLayerDraped(s._mergedLayers[s.order[x]])?m=Math.max(m,x):v=Math.min(v,x);return v>m}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{s=Math.min(s,u.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,u,m){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const S=x.tileID,P=1<<S.overscaledZ,{x:O,y:L}=S.canonical,N=O/P,V=(O+1)/P,$=L/P,W=(L+1)/P;return{minx:N,miny:$,maxx:V,maxy:W,t:x.dem.tree.raycastRoot(N,$,V,W,s,u,m),tile:x}});v.sort((x,S)=>(x.t!==null?x.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const x of v){if(x.t==null)return null;const S=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,u,m);if(S!=null)return S}return null}_createFBO(){const s=this.painter.context,u=s.gl,m=this.drapeBufferSize;s.activeTexture.set(u.TEXTURE0);const v=new o.T(s,{width:m[0],height:m[1],data:null},u.RGBA8);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const x=s.createFramebuffer(m[0],m[1],!0,null);return x.colorAttachment.set(v.texture),x.depthAttachment=new ZA(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const s in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const u=this._style._mergedLayers[s],m=u.isHidden(this.painter.transform.zoom);return u.type==="hillshade"||u.type==="custom"?!m&&u.shouldRedrape():!m&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style.getSources())if(m instanceof of){s=!0;break}if(!s)return;const u={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],x=this._style.getLayerSourceCache(v);if(x&&!u[x.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof o.ab){u[x.id]=!0;for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][x.id];if(P)for(const O of P)this._clearRenderCacheForTile(x.id,O)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof wo){s=!0;break}if(!s)return;const u={};for(let m=0;m<this._style.order.length;++m){const v=this._style._mergedLayers[this._style.order[m]],x=this._style.getLayerSourceCache(v);if(!x||u[x.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;const S=v.paint.get("raster-fade-duration");for(const P of this.proxyCoords){const O=this.proxyToSource[P.key][x.id];if(O)for(const L of O){const N=yu(x.getTile(L),x.findLoadedParent(L,0),x,this.painter.transform,S);(N.opacity!==1||N.mix!==0)&&this._clearRenderCacheForTile(x.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const s=this._style.order,u=s.length;if(u===0)return;const m=[];this._pendingGroundEffectLayers=[];let v,x=0,S=this._style._mergedLayers[s[x]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++x<u;)S=this._style._mergedLayers[s[x]];for(;x<u;++x){const P=this._style._mergedLayers[s[x]];P.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(P)?v===void 0&&(v=x):(P.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(x),v!==void 0&&(m.push({start:v,end:x-1}),v=void 0)))}if(v!==void 0&&m.push({start:v,end:x-1}),m.length!==0){const P=m[m.length-1];this._pendingGroundEffectLayers.every(O=>O>P.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(s){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const S=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let P=0;P<S.length;++P){const O=Object.values(S[P]);u.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,v=this._tilesDirty;for(let S=m.length-1;S>=0;S--){const P=m[S];if(u.getTileByID(P.key),u.proxyCachedFBO[P.key]!==void 0){const O=s[P.key],L=this.proxyToSource[P.key];let N=0;for(const V in L){const $=L[V],W=O[V];if(!W||W.length!==$.length||$.some((re,ee)=>re!==W[ee]||v[V]&&v[V].hasOwnProperty(re.key))){N=-1;break}++N}for(const V in u.proxyCachedFBO[P.key])u.renderCache[u.proxyCachedFBO[P.key][V]].dirty=N<0||N!==Object.values(O).length}}const x=[...this._drapedRenderBatches];x.sort((S,P)=>P.end-P.start-(S.end-S.start));for(const S of x)for(const P of m){if(u.proxyCachedFBO[P.key])continue;let O=u.renderCachePool.pop();O===void 0&&u.renderCache.length<50&&(O=u.renderCache.length,u.renderCache.push(this._createFBO())),O!==void 0&&(u.proxyCachedFBO[P.key]={},u.proxyCachedFBO[P.key][S.start]=O,u.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(s,u,m,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,S=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let P;if(m.isTileClipped())P=u.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);P=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+P>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=P,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):br.disabled}_renderTileClippingMasks(s,u){const m=this.painter,v=this.painter.context,x=v.gl;m._tileClippingMaskIDs={},v.setColorMode($r.disabled),v.setDepthMode(Gt.disabled);const S=m.getOrCreateProgram("clippingMask");for(const P of s){const O=m._tileClippingMaskIDs[P.key]=--u;S.draw(m,x.TRIANGLES,Gt.disabled,new br({func:x.ALWAYS,mask:0},O,255,x.KEEP,x.KEEP,x.REPLACE),$r.disabled,dr.disabled,_u(P.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const u=this.painter.transform;if(s.x<0||s.x>u.width||s.y<0||s.y>u.height)return null;const m=[s.x,s.y,1,1];o.aA(m,m,u.pixelMatrixInverse),o.cw(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const v=u._camera.position,x=o.c6(1,u.center.lat),S=[v[0],v[1],v[2]/x,0],P=o.cX([],m.slice(0,3),S);o.au(P,P);const O=this.raycast(S,P,this._exaggeration);return O!==null&&O?(o.bE(S,S,P,O),S[3]=S[2],S[2]*=x,S):null}_setupProxiedCoordsForOrtho(s,u,m){if(s.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(s,u,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const v=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let O=0;O<x.length;O++){const L=x[O],N=this._findTileCoveringTileID(L,s);if(N){const V=this._createProxiedId(L,N,m[L.key]&&m[L.key][s.id]);v.push(V),this.proxyToSource[L.key][s.id]=[V]}}let S=!1;const P=new Set;for(let O=0;O<u.length;O++){const L=s.getTile(u[O]);if(!L||!L.hasData())continue;const N=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(N&&N.tileID.canonical.z!==L.tileID.canonical.z){const V=this.proxyToSource[N.tileID.key][s.id],$=this._createProxiedId(N.tileID,L,m[N.tileID.key]&&m[N.tileID.key][s.id]);V?V.splice(V.length-1,0,$):this.proxyToSource[N.tileID.key][s.id]=[$];const W=this.proxyToSource[N.tileID.key][s.id];P.has(W)||P.add(W),v.push($),S=!0}}if(this._sourceTilesOverlap[s.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const O of P)O.sort((L,N)=>N.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(s,u,m){if(!s.getSource().loaded())return;const v=this.proxiedCoords[s.id]=[],x=this.proxyCoords,S=s.getSource(),P=S.tileID;if(!P)return;const O=new o.P(P.x,P.y)._div(1<<P.z),L=S.coordinates.map(o.ac.fromLngLat).reduce((V,$)=>(V.min.x=Math.min(V.min.x,$.x-O.x),V.min.y=Math.min(V.min.y,$.y-O.y),V.max.x=Math.max(V.max.x,$.x-O.x),V.max.y=Math.max(V.max.y,$.y-O.y),V),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),N=(V,$)=>{const W=V.wrap+V.canonical.x/(1<<V.canonical.z),re=V.canonical.y/(1<<V.canonical.z),ee=o.aj/(1<<V.canonical.z),ie=$.wrap+$.canonical.x/(1<<$.canonical.z),ae=$.canonical.y/(1<<$.canonical.z);return W+ee<ie+L.min.x||W>ie+L.max.x||re+ee<ae+L.min.y||re>ae+L.max.y};for(let V=0;V<x.length;V++){const $=x[V];for(let W=0;W<u.length;W++){const re=s.getTile(u[W]);if(!re||!re.hasData()||N($,re.tileID))continue;const ee=this._createProxiedId($,re,m[$.key]&&m[$.key][s.id]),ie=this.proxyToSource[$.key][s.id];ie?ie.push(ee):this.proxyToSource[$.key][s.id]=[ee],v.push(ee)}}}_createProxiedId(s,u,m){let v=this.orthoMatrix;if(m){const x=m.find(S=>S.key===u.tileID.key);if(x)return x}if(u.tileID.key!==s.key){const x=s.canonical.z-u.tileID.canonical.z;let S,P,O;v=o.bz();const L=u.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(S=o.aj>>x,P=S*((u.tileID.canonical.x<<x)-s.canonical.x+L),O=S*((u.tileID.canonical.y<<x)-s.canonical.y)):(S=o.aj<<-x,P=o.aj*(u.tileID.canonical.x-(s.canonical.x+L<<-x)),O=o.aj*(u.tileID.canonical.y-(s.canonical.y<<-x))),o.c5(v,0,S,0,S,0,1),o.bo(v,v,[P,O,0])}return new Bm(u.tileID,s.key,v)}_findTileCoveringTileID(s,u){let m=u.getTile(s);if(m&&m.hasData())return m;const v=this._findCoveringTileCache[u.id],x=v[s.key];if(m=x?u.getTileByID(x):null,m&&m.hasData()||x===null)return m;let S=m?m.tileID:s,P=S.overscaledZ;const O=u.getSource().minzoom,L=[];if(!x){const V=u.getSource().maxzoom;if(s.canonical.z>=V){const $=s.canonical.z-V;u.getSource().reparseOverscaled?(P=Math.max(s.canonical.z+2,u.transform.tileZoom),S=new o.aM(P,s.wrap,V,s.canonical.x>>$,s.canonical.y>>$)):$!==0&&(P=V,S=new o.aM(P,s.wrap,V,s.canonical.x>>$,s.canonical.y>>$))}S.key!==s.key&&(L.push(S.key),m=u.getTile(S))}const N=V=>{L.forEach($=>{v[$]=V}),L.length=0};for(P-=1;P>=O&&(!m||!m.hasData());P--){m&&N(m.tileID.key);const V=S.calculateScaledKey(P);if(m=u.getTileByID(V),m&&m.hasData())break;const $=v[V];if($===null)break;$===void 0?L.push(V):m=u.getTileByID($)}return N(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,u){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[u.key]=!0}}function $m(p,s,u){const m=function(P,O,L){const N=o.bG(O,P),V=o.bG(L,[.2126,.7152,.0722]),$=(re,ee,ie)=>(1-ie)*re+ie*ee,W=$(1-.3*Math.min(V,1),1,Math.min(N+1,1));return $(.92,1,Math.asin(o.ay(O[2],-1,1))/Math.PI+.5)*W}(p,[0,0,1],s),v=[0,0,0];o.bY(v,u.slice(0,3),m);const x=[0,0,0];o.bY(x,s.slice(0,3),p[2]);const S=[0,0,0];return o.cV(S,v,x),o.cY(S)}const sv=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],av=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Um{static cacheKey(s,u,m,v){let x=`${u}${v?v.cacheKey:""}`;for(const S of m)s.usedDefines.includes(S)&&(x+=`/${S}`);return x}constructor(s,u,m,v,x,S){const P=s.gl;this.program=P.createProgram(),this.configuration=v,this.name=u,this.fixedDefines=[...S];const O=v?v.getBinderAttributes():[],L=(m.staticAttributes||[]).concat(O);let N=v?v.defines():[];N=N.concat(S.map(ie=>`#define ${ie}`));const V=`#version 300 es
`;let $=V+N.concat("precision mediump float;",Ja,Af.fragmentSource).join(`
`);for(const ie of m.fragmentIncludes)$+=`
${bh[ie]}`;$+=`
${m.fragmentSource}`;let W=V+N.concat("precision highp float;",Ja,Af.vertexSource).join(`
`);for(const ie of m.vertexIncludes)W+=`
${bh[ie]}`;this.forceManualRenderingForInstanceIDShaders=s.forceManualRenderingForInstanceIDShaders&&m.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(W+=`
uniform int u_instanceID;
`),W+=`
${m.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(W=W.replaceAll("gl_InstanceID","u_instanceID"));const re=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);P.shaderSource(re,$),P.compileShader(re),P.attachShader(this.program,re);const ee=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(ee,W),P.compileShader(ee),P.attachShader(this.program,ee),this.attributes={},this.numAttributes=L.length;for(let ie=0;ie<this.numAttributes;ie++)if(L[ie]){const ae=L[ie].startsWith("a_")?L[ie]:`a_${L[ie]}`;P.bindAttribLocation(this.program,ie,ae),this.attributes[ae]=ie}P.linkProgram(this.program),P.deleteShader(ee),P.deleteShader(re),this.fixedUniforms=x(s),this.binderUniforms=v?v.getUniforms(s):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ie=>({u_instanceID:new o.c8(ie)}))(s)),(S.includes("TERRAIN")||u.indexOf("symbol")!==-1||u.indexOf("circle")!==-1)&&(this.terrainUniforms=(ie=>({u_dem:new o.c8(ie),u_dem_prev:new o.c8(ie),u_dem_tl:new o.cb(ie),u_dem_scale:new o.ca(ie),u_dem_tl_prev:new o.cb(ie),u_dem_scale_prev:new o.ca(ie),u_dem_size:new o.ca(ie),u_dem_lerp:new o.ca(ie),u_exaggeration:new o.ca(ie),u_depth:new o.c8(ie),u_depth_size_inv:new o.cb(ie),u_depth_range_unpack:new o.cb(ie),u_occluder_half_size:new o.ca(ie),u_occlusion_depth_offset:new o.ca(ie),u_meter_to_dem:new o.ca(ie),u_label_plane_matrix_inv:new o.cc(ie)}))(s)),S.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new o.c9(ie),u_tile_tr_up:new o.c9(ie),u_tile_br_up:new o.c9(ie),u_tile_bl_up:new o.c9(ie),u_tile_up_scale:new o.ca(ie)}))(s)),S.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new o.cc(ie),u_fog_range:new o.cb(ie),u_fog_color:new o.cQ(ie),u_fog_horizon_blend:new o.ca(ie),u_fog_vertical_limit:new o.cb(ie),u_fog_temporal_offset:new o.ca(ie),u_frustum_tl:new o.c9(ie),u_frustum_tr:new o.c9(ie),u_frustum_br:new o.c9(ie),u_frustum_bl:new o.c9(ie),u_globe_pos:new o.c9(ie),u_globe_radius:new o.ca(ie),u_globe_transition:new o.ca(ie),u_is_globe:new o.c8(ie),u_viewport:new o.cb(ie)}))(s)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new o.cQ(ie)}))(s)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new o.c9(ie),u_lighting_directional_dir:new o.c9(ie),u_lighting_directional_color:new o.c9(ie),u_ground_radiance:new o.c9(ie)}))(s)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new o.cc(ie),u_light_matrix_1:new o.cc(ie),u_fade_range:new o.cb(ie),u_shadow_normal_offset:new o.c9(ie),u_shadow_intensity:new o.ca(ie),u_shadow_texel_size:new o.ca(ie),u_shadow_map_resolution:new o.ca(ie),u_shadow_direction:new o.c9(ie),u_shadow_bias:new o.c9(ie),u_shadowmap_0:new o.c8(ie),u_shadowmap_1:new o.c8(ie)}))(s))}}setTerrainUniformValues(s,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in u)m[v]&&m[v].set(this.program,v,u[v])}}setGlobeUniformValues(s,u){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in u)m[v]&&m[v].set(this.program,v,u[v])}}setFogUniformValues(s,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in u)m[v].set(this.program,v,u[v])}}setCutoffUniformValues(s,u){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in u)m[v].set(this.program,v,u[v])}}setLightsUniformValues(s,u){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const v in u)m[v].set(this.program,v,u[v])}}setShadowUniformValues(s,u){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;s.program.set(this.program);for(const v in u)m[v].set(this.program,v,u[v])}_drawDebugWireframe(s,u,m,v,x,S,P,O,L,N){const V=s.options.wireframe;if(V.terrain===!1&&V.layers2D===!1&&V.layers3D===!1)return;const $=s.context;if(!(!(!V.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!V.layers2D||s._terrain&&s._terrain.renderingToTexture||!sv.includes(this.name))||!(!V.layers3D||!av.includes(this.name))))return;const W=$.gl,re=s.wireframeDebugCache.getLinesFromTrianglesBuffer(s.frameCounter,x,$);if(!re)return;const ee=[...this.fixedDefines];ee.push("DEBUG_WIREFRAME");const ie=s.getOrCreateProgram(this.name,{config:this.configuration,defines:ee});$.program.set(ie.program);const ae=(be,Pe,Ae)=>{if(Pe[be]&&Ae[be])for(const Te in Pe[be])Ae[be][Te]&&Ae[be][Te].set(Ae.program,Te,Pe[be][Te].current)};L&&L.setUniforms(ie.program,$,ie.binderUniforms,P,{zoom:O}),ae("fixedUniforms",this,ie),ae("terrainUniforms",this,ie),ae("globeUniforms",this,ie),ae("fogUniforms",this,ie),ae("lightsUniforms",this,ie),ae("shadowUniforms",this,ie),re.bind(),$.setColorMode(new $r([W.ONE,W.ONE_MINUS_SRC_ALPHA,W.ZERO,W.ONE],o.am.transparent,[!0,!0,!0,!1])),$.setDepthMode(new Gt(u.func===W.LESS?W.LEQUAL:u.func,Gt.ReadOnly,u.range)),$.setStencilMode(br.disabled);const ce=3*S.primitiveLength*2,_e=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const be=N||1;for(let Pe=0;Pe<be;++Pe)ie.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Pe),W.drawElements(W.LINES,ce,W.UNSIGNED_SHORT,_e)}else N&&N>1?W.drawElementsInstanced(W.LINES,ce,W.UNSIGNED_SHORT,_e,N):W.drawElements(W.LINES,ce,W.UNSIGNED_SHORT,_e);x.bind(),$.program.set(this.program),$.setDepthMode(u),$.setStencilMode(m),$.setColorMode(v)}checkUniforms(s,u,m){if(this.fixedDefines.includes(u)){for(const v of Object.keys(m))if(!m[v].initialized)throw new Error(`Program '${this.name}', from draw '${s}': uniform ${v} not set but required by ${u} being defined`)}}draw(s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie){const ae=s.context,ce=ae.gl;if(this.failedToCreate)return;ae.program.set(this.program),ae.setDepthMode(m),ae.setStencilMode(v),ae.setColorMode(x),ae.setCullFace(S);for(const Pe of Object.keys(this.fixedUniforms))this.fixedUniforms[Pe].set(this.program,Pe,P[Pe]);re&&re.setUniforms(this.program,ae,this.binderUniforms,$,{zoom:W});const _e={[ce.POINTS]:1,[ce.LINES]:2,[ce.TRIANGLES]:3,[ce.LINE_STRIP]:1}[u];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const be=ie&&ie>0?1:void 0;for(const Pe of V.get()){const Ae=Pe.vaos||(Pe.vaos={});if((Ae[O]||(Ae[O]=new wh)).bind(ae,this,L,re?re.getPaintVertexBuffers():[],N,Pe.vertexOffset,ee||[],be),this.forceManualRenderingForInstanceIDShaders){const Te=ie||1;for(let we=0;we<Te;++we)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),N?ce.drawElements(u,Pe.primitiveLength*_e,ce.UNSIGNED_SHORT,Pe.primitiveOffset*_e*2):ce.drawArrays(u,Pe.vertexOffset,Pe.vertexLength)}else ie&&ie>1?ce.drawElementsInstanced(u,Pe.primitiveLength*_e,ce.UNSIGNED_SHORT,Pe.primitiveOffset*_e*2,ie):N?ce.drawElements(u,Pe.primitiveLength*_e,ce.UNSIGNED_SHORT,Pe.primitiveOffset*_e*2):ce.drawArrays(u,Pe.vertexOffset,Pe.vertexLength);u===ce.TRIANGLES&&N&&this._drawDebugWireframe(s,m,v,x,N,Pe,$,W,re,ie)}}}function If(p,s,u=0){const m=Math.pow(2,s.tileID.overscaledZ),v=s.tileSize*Math.pow(2,p.transform.tileZoom)/m,x=v*(s.tileID.canonical.x+s.tileID.wrap*m),S=v*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(s,1,p.transform.tileZoom),u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S],u_pattern_transition:u}}const Ah={terrain:0,flat:1},lv=o.bz(),Of=(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae)=>{const ce=s.style.light,_e=ce.properties.get("position"),be=[_e.x,_e.y,_e.z],Pe=o.dx();ce.properties.get("anchor")==="viewport"&&(o.dy(Pe,-s.transform.angle),o.dz(be,be,Pe));const Ae=ce.properties.get("color").toPremultipliedRenderColor(null),Te=s.transform,we={u_matrix:p,u_lightpos:be,u_lightintensity:ce.properties.get("intensity"),u_lightcolor:[Ae.r,Ae.g,Ae.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lv,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Ah[L],u_base_type:Ah[N],u_ao:v,u_edge_radius:x,u_width_scale:S,u_flood_light_color:re,u_vertical_scale:ee,u_flood_light_intensity:ie,u_ground_shadow_factor:ae};return Te.projection.name==="globe"&&(we.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],we.u_zoom_transition=V,we.u_inv_rot_matrix=W,we.u_merc_center=$,we.u_up_dir=Te.projection.upVector(new o.cp(0,0,0),$[0]*o.aj,$[1]*o.aj),we.u_height_lift=O),we},bb=(p,s,u,m,v,x)=>({u_matrix:p,u_edge_radius:s,u_width_scale:u,u_vertical_scale:m,u_height_type:Ah[v],u_base_type:Ah[x]}),wb=(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae)=>{const ce=Of(p,s,u,m,v,x,S,P,L,N,V,$,W,re,ee,ie,1,[0,0,0]),_e={u_height_factor:-Math.pow(2,P.overscaledZ)/O.tileSize/8};return o.h(ce,If(s,O,ae),_e)},vu=(p,s,u)=>({u_matrix:p,u_emissive_strength:s,u_ground_shadow_factor:u}),Sb=(p,s,u,m,v,x=0)=>o.h(vu(p,s,v),If(u,m,x)),KA=(p,s,u,m)=>({u_matrix:p,u_world:u,u_emissive_strength:s,u_ground_shadow_factor:m}),YA=(p,s,u,m,v,x,S=0)=>o.h(Sb(p,s,u,m,x,S),{u_world:v}),JA=(p,s)=>({u_matrix:p,u_ground_shadow_factor:s}),Vm=(p,s,u,m,v)=>({u_matrix:p,u_camera_pos:[s[0],s[1],s[2]],u_depth_bias:u,u_height_scale:m,u_reset_depth:v}),QA=(p,s,u,m)=>{const v=o.aj/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(m),u_extrude_scale:[s.pixelsToGLUnits[0]/v,s.pixelsToGLUnits[1]/v]}},Gm=(p,s,u=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:u}),cv=o.bz(),Tb=(p,s,u,m,v,x,S)=>{const P=p.transform,O=P.projection.name==="globe",L=O?o.dA(P.zoom,s.canonical)*P._pixelsPerMercatorPixel:o.aw(u,1,x),N={u_matrix:s.projMatrix,u_extrude_scale:L,u_intensity:S,u_inv_rot_matrix:cv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){N.u_inv_rot_matrix=m,N.u_merc_center=v,N.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],N.u_zoom_transition=o.ah(P.zoom);const V=v[0]*o.aj,$=v[1]*o.aj;N.u_up_dir=P.projection.upVector(new o.cp(0,0,0),V,$)}return N};function xu(p,[s,u,m,v],[x,S]){if(x===S)return[0,0,0,0];const P=255*(p-1)/(p*(S-x));return[s*P,u*P,m*P,v*P]}function uv(p,s,[u,m]){return u===m?0:.5/p+(s-u)*(p-1)/(p*(m-u))}const hv=(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae,ce,_e,be)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:u,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:L,u_fade_t:N.mix,u_opacity:N.opacity*V.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:V.paint.get("raster-brightness-min"),u_brightness_high:V.paint.get("raster-brightness-max"),u_saturation_factor:o.dC(V.paint.get("raster-saturation")),u_contrast_factor:o.dB(V.paint.get("raster-contrast")),u_spin_weights:Eb(V.paint.get("raster-hue-rotate")),u_perspective_transform:$,u_raster_elevation:W,u_zoom_transition:S,u_merc_center:P,u_cutoff_params:O,u_colorization_mix:xu(o.dD,ee,ae),u_colorization_offset:uv(o.dD,ie,ae),u_color_ramp:re,u_texture_offset:[_e/(ce+2*_e),ce/(ce+2*_e)],u_texture_res:[ce+2*_e,ce+2*_e],u_emissive_strength:be});function Eb(p){p*=Math.PI/180;const s=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const Sc=.05,bu=(p,s,u,m,v,x,S,P,O,L,N,V)=>({u_matrix:p,u_normalize_matrix:s,u_globe_matrix:u,u_merc_matrix:m,u_grid_matrix:v,u_tl_parent:x,u_scale_parent:L,u_fade_t:N.mix,u_opacity:N.opacity,u_image0:0,u_image1:1,u_raster_elevation:V,u_zoom_transition:S,u_merc_center:P,u_cutoff_params:O}),Ab=(p,s,u,m,v,x,S,P,O,L)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_tile_offset:u,u_velocity:m,u_color_ramp:x,u_velocity_res:v,u_max_speed:S,u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sc,Sc]}),Tc=(p,s,u,m,v,x,S,P,O,L)=>({u_particle_texture:p,u_particle_texture_side_len:s,u_velocity:u,u_velocity_res:m,u_max_speed:v,u_speed_factor:x,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:P,u_data_scale:[255*O[0],255*O[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Sc,Sc]}),Hm=o.bz(),Mf=(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae,ce,_e,be,Pe,Ae,Te)=>{const we=v.transform,Ce={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:we.getCameraToCenterDistance(ce),u_rotate_symbol:+u,u_aspect_ratio:we.width/we.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:P,u_is_text:+L,u_elevation_from_sea:O?1:0,u_pitch_with_map:+m,u_texsize:N,u_texsize_icon:V,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hm,u_up_vector:[0,-1,0],u_color_adj_mat:Pe,u_icon_transition:Ae||0,u_gamma_scale:m?v.transform.getCameraToCenterDistance(ce)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:_e,u_inv_matrix:o.bi(o.bz(),S),u_normal_scale:be};return ce.name==="globe"&&(Ce.u_tile_id=[W.canonical.x,W.canonical.y,1<<W.canonical.z],Ce.u_zoom_transition=re,Ce.u_inv_rot_matrix=ie,Ce.u_merc_center=ee,Ce.u_camera_forward=we._camera.forward(),Ce.u_ecef_origin=o.dE(we.globeMatrix,W.toUnwrapped()),Ce.u_tile_matrix=Float32Array.from(we.globeMatrix),Ce.u_up_vector=ae),Ce},dv=(p,s,u,m)=>({u_matrix:p,u_emissive_strength:s,u_opacity:u,u_color:m}),fv=(p,s,u,m,v,x,S,P,O)=>o.h(function(L,N,V,$,W,re){const{width:ee,height:ie}=$.imageManager.getPixelSize(N),ae=Math.pow(2,re.tileID.overscaledZ),ce=re.tileSize*Math.pow(2,$.transform.tileZoom)/ae,_e=ce*(re.tileID.canonical.x+re.tileID.wrap*ae),be=ce*re.tileID.canonical.y;return{u_image:0,u_pattern_tl:V.tl,u_pattern_br:V.br,u_texsize:[ee,ie],u_pattern_size:V.displaySize,u_pattern_units_to_pixels:W?[$.transform.width,-1*$.transform.height]:[1/o.aw(re,1,$.transform.tileZoom),1/o.aw(re,1,$.transform.tileZoom)],u_pixel_coord_upper:[_e>>16,be>>16],u_pixel_coord_lower:[65535&_e,65535&be]}}(0,x,S,m,P,O),{u_matrix:p,u_emissive_strength:s,u_opacity:u}),Rf=new Float32Array(o.bx([])),kf=(p,s,u,m,v,x,S,P,O,L,N,V,$,W=[0,0,0],re)=>{const ee=v.style.light,ie=ee.properties.get("position"),ae=[-ie.x,-ie.y,ie.z],ce=o.dx();ee.properties.get("anchor")==="viewport"&&(o.dy(ce,-v.transform.angle),o.dz(ae,ae,ce));const _e=N.alphaMode==="MASK",be=ee.properties.get("color").toNonPremultipliedRenderColor(null),Pe=$.paint.get("model-ambient-occlusion-intensity"),Ae=$.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return Ae.a=$.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:p,u_lighting_matrix:s,u_normal_matrix:u,u_node_matrix:m||Rf,u_lightpos:ae,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[be.r,be.g,be.b],u_camera_pos:W,u_opacity:x,u_baseTextureIsAlpha:0,u_alphaMask:+_e,u_alphaCutoff:N.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:P.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:L,u_baseColorTexture:Jo.BaseColor,u_metallicRoughnessTexture:Jo.MetallicRoughness,u_normalTexture:Jo.Normal,u_occlusionTexture:Jo.Occlusion,u_emissionTexture:Jo.Emission,u_lutTexture:Jo.LUT,u_color_mix:Ae.toArray01(),u_aoIntensity:Pe,u_emissive_strength:V,u_occlusionTextureTransform:re||[0,0,0,0]}},Pb=(p,s=Rf,u=Rf)=>({u_matrix:p,u_instance:s,u_node_matrix:u}),Cb={fillExtrusion:p=>({u_matrix:new o.cc(p),u_lightpos:new o.c9(p),u_lightintensity:new o.ca(p),u_lightcolor:new o.c9(p),u_vertical_gradient:new o.ca(p),u_opacity:new o.ca(p),u_edge_radius:new o.ca(p),u_width_scale:new o.ca(p),u_ao:new o.cb(p),u_height_type:new o.c8(p),u_base_type:new o.c8(p),u_tile_id:new o.c9(p),u_zoom_transition:new o.ca(p),u_inv_rot_matrix:new o.cc(p),u_merc_center:new o.cb(p),u_up_dir:new o.c9(p),u_height_lift:new o.ca(p),u_flood_light_color:new o.c9(p),u_vertical_scale:new o.ca(p),u_flood_light_intensity:new o.ca(p),u_ground_shadow_factor:new o.c9(p)}),fillExtrusionDepth:p=>({u_matrix:new o.cc(p),u_edge_radius:new o.ca(p),u_width_scale:new o.ca(p),u_vertical_scale:new o.ca(p),u_height_type:new o.c8(p),u_base_type:new o.c8(p)}),fillExtrusionPattern:p=>({u_matrix:new o.cc(p),u_lightpos:new o.c9(p),u_lightintensity:new o.ca(p),u_lightcolor:new o.c9(p),u_vertical_gradient:new o.ca(p),u_height_factor:new o.ca(p),u_edge_radius:new o.ca(p),u_width_scale:new o.ca(p),u_ao:new o.cb(p),u_height_type:new o.c8(p),u_base_type:new o.c8(p),u_tile_id:new o.c9(p),u_zoom_transition:new o.ca(p),u_inv_rot_matrix:new o.cc(p),u_merc_center:new o.cb(p),u_up_dir:new o.c9(p),u_height_lift:new o.ca(p),u_image:new o.c8(p),u_texsize:new o.cb(p),u_pixel_coord_upper:new o.cb(p),u_pixel_coord_lower:new o.cb(p),u_tile_units_to_pixels:new o.ca(p),u_opacity:new o.ca(p),u_pattern_transition:new o.ca(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new o.cc(p),u_opacity:new o.ca(p),u_ao_pass:new o.ca(p),u_meter_to_tile:new o.ca(p),u_ao:new o.cb(p),u_flood_light_intensity:new o.ca(p),u_flood_light_color:new o.c9(p),u_attenuation:new o.ca(p),u_edge_radius:new o.ca(p),u_fb:new o.c8(p),u_fb_size:new o.ca(p),u_dynamic_offset:new o.ca(p)}),fill:p=>({u_matrix:new o.cc(p),u_emissive_strength:new o.ca(p),u_ground_shadow_factor:new o.c9(p)}),fillPattern:p=>({u_matrix:new o.cc(p),u_emissive_strength:new o.ca(p),u_image:new o.c8(p),u_texsize:new o.cb(p),u_pixel_coord_upper:new o.cb(p),u_pixel_coord_lower:new o.cb(p),u_tile_units_to_pixels:new o.ca(p),u_ground_shadow_factor:new o.c9(p),u_pattern_transition:new o.ca(p)}),fillOutline:p=>({u_matrix:new o.cc(p),u_emissive_strength:new o.ca(p),u_world:new o.cb(p),u_ground_shadow_factor:new o.c9(p)}),fillOutlinePattern:p=>({u_matrix:new o.cc(p),u_emissive_strength:new o.ca(p),u_world:new o.cb(p),u_image:new o.c8(p),u_texsize:new o.cb(p),u_pixel_coord_upper:new o.cb(p),u_pixel_coord_lower:new o.cb(p),u_tile_units_to_pixels:new o.ca(p),u_ground_shadow_factor:new o.c9(p),u_pattern_transition:new o.ca(p)}),building:p=>({u_matrix:new o.cc(p),u_normal_matrix:new o.cc(p),u_opacity:new o.ca(p)}),buildingDepth:p=>({u_matrix:new o.cc(p)}),elevatedStructuresDepth:p=>({u_matrix:new o.cc(p),u_depth_bias:new o.ca(p)}),elevatedStructures:p=>({u_matrix:new o.cc(p),u_ground_shadow_factor:new o.c9(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new o.cc(p),u_camera_pos:new o.c9(p),u_depth_bias:new o.ca(p),u_height_scale:new o.ca(p),u_reset_depth:new o.ca(p)}),circle:o.dH,collisionBox:p=>({u_matrix:new o.cc(p),u_camera_to_center_distance:new o.ca(p),u_extrude_scale:new o.cb(p)}),collisionCircle:p=>({u_matrix:new o.cc(p),u_inv_matrix:new o.cc(p),u_camera_to_center_distance:new o.ca(p),u_viewport_size:new o.cb(p)}),debug:p=>({u_color:new o.di(p),u_matrix:new o.cc(p),u_overlay:new o.c8(p),u_overlay_scale:new o.ca(p)}),clippingMask:p=>({u_matrix:new o.cc(p)}),heatmap:p=>({u_extrude_scale:new o.ca(p),u_intensity:new o.ca(p),u_matrix:new o.cc(p),u_inv_rot_matrix:new o.cc(p),u_merc_center:new o.cb(p),u_tile_id:new o.c9(p),u_zoom_transition:new o.ca(p),u_up_dir:new o.c9(p)}),heatmapTexture:p=>({u_image:new o.c8(p),u_color_ramp:new o.c8(p),u_opacity:new o.ca(p)}),hillshade:p=>({u_matrix:new o.cc(p),u_image:new o.c8(p),u_latrange:new o.cb(p),u_light:new o.cb(p),u_shadow:new o.di(p),u_highlight:new o.di(p),u_emissive_strength:new o.ca(p),u_accent:new o.di(p)}),hillshadePrepare:p=>({u_matrix:new o.cc(p),u_image:new o.c8(p),u_dimension:new o.cb(p),u_zoom:new o.ca(p)}),line:o.dG,linePattern:o.dF,raster:p=>({u_matrix:new o.cc(p),u_normalize_matrix:new o.cc(p),u_globe_matrix:new o.cc(p),u_merc_matrix:new o.cc(p),u_grid_matrix:new o.dj(p),u_tl_parent:new o.cb(p),u_scale_parent:new o.ca(p),u_fade_t:new o.ca(p),u_opacity:new o.ca(p),u_image0:new o.c8(p),u_image1:new o.c8(p),u_brightness_low:new o.ca(p),u_brightness_high:new o.ca(p),u_saturation_factor:new o.ca(p),u_contrast_factor:new o.ca(p),u_spin_weights:new o.c9(p),u_perspective_transform:new o.cb(p),u_raster_elevation:new o.ca(p),u_zoom_transition:new o.ca(p),u_merc_center:new o.cb(p),u_cutoff_params:new o.cQ(p),u_colorization_mix:new o.cQ(p),u_colorization_offset:new o.ca(p),u_color_ramp:new o.c8(p),u_texture_offset:new o.cb(p),u_texture_res:new o.cb(p),u_emissive_strength:new o.ca(p)}),rasterParticle:p=>({u_matrix:new o.cc(p),u_normalize_matrix:new o.cc(p),u_globe_matrix:new o.cc(p),u_merc_matrix:new o.cc(p),u_grid_matrix:new o.dj(p),u_tl_parent:new o.cb(p),u_scale_parent:new o.ca(p),u_fade_t:new o.ca(p),u_opacity:new o.ca(p),u_image0:new o.c8(p),u_image1:new o.c8(p),u_raster_elevation:new o.ca(p),u_zoom_transition:new o.ca(p),u_merc_center:new o.cb(p),u_cutoff_params:new o.cQ(p)}),rasterParticleTexture:p=>({u_texture:new o.c8(p),u_opacity:new o.ca(p)}),rasterParticleDraw:p=>({u_particle_texture:new o.c8(p),u_particle_texture_side_len:new o.ca(p),u_tile_offset:new o.cb(p),u_velocity:new o.c8(p),u_color_ramp:new o.c8(p),u_velocity_res:new o.cb(p),u_max_speed:new o.ca(p),u_uv_offset:new o.cb(p),u_data_scale:new o.cb(p),u_data_offset:new o.ca(p),u_particle_pos_scale:new o.ca(p),u_particle_pos_offset:new o.cb(p)}),rasterParticleUpdate:p=>({u_particle_texture:new o.c8(p),u_particle_texture_side_len:new o.ca(p),u_velocity:new o.c8(p),u_velocity_res:new o.cb(p),u_max_speed:new o.ca(p),u_speed_factor:new o.ca(p),u_reset_rate:new o.ca(p),u_rand_seed:new o.ca(p),u_uv_offset:new o.cb(p),u_data_scale:new o.cb(p),u_data_offset:new o.ca(p),u_particle_pos_scale:new o.ca(p),u_particle_pos_offset:new o.cb(p)}),symbol:p=>({u_is_size_zoom_constant:new o.c8(p),u_is_size_feature_constant:new o.c8(p),u_size_t:new o.ca(p),u_size:new o.ca(p),u_camera_to_center_distance:new o.ca(p),u_rotate_symbol:new o.c8(p),u_aspect_ratio:new o.ca(p),u_fade_change:new o.ca(p),u_matrix:new o.cc(p),u_label_plane_matrix:new o.cc(p),u_coord_matrix:new o.cc(p),u_is_text:new o.c8(p),u_elevation_from_sea:new o.c8(p),u_pitch_with_map:new o.c8(p),u_texsize:new o.cb(p),u_texsize_icon:new o.cb(p),u_texture:new o.c8(p),u_texture_icon:new o.c8(p),u_gamma_scale:new o.ca(p),u_device_pixel_ratio:new o.ca(p),u_tile_id:new o.c9(p),u_zoom_transition:new o.ca(p),u_inv_rot_matrix:new o.cc(p),u_merc_center:new o.cb(p),u_camera_forward:new o.c9(p),u_tile_matrix:new o.cc(p),u_up_vector:new o.c9(p),u_ecef_origin:new o.c9(p),u_is_halo:new o.c8(p),u_icon_transition:new o.ca(p),u_color_adj_mat:new o.cc(p),u_scale_factor:new o.ca(p),u_ground_shadow_factor:new o.c9(p),u_inv_matrix:new o.cc(p),u_normal_scale:new o.ca(p)}),background:p=>({u_matrix:new o.cc(p),u_emissive_strength:new o.ca(p),u_opacity:new o.ca(p),u_color:new o.di(p)}),backgroundPattern:p=>({u_matrix:new o.cc(p),u_emissive_strength:new o.ca(p),u_opacity:new o.ca(p),u_image:new o.c8(p),u_pattern_tl:new o.cb(p),u_pattern_br:new o.cb(p),u_texsize:new o.cb(p),u_pattern_size:new o.cb(p),u_pixel_coord_upper:new o.cb(p),u_pixel_coord_lower:new o.cb(p),u_pattern_units_to_pixels:new o.cb(p)}),terrainRaster:p=>({u_matrix:new o.cc(p),u_image0:new o.c8(p),u_skirt_height:new o.ca(p),u_ground_shadow_factor:new o.c9(p)}),skybox:p=>({u_matrix:new o.cc(p),u_sun_direction:new o.c9(p),u_cubemap:new o.c8(p),u_opacity:new o.ca(p),u_temporal_offset:new o.ca(p)}),skyboxGradient:p=>({u_matrix:new o.cc(p),u_color_ramp:new o.c8(p),u_center_direction:new o.c9(p),u_radius:new o.ca(p),u_opacity:new o.ca(p),u_temporal_offset:new o.ca(p)}),skyboxCapture:p=>({u_matrix_3f:new o.dj(p),u_sun_direction:new o.c9(p),u_sun_intensity:new o.ca(p),u_color_tint_r:new o.cQ(p),u_color_tint_m:new o.cQ(p),u_luminance:new o.ca(p)}),globeRaster:p=>({u_proj_matrix:new o.cc(p),u_globe_matrix:new o.cc(p),u_normalize_matrix:new o.cc(p),u_merc_matrix:new o.cc(p),u_zoom_transition:new o.ca(p),u_merc_center:new o.cb(p),u_image0:new o.c8(p),u_grid_matrix:new o.dj(p),u_skirt_height:new o.ca(p),u_far_z_cutoff:new o.ca(p),u_frustum_tl:new o.c9(p),u_frustum_tr:new o.c9(p),u_frustum_br:new o.c9(p),u_frustum_bl:new o.c9(p),u_globe_pos:new o.c9(p),u_globe_radius:new o.ca(p),u_viewport:new o.cb(p)}),globeAtmosphere:p=>({u_frustum_tl:new o.c9(p),u_frustum_tr:new o.c9(p),u_frustum_br:new o.c9(p),u_frustum_bl:new o.c9(p),u_horizon:new o.ca(p),u_transition:new o.ca(p),u_fadeout_range:new o.ca(p),u_color:new o.cQ(p),u_high_color:new o.cQ(p),u_space_color:new o.cQ(p),u_temporal_offset:new o.ca(p),u_horizon_angle:new o.ca(p)}),model:p=>({u_matrix:new o.cc(p),u_lighting_matrix:new o.cc(p),u_normal_matrix:new o.cc(p),u_node_matrix:new o.cc(p),u_lightpos:new o.c9(p),u_lightintensity:new o.ca(p),u_lightcolor:new o.c9(p),u_camera_pos:new o.c9(p),u_opacity:new o.ca(p),u_baseColorFactor:new o.cQ(p),u_emissiveFactor:new o.cQ(p),u_metallicFactor:new o.ca(p),u_roughnessFactor:new o.ca(p),u_baseTextureIsAlpha:new o.c8(p),u_alphaMask:new o.c8(p),u_alphaCutoff:new o.ca(p),u_baseColorTexture:new o.c8(p),u_metallicRoughnessTexture:new o.c8(p),u_normalTexture:new o.c8(p),u_occlusionTexture:new o.c8(p),u_emissionTexture:new o.c8(p),u_lutTexture:new o.c8(p),u_color_mix:new o.cQ(p),u_aoIntensity:new o.ca(p),u_emissive_strength:new o.ca(p),u_occlusionTextureTransform:new o.cQ(p)}),modelDepth:p=>({u_matrix:new o.cc(p),u_instance:new o.cc(p),u_node_matrix:new o.cc(p)}),groundShadow:p=>({u_matrix:new o.cc(p),u_ground_shadow_factor:new o.c9(p)}),stars:p=>({u_matrix:new o.cc(p),u_up:new o.c9(p),u_right:new o.c9(p),u_intensity_multiplier:new o.ca(p)}),snowParticle:p=>({u_modelview:new o.cc(p),u_projection:new o.cc(p),u_time:new o.ca(p),u_cam_pos:new o.c9(p),u_velocityConeAperture:new o.ca(p),u_velocity:new o.ca(p),u_horizontalOscillationRadius:new o.ca(p),u_horizontalOscillationRate:new o.ca(p),u_boxSize:new o.ca(p),u_billboardSize:new o.ca(p),u_simpleShapeParameters:new o.cb(p),u_screenSize:new o.cb(p),u_thinningCenterPos:new o.cb(p),u_thinningShape:new o.c9(p),u_thinningAffectedRatio:new o.ca(p),u_thinningParticleOffset:new o.ca(p),u_particleColor:new o.cQ(p),u_direction:new o.c9(p)}),rainParticle:p=>({u_modelview:new o.cc(p),u_projection:new o.cc(p),u_time:new o.ca(p),u_cam_pos:new o.c9(p),u_texScreen:new o.c8(p),u_velocityConeAperture:new o.ca(p),u_velocity:new o.ca(p),u_boxSize:new o.ca(p),u_rainDropletSize:new o.cb(p),u_distortionStrength:new o.ca(p),u_rainDirection:new o.c9(p),u_color:new o.cQ(p),u_screenSize:new o.cb(p),u_thinningCenterPos:new o.cb(p),u_thinningShape:new o.c9(p),u_thinningAffectedRatio:new o.ca(p),u_thinningParticleOffset:new o.ca(p),u_shapeDirectionalPower:new o.ca(p),u_shapeNormalPower:new o.ca(p),u_mode:new o.ca(p)}),vignette:p=>({u_vignetteShape:new o.c9(p),u_vignetteColor:new o.cQ(p)}),occlusion:p=>({u_matrix:new o.cc(p),u_anchorPos:new o.c9(p),u_screenSizePx:new o.cb(p),u_occluderSizePx:new o.cb(p),u_color:new o.cQ(p)})};class la{constructor(s,u,m,v){this.id=la.uniqueIdxCounter,la.uniqueIdxCounter++,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||v||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){this.id=la.uniqueIdxCounter,la.uniqueIdxCounter++;const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}la.uniqueIdxCounter=0;const eP={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class tP{constructor(s,u,m,v,x,S){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.instanceCount=S,this.context=s;const P=s.gl;this.buffer=P.createBuffer(),s.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||x||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let m=0;m<this.attributes.length;m++){const v=u.attributes[this.attributes[m].name];v!==void 0&&s.enableVertexAttribArray(v)}}setVertexAttribPointers(s,u,m){for(let v=0;v<this.attributes.length;v++){const x=this.attributes[v],S=u.attributes[x.name];S!==void 0&&s.vertexAttribPointer(S,x.components,s[eP[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(s,u,m){for(let v=0;v<this.attributes.length;v++){const x=u.attributes[this.attributes[v].name];x!==void 0&&this.instanceCount&&this.instanceCount>0&&s.vertexAttribDivisor(x,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pv{constructor(s,u,m,v,x){this.context=s,this.width=u,this.height=m;const S=this.framebuffer=s.gl.createFramebuffer();v&&(this.colorAttachment=new yb(s,S)),x&&(this.depthAttachmentType=x,this.depthAttachment=x==="renderbuffer"?new vb(s,S):new qA(s,S))}destroy(){const s=this.context.gl;if(this.colorAttachment){const u=this.colorAttachment.get();u&&s.deleteTexture(u)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const u=this.depthAttachment.get();u&&s.deleteRenderbuffer(u)}else{const u=this.depthAttachment.get();u&&s.deleteTexture(u)}s.deleteFramebuffer(this.framebuffer)}}class rP{constructor(s,u){this.gl=s,this.clearColor=new ub(this),this.clearDepth=new Jy(this),this.clearStencil=new $A(this),this.colorMask=new UA(this),this.depthMask=new VA(this),this.stencilMask=new GA(this),this.stencilFunc=new hb(this),this.stencilOp=new HA(this),this.stencilTest=new Mm(this),this.depthRange=new WA(this),this.depthTest=new db(this),this.depthFunc=new Qy(this),this.blend=new Rm(this),this.blendFunc=new ev(this),this.blendColor=new gu(this),this.blendEquation=new Sh(this),this.cullFace=new km(this),this.cullFaceSide=new Dm(this),this.frontFace=new Th(this),this.program=new fb(this),this.activeTexture=new tv(this),this.viewport=new pb(this),this.bindFramebuffer=new Eh(this),this.bindRenderbuffer=new Lm(this),this.bindTexture=new zm(this),this.bindVertexBuffer=new rv(this),this.bindElementBuffer=new Nm(this),this.bindVertexArrayOES=new Pf(this),this.pixelStoreUnpack=new mb(this),this.pixelStoreUnpackPremultiplyAlpha=new gb(this),this.pixelStoreUnpackFlipY=new _b(this),this.options=u?Object.assign({},u):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=u&&!!u.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=s.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),this.maxPointSize=s.getParameter(s.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u,m){return new la(this,s,u,m)}createVertexBuffer(s,u,m,v,x){return new tP(this,s,u,m,v,x)}createRenderbuffer(s,u,m){const v=this.gl,x=v.createRenderbuffer();return this.bindRenderbuffer.set(x),v.renderbufferStorage(v.RENDERBUFFER,s,u,m),this.bindRenderbuffer.set(null),x}createFramebuffer(s,u,m,v){return new pv(this,s,u,m,v)}clear({color:s,depth:u,stencil:m,colorMask:v}){const x=this.gl;let S=0;s&&(S|=x.COLOR_BUFFER_BIT,this.clearColor.set(s.toNonPremultipliedRenderColor(null)),this.colorMask.set(v||[!0,!0,!0,!0])),u!==void 0&&(S|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m!==void 0&&(S|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(S)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.bv(s.blendFunction,$r.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor),s.blendEquation?this.blendEquation.set(s.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(s.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ph;function Wm(p,s,u,m,v,x,S){const P=p.context,O=P.gl,L=p.transform,N=p.getOrCreateProgram("collisionBox"),V=[];let $=0,W=0;for(let be=0;be<m.length;be++){const Pe=m[be],Ae=s.getTile(Pe),Te=Ae.getBucket(u);if(!Te)continue;const we=pr(Pe,Te,L);let Ce=we;v[0]===0&&v[1]===0||(Ce=p.translatePosMatrix(we,Ae,v,x));const Oe=S?Te.textCollisionBox:Te.iconCollisionBox,Ve=Te.collisionCircleArray;if(Ve.length>0){const Ge=o.bz(),at=Ce;o.cB(Ge,Te.placementInvProjMatrix,L.glCoordMatrix),o.cB(Ge,Ge,Te.placementViewportMatrix),V.push({circleArray:Ve,circleOffset:W,transform:at,invTransform:Ge,projection:Te.getProjection()}),$+=Ve.length/4,W=$}Oe&&(p.terrain&&p.terrain.setupElevationDraw(Ae,N),N.draw(p,O.LINES,Gt.disabled,br.disabled,p.colorModeForRenderPass(),dr.disabled,QA(Ce,L,Ae,Te.getProjection()),u.id,Oe.layoutVertexBuffer,Oe.indexBuffer,Oe.segments,null,L.zoom,null,[Oe.collisionVertexBuffer,Oe.collisionVertexBufferExt]))}if(!S||!V.length)return;const re=p.getOrCreateProgram("collisionCircle"),ee=new o.dI;ee.resize(4*$),ee._trim();let ie=0;for(const be of V)for(let Pe=0;Pe<be.circleArray.length/4;Pe++){const Ae=4*Pe,Te=be.circleArray[Ae+0],we=be.circleArray[Ae+1],Ce=be.circleArray[Ae+2],Oe=be.circleArray[Ae+3];ee.emplace(ie++,Te,we,Ce,Oe,0),ee.emplace(ie++,Te,we,Ce,Oe,1),ee.emplace(ie++,Te,we,Ce,Oe,2),ee.emplace(ie++,Te,we,Ce,Oe,3)}(!Ph||Ph.length<2*$)&&(Ph=function(be){const Pe=2*be,Ae=new o.a_;Ae.resize(Pe),Ae._trim();for(let Te=0;Te<Pe;Te++){const we=6*Te;Ae.uint16[we+0]=4*Te+0,Ae.uint16[we+1]=4*Te+1,Ae.uint16[we+2]=4*Te+2,Ae.uint16[we+3]=4*Te+2,Ae.uint16[we+4]=4*Te+3,Ae.uint16[we+5]=4*Te+0}return Ae}($));const ae=P.createIndexBuffer(Ph,!0),ce=P.createVertexBuffer(ee,o.dJ.members,!0);for(const be of V){const Pe={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(_e=L).getCameraToCenterDistance(be.projection),u_viewport_size:[_e.width,_e.height]};re.draw(p,O.TRIANGLES,Gt.disabled,br.disabled,p.colorModeForRenderPass(),dr.disabled,Pe,u.id,ce,ae,o.bd.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,L.zoom)}var _e;ce.destroy(),ae.destroy()}const Rl=o.bz();function Df(p){const s=p._camera.getWorldToCamera(p.worldSize,1),u=o.az([],s,p.globeMatrix);o.bi(u,u);const m=[0,0,0],v=[0,1,0,0];return o.aA(v,v,u),m[0]=v[0],m[1]=v[1],m[2]=v[2],o.au(m,m),m}function Lf({width:p,height:s,anchor:u,textOffset:m,textScale:v},x){const{horizontalAlign:S,verticalAlign:P}=o.bT(u),O=-(S-.5)*p,L=-(P-.5)*s,N=o.bU(u,m);return new o.P((O/v+N[0])*x,(L/v+N[1])*x)}function Ib(p,s,u,m,v,x,S,P,O,L){const N=p.text.placedSymbolArray,V=p.text.dynamicLayoutVertexArray,$=p.icon.dynamicLayoutVertexArray,W={},re=p.getProjection(),ee=bm(S,re,v),ie=v.elevation,ae=re.upVectorScale(S.canonical,v.center.lat,v.worldSize).metersToTile;V.clear();for(let ce=0;ce<N.length;ce++){const _e=N.get(ce),{tileAnchorX:be,tileAnchorY:Pe,numGlyphs:Ae}=_e,Te=_e.hidden||!_e.crossTileID||p.allowVerticalPlacement&&!_e.placedOrientation?null:m[_e.crossTileID];if(Te){let we=0,Ce=0,Oe=0;if(ie){const ht=ie?ie.getAtTileOffset(S,be,Pe):0,[Ye,gt,Ot]=re.upVector(S.canonical,be,Pe);we=ht*Ye*ae,Ce=ht*gt*ae,Oe=ht*Ot*ae}let[Ve,Ge,at,lt]=Ea(_e.projectedAnchorX+we,_e.projectedAnchorY+Ce,_e.projectedAnchorZ+Oe,u?ee:x);const yt=mf(v.getCameraToCenterDistance(re),lt);let Fe=o.bJ(p.textSizeData,O,_e)*yt/o.bO;u&&(Fe*=p.tilePixelRatio/P);const tt=Lf(Te,Fe);u?({x:Ve,y:Ge,z:at}=re.projectTilePoint(be+tt.x,Pe+tt.y,S.canonical),[Ve,Ge,at]=Ea(Ve+we,Ge+Ce,at+Oe,x)):(s&&tt._rotate(-v.angle),Ve+=tt.x,Ge+=tt.y,at=0);const Le=p.allowVerticalPlacement&&_e.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let ht=0;ht<Ae;ht++)o.bL(V,Ve,Ge,at,Le);L&&_e.associatedIconIndex>=0&&(W[_e.associatedIconIndex]={x:Ve,y:Ge,z:at,angle:Le})}else hu(Ae,V)}if(L){$.clear();const ce=p.icon.placedSymbolArray;for(let _e=0;_e<ce.length;_e++){const be=ce.get(_e),{numGlyphs:Pe}=be,Ae=W[_e];if(be.hidden||!Ae)hu(Pe,$);else{const{x:Te,y:we,z:Ce,angle:Oe}=Ae;for(let Ve=0;Ve<Pe;Ve++)o.bL($,Te,we,Ce,Oe)}}p.icon.dynamicLayoutVertexBuffer.updateData($)}p.text.dynamicLayoutVertexBuffer.updateData(V)}function Ch(p,s,u,m,v,x,S={}){const P=u.paint.get("icon-translate"),O=u.paint.get("text-translate"),L=u.paint.get("icon-translate-anchor"),N=u.paint.get("text-translate-anchor"),V=u.layout.get("icon-rotation-alignment"),$=u.layout.get("text-rotation-alignment"),W=u.layout.get("icon-pitch-alignment"),re=u.layout.get("text-pitch-alignment"),ee=u.layout.get("icon-keep-upright"),ie=u.layout.get("text-keep-upright"),ae=u.paint.get("icon-color-saturation"),ce=u.paint.get("icon-color-contrast"),_e=u.paint.get("icon-color-brightness-min"),be=u.paint.get("icon-color-brightness-max"),Pe=u.layout.get("symbol-elevation-reference")==="sea",Ae=p.context,Te=Ae.gl,we=p.transform,Ce=V==="map",Oe=$==="map",Ve=W==="map",Ge=re==="map",at=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let lt=!1;const yt=p.depthModeForSublayer(0,Gt.ReadOnly),Fe=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),tt=[o.aD(we.center.lng),o.aH(we.center.lat)],Le=u.layout.get("text-variable-anchor"),ht=we.projection.name==="globe",Ye=[],gt=[0,-1,0];for(const Ot of m){const ut=s.getTile(Ot),Ct=ut.getBucket(u);if(!Ct||Ct.projection.name==="mercator"&&ht||Ct.fullyClipped)continue;const Wt=Ct.projection.name==="globe",qt=Wt?o.ah(we.zoom):0,Vt=bm(Ot,Ct.getProjection(),we),tr=we.calculatePixelsToTileUnitsMatrix(ut),ir=Le&&Ct.hasTextData(),ar=Ct.hasIconTextFit()&&ir&&Ct.hasIconData(),yr=Ct.getProjection().createInversionMatrix(we,Ot.canonical),kr=(1<<ut.tileID.canonical.z)*o.aj/p.transform.worldSize,pn=Fn=>{let an=[0,0,0];if(Fn){const fi=p.style.directionalLight,Jr=p.style.ambientLight;fi&&Jr&&(an=pu(p.style,fi,Jr))}return an},jn=Fn=>{we.depthOcclusionForSymbolsAndCircles&&(u.hasInitialOcclusionOpacityProperties||p.terrain)&&(Fn.push("DEPTH_D24"),Fn.push("DEPTH_OCCLUSION"))},yn=()=>{const Fn=Ce&&u.layout.get("symbol-placement")!=="point",an=[];jn(an);const fi=Fn||ar,Jr=Ct.elevationType==="road"&&Ve,Di=p.shadowRenderer,qn=Jr&&!!Di&&Di.enabled,Mn=pn(qn),Zn=Jr?Fe:yt,cn=u.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Ve&&an.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(an.push("PROJECTION_GLOBE_VIEW"),fi&&an.push("PROJECTED_POS_ON_VIEWPORT")),cn>0&&an.push("ICON_TRANSITION"),Ct.icon.zOffsetVertexBuffer&&an.push("Z_OFFSET"),ae===0&&ce===0&&_e===0&&be===1||an.push("COLOR_ADJUSTMENT"),Ct.sdfIcons&&an.push("RENDER_SDF"),qn&&an.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Jr&&Ct.icon.orientationVertexBuffer&&an.push("ELEVATED_ROADS");const gi=Ct.icon.programConfigurations.get(u.id),Eo=p.getOrCreateProgram("symbol",{config:gi,defines:an}),ei=ut.imageAtlasTexture?ut.imageAtlasTexture.size:[0,0],on=Ct.iconSizeData,Ts=o.bH(on,we.zoom),ds=Ve||!we.isOrthographic,Gs=Cl(Vt,ut.tileID.canonical,Ve,Ce,we,Ct.getProjection(),tr),Ia=ym(Vt,ut.tileID.canonical,Ve,Ce,we,Ct.getProjection(),tr),ua=p.translatePosMatrix(Ia,ut,P,L,!0),fs=p.translatePosMatrix(Vt,ut,P,L),kc=fi?Rl:Gs,Oa=Ce&&!Ve&&!Fn;let Dc=gt;!ht&&!we.mercatorFromTransition||Ce||(Dc=Df(we));const Jf=Wt?Dc:gt,jv=u.getColorAdjustmentMatrix(ae,ce,_e,be),Uh=Mf(on.kind,Ts,Oa,Ve,p,fs,kc,ua,Pe,!1,ei,[0,0],0,Ot,qt,tt,yr,Jf,Ct.getProjection(),Mn,kr,jv,cn,null),Fv=ut.imageAtlasTexture?ut.imageAtlasTexture:null,Qf=u.layout.get("icon-size").constantOr(0)!==1||Ct.iconsNeedLinear,hg=Ct.sdfIcons||p.options.rotating||p.options.zooming||Qf||ds?Te.LINEAR:Te.NEAREST,dg=Ct.sdfIcons&&u.paint.get("icon-halo-width").constantOr(1)!==0,rl=p.terrain&&Ve&&Fn?o.bi(o.bz(),Gs):Rl;if(Fn&&Ct.icon){const Vh=we.elevation,Pu=Vh?Vh.getAtTileOffsetFunc(Ot,we.center.lat,we.worldSize,Ct.getProjection()):null,Lc=_m(Vt,ut.tileID.canonical,Ve,Ce,we,Ct.getProjection(),tr);vm(Ct,Vt,p,!1,Lc,Ia,Ve,ee,Pu,Ot)}return{program:Eo,buffers:Ct.icon,uniformValues:Uh,atlasTexture:Fv,atlasTextureIcon:null,atlasInterpolation:hg,atlasInterpolationIcon:null,isSDF:Ct.sdfIcons,hasHalo:dg,depthMode:Zn,tile:ut,renderWithShadows:qn,labelPlaneMatrixInv:rl}},bn=()=>{const Fn=Oe&&u.layout.get("symbol-placement")!=="point",an=[],fi=Fn||Le||ar,Jr=Ct.elevationType==="road"&&Ge,Di=p.shadowRenderer,qn=Jr&&!!Di&&Di.enabled,Mn=pn(qn),Zn=Jr?Fe:yt;p.terrainRenderModeElevated()&&Ge&&an.push("PITCH_WITH_MAP_TERRAIN"),Wt&&(an.push("PROJECTION_GLOBE_VIEW"),fi&&an.push("PROJECTED_POS_ON_VIEWPORT")),Ct.text.zOffsetVertexBuffer&&an.push("Z_OFFSET"),Ct.iconsInText&&an.push("RENDER_TEXT_AND_SYMBOL"),an.push("RENDER_SDF"),qn&&an.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Jr&&Ct.text.orientationVertexBuffer&&an.push("ELEVATED_ROADS"),jn(an);const cn=Ct.text.programConfigurations.get(u.id),gi=p.getOrCreateProgram("symbol",{config:cn,defines:an});let Eo,ei=[0,0],on=null;const Ts=Ct.textSizeData;Ct.iconsInText&&(ei=ut.imageAtlasTexture?ut.imageAtlasTexture.size:[0,0],on=ut.imageAtlasTexture?ut.imageAtlasTexture:null,Eo=Ge||!we.isOrthographic||p.options.rotating||p.options.zooming||Ts.kind==="composite"||Ts.kind==="camera"?Te.LINEAR:Te.NEAREST);const ds=ut.glyphAtlasTexture?ut.glyphAtlasTexture.size:[0,0],Gs=u.layout.get("text-size-scale-range"),Ia=o.ay(p.scaleFactor,Gs[0],Gs[1]),ua=o.bH(Ts,we.zoom,Ia),fs=Cl(Vt,ut.tileID.canonical,Ge,Oe,we,Ct.getProjection(),tr),kc=ym(Vt,ut.tileID.canonical,Ge,Oe,we,Ct.getProjection(),tr),Oa=p.translatePosMatrix(kc,ut,O,N,!0),Dc=p.translatePosMatrix(Vt,ut,O,N),Jf=fi?Rl:fs,jv=Oe&&!Ge&&!Fn;let Uh=gt;!ht&&!we.mercatorFromTransition||Oe||(Uh=Df(we));const Fv=Mf(Ts.kind,ua,jv,Ge,p,Dc,Jf,Oa,Pe,!0,ds,ei,0,Ot,qt,tt,yr,Wt?Uh:gt,Ct.getProjection(),Mn,kr,null,null,Ia),Qf=ut.glyphAtlasTexture?ut.glyphAtlasTexture:null,hg=Te.LINEAR,dg=u.paint.get("text-halo-width").constantOr(1)!==0,rl=p.terrain&&Ge&&Fn?o.bi(o.bz(),fs):Rl;if(Fn&&Ct.text){const Vh=we.elevation,Pu=Vh?Vh.getAtTileOffsetFunc(Ot,we.center.lat,we.worldSize,Ct.getProjection()):null,Lc=_m(Vt,ut.tileID.canonical,Ge,Oe,we,Ct.getProjection(),tr);vm(Ct,Vt,p,!0,Lc,kc,Ge,ie,Pu,Ot)}return{program:gi,buffers:Ct.text,uniformValues:Fv,atlasTexture:Qf,atlasTextureIcon:on,atlasInterpolation:hg,atlasInterpolationIcon:Eo,isSDF:!0,hasHalo:dg,depthMode:Zn,tile:ut,renderWithShadows:qn,labelPlaneMatrixInv:rl}},xi=Ct.icon.segments.get().length,Cr=Ct.text.segments.get().length,zr=xi&&!S.onlyText?yn():null,Hr=Cr&&!S.onlyIcons?bn():null,Wn=u.paint.get("icon-opacity").constantOr(1),$i=u.paint.get("text-opacity").constantOr(1);if(at&&Ct.canOverlap){lt=!0;const Fn=Wn&&!S.onlyText?Ct.icon.segments.get():[],an=$i&&!S.onlyIcons?Ct.text.segments.get():[];for(const fi of Fn)Ye.push({segments:new o.bd([fi]),sortKey:fi.sortKey,state:zr});for(const fi of an)Ye.push({segments:new o.bd([fi]),sortKey:fi.sortKey,state:Hr})}else S.onlyText||Ye.push({segments:Wn?Ct.icon.segments:new o.bd([]),sortKey:0,state:zr}),S.onlyIcons||Ye.push({segments:$i?Ct.text.segments:new o.bd([]),sortKey:0,state:Hr})}lt&&Ye.sort((Ot,ut)=>Ot.sortKey-ut.sortKey);for(const Ot of Ye){const ut=Ot.state;if(ut)if(p.terrain?p.terrain.setupElevationDraw(ut.tile,ut.program,{useDepthForOcclusion:we.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ut.labelPlaneMatrixInv}):p.setupDepthForOcclusion(we.depthOcclusionForSymbolsAndCircles,ut.program),Ae.activeTexture.set(Te.TEXTURE0),ut.atlasTexture&&ut.atlasTexture.bind(ut.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),ut.atlasTextureIcon&&(Ae.activeTexture.set(Te.TEXTURE1),ut.atlasTextureIcon&&ut.atlasTextureIcon.bind(ut.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),ut.renderWithShadows&&p.shadowRenderer.setupShadows(ut.tile.tileID.toUnwrapped(),ut.program,"vector-tile",ut.tile.tileID.overscaledZ),p.uploadCommonLightUniforms(p.context,ut.program),ut.hasHalo){const Ct=ut.uniformValues;Ct.u_is_halo=1,Ih(ut.buffers,Ot.segments,u,p,ut.program,ut.depthMode,v,x,Ct,2),Ct.u_is_halo=0}else{if(ut.isSDF){const Ct=ut.uniformValues;ut.hasHalo&&(Ct.u_is_halo=1,Ih(ut.buffers,Ot.segments,u,p,ut.program,ut.depthMode,v,x,Ct,1)),Ct.u_is_halo=0}Ih(ut.buffers,Ot.segments,u,p,ut.program,ut.depthMode,v,x,ut.uniformValues,1)}}}function Ih(p,s,u,m,v,x,S,P,O,L){const N=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];v.draw(m,m.context.gl.TRIANGLES,x,S,P,dr.disabled,O,u.id,p.layoutVertexBuffer,p.indexBuffer,s,u.paint,m.transform.zoom,p.programConfigurations.get(u.id),N,L)}function qm(p,s){const u=1<<p.canonical.z,m=(s.x*u-p.canonical.x-p.wrap*u)*o.aj,v=(s.y*u-p.canonical.y)*o.aj,x=o.dS(s.z,s.y);return o.cS(m,v,x)}function mv(p,s,u,m,v){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const x=p.context.gl,S=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),P=new Gt(p.context.gl.GREATER,Gt.ReadWrite,p.depthRangeFor3D),O=function(W){const re=o.cJ(W.pitch);let ee=.01;return W.isOrthographic&&(ee=o.ai(1e-4,ee,o.cN(re>=mo?1:re/mo))),2*ee}(p.transform),L=p.transform.getFreeCameraOptions().position,N="elevatedStructuresDepthReconstruct",V=p.getOrCreateProgram(N,{defines:["DEPTH_RECONSTRUCTION"]}),$=p.getOrCreateProgram(N);for(const W of m){const re=s.getTile(W),ee=re.getBucket(u);if(!ee)continue;const ie=ee.elevatedStructures;if(!ie)continue;const ae=ee.elevationBufferData.heightRange,ce=qm(W.toUnwrapped(),L),_e=p.translatePosMatrix(W.projMatrix,re,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));let be,Pe,Ae,Te;if(v==="initialize"){if(!ae||ae.min>=1||ie.depthSegments.segments[0].primitiveLength===0)continue;be=Vm(_e,ce,O,1,0),Pe=S,Ae=ie.depthSegments,Te=V}else if(v==="reset"){if(!ae||ae.min>=0||ie.maskSegments.segments[0].primitiveLength===0)continue;be=Vm(_e,ce,0,0,1),Pe=P,Ae=ie.maskSegments,Te=V}else if(v==="geometry"){if(ie.depthSegments.segments[0].primitiveLength===0)continue;be=Vm(_e,ce,O,1,0),Pe=S,Ae=ie.depthSegments,Te=$}Te.draw(p,x.TRIANGLES,Pe,br.disabled,$r.disabled,dr.disabled,be,u.id,ie.vertexBuffer,ie.indexBuffer,Ae,u.paint,p.transform.zoom)}}function gv(p,s,u){const{painter:m,sourceCache:v,layer:x,coords:S,colorMode:P,elevationType:O,terrainEnabled:L,pass:N}=p,V=m.context.gl,$=x.paint.get("fill-pattern"),W=x.paint.get("fill-pattern-cross-fade"),re=$.constantOr(null);let ee=O;O!=="road"||s&&!L||(ee="none");const ie=ee==="road",ae=p.painter.shadowRenderer,ce=ie&&!!ae&&ae.enabled,_e=new Gt(m.context.gl.LEQUAL,Gt.ReadOnly,m.depthRangeFor3D);let be=[0,0,0];if(ce){const Te=m.style.directionalLight,we=m.style.ambientLight;Te&&we&&(be=pu(m.style,Te,we))}const Pe=$&&$.constantOr(1),Ae=(Te,we)=>{let Ce,Oe,Ve,Ge,at;we?(Ce=Pe&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ve=V.LINES):(Ce=Pe?"fillPattern":"fill",Ve=V.TRIANGLES);for(const lt of S){const yt=v.getTile(lt);if(Pe&&!yt.patternsLoaded())continue;const Fe=yt.getBucket(x);if(!Fe)continue;const tt=s?Fe.elevationBufferData:Fe.bufferData;if(tt.isEmpty())continue;m.prepareDrawTile();const Le=tt.programConfigurations.get(x.id),ht=m.isTileAffectedByFog(lt),Ye=[],gt=[];ie&&(Ye.push("ELEVATED_ROADS"),gt.push(tt.elevatedLayoutVertexBuffer)),ce&&Ye.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Pe&&(m.context.activeTexture.set(V.TEXTURE0),yt.imageAtlasTexture&&yt.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),Le.updatePaintBuffers());let Ot=!1;if(re&&yt.imageAtlas){const Vt=yt.imageAtlas,tr=o.dN.from(re),ir=tr.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),ar=tr.getSecondary(),yr=Vt.patternPositions.get(ir),kr=ar?Vt.patternPositions.get(ar.scaleSelf(o.q.devicePixelRatio).toString()):null;Ot=!!yr&&!!kr,yr&&Le.setConstantPatternPositions(yr,kr)}W>0&&(Ot||Le.getPatternTransitionVertexBuffer("fill-pattern"))&&Ye.push("FILL_PATTERN_TRANSITION");const ut=m.getOrCreateProgram(Ce,{config:Le,overrideFog:ht,defines:Ye}),Ct=m.translatePosMatrix(lt.projMatrix,yt,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));ce&&ae.setupShadows(yt.tileID.toUnwrapped(),ut,"vector-tile",yt.tileID.overscaledZ);const Wt=x.paint.get("fill-emissive-strength");if(we){Ge=tt.lineIndexBuffer,at=tt.lineSegments;const Vt=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];Oe=Ce==="fillOutlinePattern"&&Pe?YA(Ct,Wt,m,yt,Vt,be,W):KA(Ct,Wt,Vt,be)}else Ge=tt.indexBuffer,at=tt.triangleSegments,Oe=Pe?Sb(Ct,Wt,m,yt,be,W):vu(Ct,Wt,be);m.uploadCommonUniforms(m.context,ut,lt.toUnwrapped());let qt=Te;(O==="road"&&!L||O==="offset")&&(qt=_e),ut.draw(m,Ve,qt,u||m.stencilModeForClipping(lt),P,dr.disabled,Oe,x.id,tt.layoutVertexBuffer,Ge,at,x.paint,m.transform.zoom,Le,gt)}};m.renderPass===N&&Ae(m.depthModeForSublayer(1,m.renderPass==="opaque"?Gt.ReadWrite:Gt.ReadOnly),!1),ee==="none"&&m.renderPass==="translucent"&&x.paint.get("fill-antialias")&&Ae(m.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Gt.ReadOnly),!0)}function kl(p,s,u,m,v,x,S,P){u.resetLayerRenderingStats(p);const O=p.context,L=O.gl,N=p.transform,V=u.paint.get("fill-extrusion-pattern"),$=u.paint.get("fill-extrusion-pattern-cross-fade"),W=V.constantOr(null),re=V.constantOr(1),ee=u.paint.get("fill-extrusion-opacity"),ie=p.style.enable3dLights(),ae=u.paint.get(ie&&!re?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ce=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ae],_e=u.layout.get("fill-extrusion-edge-radius"),be=_e>0&&!u.paint.get("fill-extrusion-rounded-roof"),Pe=be?0:_e,Ae=N.projection.name==="globe"?o.dV():0,Te=N.projection.name==="globe",we=Te?o.ah(N.zoom):0,Ce=[o.aD(N.center.lng),o.aH(N.center.lat)],Oe=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ve=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Oe?null:u.lut).toArray01().slice(0,3),Ge=u.paint.get("fill-extrusion-flood-light-intensity"),at=u.paint.get("fill-extrusion-vertical-scale"),lt=u.paint.get("fill-extrusion-line-width").constantOr(1)!==0,yt=u.paint.get("fill-extrusion-height-alignment"),Fe=u.paint.get("fill-extrusion-base-alignment"),tt=Ya(p,u.paint.get("fill-extrusion-cutoff-fade-range")),Le=[];let ht;Te&&Le.push("PROJECTION_GLOBE_VIEW"),ce[0]>0&&Le.push("FAUX_AO"),be&&Le.push("ZERO_ROOF_RADIUS"),P&&Le.push("HAS_CENTROID"),Ge>0&&Le.push("FLOOD_LIGHT"),tt.shouldRenderCutoff&&Le.push("RENDER_CUTOFF"),lt&&Le.push("RENDER_WALL_MODE");const Ye=p.renderPass==="shadow",gt=p.shadowRenderer,Ot=Ye&&!!gt,ut=Ye?dr.disabled:dr.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Ct=[0,0,0];if(gt){const Vt=p.style.directionalLight,tr=p.style.ambientLight;Vt&&tr&&(Ct=pu(p.style,Vt,tr)),Ye||(Le.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gt.useNormalOffset&&Le.push("NORMAL_OFFSET")),ht=Le.concat(["SHADOWS_SINGLE_CASCADE"])}const Wt=Ot?"fillExtrusionDepth":re?"fillExtrusionPattern":"fillExtrusion",qt=u.getLayerRenderingStats();for(const Vt of m){const tr=s.getTile(Vt),ir=tr.getBucket(u);if(!ir||ir.projection.name!==N.projection.name)continue;let ar=!1;gt&&(ar=gt.getMaxCascadeForTile(Vt.toUnwrapped())===0);const yr=p.isTileAffectedByFog(Vt),kr=ir.programConfigurations.get(u.id);let pn=!1;if(W&&tr.imageAtlas){const Hr=tr.imageAtlas,Wn=o.dN.from(W),$i=Wn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Fn=Wn.getSecondary(),an=Hr.patternPositions.get($i),fi=Fn?Hr.patternPositions.get(Fn.scaleSelf(o.q.devicePixelRatio).toString()):null;pn=!!an&&!!fi,an&&kr.setConstantPatternPositions(an,fi)}$>0&&(pn||kr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Le.push("FILL_EXTRUSION_PATTERN_TRANSITION");const jn=p.getOrCreateProgram(Wt,{config:kr,defines:ar?ht:Le,overrideFog:yr});if(p.terrain&&p.terrain.setupElevationDraw(tr,jn,{useMeterToDem:!0}),!ir.centroidVertexBuffer){const Hr=jn.attributes.a_centroid_pos;Hr!==void 0&&L.vertexAttrib2f(Hr,0,0)}!Ye&&gt&&gt.setupShadows(tr.tileID.toUnwrapped(),jn,"vector-tile",tr.tileID.overscaledZ),re&&(p.context.activeTexture.set(L.TEXTURE0),tr.imageAtlasTexture&&tr.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),kr.updatePaintBuffers());const yn=u.paint.get("fill-extrusion-vertical-gradient"),bn=1/ir.tileToMeter;let xi;if(Ye&&gt){if(Ac(tr.tileID,ir,p))continue;const Hr=gt.calculateShadowPassMatrixFromTile(tr.tileID.toUnwrapped());xi=bb(Hr,Pe,bn,at,yt,Fe)}else{const Hr=p.translatePosMatrix(Vt.expandedProjMatrix,tr,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Wn=N.projection.createInversionMatrix(N,Vt.canonical);xi=re?wb(Hr,p,yn,ee,ce,Pe,bn,Vt,tr,Ae,yt,Fe,we,Ce,Wn,Ve,at,$):Of(Hr,p,yn,ee,ce,Pe,bn,Vt,Ae,yt,Fe,we,Ce,Wn,Ve,at,Ge,Ct)}p.uploadCommonUniforms(O,jn,Vt.toUnwrapped(),null,tt);let Cr=ir.segments;if(N.projection.name==="mercator"&&!Ye&&(Cr=ir.getVisibleSegments(tr.tileID,p.terrain,p.transform.getFrustum(0)),!Cr.get().length))continue;if(qt)if(Ye)for(const Hr of Cr.get())qt.numRenderedVerticesInShadowPass+=Hr.primitiveLength;else for(const Hr of Cr.get())qt.numRenderedVerticesInTransparentPass+=Hr.primitiveLength;const zr=[];(p.terrain||P)&&zr.push(ir.centroidVertexBuffer),Te&&zr.push(ir.layoutVertexExtBuffer),lt&&zr.push(ir.wallVertexBuffer),jn.draw(p,O.gl.TRIANGLES,v,x,S,ut,xi,u.id,ir.layoutVertexBuffer,ir.indexBuffer,Cr,u.paint,p.transform.zoom,kr,zr)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function Dl(p,s,u,m,v,x,S,P,O,L,N,V,$,W,re,ee,ie,ae,ce){const _e=p.context,be=_e.gl,Pe=p.transform,Ae=p.transform.zoom,Te=[],we=Ya(p,u.paint.get("fill-extrusion-cutoff-fade-range"));L==="clear"?(Te.push("CLEAR_SUBPASS"),ce&&(Te.push("CLEAR_FROM_TEXTURE"),_e.activeTexture.set(be.TEXTURE0),ce.bind(be.LINEAR,be.CLAMP_TO_EDGE))):L==="sdf"&&Te.push("SDF_SUBPASS"),ie&&Te.push("HAS_CENTROID"),we.shouldRenderCutoff&&Te.push("RENDER_CUTOFF");const Ce=u.layout.get("fill-extrusion-edge-radius"),Oe=(Ve,Ge,at,lt,yt)=>{const Fe=Ge.programConfigurations.get(u.id),tt=p.isTileAffectedByFog(Ve),Le=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Fe,defines:Te,overrideFog:tt}),ht=((gt,Ot,ut,Ct,Wt,qt,Vt,tr,ir,ar,yr)=>({u_matrix:Ot,u_opacity:ut,u_ao_pass:Ct?1:0,u_meter_to_tile:Wt,u_ao:qt,u_flood_light_intensity:Vt,u_flood_light_color:tr,u_attenuation:ir,u_edge_radius:ar,u_fb:0,u_fb_size:yr,u_dynamic_offset:1}))(0,lt,N,O,yt,[V,$*yt],W,re,ee,Ae>=17?0:Ce*yt,ce?ce.size[0]:0),Ye=[];ie&&Ye.push(Ge.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(_e,Le,Ve.toUnwrapped(),null,we),Le.draw(p,_e.gl.TRIANGLES,v,x,S,P,ht,u.id,Ge.vertexBuffer,Ge.indexBuffer,at,u.paint,Ae,Fe,Ye)};for(const Ve of m){const Ge=s.getTile(Ve),at=Ge.getBucket(u);if(!at||at.projection.name!==Pe.projection.name||!at.groundEffect||at.groundEffect&&!at.groundEffect.hasData())continue;const lt=at.groundEffect,yt=1/at.tileToMeter;{const Fe=p.translatePosMatrix(Ve.projMatrix,Ge,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),tt=lt.getDefaultSegment();Oe(Ve,lt,tt,Fe,yt)}if(ae)for(let Fe=0;Fe<4;Fe++){const tt=o.dT[Fe](Ve),Le=s.getTile(tt);if(!Le)continue;const ht=Le.getBucket(u);if(!ht||ht.projection.name!==Pe.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const Ye=ht.groundEffect;let gt,Ot;Fe===0?(gt=[-8192,0,0],Ot=1):Fe===1?(gt=[o.aj,0,0],Ot=0):Fe===2?(gt=[0,-8192,0],Ot=3):(gt=[0,o.aj,0],Ot=2);const ut=Ye.regionSegments[Ot];if(!ut)continue;const Ct=new Float32Array(16);o.bo(Ct,Ve.projMatrix,gt),Oe(Ve,Ye,ut,p.translatePosMatrix(Ct,Ge,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),yt)}}}function Ht(p,s,u,m,v,x,S){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const P=x?x.findDEMTileFor(u):null;if(!(P&&P.dem||S))return;x&&P&&P.dem&&m.selfDEMTileTimestamp!==P.dem._timestamp&&(m.borderDoneWithNeighborZ=[-1,-1,-1,-1],m.selfDEMTileTimestamp=P.dem._timestamp);const O=ae=>new o.P(Math.ceil((ae+o.dX)*o.dY),0),L=ae=>{const ce=s.getSource().minzoom,_e=Pe=>{const Ae=s.getTileByID(Pe);if(Ae&&Ae.hasData())return Ae.getBucket(v)},be=[0,-1,1];for(const Pe of be){if(ae.overscaledZ+Pe<ce)continue;const Ae=_e(ae.calculateScaledKey(ae.overscaledZ+Pe));if(Ae)return Ae}},N=[0,0,0],V=(ae,ce)=>(N[0]=Math.min(ae.min.y,ce.min.y),N[1]=Math.max(ae.max.y,ce.max.y),N[2]=o.aj-ce.min.x>ae.max.x?ce.min.x-o.aj:ae.max.x,N),$=(ae,ce)=>(N[0]=Math.min(ae.min.x,ce.min.x),N[1]=Math.max(ae.max.x,ce.max.x),N[2]=o.aj-ce.min.y>ae.max.y?ce.min.y-o.aj:ae.max.y,N),W=[(ae,ce)=>V(ae,ce),(ae,ce)=>V(ce,ae),(ae,ce)=>$(ae,ce),(ae,ce)=>$(ce,ae)],re=(ae,ce,_e,be,Pe,Ae,Te)=>{if(!x)return 0;const we=[[Ae?_e:ae,Ae?ae:_e,0],[Ae?_e:ce,Ae?ce:_e,0]],Ce=Te<0?o.aj+Te:Te,Oe=[Ae?Ce:(ae+ce)/2,Ae?(ae+ce)/2:Ce,0];return _e===0&&Te<0||_e!==0&&Te>0?x.getForTilePoints(Pe,[Oe],!0,be):we.push(Oe),x.getForTilePoints(u,we,!0,P),Math.max(we[0][2],we[1][2],Oe[2])/x.exaggeration()};for(let ae=0;ae<4;ae++){const ce=m.borderFeatureIndices[ae];if(ce.length===0)continue;const _e=o.dT[ae](u),be=L(_e);if(!(be&&be instanceof o.dU))continue;const Pe=x?x.findDEMTileFor(_e):null;if(!(Pe&&Pe.dem||S)||(x&&Pe&&Pe.dem&&m.borderDEMTileTimestamp[ae]!==Pe.dem._timestamp&&(m.borderDoneWithNeighborZ[ae]=-1,m.borderDEMTileTimestamp[ae]=Pe.dem._timestamp),m.borderDoneWithNeighborZ[ae]===be.canonical.z))continue;be.centroidVertexArray.length===0&&be.createCentroidsBuffer();const Ae=(ae<2?1:5)-ae,Te=be.borderDoneWithNeighborZ[Ae]!==m.canonical.z,we=be.borderFeatureIndices[Ae];let Ce=0;if(m.canonical.z!==be.canonical.z){for(const Oe of ce)m.showCentroid(m.featuresOnBorder[Oe]);if(Te)for(const Oe of we)be.showCentroid(be.featuresOnBorder[Oe]);m.borderDoneWithNeighborZ[ae]=be.canonical.z,be.borderDoneWithNeighborZ[Ae]=m.canonical.z}for(const Oe of ce){const Ve=m.featuresOnBorder[Oe],Ge=m.centroidData[Ve.centroidDataIndex],at=Ve.borders[ae];let lt;for(;Ce<we.length;){lt=be.featuresOnBorder[we[Ce]];const yt=lt.borders[Ae];if(yt[1]>at[0]+3||yt[0]>at[0]-3)break;be.showCentroid(lt),Ce++}if(lt&&Ce<we.length){const yt=Ce;let Fe=0;for(;!(lt.borders[Ae][0]>at[1]-3)&&(Fe++,++Ce!==we.length);)lt=be.featuresOnBorder[we[Ce]];lt=be.featuresOnBorder[we[yt]];let tt=!1;if(Fe>=1){const Ye=lt.borders[Ae];Math.abs(at[0]-Ye[0])<3&&Math.abs(at[1]-Ye[1])<3&&(Fe=1,tt=!0,Ce=yt+1)}else if(Fe===0){m.showCentroid(Ve);continue}const Le=be.centroidData[lt.centroidDataIndex];S&&tt&&(((ee=Ge).flags|(ie=Le).flags)&o.dW?(ee.flags|=o.dW,ie.flags|=o.dW):(ee.flags&=2147483647,ie.flags&=2147483647));const ht=Ve.intersectsCount()>1||lt.intersectsCount()>1;if(Fe>1)Ce=yt,Ge.centroidXY=Le.centroidXY=new o.P(0,0);else if(Pe&&Pe.dem&&!ht){const Ye=W[ae](Ge,Le),gt=ae%2?o.aj-1:0,Ot=re(Ye[0],Math.min(o.aj-1,Ye[1]),gt,Pe,_e,ae<2,Ye[2]);Ge.centroidXY=Le.centroidXY=O(Ot)}else ht?Ge.centroidXY=Le.centroidXY=new o.P(0,0):(Ge.centroidXY=m.encodeBorderCentroid(Ve),Le.centroidXY=be.encodeBorderCentroid(lt));m.writeCentroidToBuffer(Ge),be.writeCentroidToBuffer(Le)}else m.showCentroid(Ve)}m.borderDoneWithNeighborZ[ae]=be.canonical.z,be.borderDoneWithNeighborZ[Ae]=m.canonical.z}var ee,ie;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const Ob=[1,0,0],Mb=[0,1,0],Ec=[0,0,1];function Ac(p,s,u){const m=u.transform,v=u.shadowRenderer;if(!v)return!0;const x=p.toUnwrapped(),S=m.tileSize*v._cascades[u.currentShadowCascade].scale;let P=s.maxHeight;if(m.elevation){const ee=m.elevation.getMinMaxForTile(p);ee&&(P+=ee.max)}const O=[...v.shadowDirection];O[2]=-O[2];const L=v.computeSimplifiedTileShadowVolume(x,P,S,O);if(!L)return!1;const N=[Ob,Mb,Ec,O,[O[0],0,O[2]],[0,O[1],O[2]]],V=m.projection.name==="globe",$=m.scaleZoom(S),W=o.cn.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,$,!V),re=v.getCurrentCascadeFrustum();return W.intersectsPrecise(L.vertices,L.planes,N)===0||re.intersectsPrecise(L.vertices,L.planes,N)===0}function cr(p){return[p[0]*o.dZ,p[1]*o.dZ,p[2]*o.dZ,0]}function zf(p,s,u,m,v,x,S,P,O){const L=m.getSource(),N=u.globeSharedBuffers;if(!N)return;let V,$,W;if(s&&(V=m.getTile(s)),L instanceof o.aP?($=L.texture,W=o.ds(0,0,u.transform)):V&&s&&($=V.texture,W=o.ds(s.canonical.z,s.canonical.x,u.transform)),!$||!W)return;p||(W=o.cE(o.bz(),W,[1,-1,1]));const re=u.context,ee=re.gl,ie=v.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR,ae=u.colorModeForDrapableLayerRenderPass(x),ce=S.defines;ce.push("GLOBE_POLES");const _e=new Gt(ee.LEQUAL,Gt.ReadWrite,u.depthRangeFor3D),be=Float32Array.from(u.transform.expandedFarZProjMatrix),Pe=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0))));u.terrain&&u.terrain.prepareDrawTile(),re.activeTexture.set(ee.TEXTURE0),$.bind(ie,ee.CLAMP_TO_EDGE),re.activeTexture.set(ee.TEXTURE1),$.bind(ie,ee.CLAMP_TO_EDGE),"useMipmap"in $&&re.extTextureFilterAnisotropic&&u.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,re.extTextureFilterAnisotropicMax);const[Ae,Te,we,Ce]=s?N.getPoleBuffers(s.canonical.z,!1):N.getPoleBuffers(0,!0),Oe=v.paint.get("raster-elevation");let Ve;p?(Ve=Ae,u.renderDefaultNorthPole=Oe!==0):(Ve=Te,u.renderDefaultSouthPole=Oe!==0);const Ge=cr(S.mix),at=((yt,Fe,tt,Le,ht,Ye,gt,Ot,ut,Ct,Wt,qt,Vt)=>hv(yt,Fe,tt,new Float32Array(16),new Float32Array(9),[0,0],Le,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ye,[0,0],Ot,2,Ct,Wt,qt,1,0,Vt))(be,Pe,W,o.ah(u.transform.zoom),0,v,0,Oe,0,Ge,S.offset,S.range,x),lt=u.getOrCreateProgram("raster",{defines:ce});u.uploadCommonUniforms(re,lt,null),lt.draw(u,ee.TRIANGLES,_e,O,ae,P,at,v.id,Ve,we,Ce)}function nP(p){const s=p._nearZ,u=p.projection.farthestPixelDistance(p),m=u-s,v=.2*p.height,x=s+v;return[s,u,(x-v-s)/m,(x-s)/m]}function iP(p,s,u,m){if(p)return s instanceof gc&&p instanceof lh?s.getTextureDescriptor(p,u,!0):{texture:p.texture,mix:cr(m.mix),offset:m.offset,buffer:0,tileSize:1}}var _v=o.d_([{name:"a_index",type:"Int16",components:1}]);class Rb{constructor(s,u,m,v){const x={width:m[0],height:m[1],data:null},S=s.gl;this.targetColorTexture=new o.T(s,x,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(s,x,S.RGBA8,{useMipmap:!1}),this.context=s,this.updateParticleTexture(u,v),this.lastInvalidatedAt=0}updateParticleTexture(s,u){if(this.particleTextureDimension===u.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,v=u.width*u.height;this.particleTexture0=new o.T(this.context,u,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,u,m.RGBA8,{premultiply:!1,useMipmap:!1});const x=new o.d$;x.reserve(v);for(let S=0;S<v;S++)x.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(x,_v.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=u.width}update(s){return!(this.lastInvalidatedAt<s&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function oP(p,s,u){if(!p)return null;const m=s.getTextureDescriptor(p,u,!0);if(!m)return null;let{texture:v,mix:x,offset:S,tileSize:P,buffer:O,format:L}=m;if(!v||!L)return null;let N=!1;return L==="uint32"&&(N=!0,x[3]=0,x=xu(o.e0,x,[0,u.paint.get("raster-particle-max-speed")]),S=uv(o.e0,S,[0,u.paint.get("raster-particle-max-speed")])),{texture:v,textureOffset:[O/(P+2*O),P/(P+2*O)],tileSize:P,scalarData:N,scale:x,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function kb(p){const s=p._nearZ,u=p.projection.farthestPixelDistance(p),m=u-s,v=.2*p.height,x=s+v;return[s,u,(x-v-s)/m,(x-s)/m]}const sP=new o.am(1,0,0,1),aP=new o.am(0,1,0,1),Ss=new o.am(0,0,1,1),yv=new o.am(1,0,1,1),Qo=new o.am(0,1,1,1);function Ll(p,s,u,m,v,x){for(let S=0;S<u.length;S++)if(v){const L=new o.am(m.r*.8,m.g*.8,m.b*.8,1);wu(p,s,u[S],m,-1,-1,x),wu(p,s,u[S],m,-1,1,x),wu(p,s,u[S],m,1,1,x),wu(p,s,u[S],m,1,-1,x),wu(p,s,u[S],L,0,0,x)}else wu(p,s,u[S],m,0,0,x)}function wu(p,s,u,m,v,x,S){const P=p.context,O=p.transform,L=P.gl,N=O.projection.name==="globe",V=N?["PROJECTION_GLOBE_VIEW"]:[];let $=o.bw(u.projMatrix);if(N&&o.ah(O.zoom)>0){const Ge=o.bg(u.canonical,O),at=o.e1(Ge);$=o.az(new Float32Array(16),O.globeMatrix,at),o.az($,O.projMatrix,$)}const W=o.bz();W[12]+=2*v/(o.q.devicePixelRatio*O.width),W[13]+=2*x/(o.q.devicePixelRatio*O.height),o.az($,W,$);const re=p.getOrCreateProgram("debug",{defines:V}),ee=s.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(ee,re);const ie=Gt.disabled,ae=br.disabled,ce=p.colorModeForRenderPass(),_e="$debug";P.activeTexture.set(L.TEXTURE0),p.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),N?ee._makeGlobeTileDebugBuffers(p.context,O):ee._makeDebugTileBoundsBuffers(p.context,O.projection);const be=ee._tileDebugBuffer||p.debugBuffer,Pe=ee._tileDebugIndexBuffer||p.debugIndexBuffer,Ae=ee._tileDebugSegments||p.debugSegments;if(re.draw(p,L.LINE_STRIP,ie,ae,ce,dr.disabled,Gm($,m.toPremultipliedRenderColor(null)),_e,be,Pe,Ae,null,null,null,[ee._globeTileDebugBorderBuffer]),S){const Ge=ee.latestRawTileData,at=Math.floor((Ge&&Ge.byteLength||0)/1024);let lt=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(lt+=` => ${u.overscaledZ}`),lt+=` ${ee.state}`,lt+=` ${at}kb`,function(yt,Fe){yt.initDebugOverlayCanvas();const tt=yt.debugOverlayCanvas,Le=yt.context.gl,ht=yt.debugOverlayCanvas.getContext("2d");ht.clearRect(0,0,tt.width,tt.height),ht.shadowColor="white",ht.shadowBlur=2,ht.lineWidth=1.5,ht.strokeStyle="white",ht.textBaseline="top",ht.font="bold 36px Open Sans, sans-serif",ht.fillText(Fe,5,5),ht.strokeText(Fe,5,5),yt.debugOverlayTexture.update(tt),yt.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(p,lt)}const Te=s.getTile(u).tileSize,we=512/Math.min(Te,512)*(u.overscaledZ/O.zoom)*.5,Ce=ee._tileDebugTextBuffer||p.debugBuffer,Oe=ee._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ve=ee._tileDebugTextSegments||p.debugSegments;re.draw(p,L.TRIANGLES,ie,ae,$r.alphaBlended,dr.disabled,Gm($,o.am.transparent.toPremultipliedRenderColor(null),we),_e,Ce,Oe,Ve,null,null,null,[ee._globeTileDebugTextBuffer])}function Zm(p,s,u,m){Oh(p,0,s+u/2,p.transform.width,u,m)}function Xm(p,s,u,m){Oh(p,s-u/2,0,u,p.transform.height,m)}function Oh(p,s,u,m,v,x){const S=p.context,P=S.gl;P.enable(P.SCISSOR_TEST),P.scissor(s*o.q.devicePixelRatio,u*o.q.devicePixelRatio,m*o.q.devicePixelRatio,v*o.q.devicePixelRatio),S.clear({color:x}),P.disable(P.SCISSOR_TEST)}const Db=o.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:zl}=Db;function Tn(p,s,u,m){p.emplaceBack(s,u,m)}class Nf{constructor(s){this.vertexArray=new o.e2,this.indices=new o.a_,Tn(this.vertexArray,-1,-1,1),Tn(this.vertexArray,1,-1,1),Tn(this.vertexArray,-1,1,1),Tn(this.vertexArray,1,1,1),Tn(this.vertexArray,-1,-1,-1),Tn(this.vertexArray,1,-1,-1),Tn(this.vertexArray,-1,1,-1),Tn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,zl),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function Pc(p,s,u,m,v,x){const S=p.context.gl,P=s.paint.get("sky-atmosphere-color"),O=s.paint.get("sky-atmosphere-halo-color"),L=s.paint.get("sky-atmosphere-sun-intensity"),N=((V,$,W,re,ee)=>({u_matrix_3f:V,u_sun_direction:$,u_sun_intensity:W,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[ee.r,ee.g,ee.b,ee.a],u_luminance:5e-5}))(o.e4(o.dx(),m),v,L,P.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),u.draw(p,S.TRIANGLES,Gt.disabled,br.disabled,$r.unblended,dr.frontCW,N,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const Lb=o.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class zb{constructor(s){const u=new o.e5;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new o.a_;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(u,Lb.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Nb=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class lP{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Mh{constructor(s){this.colorModeAlphaBlendedWriteRGB=new $r([1,fu,1,fu],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new $r([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new lP,this.updateNeeded=!0,s.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),s.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),s.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(s){const u=s.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new zb(u);const m=this.params.sizeRange,v=this.params.intensityRange,x=function(N){const V=o.e7(30),$=[];for(let W=0;W<N;++W){const re=2*Math.PI*V(),ee=Math.acos(1-2*V())-.5*Math.PI;$.push(o.cS(Math.cos(ee)*Math.cos(re),Math.cos(ee)*Math.sin(re),Math.sin(ee)))}return $}(this.params.starsCount),S=o.e7(300),P=new o.e6,O=new o.a_;let L=0;for(let N=0;N<x.length;++N){const V=o.bY([],x[N],200),$=Math.max(0,1+.01*m*(1*S()-.5)),W=Math.max(0,1+.01*v*(1*S()-.5));P.emplaceBack(V[0],V[1],V[2],-1,-1,$,W),P.emplaceBack(V[0],V[1],V[2],1,-1,$,W),P.emplaceBack(V[0],V[1],V[2],1,1,$,W),P.emplaceBack(V[0],V[1],V[2],-1,1,$,W),O.emplaceBack(L+0,L+1,L+2),O.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=u.createVertexBuffer(P,Nb.members),this.starsIdx=u.createIndexBuffer(O),this.starsSegments=o.bd.simpleSegment(0,0,P.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(s,u){const m=s.context,v=m.gl,x=s.transform,S=new Gt(v.LEQUAL,Gt.ReadOnly,[0,1]),P=o.ah(x.zoom),O=s.style.getLut(u.scope),L=u.properties.get("color-use-theme")==="none",N=u.properties.get("color").toNonPremultipliedRenderColor(L?null:O).toArray01(),V=u.properties.get("high-color-use-theme")==="none",$=u.properties.get("high-color").toNonPremultipliedRenderColor(V?null:O).toArray01(),W=u.properties.get("space-color-use-theme")==="none",re=u.properties.get("space-color").toNonPremultipliedRenderColor(W?null:O).toArray01(),ee=5e-4,ie=o.e8(u.properties.get("horizon-blend"),0,1,ee,.25),ae=o.dl(s,m,x)&&ie===ee?x.worldSize/(2*Math.PI*1.025)-1:x.globeRadius,ce=s.frameCounter/1e3%1,_e=o.ae(x.globeCenterInViewSpace),be=Math.sqrt(Math.pow(_e,2)-Math.pow(ae,2)),Pe=Math.acos(be/_e),Ae=Te=>{const we=x.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&we.push("ALPHA_PASS");const Ce=s.getOrCreateProgram("globeAtmosphere",{defines:we}),Oe=((Ge,at,lt,yt,Fe,tt,Le,ht,Ye,gt,Ot,ut)=>({u_frustum_tl:Ge,u_frustum_tr:at,u_frustum_br:lt,u_frustum_bl:yt,u_horizon:Fe,u_transition:tt,u_fadeout_range:Le,u_color:ht,u_high_color:Ye,u_space_color:gt,u_temporal_offset:Ot,u_horizon_angle:ut}))(x.frustumCorners.TL,x.frustumCorners.TR,x.frustumCorners.BR,x.frustumCorners.BL,x.frustumCorners.horizon,P,ie,N,$,re,ce,Pe);s.uploadCommonUniforms(m,Ce);const Ve=this.atmosphereBuffer;Ve&&Ce.draw(s,v.TRIANGLES,S,br.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,dr.backCW,Oe,Te?"atmosphere_glow_alpha":"atmosphere_glow",Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)};Ae(!1),Ae(!0)}drawStars(s,u){const m=o.ay(u.properties.get("star-intensity"),0,1);if(m===0)return;const v=s.context,x=v.gl,S=s.transform,P=s.getOrCreateProgram("stars"),O=o.b_([]);o.c0(O,O,-S._pitch),o.b$(O,O,-S.angle),o.c0(O,O,o.al(S._center.lat)),o.e9(O,O,-o.al(S._center.lng));const L=o.c3(new Float32Array(16),O),N=o.az([],S.starsProjMatrix,L),V=o.e4([],L),$=o.ea([],V),W=[0,1,0];o.dz(W,W,$),o.bY(W,W,this.params.sizeMultiplier);const re=[1,0,0];o.dz(re,re,$),o.bY(re,re,this.params.sizeMultiplier);const ee=(ie=W,ae=re,ce=m,{u_matrix:Float32Array.from(N),u_up:ie,u_right:ae,u_intensity_multiplier:ce});var ie,ae,ce;s.uploadCommonUniforms(v,P),this.starsVx&&this.starsIdx&&P.draw(s,x.TRIANGLES,Gt.disabled,br.disabled,this.colorModeAlphaBlendedWriteRGB,dr.disabled,ee,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Su(p,s){const u=[...p],m=s.cameraWorldSizeForFog/s.worldSize,v=o.bx([]);return o.cE(v,v,[m,m,1]),o.az(u,v,u),o.az(u,s.worldToFogMatrix,u),u}function Tt(p,s,u,m,v){const x=u.material,S=m.context,{baseColorTexture:P,metallicRoughnessTexture:O}=x.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:N,emissionTexture:V}=x;function $(re,ee,ie){if(re&&(p.push(ee),S.activeTexture.set(S.gl.TEXTURE0+ie),re.gfxTexture)){const{minFilter:ae,magFilter:ce,wrapS:_e,wrapT:be}=re.sampler;re.gfxTexture.bindExtraParam(ae,ce,_e,be)}}$(P,"HAS_TEXTURE_u_baseColorTexture",Jo.BaseColor),$(O,"HAS_TEXTURE_u_metallicRoughnessTexture",Jo.MetallicRoughness),$(L,"HAS_TEXTURE_u_normalTexture",Jo.Normal),$(N,"HAS_TEXTURE_u_occlusionTexture",Jo.Occlusion),$(V,"HAS_TEXTURE_u_emissionTexture",Jo.Emission),v&&(v.texture||(v.texture=new o.eh(m.context,v.image,[v.image.height,v.image.height,v.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+Jo.LUT),v.texture&&v.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),u.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),s.push(u.texcoordBuffer)),u.colorBuffer&&(p.push(u.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),s.push(u.colorBuffer)),u.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),s.push(u.normalBuffer)),u.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),s.push(u.pbrBuffer)),x.alphaMode!=="OPAQUE"&&x.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),x.defined||p.push("DIFFUSE_SHADED");const W=m.shadowRenderer;W&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),W.useNormalOffset&&p.push("NORMAL_OFFSET"))}function $t(p,s,u,m,v,x){const S=u.paint.get("model-opacity").constantOr(1),P=s.context,O=new Gt(s.context.gl.LEQUAL,Gt.ReadWrite,s.depthRangeFor3D),L=s.transform,N=p.mesh,V=N.material,$=V.pbrMetallicRoughness,W=s.style.fog;let re;re=s.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:o.az([],m.zScaleMatrix,p.nodeModelMatrix),o.az(re,m.negCameraPosMatrix,re);const ee=o.bi([],re);o.ee(ee,ee);const ie=u.paint.get("model-color-use-theme").constantOr("default")==="none",ae=u.paint.get("model-emissive-strength").constantOr(0),ce=kf(new Float32Array(p.worldViewProjection),new Float32Array(re),new Float32Array(ee),null,s,S,$.baseColorFactor,V.emissiveFactor,$.metallicFactor,$.roughnessFactor,V,ae,u),_e={defines:[]},be=[],Pe=s.shadowRenderer;Pe&&(Pe.useNormalOffset=!1),Tt(_e.defines,be,N,s,ie?null:u.lut);let Ae=null;if(W){const Ce=Su(p.nodeModelMatrix,s.transform);if(Ae=new Float32Array(Ce),L.projection.name!=="globe"){const Oe=N.aabb.min,Ve=N.aabb.max,[Ge,at]=W.getOpacityForBounds(Ce,Oe[0],Oe[1],Ve[0],Ve[1]);_e.overrideFog=Ge>=Qe||at>=Qe}}const Te=Ya(s,u.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&_e.defines.push("RENDER_CUTOFF");const we=s.getOrCreateProgram("model",_e);s.uploadCommonUniforms(P,we,null,Ae,Te),s.renderPass!=="shadow"&&Pe&&Pe.setupShadowsFromMatrix(p.nodeModelMatrix,we),we.draw(s,P.gl.TRIANGLES,O,v,x,N.material.doubleSided?dr.disabled:dr.backCCW,ce,u.id,N.vertexBuffer,N.indexBuffer,N.segments,u.paint,s.transform.zoom,void 0,be)}function Tu(p,s,u,m,v,x,S){let P;P=p.projection.name==="globe"?o.ed(u,p):[...u],o.az(P,P,s.matrix);const O=o.az([],m,P);if(s.meshes)for(const L of s.meshes){if(L.material.alphaMode!=="BLEND"){S.push({mesh:L,depth:0,modelIndex:v,worldViewProjection:O,nodeModelMatrix:P});continue}const N=o.ad([],L.centroid,O);!p.isOrthographic&&N[2]<=0||x.push({mesh:L,depth:N[2],modelIndex:v,worldViewProjection:O,nodeModelMatrix:P})}if(s.children)for(const L of s.children)Tu(p,L,u,m,v,x,S)}function di(p,s,u,m){const v=u.shadowRenderer;if(!v)return;const x=v.getShadowPassDepthMode(),S=v.getShadowPassColorMode(),P=v.calculateShadowPassMatrixFromMatrix(s),O=Pb(P);u.getOrCreateProgram("modelDepth",{defines:u._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(u,u.context.gl.TRIANGLES,x,br.disabled,S,dr.backCCW,O,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,u.transform.zoom,void 0,void 0)}function Be(p,s,u){const m=s.updateZoomBasedPaintProperties(),v=function(x,S,P){let O,L,N,V=x.terrain?x.terrain.exaggeration():0;if(x.terrain&&V>0){const $=x.terrain,W=$.findDEMTileFor(P);W&&W.dem?O=o.ei.create($,P,W):V=0}if(V===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),V===S.validForExaggeration&&(V===0||O&&O._demTile&&O._demTile.tileID===S.validForDEMTile.id&&O._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const $ in S.instancesPerModel){const W=S.instancesPerModel[$];for(let re=0;re<W.instancedDataArray.length;++re){const ee=(O?V*O.getElevationAt(0|W.instancedDataArray.float32[16*re],0|W.instancedDataArray.float32[16*re+1],!0,!0):0)+W.instancesEvaluatedElevation[re];W.instancedDataArray.float32[16*re+6]=ee,L=L?Math.min(S.terrainElevationMin,ee):ee,N=N?Math.max(S.terrainElevationMax,ee):ee}}return S.terrainElevationMin=L||0,S.terrainElevationMax=N||0,S.validForExaggeration=V,S.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,s,u);(m||v)&&(s.uploaded=!1,s.upload(p.context))}const Pa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.cW([0,0,0],[o.aj,o.aj,0])};function Km(p,s){const u=1<<p.canonical.z,m=s.getFreeCameraOptions().position,v=s.elevation,x=p.canonical.x/u,S=(p.canonical.x+1)/u,P=p.canonical.y/u,O=(p.canonical.y+1)/u;let L=s._centerAltitude;if(v){const W=v.getMinMaxForTile(p);W&&W.max>L&&(L=W.max)}const N=o.ay(m.x,x,S)-m.x,V=o.ay(m.y,P,O)-m.y,$=o.c6(L,s.center.lat)-m.z;return s._zoomFromMercatorZ(Math.sqrt(N*N+V*V+$*$))}function Ym(p,s,u,m,v,x,S){const P=p.context,O=p.renderPass==="shadow",L=p.shadowRenderer,N=O&&L?L.getShadowPassDepthMode():new Gt(P.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),V=p.isTileAffectedByFog(x);if(u.meshes)for(const $ of u.meshes){const W=["MODEL_POSITION_ON_GPU"],re=[];let ee,ie,ae;m.instancedDataArray.length>20&&W.push("INSTANCED_ARRAYS");const ce=Ya(p,s.paint.get("model-cutoff-fade-range"));if(ce.shouldRenderCutoff&&W.push("RENDER_CUTOFF"),O&&L)ee=p.getOrCreateProgram("modelDepth",{defines:W}),ie=Pb(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(u.matrix)),ae=L.getShadowPassColorMode();else{Tt(W,re,$,p,s.paint.get("model-color-use-theme").constantOr("default")==="none"?null:s.lut),ee=p.getOrCreateProgram("model",{defines:W,overrideFog:V});const be=$.material,Pe=be.pbrMetallicRoughness,Ae=s.paint.get("model-opacity").constantOr(1),Te=s.paint.get("model-emissive-strength").constantOr(0);ie=kf(x.expandedProjMatrix,Float32Array.from(u.matrix),new Float32Array(16),null,p,Ae,Pe.baseColorFactor,be.emissiveFactor,Pe.metallicFactor,Pe.roughnessFactor,be,Te,s,v),L&&(S.shadowUniformsInitialized?ee.setShadowUniformValues(P,L.getShadowUniformValues()):(L.setupShadows(x.toUnwrapped(),ee,"model-tile",x.overscaledZ),S.shadowUniformsInitialized=!0)),ae=ce.shouldRenderCutoff||Ae<1||be.alphaMode!=="OPAQUE"?$r.alphaBlended:$r.unblended}p.uploadCommonUniforms(P,ee,x.toUnwrapped(),null,ce);const _e=$.material.doubleSided?dr.disabled:dr.backCCW;if(m.instancedDataArray.length>20)re.push(m.instancedDataBuffer),ee.draw(p,P.gl.TRIANGLES,N,br.disabled,ae,_e,ie,s.id,$.vertexBuffer,$.indexBuffer,$.segments,s.paint,p.transform.zoom,void 0,re,m.instancedDataArray.length);else{const be=O?"u_instance":"u_normal_matrix";for(let Pe=0;Pe<m.instancedDataArray.length;++Pe)ie[be]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Pe,16),ee.draw(p,P.gl.TRIANGLES,N,br.disabled,ae,_e,ie,s.id,$.vertexBuffer,$.indexBuffer,$.segments,s.paint,p.transform.zoom,void 0,re)}}if(u.children)for(const $ of u.children)Ym(p,s,$,m,v,x,S)}const vv=[1,-1,1];function jb(p,s,u,m){if(!u.modelManager)return!0;const v=u.modelManager;if(!u.shadowRenderer)return!0;const x=u.shadowRenderer,S=s.aabb;let P=!0,O=p.maxHeight;if(O===0){let N=0;for(const V in p.instancesPerModel){const $=v.getModel(V,m);$?N=Math.max(N,Math.max(Math.max($.aabb.max[0],$.aabb.max[1]),$.aabb.max[2])):P=!1}O=p.maxScale*N*1.41+p.maxVerticalOffset,P&&(p.maxHeight=O)}S.max[2]=O,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,o.ad(S.min,S.min,s.tileMatrix),o.ad(S.max,S.max,s.tileMatrix);const L=S.intersects(x.getCurrentCascadeFrustum());return u.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=L===2),L===0}function Fb(p,s){const u=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],v=p.uniformValues.u_cutoff_params[2],x=p.uniformValues.u_cutoff_params[3];return m===u||x===v?1:o.ay(((s-u)/(m-u)-v)/(x-v),0,1)}function Rh(p,s,u,m){if(s.pitch<20)return 1;const v=s.getWorldToCameraMatrix();o.az(v,v,p);const x=o.ej(u.min[0],u.min[1],u.min[2],1);let S=o.aA(o.ek(),x,v),P=S,O=S;x[1]=u.max[1],S=o.aA(o.ek(),x,v),P=S[1]<P[1]?S:P,O=S[1]>O[1]?S:O,x[0]=u.max[0],S=o.aA(o.ek(),x,v),P=S[1]<P[1]?S:P,O=S[1]>O[1]?S:O,x[1]=u.min[1],S=o.aA(o.ek(),x,v),P=S[1]<P[1]?S:P,O=S[1]>O[1]?S:O;const L=o.ay(m[0],0,1),N=100*s.pixelsPerMeter*o.ay(m[1],0,1),V=o.ay(m[2],0,1),$=o.el(o.ek(),P,O,L),W=Math.tan(.5*s.fovX),re=-$[2]*W;if(N===0)return $[1]<-Math.abs(re)?V:1;const ee=(-Math.abs(re)-$[1])/N,ie=(ce,_e,be)=>(1-be)*ce+be*_e,ae=o.ay(ie(1,V,ee),V,1);return ie(1,ae,o.ay((s.pitch-20)/20,0,1))}class cP{}class uP{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(s,u,m){{const V=this._storage.get(u.id);if(V)return V.lastUsedFrameIdx=s,V.buf}const v=m.gl,x=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),S=new ArrayBuffer(x),P=new Int16Array(S);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const O=new o.en;for(let V=0;V<x/2;V+=3){const $=P[V],W=P[V+1],re=P[V+2];O.emplaceBack($,W),O.emplaceBack(W,re),O.emplaceBack(re,$)}const L=m.bindVertexArrayOES.current,N=new cP;return N.buf=new la(m,O),N.lastUsedFrameIdx=s,this._storage.set(u.id,N),m.bindVertexArrayOES.set(L),N.buf}update(s){for(const[u,m]of this._storage)s-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(u))}destroy(){for(const[s,u]of this._storage)u.buf.destroy(),this._storage.delete(s)}}class Bb{constructor(s){this.occluderSize=30,this.depthOffset=-1e-4,s.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),s.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Jm=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class xv{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class bv{constructor(s,u){this.revealStart=11,this.revealRange=2,s.registerParameter(this,[...u,"Reveal"],"revealStart",{min:0,max:17,step:.05}),s.registerParameter(this,[...u,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const $b=o.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Qm{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(s,u){const m=s.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.eo,P=new o.a_;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),P.emplaceBack(0,1,2),P.emplaceBack(0,2,3),this.vignetteVx=s.context.createVertexBuffer(S,$b.members),this.vignetteIdx=s.context.createIndexBuffer(P)}const v=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){s.uploadCommonUniforms(s.context,m);const S={u_vignetteShape:(x={vignetteShape:[u.start,u.range,Math.pow(10,u.fadePower)],vignetteColor:[u.color.r,u.color.g,u.color.b,u.color.a*u.strength]}).vignetteShape,u_vignetteColor:x.vignetteColor};m.draw(s,s.context.gl.TRIANGLES,Gt.disabled,br.disabled,$r.alphaBlended,dr.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,v)}var x}}class jf{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(s,u){const m=s.getFreeCameraOptions().position,v=m.toAltitude(),x=m.toLngLat(),S=o.al(x.lng),P=o.al(x.lat),O=s.pixelsPerMeter/u,L=S*o.eq,N=o.eq*Math.log(Math.tan(Math.PI/4+P/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const V=-this._offsetYPrev+N,$=-this._elevationPrev+v;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*O,this._accumulatedOffsetY+=V*O,this._accumulatedElevation+=$*O,this._offsetXPrev=L,this._offsetYPrev=N,this._elevationPrev=v}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Eu(p,s){return[-(p[0]-Math.floor(p[0]/s)*s),-(p[1]-Math.floor(p[1]/s)*s),-(p[2]-Math.floor(p[2]/s)*s)]}function wv(p){const s=o.e7(1323123451230),u=[];for(let m=0;m<p;++m){const v=2*s()-1,x=2*s()-1,S=2*s()-1;u.push(o.cS(v,x,S))}return u}function Cc(p,s,u,m,v){const x=o.ay((v-u)/(m-u),0,1);return(1-x)*p+x*s}class Bo{constructor(s){this._movement=new jf,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Qm,this._ppmScaleFactor=s}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(s,u){const m=s.transform;this._movement.update(m,this._ppmScaleFactor);const v=m.starsProjMatrix,x=o.b_([]);o.c0(x,x,o.al(90)-m._pitch),o.b$(x,x,-m.angle);const S=o.c3(new Float32Array(16),x),P=o.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=o.ee([],P),L=o.az([],O,S),N=Date.now()/1e3;return this._accumulatedTimeFromStart+=(N-this._prevTime)*u,this._prevTime=N,{projectionMatrix:v,modelviewMatrix:L}}}class hP extends Bo{constructor(s){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new bv(s.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(s){const u=s.context;if(!this.particlesVx){const m=wv(this.particlesCount),v=new o.er,x=new o.a_;let S=0;const P=o.e7(1323123451230);for(let O=0;O<m.length;++O){const L=m[O],N=[2*P()-1,P(),P(),P()];v.emplaceBack(L[0],L[1],L[2],-1,-1,...N),v.emplaceBack(L[0],L[1],L[2],1,-1,...N),v.emplaceBack(L[0],L[1],L[2],1,1,...N),v.emplaceBack(L[0],L[1],L[2],-1,1,...N),x.emplaceBack(S+0,S+1,S+2),x.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=u.createVertexBuffer(v,Jm.members),this.particlesIdx=u.createIndexBuffer(x)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.rain)return;const u=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},m=s.transform.zoom;if(u.revealStart>m)return;const v=Cc(0,1,u.revealStart,u.revealStart+u.revealRange,m);if(!this.particlesVx||!this.particlesIdx)return;const x=structuredClone(this._params);let S=[-x.direction.x,x.direction.y,-100];o.au(S,S);const P=structuredClone(this._vignetteParams);P.strength*=v,x.overrideStyleParameters||(x.intensity=s.style.rain.state.density,x.timeFactor=s.style.rain.state.intensity,x.color=structuredClone(s.style.rain.state.color),S=structuredClone(s.style.rain.state.direction),x.screenThinning.intensity=s.style.rain.state.centerThinning,x.dropletSizeX=s.style.rain.state.dropletSize[0],x.dropletSizeYScale=s.style.rain.state.dropletSize[1]/s.style.rain.state.dropletSize[0],x.distortionStrength=100*s.style.rain.state.distortionStrength,P.strength=1,P.color=structuredClone(s.style.rain.state.vignetteColor));const O=this.updateOnRender(s,x.timeFactor),L=s.context,N=L.gl,V=s.transform;this.screenTexture&&this.screenTexture.size[0]===s.width&&this.screenTexture.size[1]===s.height||(this.screenTexture=new o.T(L,{width:s.width,height:s.height,data:null},N.RGBA8)),x.distortionStrength>0&&(L.activeTexture.set(N.TEXTURE0),this.screenTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),N.copyTexSubImage2D(N.TEXTURE_2D,0,0,0,0,0,s.width,s.height));const $=s.getOrCreateProgram("rainParticle");s.uploadCommonUniforms(L,$),L.activeTexture.set(N.TEXTURE0),this.screenTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const W=[x.color.r,x.color.g,x.color.b,x.color.a],re=(ee,ie)=>{const ae=Eu(this._movement.getPosition(),ee),ce=x.dropletSizeX,_e=x.dropletSizeX*x.dropletSizeYScale,be=s.width/2,Pe=s.height/2,Ae=Cc(0,x.screenThinning.start,0,1,x.screenThinning.intensity),Te=Cc(.001,x.screenThinning.range,0,1,x.screenThinning.intensity),we=Cc(0,x.screenThinning.particleOffset,0,1,x.screenThinning.intensity),Ce=(Oe={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ae,velocityConeAperture:x.velocityConeAperture,velocity:x.velocity,boxSize:ee,rainDropletSize:[ce,_e],distortionStrength:x.distortionStrength,rainDirection:S,color:W,screenSize:[V.width,V.height],thinningCenterPos:[be,Pe],thinningShape:[Ae,Te,Math.pow(10,x.screenThinning.fadePower)],thinningAffectedRatio:x.screenThinning.affectedRatio,thinningParticleOffset:we,shapeDirectionalPower:x.shapeDirPower,shapeNormalPower:x.shapeNormalPower,mode:ie?0:1},{u_modelview:Float32Array.from(Oe.modelview),u_projection:Float32Array.from(Oe.projection),u_time:Oe.time,u_cam_pos:Oe.camPos,u_texScreen:0,u_velocityConeAperture:Oe.velocityConeAperture,u_velocity:Oe.velocity,u_boxSize:Oe.boxSize,u_rainDropletSize:Oe.rainDropletSize,u_distortionStrength:Oe.distortionStrength,u_rainDirection:Oe.rainDirection,u_color:Oe.color,u_screenSize:Oe.screenSize,u_thinningCenterPos:Oe.thinningCenterPos,u_thinningShape:Oe.thinningShape,u_thinningAffectedRatio:Oe.thinningAffectedRatio,u_thinningParticleOffset:Oe.thinningParticleOffset,u_shapeDirectionalPower:Oe.shapeDirectionalPower,u_shapeNormalPower:Oe.shapeNormalPower,u_mode:Oe.mode});var Oe;const Ve=Math.round(x.intensity*this.particlesCount),Ge=o.bd.simpleSegment(0,0,4*Ve,2*Ve);$.draw(s,N.TRIANGLES,Gt.disabled,br.disabled,$r.alphaBlended,dr.disabled,Ce,"rain_particles",this.particlesVx,this.particlesIdx,Ge)};x.distortionStrength>0&&re(x.boxSize,!0),re(x.boxSize,!1),this._vignette.draw(s,P)}}const Ff=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Qn extends Bo{constructor(s){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new bv(s.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(s){const u=s.context;if(!this.particlesVx){const m=wv(this.particlesCount),v=new o.es,x=new o.a_;let S=0;const P=o.e7(1323123451230);for(let O=0;O<m.length;++O){const L=m[O],N=P(),V=P(),$=P(),W=[O/m.length,N,V,$],re=[P(),P()];v.emplaceBack(L[0],L[1],L[2],-1,-1,...W,...re),v.emplaceBack(L[0],L[1],L[2],1,-1,...W,...re),v.emplaceBack(L[0],L[1],L[2],1,1,...W,...re),v.emplaceBack(L[0],L[1],L[2],-1,1,...W,...re),x.emplaceBack(S+0,S+1,S+2),x.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=u.createVertexBuffer(v,Ff.members),this.particlesIdx=u.createIndexBuffer(x)}}draw(s){if(!this._params.overrideStyleParameters&&!s.style.snow)return;const u=structuredClone(this._params);let m=[-u.direction.x,u.direction.y,-100];o.au(m,m);const v=structuredClone(this._vignetteParams),x=u.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=s.transform.zoom;if(x.revealStart>S)return;const P=Cc(0,1,x.revealStart,x.revealStart+x.revealRange,S);v.strength*=P,u.overrideStyleParameters||(u.intensity=s.style.snow.state.density,u.timeFactor=s.style.snow.state.intensity,u.color=structuredClone(s.style.snow.state.color),m=structuredClone(s.style.snow.state.direction),u.screenThinning.intensity=s.style.snow.state.centerThinning,u.billboardSize=2.79*s.style.snow.state.flakeSize,v.strength=1,v.color=structuredClone(s.style.snow.state.vignetteColor));const O=this.updateOnRender(s,u.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=s.context,N=L.gl,V=s.transform,$=s.getOrCreateProgram("snowParticle");s.uploadCommonUniforms(L,$),((W,re,ee)=>{const ie=Eu(this._movement.getPosition(),W),ae=V.width/2,ce=V.height/2,_e=Cc(0,ee.screenThinning.start,0,1,ee.screenThinning.intensity),be=Cc(.001,ee.screenThinning.range,0,1,ee.screenThinning.intensity),Pe=Cc(0,ee.screenThinning.particleOffset,0,1,ee.screenThinning.intensity),Ae=(Te={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ie,velocityConeAperture:ee.velocityConeAperture,velocity:ee.velocity,horizontalOscillationRadius:ee.horizontalOscillationRadius,horizontalOscillationRate:ee.horizontalOscillationRate,boxSize:W,billboardSize:1*ee.billboardSize,simpleShapeParameters:[ee.shapeFadeStart,ee.shapeFadePower],screenSize:[V.width,V.height],thinningCenterPos:[ae,ce],thinningShape:[_e,be,Math.pow(10,ee.screenThinning.fadePower)],thinningAffectedRatio:ee.screenThinning.affectedRatio,thinningParticleOffset:Pe,color:[ee.color.r,ee.color.g,ee.color.b,ee.color.a],direction:m},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const we=Math.round(ee.intensity*this.particlesCount),Ce=o.bd.simpleSegment(0,0,4*we,2*we);this.particlesVx&&this.particlesIdx&&$.draw(s,N.TRIANGLES,Gt.disabled,br.disabled,$r.alphaBlended,dr.disabled,Ae,"snow_particles",this.particlesVx,this.particlesIdx,Ce)})(u.boxSize,0,u),this._vignette.draw(s,v)}}const rn={symbol:function(p,s,u,m,v){if(p.renderPass!=="translucent")return;const x=br.disabled,S=p.colorModeForRenderPass(),P=u.layout.get("text-variable-anchor"),O=u.layout.get("text-size-scale-range"),L=o.ay(p.scaleFactor,O[0],O[1]);P&&function($,W,re,ee,ie,ae,ce,_e){const be=W.transform,Pe=ie==="map",Ae=ae==="map";for(const Te of $){const we=ee.getTile(Te),Ce=we.getBucket(re);if(!Ce||!Ce.text||!Ce.text.segments.get().length)continue;const Oe=o.bH(Ce.textSizeData,be.zoom,_e),Ve=bm(Te,Ce.getProjection(),be),Ge=be.calculatePixelsToTileUnitsMatrix(we),at=Cl(Ve,we.tileID.canonical,Ae,Pe,be,Ce.getProjection(),Ge),lt=Ce.hasIconTextFit()&&Ce.hasIconData();Oe&&Ib(Ce,Pe,Ae,ce,be,at,Te,Math.pow(2,be.zoom-we.tileID.overscaledZ),Oe,lt)}}(m,p,u,s,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v,L);const N=u.paint.get("icon-opacity").constantOr(1)!==0,V=u.paint.get("text-opacity").constantOr(1)!==0;u.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(N||V)?Ch(p,s,u,m,x,S):(N&&Ch(p,s,u,m,x,S,{onlyIcons:!0}),V&&Ch(p,s,u,m,x,S,{onlyText:!0})),s.map.showCollisionBoxes&&(Wm(p,s,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),Wm(p,s,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,u,m){if(p.renderPass!=="translucent")return;const v=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),S=u.paint.get("circle-stroke-opacity"),P=u.layout.get("circle-sort-key").constantOr(1)!==void 0,O=u.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;const L=p.context,N=L.gl,V=p.transform,$=!(!p.terrain||!p.terrain.enabled),W=u.layout.get("circle-elevation-reference"),re=p.depthModeForSublayer(0,Gt.ReadOnly),ee=new Gt(p.context.gl.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),ie=W==="none"||$?re:ee,ae=br.disabled,ce=p.colorModeForDrapableLayerRenderPass(O),_e=V.projection.name==="globe",be=[o.aD(V.center.lng),o.aH(V.center.lat)],Pe=[];for(let Te=0;Te<m.length;Te++){const we=m[Te],Ce=s.getTile(we),Oe=Ce.getBucket(u);if(!Oe||Oe.projection.name!==V.projection.name)continue;const Ve=Oe.programConfigurations.get(u.id),Ge=Oe.layoutVertexBuffer,at=Oe.globeExtVertexBuffer,lt=Oe.indexBuffer,yt=o.dK(u),Fe=[at],tt=p.isTileAffectedByFog(we);_e&&yt.push("PROJECTION_GLOBE_VIEW"),yt.push("DEPTH_D24"),p.terrain&&V.depthOcclusionForSymbolsAndCircles&&yt.push("DEPTH_OCCLUSION"),Oe.hasElevation&&(yt.push("ELEVATED_ROADS"),Fe.push(Oe.elevatedLayoutVertexBuffer));const Le=p.getOrCreateProgram("circle",{config:Ve,defines:yt,overrideFog:tt}),ht=V.projection.createInversionMatrix(V,we.canonical),Ye={programConfiguration:Ve,program:Le,layoutVertexBuffer:Ge,dynamicBuffers:Fe,indexBuffer:lt,uniformValues:o.dL(p,we,Ce,ht,be,u),tile:Ce};if(P){const gt=Oe.segments.get();for(const Ot of gt)Pe.push({segments:new o.bd([Ot]),sortKey:Ot.sortKey,state:Ye})}else Pe.push({segments:Oe.segments,sortKey:0,state:Ye})}P&&Pe.sort((Te,we)=>Te.sortKey-we.sortKey);const Ae={useDepthForOcclusion:V.depthOcclusionForSymbolsAndCircles};for(const Te of Pe){const{programConfiguration:we,program:Ce,layoutVertexBuffer:Oe,dynamicBuffers:Ve,indexBuffer:Ge,uniformValues:at,tile:lt}=Te.state,yt=Te.segments;p.terrain&&p.terrain.setupElevationDraw(lt,Ce,Ae),p.uploadCommonUniforms(L,Ce,lt.tileID.toUnwrapped()),Ce.draw(p,N.TRIANGLES,ie,ae,ce,dr.disabled,at,u.id,Oe,Ge,yt,u.paint,V.zoom,we,Ve)}},heatmap:function(p,s,u,m){if(u.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const v=p.context,x=v.gl,S=br.disabled,P=new $r([x.ONE,x.ONE,x.ONE,x.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(W,re,ee,ie){const ae=W.gl,ce=re.width*ie,_e=re.height*ie;W.activeTexture.set(ae.TEXTURE1),W.viewport.set([0,0,ce,_e]);let be=ee.heatmapFbo;if(!be||be&&(be.width!==ce||be.height!==_e)){be&&be.destroy();const Pe=ae.createTexture();ae.bindTexture(ae.TEXTURE_2D,Pe),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_2D,ae.TEXTURE_MAG_FILTER,ae.LINEAR),be=ee.heatmapFbo=W.createFramebuffer(ce,_e,!0,null),function(Ae,Te,we,Ce,Oe,Ve){const Ge=Ae.gl;Ge.texImage2D(Ge.TEXTURE_2D,0,Ae.extRenderToTextureHalfFloat?Ge.RGBA16F:Ge.RGBA,Oe,Ve,0,Ge.RGBA,Ae.extRenderToTextureHalfFloat?Ge.HALF_FLOAT:Ge.UNSIGNED_BYTE,null),Ce.colorAttachment.set(we)}(W,0,Pe,be,ce,_e)}else ae.bindTexture(ae.TEXTURE_2D,be.colorAttachment.get()),W.bindFramebuffer.set(be.framebuffer)})(v,p,u,p.transform.projection.name==="globe"?.5:.25),v.clear({color:o.am.transparent});const O=p.transform,L=O.projection.name==="globe",N=L?["PROJECTION_GLOBE_VIEW"]:[],V=L?dr.frontCCW:dr.disabled,$=[o.aD(O.center.lng),o.aH(O.center.lat)];for(let W=0;W<m.length;W++){const re=m[W];if(s.hasRenderableParent(re))continue;const ee=s.getTile(re),ie=ee.getBucket(u);if(!ie||ie.projection.name!==O.projection.name)continue;const ae=p.isTileAffectedByFog(re),ce=ie.programConfigurations.get(u.id),_e=p.getOrCreateProgram("heatmap",{config:ce,defines:N,overrideFog:ae}),{zoom:be}=p.transform;p.terrain&&p.terrain.setupElevationDraw(ee,_e),p.uploadCommonUniforms(v,_e,re.toUnwrapped());const Pe=O.projection.createInversionMatrix(O,re.canonical);_e.draw(p,x.TRIANGLES,Gt.disabled,S,P,V,Tb(p,re,ee,Pe,$,be,u.paint.get("heatmap-intensity")),u.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,u.paint,p.transform.zoom,ce,L?[ie.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,x){const S=v.context,P=S.gl,O=x.heatmapFbo;if(!O)return;S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,O.colorAttachment.get()),S.activeTexture.set(P.TEXTURE1);let L=x.colorRampTexture;L||(L=x.colorRampTexture=new o.T(S,x.colorRamp,P.RGBA8)),L.bind(P.LINEAR,P.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,P.TRIANGLES,Gt.disabled,br.disabled,v.colorModeForRenderPass(),dr.disabled,((N,V,$,W)=>({u_image:0,u_color_ramp:1,u_opacity:V.paint.get("heatmap-opacity")}))(0,x),x.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,x.paint,v.transform.zoom)}(p,u))},line:function(p,s,u,m){if(p.renderPass!=="translucent")return;const v=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(v.constantOr(1)===0||x.constantOr(1)===0)return;const S=u.paint.get("line-emissive-strength"),P=u.paint.get("line-occlusion-opacity"),O=u.layout.get("line-elevation-reference"),L=u.layout.get("line-width-unit")==="meters",N=O==="sea",V=!(!p.terrain||!p.terrain.enabled),$=p.context,W=$.gl;if(u.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const re=u.layout.get("line-cross-slope"),ee=re!==void 0,ie=re<1,ae=p.colorModeForDrapableLayerRenderPass(S),ce=p.terrain&&p.terrain.renderingToTexture,_e=ce?1:o.q.devicePixelRatio,be=u.paint.get("line-dasharray"),Pe=be.constantOr(1),Ae=u.layout.get("line-cap"),Te=be.constantOr(null),we=Ae.constantOr(null),Ce=u.paint.get("line-pattern"),Oe=Ce.constantOr(1),Ve=u.paint.get("line-pattern-cross-fade"),Ge=Ce.constantOr(null),at=u.paint.get("line-opacity").constantOr(1);let lt=!Oe&&at!==1||p.depthOcclusion&&P>0&&P<1;const yt=u.paint.get("line-gradient"),Fe=Oe?"linePattern":"line",tt=o.dM(u);let Le;if(ce&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(lt=!1),P!==0&&p.depthOcclusion){const Ot=u.paint._values["line-opacity"];Ot&&Ot.value&&Ot.value.kind==="constant"?Le=Ot.value:o.w(`Occlusion opacity for layer ${u.id} is supported only when line-opacity isn't data-driven.`)}x.value.kind!=="constant"&&x.value.isLineProgressConstant===!1&&tt.push("VARIABLE_LINE_WIDTH");const ht=(Ot,ut,Ct,Wt,qt,Vt)=>{for(const tr of Ot){const ir=s.getTile(tr);if(Oe&&!ir.patternsLoaded())continue;const ar=ir.getBucket(u);if(!ar||ar.elevationType!=="none"&&!qt||ar.elevationType==="none"&&qt)continue;p.prepareDrawTile();const yr=[...ut],kr=p.shadowRenderer,pn=ar.elevationType==="road"&&!!kr&&kr.enabled;let jn=[0,0,0];if(pn){const Jr=p.style.directionalLight,Di=p.style.ambientLight;Jr&&Di&&(jn=pu(p.style,Jr,Di)),yr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const yn=ar.programConfigurations.get(u.id);let bn=!1;if(Ge&&ir.imageAtlas){const Jr=o.dN.from(Ge),Di=Jr.getPrimary().scaleSelf(_e).toString(),qn=ir.imageAtlas.patternPositions.get(Di),Mn=Jr.getSecondary(),Zn=Mn?ir.imageAtlas.patternPositions.get(Mn.scaleSelf(_e).toString()):null;bn=!!qn&&!!Zn,qn&&yn.setConstantPatternPositions(qn,Zn)}Ve>0&&(bn||yn.getPatternTransitionVertexBuffer("line-pattern"))&&yr.push("LINE_PATTERN_TRANSITION");const xi=p.isTileAffectedByFog(tr),Cr=p.getOrCreateProgram(Fe,{config:yn,defines:yr,overrideFog:xi,overrideRtt:!qt&&void 0});if(!Oe&&Te&&we&&ir.lineAtlas){const Jr=ir.lineAtlas.getDash(Te,we);Jr&&yn.setConstantPatternPositions(Jr)}pn&&kr.setupShadows(ir.tileID.toUnwrapped(),Cr,"vector-tile",ir.tileID.overscaledZ);let[zr,Hr]=u.paint.get("line-trim-offset");(we==="round"||we==="square")&&zr!==Hr&&(zr===0&&(zr-=1),Hr===1&&(Hr+=1));const Wn=ce?tr.projMatrix:null,$i=L?1/ar.tileToMeter/o.aw(ir,1,p.transform.zoom):1,Fn=L?1/ar.tileToMeter/o.aw(ir,1,Math.floor(p.transform.zoom)):1,an=Oe?o.dO(p,ir,u,Wn,_e,$i,Fn,[zr,Hr],jn,Ve):o.dP(p,ir,u,Wn,ar.lineClipsArray.length,_e,$i,Fn,[zr,Hr],jn);if(yt){const Jr=ar.gradients[u.id];let Di=Jr.texture;if(u.gradientVersion!==Jr.version){let qn=256;if(u.stepInterpolant){const Mn=s.getSource().maxzoom,Zn=tr.canonical.z===Mn?Math.ceil(1<<p.transform.maxZoom-tr.canonical.z):1;qn=o.ay(o.dQ(ar.maxLineLength/o.aj*1024*Zn),256,$.maxTextureSize)}Jr.gradient=o.dR({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:qn,image:Jr.gradient||void 0,clips:ar.lineClipsArray}),Jr.texture?Jr.texture.update(Jr.gradient):Jr.texture=new o.T($,Jr.gradient,W.RGBA8),Jr.version=u.gradientVersion,Di=Jr.texture}$.activeTexture.set(W.TEXTURE1),Di.bind(u.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}Pe&&($.activeTexture.set(W.TEXTURE0),ir.lineAtlasTexture&&ir.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),yn.updatePaintBuffers()),Oe&&($.activeTexture.set(W.TEXTURE0),ir.imageAtlasTexture&&ir.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),yn.updatePaintBuffers()),qt&&!N&&p.terrain.setupElevationDraw(ir,Cr),p.uploadCommonUniforms($,Cr,tr.toUnwrapped());const fi=Jr=>{Le!=null&&(Le.value=at*P),Cr.draw(p,W.TRIANGLES,Ct,Jr,ae,dr.disabled,an,u.id,ar.layoutVertexBuffer,ar.indexBuffer,ar.segments,u.paint,p.transform.zoom,yn,[ar.layoutVertexBuffer2,ar.patternVertexBuffer,ar.zOffsetVertexBuffer]),Le!=null&&(Le.value=at)};if(lt&&!qt){const Jr=p.stencilModeForClipping(tr).ref;Jr===0&&ce&&$.clear({stencil:0});const Di={func:W.EQUAL,mask:255};an.u_alpha_discard_threshold=.8,fi(new br(Di,Jr,255,W.KEEP,W.KEEP,W.INVERT)),an.u_alpha_discard_threshold=0,fi(new br(Di,Jr,255,W.KEEP,W.KEEP,W.KEEP))}else an.u_alpha_discard_threshold=lt&&qt&&Vt?.8:0,fi(qt?Wt:p.stencilModeForClipping(tr))}};let Ye=p.depthModeForSublayer(0,Gt.ReadOnly);const gt=new Gt(p.depthOcclusion?W.GREATER:W.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);if(u.hasNonElevatedBuckets){const Ot=!ce&&p.terrain;P!==0&&Ot?o.w(`Occlusion opacity for layer ${u.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ot?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${u.id}.`):ht(m,tt,Ye,br.disabled,!1,!0)}if(u.hasElevatedBuckets){O==="hd-road-markup"?V||(Ye=gt,tt.push("ELEVATED_ROADS")):(tt.push("ELEVATED"),Ye=gt,ee&&tt.push(ie?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),N&&tt.push("ELEVATION_REFERENCE_SEA"));const Ot=lt?p.stencilModeFor3D():br.disabled;p.forceTerrainMode=!0,ht(m,tt,Ye,Ot,!0,!0),lt&&ht(m,tt,Ye,Ot,!0,!1),p.forceTerrainMode=!1}lt&&(p.resetStencilClippingMasks(),ce&&$.clear({stencil:0})),P===0||p.depthOcclusion||ce||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,s,u,m){const v=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const S=u.paint.get("fill-emissive-strength"),P=p.colorModeForDrapableLayerRenderPass(S),O=u.paint.get("fill-pattern"),L=p.opaquePassEnabledForLayer()&&!O.constantOr(1)&&v.constantOr(o.am.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";let N="none";u.layout.get("fill-elevation-reference")!=="none"?N="road":u.paint.get("fill-z-offset").constantOr(1)!==0&&(N="offset");const V=!(!p.terrain||!p.terrain.enabled),$={painter:p,sourceCache:s,layer:u,coords:m,colorMode:P,elevationType:N,terrainEnabled:V,pass:L};if(p.renderPass!=="shadow")if(N!=="offset"){if(gv($,!1),N==="road"){const W=!V&&p.renderPass==="translucent";W&&mv(p,s,u,m,"geometry"),gv($,!0,br.disabled),W&&function(re){const{painter:ee,sourceCache:ie,layer:ae,coords:ce,colorMode:_e}=re,be=ee.context.gl,Pe=re.painter.shadowRenderer,Ae=!!Pe&&Pe.enabled,Te=new Gt(ee.context.gl.LEQUAL,Gt.ReadOnly,ee.depthRangeFor3D);let we=[0,0,0];if(Ae){const Oe=ee.style.directionalLight,Ve=ee.style.ambientLight;Oe&&Ve&&(we=pu(ee.style,Oe,Ve))}const Ce=Oe=>{for(const Ve of ce){const Ge=ie.getTile(Ve),at=Ge.getBucket(ae);if(!at)continue;const lt=at.elevatedStructures;if(!lt)continue;let yt,Fe;if(Oe?(yt=lt.renderableBridgeSegments,Fe=lt.bridgeProgramConfigurations.get(ae.id)):(yt=lt.renderableTunnelSegments,Fe=lt.tunnelProgramConfigurations.get(ae.id)),!yt||yt.segments[0].primitiveLength===0)continue;Fe.updatePaintBuffers(),ee.prepareDrawTile();const tt=ee.isTileAffectedByFog(Ve),Le=[];Ae&&Le.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ht=ee.getOrCreateProgram("elevatedStructures",{config:Fe,overrideFog:tt,defines:Le}),Ye=ee.translatePosMatrix(Ve.projMatrix,Ge,ae.paint.get("fill-translate"),ae.paint.get("fill-translate-anchor"));Ae&&Pe.setupShadows(Ge.tileID.toUnwrapped(),ht,"vector-tile",Ge.tileID.overscaledZ);const gt=JA(Ye,we);ee.uploadCommonUniforms(ee.context,ht,Ve.toUnwrapped()),ht.draw(ee,be.TRIANGLES,Te,br.disabled,_e,dr.backCCW,gt,ae.id,lt.vertexBuffer,lt.indexBuffer,yt,ae.paint,ee.transform.zoom,Fe,[lt.vertexBufferNormal])}};Ce(!0),Ce(!1)}($)}}else gv($,!1,p.stencilModeFor3D());else p.shadowRenderer&&N==="road"&&!V&&function(W){const{painter:re,sourceCache:ee,layer:ie,coords:ae}=W,ce=re.context.gl,_e=W.painter.shadowRenderer;for(const be of ae){const Pe=ee.getTile(be),Ae=Pe.getBucket(ie);if(!Ae)continue;const Te=Ae.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;re.prepareDrawTile();const we=Ae.bufferData.programConfigurations.get(ie.id),Ce=re.isTileAffectedByFog(be),Oe=re.getOrCreateProgram("elevatedStructuresDepth",{config:we,overrideFog:Ce}),Ve=_e.calculateShadowPassMatrixFromTile(Pe.tileID.toUnwrapped());re.uploadCommonUniforms(re.context,Oe,be.toUnwrapped());const Ge={u_matrix:Ve,u_depth_bias:.001};Oe.draw(re,ce.TRIANGLES,_e.getShadowPassDepthMode(),br.disabled,_e.getShadowPassColorMode(),dr.disabled,Ge,ie.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,ie.paint,re.transform.zoom,we)}}($)},"fill-extrusion":function(p,s,u,m){const v=u.paint.get("fill-extrusion-opacity"),x=p.context,S=x.gl,P=p.terrain,O=P&&P.renderingToTexture;if(v===0)return;const L=p.conflationActive&&p.style.isLayerClipped(u,s.getSource()),N=p.style.order.indexOf(u.fqid);if(L&&function(V,$,W,re,ee){for(const ie of re){const ae=$.getTile(ie).getBucket(W);ae&&(ae.updateReplacement(ie,V.replacementSource,ee),ae.uploadCentroid(V.context))}}(p,s,u,m,N),P||L)for(const V of m){const $=s.getTile(V).getBucket(u);$&&Ht(p.context,s,V,$,u,P,L)}if(p.renderPass==="shadow"&&p.shadowRenderer){const V=p.shadowRenderer;if(P&&v<.65&&u._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const $=V.getShadowPassDepthMode(),W=V.getShadowPassColorMode();kl(p,s,u,m,$,br.disabled,W,L)}else if(p.renderPass==="translucent"){const V=!u.paint.get("fill-extrusion-pattern").constantOr(1),$=u.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!O&&$.a!==0){const W=new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D);v===1&&V?kl(p,s,u,m,W,br.disabled,$r.unblended,L):(kl(p,s,u,m,W,br.disabled,$r.disabled,L),kl(p,s,u,m,W,p.stencilModeFor3D(),p.colorModeForRenderPass(),L),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&V&&(!P&&p.transform.projection.name!=="globe"||O)){const W=u.paint.get("fill-extrusion-opacity"),re=u.paint.get("fill-extrusion-ambient-occlusion-intensity"),ee=u.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ie=u.paint.get("fill-extrusion-flood-light-intensity"),ae=u.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ce=u.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ae?null:u.lut).toArray01().slice(0,3),_e=re>0&&ee>0,be=ie>0,Pe=(Te,we,Ce)=>(1-Ce)*Te+Ce*we,Ae=Te=>{const we=p.depthModeForSublayer(1,Gt.ReadOnly,S.LEQUAL,!0),Ce=u.paint.get(Te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=Pe(.1,3,Ce),Ve=p._showOverdrawInspector;if(!Ve){const Ge=new br({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),at=new $r([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);Dl(p,s,u,m,we,Ge,at,dr.disabled,Te,"sdf",W,re,ee,ie,ce,Oe,L,!1)}{const Ge=Ve?br.disabled:new br({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),at=Ve?p.colorModeForRenderPass():new $r([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.am.transparent,[!0,!0,!0,!0]);Dl(p,s,u,m,we,Ge,at,dr.disabled,Te,"color",W,re,ee,ie,ce,Oe,L,!1)}};if(O){const Te=(we,Ce,Oe)=>{const Ve=p.depthModeForSublayer(1,Gt.ReadOnly,S.LEQUAL,!1),Ge=u.paint.get(we?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),at=Pe(.1,3,Ge);{const lt=new $r([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0]);Dl(p,s,u,m,Ve,br.disabled,lt,dr.disabled,we,"clear",W,re,ee,ie,ce,at,L,Ce)}{const lt=new br({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),yt=new $r([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);Dl(p,s,u,m,Ve,lt,yt,dr.disabled,we,"sdf",W,re,ee,ie,ce,at,L,Ce)}{const lt=we?S.ZERO:S.ONE_MINUS_DST_ALPHA,yt=new br({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Fe=new $r([lt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.am.transparent,[!0,!0,!0,!0]);Dl(p,s,u,m,Ve,yt,Fe,dr.disabled,we,"color",W,re,ee,ie,ce,at,L,Ce)}{const lt=new $r([S.ONE,S.ONE,S.ONE,we?S.ZERO:S.ONE],o.am.transparent,[!1,!1,!1,!0],we?S.FUNC_ADD:S.MAX);Dl(p,s,u,m,Ve,br.disabled,lt,dr.disabled,we,"clear",W,re,ee,ie,ce,at,L,Ce,Oe)}};if(_e||be){let we;if(p.prepareDrawTile(),P){const Ce=P.drapeBufferSize[0],Oe=P.drapeBufferSize[1];we=P.framebufferCopyTexture,we&&(!we||we.size[0]===Ce&&we.size[1]===Oe)||(we&&we.destroy(),we=P.framebufferCopyTexture=new o.T(x,new o.r({width:Ce,height:Oe}),S.RGBA8)),we.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,Ce,Oe)}_e&&Te(!0,!1,we),be&&Te(!1,!0,we)}}else _e&&Ae(!0),be&&Ae(!1),(_e||be)&&p.resetStencilClippingMasks()}}},building:function(p,s,u,m){},hillshade:function(p,s,u,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const v=p.context,x=p.terrain&&p.terrain.renderingToTexture,[S,P]=p.renderPass!=="translucent"||x?[{},m]:p.stencilConfigForOverlap(m);for(const O of P){const L=s.getTile(O);if(L.needsHillshadePrepare&&p.renderPass==="offscreen")BA(p,L,u);else if(p.renderPass==="translucent"){const N=p.depthModeForSublayer(0,Gt.ReadOnly),V=u.paint.get("hillshade-emissive-strength"),$=p.colorModeForDrapableLayerRenderPass(V),W=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(O):S[O.overscaledZ];FA(p,O,L,u,N,W,$)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,u,m,v,x){if(p.renderPass!=="translucent"||u.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",P=u.paint.get("raster-elevation")!==0,O=P&&S;if(p.renderElevatedRasterBackface&&!O)return;const L=p.context,N=L.gl,V=s.getSource(),$=function(Ae,Te,we,Ce){const Oe=Te.paint.get("raster-color"),Ve=Ae.type==="raster-array",Ge=[],at=Te.paint.get("raster-resampling"),lt=Te.paint.get("raster-color-mix");let yt=Te.paint.get("raster-color-range");const Fe=[lt[0],lt[1],lt[2],0],tt=lt[3];let Le=at==="nearest"?Ce.NEAREST:Ce.LINEAR;if(Ve&&(Ge.push("RASTER_ARRAY"),Oe||Ge.push("RASTER_COLOR"),at==="linear"&&Ge.push("RASTER_ARRAY_LINEAR"),Le=Ce.NEAREST,!yt&&Ae.rasterLayers)){const ht=Ae.rasterLayers.find(({id:Ye})=>Ye===Te.sourceLayer);ht&&ht.fields&&ht.fields.range&&(yt=ht.fields.range)}if(yt=yt||[0,1],Oe){Ge.push("RASTER_COLOR"),we.activeTexture.set(Ce.TEXTURE2),Te.updateColorRamp(yt);let ht=Te.colorRampTexture;ht||(ht=Te.colorRampTexture=new o.T(we,Te.colorRamp,Ce.RGBA8)),ht.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}return{mix:Fe,range:yt,offset:tt,defines:Ge,resampling:Le}}(V,u,L,N);if(V instanceof o.aP&&!m.length&&!S)return;const W=u.paint.get("raster-emissive-strength"),re=p.colorModeForDrapableLayerRenderPass(W),ee=p.terrain&&p.terrain.renderingToTexture,ie=!p.options.moving,ae=u.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;if(V instanceof o.aP&&!m.length&&(V.onNorthPole||V.onSouthPole)){const Ae=P?p.stencilModeFor3D():br.disabled;return void zf(!!V.onNorthPole,null,p,s,u,W,$,dr.disabled,Ae)}if(!m.length)return;const[ce,_e]=V instanceof o.aP||ee?[{},m]:p.stencilConfigForOverlap(m),be=_e[_e.length-1].overscaledZ;O&&$.defines.push("PROJECTION_GLOBE_VIEW"),P&&$.defines.push("RENDER_CUTOFF");const Pe=(Ae,Te,we)=>{for(const Ce of Ae){const Oe=Ce.toUnwrapped(),Ve=s.getTile(Ce);if(ee&&(!Ve||!Ve.hasData()))continue;L.activeTexture.set(N.TEXTURE0);const Ge=iP(Ve,V,u,$);if(!Ge||!Ge.texture)continue;const{texture:at,mix:lt,offset:yt,tileSize:Fe,buffer:tt}=Ge;let Le,ht;ee?(Le=Gt.disabled,ht=Ce.projMatrix):P?(Le=new Gt(N.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D),ht=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(Oe,ie)):(Le=p.depthModeForSublayer(Ce.overscaledZ-be,u.paint.get("raster-opacity")===1?Gt.ReadWrite:Gt.ReadOnly,N.LESS),ht=p.transform.calculateProjMatrix(Oe,ie));const Ye=p.terrain&&ee?p.terrain.stencilModeForRTTOverlap(Ce):ce[Ce.overscaledZ],gt=x?0:u.paint.get("raster-fade-duration");Ve.registerFadeDuration(gt);const Ot=s.findLoadedParent(Ce,0),ut=yu(Ve,Ot,s,p.transform,gt);let Ct,Wt;p.terrain&&p.terrain.prepareDrawTile(),L.activeTexture.set(N.TEXTURE0),at.bind(ae,N.CLAMP_TO_EDGE),L.activeTexture.set(N.TEXTURE1),Ot?(Ot.texture&&Ot.texture.bind(ae,N.CLAMP_TO_EDGE),Ct=Math.pow(2,Ot.tileID.overscaledZ-Ve.tileID.overscaledZ),Wt=[Ve.tileID.canonical.x*Ct%1,Ve.tileID.canonical.y*Ct%1]):at.bind(ae,N.CLAMP_TO_EDGE),"useMipmap"in at&&L.extTextureFilterAnisotropic&&p.transform.pitch>20&&N.texParameterf(N.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const qt=p.transform;let Vt;const tr=P?nP(qt):[0,0,0,0];let ir,ar,yr,kr,pn,jn=0;if(O&&V instanceof o.aP&&V.coordinates.length>3)ir=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0)))),ar=Float32Array.from(qt.globeMatrix),yr=Float32Array.from(o.dm(qt)),kr=[o.aD(qt.center.lng),o.aH(qt.center.lat)],Vt=V.elevatedGlobePerspectiveTransform,pn=V.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Cr=o.dn(Ce.canonical);jn=o.dp(Cr.getCenter().lat),ir=Float32Array.from(o.bh(o.dr(Ce.canonical))),ar=Float32Array.from(qt.globeMatrix),yr=Float32Array.from(o.dm(qt)),kr=[o.aD(qt.center.lng),o.aH(qt.center.lat)],Vt=[0,0],pn=Float32Array.from(o.dq(Ce.canonical,Cr,jn,qt.worldSize/qt._pixelsPerMercatorPixel))}else Vt=V instanceof o.aP?V.perspectiveTransform:[0,0],ir=new Float32Array(16),ar=new Float32Array(9),yr=new Float32Array(16),kr=[0,0],pn=new Float32Array(9);const yn=hv(ht,ir,ar,yr,pn,Wt||[0,0],o.ah(p.transform.zoom),kr,tr,Ct||1,ut,u,Vt,P?u.paint.get("raster-elevation"):0,2,lt,yt,$.range,Fe,tt,W),bn=p.isTileAffectedByFog(Ce),xi=p.getOrCreateProgram("raster",{defines:$.defines,overrideFog:bn});if(p.uploadCommonUniforms(L,xi,Oe),V instanceof o.aP){const Cr=V.elevatedGlobeVertexBuffer,zr=V.elevatedGlobeIndexBuffer;if(ee||!S)V.boundsBuffer&&V.boundsSegments&&xi.draw(p,N.TRIANGLES,Le,br.disabled,re,dr.disabled,yn,u.id,V.boundsBuffer,p.quadTriangleIndexBuffer,V.boundsSegments);else if(Cr&&zr){const Hr=qt.zoom<=o.cL?V.elevatedGlobeSegments:V.getSegmentsForLongitude(qt.center.lng);Hr&&xi.draw(p,N.TRIANGLES,Le,br.disabled,re,Te,yn,u.id,Cr,zr,Hr)}}else if(O){Le=new Gt(N.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D);const Cr=p.globeSharedBuffers;if(Cr){const[zr,Hr,Wn]=Cr.getGridBuffers(jn,!1);xi.draw(p,N.TRIANGLES,Le,we||Ye,p.colorModeForRenderPass(),Te,yn,u.id,zr,Hr,Wn)}}else{const{tileBoundsBuffer:Cr,tileBoundsIndexBuffer:zr,tileBoundsSegments:Hr}=p.getTileBoundsBuffers(Ve);xi.draw(p,N.TRIANGLES,Le,Ye,re,dr.disabled,yn,u.id,Cr,zr,Hr)}}if(!(V instanceof o.aP)&&O)for(const Ce of Ae){const Oe=Ce.canonical.y===(1<<Ce.canonical.z)-1;Ce.canonical.y===0&&zf(!0,Ce,p,s,u,W,$,Te,we||br.disabled),Oe&&zf(!1,Ce,p,s,u,W,$,Te===dr.frontCW?dr.backCW:dr.frontCW,we||br.disabled)}};O?Pe(_e,p.renderElevatedRasterBackface?dr.backCW:dr.frontCW,p.stencilModeFor3D()):Pe(_e,dr.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,s,u,m,v,x){p.renderPass==="offscreen"&&function(S,P,O,L){if(!L.length)return;const N=S.context,V=N.gl,$=P.getSource();if(!($ instanceof gc))return;const W=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let re=O.particlePositionRGBAImage;if(!re||re.width!==W){const _e=function(be){const Pe=be*be,Ae=new Uint8Array(4*Pe),Te=function(Ce){return Ce|=0,Ce=Math.imul(2747636419^Ce,2654435769),Ce=Math.imul(Ce^Ce>>>16,2654435769),((Ce=Math.imul(Ce^Ce>>>16,2654435769))>>>0)/4294967296},we=1/1.1;for(let Ce=0;Ce<Pe;Ce++){const Oe=we*(Te(2*Ce+0)+Sc),Ve=we*(Te(2*Ce+1)+Sc),Ge=255*Oe%1,at=255*Ve%1,lt=Ge,yt=Ve-at/255,Fe=at;Ae[4*Ce+0]=255*(Oe-Ge/255),Ae[4*Ce+1]=255*lt,Ae[4*Ce+2]=255*yt,Ae[4*Ce+3]=255*Fe}return Ae}(W);re=O.particlePositionRGBAImage=new o.r({width:W,height:W},_e)}let ee=O.particleFramebuffer;ee?ee.width!==W&&(ee.destroy(),ee=O.particleFramebuffer=N.createFramebuffer(W,W,!0,null)):ee=O.particleFramebuffer=N.createFramebuffer(W,W,!0,null);const ie=[];for(const _e of L){const be=P.getTile(_e);if(!(be instanceof lh))continue;const Pe=oP(be,$,O);if(!Pe)continue;const Ae=[be.tileSize,be.tileSize];let Te=O.tileFramebuffer;Te||(Te=O.tileFramebuffer=N.createFramebuffer(Ae[0],Ae[1],!0,null));let we=be.rasterParticleState;we||(we=be.rasterParticleState=new Rb(N,_e,Ae,re));const Ce=we.update(O.lastInvalidatedAt);we.particleTextureDimension!==W&&we.updateParticleTexture(_e,re);const Oe=we.targetColorTexture;we.targetColorTexture=we.backgroundColorTexture,we.backgroundColorTexture=Oe;const Ve=we.particleTexture0;we.particleTexture0=we.particleTexture1,we.particleTexture1=Ve,ie.push([_e,Pe,we,Ce])}if(ie.length===0)return;const ae=o.q.now(),ce=O.previousDrawTimestamp?.001*(ae-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=ae,O.hasColorMap()){N.activeTexture.set(V.TEXTURE0+2);let _e=O.colorRampTexture;_e||(_e=O.colorRampTexture=new o.T(N,O.colorRamp,V.RGBA8)),_e.bind(V.LINEAR,V.CLAMP_TO_EDGE)}N.bindFramebuffer.set(O.tileFramebuffer.framebuffer),function(_e,be,Pe){const Ae=_e.context,Te=Ae.gl,we=be.tileFramebuffer;Ae.activeTexture.set(Te.TEXTURE0);const Ce={u_texture:0,u_opacity:1.05*(Ve=be.paint.get("raster-particle-fade-opacity-factor"))/(Ve+.05)},Oe=_e.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ve;for(const Ge of Pe){const[,,at,lt]=Ge;we.colorAttachment.set(at.targetColorTexture.texture),Ae.viewport.set([0,0,we.width,we.height]),Ae.clear({color:o.am.transparent}),lt&&(at.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Oe.draw(_e,Te.TRIANGLES,Gt.disabled,br.disabled,$r.alphaBlended,dr.disabled,Ce,be.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments))}}(S,O,ie),function(_e,be,Pe,Ae){const Te=_e.context,we=Te.gl,Ce=Pe.tileFramebuffer,Oe=_e.transform.projection.name==="globe",Ve=Pe.paint.get("raster-particle-max-speed");for(const Ge of Ae){const[at,lt,yt]=Ge;Te.activeTexture.set(we.TEXTURE0+0),lt.texture.bind(we.LINEAR,we.CLAMP_TO_EDGE),Ce.colorAttachment.set(yt.targetColorTexture.texture);const Fe=_e.getOrCreateProgram("rasterParticleDraw",{defines:lt.defines,overrideFog:!1});Te.activeTexture.set(we.TEXTURE0+1);const tt=lt.scalarData?[]:[0,1,2,3].map(Ye=>o.dT[Ye](at));tt.push(at);const Le=at.canonical.x,ht=at.canonical.y;for(const Ye of tt){const gt=be.getTile(Oe?Ye.wrapped():Ye);if(!gt)continue;const Ot=gt.rasterParticleState;if(!Ot)continue;const ut=Ye.canonical.x+(1<<Ye.canonical.z)*(Ye.wrap-at.wrap),Ct=Ye.canonical.y;Ot.particleTexture0.bind(we.NEAREST,we.CLAMP_TO_EDGE);const Wt=Ab(1,Ot.particleTexture0.size[0],[ut-Le,Ct-ht],0,lt.texture.size,2,Ve,lt.textureOffset,lt.scale,lt.offset);Fe.draw(_e,we.POINTS,Gt.disabled,br.disabled,$r.alphaBlended,dr.disabled,Wt,Pe.id,Ot.particleIndexBuffer,void 0,Ot.particleSegment)}}}(S,P,O,ie),N.bindFramebuffer.set(O.particleFramebuffer.framebuffer),function(_e,be,Pe,Ae){const Te=_e.context,we=Te.gl,Ce=be.paint.get("raster-particle-max-speed"),Oe=Ae*be.paint.get("raster-particle-speed-factor")*.15,Ve=function(at){return Math.pow(at,6)}(.01+1*be.paint.get("raster-particle-reset-rate-factor")),Ge=be.particleFramebuffer;Te.viewport.set([0,0,Ge.width,Ge.height]);for(const at of Pe){const[,lt,yt]=at;Te.activeTexture.set(we.TEXTURE0+0),lt.texture.bind(we.LINEAR,we.CLAMP_TO_EDGE),Te.activeTexture.set(we.TEXTURE0+1);const Fe=yt.particleTexture0;Fe.bind(we.NEAREST,we.CLAMP_TO_EDGE);const tt=Tc(1,Fe.size[0],0,lt.texture.size,Ce,Oe,Ve,lt.textureOffset,lt.scale,lt.offset);Ge.colorAttachment.set(yt.particleTexture1.texture),Te.clear({color:o.am.transparent}),_e.getOrCreateProgram("rasterParticleUpdate",{defines:lt.defines}).draw(_e,we.TRIANGLES,Gt.disabled,br.disabled,$r.unblended,dr.disabled,tt,be.id,_e.viewportBuffer,_e.quadTriangleIndexBuffer,_e.viewportSegments)}}(S,O,ie,ce)}(p,s,u,m),p.renderPass==="translucent"&&(function(S,P,O,L,N){const V=S.context,$=V.gl,W=P.getSource().tileSize,re=5*(1-o.af(o.cx,o.cx+1,S.transform.zoom))*W+O.paint.get("raster-particle-elevation"),ee=!S.options.moving,ie=S.transform.projection.name==="globe";if(!L.length)return;const[ae,ce]=S.stencilConfigForOverlap(L),_e=[];ie&&_e.push("PROJECTION_GLOBE_VIEW");const be=S.stencilModeFor3D();for(const Pe of ce){const Ae=Pe.toUnwrapped(),Te=P.getTile(Pe);if(!Te.rasterParticleState)continue;const we=Te.rasterParticleState,Ce=100;Te.registerFadeDuration(Ce);const Oe=P.findLoadedParent(Pe,0),Ve=yu(Te,Oe,P,S.transform,Ce);let Ge,at;S.terrain&&S.terrain.prepareDrawTile(),V.activeTexture.set($.TEXTURE0),we.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),V.activeTexture.set($.TEXTURE1),Oe&&Oe.rasterParticleState?(Oe.rasterParticleState.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Ge=Math.pow(2,Oe.tileID.overscaledZ-Te.tileID.overscaledZ),at=[Te.tileID.canonical.x*Ge%1,Te.tileID.canonical.y*Ge%1]):we.targetColorTexture.bind($.LINEAR,$.CLAMP_TO_EDGE);const lt=ie?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ae,ee),yt=S.transform,Fe=kb(yt),tt=o.dn(Pe.canonical),Le=o.dp(tt.getCenter().lat);let ht,Ye,gt,Ot,ut;ie?(ht=Float32Array.from(o.bh(o.dr(Pe.canonical))),Ye=Float32Array.from(yt.globeMatrix),gt=Float32Array.from(o.dm(yt)),Ot=[o.aD(yt.center.lng),o.aH(yt.center.lat)],ut=Float32Array.from(o.dq(Pe.canonical,tt,Le,yt.worldSize/yt._pixelsPerMercatorPixel))):(ht=new Float32Array(16),Ye=new Float32Array(9),gt=new Float32Array(16),Ot=[0,0],ut=new Float32Array(9));const Ct=bu(lt,ht,Ye,gt,ut,at||[0,0],o.ah(S.transform.zoom),Ot,Fe,Ge||1,Ve,re),Wt=S.isTileAffectedByFog(Pe),qt=S.getOrCreateProgram("rasterParticle",{defines:_e,overrideFog:Wt});if(S.uploadCommonUniforms(V,qt,Ae),ie){const Vt=new Gt($.LEQUAL,Gt.ReadOnly,S.depthRangeFor3D),tr=0,ir=S.globeSharedBuffers;if(ir){const[ar,yr,kr]=ir.getGridBuffers(Le,tr!==0);qt.draw(S,$.TRIANGLES,Vt,be,$r.alphaBlended,S.renderElevatedRasterBackface?dr.frontCCW:dr.backCCW,Ct,O.id,ar,yr,kr)}}else{const Vt=S.depthModeForSublayer(0,Gt.ReadOnly),tr=ae[Pe.overscaledZ],{tileBoundsBuffer:ir,tileBoundsIndexBuffer:ar,tileBoundsSegments:yr}=S.getTileBoundsBuffers(Te);qt.draw(S,$.TRIANGLES,Vt,tr,$r.alphaBlended,dr.disabled,Ct,O.id,ir,ar,yr)}}S.resetStencilClippingMasks()}(p,s,u,m),p.style.map.triggerRepaint())},background:function(p,s,u,m){const v=u.paint.get("background-color"),x=u.paint.get("background-color-use-theme").constantOr("default")==="none",S=u.paint.get("background-opacity"),P=u.paint.get("background-emissive-strength"),O=u.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const L=p.context,N=L.gl,V=p.transform,$=V.tileSize,W=u.paint.get("background-pattern");let re;if(W!==void 0&&(W===null||(re=p.imageManager.getPattern(o.I.from(W.toString()),u.scope,p.style.getLut(u.scope)),!re)))return;const ee=!W&&v.a===1&&S===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==ee)return;const ie=br.disabled,ae=p.depthModeForSublayer(0,ee==="opaque"?Gt.ReadWrite:Gt.ReadOnly),ce=p.colorModeForDrapableLayerRenderPass(P),_e=W?"backgroundPattern":"background";let be,Pe=m;if(Pe||(be=p.getBackgroundTiles(),Pe=Object.values(be).map(Ae=>Ae.tileID)),W&&(L.activeTexture.set(N.TEXTURE0),p.imageManager.bind(p.context,u.scope)),O){const Ae=p.getOrCreateProgram(_e,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(o.bx([])),we=new o.aM(0,0,0,0,0),Ce=W?fv(Te,P,S,p,0,u.scope,re,O,{tileID:we,tileSize:$}):dv(Te,P,S,v.toPremultipliedRenderColor(x?null:u.lut));Ae.draw(p,N.TRIANGLES,ae,ie,ce,dr.disabled,Ce,u.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const Ae of Pe){const Te=p.isTileAffectedByFog(Ae),we=p.getOrCreateProgram(_e,{overrideFog:Te}),Ce=Ae.toUnwrapped(),Oe=m?Ae.projMatrix:p.transform.calculateProjMatrix(Ce);p.prepareDrawTile();const Ve=s?s.getTile(Ae):be?be[Ae.key]:new ou(Ae,$,V.zoom,p),Ge=W?fv(Oe,P,S,p,0,u.scope,re,O,{tileID:Ae,tileSize:$}):dv(Oe,P,S,v.toPremultipliedRenderColor(x?null:u.lut));p.uploadCommonUniforms(L,we,Ce);const{tileBoundsBuffer:at,tileBoundsIndexBuffer:lt,tileBoundsSegments:yt}=p.getTileBoundsBuffers(Ve);we.draw(p,N.TRIANGLES,ae,ie,ce,dr.disabled,Ge,u.id,at,lt,yt)}},sky:function(p,s,u){const m=p._atmosphere?o.ah(p.transform.zoom):1,v=u.paint.get("sky-opacity")*m;if(v===0)return;const x=p.context,S=u.paint.get("sky-type"),P=new Gt(x.gl.LEQUAL,Gt.ReadOnly,[0,1]),O=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?u.needsSkyboxCapture(p)&&(function(L,N,V,$){const W=L.context,re=W.gl;let ee=N.skyboxFbo;if(!ee){ee=N.skyboxFbo=W.createFramebuffer(32,32,!0,null),N.skyboxGeometry=new Nf(W),N.skyboxTexture=W.gl.createTexture(),re.bindTexture(re.TEXTURE_CUBE_MAP,N.skyboxTexture),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_CUBE_MAP,re.TEXTURE_MAG_FILTER,re.LINEAR);for(let _e=0;_e<6;++_e)re.texImage2D(re.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0,re.RGBA,32,32,0,re.RGBA,re.UNSIGNED_BYTE,null)}W.bindFramebuffer.set(ee.framebuffer),W.viewport.set([0,0,32,32]);const ie=N.getCenter(L,!0),ae=L.getOrCreateProgram("skyboxCapture"),ce=new Float64Array(16);o.bx(ce),o.e3(ce,ce,.5*-Math.PI),Pc(L,N,ae,ce,ie,0),o.bx(ce),o.e3(ce,ce,.5*Math.PI),Pc(L,N,ae,ce,ie,1),o.bx(ce),o.cG(ce,ce,.5*-Math.PI),Pc(L,N,ae,ce,ie,2),o.bx(ce),o.cG(ce,ce,.5*Math.PI),Pc(L,N,ae,ce,ie,3),o.bx(ce),Pc(L,N,ae,ce,ie,4),o.bx(ce),o.e3(ce,ce,Math.PI),Pc(L,N,ae,ce,ie,5),W.viewport.set([0,0,L.width,L.height])}(p,u),u.markSkyboxValid(p)):p.renderPass==="sky"&&function(L,N,V,$,W){const re=L.context,ee=re.gl,ie=L.transform,ae=L.getOrCreateProgram("skybox");re.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,N.skyboxTexture);const ce=((_e,be,Pe,Ae,Te)=>({u_matrix:_e,u_sun_direction:be,u_cubemap:0,u_opacity:Ae,u_temporal_offset:Te}))(ie.skyboxMatrix,N.getCenter(L,!1),0,$,W);L.uploadCommonUniforms(re,ae),ae.draw(L,ee.TRIANGLES,V,br.disabled,L.colorModeForRenderPass(),dr.backCW,ce,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,u,P,v,O):S==="gradient"&&p.renderPass==="sky"&&function(L,N,V,$,W){const re=L.context,ee=re.gl,ie=L.transform,ae=L.getOrCreateProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new Nf(re)),re.activeTexture.set(ee.TEXTURE0);let ce=N.colorRampTexture;ce||(ce=N.colorRampTexture=new o.T(re,N.colorRamp,ee.RGBA8)),ce.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const _e=((be,Pe,Ae,Te,we)=>({u_matrix:be,u_color_ramp:0,u_center_direction:Pe,u_radius:o.al(Ae),u_opacity:Te,u_temporal_offset:we}))(ie.skyboxMatrix,N.getCenter(L,!1),N.paint.get("sky-gradient-radius"),$,W);L.uploadCommonUniforms(re,ae),ae.draw(L,ee.TRIANGLES,V,br.disabled,L.colorModeForRenderPass(),dr.backCW,_e,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,u,P,v,O)},custom:function(p,s,u,m){const v=p.context,x=u.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&u.isDraped(s)){if(p.renderPass==="offscreen"){const S=x.prerender;if(S){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const P=p.transform.pointMerc;S.call(x,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.ah(p.transform.zoom),[P.x,P.y],p.transform.pixelsPerMeterRatio)}else S.call(x,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const P=x.renderToTile;if(P){const O=m[0].canonical,L={x:O.x+m[0].wrap*(x.wrapTileId?0:1<<O.z),y:O.y,z:O.z};v.setDepthMode(Gt.disabled),v.setStencilMode(br.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),P.call(x,v.gl,L),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(br.disabled);const S=x.renderingMode==="3d"?new Gt(p.context.gl.LEQUAL,Gt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Gt.ReadOnly);if(v.setDepthMode(S),p.transform.projection.name==="globe"){const P=p.transform.pointMerc;x.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.ah(p.transform.zoom),[P.x,P.y],p.transform.pixelsPerMeterRatio)}else x.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,s,u,m){if(p.renderPass==="opaque")return;const v=u.paint.get("model-opacity").constantOr(1);if(v===0)return;const x=u.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!x||p.terrain&&v<.65&&u._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const S=p.shadowRenderer,P=u.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,P||(S.enabled=!1));const O=()=>{S&&(S.useNormalOffset=!0,P||(S.enabled=!0))},L=s.getSource();if(p.renderPass==="light-beam"&&L.type!=="batched-model")return;if(L.type==="vector"||L.type==="geojson")return function(ae,ce,_e,be,Pe){const Ae=ae.transform;if(Ae.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Ae.projection.name} projection is not yet implemented`);const Te=Ae.getFreeCameraOptions().position;if(!ae.modelManager)return;const we=ae.modelManager;_e.modelManager=we;const Ce=ae.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Oe=_e._unevaluatedLayout._values["model-id"],Ve=Object.assign({},_e.layout.get("model-id").parameters),Ge=ae.style.order.indexOf(_e.fqid);for(const at of be){const lt=ce.getTile(at).getBucket(_e);if(!lt||lt.projection.name!==Ae.projection.name)continue;const yt=lt.getModelUris();yt&&!lt.modelsRequested&&(we.addModelsFromBucket(yt,Pe),lt.modelsRequested=!0);const Fe=Km(at,Ae);Ve.zoom=Fe;const tt=Oe.possiblyEvaluate(Ve);if(Be(ae,lt,at),Pa.shadowUniformsInitialized=!1,Pa.useSingleShadowCascade=!!Ce&&Ce.getMaxCascadeForTile(at.toUnwrapped())===0,ae.renderPass==="shadow"&&Ce){if(ae.currentShadowCascade===1&&lt.isInsideFirstShadowMapFrustum)continue;const Ye=Ae.calculatePosMatrix(at.toUnwrapped(),Ae.worldSize);if(Pa.tileMatrix.set(Ye),Pa.shadowTileMatrix=Float32Array.from(Ce.calculateShadowPassMatrixFromMatrix(Ye)),Pa.aabb.min.fill(0),Pa.aabb.max[0]=Pa.aabb.max[1]=o.aj,Pa.aabb.max[2]=0,jb(lt,Pa,ae,_e.scope))continue}const Le=1<<at.canonical.z,ht=[((Te.x-at.wrap)*Le-at.canonical.x)*o.aj,(Te.y*Le-at.canonical.y)*o.aj,Te.z*Le*o.aj];ae.conflationActive&&Object.keys(lt.instancesPerModel).length>0&&ae.style.isLayerClipped(_e,ce.getSource())&&lt.updateReplacement(at,ae.replacementSource,Ge,Pe)&&(lt.uploaded=!1,lt.upload(ae.context));for(let Ye in lt.instancesPerModel){const gt=lt.instancesPerModel[Ye];gt.features.length>0&&(Ye=tt.evaluate(gt.features[0].feature,{}));const Ot=we.getModel(Ye,Pe);if(Ot||we.hasURLBeenRequested(Ye)||lt.modelUris.includes(Ye)||(lt.modelUris.push(Ye),lt.modelsRequested=!1),Ot&&Ot.uploaded)for(const ut of Ot.nodes)Ym(ae,_e,ut,gt,ht,at,Pa)}}}(p,s,u,m,L.type==="vector"?u.scope:""),void O();if(!L.loaded())return;if(L.type==="batched-model")return function(ae,ce,_e,be){_e.resetLayerRenderingStats(ae);const Pe=ae.context,Ae=ae.transform,Te=ae.style.fog,we=ae.shadowRenderer;if(Ae.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Ae.projection.name} projection is not yet implemented`);const Ce=ae.transform.getFreeCameraOptions().position,Oe=o.bY([],[Ce.x,Ce.y,Ce.z],ae.transform.worldSize),Ve=o.eb([],Oe),Ge=o.bx([]),at=o.ec(Ae.center.lat,Ae.zoom),lt=o.bn([],[1,1,1/at]);o.bo(Ge,Ge,Ve);const yt=_e.paint.get("model-opacity").constantOr(1),Fe=new Gt(Pe.gl.LEQUAL,Gt.ReadWrite,ae.depthRangeFor3D),tt=new Gt(Pe.gl.LEQUAL,Gt.ReadOnly,ae.depthRangeFor3D),Le=new o.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ht=ae.renderPass==="shadow",Ye=ht&&we?we.getCurrentCascadeFrustum():Ae.getFrustum(Ae.scaleZoom(Ae.worldSize)),gt=_e.paint.get("model-front-cutoff"),Ot=gt[2]<1,ut=Ya(ae,_e.paint.get("model-cutoff-fade-range")),Ct=_e.getLayerRenderingStats();(function(Wt,qt,Vt,tr){const ir=Wt.terrain?Wt.terrain.exaggeration():0,ar=Wt.transform.zoom;for(const yr of tr){const kr=qt.getTile(yr).getBucket(Vt);kr&&(kr.setFilter(Vt.filter),Wt.conflationActive&&kr.updateReplacement(yr,Wt.replacementSource),kr.evaluateTransform(Wt,Vt),Wt.terrain&&ir>0&&kr.elevationUpdate(Wt.terrain,ir,yr,Vt.source),kr.needsReEvaluation(Wt,ar,Vt)&&kr.evaluate(Vt))}})(ae,ce,_e,be),function(){let Wt,qt,Vt;Ot?(Wt=be.length-1,qt=-1,Vt=-1):(Wt=0,qt=be.length,Vt=1);const tr=new Float64Array(16),ir=o.ef(),ar=new o.P(0,0);for(let yr=Wt;yr!==qt;yr+=Vt){const kr=be[yr],pn=ce.getTile(kr).getBucket(_e);if(!pn||!pn.uploaded)continue;let jn=!1;we&&(jn=we.getMaxCascadeForTile(kr.toUnwrapped())===0);const yn=Ae.calculatePosMatrix(kr.toUnwrapped(),Ae.worldSize),bn=pn.modelTraits;!ht&&Ot&&(o.bi(tr,yn),o.ad(ir,Oe,tr),ar.x=ir[0],ar.y=ir[1]);const xi=[];pn.setFilter(_e.filter);for(const Cr of pn.getNodesInfo()){if(Cr.hiddenByReplacement||!Cr.node.meshes)continue;const zr=Cr.node;let Hr=0;ae.terrain&&zr.elevation&&(Hr=zr.elevation*ae.terrain.exaggeration());const Wn=(()=>{const gi=Cr.aabb;return Le.min=[...gi.min],Le.max=[...gi.max],Le.min[2]+=Hr,Le.max[2]+=Hr,o.ad(Le.min,Le.min,yn),o.ad(Le.max,Le.max,yn),Le})(),$i=Cr.evaluatedScale;if($i[0]<=1&&$i[1]<=1&&$i[2]<=1&&Wn.intersects(Ye)===0)continue;if(!ht&&Ot){const gi=.16666666666666666;Cr.cameraCollisionOpacity=Oe[0]>Wn.min[0]&&Oe[0]<Wn.max[0]&&Oe[1]>Wn.min[1]&&Oe[1]<Wn.max[1]&&Oe[2]*at<Wn.max[2]&&zr.footprint&&o.bS(ar,zr.footprint)?Math.max(Cr.cameraCollisionOpacity-gi,0):Math.min(1,Cr.cameraCollisionOpacity+gi)}const Fn=[...yn],an=1/o.cU(kr.canonical),fi=zr.anchor?zr.anchor[0]:0,Jr=zr.anchor?zr.anchor[1]:0;o.bo(Fn,Fn,[fi*($i[0]-1)+Cr.evaluatedTranslation[0]*an,Jr*($i[1]-1)+Cr.evaluatedTranslation[1]*an,Hr+Cr.evaluatedTranslation[2]]),o.ci($i,o.eg)||o.cE(Fn,Fn,$i);const Di=o.az([],Fn,zr.matrix),qn=o.az([],Ae.expandedFarZProjMatrix,Di),Mn=o.az([],Ae.expandedFarZProjMatrix,Fn),Zn=o.aA([],[fi,Jr,Hr,1],qn)[2];zr.hidden=!1;let cn=yt;ht||(Ot&&(cn*=Cr.cameraCollisionOpacity,cn*=Rh(Fn,Ae,Cr.aabb,gt)),cn*=Fb(ut,Zn)),cn!==0?xi.push({nodeInfo:Cr,depth:Zn,opacity:cn,wvpForNode:qn,wvpForTile:Mn,nodeModelMatrix:Di,tileModelMatrix:Fn}):zr.hidden=!0}ht||xi.sort((Cr,zr)=>!Ot||Cr.opacity===1&&zr.opacity===1?Cr.depth<zr.depth?-1:1:Cr.opacity===1?-1:zr.opacity===1?1:Cr.depth>zr.depth?-1:1);for(const Cr of xi){const zr=Cr.nodeInfo,Hr=zr.node;let Wn=o.az([],lt,Cr.tileModelMatrix);o.az(Wn,Ge,Wn);const $i=o.bi([],Wn);o.ee($i,$i),o.cE($i,$i,vv),Wn=o.az(Wn,Wn,Hr.matrix);const Fn=ae.renderPass==="light-beam",an=_e.paint.get("model-color-use-theme").constantOr("default")==="none",fi=bn&o.em.HasMapboxMeshFeatures,Jr=fi?0:zr.evaluatedRMEA[0][2];for(let Di=0;Di<Hr.meshes.length;++Di){const qn=Hr.meshes[Di],Mn=Di===Hr.lightMeshIndex;let Zn=Cr.wvpForNode;if(Mn){if(!Fn&&!ae.terrain&&ae.shadowRenderer){ae.currentLayer<ae.firstLightBeamLayer&&(ae.firstLightBeamLayer=ae.currentLayer);continue}Zn=Cr.wvpForTile}else if(Fn)continue;const cn={defines:[]},gi=[];if(!ht&&we&&(we.useNormalOffset=!!qn.normalBuffer),Tt(cn.defines,gi,qn,ae,an?null:_e.lut),fi||cn.defines.push("DIFFUSE_SHADED"),jn&&cn.defines.push("SHADOWS_SINGLE_CASCADE"),Ct&&(ht?Ct.numRenderedVerticesInShadowPass+=qn.vertexArray.length:Ct.numRenderedVerticesInTransparentPass+=qn.vertexArray.length),ht){di(qn,Cr.nodeModelMatrix,ae,_e);continue}let Eo=null;if(Te){const Ia=Su(Cr.nodeModelMatrix,ae.transform);if(Eo=new Float32Array(Ia),Ae.projection.name!=="globe"){const ua=qn.aabb.min,fs=qn.aabb.max,[kc,Oa]=Te.getOpacityForBounds(Ia,ua[0],ua[1],fs[0],fs[1]);cn.overrideFog=kc>=Qe||Oa>=Qe}}const ei=qn.material;let on;ei.occlusionTexture&&ei.occlusionTexture.offsetScale&&(on=ei.occlusionTexture.offsetScale,cn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ts=ae.getOrCreateProgram("model",cn);!ht&&we&&we.setupShadowsFromMatrix(Cr.tileModelMatrix,Ts,we.useNormalOffset),ae.uploadCommonUniforms(Pe,Ts,null,Eo);const ds=ei.pbrMetallicRoughness;ds.metallicFactor=.9,ds.roughnessFactor=.5;const Gs=kf(new Float32Array(Zn),new Float32Array(Wn),new Float32Array($i),new Float32Array(Hr.matrix),ae,Cr.opacity,ds.baseColorFactor,ei.emissiveFactor,ds.metallicFactor,ds.roughnessFactor,ei,Jr,_e,[0,0,0],on);!Mn&&(zr.hasTranslucentParts||Cr.opacity<1)&&Ts.draw(ae,Pe.gl.TRIANGLES,Fe,br.disabled,$r.disabled,dr.backCCW,Gs,_e.id,qn.vertexBuffer,qn.indexBuffer,qn.segments,_e.paint,ae.transform.zoom,void 0,gi),Ts.draw(ae,Pe.gl.TRIANGLES,Mn?tt:Fe,br.disabled,Mn||Cr.opacity<1||zr.hasTranslucentParts?$r.alphaBlended:$r.unblended,dr.backCCW,Gs,_e.id,qn.vertexBuffer,qn.indexBuffer,qn.segments,_e.paint,ae.transform.zoom,void 0,gi)}}}}()}(p,s,u,m),void O();if(L.type!=="model")return;const N=L.getModels(),V=[],$=p.transform.getFreeCameraOptions().position,W=o.bY([],[$.x,$.y,$.z],p.transform.worldSize);o.eb(W,W);const re=[],ee=[];let ie=0;for(const ae of N){const ce=u.paint.get("model-rotation").constantOr(null),_e=u.paint.get("model-scale").constantOr(null),be=u.paint.get("model-translation").constantOr(null);ae.computeModelMatrix(p,ce,_e,be,!0,!0,!1);const Pe=o.bx([]),Ae=o.ec(ae.position.lat,p.transform.zoom),Te=o.bn([],[1,1,1/Ae]);o.bo(Pe,Pe,W),V.push({zScaleMatrix:Te,negCameraPosMatrix:Pe});for(const we of ae.nodes)Tu(p.transform,we,ae.matrix,p.transform.expandedFarZProjMatrix,ie,re,ee);ie++}if(re.sort((ae,ce)=>ce.depth-ae.depth),p.renderPass!=="shadow"){if(v===1)for(const ae of ee)$t(ae,p,u,V[ae.modelIndex],br.disabled,p.colorModeForRenderPass());else{for(const ae of ee)$t(ae,p,u,V[ae.modelIndex],br.disabled,$r.disabled);for(const ae of ee)$t(ae,p,u,V[ae.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const ae of re)$t(ae,p,u,V[ae.modelIndex],br.disabled,p.colorModeForRenderPass());O()}else{for(const ae of ee)di(ae.mesh,ae.nodeModelMatrix,p,u);for(const ae of re)di(ae.mesh,ae.nodeModelMatrix,p,u);O()}}},Sv={line:function(p,s,u){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(s){const m=s.getVisibleCoordinates();for(const v of m){const x=s.getTile(v).getBucket(p);if(x&&(x.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,s,u){const m=s.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(u.modelManager&&u.modelManager.upload(u,m.type==="vector"?p.scope:""));if(m.type==="batched-model"||m.type!=="model")return;const v=m.getModels();for(const x of v)x.upload(u.context)},raster:function(p,s,u){const m=s.getSource();if(!(m instanceof gc&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const x=p.paint.get("raster-array-band")||m.getInitialBand(v);if(x==null)return;const S=s.getIds().map(P=>s.getTileByID(P));for(const P of S)P.updateNeeded(v,x)&&m.prepareTile(P,v,x)},"raster-particle":function(p,s,u){const m=s.getSource();if(!(m instanceof gc&&m.loaded()))return;const v=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!v)return;const x=p.paint.get("raster-particle-array-band")||m.getInitialBand(v);if(x==null)return;const S=s.getIds().map(P=>s.getTileByID(P));for(const P of S)P.updateNeeded(v,x)&&m.prepareTile(P,v,x)}},Nl={fill:mv},Bf={fill:function(p,s,u,m){if(!u.layout||u.layout.get("fill-elevation-reference")==="none")return;const v=p.context.gl,x=new Gt(v.LEQUAL,Gt.ReadOnly,p.depthRangeFor3D),S=new br({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),P=p.transform.getFreeCameraOptions().position,O=p.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const L of m){const N=s.getTile(L),V=N.getBucket(u);if(!V)continue;const $=V.elevatedStructures;if(!$||$.maskSegments.segments[0].primitiveLength===0)continue;const W=qm(L.toUnwrapped(),P),re=p.translatePosMatrix(L.projMatrix,N,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor")),ee=Vm(re,W,0,0,0);O.draw(p,v.TRIANGLES,x,S,$r.disabled,dr.disabled,ee,u.id,$.vertexBuffer,$.indexBuffer,$.maskSegments,u.paint,p.transform.zoom)}}};class kh{constructor(s,u,m,v,x,S){this.context=new rP(s,u),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=x,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const P=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const L of P)this._debugParams.enabledLayers[L]=!0;x.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),x.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),x.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),x.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),x.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const L of P)x.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],L);this.occlusionParams=new Bb(x),this.setup(),this.numSublayers=us.maxUnderzooming+us.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new LA(this),this._wireframeDebugCache=new uP,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const O=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,O,s.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=v,this.worldview=S}updateTerrain(s,u){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Cf(this,s));const v=this._terrain;this.transform.elevation=m?v:null,v.update(s,this.transform,u),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(s){const u=s.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,v]=u.getFovAdjustedRange(this.transform._fov);if(m>v)return void(this.transform.fogCullDistSq=null);const x=m+.78*(v-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(s){s&&!this._terrain&&(this._terrain=new Cf(this,this.style)),this._forceTerrainMode=s}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(s,u){if(this.width=s*o.q.devicePixelRatio,this.height=u*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const s=this.context,u=new o.ba;u.emplaceBack(0,0),u.emplaceBack(o.aj,0),u.emplaceBack(0,o.aj),u.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=s.createVertexBuffer(u,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const m=new o.ba;m.emplaceBack(0,0),m.emplaceBack(o.aj,0),m.emplaceBack(0,o.aj),m.emplaceBack(o.aj,o.aj),this.debugBuffer=s.createVertexBuffer(m,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const v=new o.ba;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(v,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const x=new o.aZ;x.emplaceBack(0,0,0,0),x.emplaceBack(o.aj,0,o.aj,0),x.emplaceBack(0,o.aj,0,o.aj),x.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=s.createVertexBuffer(x,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const S=new o.a_;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(S);const P=new o.bb;for(const L of[0,1,3,2,0])P.emplaceBack(L);this.debugIndexBuffer=s.createIndexBuffer(P),this.emptyTexture=new o.T(s,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA8),this.identityMat=o.bz();const O=this.context.gl;this.stencilClearMode=new br({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,s.TRIANGLES,Gt.disabled,this.stencilClearMode,$r.disabled,dr.disabled,_u(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,u,m){if(!u||this.currentStencilSource===u.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let P=!1;for(const O of m)if(this._tileClippingMaskIDs[O.key]===void 0){P=!0;break}if(!P)return}this.currentStencilSource=u.id;const v=this.context,x=v.gl;this.nextStencilID+m.length>256&&this.clearStencil(),v.setColorMode($r.disabled),v.setDepthMode(Gt.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of m){const O=u.getTile(P),L=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:V,tileBoundsSegments:$}=this.getTileBoundsBuffers(O);S.draw(this,x.TRIANGLES,Gt.disabled,new br({func:x.ALWAYS,mask:0},L,255,x.KEEP,x.KEEP,x.REPLACE),$r.disabled,dr.disabled,_u(P.projMatrix),"$clipping",N,V,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new br({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const u=this.context.gl;return new br({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){const u=this.context.gl,m=s.sort((S,P)=>P.overscaledZ-S.overscaledZ),v=m[m.length-1].overscaledZ,x=m[0].overscaledZ-v+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const S={};for(let P=0;P<x;P++)S[P+v]=new br({func:u.GEQUAL,mask:255},P+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[S,m]}return[{[v]:br.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new $r([s.CONSTANT_COLOR,s.ONE,s.CONSTANT_COLOR,s.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$r.unblended:$r.alphaBlended}colorModeForDrapableLayerRenderPass(s){const u=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new $r([u.ONE,u.ONE_MINUS_SRC_ALPHA,u.CONSTANT_ALPHA,u.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,s===void 0?0:s),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(s,u,m,v=!1){if(this.depthOcclusion)return new Gt(this.context.gl.GREATER,Gt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!v)return Gt.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Gt(m||this.context.gl.LEQUAL,u,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const s=this.context.gl,u=Math.ceil(this.width),m=Math.ceil(this.height),v=this.context.bindFramebuffer.get(),x=s.getParameter(s.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===u&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),u!==0&&m!==0&&(this.depthFBO=new pv(this.context,u,m,!1,"texture"),this.depthTexture=new o.T(this.context,{width:u,height:m,data:null},s.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(v),s.bindTexture(s.TEXTURE_2D,x),this.depthFBO&&(s.bindFramebuffer(s.READ_FRAMEBUFFER,null),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),s.blitFramebuffer(0,0,u,m,0,0,u,m,s.DEPTH_BUFFER_BIT,s.NEAREST),s.bindFramebuffer(s.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((s,u)=>s+u/this._fpsHistory.length,0))}render(s,u){const m=o.q.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=s.map.repaint,this.style=s,this.options=u;const v=this.style._mergedLayers,x=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(x).filter(Fe=>{const tt=v[Fe];return!(tt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[tt.type]});let P=S(),O=!1,L=!1;for(const Fe of P){const tt=v[Fe];tt.type==="circle"&&(O=!0),tt.type==="symbol"&&(tt.hasInitialOcclusionOpacityProperties?L=!0:O=!0)}let N=P.map(Fe=>v[Fe]);const V=this.style._mergedSourceCaches;this.imageManager=s.imageManager,this.modelManager=s.modelManager,this.symbolFadeChange=s.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let $=0,W=!1;for(const Fe in V){const tt=V[Fe];tt.used&&(tt.prepare(this.context),tt.getSource().usedInConflation&&++$)}let re=!1;for(const Fe of N)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(re=!0),this.prepareLayer(Fe));const ee={},ie={},ae={},ce={},_e={};for(const Fe in V){const tt=V[Fe];ee[Fe]=tt.getVisibleCoordinates(),ie[Fe]=ee[Fe].slice().reverse(),ae[Fe]=tt.getVisibleCoordinates(!0).reverse(),ce[Fe]=tt.getShadowCasterCoordinates(),_e[Fe]=tt.sortCoordinatesByDistance(ee[Fe])}const be=Fe=>{const tt=this.style.getLayerSourceCache(Fe);return tt&&tt.used?tt.getSource():null};if($||re||this._clippingActiveLastFrame){const Fe=[],tt=[];let Le=0;for(const ht of N)this.isSourceForClippingOrConflation(ht,be(ht))&&(Fe.push(ht),tt.push(Le)),Le++;if(Fe&&(re||Fe.length>1)||this._clippingActiveLastFrame){re=!1;const ht=[];for(let Ye=0;Ye<Fe.length;Ye++){const gt=Fe[Ye],Ot=tt[Ye],ut=this.style.getLayerSourceCache(gt);if(!ut||!ut.used||!ut.getSource().usedInConflation&&gt.type!=="clip")continue;let Ct=o.eu,Wt=o.bQ.None;const qt=[];let Vt=!0;if(gt.type==="clip"){Ct=Ot;for(const tr of gt.layout.get("clip-layer-types"))Wt|=tr==="model"?o.bQ.Model:tr==="symbol"?o.bQ.Symbol:o.bQ.FillExtrusion;for(const tr of gt.layout.get("clip-layer-scope"))qt.push(tr);gt.isHidden(this.transform.zoom)?Vt=!1:re=!0}Vt&&ht.push({layer:gt.fqid,cache:ut,order:Ct,clipMask:Wt,clipScope:qt})}this.replacementSource.setSources(ht),W=!0}}this._clippingActiveLastFrame=re,W||this.replacementSource.clear(),this.conflationActive=W,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<N.length;Fe++){const tt=N[Fe],Le=tt.cutoffRange();if(this.longestCutoffRange=Math.max(Le,this.longestCutoffRange),Le>0){const ht=be(tt);ht&&(this.minCutoffZoom=Math.max(ht.minzoom,this.minCutoffZoom)),tt.minzoom&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom))}tt.is3D(x)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const Pe=this.style&&this.style.fog;Pe?(this._fogVisible=Pe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Pe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ae),this.opaquePassCutoff=0,P=S(),N=P.map(Fe=>v[Fe]));const Ae=this._shadowRenderer;if(Ae){Ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in V)for(const tt of ee[Fe]){let Le={min:0,max:0};this.terrain&&(Le=this.terrain.getMinMaxForTile(tt)||Le),Ae.addShadowReceiver(tt.toUnwrapped(),Le.min,Le.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Mh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Te=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),we=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Te&&!this._snow&&(this._snow=new Qn(this)),!Te&&this._snow&&(this._snow.destroy(),delete this._snow),we&&!this._rain&&(this._rain=new hP(this)),!we&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!_r.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of N){const tt=s.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Le=tt?ie[tt.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Le&&Le.length)&&this.renderLayer(this,tt,Fe,Le)}this.depthRangeFor3D=[0,1-(N.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ce)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Ce=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Oe=(()=>{if(u.showOverdrawInspector)return o.am.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const tt=this.style.getLut(Fe.scope);if(!Ce){const Le=Fe.properties.get("color-use-theme")==="none",ht=Fe.properties.get("color").toNonPremultipliedRenderColor(Le?null:tt).toArray01();return new o.am(...ht)}if(Ce){const Le=Fe.properties.get("space-color-use-theme")==="none",ht=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Le?null:tt).toArray01();return new o.am(...ht)}}return o.am.transparent})();if(this.context.clear({color:Oe,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=P.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=N[this.currentLayer],tt=s.getLayerSourceCache(Fe);if(Fe.isSky())continue;const Le=tt?(Fe.is3D(x)?_e:ie)[tt.id]:void 0;this._renderTileClippingMasks(Fe,tt,Le),this.renderLayer(this,tt,Fe,Le)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Ce&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<P.length;this.currentLayer++){const Fe=N[this.currentLayer],tt=s.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,tt,Fe,tt?ie[tt.id]:void 0)}function Ve(Fe,tt){let Le;return tt&&(Le=(Fe.type==="symbol"?ae:Fe.is3D(x)?_e:ie)[tt.id]),Le}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<P.length;){const Fe=N[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const tt=s.getLayerSourceCache(Fe);this.renderLayer(this,tt,Fe,Ve(Fe,tt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ge=0;Ae&&(Ge=Ae.getShadowCastingLayerCount());let at=!1,lt=-1;for(let Fe=0;Fe<P.length;++Fe){const tt=N[Fe];tt.isHidden(this.transform.zoom)||tt.is3D(x)&&(lt=Fe)}L&&lt===-1&&(O=!0);let yt=!1;for(;this.currentLayer<P.length;){const Fe=N[this.currentLayer],tt=s.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!yt&&Fe.is3D(x)&&!x){const Le=this.currentLayer,ht=Ye=>{for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){const gt=N[this.currentLayer];if(Nl[gt.type]){const Ot=this.style.getLayerSourceCache(gt);Nl[gt.type](this,Ot,gt,Ve(gt,Ot),Ye)}}};ht("initialize"),ht("reset"),this.currentLayer=Le,yt=!0}if(O&&!at&&this.terrain&&!this.transform.isOrthographic&&(at=!0,this.blitDepth()),L&&lt!==-1&&this.currentLayer===lt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,tt,tt?ee[tt.id]:void 0),this.renderLayer(this,tt,Fe,Ve(Fe,tt)),!this.terrain&&Ae&&Ge>0&&Fe.hasShadowPass()&&--Ge==0){{this.clearStencil();const Le=this.currentLayer;for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){const ht=N[this.currentLayer];if(Bf[ht.type]){const Ye=this.style.getLayerSourceCache(ht);Bf[ht.type](this,Ye,ht,Ve(ht,Ye))}}this.currentLayer=Le}if(Ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Le=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Le;this.currentLayer++){const ht=N[this.currentLayer];if(!ht.hasLightBeamPass())continue;const Ye=s.getLayerSourceCache(ht);this.renderLayer(this,Ye,ht,Ye?ie[Ye.id]:void 0)}this.currentLayer=Le,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Le=this.currentLayer;this.depthOcclusion=!0;for(const ht of this.layersWithOcclusionOpacity){this.currentLayer=ht;const Ye=N[this.currentLayer],gt=s.getLayerSourceCache(Ye),Ot=gt?ie[gt.id]:void 0;this.terrain||this._renderTileClippingMasks(Ye,gt,gt?ee[gt.id]:void 0),this.renderLayer(this,gt,Ye,Ot)}this.depthOcclusion=!1,this.currentLayer=Le,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;N.forEach(tt=>{const Le=s.getLayerSourceCache(tt);Le&&!tt.isHidden(this.transform.zoom)&&Le.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Le.getSource().maxzoom)&&(Fe=Le)}),Fe&&this.options.showTileBoundaries&&Ll(this,Fe,Fe.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ll(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const tt=Fe.transform.padding;Zm(Fe,Fe.transform.height-(tt.top||0),3,sP),Zm(Fe,tt.bottom||0,3,aP),Xm(Fe,tt.left||0,3,Ss),Xm(Fe,Fe.transform.width-(tt.right||0),3,yv);const Le=Fe.transform.centerPoint;(function(ht,Ye,gt,Ot){Oh(ht,Ye-1,gt-10,2,20,Ot),Oh(ht,Ye-10,gt-1,20,2,Ot)})(Fe,Le.x,Fe.transform.height-Le.y,Qo)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),W||(this.conflationActive=!1)}prepareLayer(s){this.gpuTimingStart(s);const{unsupportedLayers:u}=this.transform.projection,m=!u||!u.includes(s.type);if(Sv[s.type]&&(m||this.terrain&&s.type==="custom")){const v=this.style.getLayerSourceCache(s);Sv[s.type](s,v,this)}this.gpuTimingEnd()}renderLayer(s,u,m,v){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||v&&v.length)&&(this.id=m.id,this.gpuTimingStart(m),s.transform.projection.unsupportedLayers&&s.transform.projection.unsupportedLayers.includes(m.type)&&(!s.terrain||m.type!=="custom")||m.type==="clip"||rn[m.type](s,u,m,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery,m=this.context.gl;let v=this.gpuTimers[s.id];v||(v=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:m.createQuery()}),v.calls++,m.beginQuery(u.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,u=this.context.gl,m=u.createQuery();this.deferredRenderGpuTimeQueries.push(m),u.beginQuery(s.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const u={};for(const m in s){const v=s[m],x=this.context.extTimerQuery,S=x.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;x.deleteQueryEXT(v.query),u[m]=S}return u}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.gl;let m=0;for(const v of s)m+=u.getQueryParameter(v,u.QUERY_RESULT)/1e6,u.deleteQuery(v);return m}translatePosMatrix(s,u,m,v,x){if(!m[0]&&!m[1])return s;const S=x?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(S){const L=Math.sin(S),N=Math.cos(S);m=[m[0]*N-m[1]*L,m[0]*L+m[1]*N]}const P=[x?m[0]:o.aw(u,m[0],this.transform.zoom),x?m[1]:o.aw(u,m[1],this.transform.zoom),0],O=new Float32Array(16);return o.bo(O,s,P),O}saveTileTexture(s){const u=s.size[0],m=this._tileTextures[u];m?m.push(s):this._tileTextures[u]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(s,u,m){const v=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,x=[];return this.style&&this.style.enable3dLights()&&(s==="globeRaster"||s==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||x.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||v||u!==void 0&&!u||x.push("FOG","FOG_DITHERING"),v&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(s,u){this.cache=this.cache||{};const m=u&&u.defines||[],v=u&&u.config,x=this.currentGlobalDefines(s,u&&u.overrideFog,u&&u.overrideRtt).concat(m),S=Um.cacheKey(Im[s],s,x,v);return this.cache[S]||(this.cache[S]=new Um(this.context,s,Im[s],v,Cb[s],x)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(s,u){if(this.style.enable3dLights()){const m=this.style.directionalLight,v=this.style.ambientLight;if(m&&v){const x=((S,P,O)=>{const L=S.properties.get("direction"),N=S.properties.get("color-use-theme")==="none",V=S.properties.get("color").toNonPremultipliedRenderColor(N?null:O.getLut(S.scope)).toArray01(),$=S.properties.get("intensity"),W=P.properties.get("color-use-theme")==="none",re=P.properties.get("color").toNonPremultipliedRenderColor(W?null:O.getLut(P.scope)).toArray01(),ee=P.properties.get("intensity"),ie=[L.x,L.y,L.z],ae=o.dw(re,ee),ce=o.dw(V,$);return{u_lighting_ambient_color:ae,u_lighting_directional_dir:ie,u_lighting_directional_color:ce,u_ground_radiance:$m(ie,ce,ae)}})(m,v,this.style);u.setLightsUniformValues(s,x)}}}uploadCommonUniforms(s,u,m,v,x){if(this.uploadCommonLightUniforms(s,u),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const P=S.getOpacity(this.transform.pitch),O=((L,N,V,$,W,re,ee,ie,ae,ce,_e,be)=>{const Pe=L.transform,Ae=N.properties.get("color-use-theme")==="none",Te=N.properties.get("color").toNonPremultipliedRenderColor(Ae?null:L.style.getLut(N.scope)).toArray01();Te[3]=$;const we=L.frameCounter/1e3%1,[Ce,Oe]=N.properties.get("vertical-range");return{u_fog_matrix:V?Pe.calculateFogTileMatrix(V):be||L.identityMat,u_fog_range:N.getFovAdjustedRange(Pe._fov),u_fog_color:Te,u_fog_horizon_blend:N.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Ce,Oe),Oe],u_fog_temporal_offset:we,u_frustum_tl:W,u_frustum_tr:re,u_frustum_br:ee,u_frustum_bl:ie,u_globe_pos:ae,u_globe_radius:ce,u_viewport:_e,u_globe_transition:o.ah(Pe.zoom),u_is_globe:+(Pe.projection.name==="globe")}})(this,S,m,P,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],v);u.setFogUniformValues(s,O)}x&&u.setCutoffUniformValues(s,x.uniformValues)}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,u=s.createTexture();return s.bindTexture(s.TEXTURE_2D,u),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const v of m)u[v.key]=s[v.key]||new ou(v,512,this.transform.tileZoom,this,void 0,this.worldview);return u}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(s,u){return!(!s.is3D(!(!this.terrain||!this.terrain.enabled))||s.type!=="clip"&&(s.minzoom&&s.minzoom>this.transform.zoom||(this.style._clipLayerPresent||s.sourceLayer!=="building")&&(!u||u.type!=="batched-model")))}isTileAffectedByFog(s){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let u=this._cachedTileFogOpacities[s.key];return u||(this._cachedTileFogOpacities[s.key]=u=this.style.fog.getOpacityForTile(s)),u[0]>=Qe||u[1]>=Qe}setupDepthForOcclusion(s,u,m){const v=this.context,x=v.gl,S=!!m;var P;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),v.activeTexture.set(x.TEXTURE3),s&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((P=this.depthRangeFor3D)[1]-P[0]),-1-2*P[0]/(P[1]-P[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),v.activeTexture.set(x.TEXTURE0),S||u.setTerrainUniformValues(v,m)}}function Ic(p,s){let u=!1,m=null;const v=()=>{m=null,u&&(p(),m=setTimeout(v,s),u=!1)};return()=>(u=!0,m||v(),m)}class Tv{constructor(s){this._hashName=s&&encodeURIComponent(s),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ic(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const u=eg(s);if(this._hashName){const m=this._hashName;let v=!1;const x=location.hash.slice(1).split("&").map(S=>{const P=S.split("=")[0];return P===m?(v=!0,`${P}=${u}`):S}).filter(S=>S);return v||x.push(`${m}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){const s=location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(Number(m)))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(u[3]||0):s.getBearing();return s.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function eg(p,s){const u=p.getCenter(),m=Math.round(100*p.getZoom())/100,v=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,v),S=Math.round(u.lng*x)/x,P=Math.round(u.lat*x)/x,O=p.getBearing(),L=p.getPitch();let N=s?`/${S}/${P}/${m}`:`${m}/${P}/${S}`;return(O||L)&&(N+="/"+Math.round(10*O)/10),L&&(N+=`/${Math.round(L)}`),N}const Dh={linearity:.3,easing:o.ew(0,0,.3,1)},Ev=o.h({deceleration:2500,maxSpeed:1400},Dh),Qa=o.h({deceleration:20,maxSpeed:1400},Dh),Oc=o.h({deceleration:1e3,maxSpeed:360},Dh),$f=o.h({deceleration:1e3,maxSpeed:90},Dh);class tg{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=o.q.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const x=zh(u.pan.mag(),m,o.h({},Ev,s||{}));v.offset=u.pan.mult(x.amount/u.pan.mag()),v.center=this._map.transform.center,Lh(v,x)}if(u.zoom){const x=zh(u.zoom,m,Qa);v.zoom=this._map.transform.zoom+x.amount,Lh(v,x)}if(u.bearing){const x=zh(u.bearing,m,Oc);v.bearing=this._map.transform.bearing+o.ay(x.amount,-179,179),Lh(v,x)}if(u.pitch){const x=zh(u.pitch,m,$f);v.pitch=this._map.transform.pitch+x.amount,Lh(v,x)}if(v.zoom||v.bearing){const x=u.pinchAround===void 0?u.around:u.pinchAround;v.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function Lh(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function zh(p,s,u){const{maxSpeed:m,linearity:v,deceleration:x}=u,S=o.ay(p*v/(s/1e3),-m,m),P=Math.abs(S)/(x*v);return{easing:u.easing,duration:1e3*P,amount:S*(P/2)}}class So extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,m,v={}){const x=Se(u.getCanvasContainer(),m),S=u.unproject(x);super(s,o.h({point:x,lngLat:S,originalEvent:m},v)),this._defaultPrevented=!1,this.target=u}}class Nh extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,m){const v=s==="touchend"?m.changedTouches:m.touches,x=qe(u.getCanvasContainer(),v),S=x.map(O=>u.unproject(O)),P=x.reduce((O,L,N,V)=>O.add(L.div(V.length)),new o.P(0,0));super(s,{points:x,point:P,lngLats:S,lngLat:u.unproject(P),originalEvent:m}),this._defaultPrevented=!1}}class Mc extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u){super("wheel",{originalEvent:u}),this._defaultPrevented=!1}}class Av{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Mc(this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new So(s.type,this._map,s))}mouseup(s){this._map.fire(new So(s.type,this._map,s))}preclick(s){const u=o.h({},s);u.type="preclick",this._map.fire(new So(u.type,this._map,u))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(s),this._map.fire(new So(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new So(s.type,this._map,s))}mouseover(s){this._map.fire(new So(s.type,this._map,s))}mouseout(s){this._map.fire(new So(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Nh(s.type,this._map,s))}touchmove(s){this._map.fire(new Nh(s.type,this._map,s))}touchend(s){this._map.fire(new Nh(s.type,this._map,s))}touchcancel(s){this._map.fire(new Nh(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rg{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new So(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new So("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new So(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pv{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(J(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const m=u,v=this._startPos,x=this._lastPos;if(!v||!x||x.equals(m)||!this._box&&m.dist(v)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=j("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const S=Math.min(v.x,m.x),P=Math.max(v.x,m.x),O=Math.min(v.y,m.y),L=Math.max(v.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${O}px)`,this._box.style.width=P-S+"px",this._box.style.height=L-O+"px")})}mouseupWindow(s,u){if(!this._active)return;const m=this._startPos,v=u;if(m&&s.button===0){if(this.reset(),me(),m.x!==v.x||m.y!==v.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(m,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ne(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new o.A(s,{originalEvent:u}))}}function Uf(p,s){const u={};for(let m=0;m<p.length;m++)u[p[m].identifier]=s[m];return u}class To{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(v){const x=new o.P(0,0);for(const S of v)x._add(S);return x.div(v.length)}(u),this.touches=Uf(m,u)))}touchmove(s,u,m){if(this.aborted||!this.centroid)return;const v=Uf(m,u);for(const x in this.touches){const S=v[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,u,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Vf{constructor(s){this.singleTap=new To(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,u,m){this.singleTap.touchstart(s,u,m)}touchmove(s,u,m){this.singleTap.touchmove(s,u,m)}touchend(s,u,m){const v=this.singleTap.touchend(s,u,m);if(v){const x=s.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(v)<30;if(x&&S||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Cv{constructor(){this._zoomIn=new Vf({numTouches:1,numTaps:2}),this._zoomOut=new Vf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,m){this._zoomIn.touchstart(s,u,m),this._zoomOut.touchstart(s,u,m)}touchmove(s,u,m){this._zoomIn.touchmove(s,u,m),this._zoomOut.touchmove(s,u,m)}touchend(s,u,m){const v=this._zoomIn.touchend(s,u,m),x=this._zoomOut.touchend(s,u,m);return v?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(v)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Iv={0:1,2:2},Rc={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Gf{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,u){return!1}_move(s,u){return{}}mousedown(s,u){if(this._lastPoint)return;const m=Ze(s);this._correctButton(s,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(s,u){const m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&function(v,x){const S=Iv[x];return v.buttons===void 0||(v.buttons&S)!==S}(s,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}}mouseupWindow(s){this._lastPoint&&Ze(s)===this._eventButton&&(this._moved&&me(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ov extends Gf{mousedown(s,u){super.mousedown(s,u),this._lastPoint&&(this._active=!0)}_correctButton(s,u){return u===0&&!s.ctrlKey}_move(s,u){return{around:u,panDelta:u.sub(s)}}}class ng extends Gf{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Rc[s.pitchRotateKey]:void 0}_correctButton(s,u){return this._pitchRotateKey?u===0&&s[this._pitchRotateKey]:u===0&&s.ctrlKey||u===2}_move(s,u){const m=.8*(u.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class Au extends Gf{constructor(s){super(s),this._pitchRotateKey=s.pitchRotateKey?Rc[s.pitchRotateKey]:void 0}_correctButton(s,u){return this._pitchRotateKey?u===0&&s[this._pitchRotateKey]:u===0&&s.ctrlKey||u===2}_move(s,u){const m=-.5*(u.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){this._pitchRotateKey||s.preventDefault()}}class Mv{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(s,u,m){return this._calculateTransform(s,u,m)}touchmove(s,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!o.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,u,m)}}touchend(s,u,m){this._calculateTransform(s,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,m){m.length>0&&(this._active=!0);const v=Uf(m,u),x=new o.P(0,0),S=new o.P(0,0);let P=0;for(const L in v){const N=v[L],V=this._touches[L];V&&(x._add(N),S._add(N.sub(V)),P++,v[L]=N)}if(this._touches=v,P<this._minTouches||!S.mag())return;const O=S.div(P);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(P),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Hf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,u,m){return{}}touchstart(s,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,m){const v=this._firstTwoTouches;if(!v)return;s.preventDefault();const[x,S]=v,P=jh(m,u,x),O=jh(m,u,S);if(!P||!O)return;const L=this._aroundCenter?null:P.add(O).div(2);return this._move([P,O],L,s)}touchend(s,u,m){if(!this._firstTwoTouches)return;const[v,x]=this._firstTwoTouches,S=jh(m,u,v),P=jh(m,u,x);S&&P||(this._active&&me(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function jh(p,s,u){for(let m=0;m<p.length;m++)if(p[m].identifier===u)return s[m]}function Wf(p,s){return Math.log(p/s)/Math.LN2}class Rv extends Hf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Wf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Wf(this._distance,m),pinchAround:u}}}function ig(p,s){return 180*p.angleWith(s)/Math.PI}class Ub extends Hf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ig(this._vector,m),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const v=ig(s,m);return Math.abs(v)<u}}function og(p){return Math.abs(p.y)>Math.abs(p.x)}class Vb extends Hf{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,og(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,m){const v=this._lastPoints;if(!v)return;const x=s[0].sub(v[0]),S=s[1].sub(v[1]);return this._map._cooperativeGestures&&!o.ex()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,S,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+S.y)/2*-.5})}gestureBeginsVertically(s,u,m){if(this._valid!==void 0)return this._valid;const v=s.mag()>=2,x=u.mag()>=2;if(!v&&!x)return;if(!v||!x)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const S=s.y>0==u.y>0;return og(s)&&og(u)&&S}}const Gb={panStep:100,bearingStep:15,pitchStep:10};class Hb{constructor(){const s=Gb;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,m=0,v=0,x=0,S=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?v=1:(s.preventDefault(),S=-1);break;case 40:s.shiftKey?v=-1:(s.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(m=0,v=0),{cameraAnimation:P=>{const O=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Wb,zoom:u?Math.round(O)+u*(s.shiftKey?2:1):O,bearing:P.getBearing()+m*this._bearingStep,pitch:P.getPitch()+v*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:P.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Wb(p){return p*(2-p)}const kv=4.000244140625,qb=1/450;class Zb{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._handler=u,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=qb,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||o.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=o.q.now(),v=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%kv==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=window.setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Se(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>kv?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&N!==0&&(N=1/N);const V=u(),$=Math.pow(2,V),W=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(W*N))),this._type==="wheel"&&(this._startZoom=V,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:u(),v=this._startZoom,x=this._easing;let S,P=!1;if(this._type==="wheel"&&v&&x){const L=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),N=x(L);S=o.ai(v,m,N),L<1?this._frameId||(this._frameId=!0):P=!0}else S=m,P=!0;this._active=!0,P&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let O=S-u();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!P,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=o.ey;if(this._prevEase){const m=this._prevEase,v=(o.q.now()-m.start)/m.duration,x=m.easing(v+.01)-m.easing(v),S=.27/Math.sqrt(x*x+1e-4)*.01,P=Math.sqrt(.0729-S*S);u=o.ew(S,P,.25,1)}return this._prevEase={start:o.q.now(),duration:s,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Xb{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Kb{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,u){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yb{constructor(){this._tap=new Vf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,u,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,u,m))}touchmove(s,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const v=u[0],x=v.y-this._swipePoint.y;return this._swipePoint=v,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,u,m)}touchend(s,u,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,u,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jb{constructor(s,u,m){this._el=s,this._mousePan=u,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dP{constructor(s,u,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class fP{constructor(s,u,m,v){this._el=s,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const sg=p=>p.zoom||p.drag||p.pitch||p.rotate;class mi extends o.A{}class Qb{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,u){const m=o.at([],u,s);this.radius=o.ae(m[2]<0?o.eA([],m,this.constants):[m[0],m[1],0])}projectRay(s){o.eA(s,s,this.constants),o.au(s,s),o.eB(s,s,this.constants);const u=o.bY([],s,this.radius);if(u[2]>0){const m=o.bY([],[0,0,1],o.bG(u,[0,0,1])),v=o.bY([],o.au([],[u[0],u[1],0]),this.radius),x=o.cV([],u,o.bY([],o.at([],o.cV([],v,m),u),2));u[0]=x[0],u[1]=x[1]}return u}}function ag(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Dv{constructor(s,u){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tg(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Qb,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),o.aV(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,x,S]of this._listeners){const P=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(x,P,S)}}destroy(){for(const[s,u,m]of this._listeners){const v=s===document?this.handleWindowEvent:this.handleEvent;s.removeEventListener(u,v,m)}}_addDefaultHandlers(s){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new Av(u,s));const v=u.boxZoom=new Pv(u,s);this._add("boxZoom",v);const x=new Cv,S=new Kb;u.doubleClickZoom=new Xb(S,x),this._add("tapZoom",x),this._add("clickZoom",S);const P=new Yb;this._add("tapDragZoom",P);const O=u.touchPitch=new Vb(u);this._add("touchPitch",O);const L=new ng(s),N=new Au(s);u.dragRotate=new dP(s,L,N),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const V=new Ov(s),$=new Mv(u,s);u.dragPan=new Jb(m,V,$),this._add("mousePan",V),this._add("touchPan",$,["touchZoom","touchRotate"]);const W=new Ub,re=new Rv;u.touchZoomRotate=new fP(m,re,W,P),this._add("touchRotate",W,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new rg(u));const ee=u.scrollZoom=new Zb(u,this);this._add("scrollZoom",ee,["mousePan"]);const ie=u.keyboard=new Hb;this._add("keyboard",ie);for(const ae of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[ae]&&u[ae].enable(s[ae])}_add(s,u,m){this._handlers.push({handlerName:s,handler:u,allowed:m}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!sg(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,u,m){for(const v in s)if(v!==m&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const u=[];for(const m of s)this._el.contains(m.target)&&u.push(m);return u}handleEvent(s,u){this._updatingCamera=!0;const m=s.type==="renderFrame",v=m?void 0:s,x={needsRenderFrame:!1},S={},P={},O=s.touches?this._getMapTouches(s.touches):void 0,L=O?qe(this._el,O):m?void 0:Se(this._el,s);for(const{handlerName:$,handler:W,allowed:re}of this._handlers){if(!W.isEnabled())continue;let ee;this._blockedByActive(P,re,$)?W.reset():W[u||s.type]&&(ee=W[u||s.type](s,L,O),this.mergeHandlerResult(x,S,ee,$,v),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||W.isActive())&&(P[$]=W)}const N={};for(const $ in this._previousActiveHandlers)P[$]||(N[$]=v);this._previousActiveHandlers=P,(Object.keys(N).length||ag(x))&&(this._changes.push([x,S,N]),this._triggerRenderFrame()),(Object.keys(P).length||ag(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=x;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))}mergeHandlerResult(s,u,m,v,x){if(!m)return;o.h(s,m);const S={handlerName:v,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(u.zoom=S),m.panDelta!==void 0&&(u.drag=S),m.pitchDelta!==void 0&&(u.pitch=S),m.bearingDelta!==void 0&&(u.rotate=S)}_applyChanges(){const s={},u={},m={};for(const[v,x,S]of this._changes)v.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(v.panDelta)),v.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(s.around=v.around),v.aroundCoord!==void 0&&(s.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(s.pinchAround=v.pinchAround),v.noInertia&&(s.noInertia=v.noInertia),o.h(u,x),o.h(m,S);this._updateMapTransform(s,u,m),this._changes=[]}_updateMapTransform(s,u,m){const v=this._map,x=v.transform,S=ce=>[ce.x,ce.y,ce.z];if((ce=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!ag(s)){const ce=x.zoom;x.cameraElevationReference="sea",this._originalZoom!=null&&x._orthographicProjectionAtLowPitch&&x.projection.name!=="globe"&&x.pitch===0?(x.cameraElevationReference="ground",x.zoom=this._originalZoom):(x.recenterOnTerrain(),x.cameraElevationReference="ground"),ce!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&v._stop(!0),!ag(s))return void this._fireEvents(u,m,!0);let{panDelta:P,zoomDelta:O,bearingDelta:L,pitchDelta:N,around:V,aroundCoord:$,pinchAround:W}=s;x._isCameraConstrained&&(O>0&&(O=0),x._isCameraConstrained=!1),W!==void 0&&(V=W),(O||(ce=>u[ce]&&!this._eventsInProgress[ce])("drag"))&&V&&(this._dragOrigin=S(x.pointCoordinate3D(V)),this._originalZoom=x.zoom,this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",v._stop(!0),V=V||v.transform.centerPoint,L&&(x.bearing+=L),N&&(x.pitch+=N),x._updateCameraState();const re=[0,0,0];if(P)if(x.projection.name==="mercator"){const ce=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V).dir),_e=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(V.sub(P)).dir);re[0]=_e[0]-ce[0],re[1]=_e[1]-ce[1]}else{const ce=x.pointCoordinate(V);if(x.projection.name==="globe"){P=P.rotate(-x.angle);const _e=x._pixelsPerMercatorPixel/x.worldSize;re[0]=-P.x*o.ez(o.aY(ce.y))*_e,re[1]=-P.y*o.ez(x.center.lat)*_e}else{const _e=x.pointCoordinate(V.sub(P));ce&&_e&&(re[0]=_e.x-ce.x,re[1]=_e.y-ce.y)}}const ee=x.zoom,ie=[0,0,0];if(O){const ce=S($||x.pointCoordinate3D(V)),_e={dir:o.au([],o.at([],ce,x._camera.position))};if(_e.dir[2]<0){const be=x.zoomDeltaToMovement(ce,O);o.bY(ie,_e.dir,be)}}const ae=o.cV(re,re,ie);x._translateCameraConstrained(ae),O&&Math.abs(x.zoom-ee)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,m,!0)}_fireEvents(s,u,m){const v=sg(this._eventsInProgress),x=sg(s),S={};for(const N in s){const{originalEvent:V}=s[N];this._eventsInProgress[N]||(S[`${N}start`]=V),this._eventsInProgress[N]=s[N]}!v&&x&&this._fireEvent("movestart",x.originalEvent);for(const N in S)this._fireEvent(N,S[N]);x&&this._fireEvent("move",x.originalEvent);for(const N in s){const{originalEvent:V}=s[N];this._fireEvent(N,V)}const P={};let O;for(const N in this._eventsInProgress){const{handlerName:V,originalEvent:$}=this._eventsInProgress[N];this._handlersById[V].isActive()||(delete this._eventsInProgress[N],O=u[V]||$,P[`${N}end`]=O)}for(const N in P)this._fireEvent(N,P[N]);const L=sg(this._eventsInProgress);if(m&&(v||x)&&!L){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),V=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;N?(V(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:O})):(this._map.fire(new o.A("moveend",{originalEvent:O})),V(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new o.A(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new mi("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ew="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qf extends o.E{constructor(s,u){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,m){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,o.h({offset:s},u),m)}panTo(s,u,m){return this.easeTo(o.h({center:s},u),m)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,m){return this.easeTo(o.h({zoom:s},u),m)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,m){return this.easeTo(o.h({bearing:s},u),m)}resetNorth(s,u){return this.rotateTo(0,o.h({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=o.aG.convert(s);const m=u&&u.bearing||0,v=u&&u.pitch||0,x=s.getNorthWest(),S=s.getSouthEast();return this._cameraForBounds(this.transform,x,S,m,v,u)}_extendPadding(s){const u={top:0,right:0,bottom:0,left:0};return s==null?o.h({},u,this.transform.padding):typeof s=="number"?{top:s,bottom:s,right:s,left:s}:o.h({},u,s)}_extendCameraOptions(s){return(s=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=this._extendPadding(s.padding),s}_minimumAABBFrustumDistance(s,u){const m=u.max[0]-u.min[0],v=u.max[1]-u.min[1];return m/v>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):v/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,u,m,v,x,S){const P=s.clone(),O=this._extendCameraOptions(S);P.bearing=v,P.pitch=x;const L=o.cd.convert(u),N=o.cd.convert(m),V=.5*(L.lat+N.lat),$=.5*(L.lng+N.lng),W=o.eC(V,$),re=o.au([],W),ee=o.au([],o.bF([],re,[0,1,0])),ie=o.bF([],ee,re),ae=[ee[0],ee[1],ee[2],0,ie[0],ie[1],ie[2],0,re[0],re[1],re[2],0,0,0,0,1],ce=[W,o.eC(L.lat,L.lng),o.eC(N.lat,L.lng),o.eC(N.lat,N.lng),o.eC(L.lat,N.lng),o.eC(V,L.lng),o.eC(V,N.lng),o.eC(L.lat,$),o.eC(N.lat,$)];let _e=o.cW.fromPoints(ce.map(Ye=>[o.bG(ee,Ye),o.bG(ie,Ye),o.bG(re,Ye)]));const be=o.ad([],_e.center,ae);o.eD(be)===0&&o.eE(be,0,0,1),o.au(be,be),o.bY(be,be,o.aB),P.center=o.eF(be);const Pe=P.getWorldToCameraMatrix(),Ae=o.bi(new Float64Array(16),Pe);_e=o.cW.applyTransform(_e,o.az([],Pe,ae));const Te=this._extendAABB(_e,P,O,v);if(!Te)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_e=Te,o.ad(be,be,Pe);const we=.5*(_e.max[2]-_e.min[2]),Ce=this._minimumAABBFrustumDistance(P,_e),Oe=o.bY([],[0,0,1],we),Ve=o.cV(Oe,be,Oe),Ge=Ce+(P.pitch===0?0:o.bD(be,Ve)),at=P.globeCenterInViewSpace,lt=o.at([],be,[at[0],at[1],at[2]]);o.au(lt,lt),o.bY(lt,lt,Ge);const yt=o.cV([],be,lt);o.ad(yt,yt,Ae);const Fe=o.eq/o.aB,tt=o.ae(yt),Le=o.c6(Math.max(tt*Fe-o.eq,Number.EPSILON),0),ht=Math.min(P.zoomFromMercatorZAdjusted(Le),O.maxZoom);return ht>.5*(o.cL+o.cx)?(P.setProjection({name:"mercator"}),P.zoom=ht,this._cameraForBounds(P,u,m,v,x,S)):{center:P.center,zoom:ht,bearing:v,pitch:x}}_extendAABB(s,u,m,v){const x=.5*((m.padding.left||0)+(m.padding.right||0)),S=.5*((m.padding.top||0)+(m.padding.bottom||0)),P=S,O=x,L=x,N=S,V=u.width-(O+L),$=u.height-(P+N),W=o.at([],s.max,s.min),re=Math.min(V/W[0],$/W[1]),ee=Math.min(u.scaleZoom(u.scale*re),m.maxZoom);if(isNaN(ee))return null;const ie=u.scale/u.zoomScale(ee),ae=new o.cW([s.min[0]-O*ie,s.min[1]-N*ie,s.min[2]],[s.max[0]+L*ie,s.max[1]+P*ie,s.max[2]]),ce=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new o.P(m.offset.x,m.offset.y):o.P.convert(m.offset)).rotate(-o.al(v));return ae.center[0]-=ce.x*ie,ae.center[1]+=ce.y*ie,ae}queryTerrainElevation(s,u){const m=this.transform.elevation;return m?(u=o.h({},{exaggerated:!0},u),m.getAtPoint(o.ac.fromLngLat(s),null,u.exaggerated)):null}_cameraForBounds(s,u,m,v,x,S){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,u,m,v,x,S);const P=s.clone(),O=this._extendCameraOptions(S);P.bearing=v,P.pitch=x;const L=o.cd.convert(u),N=o.cd.convert(m),V=new o.cd(L.lng,N.lat),$=new o.cd(N.lng,L.lat),W=P.project(L),re=P.project(N),ee=this.queryTerrainElevation(L),ie=this.queryTerrainElevation(N),ae=this.queryTerrainElevation(V),ce=this.queryTerrainElevation($),_e=[[W.x,W.y,Math.min(ee||0,ie||0,ae||0,ce||0)],[re.x,re.y,Math.max(ee||0,ie||0,ae||0,ce||0)]];let be=o.cW.fromPoints(_e);const Pe=P.getWorldToCameraMatrix(),Ae=o.bi(new Float64Array(16),Pe);be=o.cW.applyTransform(be,Pe);const Te=this._extendAABB(be,P,O,v);if(!Te)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");be=Te;const we=.5*o.at([],be.max,be.min)[2],Ce=this._minimumAABBFrustumDistance(P,be),Oe=[0,0,1,0];o.aA(Oe,Oe,Pe),o.eG(Oe,Oe);const Ve=o.bY([],Oe,Ce+we),Ge=o.cV([],be.center,Ve);o.ad(be.center,be.center,Ae),o.ad(Ge,Ge,Ae);const at=P.unproject(new o.P(be.center[0],be.center[1])),lt=o.eH(P.projection,at),yt=Math.pow(2,lt),Fe=Math.min(P._zoomFromMercatorZ(Ge[2]*P.pixelsPerMeter*yt/P.worldSize),O.maxZoom);return P.mercatorFromTransition&&Fe<.5*(o.cL+o.cx)?(P.setProjection({name:"globe"}),P.zoom=Fe,this._cameraForBounds(P,u,m,v,x,S)):{center:at,zoom:Fe,bearing:v,pitch:x}}fitBounds(s,u,m){const v=this.cameraForBounds(s,u);return this._fitInternal(v,u,m)}fitScreenCoordinates(s,u,m,v,x){const S=o.P.convert(s),P=o.P.convert(u),O=new o.P(Math.min(S.x,P.x),Math.min(S.y,P.y)),L=new o.P(Math.max(S.x,P.x),Math.max(S.y,P.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,P))return this;const N=this.transform.pointLocation3D(O),V=this.transform.pointLocation3D(L),$=this.transform.pointLocation3D(new o.P(O.x,L.y)),W=this.transform.pointLocation3D(new o.P(L.x,O.y)),re=[Math.min(N.lng,V.lng,$.lng,W.lng),Math.min(N.lat,V.lat,$.lat,W.lat)],ee=[Math.max(N.lng,V.lng,$.lng,W.lng),Math.max(N.lat,V.lat,$.lat,W.lat)],ie=v&&v.pitch?v.pitch:this.getPitch(),ae=this._cameraForBounds(this.transform,re,ee,m,ie,v);return this._fitInternal(ae,v,x)}_fitInternal(s,u,m){return s?(u=o.h(s,u)).linear?this.easeTo(u,m):this.flyTo(u,m):this}jumpTo(s,u){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let v=!1,x=!1,S=!1;"zoom"in s&&m.zoom!==+s.zoom&&(v=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=o.cd.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(x=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(S=!0,m.pitch=+s.pitch);const P=typeof s.padding=="number"?this._extendPadding(s.padding):s.padding;if(s.padding!=null&&!m.isPaddingEqual(P))if(s.retainPadding===!1){const O=m.clone();O.padding=P,m.setLocationAtPoint(m.center,O.centerPoint)}else m.padding=P;return s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),v&&this.fire(new o.A("zoomstart",u)).fire(new o.A("zoom",u)).fire(new o.A("zoomend",u)),x&&this.fire(new o.A("rotatestart",u)).fire(new o.A("rotate",u)).fire(new o.A("rotateend",u)),S&&this.fire(new o.A("pitchstart",u)).fire(new o.A("pitch",u)).fire(new o.A("pitchend",u)),this.fire(new o.A("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(ew),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return o.w(ew),this;this.stop();const v=m.zoom,x=m.pitch,S=m.bearing;m.setFreeCameraOptions(s);const P=v!==m.zoom,O=x!==m.pitch,L=S!==m.bearing;return this.fire(new o.A("movestart",u)).fire(new o.A("move",u)),P&&this.fire(new o.A("zoomstart",u)).fire(new o.A("zoom",u)).fire(new o.A("zoomend",u)),L&&this.fire(new o.A("rotatestart",u)).fire(new o.A("rotate",u)).fire(new o.A("rotateend",u)),O&&this.fire(new o.A("pitchstart",u)).fire(new o.A("pitch",u)).fire(new o.A("pitchend",u)),this.fire(new o.A("moveend",u)),this}easeTo(s,u){this._stop(!1,s.easeId),((s=o.h({offset:[0,0],duration:500,easing:o.ey},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),P=this.getPadding(),O="zoom"in s?+s.zoom:v,L="bearing"in s?this._normalizeBearing(s.bearing,x):x,N="pitch"in s?+s.pitch:S,V=this._extendPadding(s.padding),$=o.P.convert(s.offset);let W,re,ee;if(m.projection.name==="globe"){const Oe=o.ac.fromLngLat(m.center),Ve=$.rotate(-m.angle);Oe.x+=Ve.x/m.worldSize,Oe.y+=Ve.y/m.worldSize;const Ge=Oe.toLngLat(),at=o.cd.convert(s.center||Ge);this._normalizeCenter(at),W=m.centerPoint.add(Ve),re=new o.P(Oe.x,Oe.y).mult(m.worldSize),ee=new o.P(o.aD(at.lng),o.aH(at.lat)).mult(m.worldSize).sub(re)}else{W=m.centerPoint.add($);const Oe=m.pointLocation(W),Ve=o.cd.convert(s.center||Oe);this._normalizeCenter(Ve),re=m.project(Oe),ee=m.project(Ve).sub(re)}const ie=m.zoomScale(O-v);let ae,ce;s.around&&(ae=o.cd.convert(s.around),ce=m.locationPoint(ae));const _e=this._zooming||O!==v,be=this._rotating||x!==L,Pe=this._pitching||N!==S,Ae=!m.isPaddingEqual(V),Te=s.retainPadding===!1?m.clone():m,we=Oe=>Ve=>{if(_e&&(Oe.zoom=o.ai(v,O,Ve)),be&&(Oe.bearing=o.ai(x,L,Ve)),Pe&&(Oe.pitch=o.ai(S,N,Ve)),Ae&&(Te.interpolatePadding(P,V,Ve),W=Te.centerPoint.add($)),ae)Oe.setLocationAtPoint(ae,ce);else{const Ge=Oe.zoomScale(Oe.zoom-v),at=O>v?Math.min(2,ie):Math.max(.5,ie),lt=Math.pow(at,1-Ve),yt=Oe.unproject(re.add(ee.mult(Ve*lt)).mult(Ge));Oe.setLocationAtPoint(Oe.renderWorldCopies?yt.wrap():yt,W)}return s.preloadOnly||this._fireMoveEvents(u),Oe};if(s.preloadOnly){const Oe=this._emulate(we,s.duration,m);return this._preloadTiles(Oe),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=be,this._pitching=Pe,this._padding=Ae,this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,Ce),this._ease(we(m),Oe=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(u,Oe)},s),this}_prepareEase(s,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),u||m.moving||this.fire(new o.A("movestart",s)),this._zooming&&!m.zooming&&this.fire(new o.A("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new o.A("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new o.A("pitchstart",s))}_fireMoveEvents(s){this.fire(new o.A("move",s)),this._zooming&&this.fire(new o.A("zoom",s)),this._rotating&&this.fire(new o.A("rotate",s)),this._pitching&&this.fire(new o.A("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,v=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.A("zoomend",s)),v&&this.fire(new o.A("rotateend",s)),x&&this.fire(new o.A("pitchend",s)),this.fire(new o.A("moveend",s))}flyTo(s,u){if(this._prefersReducedMotion(s)){const Ye=o.aF(s,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ye,u)}this.stop(),s=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.ey},s);const m=this.transform,v=this.getZoom(),x=this.getBearing(),S=this.getPitch(),P=this.getPadding(),O="zoom"in s?o.ay(+s.zoom,m.minZoom,m.maxZoom):v,L="bearing"in s?this._normalizeBearing(s.bearing,x):x,N="pitch"in s?+s.pitch:S,V=this._extendPadding(s.padding),$=m.zoomScale(O-v),W=o.P.convert(s.offset);let re=m.centerPoint.add(W);const ee=m.pointLocation(re),ie=o.cd.convert(s.center||ee);this._normalizeCenter(ie);const ae=m.project(ee),ce=m.project(ie).sub(ae);let _e=s.curve;const be=Math.max(m.width,m.height),Pe=be/$,Ae=ce.mag();if("minZoom"in s){const Ye=o.ay(Math.min(s.minZoom,v,O),m.minZoom,m.maxZoom),gt=be/m.zoomScale(Ye-v);_e=Math.sqrt(gt/Ae*2)}const Te=_e*_e;function we(Ye){const gt=(Pe*Pe-be*be+(Ye?-1:1)*Te*Te*Ae*Ae)/(2*(Ye?Pe:be)*Te*Ae);return Math.log(Math.sqrt(gt*gt+1)-gt)}function Ce(Ye){return(Math.exp(Ye)-Math.exp(-Ye))/2}function Oe(Ye){return(Math.exp(Ye)+Math.exp(-Ye))/2}const Ve=we(0);let Ge=function(Ye){return Oe(Ve)/Oe(Ve+_e*Ye)},at=function(Ye){return be*((Oe(Ve)*(Ce(gt=Ve+_e*Ye)/Oe(gt))-Ce(Ve))/Te)/Ae;var gt},lt=(we(1)-Ve)/_e;if(Math.abs(Ae)<1e-6||!isFinite(lt)){if(Math.abs(be-Pe)<1e-6)return this.easeTo(s,u);const Ye=Pe<be?-1:1;lt=Math.abs(Math.log(Pe/be))/_e,at=function(){return 0},Ge=function(gt){return Math.exp(Ye*_e*gt)}}s.duration="duration"in s?+s.duration:1e3*lt/("screenSpeed"in s?+s.screenSpeed/_e:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const yt=x!==L,Fe=N!==S,tt=!m.isPaddingEqual(V),Le=s.retainPadding===!1?m.clone():m,ht=Ye=>gt=>{const Ot=gt*lt,ut=1/Ge(Ot);Ye.zoom=gt===1?O:v+Ye.scaleZoom(ut),yt&&(Ye.bearing=o.ai(x,L,gt)),Fe&&(Ye.pitch=o.ai(S,N,gt)),tt&&(Le.interpolatePadding(P,V,gt),re=Le.centerPoint.add(W));const Ct=gt===1?ie:Ye.unproject(ae.add(ce.mult(at(Ot))).mult(ut));return Ye.setLocationAtPoint(Ye.renderWorldCopies?Ct.wrap():Ct,re),Ye._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(u),Ye};if(s.preloadOnly){const Ye=this._emulate(ht,s.duration,m);return this._preloadTiles(Ye),this}return this._zooming=!0,this._rotating=yt,this._pitching=Fe,this._padding=tt,this._prepareEase(u,!1),this._ease(ht(m),()=>this._afterEase(u),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(s){}_cancelRenderFrame(s){}_stop(s,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,u,m){m.animate===!1||m.duration===0?(s(1),u()):(this._easeStart=o.q.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,u){s=o.bX(s,-180,180);const m=Math.abs(s-u);return Math.abs(s-360-u)<m&&(s-=360),Math.abs(s+360-u)<m&&(s+=360),s}_normalizeCenter(s){const u=this.transform;if(u.maxBounds||u.projection.name!=="globe"&&!u.renderWorldCopies)return;const m=s.lng-u.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,u,m){const v=Math.ceil(15*u/1e3),x=[],S=s(m.clone());for(let P=0;P<=v;P++){const O=S(P/v);x.push(O.clone())}return x}_preloadTiles(s,u){}}class Lv{constructor(s={}){this.options=s,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const u=this.options&&this.options.compact,m=s._getUIString("AttributionControl.ToggleAttribution");this._map=s,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const v=j("span","mapboxgl-ctrl-icon",this._compactButton);return v.setAttribute("aria-hidden","true"),v.setAttribute("title",m),this._innerContainer=j("div","mapboxgl-ctrl-attrib-inner",this._container),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(s){const m=u.reduce((v,x,S)=>(x.value&&(v+=`${x.key}=${x.value}${S<u.length-1?"&":""}`),v),"?");s.href=`${o.e.FEEDBACK_URL}/${m}#${eg(this._map,!0)}`,s.rel="noopener nofollow"}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._mergedSourceCaches;for(const v in u){const x=u[v];if(x.used){const S=x.getSource();S.attribution&&s.indexOf(S.attribution)<0&&s.push(S.attribution)}}s.sort((v,x)=>v.length-x.length),s=s.filter((v,x)=>{for(let S=x+1;S<s.length;S++)if(s[S].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class lg{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=j("div","mapboxgl-ctrl");const u=j("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const u in s){const m=s[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Zf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const v of m)if(v.id===s)return void(v.cancelled=!0)}run(s=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class jl{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const u=o.dk((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,u,m){this._start=this.getValue(u),this._end=s,this._startTime=u,this._endTime=u+m}}const cg={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ki extends o.A{constructor(s,u,m,v){const{point:x,lngLat:S,originalEvent:P,target:O}=s;super(s.type,{point:x,lngLat:S,originalEvent:P,target:O}),this.preventDefault=()=>{s.preventDefault()},this.id=u,this.interaction=m,this.feature=v}}class el{constructor(s){this.map=s,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(s,u){if(this.typeById.has(s))throw new Error(`Interaction id "${s}" already exists.`);const m=u.filter;let v=u.type;m&&this.filters.set(s,o.b3(m)),v==="mouseover"&&(v="mouseenter"),v==="mouseout"&&(v="mouseleave");const x=this.interactionsByType.get(v)||new Map;v==="mouseenter"||v==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(s,u)):x.size===0&&this.map.on(v,this.handleType),x.size===0&&this.interactionsByType.set(v,x),x.set(s,u),this.typeById.set(s,v)}get(s){const u=this.typeById.get(s);if(!u)return;const m=this.interactionsByType.get(u);return m?m.get(s):void 0}remove(s){const u=this.typeById.get(s);if(!u)return;this.typeById.delete(s),this.filters.delete(s);const m=this.interactionsByType.get(u);m&&(m.delete(s),u==="mouseenter"||u==="mouseleave"?(this.delegatedInteractions.delete(s),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):m.size===0&&this.map.off(u,this.handleType))}queryTargets(s,u){const m=[];for(const[v,x]of u)x.target&&m.push({targetId:v,target:x.target,filter:this.filters.get(v)});return this.map.style.queryRenderedTargets(s,m,this.map.transform)}handleMove(s){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const u=this.queryTargets(s.point,Array.from(this.delegatedInteractions).reverse());u.length&&(s.type="mouseenter",this.handleType(s,u));const m=new Map;for(const[v,{feature:x}]of this.prevHoveredFeatures)this.hoveredFeatures.has(v)||m.set(x.id,x);m.size&&(s.type="mouseleave",this.handleType(s,Array.from(m.values())))}handleOut(s){const u=Array.from(this.hoveredFeatures.values()).map(({feature:m})=>m);u.length&&(s.type="mouseleave",this.handleType(s,u)),this.hoveredFeatures.clear()}handleType(s,u){const m=s.type==="mouseenter";if(m&&!this.interactionsByType.has(s.type))return void o.w("mouseenter interaction required for mouseleave to work.");const v=Array.from(this.interactionsByType.get(s.type)).reverse(),x=!!u;u=u||this.queryTargets(s.point,v);let S=!1;const P=new Set;for(const O of u){for(const[L,N]of v){if(!N.target)continue;const V=O.variants?O.variants[L]:null;if(V){for(const $ of V){if(fm($,O,P,L))continue;const W=new o.de(O,$),re=af($,O,L);x&&(W.state=this.map.getFeatureState(W));const ee=m?this.prevHoveredFeatures.get(re):null,ie=new ki(s,L,N,W),ae=ee?ee.stop:N.handler(ie);if(m&&this.hoveredFeatures.set(re,{feature:O,stop:ae}),ae!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[O,L]of v){const{handler:N,target:V}=L;if(!V&&N(new ki(s,O,L,null))!==!1)break}}}function Xf(p,s){if(Array.isArray(p)&&Array.isArray(s)){const u=new Set(p),m=new Set(s);return u.size===m.size&&p.every(v=>m.has(v))}return o.bv(p,s)}const ug={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},tw={showCompass:!0,showZoom:!0,visualizePitch:!1};class pP{constructor(s,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new ng({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new Au({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(s,u){this.mouseRotate.mousedown(s,u),this.mousePitch&&this.mousePitch.mousedown(s,u),J()}move(s,u){const m=this.map,v=this.mouseRotate.mousemoveWindow(s,u),x=v&&v.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){const S=this.mousePitch.mousemoveWindow(s,u),P=S&&S.pitchDelta;P&&m.setPitch(m.getPitch()+P)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ne(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(o.h({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Se(this.element,s)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Se(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=qe(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=qe(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Fh(p,s,u){if(p=new o.cd(p.lng,p.lat),s){const m=new o.cd(p.lng-360,p.lat),v=new o.cd(p.lng+360,p.lat),x=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),S=u.locationPoint3D(p).distSqr(s),P=s.x<0||s.y<0||s.x>u.width||s.y>u.height;u.locationPoint3D(m).distSqr(s)<S&&(P||Math.abs(m.lng-u.center.lng)<x)?p=m:u.locationPoint3D(v).distSqr(s)<S&&(P||Math.abs(v.lng-u.center.lng)<x)&&(p=v)}for(;Math.abs(p.lng-u.center.lng)>180;){const m=u.locationPoint3D(p);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const zv={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},tl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Kf extends o.E{constructor(s,u){super(),(s instanceof HTMLElement||u)&&(s=o.h({element:s},u)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:m="center",color:v="#3FB1CE",scale:x=1,draggable:S=!1,clickTolerance:P=0,rotation:O=tl.rotation,rotationAlignment:L=tl.rotationAlignment,pitchAlignment:N=tl.pitchAlignment,occludedOpacity:V=tl.occludedOpacity,altitude:$=tl.altitude}=s||{};this._anchor=m,this._color=v,this._scale=x,this._draggable=S,this._clickTolerance=P,this._rotation=O,this._rotationAlignment=L,this._pitchAlignment=N,this._occludedOpacity=V,this._altitude=$,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),s&&s.element?(this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(s&&s.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",ee=>{ee.preventDefault()}),this._element.addEventListener("mousedown",ee=>{ee.preventDefault()});const W=this._element.classList;for(const ee in zv)W.remove(`mapboxgl-marker-anchor-${ee}`);W.add(`mapboxgl-marker-anchor-${this._anchor}`);const re=s&&s.className?s.className.trim().split(/\s+/):[];W.add(...re),this._popup=null}_createDefaultMarker(){const s=j("div"),u=H("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},s);if(this._altitude===0){const m=H("radialGradient",{id:"shadowGradient"},H("defs",{},u));H("stop",{offset:"10%","stop-opacity":.4},m),H("stop",{offset:"100%","stop-opacity":.05},m),H("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u)}return H("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),H("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),H("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),s}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.cd.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(s){return s===this._altitude||(this._defaultMarker&&(this._altitude===0&&s!==0||this._altitude!==0&&s===0)&&(this._element=this._createDefaultMarker()),this._altitude=s||tl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,s._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const u=s.code,m=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){const u=s.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,u=this._pos;if(!s||!u)return!1;const m=s.unproject(u,this._altitude),v=s.getFreeCameraOptions();if(!v.position)return!1;const x=v.position.toLngLat();return x.distanceTo(m)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const u=this._pos;if(!u||u.x<0||u.x>s.transform.width||u.y<0||u.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(u,this._altitude);let v;s._showingGlobe()&&o.eK(s.transform,this._lngLat)?v=0:(v=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${zv[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const s=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!s||m!=="map")return"";if(!u._showingGlobe()){const O=u.getPitch();return O?`rotateX(${O}deg)`:""}const v=o.cJ(o.eL(u.transform,this._lngLat)),x=s.sub(o.eM(u.transform)),S=Math.abs(x.x)+Math.abs(x.y);if(S===0)return"";const P=v/S;return`rotateX(${-x.y*P}deg) rotateY(${x.x*P}deg)`}_calculateZTransform(){const s=this._pos,u=this._map;if(!u||!s)return"";let m=0;const v=this.getRotationAlignment();if(v==="map")if(u._showingGlobe()){const x=u.project(new o.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=u.project(new o.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(x);m=o.cJ(Math.atan2(S.y,S.x))-90}else m=-u.getBearing();else if(v==="horizon"){const x=o.af(4,6,u.getZoom()),S=o.eM(u.transform);S.y+=x*u.transform.height;const P=s.sub(S),O=o.cJ(Math.atan2(P.y,P.x));m=(O>90?O-270:O+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=Fh(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat,this._altitude),s===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){return this._element.classList.add(s),this}removeClassName(s){return this._element.classList.remove(s),this}toggleClassName(s){return this._element.classList.toggle(s)}_onMove(s){const u=this._map;if(!u)return;const m=this._pointerdownPos,v=this._positionDelta;if(m&&v){if(!this._isDragging){const x=this._clickTolerance||u._clickTolerance;if(s.point.dist(m)<x)return;this._isDragging=!0}this._pos=s.point.sub(v),this._lngLat=u.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(s){const u=this._map,m=this._pos;u&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const u=this._map;return u&&(s?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||tl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||tl.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||tl.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||tl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Nv={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Yf={maxWidth:100,unit:"metric"},Bh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Fl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ca=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ca(p=new o.P(0,0),s="bottom"){if(typeof p=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new o.P(0,p);case"top-left":return new o.P(u,u);case"top-right":return new o.P(-u,u);case"bottom":return new o.P(0,-p);case"bottom-left":return new o.P(u,-u);case"bottom-right":return new o.P(-u,-u);case"left":return new o.P(p,0);case"right":return new o.P(-p,0)}return new o.P(0,0)}return p instanceof o.P||Array.isArray(p)?o.P.convert(p):o.P.convert(p[s]||[0,0])}return{version:w,supported:G.supported,setRTLTextPlugin:o.eQ,getRTLTextPluginStatus:o.eP,Map:class extends qf{constructor(p){I.mark(T.create);const s=p;if((p=o.h({},ug,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.eI(window)&&(p.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Vy(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Zf,this._domRenderTaskQueue=new Zf,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},cg,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new jl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new $e(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const u=document.getElementById(p.container);if(!u)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=u}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new xv),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Dv(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||o.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this.indoor=new zA(this),p.hash&&(this._hash=new Tv(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){s.center==null&&s.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const u=p.bounds;u&&(this.resize(),this.fitBounds(u,o.h({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Lv({customAttribution:p.customAttribution})),this._logoControl=new lg,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",u=>{this._update(u.dataType==="style"),this.fire(new o.A(`${u.dataType}data`,u))}),this.on("dataloading",u=>{this.fire(new o.A(`${u.dataType}dataloading`,u))}),this._interactions=new el(this)}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new o.A("movestart",p)).fire(new o.A("move",p)),this.fire(new o.A("resize",p)),s&&this.fire(new o.A("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.aG.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(s=>s.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?navigator.language:s):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style.reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,s=p.projection.name;let u;s==="globe"&&p.zoom>=o.cx?(p.setMercatorFromTransition(),u=!0):s==="mercator"&&p.zoom<o.cx&&(p.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;return s=p.name==="globe"&&this.transform.zoom>=o.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,s){return this.transform.locationPoint3D(o.cd.convert(p),s)}unproject(p,s){return this.transform.pointLocation3D(o.P.convert(p),s)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,u){const m=v=>{let x=[];if(Array.isArray(s)){const S=s.filter(P=>this.getLayer(P));x=S.length?this.queryRenderedFeatures(v,{layers:S}):[]}else x=this.queryRenderedFeatures(v,{target:s});return x};if(p==="mouseenter"||p==="mouseover"){let v=!1;return{listener:u,targets:s,delegates:{mousemove:S=>{const P=m(S.point);P.length?v||(v=!0,u.call(this,new So(p,this,S.originalEvent,{features:P}))):v=!1},mouseout:()=>{v=!1}}}}if(p==="mouseleave"||p==="mouseout"){let v=!1;return{listener:u,targets:s,delegates:{mousemove:P=>{m(P.point).length?v=!0:v&&(v=!1,u.call(this,new So(p,this,P.originalEvent)))},mouseout:P=>{v&&(v=!1,u.call(this,new So(p,this,P.originalEvent)))}}}}{const v=x=>{const S=m(x.point);S.length&&(x.features=S,u.call(this,x),delete x.features)};return{listener:u,targets:s,delegates:{[p]:v}}}}on(p,s,u){if(typeof s=="function"||u===void 0)return super.on(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._createDelegatedListener(p,s,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const v in m.delegates)this.on(v,m.delegates[v]);return this}once(p,s,u){if(typeof s=="function"||u===void 0)return super.once(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._createDelegatedListener(p,s,u);for(const v in m.delegates)this.once(v,m.delegates[v]);return this}off(p,s,u){if(typeof s=="function"||u===void 0)return super.off(p,s);if(typeof s=="string"&&(s=[s]),!this._areTargetsValid(s))return this;const m=this._delegatedListeners?this._delegatedListeners[p]:void 0;return m&&(v=>{for(let x=0;x<v.length;x++){const S=v[x];if(S.listener===u&&Xf(S.targets,s)){for(const P in S.delegates)this.off(P,S.delegates[P]);return v.splice(x,1),this}}})(m),this}queryRenderedFeatures(p,s){if(!this.style)return[];if(p===void 0||p instanceof o.P||Array.isArray(p)||s!==void 0||(s=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!s){const x=this.style.queryRenderedFeatures(p,void 0,this.transform),S=this.style.queryRenderedFeatureset(p,void 0,this.transform);return x.concat(S)}let u=!0;if(s.target&&(u=this._isTargetValid(s.target),u&&!s.layers))return this.style.queryRenderedFeatureset(p,s,this.transform);let m=!0;if(s.layers&&Array.isArray(s.layers)){for(const x of s.layers)if(!this._isValidId(x)){m=!1;break}if(m&&!s.target)return this.style.queryRenderedFeatures(p,s,this.transform)}let v=[];return m&&(v=v.concat(this.style.queryRenderedFeatures(p,s,this.transform))),u&&(v=v.concat(this.style.queryRenderedFeatureset(p,s,this.transform))),v}querySourceFeatures(p,s){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,s)}isPointOnSurface(p){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&o.w(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(p))}addInteraction(p,s){return this._interactions.add(p,s),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,s){return s=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s),this.style&&p&&s.diff!==!1&&s.localFontFamily===this._localFontFamily&&s.localIdeographFontFamily===this._localIdeographFontFamily&&!s.config?(this.style._diffStyle(p,(u,m)=>{if(u){const v=typeof u=="string"?u:u instanceof Error?u.message:u.error;o.w(`Unable to perform style diff: ${v}. Rebuilding the style from scratch.`),this._updateStyle(p,s)}else m&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const u=o.h({},s);s&&s.config&&(u.initialConfig=s.config,delete u.config),this.style=new Fo(this,u).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.d8(p)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const s of p)if(!this._isValidId(s))return!1;return!0}return this._isTargetValid(p)}addSource(p,s){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,s,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,u)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,s,{pixelRatio:u=1,sdf:m=!1,stretchX:v,stretchY:x,content:S}={}){this._lazyInitEmptyStyle();const P=o.I.from(p);if(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap){const{width:O,height:L,data:N}=o.q.getImageData(s);this.style.addImage(P,{data:new o.r({width:O,height:L},N),pixelRatio:u,stretchX:v,stretchY:x,content:S,sdf:m,version:0,usvg:!1})}else if(s.width===void 0||s.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:L}=s,N=s;this.style.addImage(P,{data:new o.r({width:O,height:L},new Uint8Array(N.data)),pixelRatio:u,stretchX:v,stretchY:x,content:S,sdf:m,usvg:!1,version:0,userImage:N}),N.onAdd&&N.onAdd(this,p)}}updateImage(p,s){this._lazyInitEmptyStyle();const u=o.I.from(p),m=this.style.getImage(u);if(!m)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap?o.q.getImageData(s):s,{width:x,height:S,data:P}=v;if(x===void 0||S===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==(m.usvg?m.icon.usvg_tree.width:m.data.width)||S!==(m.usvg?m.icon.usvg_tree.height:m.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${x}, ${S})
                must be that same as the previous version of the image
                (${m.data.width}, ${m.data.height})`)));const O=!(s instanceof HTMLImageElement||ImageBitmap&&s instanceof ImageBitmap);let L=!1;m.usvg?(m.data=new o.r({width:x,height:S},new Uint8Array(P)),m.usvg=!1,m.icon=void 0,L=!0):m.data.replace(P,O),this.style.updateImage(u,m,L)}hasImage(p){return p?!!this.style&&!!this.style.getImage(o.I.from(p)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(o.I.from(p))}loadImage(p,s){o.o(this._requestManager.transformRequest(p,o.R.Image),(u,m)=>{s(u,m instanceof HTMLImageElement?o.q.getImageData(m):m)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,s){this._lazyInitEmptyStyle(),this.style.addModel(p,s)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,s){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)):this}getSlot(p){const s=this.getLayer(p);return s&&s.slot||null}setSlot(p,s){return this.style.setSlot(p,s),this.style.mergeLayers(),this._update(!0)}addImport(p,s){return this.style.addImport(p,s).catch(u=>this.fire(new o.z(new Error("Failed to add import",u)))),this}updateImport(p,s){return typeof s!="string"&&s.id!==p?(this.removeImport(p),this.addImport(s)):(this.style.updateImport(p,s),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,s){return this.style.moveImport(p,s),this._update(!0)}moveLayer(p,s){return this._isValidId(p)?(this.style.moveLayer(p,s),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const s=this.style.getOwnLayer(p);return s?s.type==="custom"?s.implementation:s.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,s,u){return this._isValidId(p)?(this.style.setLayerZoomRange(p,s,u),this._update(!0)):this}setFilter(p,s,u={}){return this._isValidId(p)?(this.style.setFilter(p,s,u),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,s,u,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,s,u,m),this._update(!0)):this}getPaintProperty(p,s){return this._isValidId(p)?this.style.getPaintProperty(p,s):null}setLayoutProperty(p,s,u,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,s,u,m),this._update(!0)):this}getLayoutProperty(p,s){return this._isValidId(p)?this.style.getLayoutProperty(p,s):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,s){return this.style.setSchema(p,s),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,s){return this.style.setConfig(p,s),this._update(!0)}getConfigProperty(p,s){return this.style.getConfigProperty(p,s)}setConfigProperty(p,s,u){return this.style.setConfigProperty(p,s,u),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const s=p[0];s.properties?this.style.setFlatLight(s.properties,s.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,s={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,s){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,s),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.cd.convert(p),this.transform):0}setFeatureState(p,s){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,s),this._update())}removeFeatureState(p,s){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,s),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let u,m,v,x=this._container;for(;x&&(!m||!v);){const S=window.getComputedStyle(x).transform;S&&S!=="none"&&(u=S.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(m=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(v=u[3])),x=x.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=v?Math.abs(s/v):s}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=j("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=j("div","mapboxgl-canvas-container",p);this._canvas=j("canvas","mapboxgl-canvas",s),this._interactive&&(s.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=j("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(v=>{m[v]=j("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const u=o.q.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const p=o.h({},G.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._canvas.getContext("webgl2",p);s?(Mt(s,!0),this.painter=new kh(s,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",u=>{u.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(s)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;this.fire(new o.A("renderstart")),++this._frameId;const u=this.painter.context.extTimerQuery,m=o.q.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(s=v.createQuery(),v.beginQuery(u.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,N=this.transform.pitch,V=o.q.now(),$=new o.aa(L,{now:V,fadeDuration:x,pitch:N,transition:this.style.transition,worldview:this._worldview});this.style.update($)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(m),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(m);const P=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),P&&(this._placementDirty=P.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,I.mark(T.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const L=o.q.now()-m;v.endQuery(u.TIME_ELAPSED_EXT),setTimeout(()=>{const N=v.getQueryParameter(s,v.QUERY_RESULT)/1e6;v.deleteQuery(s),this.fire(new o.A("gpu-timing-frame",{cpuTime:L,gpuTime:N}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const N=this.painter.queryGpuTimers(L);this.fire(new o.A("gpu-timing-layer",{layerTimes:N}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const N=this.painter.queryGpuTimeDeferredRender(L);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:N}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(O||this._repaint)this.triggerRepaint();else{const L=this.idle();if(L&&(S=this._updateAverageElevation(m,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const N=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:N})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,I.mark(T.fullLoad),this._performanceMetricsCollection&&Xr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const u=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const v=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=p;const S=Math.abs(v-x);if(S>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(x),u(x);this._averageElevation.easeTo(x,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(x),u(x)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){ur(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===dt||p.status===401)){const s=this.painter.context.gl;Mt(s,!1),this._logoControl instanceof lg&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Mr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&vr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function v(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);const S=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,S),S}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(v(p),s.canvasCopies.map(v),s.timeStamps)}_canvasPixelComparison(p,s,u){let m=u[1]-u[0];const v=p.length/4;for(let x=0;x<s.length;x++){const S=s[x];let P=0;for(let O=0;O<S.length;O+=4)S[O]===p[O]&&S[O+1]===p[O+1]&&S[O+2]===p[O+2]&&S[O+3]===p[O+3]&&(P+=1);m+=(u[x+2]-u[x+1])*(1-P/v)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),_r.delete(this.painter.context.gl),Lt.remove(),or.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.q.frame(s=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(s)}))}_preloadTiles(p){const s=this.style?this.style.getSourceCaches():[];return o.bt(s,(u,m)=>u._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,s){o.eJ(p,s)}get version(){return w}},NavigationControl:class{constructor(p={}){this.options=o.h({},tw,p),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),j("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),j("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:s}):u.resetNorth({},{originalEvent:s}))}),this._compassIcon=j("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),u=s===p.getMaxZoom(),m=s===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new pP(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const u=j("button",p,this._container);return u.type="button",u.addEventListener("click",s),u}_setButtonTitle(p,s){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends o.E{constructor(p={}){super();const s=navigator.geolocation;this.options=o.h({geolocation:s},Nv,p),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ic(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,p(u)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(u=>s(u.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),u=p.coords;return!!s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",p)),this._finish()}}_updateCamera(p){const s=new o.cd(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,m=this._map.getBearing(),v=o.h({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(u),v,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new o.cd(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=o.c6(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=j("button","mapboxgl-ctrl-geolocate",this._container),j("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j("div","mapboxgl-user-location"),this._dotElement.appendChild(j("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Kf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Kf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lv,ScaleControl:class{constructor(p={}){this.options=o.h({},Yf,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,u=s._containerHeight/2,m=s._containerWidth/2-p/2,v=s.unproject([m,u]),x=s.unproject([m+p,u]),S=v.distanceTo(x);if(this.options.unit==="imperial"){const P=3.2808*S;P>5280?this._setScale(p,P/5280,"mile"):this._setScale(p,P,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,s,u){this._map._requestDomTask(()=>{const m=function(x){const S=Math.pow(10,`${Math.floor(x)}`.length-1);let P=x/S;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(O){const L=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*L)/L}(P),S*P}(s),v=m/s;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(m):`${m}&nbsp;${Bh[u]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=j("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(p){super(),this.options=o.h(Object.create(Fl),p),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=o.cd.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const s=document.createDocumentFragment(),u=document.createElement("body");let m;for(u.innerHTML=p;m=u.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=j("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const u=this._closeButton=j("button","mapboxgl-popup-close-button",s);u.type="button",u.setAttribute("aria-label","Close popup"),u.innerHTML='<span aria-hidden="true">&#215;</span>',u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,u=this._container,m=this._pos;if(!s||!u||!m)return"bottom";const v=u.offsetWidth,x=u.offsetHeight,S=m.x<v/2,P=m.x>s.transform.width-v/2;if(m.y+p<x)return S?"top-left":P?"top-right":"top";if(m.y>s.transform.height-x){if(S)return"bottom-left";if(P)return"bottom-right"}return S?"left":P?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,u=this._content;if(!s||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=j("div","mapboxgl-popup",s.getContainer()),this._tip=j("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fh(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p instanceof o.P?p:s.project(this._lngLat,this._altitude),x=ca(this.options.offset),S=this._anchor=this._getAnchor(x.y),P=ca(this.options.offset,S),O=v.add(P).round();s._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${zv[S]} translate(${O.x}px,${O.y}px)`)})}if(!this._marker&&s._showingGlobe()){const v=o.eK(s.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Ca);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Kf,Style:Fo,LngLat:o.cd,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:ob,Evented:o.E,config:o.e,prewarm:o.eO,clearPrewarmedResources:o.eN,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(p){o.e.ACCESS_TOKEN=p},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(p){o.e.API_URL=p},get workerCount(){return o.eX.workerCount},set workerCount(p){o.eX.workerCount=p},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.eW(p)},get workerUrl(){return o.eV.workerUrl},set workerUrl(p){o.eV.workerUrl=p},get workerClass(){return o.eV.workerClass},set workerClass(p){o.eV.workerClass=p},get workerParams(){return o.eV.workerParams},set workerParams(p){o.eV.workerParams=p},get dracoUrl(){return o.eU()},set dracoUrl(p){o.eT(p)},get meshoptUrl(){return o.eS()},set meshoptUrl(p){o.eR(p)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var g=c;return g})})(sK);var vje=sK.exports;const xje=Ii(vje),bje=()=>{const e=Q.useRef(null),t=Q.useRef(null),[r,i]=Q.useState([]),[c,d]=Q.useState(null),[g,o]=Q.useState(!0),{toast:w}=Wd();Q.useEffect(()=>{T()},[]),Q.useEffect(()=>{if(e.current&&!t.current){w({title:"Mapbox Token Required",description:"Please set your Mapbox access token to view the map.",variant:"destructive"});return}return t.current&&r.length>0&&I(),()=>{t.current&&(t.current.remove(),t.current=null)}},[r]);const T=async()=>{try{const{data:R,error:F}=await ja.from("crime_incidents").select("*").not("latitude","is",null).not("longitude","is",null).order("created_at",{ascending:!1});if(F)throw F;i(R||[])}catch(R){console.error("Error fetching incidents:",R),w({title:"Error",description:"Failed to load crime incidents.",variant:"destructive"})}finally{o(!1)}},I=()=>{t.current&&r.forEach(R=>{if(R.latitude&&R.longitude){const F=document.createElement("div");F.className="marker",F.style.width="20px",F.style.height="20px",F.style.borderRadius="50%",F.style.cursor="pointer";const G={theft:"#ef4444",assault:"#f97316",vandalism:"#eab308",burglary:"#8b5cf6",other:"#6b7280"};F.style.backgroundColor=G[R.incident_type]||G.other,F.style.border="2px solid white",F.style.boxShadow="0 2px 4px rgba(0,0,0,0.3)",F.addEventListener("click",()=>{d(R)}),new xje.Marker(F).setLngLat([R.longitude,R.latitude]).addTo(t.current)}})},C=R=>{const F={pending:"bg-yellow-100 text-yellow-800",investigating:"bg-blue-100 text-blue-800",resolved:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"};return z.jsx(ac,{className:F[R]||F.pending,children:R})};return g?z.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:z.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):z.jsxs("div",{className:"container mx-auto px-4 py-8",children:[z.jsxs("div",{className:"mb-6",children:[z.jsxs("h1",{className:"text-3xl font-bold text-slate-900 flex items-center gap-3",children:[z.jsx(Hp,{className:"h-8 w-8 text-blue-600"}),"Crime Map"]}),z.jsx("p",{className:"text-slate-600 mt-2",children:"Interactive map showing reported crime incidents in your area."})]}),z.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[z.jsx("div",{className:"lg:col-span-2",children:z.jsxs(wi,{className:"h-[600px]",children:[z.jsx(Mi,{children:z.jsxs(Ri,{className:"flex items-center justify-between",children:[z.jsxs("span",{className:"flex items-center gap-2",children:[z.jsx(tne,{className:"h-5 w-5"}),"Interactive Map"]}),z.jsx("div",{className:"flex gap-2",children:z.jsxs(pi,{size:"sm",variant:"outline",children:[z.jsx(hG,{className:"h-4 w-4 mr-2"}),"Filter"]})})]})}),z.jsx(Si,{className:"p-0 h-[calc(100%-80px)]",children:z.jsx("div",{className:"flex items-center justify-center h-full bg-slate-50",children:z.jsxs("div",{className:"text-center space-y-4",children:[z.jsx(Hp,{className:"h-16 w-16 text-slate-400 mx-auto"}),z.jsxs("div",{children:[z.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Mapbox Integration Required"}),z.jsx("p",{className:"text-slate-500 max-w-md",children:"To view the interactive map, please add your Mapbox access token to the Map component. Get your token from mapbox.com."})]})]})})})]})}),z.jsxs("div",{className:"space-y-4",children:[z.jsxs(wi,{children:[z.jsx(Mi,{children:z.jsx(Ri,{className:"text-lg",children:"Legend"})}),z.jsxs(Si,{className:"space-y-3",children:[z.jsxs("div",{className:"flex items-center gap-3",children:[z.jsx("div",{className:"w-4 h-4 rounded-full bg-red-500"}),z.jsx("span",{className:"text-sm",children:"Theft"})]}),z.jsxs("div",{className:"flex items-center gap-3",children:[z.jsx("div",{className:"w-4 h-4 rounded-full bg-orange-500"}),z.jsx("span",{className:"text-sm",children:"Assault"})]}),z.jsxs("div",{className:"flex items-center gap-3",children:[z.jsx("div",{className:"w-4 h-4 rounded-full bg-yellow-500"}),z.jsx("span",{className:"text-sm",children:"Vandalism"})]}),z.jsxs("div",{className:"flex items-center gap-3",children:[z.jsx("div",{className:"w-4 h-4 rounded-full bg-purple-500"}),z.jsx("span",{className:"text-sm",children:"Burglary"})]}),z.jsxs("div",{className:"flex items-center gap-3",children:[z.jsx("div",{className:"w-4 h-4 rounded-full bg-gray-500"}),z.jsx("span",{className:"text-sm",children:"Other"})]})]})]}),c&&z.jsxs(wi,{children:[z.jsx(Mi,{children:z.jsx(Ri,{className:"text-lg",children:"Incident Details"})}),z.jsxs(Si,{className:"space-y-3",children:[z.jsxs("div",{children:[z.jsx("h3",{className:"font-semibold",children:c.title}),z.jsx("p",{className:"text-sm text-slate-600 mt-1",children:c.description})]}),z.jsxs("div",{className:"space-y-2",children:[z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"Type:"}),z.jsx("span",{className:"text-sm font-medium",children:c.incident_type})]}),z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"Status:"}),C(c.status)]}),z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"Priority:"}),z.jsx(ac,{variant:"outline",children:c.priority})]}),z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"Date:"}),z.jsx("span",{className:"text-sm",children:new Date(c.created_at).toLocaleDateString()})]})]}),c.address&&z.jsx("div",{className:"pt-2 border-t",children:z.jsxs("p",{className:"text-sm text-slate-600",children:[" ",c.address]})})]})]}),z.jsxs(wi,{children:[z.jsx(Mi,{children:z.jsx(Ri,{className:"text-lg",children:"Statistics"})}),z.jsxs(Si,{className:"space-y-3",children:[z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"Total Incidents:"}),z.jsx("span",{className:"text-sm font-semibold",children:r.length})]}),z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"This Month:"}),z.jsx("span",{className:"text-sm font-semibold",children:r.filter(R=>new Date(R.created_at).getMonth()===new Date().getMonth()).length})]}),z.jsxs("div",{className:"flex justify-between",children:[z.jsx("span",{className:"text-sm text-slate-500",children:"Pending:"}),z.jsx("span",{className:"text-sm font-semibold text-yellow-600",children:r.filter(R=>R.status==="pending").length})]})]})]})]})]})]})},wje=()=>{const e=im();return Q.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),z.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:z.jsxs("div",{className:"text-center",children:[z.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),z.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),z.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},Sje=new _se,Tje=()=>z.jsx(vse,{client:Sje,children:z.jsxs(Zoe,{children:[z.jsx(Wne,{}),z.jsx(bie,{}),z.jsx(Lce,{children:z.jsx(kce,{children:z.jsx(mae,{children:z.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-slate-800",children:z.jsxs(lae,{children:[z.jsx(Wl,{path:"/auth",element:z.jsx(gje,{})}),z.jsx(Wl,{path:"/",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(ONe,{})]})}),z.jsx(Wl,{path:"/report",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(lje,{})]})}),z.jsx(Wl,{path:"/view-crimes",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(uje,{})]})}),z.jsx(Wl,{path:"/community",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(hje,{})]})}),z.jsx(Wl,{path:"/emergency",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(dje,{})]})}),z.jsx(Wl,{path:"/profile",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(_je,{})]})}),z.jsx(Wl,{path:"/admin",element:z.jsxs(td,{adminOnly:!0,children:[z.jsx(rd,{}),z.jsx(yje,{})]})}),z.jsx(Wl,{path:"/map",element:z.jsxs(td,{children:[z.jsx(rd,{}),z.jsx(bje,{})]})}),z.jsx(Wl,{path:"*",element:z.jsx(wje,{})})]})})})})})]})});z8(document.getElementById("root")).render(z.jsx(Tje,{}));
